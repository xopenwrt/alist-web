;(function(){function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray2(arr)||_nonIterableSpread();}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter);}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray2(arr);}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value;}catch(error){reject(error);return;}if(info.done){resolve(value);}else{Promise.resolve(value).then(_next,_throw);}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value);}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err);}_next(undefined);});};}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;})),keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty2(target,key,source[key]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}return target;}function _defineProperty2(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _slicedToArray2(arr,i){return _arrayWithHoles2(arr)||_iterableToArrayLimit2(arr,i)||_unsupportedIterableToArray2(arr,i)||_nonIterableRest2();}function _nonIterableRest2(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _unsupportedIterableToArray2(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray2(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray2(o,minLen);}function _arrayLikeToArray2(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function _iterableToArrayLimit2(arr,i){var _i=arr==null?null:typeof Symbol!=="undefined"&&arr[Symbol.iterator]||arr["@@iterator"];if(_i==null)return;var _arr=[];var _n=true;var _d=false;var _s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"]!=null)_i["return"]();}finally{if(_d)throw _e;}}return _arr;}function _arrayWithHoles2(arr){if(Array.isArray(arr))return arr;}var __vite_style__=document.createElement('style');__vite_style__.innerHTML="::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-corner,::-webkit-scrollbar-track{background-color:#e2e2e2;border-radius:2px}::-webkit-scrollbar-thumb{border-radius:2px;background-color:rgba(0,0,0,.3)}::-webkit-scrollbar-button:vertical{display:none}::-webkit-scrollbar-thumb:vertical:hover{background-color:rgba(0,0,0,.35)}::-webkit-scrollbar-thumb:vertical:active{background-color:rgba(0,0,0,.38)}.chakra-ui-dark ::-webkit-scrollbar-corner,.chakra-ui-dark ::-webkit-scrollbar-track{background-color:#0f0f0f}.chakra-ui-dark ::-webkit-scrollbar-thumb{background-color:#2d2d2d}.chakra-ui-dark ::-webkit-scrollbar-thumb:vertical:hover{background-color:#3a3a3a}.chakra-ui-dark ::-webkit-scrollbar-thumb:vertical:active{background-color:#3a3a3a}\n";document.head.appendChild(__vite_style__);System.register(['./vendor-legacy.75b6488b.js','./index.esm-legacy.fe6c3c2e.js','./index-legacy.5c7fb3bb.js','./copy-clip-legacy.98530339.js'],function(exports,module){'use strict';var react,useLocation,useToast,useTranslation,useDisclosure,useColorModeValue,React,Box,Input,Heading,Progress,useHistory,HStack,Tooltip,Icon,Flex,Link,Image$1,Spinner,SlideFade,Center,VStack,Link$1,Breadcrumb,BreadcrumbItem,BreadcrumbLink,Text,Button,PropTypes,Spacer,FormControl,FormLabel,Switch,LinkBox,LinkOverlay,Modal,ModalOverlay,ModalContent,ModalHeader,ModalCloseButton,ModalBody,ModalFooter,axios,instance,admin,IContext,GenIcon,Md5_1,BsFillArrowDownCircleFill,BsFillArrowUpCircleFill,BsFillGridFill,FaListUl,getSetting,Markdown,BsFillFileEarmarkMinusFill,BsFillFileEarmarkImageFill,BsFillFileEarmarkFontFill,BsFillFileEarmarkMusicFill,BsFillFileEarmarkPlayFill,BsFileEarmarkWordFill,BsFillFileEarmarkExcelFill,BsFillFileEarmarkPptFill,BsFillFileEarmarkPdfFill,BsApple,BsWindows,BsFillFileEarmarkZipFill,DiAndroid,FaDatabase,BsFillMarkdownFill,FaBook,FaCompactDisc,Overlay,IContextProvider,__vitePreload,copyToClip;return{setters:[function(module){react=module.r;useLocation=module.u;useToast=module.h;useTranslation=module.j;useDisclosure=module.k;useColorModeValue=module.l;React=module.R;Box=module.n;Input=module.I;Heading=module.H;Progress=module.P;useHistory=module.o;HStack=module.p;Tooltip=module.q;Icon=module.s;Flex=module.F;Link=module.L;Image$1=module.t;Spinner=module.v;SlideFade=module.x;Center=module.C;VStack=module.V;Link$1=module.y;Breadcrumb=module.z;BreadcrumbItem=module.A;BreadcrumbLink=module.D;Text=module.E;Button=module.G;PropTypes=module.J;Spacer=module.K;FormControl=module.M;FormLabel=module.N;Switch=module.O;LinkBox=module.Q;LinkOverlay=module.U;Modal=module.W;ModalOverlay=module.X;ModalContent=module.Y;ModalHeader=module.Z;ModalCloseButton=module._;ModalBody=module.$;ModalFooter=module.a0;},function(module){axios=module.a;instance=module.i;admin=module.b;IContext=module.I;GenIcon=module.G;Md5_1=module.M;BsFillArrowDownCircleFill=module.B;BsFillArrowUpCircleFill=module.c;BsFillGridFill=module.d;FaListUl=module.F;getSetting=module.g;Markdown=module.e;BsFillFileEarmarkMinusFill=module.f;BsFillFileEarmarkImageFill=module.h;BsFillFileEarmarkFontFill=module.j;BsFillFileEarmarkMusicFill=module.k;BsFillFileEarmarkPlayFill=module.l;BsFileEarmarkWordFill=module.m;BsFillFileEarmarkExcelFill=module.n;BsFillFileEarmarkPptFill=module.o;BsFillFileEarmarkPdfFill=module.p;BsApple=module.q;BsWindows=module.r;BsFillFileEarmarkZipFill=module.s;DiAndroid=module.D;FaDatabase=module.t;BsFillMarkdownFill=module.u;FaBook=module.v;FaCompactDisc=module.w;Overlay=module.O;IContextProvider=module.x;},function(module){__vitePreload=module._;},function(module){copyToClip=module.c;}],execute:function execute(){var _Object$freeze,_Object$freeze2,_Object$freeze3;exports({F:FcPlus,I:IoIosFolder,d:FcSynchronize,f:FcTodoList,g:FcSupport,h:FcInternal,i:FcDownload,j:FcLink,k:FcRefresh,l:FcAlphabeticalSortingAz,n:FcNumericalSorting12,o:FcClock,r:getFileSize});var pathJoin$1=function pathJoin$1(){for(var _len4=arguments.length,paths=new Array(_len4),_key4=0;_key4<_len4;_key4++){paths[_key4]=arguments[_key4];}return paths.join("/").replace(/\/{2,}/g,"/");};var _cancelPath;var CancelToken=axios.CancelToken;var useApi=exports('b',function(){var _react$exports$useCon=react.exports.useContext(IContext),password=_react$exports$useCon.password,page=_react$exports$useCon.page;var _useLocation=useLocation(),pathname=_useLocation.pathname;var _path=pathname;return{path:function path(){return instance.post("path",{path:_path,password:password,page_num:page.page_num,page_size:page.page_size},{cancelToken:new CancelToken(function executor(c){_cancelPath=c;})});},cancelPath:function cancelPath(){_cancelPath&&_cancelPath();},mkdir:function mkdir(name){var path_=pathJoin$1(_path,name);return admin.post("mkdir",{path:path_});},rename:function rename(name,old){var path_=pathJoin$1(_path,old);return admin.post("rename",{name:name,path:path_});},move:function move(names,dir){return admin.post("move",{src_dir:_path,dst_dir:dir,names:names});},copy:function copy(names,dir){return admin.post("copy",{src_dir:_path,dst_dir:dir,names:names});},refresh:function refresh(){return admin.post("refresh",{path:_path});}};});// THIS FILE IS AUTO GENERATED
function IoIosCopy(props){return GenIcon({"tag":"svg","attr":{"viewBox":"0 0 512 512"},"child":[{"tag":"path","attr":{"d":"M352 115h90c3.3 0 6-2.7 6-6 0-8.2-3.7-16-10-21.3l-77.1-64.2c-4.9-4.1-14.2-7.4-20.6-7.4-4.1 0-7.4 3.3-7.4 7.4V96c.1 10.5 8.6 19 19.1 19z"}},{"tag":"path","attr":{"d":"M307 96V16H176c-17.6 0-32 14.4-32 32v336c0 17.6 14.4 32 32 32h240c17.6 0 32-14.4 32-32V141h-96c-24.8 0-45-20.2-45-45z"}},{"tag":"path","attr":{"d":"M116 412V80H96c-17.6 0-32 14.4-32 32v352c0 17.6 14.4 32 32 32h256c17.6 0 32-14.4 32-32v-20H148c-17.6 0-32-14.4-32-32z"}}]})(props);}function IoIosFolder(props){return GenIcon({"tag":"svg","attr":{"viewBox":"0 0 512 512"},"child":[{"tag":"path","attr":{"d":"M480 119c0-13.3-9.4-23-22.8-23H198.9c-2.8 0-4.3-.6-6.1-2.4l-22.5-22.5-.2-.2c-4.9-4.6-8.9-6.9-17.3-6.9H56.7C42.9 64 32 74.3 32 87v73.7c0 1.6 1.7 1.5 3 .7s5-1.4 7-1.4h428c2 0 5.7.6 7 1.4 1.3.8 3 .9 3-.7V119zM32 416.4c0 17.5 14.2 31.6 31.6 31.6H448c17.6 0 32-14.4 32-32V204c0-8.8-7.2-16-16-16H48c-8.8 0-16 7.2-16 16v212.4z"}}]})(props);}var useFolderLink=exports('u',function(){var proxy=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var _react$exports$useCon2=react.exports.useContext(IContext),type=_react$exports$useCon2.type;var _useLocation2=useLocation(),pathname=_useLocation2.pathname;var host="/";if(host==="/"){host=window.location.origin+"/";}var path=pathname.endsWith("/")?pathname.slice(0,-1):pathname;if(type==="file"){path=path.substring(0,path.lastIndexOf("/"));}if(proxy){return"".concat(host,"p").concat(path);}return"".concat(host,"d").concat(path);});var md5=function md5(str){return Md5_1.hashStr(str);};var md5_16=exports('m',function(str){return md5(str).slice(8,24);});var useEncrypt=exports('a',function(){var _react$exports$useCon3=react.exports.useContext(IContext),getSetting=_react$exports$useCon3.getSetting,password=_react$exports$useCon3.password,loggedIn=_react$exports$useCon3.loggedIn;return function(url){var encode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var link=encode?encodeURI(url):url;if(getSetting("check down link")!=="true"){return link;}var name=url.split("/").pop();var token=localStorage.getItem("admin-token");if(loggedIn){var sign=md5_16("alist-".concat(token,"-").concat(name));return link+(encode?encodeURI("?sign=".concat(sign)):"?sign=".concat(sign));}if(!password){return link;}var pw=md5_16("alist-".concat(password,"-").concat(name));return link+(encode?encodeURI("?pw=".concat(pw)):"?pw=".concat(pw));};});var useFileUrl=exports('e',function(){var proxy=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var encode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var link=useFolderLink(proxy);var encrypt=useEncrypt();var _react$exports$useCon4=react.exports.useContext(IContext),files=_react$exports$useCon4.files;return function(){var file=arguments.length>0&&arguments[0]!==undefined?arguments[0]:void 0;if(!file){file=files[0];}var url=link;if(!url.endsWith(file.name)){url="".concat(url,"/").concat(file.name);}return encrypt(url,encode);};});function mitt(n){return{all:n=n||new Map(),on:function on(t,e){var i=n.get(t);i?i.push(e):n.set(t,[e]);},off:function off(t,e){var i=n.get(t);i&&(e?i.splice(i.indexOf(e)>>>0,1):n.set(t,[]));},emit:function emit(t,e){var i=n.get(t);i&&i.slice().map(function(n){n(e);}),(i=n.get("*"))&&i.slice().map(function(n){n(t,e);});}};}var bus=exports('c',mitt());function getFileSize(size){if(!size)return"-";var num=1024;if(size<num)return size+"B";if(size<Math.pow(num,2))return(size/num).toFixed(2)+"K";if(size<Math.pow(num,3))return(size/Math.pow(num,2)).toFixed(2)+"M";if(size<Math.pow(num,4))return(size/Math.pow(num,3)).toFixed(2)+"G";return(size/Math.pow(num,4)).toFixed(2)+"T";}var pathJoin=exports('p',function(){for(var _len5=arguments.length,paths=new Array(_len5),_key5=0;_key5<_len5;_key5++){paths[_key5]=arguments[_key5];}return paths.join("/").replace(/\/{2,}/g,"/");});var oldTimestamp=new Date().valueOf();var oldLoaded=0;var Uploader=react.exports.forwardRef(function(_props,ref){react.exports.useImperativeHandle(ref,function(){return{upload:function upload(){setProgress(0);var fileInput=document.querySelector("#upload-input");fileInput.click();}};});var _react$exports$useCon5=react.exports.useContext(IContext),password=_react$exports$useCon5.password;var _useLocation3=useLocation(),pathname=_useLocation3.pathname;var toast=useToast();var _react$exports$useSta=react.exports.useState(50),_react$exports$useSta2=_slicedToArray2(_react$exports$useSta,2),progress=_react$exports$useSta2[0],setProgress=_react$exports$useSta2[1];var _useTranslation=useTranslation(),t=_useTranslation.t;var _useDisclosure=useDisclosure(),isOpen=_useDisclosure.isOpen,onOpen=_useDisclosure.onOpen,onClose=_useDisclosure.onClose;var bgColor=useColorModeValue("gray.100","gray.600");var _react$exports$useSta3=react.exports.useState("Uploading"),_react$exports$useSta4=_slicedToArray2(_react$exports$useSta3,2),msg=_react$exports$useSta4[0],setMsg=_react$exports$useSta4[1];return/* @__PURE__ */React.createElement(Box,null,/* @__PURE__ */React.createElement(Input,{display:"none",type:"file",multiple:true,id:"upload-input",onChange:function onChange(e){var files=e.target.files;var file=files[0];if(!files||!file){return;}onOpen();var form=new FormData();for(var i=0;i<files.length;i++){form.append("files",files[i],files[i].name);}form.append("path",pathname);form.append("password",password);instance.post("upload",form,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function onUploadProgress(progressEvent){if(progressEvent.lengthComputable){var complete=progressEvent.loaded/progressEvent.total*100|0;console.log("complete",complete);setProgress(complete);var timestamp=new Date().valueOf();var duration=(timestamp-oldTimestamp)/1e3;if(duration>1){var loaded=progressEvent.loaded-oldLoaded;var speed=loaded/duration;var remain=progressEvent.total-progressEvent.loaded;var remainTime=remain/speed;setMsg("".concat(getFileSize(speed),"/s  (").concat(t("about remaining")," ").concat(Math.round(remainTime)).concat(t("s"),")"));oldTimestamp=timestamp;oldLoaded=progressEvent.loaded;}if(complete===100){setMsg("Back-end processing");}}}}).then(function(resp){onClose();var fileInput=document.querySelector("#upload-input");fileInput.value="";var res=resp.data;toast({title:t(res.message),status:res.code===200?"success":"error",duration:3e3,isClosable:true});bus.emit("refresh");});}}),/* @__PURE__ */React.createElement(Box,{zIndex:99,w:{base:"80vw",md:"40vw"},position:"fixed",bottom:"20px",right:"20px",bgColor:bgColor,rounded:"lg",p:4,display:isOpen?"block":"none"},/* @__PURE__ */React.createElement(Heading,{mb:2,fontSize:20},t(msg),"..."),/* @__PURE__ */React.createElement(Progress,{hasStripe:true,isAnimated:true,rounded:"lg",value:progress})));});// THIS FILE IS AUTO GENERATED
function FcAlphabeticalSortingAz(props){return GenIcon({"tag":"svg","attr":{"version":"1","viewBox":"0 0 48 48","enableBackground":"new 0 0 48 48"},"child":[{"tag":"polygon","attr":{"fill":"#546E7A","points":"38,33 38,5 34,5 34,33 28,33 36,43 44,33"}},{"tag":"g","attr":{"fill":"#2196F3"},"child":[{"tag":"path","attr":{"d":"M16.8,17.2h-5.3l-1.1,3H6.9L12.6,5h2.9l5.7,15.2h-3.2L16.8,17.2z M12.2,14.5H16l-1.9-5.7L12.2,14.5z"}},{"tag":"path","attr":{"d":"M12.4,40.5H20V43H8.4v-1.9L16,30.3H8.4v-2.5h11.4v1.7L12.4,40.5z"}}]}]})(props);}function FcClock(props){return GenIcon({"tag":"svg","attr":{"version":"1","viewBox":"0 0 48 48","enableBackground":"new 0 0 48 48"},"child":[{"tag":"circle","attr":{"fill":"#00ACC1","cx":"24","cy":"24","r":"20"}},{"tag":"circle","attr":{"fill":"#eee","cx":"24","cy":"24","r":"16"}},{"tag":"rect","attr":{"x":"23","y":"11","width":"2","height":"13"}},{"tag":"rect","attr":{"x":"26.1","y":"22.7","transform":"matrix(-.707 .707 -.707 -.707 65.787 27.25)","width":"2.3","height":"9.2"}},{"tag":"circle","attr":{"cx":"24","cy":"24","r":"2"}},{"tag":"circle","attr":{"fill":"#00ACC1","cx":"24","cy":"24","r":"1"}}]})(props);}function FcDownload(props){return GenIcon({"tag":"svg","attr":{"version":"1","viewBox":"0 0 48 48","enableBackground":"new 0 0 48 48"},"child":[{"tag":"g","attr":{"fill":"#1565C0"},"child":[{"tag":"polygon","attr":{"points":"24,37.1 13,24 35,24"}},{"tag":"rect","attr":{"x":"20","y":"4","width":"8","height":"4"}},{"tag":"rect","attr":{"x":"20","y":"10","width":"8","height":"4"}},{"tag":"rect","attr":{"x":"20","y":"16","width":"8","height":"11"}},{"tag":"rect","attr":{"x":"6","y":"40","width":"36","height":"4"}}]}]})(props);}function FcInternal(props){return GenIcon({"tag":"svg","attr":{"version":"1","viewBox":"0 0 48 48","enableBackground":"new 0 0 48 48"},"child":[{"tag":"circle","attr":{"fill":"#B3E5FC","cx":"24","cy":"30","r":"15"}},{"tag":"g","attr":{"fill":"#1565C0"},"child":[{"tag":"polygon","attr":{"points":"24,38.7 15,28 33,28"}},{"tag":"rect","attr":{"x":"21","y":"5","width":"6","height":"26"}}]}]})(props);}function FcLink(props){return GenIcon({"tag":"svg","attr":{"version":"1","viewBox":"0 0 48 48","enableBackground":"new 0 0 48 48"},"child":[{"tag":"g","attr":{"fill":"#1976D2"},"child":[{"tag":"path","attr":{"d":"M38,13h-3c-5.5,0-10,4.5-10,10s4.5,10,10,10h3c5.5,0,10-4.5,10-10S43.5,13,38,13z M38,29h-3 c-3.3,0-6-2.7-6-6s2.7-6,6-6h3c3.3,0,6,2.7,6,6S41.3,29,38,29z"}},{"tag":"path","attr":{"d":"M13,13h-3C4.5,13,0,17.5,0,23s4.5,10,10,10h3c5.5,0,10-4.5,10-10S18.5,13,13,13z M13,29h-3 c-3.3,0-6-2.7-6-6s2.7-6,6-6h3c3.3,0,6,2.7,6,6S16.3,29,13,29z"}}]},{"tag":"path","attr":{"fill":"#42A5F5","d":"M33,21H15c-1.1,0-2,0.9-2,2s0.9,2,2,2h18c1.1,0,2-0.9,2-2S34.1,21,33,21z"}}]})(props);}function FcNumericalSorting12(props){return GenIcon({"tag":"svg","attr":{"version":"1","viewBox":"0 0 48 48","enableBackground":"new 0 0 48 48"},"child":[{"tag":"polygon","attr":{"fill":"#546E7A","points":"38,33 38,5 34,5 34,33 28,33 36,43 44,33"}},{"tag":"g","attr":{"fill":"#2196F3"},"child":[{"tag":"path","attr":{"d":"M16.4,20h-3V8.6L9.9,9.7V7.3L16,5.1h0.3V20z"}},{"tag":"path","attr":{"d":"M19.4,43H9.2v-2l4.8-5.1c0.4-0.4,0.7-0.8,0.9-1.1c0.2-0.3,0.5-0.6,0.6-0.9c0.2-0.3,0.3-0.5,0.3-0.8 c0.1-0.2,0.1-0.5,0.1-0.7c0-0.7-0.2-1.2-0.5-1.6c-0.3-0.4-0.8-0.6-1.4-0.6c-0.3,0-0.7,0.1-0.9,0.2c-0.3,0.1-0.5,0.3-0.7,0.5 c-0.2,0.2-0.3,0.5-0.4,0.8s-0.1,0.6-0.1,1h-3c0-0.7,0.1-1.3,0.4-1.9c0.2-0.6,0.6-1.1,1-1.6c0.5-0.4,1-0.8,1.6-1.1 c0.6-0.3,1.4-0.4,2.2-0.4c0.8,0,1.5,0.1,2.1,0.3c0.6,0.2,1.1,0.5,1.5,0.8s0.7,0.8,0.9,1.3s0.3,1.1,0.3,1.8c0,0.5-0.1,1-0.2,1.4 S18.3,34.5,18,35s-0.6,0.9-1,1.4c-0.4,0.5-0.9,1-1.4,1.5L13,40.6h6.4V43z"}}]}]})(props);}function FcPlus(props){return GenIcon({"tag":"svg","attr":{"version":"1","viewBox":"0 0 48 48","enableBackground":"new 0 0 48 48"},"child":[{"tag":"circle","attr":{"fill":"#4CAF50","cx":"24","cy":"24","r":"21"}},{"tag":"g","attr":{"fill":"#fff"},"child":[{"tag":"rect","attr":{"x":"21","y":"14","width":"6","height":"20"}},{"tag":"rect","attr":{"x":"14","y":"21","width":"20","height":"6"}}]}]})(props);}function FcRefresh(props){return GenIcon({"tag":"svg","attr":{"version":"1","viewBox":"0 0 48 48","enableBackground":"new 0 0 48 48"},"child":[{"tag":"g","attr":{"fill":"#1565C0"},"child":[{"tag":"path","attr":{"d":"M13,13c0-3.3,2.7-6,6-6h10c3.3,0,6,2.7,6,6h4c0-5.5-4.5-10-10-10H19C13.5,3,9,7.5,9,13v11.2h4V13z"}},{"tag":"polygon","attr":{"points":"4.6,22 11,30.4 17.4,22"}}]},{"tag":"g","attr":{"fill":"#1565C0"},"child":[{"tag":"path","attr":{"d":"M35,35c0,3.3-2.7,6-6,6H19c-3.3,0-6-2.7-6-6H9c0,5.5,4.5,10,10,10h10c5.5,0,10-4.5,10-10V23h-4V35z"}},{"tag":"polygon","attr":{"points":"30.6,26 37,17.6 43.4,26"}}]}]})(props);}function FcSearch(props){return GenIcon({"tag":"svg","attr":{"version":"1","viewBox":"0 0 48 48","enableBackground":"new 0 0 48 48"},"child":[{"tag":"g","attr":{"fill":"#616161"},"child":[{"tag":"rect","attr":{"x":"34.6","y":"28.1","transform":"matrix(.707 -.707 .707 .707 -15.154 36.586)","width":"4","height":"17"}},{"tag":"circle","attr":{"cx":"20","cy":"20","r":"16"}}]},{"tag":"rect","attr":{"x":"36.2","y":"32.1","transform":"matrix(.707 -.707 .707 .707 -15.839 38.239)","fill":"#37474F","width":"4","height":"12.3"}},{"tag":"circle","attr":{"fill":"#64B5F6","cx":"20","cy":"20","r":"13"}},{"tag":"path","attr":{"fill":"#BBDEFB","d":"M26.9,14.2c-1.7-2-4.2-3.2-6.9-3.2s-5.2,1.2-6.9,3.2c-0.4,0.4-0.3,1.1,0.1,1.4c0.4,0.4,1.1,0.3,1.4-0.1 C16,13.9,17.9,13,20,13s4,0.9,5.4,2.5c0.2,0.2,0.5,0.4,0.8,0.4c0.2,0,0.5-0.1,0.6-0.2C27.2,15.3,27.2,14.6,26.9,14.2z"}}]})(props);}function FcSupport(props){return GenIcon({"tag":"svg","attr":{"version":"1","viewBox":"0 0 48 48","enableBackground":"new 0 0 48 48"},"child":[{"tag":"path","attr":{"fill":"#607D8B","d":"M44.7,11L36,19.6c0,0-2.6,0-5.2-2.6s-2.6-5.2-2.6-5.2l8.7-8.7c-4.9-1.2-10.8,0.4-14.4,4 c-5.4,5.4-0.6,12.3-2,13.7C12.9,28.7,5.1,34.7,4.9,35c-2.3,2.3-2.4,6-0.2,8.2c2.2,2.2,5.9,2.1,8.2-0.2c0.3-0.3,6.7-8.4,14.2-15.9 c1.4-1.4,8,3.7,13.6-1.8C44.2,21.7,45.9,15.9,44.7,11z M9.4,41.1c-1.4,0-2.5-1.1-2.5-2.5C6.9,37.1,8,36,9.4,36 c1.4,0,2.5,1.1,2.5,2.5C11.9,39.9,10.8,41.1,9.4,41.1z"}}]})(props);}function FcSynchronize(props){return GenIcon({"tag":"svg","attr":{"version":"1","viewBox":"0 0 48 48","enableBackground":"new 0 0 48 48"},"child":[{"tag":"path","attr":{"fill":"#FF6F00","d":"M38.7,11.9l-3.1,2.5c2.2,2.7,3.4,6.1,3.4,9.5c0,8.3-6.7,15-15,15c-0.9,0-1.9-0.1-2.8-0.3l-0.7,3.9 c1.2,0.2,2.4,0.3,3.5,0.3c10.5,0,19-8.5,19-19C43,19.6,41.5,15.3,38.7,11.9z"}},{"tag":"polygon","attr":{"fill":"#FF6F02","points":"31,8 42.9,9.6 33.1,19.4"}},{"tag":"path","attr":{"fill":"#FF6F00","d":"M24,5C13.5,5,5,13.5,5,24c0,4.6,1.6,9,4.6,12.4l3-2.6C10.3,31.1,9,27.6,9,24c0-8.3,6.7-15,15-15 c0.9,0,1.9,0.1,2.8,0.3l0.7-3.9C26.4,5.1,25.2,5,24,5z"}},{"tag":"polygon","attr":{"fill":"#FF6F02","points":"17,40 5.1,38.4 14.9,28.6"}}]})(props);}function FcTodoList(props){return GenIcon({"tag":"svg","attr":{"version":"1","viewBox":"0 0 48 48","enableBackground":"new 0 0 48 48"},"child":[{"tag":"g","attr":{"fill":"#3F51B5"},"child":[{"tag":"polygon","attr":{"points":"17.8,18.1 10.4,25.4 6.2,21.3 4,23.5 10.4,29.9 20,20.3"}},{"tag":"polygon","attr":{"points":"17.8,5.1 10.4,12.4 6.2,8.3 4,10.5 10.4,16.9 20,7.3"}},{"tag":"polygon","attr":{"points":"17.8,31.1 10.4,38.4 6.2,34.3 4,36.5 10.4,42.9 20,33.3"}}]},{"tag":"g","attr":{"fill":"#90CAF9"},"child":[{"tag":"rect","attr":{"x":"24","y":"22","width":"20","height":"4"}},{"tag":"rect","attr":{"x":"24","y":"9","width":"20","height":"4"}},{"tag":"rect","attr":{"x":"24","y":"35","width":"20","height":"4"}}]}]})(props);}var Search=function Search(props){var inputRef=react.exports.useRef(null);var _useTranslation2=useTranslation(),t=_useTranslation2.t;var _react$exports$useCon6=react.exports.useContext(IContext),getSetting=_react$exports$useCon6.getSetting;var _react$exports$useSta5=react.exports.useState(""),_react$exports$useSta6=_slicedToArray2(_react$exports$useSta5,2),keyword=_react$exports$useSta6[0],setKeyword=_react$exports$useSta6[1];var search=function search(){history.push("?s=".concat(keyword));};var history=useHistory();react.exports.useEffect(function(){if(props.isSearch){var _inputRef$current;(_inputRef$current=inputRef.current)===null||_inputRef$current===void 0?void 0:_inputRef$current.focus();}var switchSearch=function switchSearch(e){if(["k","K"].includes(e.key)&&e.ctrlKey){props.setIsSearch(!props.isSearch);e.preventDefault();}};if(getSetting("enable search")==="true"){document.addEventListener("keydown",switchSearch);}var cancelSearch=function cancelSearch(e){props.setIsSearch(false);};document.addEventListener("click",cancelSearch);return function(){document.removeEventListener("keydown",switchSearch);document.removeEventListener("click",cancelSearch);};},[props.isSearch]);if(getSetting("enable search")!=="true")return null;return/* @__PURE__ */React.createElement(HStack,{spacing:2,onClick:function onClick(e){e.stopPropagation();}},/* @__PURE__ */React.createElement(Input,{display:props.isSearch?"block":"none",value:keyword,onKeyUp:function onKeyUp(e){if(e.key==="Enter"){search();}},onChange:function onChange(e){setKeyword(e.target.value);},ref:inputRef}),/* @__PURE__ */React.createElement(Tooltip,{shouldWrapChildren:true,hasArrow:true,placement:"bottom",label:t("Search files")},/* @__PURE__ */React.createElement(Icon,{boxSize:7,cursor:"pointer",onClick:function onClick(){if(!props.isSearch){props.setIsSearch(true);}else{search();}},as:FcSearch})));};var Header=function Header(){var _useTranslation3=useTranslation(),t=_useTranslation3.t;var fileUrl=useFileUrl();var toast=useToast();var _react$exports$useCon7=react.exports.useContext(IContext),show=_react$exports$useCon7.show,setShow=_react$exports$useCon7.setShow,type=_react$exports$useCon7.type,getSetting=_react$exports$useCon7.getSetting,files=_react$exports$useCon7.files,multiSelect=_react$exports$useCon7.multiSelect,selectFiles=_react$exports$useCon7.selectFiles,meta=_react$exports$useCon7.meta,loggedIn=_react$exports$useCon7.loggedIn;var logos=getSetting("logo");var logo=useColorModeValue(logos.split(",").shift(),logos.split(",").pop());var uploadRef=react.exports.useRef(null);var _react$exports$useSta7=react.exports.useState(false),_react$exports$useSta8=_slicedToArray2(_react$exports$useSta7,2),isSearch=_react$exports$useSta8[0],setIsSearch=_react$exports$useSta8[1];return/* @__PURE__ */React.createElement(Flex,{className:"header",px:"2",py:"2",justify:"space-between",w:"full"},/* @__PURE__ */React.createElement(Link,{to:"/",className:"logo"},logo.includes("http")?/* @__PURE__ */React.createElement(Image$1,{fallback:/* @__PURE__ */React.createElement(Spinner,{color:getSetting("icon color")||"#1890ff"}),rounded:"lg",h:"44px",w:"auto",src:logo}):/* @__PURE__ */React.createElement(Heading,null,logo)),/* @__PURE__ */React.createElement(HStack,{className:"buttons",spacing:"2"},["folder","search"].includes(type)&&/* @__PURE__ */React.createElement(Search,{isSearch:isSearch,setIsSearch:setIsSearch}),!isSearch&&/* @__PURE__ */React.createElement(SlideFade,{in:!isSearch,offsetX:"20px",offsetY:0},/* @__PURE__ */React.createElement(HStack,{spacing:"2"},type==="file"&&/* @__PURE__ */React.createElement(Tooltip,{shouldWrapChildren:true,hasArrow:true,placement:"bottom",label:t("Download")},/* @__PURE__ */React.createElement(Icon,{cursor:"pointer",boxSize:6,as:BsFillArrowDownCircleFill,onClick:function onClick(){if(type==="file"){var url=fileUrl();window.open(url,"_blank");return;}}})),type==="folder"&&!getSetting("no upload").split(",").includes(meta.driver)&&(meta.upload||loggedIn)&&/* @__PURE__ */React.createElement(Box,null,/* @__PURE__ */React.createElement(Tooltip,{shouldWrapChildren:true,hasArrow:true,placement:"bottom",label:t("Upload file")},/* @__PURE__ */React.createElement(Icon,{cursor:"pointer",boxSize:6,as:BsFillArrowUpCircleFill,onClick:function onClick(){uploadRef.current.upload();}})),/* @__PURE__ */React.createElement(Uploader,{ref:uploadRef})),type!=="error"&&/* @__PURE__ */React.createElement(Tooltip,{shouldWrapChildren:true,hasArrow:true,placement:"bottom",label:t("Copy direct link")},/* @__PURE__ */React.createElement(Icon,{cursor:"pointer",boxSize:6,as:IoIosCopy,onClick:function onClick(){var content="";if(type==="file"){content=fileUrl();}else{var files_=files;if(multiSelect){files_=selectFiles;}content=files_.filter(function(file){return file.type!==1;}).map(function(file){return fileUrl(file);}).join("\n");}copyToClip(content);toast({title:t("Copied"),status:"success",duration:3e3,isClosable:true});}})),/* @__PURE__ */React.createElement(Tooltip,{shouldWrapChildren:true,hasArrow:true,placement:"bottom",label:t("switch to layout view",{layout:t(show==="list"?"grid":"list")})},/* @__PURE__ */React.createElement(Icon,{boxSize:6,cursor:"pointer",onClick:function onClick(){setShow(show==="list"?"grid":"list");localStorage.setItem("show",show==="list"?"grid":"list");},as:show==="list"?BsFillGridFill:FaListUl}))))));};var Footer=function Footer(){var _useTranslation4=useTranslation(),t=_useTranslation4.t;var _react$exports$useCon8=react.exports.useContext(IContext),getSetting=_react$exports$useCon8.getSetting;return/* @__PURE__ */React.createElement(Center,{py:"4",className:"footer"},/* @__PURE__ */React.createElement(VStack,null,/* @__PURE__ */React.createElement(HStack,{spacing:"2",className:"line0"},/* @__PURE__ */React.createElement(Link$1,{isExternal:true,href:"https://github.com/Xhofe/alist"},t("Powered by {{project}}",{project:"Alist"})),/* @__PURE__ */React.createElement("span",null,"|"),/* @__PURE__ */React.createElement(Link,{to:"/@manage"},t("Manage"))),getSetting("site beian")&&/* @__PURE__ */React.createElement(Link$1,{className:"line1",isExternal:true,href:"https://beian.miit.gov.cn/"},getSetting("site beian"))));};var Nav=function Nav(){var location=useLocation();var _useTranslation5=useTranslation(),t=_useTranslation5.t;return/* @__PURE__ */React.createElement(Breadcrumb,{spacing:"1",className:"nav",w:"full",px:"2"},/* @__PURE__ */React.createElement(BreadcrumbItem,null,/* @__PURE__ */React.createElement(BreadcrumbLink,{_hover:{textDecoration:"none",bg:"rgba(132,133,141,0.18)"},p:"1",rounded:"lg",as:Link,to:"/"},getSetting("home emoji"),t("Home"))),location.pathname.slice(1).split("/").map(function(path,index){var isLast=index===location.pathname.split("/").length-2;var pathname=location.pathname.split("/").slice(0,index+2).join("/");return/* @__PURE__ */React.createElement(BreadcrumbItem,{key:pathname,isCurrentPage:isLast},/* @__PURE__ */React.createElement(BreadcrumbLink,{isCurrentPage:isLast,wordBreak:"break-word",as:isLast?void 0:Link,to:encodeURI(pathname),_hover:{textDecoration:"none",bg:"rgba(132,133,141,0.18)"},p:"1",rounded:"lg"},path));}));};var Error$1=function Error$1(_ref5){var msg=_ref5.msg;var _useTranslation6=useTranslation(),t=_useTranslation6.t;return/* @__PURE__ */React.createElement(Box,{className:"error",textAlign:"center",py:10,px:6},/* @__PURE__ */React.createElement(Heading,{display:"inline-block",size:"xl"},t("ERROR")),/* @__PURE__ */React.createElement(Text,{fontSize:"18px",my:3},t(msg)),/* @__PURE__ */React.createElement(Link,{to:"/"},/* @__PURE__ */React.createElement(Button,{variant:"solid"},t("Back Home"))));};function _defineProperty$1(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function ownKeys$1(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread2$1(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys$1(Object(source),true).forEach(function(key){_defineProperty$1(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys$1(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _objectWithoutPropertiesLoose(source,excluded){if(source==null)return{};var target={};var sourceKeys=Object.keys(source);var key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(excluded.indexOf(key)>=0)continue;target[key]=source[key];}return target;}function _objectWithoutProperties(source,excluded){if(source==null)return{};var target=_objectWithoutPropertiesLoose(source,excluded);var key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];if(excluded.indexOf(key)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(source,key))continue;target[key]=source[key];}}return target;}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest();}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr;}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"]!=null)_i["return"]();}finally{if(_d)throw _e;}}return _arr;}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread2(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function compose$1(){for(var _len=arguments.length,fns=new Array(_len),_key=0;_key<_len;_key++){fns[_key]=arguments[_key];}return function(x){return fns.reduceRight(function(y,f){return f(y);},x);};}function curry$1(fn){return function curried(){var _this=this;for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2];}return args.length>=fn.length?fn.apply(this,args):function(){for(var _len3=arguments.length,nextArgs=new Array(_len3),_key3=0;_key3<_len3;_key3++){nextArgs[_key3]=arguments[_key3];}return curried.apply(_this,[].concat(args,nextArgs));};};}function isObject$1(value){return{}.toString.call(value).includes('Object');}function isEmpty(obj){return!Object.keys(obj).length;}function isFunction(value){return typeof value==='function';}function hasOwnProperty(object,property){return Object.prototype.hasOwnProperty.call(object,property);}function validateChanges(initial,changes){if(!isObject$1(changes))errorHandler$1('changeType');if(Object.keys(changes).some(function(field){return!hasOwnProperty(initial,field);}))errorHandler$1('changeField');return changes;}function validateSelector(selector){if(!isFunction(selector))errorHandler$1('selectorType');}function validateHandler(handler){if(!(isFunction(handler)||isObject$1(handler)))errorHandler$1('handlerType');if(isObject$1(handler)&&Object.values(handler).some(function(_handler){return!isFunction(_handler);}))errorHandler$1('handlersType');}function validateInitial(initial){if(!initial)errorHandler$1('initialIsRequired');if(!isObject$1(initial))errorHandler$1('initialType');if(isEmpty(initial))errorHandler$1('initialContent');}function throwError$1(errorMessages,type){throw new Error(errorMessages[type]||errorMessages["default"]);}var errorMessages$1={initialIsRequired:'initial state is required',initialType:'initial state should be an object',initialContent:'initial state shouldn\'t be an empty object',handlerType:'handler should be an object or a function',handlersType:'all handlers should be a functions',selectorType:'selector should be a function',changeType:'provided value of changes should be an object',changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',"default":'an unknown error accured in `state-local` package'};var errorHandler$1=curry$1(throwError$1)(errorMessages$1);var validators$1={changes:validateChanges,selector:validateSelector,handler:validateHandler,initial:validateInitial};function create(initial){var handler=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};validators$1.initial(initial);validators$1.handler(handler);var state={current:initial};var didUpdate=curry$1(didStateUpdate)(state,handler);var update=curry$1(updateState)(state);var validate=curry$1(validators$1.changes)(initial);var getChanges=curry$1(extractChanges)(state);function getState(){var selector=arguments.length>0&&arguments[0]!==undefined?arguments[0]:function(state){return state;};validators$1.selector(selector);return selector(state.current);}function setState(causedChanges){compose$1(didUpdate,update,validate,getChanges)(causedChanges);}return[getState,setState];}function extractChanges(state,causedChanges){return isFunction(causedChanges)?causedChanges(state.current):causedChanges;}function updateState(state,changes){state.current=_objectSpread2(_objectSpread2({},state.current),changes);return changes;}function didStateUpdate(state,handler,changes){isFunction(handler)?handler(state.current):Object.keys(changes).forEach(function(field){var _handler$field;return(_handler$field=handler[field])===null||_handler$field===void 0?void 0:_handler$field.call(handler,state.current[field]);});return changes;}var index$3={create:create};var config$1={paths:{vs:'https://cdn.jsdelivr.net/npm/monaco-editor@0.33.0/min/vs'}};function curry(fn){return function curried(){var _this=this;for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}return args.length>=fn.length?fn.apply(this,args):function(){for(var _len2=arguments.length,nextArgs=new Array(_len2),_key2=0;_key2<_len2;_key2++){nextArgs[_key2]=arguments[_key2];}return curried.apply(_this,[].concat(args,nextArgs));};};}function isObject(value){return{}.toString.call(value).includes('Object');}/**
       * validates the configuration object and informs about deprecation
       * @param {Object} config - the configuration object 
       * @return {Object} config - the validated configuration object
       */function validateConfig(config){if(!config)errorHandler('configIsRequired');if(!isObject(config))errorHandler('configType');if(config.urls){informAboutDeprecation();return{paths:{vs:config.urls.monacoBase}};}return config;}/**
       * logs deprecation message
       */function informAboutDeprecation(){console.warn(errorMessages.deprecation);}function throwError(errorMessages,type){throw new Error(errorMessages[type]||errorMessages["default"]);}var errorMessages={configIsRequired:'the configuration object is required',configType:'the configuration object should be an object',"default":'an unknown error accured in `@monaco-editor/loader` package',deprecation:"Deprecation warning!\n    You are using deprecated way of configuration.\n\n    Instead of using\n      monaco.config({ urls: { monacoBase: '...' } })\n    use\n      monaco.config({ paths: { vs: '...' } })\n\n    For more please check the link https://github.com/suren-atoyan/monaco-loader#config\n  "};var errorHandler=curry(throwError)(errorMessages);var validators={config:validateConfig};var compose=function compose(){for(var _len=arguments.length,fns=new Array(_len),_key=0;_key<_len;_key++){fns[_key]=arguments[_key];}return function(x){return fns.reduceRight(function(y,f){return f(y);},x);};};function merge(target,source){Object.keys(source).forEach(function(key){if(source[key]instanceof Object){if(target[key]){Object.assign(source[key],merge(target[key],source[key]));}}});return _objectSpread2$1(_objectSpread2$1({},target),source);}// The source (has been changed) is https://github.com/facebook/react/issues/5465#issuecomment-157888325
var CANCELATION_MESSAGE={type:'cancelation',msg:'operation is manually canceled'};function makeCancelable(promise){var hasCanceled_=false;var wrappedPromise=new Promise(function(resolve,reject){promise.then(function(val){return hasCanceled_?reject(CANCELATION_MESSAGE):resolve(val);});promise["catch"](reject);});return wrappedPromise.cancel=function(){return hasCanceled_=true;},wrappedPromise;}/** the local state of the module */var _state$create=index$3.create({config:config$1,isInitialized:false,resolve:null,reject:null,monaco:null}),_state$create2=_slicedToArray(_state$create,2),getState=_state$create2[0],setState=_state$create2[1];/**
       * set the loader configuration
       * @param {Object} config - the configuration object
       */function config(globalConfig){var _validators$config=validators.config(globalConfig),monaco=_validators$config.monaco,config=_objectWithoutProperties(_validators$config,["monaco"]);setState(function(state){return{config:merge(state.config,config),monaco:monaco};});}/**
       * handles the initialization of the monaco-editor
       * @return {Promise} - returns an instance of monaco (with a cancelable promise)
       */function init(){var state=getState(function(_ref){var monaco=_ref.monaco,isInitialized=_ref.isInitialized;return{monaco:monaco,isInitialized:isInitialized};});if(!state.isInitialized){setState({isInitialized:true});if(state.monaco){return makeCancelable(Promise.resolve(state.monaco));}if(window.monaco&&window.monaco.editor){storeMonacoInstance(window.monaco);return makeCancelable(Promise.resolve(window.monaco));}compose(injectScripts,getMonacoLoaderScript)(configureLoader);}return makeCancelable(wrapperPromise);}/**
       * injects provided scripts into the document.body
       * @param {Object} script - an HTML script element
       * @return {Object} - the injected HTML script element
       */function injectScripts(script){return document.body.appendChild(script);}/**
       * creates an HTML script element with/without provided src
       * @param {string} [src] - the source path of the script
       * @return {Object} - the created HTML script element
       */function createScript(src){var script=document.createElement('script');return src&&(script.src=src),script;}/**
       * creates an HTML script element with the monaco loader src
       * @return {Object} - the created HTML script element
       */function getMonacoLoaderScript(configureLoader){var state=getState(function(_ref2){var config=_ref2.config,reject=_ref2.reject;return{config:config,reject:reject};});var loaderScript=createScript("".concat(state.config.paths.vs,"/loader.js"));loaderScript.onload=function(){return configureLoader();};loaderScript.onerror=state.reject;return loaderScript;}/**
       * configures the monaco loader
       */function configureLoader(){var state=getState(function(_ref3){var config=_ref3.config,resolve=_ref3.resolve,reject=_ref3.reject;return{config:config,resolve:resolve,reject:reject};});var require=window.require;require.config(state.config);require(['vs/editor/editor.main'],function(monaco){storeMonacoInstance(monaco);state.resolve(monaco);},function(error){state.reject(error);});}/**
       * store monaco instance in local state
       */function storeMonacoInstance(monaco){if(!getState().monaco){setState({monaco:monaco});}}/**
       * internal helper function
       * extracts stored monaco instance
       * @return {Object|null} - the monaco instance
       */function __getMonacoInstance(){return getState(function(_ref4){var monaco=_ref4.monaco;return monaco;});}var wrapperPromise=new Promise(function(resolve,reject){return setState({resolve:resolve,reject:reject});});var loader={config:config,init:init,__getMonacoInstance:__getMonacoInstance};function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};return _extends.apply(this,arguments);}var loadingStyles={display:'flex',height:'100%',width:'100%',justifyContent:'center',alignItems:'center'};function Loading(_ref6){var content=_ref6.content;return/*#__PURE__*/React.createElement("div",{style:loadingStyles},content);}var styles={wrapper:{display:'flex',position:'relative',textAlign:'initial'},fullWidth:{width:'100%'},hide:{display:'none'}};// one of the reasons why we use a separate prop for passing ref instead of using forwardref
function MonacoContainer$1(_ref7){var width=_ref7.width,height=_ref7.height,isEditorReady=_ref7.isEditorReady,loading=_ref7.loading,_ref=_ref7._ref,className=_ref7.className,wrapperProps=_ref7.wrapperProps;return/*#__PURE__*/React.createElement("section",_extends({style:_objectSpread(_objectSpread({},styles.wrapper),{},{width:width,height:height})},wrapperProps),!isEditorReady&&/*#__PURE__*/React.createElement(Loading,{content:loading}),/*#__PURE__*/React.createElement("div",{ref:_ref,style:_objectSpread(_objectSpread({},styles.fullWidth),!isEditorReady&&styles.hide),className:className}));}MonacoContainer$1.propTypes={width:PropTypes.oneOfType([PropTypes.number,PropTypes.string]).isRequired,height:PropTypes.oneOfType([PropTypes.number,PropTypes.string]).isRequired,loading:PropTypes.oneOfType([PropTypes.element,PropTypes.string]).isRequired,isEditorReady:PropTypes.bool.isRequired,className:PropTypes.string,wrapperProps:PropTypes.object};var MonacoContainer=/*#__PURE__*/react.exports.memo(MonacoContainer$1);function useMount(effect){react.exports.useEffect(effect,[]);}function useUpdate(effect,deps){var applyChanges=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var isInitialMount=react.exports.useRef(true);react.exports.useEffect(isInitialMount.current||!applyChanges?function(){isInitialMount.current=false;}:effect,deps);}function noop(){}function getOrCreateModel(monaco,value,language,path){return getModel(monaco,path)||createModel(monaco,value,language,path);}function getModel(monaco,path){return monaco.editor.getModel(createModelUri(monaco,path));}function createModel(monaco,value,language,path){return monaco.editor.createModel(value,language,path&&createModelUri(monaco,path));}function createModelUri(monaco,path){return monaco.Uri.parse(path);}function isUndefined(input){return input===undefined;}({original:PropTypes.string,modified:PropTypes.string,language:PropTypes.string,originalLanguage:PropTypes.string,modifiedLanguage:PropTypes.string,/* === */originalModelPath:PropTypes.string,modifiedModelPath:PropTypes.string,keepCurrentOriginalModel:PropTypes.bool,keepCurrentModifiedModel:PropTypes.bool,theme:PropTypes.string,loading:PropTypes.oneOfType([PropTypes.element,PropTypes.string]),options:PropTypes.object,/* === */width:PropTypes.oneOfType([PropTypes.number,PropTypes.string]),height:PropTypes.oneOfType([PropTypes.number,PropTypes.string]),className:PropTypes.string,wrapperProps:PropTypes.object,/* === */beforeMount:PropTypes.func,onMount:PropTypes.func});function usePrevious(value){var ref=react.exports.useRef();react.exports.useEffect(function(){ref.current=value;},[value]);return ref.current;}var viewStates=new Map();function Editor(_ref8){var defaultValue=_ref8.defaultValue,defaultLanguage=_ref8.defaultLanguage,defaultPath=_ref8.defaultPath,value=_ref8.value,language=_ref8.language,path=_ref8.path,theme=_ref8.theme,line=_ref8.line,loading=_ref8.loading,options=_ref8.options,overrideServices=_ref8.overrideServices,saveViewState=_ref8.saveViewState,keepCurrentModel=_ref8.keepCurrentModel,width=_ref8.width,height=_ref8.height,className=_ref8.className,wrapperProps=_ref8.wrapperProps,beforeMount=_ref8.beforeMount,onMount=_ref8.onMount,onChange=_ref8.onChange,onValidate=_ref8.onValidate;var _react$exports$useSta9=react.exports.useState(false),_react$exports$useSta10=_slicedToArray2(_react$exports$useSta9,2),isEditorReady=_react$exports$useSta10[0],setIsEditorReady=_react$exports$useSta10[1];var _react$exports$useSta11=react.exports.useState(true),_react$exports$useSta12=_slicedToArray2(_react$exports$useSta11,2),isMonacoMounting=_react$exports$useSta12[0],setIsMonacoMounting=_react$exports$useSta12[1];var monacoRef=react.exports.useRef(null);var editorRef=react.exports.useRef(null);var containerRef=react.exports.useRef(null);var onMountRef=react.exports.useRef(onMount);var beforeMountRef=react.exports.useRef(beforeMount);var subscriptionRef=react.exports.useRef(null);var valueRef=react.exports.useRef(value);var previousPath=usePrevious(path);useMount(function(){var cancelable=loader.init();cancelable.then(function(monaco){return(monacoRef.current=monaco)&&setIsMonacoMounting(false);}).catch(function(error){return(error===null||error===void 0?void 0:error.type)!=='cancelation'&&console.error('Monaco initialization: error:',error);});return function(){return editorRef.current?disposeEditor():cancelable.cancel();};});useUpdate(function(){var model=getOrCreateModel(monacoRef.current,defaultValue||value,defaultLanguage||language,path);if(model!==editorRef.current.getModel()){saveViewState&&viewStates.set(previousPath,editorRef.current.saveViewState());editorRef.current.setModel(model);saveViewState&&editorRef.current.restoreViewState(viewStates.get(path));}},[path],isEditorReady);useUpdate(function(){editorRef.current.updateOptions(options);},[options],isEditorReady);useUpdate(function(){if(editorRef.current.getOption(monacoRef.current.editor.EditorOption.readOnly)){editorRef.current.setValue(value);}else{if(value!==editorRef.current.getValue()){editorRef.current.executeEdits('',[{range:editorRef.current.getModel().getFullModelRange(),text:value,forceMoveMarkers:true}]);editorRef.current.pushUndoStop();}}},[value],isEditorReady);useUpdate(function(){monacoRef.current.editor.setModelLanguage(editorRef.current.getModel(),language);},[language],isEditorReady);useUpdate(function(){// reason for undefined check: https://github.com/suren-atoyan/monaco-react/pull/188
if(!isUndefined(line)){editorRef.current.revealLine(line);}},[line],isEditorReady);useUpdate(function(){monacoRef.current.editor.setTheme(theme);},[theme],isEditorReady);var createEditor=react.exports.useCallback(function(){beforeMountRef.current(monacoRef.current);var autoCreatedModelPath=path||defaultPath;var defaultModel=getOrCreateModel(monacoRef.current,value||defaultValue,defaultLanguage||language,autoCreatedModelPath);editorRef.current=monacoRef.current.editor.create(containerRef.current,_objectSpread({model:defaultModel,automaticLayout:true},options),overrideServices);saveViewState&&editorRef.current.restoreViewState(viewStates.get(autoCreatedModelPath));monacoRef.current.editor.setTheme(theme);setIsEditorReady(true);},[defaultValue,defaultLanguage,defaultPath,value,language,path,options,overrideServices,saveViewState,theme]);react.exports.useEffect(function(){if(isEditorReady){onMountRef.current(editorRef.current,monacoRef.current);}},[isEditorReady]);react.exports.useEffect(function(){!isMonacoMounting&&!isEditorReady&&createEditor();},[isMonacoMounting,isEditorReady,createEditor]);// subscription
// to avoid unnecessary updates (attach - dispose listener) in subscription
valueRef.current=value;react.exports.useEffect(function(){if(isEditorReady&&onChange){var _subscriptionRef$curr,_editorRef$current;(_subscriptionRef$curr=subscriptionRef.current)===null||_subscriptionRef$curr===void 0?void 0:_subscriptionRef$curr.dispose();subscriptionRef.current=(_editorRef$current=editorRef.current)===null||_editorRef$current===void 0?void 0:_editorRef$current.onDidChangeModelContent(function(event){var editorValue=editorRef.current.getValue();if(valueRef.current!==editorValue){onChange(editorValue,event);}});}},[isEditorReady,onChange]);// onValidate
react.exports.useEffect(function(){if(isEditorReady){var changeMarkersListener=monacoRef.current.editor.onDidChangeMarkers(function(uris){var _editorRef$current$ge;var editorUri=(_editorRef$current$ge=editorRef.current.getModel())===null||_editorRef$current$ge===void 0?void 0:_editorRef$current$ge.uri;if(editorUri){var currentEditorHasMarkerChanges=uris.find(function(uri){return uri.path===editorUri.path;});if(currentEditorHasMarkerChanges){var markers=monacoRef.current.editor.getModelMarkers({resource:editorUri});onValidate===null||onValidate===void 0?void 0:onValidate(markers);}}});return function(){changeMarkersListener===null||changeMarkersListener===void 0?void 0:changeMarkersListener.dispose();};}},[isEditorReady,onValidate]);function disposeEditor(){var _subscriptionRef$curr2;(_subscriptionRef$curr2=subscriptionRef.current)===null||_subscriptionRef$curr2===void 0?void 0:_subscriptionRef$curr2.dispose();if(keepCurrentModel){saveViewState&&viewStates.set(path,editorRef.current.saveViewState());}else{var _editorRef$current$ge2;(_editorRef$current$ge2=editorRef.current.getModel())===null||_editorRef$current$ge2===void 0?void 0:_editorRef$current$ge2.dispose();}editorRef.current.dispose();}return/*#__PURE__*/React.createElement(MonacoContainer,{width:width,height:height,isEditorReady:isEditorReady,loading:loading,_ref:containerRef,className:className,wrapperProps:wrapperProps});}Editor.propTypes={defaultValue:PropTypes.string,defaultPath:PropTypes.string,defaultLanguage:PropTypes.string,value:PropTypes.string,language:PropTypes.string,path:PropTypes.string,/* === */theme:PropTypes.string,line:PropTypes.number,loading:PropTypes.oneOfType([PropTypes.element,PropTypes.string]),options:PropTypes.object,overrideServices:PropTypes.object,saveViewState:PropTypes.bool,keepCurrentModel:PropTypes.bool,/* === */width:PropTypes.oneOfType([PropTypes.number,PropTypes.string]),height:PropTypes.oneOfType([PropTypes.number,PropTypes.string]),className:PropTypes.string,wrapperProps:PropTypes.object,/* === */beforeMount:PropTypes.func,onMount:PropTypes.func,onChange:PropTypes.func,onValidate:PropTypes.func};Editor.defaultProps={theme:'light',loading:'Loading...',options:{},overrideServices:{},saveViewState:true,keepCurrentModel:false,/* === */width:'100%',height:'100%',wrapperProps:{},/* === */beforeMount:noop,onMount:noop,onValidate:noop};var index$2=/*#__PURE__*/react.exports.memo(Editor);var type$1=-1;var exts$1=[];var CodeEditor=function CodeEditor(_ref9){var file=_ref9.file;var theme=useColorModeValue("light","dark");var _useTranslation7=useTranslation(),t=_useTranslation7.t;var toast=useToast();var _useLocation4=useLocation(),pathname=_useLocation4.pathname;var _React$useState=React.useState(""),_React$useState2=_slicedToArray2(_React$useState,2),content=_React$useState2[0],setContent=_React$useState2[1];var link=useFileUrl(true)(file);var getContent=function getContent(){axios.get(link).then(/*#__PURE__*/function(){var _ref10=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee(resp){return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setContent(resp.data);case 1:case"end":return _context.stop();}}},_callee);}));return function(_x){return _ref10.apply(this,arguments);};}());};var handleSaveButton=/*#__PURE__*/function(){var _ref11=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee2(){var folder,form;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:folder=pathname.substring(0,pathname.lastIndexOf("/")||1);form=new FormData();form.append("files",new Blob([content]),file.name);form.append("path",folder);instance.post("upload",form,{headers:{"Content-Type":"multipart/form-data"}}).then(function(resp){var res=resp.data;toast({title:t(res.message),status:res.code===200?"success":"error",duration:3e3,isClosable:true});});case 5:case"end":return _context2.stop();}}},_callee2);}));return function handleSaveButton(){return _ref11.apply(this,arguments);};}();React.useEffect(function(){getContent();},[]);return/* @__PURE__ */React.createElement(Box,null,/* @__PURE__ */React.createElement(index$2,{height:"70vh",value:content,path:file.name,theme:theme==="light"?"light":"vs-dark",onChange:function onChange(value){return setContent(value);}}),/* @__PURE__ */React.createElement(Flex,{m:"2"},/* @__PURE__ */React.createElement(Spacer,null),/* @__PURE__ */React.createElement(Button,{mt:"5",onClick:handleSaveButton},t("Save"))));};var __glob_7_1=/*#__PURE__*/Object.freeze((_Object$freeze={__proto__:null},_defineProperty2(_Object$freeze,Symbol.toStringTag,'Module'),_defineProperty2(_Object$freeze,"type",type$1),_defineProperty2(_Object$freeze,"exts",exts$1),_defineProperty2(_Object$freeze,'default',CodeEditor),_Object$freeze));exports('_',__glob_7_1);var type=5;var exts=[];var MarkdownPreview=function MarkdownPreview(_ref12){var file=_ref12.file,readme=_ref12.readme;var _React$useState3=React.useState(""),_React$useState4=_slicedToArray2(_React$useState3,2),content=_React$useState4[0],setContent=_React$useState4[1];var _React$useState5=React.useState(""),_React$useState6=_slicedToArray2(_React$useState5,2),srcDoc=_React$useState6[0],setSrcDoc=_React$useState6[1];var _react$exports$useCon9=react.exports.useContext(IContext),getSetting=_react$exports$useCon9.getSetting,loggedIn=_react$exports$useCon9.loggedIn;var link=useFileUrl(true)(file);var html=file.name.endsWith(".html");var _React$useState7=React.useState("preview"),_React$useState8=_slicedToArray2(_React$useState7,2),show=_React$useState8[0],setShow=_React$useState8[1];var refresh=function refresh(){if(readme){if(file.type===-1){link=file.url;}}axios.get(link,{responseType:"blob"}).then(/*#__PURE__*/function(){var _ref13=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee3(resp){var blob,res,decoder;return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:blob=resp.data;_context3.next=3;return blob.text();case 3:res=_context3.sent;if(!res.includes("\uFFFD")){_context3.next=11;break;}decoder=new TextDecoder("gbk");_context3.t0=decoder;_context3.next=9;return blob.arrayBuffer();case 9:_context3.t1=_context3.sent;res=_context3.t0.decode.call(_context3.t0,_context3.t1);case 11:if(html){setSrcDoc(res);}if(file.name.endsWith(".md")){setContent(res);}else{setContent("```"+file.name.split(".").pop()+"\n"+res+"\n```");}case 13:case"end":return _context3.stop();}}},_callee3);}));return function(_x2){return _ref13.apply(this,arguments);};}());};react.exports.useEffect(function(){refresh();return function(){setContent("");};},[]);if(content){return/* @__PURE__ */React.createElement(Box,{w:"full"},/* @__PURE__ */React.createElement(HStack,null,html&&/* @__PURE__ */React.createElement(FormControl,{display:"flex",alignItems:"center",width:"auto",m:"1"},/* @__PURE__ */React.createElement(FormLabel,{htmlFor:"render",mb:"0"},"Render?"),/* @__PURE__ */React.createElement(Switch,{id:"render",isChecked:show==="render",onChange:function onChange(){setShow(show==="render"?"preview":"render");}})),!readme&&loggedIn&&/* @__PURE__ */React.createElement(FormControl,{display:"flex",alignItems:"center",width:"auto",m:"1"},/* @__PURE__ */React.createElement(FormLabel,{htmlFor:"render",mb:"0"},"Edit?"),/* @__PURE__ */React.createElement(Switch,{id:"edit",isChecked:show==="edit",onChange:function onChange(){setShow(show==="edit"?"preview":"edit");}}))),show==="render"?/* @__PURE__ */React.createElement("iframe",{srcDoc:srcDoc,style:{width:"100%",borderRadius:"0.75rem",boxShadow:"#00000031 0px 1px 10px 5px",minHeight:"70vh"}}):show==="edit"?/* @__PURE__ */React.createElement(CodeEditor,{file:file}):/* @__PURE__ */React.createElement(Box,{className:"markdown-body"},/* @__PURE__ */React.createElement(Markdown,null,content)));}else{return/* @__PURE__ */React.createElement(Center,{w:"full"},/* @__PURE__ */React.createElement(Spinner,{color:getSetting("icon color"),size:"xl"}));}};var __glob_7_5=/*#__PURE__*/Object.freeze((_Object$freeze2={__proto__:null},_defineProperty2(_Object$freeze2,Symbol.toStringTag,'Module'),_defineProperty2(_Object$freeze2,"type",type),_defineProperty2(_Object$freeze2,"exts",exts),_defineProperty2(_Object$freeze2,'default',MarkdownPreview),_Object$freeze2));exports('s',__glob_7_5);var iconMap={"dmg,ipa,plist":BsApple,"exe,msi":BsWindows,"zip,gz,rar,7z,tar,jar,xz":BsFillFileEarmarkZipFill,apk:DiAndroid,db:FaDatabase,md:BsFillMarkdownFill,epub:FaBook,iso:FaCompactDisc,m3u8:BsFillFileEarmarkPlayFill};var getIcon=exports('q',function(type,ext){if(type!==1){for(var _i2=0,_Object$entries=Object.entries(iconMap);_i2<_Object$entries.length;_i2++){var _Object$entries$_i=_slicedToArray2(_Object$entries[_i2],2),extensions=_Object$entries$_i[0],icon=_Object$entries$_i[1];if(extensions.split(",").includes(ext.toLowerCase())){return icon;}}}switch(type){case 1:return IoIosFolder;case 2:{if(ext==="doc"||ext==="docx"){return BsFileEarmarkWordFill;}if(ext==="xls"||ext==="xlsx"){return BsFillFileEarmarkExcelFill;}if(ext==="ppt"||ext==="pptx"){return BsFillFileEarmarkPptFill;}else{return BsFillFileEarmarkPdfFill;}}case 3:return BsFillFileEarmarkPlayFill;case 4:return BsFillFileEarmarkMusicFill;case 5:return BsFillFileEarmarkFontFill;case 6:return BsFillFileEarmarkImageFill;default:return BsFillFileEarmarkMinusFill;}});var Result=function Result(file){var _react$exports$useCon10=react.exports.useContext(IContext),getSetting=_react$exports$useCon10.getSetting;return/* @__PURE__ */React.createElement(Box,{w:"full"},/* @__PURE__ */React.createElement(Tooltip,{placement:"bottom-start",label:pathJoin(file.path,file.name)},/* @__PURE__ */React.createElement(LinkBox,{className:"result",p:"2",w:"full",rounded:"lg",transition:"all 0.3s",_hover:{transform:"scale(1.01)",bgColor:"rgba(132,133,141,0.18)"}},/* @__PURE__ */React.createElement(LinkOverlay,{as:Link,to:encodeURI(pathJoin(file.path,file.name))},/* @__PURE__ */React.createElement(HStack,{spacing:2},/* @__PURE__ */React.createElement(Flex,{className:"result-name",align:"center",w:{base:3/4,md:"50%"}},/* @__PURE__ */React.createElement(Icon,{color:getSetting("icon color"),boxSize:6,as:getIcon(file.type,file.name.split(".").pop()||""),mr:2}),/* @__PURE__ */React.createElement(Text,{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",fontSize:"md"},file.name)),/* @__PURE__ */React.createElement(Text,{className:"result-size",w:{base:1/4,md:1/6},textAlign:"right"},getFileSize(file.size)),/* @__PURE__ */React.createElement(Text,{className:"result-path",w:{base:0,md:1/3},display:{base:"none",md:"unset"},textAlign:"right"},file.path))))));};var Results=function Results(){var location=useLocation();var _react$exports$useSta13=react.exports.useState(true),_react$exports$useSta14=_slicedToArray2(_react$exports$useSta13,2),loading=_react$exports$useSta14[0],setLoading=_react$exports$useSta14[1];var _react$exports$useCon11=react.exports.useContext(IContext),getSetting=_react$exports$useCon11.getSetting;var toast=useToast();var _react$exports$useSta15=react.exports.useState([]),_react$exports$useSta16=_slicedToArray2(_react$exports$useSta15,2),results=_react$exports$useSta16[0],setResults=_react$exports$useSta16[1];var search=function search(){var searchParams=new URLSearchParams(location.search);var path=location.pathname;var keyword=searchParams.get("s");if(!keyword)return;setLoading(true);instance.post("search",{path:path,keyword:keyword}).then(function(resp){setLoading(false);var res=resp.data;if(res.code===200){setResults(res.data);}else{toast({title:res.message,status:"error",duration:3e3,isClosable:true});}});};react.exports.useEffect(function(){search();},[location.search]);var _useTranslation8=useTranslation(),t=_useTranslation8.t;if(loading){return/* @__PURE__ */React.createElement(Center,{w:"full",py:"4"},/* @__PURE__ */React.createElement(Spinner,{color:getSetting("icon color")||"#1890ff",size:"xl"}));}return/* @__PURE__ */React.createElement(VStack,{className:"results-box",w:"full"},/* @__PURE__ */React.createElement(HStack,{className:"results-title",w:"full",p:"2"},[{name:"name",base:2/3,md:"50%",textAlign:"left"},{name:"size",base:1/3,md:1/6,textAlign:"right"},{name:"path",base:0,md:1/3,textAlign:"right"}].map(function(item){return/* @__PURE__ */React.createElement(Flex,{w:{base:item.base,md:item.md},key:item.name,align:"center"},/* @__PURE__ */React.createElement(Text,{w:"full",className:"results-title-".concat(item.name),fontSize:"sm",fontWeight:"bold",color:"gray.500",textAlign:item.textAlign,cursor:"pointer",display:item.name==="path"?{base:"none",md:"unset"}:"unset"},t(item.name)));})),results.map(function(result){return/* @__PURE__ */React.createElement(Result,_objectSpread({key:result.name},result));}));};var Files=react.exports.lazy(function(){return __vitePreload(function(){return module.import((window.__dynamicImportHandler__||function(importer){return importer;})('./index-legacy.1faaffdc.js'));},false?"__VITE_PRELOAD__":void 0);});var File=react.exports.lazy(function(){return __vitePreload(function(){return module.import((window.__dynamicImportHandler__||function(importer){return importer;})('./file-legacy.94046e16.js'));},false?"__VITE_PRELOAD__":void 0);});var KuttyHero=function KuttyHero(){var bgColor=useColorModeValue("white","gray.700");useTranslation();var _react$exports$useCon12=react.exports.useContext(IContext),getSetting=_react$exports$useCon12.getSetting,setPassword=_react$exports$useCon12.setPassword,password=_react$exports$useCon12.password,settingLoaded=_react$exports$useCon12.settingLoaded,type=_react$exports$useCon12.type,msg=_react$exports$useCon12.msg,files=_react$exports$useCon12.files,meta=_react$exports$useCon12.meta;var readme=react.exports.useMemo(function(){if(type==="file"){return void 0;}var readmeFile={name:"README.md",size:0,type:-1,driver:"local",updated_at:"",thumbnail:"",url:meta.readme};if(meta.readme){return readmeFile;}var file=files.find(function(file2){return file2.name.toLowerCase()==="readme.md";});if(file){return file;}if(getSetting("global readme url")){readmeFile.url=getSetting("global readme url");return readmeFile;}return void 0;},[files,type,settingLoaded]);return/* @__PURE__ */React.createElement(Center,{className:"index-box",w:"full"},/* @__PURE__ */React.createElement(Overlay,{list:true}),/* @__PURE__ */React.createElement(VStack,{className:"root-box",w:{base:"95%",lg:"980px"}},/* @__PURE__ */React.createElement(Header,null),/* @__PURE__ */React.createElement(Nav,null),/* @__PURE__ */React.createElement(Box,{className:"main-box",rounded:"xl",shadow:"lg",bgColor:bgColor,w:"full"},type==="loading"?/* @__PURE__ */React.createElement(Center,{w:"full",py:"4"},/* @__PURE__ */React.createElement(Spinner,{color:getSetting("icon color")||"#1890ff",size:"xl"})):/* @__PURE__ */React.createElement(Box,{className:"content-box",w:"full",p:"2"},/* @__PURE__ */React.createElement(react.exports.Suspense,{fallback:/* @__PURE__ */React.createElement(Center,{h:"full"},/* @__PURE__ */React.createElement(Spinner,{color:getSetting("icon color")||"#1890ff",size:"xl"}))},type==="folder"||type==="nexting"?/* @__PURE__ */React.createElement(Files,null):type==="file"?/* @__PURE__ */React.createElement(File,null):type==="search"?/* @__PURE__ */React.createElement(Results,null):/* @__PURE__ */React.createElement(Error$1,{msg:msg})))),type==="folder"&&readme&&/* @__PURE__ */React.createElement(Box,{className:"readme-box",rounded:"xl",shadow:"lg",bgColor:bgColor,w:"full",p:"4"},/* @__PURE__ */React.createElement(MarkdownPreview,{file:readme,readme:true})),/* @__PURE__ */React.createElement(Footer,null)));};var index$1='';var useChangeEffect=function useChangeEffect(callback,deps){var didMountRef=react.exports.useRef(false);react.exports.useEffect(function(){if(didMountRef.current){callback();}else{didMountRef.current=true;}},deps);};var useSyncCallback=function useSyncCallback(callback){var _react$exports$useSta17=react.exports.useState({current:false}),_react$exports$useSta18=_slicedToArray2(_react$exports$useSta17,2),proxyState=_react$exports$useSta18[0],setProxyState=_react$exports$useSta18[1];var Func=react.exports.useCallback(function(){setProxyState({current:true});},[proxyState]);react.exports.useEffect(function(){if(proxyState.current===true)setProxyState({current:false});},[proxyState]);react.exports.useEffect(function(){proxyState.current&&callback();});return Func;};var notTurnPage=false;var inputPass=false;var Do=function Do(props){var _react$exports$useCon13=react.exports.useContext(IContext),type=_react$exports$useCon13.type,setType=_react$exports$useCon13.setType,setSelectFiles=_react$exports$useCon13.setSelectFiles,setFiles=_react$exports$useCon13.setFiles,setLastFiles=_react$exports$useCon13.setLastFiles,files=_react$exports$useCon13.files,setMsg=_react$exports$useCon13.setMsg,sort=_react$exports$useCon13.sort,password=_react$exports$useCon13.password,setPassword=_react$exports$useCon13.setPassword,setMeta=_react$exports$useCon13.setMeta,getSetting=_react$exports$useCon13.getSetting,setPage=_react$exports$useCon13.setPage,page=_react$exports$useCon13.page,settingLoaded=_react$exports$useCon13.settingLoaded;var _useTranslation9=useTranslation(),t=_useTranslation9.t;var history=useHistory();var location=useLocation();var toast=useToast();var _useApi=useApi(),path=_useApi.path,cancelPath=_useApi.cancelPath;var refresh=useSyncCallback(function(){if(!settingLoaded){return;}if(switchToSearch()){return;}cancelPath();console.log("refresh");console.log(page);var loadType=getSetting("load type");if(type==="folder"){setLastFiles(files);}if(page.page_num===1||loadType==="all"||loadType==="pagination"){setType("loading");setSelectFiles([]);setFiles([]);}else{setType("nexting");}path().then(function(resp){var res=resp.data;setMsg(res.message);if(res.code===200){if(res.data.type==="file"){setFiles(res.data.files);}else{if(page.page_num===1||loadType==="all"||loadType==="pagination"){setFiles(sortFiles(res.data.files));}else{setFiles([].concat(_toConsumableArray(files),_toConsumableArray(res.data.files)));}}setMeta(res.data.meta);setType(res.data.type);}else{if(res.code===401&&inputPass){toast({title:t(res.message),status:"error",duration:3e3,isClosable:true});inputPass=false;}if(res.code===1001){toast({title:t(res.message),status:"warning",duration:3e3,isClosable:true});history.push("/@manage");}if(res.code===401){setType("unauthorized");}else{setType("error");}}});});var sortFiles=function sortFiles(files2){var orderBy=sort.orderBy,reverse=sort.reverse;if(!orderBy)return files2;return files2.sort(function(a,b){if(a[orderBy]<b[orderBy])return reverse?1:-1;if(a[orderBy]>b[orderBy])return reverse?-1:1;return 0;});};var nextPage=function nextPage(){if(notTurnPage){notTurnPage=false;return;}refresh();};var allRefresh=function allRefresh(){if(page.page_num!==1){notTurnPage=true;setPage({page_num:1,page_size:page.page_size});}refresh();};react.exports.useEffect(function(){var files_=sortFiles(files);setFiles(_toConsumableArray(files_));},[sort]);react.exports.useEffect(function(){allRefresh();bus.on("refresh",allRefresh);return function(){bus.off("refresh",allRefresh);};},[location.pathname]);useChangeEffect(function(){nextPage();},[page]);var switchToSearch=function switchToSearch(){var query=new URLSearchParams(location.search);var search=query.get("s");if(search){setType("search");return true;}return false;};react.exports.useEffect(function(){if(!switchToSearch()){allRefresh();}},[location.search]);var _useDisclosure2=useDisclosure(),isOpen=_useDisclosure2.isOpen,_onClose=_useDisclosure2.onClose,onOpen=_useDisclosure2.onOpen;var initialRef=React.useRef();react.exports.useEffect(function(){if(type==="unauthorized"){onOpen();}},[type]);return/* @__PURE__ */React.createElement(React.Fragment,null,/* @__PURE__ */React.createElement(React.Fragment,_objectSpread({},props)),/* @__PURE__ */React.createElement(Modal,{initialFocusRef:initialRef,isOpen:isOpen,onClose:function onClose(){_onClose();}},/* @__PURE__ */React.createElement(ModalOverlay,null),/* @__PURE__ */React.createElement(ModalContent,null,/* @__PURE__ */React.createElement(ModalHeader,null,t("Input password")),/* @__PURE__ */React.createElement(ModalCloseButton,null),/* @__PURE__ */React.createElement(ModalBody,{pb:6},/* @__PURE__ */React.createElement(Input,{type:"password",ref:initialRef,value:password,onChange:function onChange(e){setPassword(e.target.value);},onKeyUp:function onKeyUp(e){if(e.key==="Enter"){localStorage.setItem("password",password);inputPass=true;refresh();_onClose();}}})),/* @__PURE__ */React.createElement(ModalFooter,null,/* @__PURE__ */React.createElement(Button,{onClick:function onClick(){localStorage.setItem("password",password);inputPass=true;refresh();_onClose();},mr:3},t("Ok")),/* @__PURE__ */React.createElement(Button,{colorScheme:"gray",onClick:function onClick(){history.goBack();_onClose();}},t("Cancel"))))));};var Index=function Index(){return/* @__PURE__ */React.createElement(IContextProvider,null,/* @__PURE__ */React.createElement(Do,null,/* @__PURE__ */React.createElement(KuttyHero,null)));};var index=/*#__PURE__*/Object.freeze((_Object$freeze3={__proto__:null},_defineProperty2(_Object$freeze3,Symbol.toStringTag,'Module'),_defineProperty2(_Object$freeze3,'default',Index),_Object$freeze3));exports('t',index);}};});})();
