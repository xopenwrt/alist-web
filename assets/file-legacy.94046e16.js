;(function(){function _get3(){if(typeof Reflect!=="undefined"&&Reflect.get){_get3=Reflect.get;}else{_get3=function _get(target,property,receiver){var base=_superPropBase2(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(arguments.length<3?target:receiver);}return desc.value;};}return _get3.apply(this,arguments);}function _superPropBase2(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf3(object);if(object===null)break;}return object;}function _inherits3(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function");}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});Object.defineProperty(subClass,"prototype",{writable:false});if(superClass)_setPrototypeOf2(subClass,superClass);}function _setPrototypeOf2(o,p){_setPrototypeOf2=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf2(o,p);}function _createSuper3(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct2();return function _createSuperInternal(){var Super=_getPrototypeOf3(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf3(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn2(this,result);};}function _possibleConstructorReturn2(self,call){if(call&&(_typeof3(call)==="object"||typeof call==="function")){return call;}else if(call!==void 0){throw new TypeError("Derived constructors may only return object or undefined");}return _assertThisInitialized2(self);}function _assertThisInitialized2(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function _isNativeReflectConstruct2(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}function _getPrototypeOf3(o){_getPrototypeOf3=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf3(o);}function _classCallCheck3(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass3(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:false});return Constructor;}function _slicedToArray2(arr,i){return _arrayWithHoles2(arr)||_iterableToArrayLimit2(arr,i)||_unsupportedIterableToArray2(arr,i)||_nonIterableRest2();}function _nonIterableRest2(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _unsupportedIterableToArray2(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray2(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray2(o,minLen);}function _arrayLikeToArray2(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function _iterableToArrayLimit2(arr,i){var _i=arr==null?null:typeof Symbol!=="undefined"&&arr[Symbol.iterator]||arr["@@iterator"];if(_i==null)return;var _arr=[];var _n=true;var _d=false;var _s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"]!=null)_i["return"]();}finally{if(_d)throw _e;}}return _arr;}function _arrayWithHoles2(arr){if(Array.isArray(arr))return arr;}function _defineProperty3(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _typeof3(obj){"@babel/helpers - typeof";return _typeof3="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj;}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;},_typeof3(obj);}var __vite_style__=document.createElement('style');__vite_style__.innerHTML=".rc-slider{border-radius:6px;height:14px;padding:5px 0;position:relative;touch-action:none;width:100%}.rc-slider,.rc-slider *{-webkit-tap-highlight-color:rgba(0,0,0,0);box-sizing:border-box}.rc-slider-rail{background-color:#e9e9e9;width:100%}.rc-slider-rail,.rc-slider-track{border-radius:6px;height:4px;position:absolute}.rc-slider-track{background-color:#abe2fb;left:0}.rc-slider-handle{background-color:#fff;border:2px solid #96dbfa;border-radius:50%;cursor:pointer;cursor:-webkit-grab;cursor:grab;height:14px;margin-top:-5px;position:absolute;touch-action:pan-x;width:14px}.rc-slider-handle-dragging.rc-slider-handle-dragging.rc-slider-handle-dragging{border-color:#57c5f7;box-shadow:0 0 0 5px #96dbfa}.rc-slider-handle:focus{outline:none}.rc-slider-handle-click-focused:focus{border-color:#96dbfa;box-shadow:unset}.rc-slider-handle:hover{border-color:#57c5f7}.rc-slider-handle:active{border-color:#57c5f7;box-shadow:0 0 5px #57c5f7;cursor:-webkit-grabbing;cursor:grabbing}.rc-slider-mark{font-size:12px;left:0;position:absolute;top:18px;width:100%}.rc-slider-mark-text{color:#999;cursor:pointer;display:inline-block;position:absolute;text-align:center;vertical-align:middle}.rc-slider-mark-text-active{color:#666}.rc-slider-step{background:transparent;height:4px;position:absolute;width:100%}.rc-slider-dot{background-color:#fff;border:2px solid #e9e9e9;border-radius:50%;bottom:-2px;cursor:pointer;height:8px;margin-left:-4px;position:absolute;vertical-align:middle;width:8px}.rc-slider-dot-active{border-color:#96dbfa}.rc-slider-dot-reverse{margin-right:-4px}.rc-slider-disabled{background-color:#e9e9e9}.rc-slider-disabled .rc-slider-track{background-color:#ccc}.rc-slider-disabled .rc-slider-dot,.rc-slider-disabled .rc-slider-handle{background-color:#fff;border-color:#ccc;box-shadow:none;cursor:not-allowed}.rc-slider-disabled .rc-slider-dot,.rc-slider-disabled .rc-slider-mark-text{cursor:not-allowed!important}.rc-slider-vertical{height:100%;padding:0 5px;width:14px}.rc-slider-vertical .rc-slider-rail{height:100%;width:4px}.rc-slider-vertical .rc-slider-track{bottom:0;left:5px;width:4px}.rc-slider-vertical .rc-slider-handle{margin-left:-5px;touch-action:pan-y}.rc-slider-vertical .rc-slider-mark{height:100%;left:18px;top:0}.rc-slider-vertical .rc-slider-step{height:100%;width:4px}.rc-slider-vertical .rc-slider-dot{left:2px;margin-bottom:-4px}.rc-slider-vertical .rc-slider-dot:first-child{margin-bottom:-4px}.rc-slider-vertical .rc-slider-dot:last-child{margin-bottom:-4px}.rc-slider-tooltip-zoom-down-appear,.rc-slider-tooltip-zoom-down-enter,.rc-slider-tooltip-zoom-down-leave{animation-duration:.3s;animation-fill-mode:both;animation-play-state:paused;display:block!important}.rc-slider-tooltip-zoom-down-appear.rc-slider-tooltip-zoom-down-appear-active,.rc-slider-tooltip-zoom-down-enter.rc-slider-tooltip-zoom-down-enter-active{animation-name:rcSliderTooltipZoomDownIn;animation-play-state:running}.rc-slider-tooltip-zoom-down-leave.rc-slider-tooltip-zoom-down-leave-active{animation-name:rcSliderTooltipZoomDownOut;animation-play-state:running}.rc-slider-tooltip-zoom-down-appear,.rc-slider-tooltip-zoom-down-enter{animation-timing-function:cubic-bezier(.23,1,.32,1);transform:scale(0)}.rc-slider-tooltip-zoom-down-leave{animation-timing-function:cubic-bezier(.755,.05,.855,.06)}@keyframes rcSliderTooltipZoomDownIn{0%{opacity:0;transform:scale(0);transform-origin:50% 100%}to{transform:scale(1);transform-origin:50% 100%}}@keyframes rcSliderTooltipZoomDownOut{0%{transform:scale(1);transform-origin:50% 100%}to{opacity:0;transform:scale(0);transform-origin:50% 100%}}.rc-slider-tooltip{left:-9999px;position:absolute;top:-9999px;visibility:visible}.rc-slider-tooltip,.rc-slider-tooltip *{-webkit-tap-highlight-color:rgba(0,0,0,0);box-sizing:border-box}.rc-slider-tooltip-hidden{display:none}.rc-slider-tooltip-placement-top{padding:4px 0 8px}.rc-slider-tooltip-inner{background-color:#6c6c6c;border-radius:6px;box-shadow:0 0 4px #d9d9d9;color:#fff;font-size:12px;height:24px;line-height:1;min-width:24px;padding:6px 2px;text-align:center;text-decoration:none}.rc-slider-tooltip-arrow{border-color:transparent;border-style:solid;height:0;position:absolute;width:0}.rc-slider-tooltip-placement-top .rc-slider-tooltip-arrow{border-top-color:#6c6c6c;border-width:4px 4px 0;bottom:4px;left:50%;margin-left:-4px}.rc-switch{background-color:#ccc;border:1px solid #ccc;border-radius:20px;box-sizing:border-box;cursor:pointer;display:inline-block;height:22px;line-height:20px;padding:0;position:relative;transition:all .3s cubic-bezier(.35,0,.25,1);vertical-align:middle;width:44px}.rc-switch-inner{color:#fff;font-size:12px;left:24px;position:absolute;top:0}.rc-switch:after{animation-duration:.3s;animation-name:rcSwitchOff;animation-timing-function:cubic-bezier(.35,0,.25,1);background-color:#fff;border-radius:50%;box-shadow:0 2px 5px rgba(0,0,0,.26);content:\" \";cursor:pointer;height:18px;left:2px;position:absolute;top:1px;transform:scale(1);transition:left .3s cubic-bezier(.35,0,.25,1);width:18px}.rc-switch:hover:after{animation-name:rcSwitchOn;transform:scale(1.1)}.rc-switch:focus{box-shadow:0 0 0 2px #d5f1fd;outline:none}.rc-switch-checked{background-color:#87d068;border:1px solid #87d068}.rc-switch-checked .rc-switch-inner{left:6px}.rc-switch-checked:after{left:22px}.rc-switch-disabled{background:#ccc;border-color:#ccc;cursor:no-drop}.rc-switch-disabled:after{animation-name:none;background:#9e9e9e;cursor:no-drop}.rc-switch-disabled:hover:after{animation-name:none;transform:scale(1)}.rc-switch-label{display:inline-block;font-size:14px;line-height:20px;padding-left:10px;pointer-events:none;user-select:text;vertical-align:middle;white-space:normal}@keyframes rcSwitchOn{0%{transform:scale(1)}50%{transform:scale(1.25)}to{transform:scale(1.1)}}@keyframes rcSwitchOff{0%{transform:scale(1.1)}to{transform:scale(1)}}.react-jinke-music-player-main:focus{outline:none}.react-jinke-music-player-main li,.react-jinke-music-player-main ul{list-style-type:none;margin:0;padding:0}.react-jinke-music-player-main *{box-sizing:border-box}.react-jinke-music-player-main .text-center{text-align:center}.react-jinke-music-player-main .hidden{display:none!important}.react-jinke-music-player-main .loading{animation:audioLoading 1s linear infinite;display:inline-flex}.react-jinke-music-player-main .loading svg{color:#31c27c;font-size:24px}.react-jinke-music-player-main .translate{animation:translate .35s cubic-bezier(.43,-.1,.16,1.1) forwards}.react-jinke-music-player-main .scale{animation:scaleTo .35s cubic-bezier(.43,-.1,.16,1.1) forwards}@keyframes playing{to{transform:rotateX(1turn)}}@keyframes coverReset{to{transform:rotate(0)}}@keyframes audioLoading{0%{transform:rotate(0)}to{transform:rotate(1turn)}}@keyframes scale{0%{transform:scale(0)}50%{opacity:.6;transform:scale(1.5)}to{opacity:0;transform:scale(2)}}@keyframes scaleTo{0%{opacity:0;transform:scale(0)}to{opacity:1;transform:scale(1)}}@keyframes scaleFrom{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(0)}}@keyframes imgRotate{0%{transform:rotate(0)}to{transform:rotate(1turn)}}@keyframes fromTo{0%{transform:scale(1) translateY(110%)}to{transform:scale(1) translateZ(0)}}@keyframes fromOut{0%{transform:scale(1) translateZ(0)}to{transform:scale(1) translateY(110%)}}@keyframes fromDown{0%{transform:scale(1) translateY(-110%)}to{transform:scale(1) translateZ(0)}}@keyframes translate{0%{opacity:0;transform:translate(100%)}to{opacity:1;transform:translateZ(0)}}@keyframes remove{0%{opacity:1;transform:translateZ(0)}to{opacity:0;transform:translate(-100%)}}.react-jinke-music-player-main .img-rotate-pause{animation-play-state:paused!important}.react-jinke-music-player-main .img-rotate-reset{animation:coverReset .35s cubic-bezier(.43,-.1,.16,1.1) forwards!important}.react-jinke-music-player-mobile{background-color:rgba(0,0,0,.75);bottom:0;color:#fff;display:flex;flex-direction:column;justify-content:space-between;left:0;overflow:hidden;padding:20px;position:fixed;right:0;top:0;width:100%;z-index:999}.react-jinke-music-player-mobile>.group{flex:1 1 auto}.react-jinke-music-player-mobile .show{animation:mobile-bg-show .35s cubic-bezier(.43,-.1,.16,1.1) forwards}.react-jinke-music-player-mobile .hide{animation:mobile-bg-hide .35s cubic-bezier(.43,-.1,.16,1.1) forwards}.react-jinke-music-player-mobile-play-model-tip{align-items:center;background-color:#31c27c;box-shadow:0 2px 20px rgba(0,0,0,.1);color:#fff;display:flex;height:35px;left:0;line-height:35px;padding:0 20px;position:fixed;top:0;transform:translateY(-105%);transition:transform .35s cubic-bezier(.43,-.1,.16,1.1);width:100%;z-index:1000}.react-jinke-music-player-mobile-play-model-tip-title{margin-right:12px}.react-jinke-music-player-mobile-play-model-tip-title svg{animation:none!important;vertical-align:text-bottom!important}@media screen and (max-width:767px){.react-jinke-music-player-mobile-play-model-tip-title svg{color:#fff!important;font-size:19px}}.react-jinke-music-player-mobile-play-model-tip-title .loop-btn{display:flex}.react-jinke-music-player-mobile-play-model-tip-text{font-size:14px}.react-jinke-music-player-mobile-play-model-tip.show{transform:translateZ(0)}.react-jinke-music-player-mobile-header{align-items:center;animation:fromDown .35s cubic-bezier(.43,-.1,.16,1.1) forwards;display:flex;justify-content:center;left:0;position:relative;top:0;width:100%}.react-jinke-music-player-mobile-header-title{font-size:20px;overflow:hidden;padding:0 30px;text-align:center;text-overflow:ellipsis;transition:color .35s cubic-bezier(.43,-.1,.16,1.1);white-space:nowrap}.react-jinke-music-player-mobile-header .item{display:inline-flex;width:50px}.react-jinke-music-player-mobile-header-right{color:rgba(255,255,255,.6);cursor:pointer;position:absolute;right:0}.react-jinke-music-player-mobile-header-right svg{font-size:25px}.react-jinke-music-player-mobile-singer{animation:fromDown .35s cubic-bezier(.43,-.1,.16,1.1) forwards;padding:12px 0}@media screen and (max-width:320px){.react-jinke-music-player-mobile-singer{padding:0}}.react-jinke-music-player-mobile-singer-name{font-size:14px;position:relative;transition:color .35s cubic-bezier(.43,-.1,.16,1.1)}.react-jinke-music-player-mobile-singer-name:after,.react-jinke-music-player-mobile-singer-name:before{background-color:rgba(255,255,255,.6);border-radius:2px;content:\"\";height:1px;position:absolute;top:9px;transition:background-color .35s cubic-bezier(.43,-.1,.16,1.1);width:16px}.react-jinke-music-player-mobile-singer-name:after{left:-25px}.react-jinke-music-player-mobile-singer-name:before{right:-25px}.react-jinke-music-player-mobile-cover{animation:fromTo .35s cubic-bezier(.43,-.1,.16,1.1) forwards;border:5px solid rgba(0,0,0,.2);border-radius:50%;box-shadow:0 0 1px 3px rgba(0,0,0,.1);height:300px;margin:15px auto;overflow:hidden;transition:box-shadow,border .35s cubic-bezier(.43,-.1,.16,1.1);width:300px}@media screen and (max-width:320px){.react-jinke-music-player-mobile-cover{height:230px;margin:10px auto;width:230px}}.react-jinke-music-player-mobile-cover .cover{animation:imgRotate 30s linear infinite;object-fit:cover;width:100%}.react-jinke-music-player-mobile-progress{align-items:center;display:flex;justify-content:space-around}.react-jinke-music-player-mobile-progress .current-time,.react-jinke-music-player-mobile-progress .duration{color:rgba(255,255,255,.6);display:inline-flex;font-size:12px;transition:color .35s cubic-bezier(.43,-.1,.16,1.1);width:55px}.react-jinke-music-player-mobile-progress .current-time{margin-right:5px}.react-jinke-music-player-mobile-progress .duration{justify-content:flex-end;margin-left:5px}.react-jinke-music-player-mobile-progress .progress-bar{flex:1 1 auto}.react-jinke-music-player-mobile-progress .rc-slider-rail{background-color:rgba(255,255,255,.6)}.react-jinke-music-player-mobile-progress .rc-slider-handle,.react-jinke-music-player-mobile-progress .rc-slider-track{background-color:#31c27c}.react-jinke-music-player-mobile-progress .rc-slider-handle{border:2px solid #fff}.react-jinke-music-player-mobile-progress .rc-slider-handle:active{box-shadow:0 0 2px #31c27c}.react-jinke-music-player-mobile-progress-bar{display:flex;position:relative;width:100%}.react-jinke-music-player-mobile-progress-bar .progress-load-bar{background-color:rgba(0,0,0,.06);height:4px;left:0;position:absolute;top:5px;transition:width,background-color .35s cubic-bezier(.43,-.1,.16,1.1);width:0;z-index:77}.react-jinke-music-player-mobile-switch{animation:fromDown .35s cubic-bezier(.43,-.1,.16,1.1) forwards}.react-jinke-music-player-mobile-toggle{padding:17px 0}.react-jinke-music-player-mobile-toggle .group{cursor:pointer}.react-jinke-music-player-mobile-toggle .group svg{font-size:40px}.react-jinke-music-player-mobile-toggle .play-btn{padding:0 40px}.react-jinke-music-player-mobile-toggle .play-btn svg{font-size:45px}.react-jinke-music-player-mobile-toggle .loading-icon{padding:0 40px}@media screen and (max-width:320px){.react-jinke-music-player-mobile-toggle{padding:10px 0}.react-jinke-music-player-mobile-toggle>.group svg{font-size:32px}.react-jinke-music-player-mobile-toggle .play-btn svg{font-size:40px}}.react-jinke-music-player-mobile-operation,.react-jinke-music-player-mobile-progress,.react-jinke-music-player-mobile-toggle{animation:fromTo .35s cubic-bezier(.43,-.1,.16,1.1) forwards}.react-jinke-music-player-mobile-operation .items{align-items:center;display:flex;justify-content:space-around}.react-jinke-music-player-mobile-operation .items .item{cursor:pointer;flex:1;text-align:center}.react-jinke-music-player-mobile-operation .items .item svg{color:rgba(255,255,255,.6)}@keyframes mobile-bg-show{0%{opacity:0}to{opacity:1}}@keyframes mobile-bg-hide{0%{opacity:1}to{opacity:0}}.audio-lists-panel-sortable-highlight-bg{background-color:rgba(49,194,124,.15)!important}.audio-lists-panel{background-color:rgba(0,0,0,.75);border-radius:4px 4px 0 0;bottom:80px;color:rgba(255,255,255,.8);display:none\\\t;height:410px;overflow:hidden;position:fixed;right:33px;transform:scale(0);transform-origin:right bottom;transition:background-color .35s cubic-bezier(.43,-.1,.16,1.1);width:480px;z-index:999}.audio-lists-panel svg{font-size:24px}.audio-lists-panel.show{animation:scaleTo .35s cubic-bezier(.43,-.1,.16,1.1) forwards;display:block\\\t}.audio-lists-panel.hide{animation:scaleFrom .35s cubic-bezier(.43,-.1,.16,1.1) forwards;display:none\\\t}.audio-lists-panel-mobile{background-color:rgba(0,0,0,.75);border-radius:0;bottom:0;height:auto!important;left:0;right:0;top:0;transform-origin:bottom center;width:100%!important}.audio-lists-panel-mobile.show{animation:fromTo .35s cubic-bezier(.43,-.1,.16,1.1) forwards;display:block\\\t}.audio-lists-panel-mobile.hide{animation:fromOut .35s cubic-bezier(.43,-.1,.16,1.1) forwards;display:none\\\t}.audio-lists-panel-mobile .audio-item:not(.audio-lists-panel-sortable-highlight-bg){background-color:rgba(0,0,0,.15)!important}.audio-lists-panel-mobile .audio-item:not(.audio-lists-panel-sortable-highlight-bg).playing{background-color:rgba(0,0,0,.75)!important}.audio-lists-panel-mobile .audio-lists-panel-content{-webkit-overflow-scrolling:touch;height:calc(100vh - 50px)!important;transform-origin:bottom center;width:100%!important}.audio-lists-panel-header{border-bottom:1px solid rgba(3,3,3,.75);box-shadow:0 1px 2px rgba(0,0,0,.2);text-shadow:0 1px 1px rgba(0,0,0,.1);transition:background-color,border-bottom .35s cubic-bezier(.43,-.1,.16,1.1)}.audio-lists-panel-header-close-btn,.audio-lists-panel-header-delete-btn{cursor:pointer;display:flex}.audio-lists-panel-header-delete-btn svg{font-size:21px}@media screen and (max-width:767px){.audio-lists-panel-header-delete-btn svg{font-size:19px}}@media screen and (min-width:768px){.audio-lists-panel-header-close-btn:hover svg{animation:imgRotate .35s cubic-bezier(.43,-.1,.16,1.1)}}.audio-lists-panel-header-line{background:#fff;height:20px;margin:0 10px;width:1px}.audio-lists-panel-header-title{align-items:center;display:flex;font-size:16px;font-weight:500;height:50px;margin:0;padding:0 20px;text-align:left;transition:color .35s cubic-bezier(.43,-.1,.16,1.1)}.audio-lists-panel-header-num{margin-left:10px}.audio-lists-panel-header-actions{align-items:center;display:flex;flex-grow:1;justify-content:flex-end}.audio-lists-panel-content{height:359px;overflow-x:hidden;overflow-y:auto}.audio-lists-panel-content.no-content{align-items:center;display:flex;justify-content:center}.audio-lists-panel-content.no-content>span{display:flex}.audio-lists-panel-content .no-data{margin-left:10px}.audio-lists-panel-content .audio-item{align-items:center;border-bottom:1px solid transparent;cursor:pointer;display:flex;font-size:14px;justify-content:space-between;line-height:40px;padding:3px 20px;transition:background-color .35s cubic-bezier(.43,-.1,.16,1.1)}.audio-lists-panel-content .audio-item:nth-child(odd){background-color:rgba(0,0,0,.1)}.audio-lists-panel-content .audio-item.playing{background-color:rgba(0,0,0,.35)}.audio-lists-panel-content .audio-item.playing,.audio-lists-panel-content .audio-item.playing svg{color:#31c27c}.audio-lists-panel-content .audio-item.remove{animation:remove .35s cubic-bezier(.43,-.1,.16,1.1) forwards}.audio-lists-panel-content .audio-item .player-icons{display:inline-flex;width:30px}.audio-lists-panel-content .audio-item .player-icons .loading{animation:audioLoading 1s linear infinite}.audio-lists-panel-content .audio-item:active,.audio-lists-panel-content .audio-item:hover{background-color:rgba(0,0,0,.35)}.audio-lists-panel-content .audio-item:active .group:not([class=\".player-delete\"]) svg,.audio-lists-panel-content .audio-item:hover .group:not([class=\".player-delete\"]) svg{color:#31c27c}.audio-lists-panel-content .audio-item .group{display:inline-flex}.audio-lists-panel-content .audio-item .player-name{flex:1;padding:0 20px 0 10px}.audio-lists-panel-content .audio-item .player-name,.audio-lists-panel-content .audio-item .player-singer{display:inline-block;overflow:hidden;text-overflow:ellipsis;transition:color .35s cubic-bezier(.43,-.1,.16,1.1);white-space:nowrap}.audio-lists-panel-content .audio-item .player-singer{font-size:12px;width:85px}.audio-lists-panel-content .audio-item .player-delete{justify-content:flex-end;text-align:right;width:30px}.audio-lists-panel-content .audio-item .player-delete:hover svg{animation:imgRotate .35s cubic-bezier(.43,-.1,.16,1.1)}.react-jinke-music-player-main{font-family:inherit;touch-action:none}.react-jinke-music-player-main ::-webkit-scrollbar-thumb{background-color:#31c27c;height:20px;opacity:.5}.react-jinke-music-player-main ::-webkit-scrollbar{background-color:#f7f8fa;width:8px}.react-jinke-music-player-main .rc-switch:focus{box-shadow:none}.react-jinke-music-player-main .lyric-btn svg{font-size:20px}.react-jinke-music-player-main .lyric-btn-active,.react-jinke-music-player-main .lyric-btn-active svg{color:#31c27c!important}.react-jinke-music-player-main .music-player-lyric{background:transparent;bottom:100px;color:#31c27c;cursor:move;font-size:36px;left:0;position:fixed;text-align:center;text-shadow:0 1px 1px hsla(0,0%,100%,.05);transition:box-shadow .35s cubic-bezier(.43,-.1,.16,1.1);width:100%;z-index:998}@media screen and (max-width:767px){.react-jinke-music-player-main .music-player-lyric{font-size:16px;z-index:999}}.react-jinke-music-player-main .play-mode-title{background-color:rgba(0,0,0,.5);bottom:80px;color:#fff;line-height:1.5;opacity:0;padding:5px 20px;pointer-events:none;position:fixed;right:72px;text-align:center;transform:translate(100%);transform-origin:bottom center;transition:all .35s cubic-bezier(.43,-.1,.16,1.1);user-select:none;visibility:hidden;z-index:1000}.react-jinke-music-player-main .play-mode-title.play-mode-title-visible{opacity:1;pointer-events:all;transform:translateZ(0);visibility:visible}.react-jinke-music-player-main .glass-bg-container{background-position:50%;background-repeat:no-repeat;background-size:cover;filter:blur(80px);height:300%;left:0;position:absolute;top:0;width:300%;z-index:-1}.react-jinke-music-player-main .glass-bg{backdrop-filter:blur(10px)}.react-jinke-music-player-main svg{font-size:24px;transition:color .35s cubic-bezier(.43,-.1,.16,1.1)}.react-jinke-music-player-main svg:active,.react-jinke-music-player-main svg:hover{color:#31c27c}@media screen and (max-width:767px){.react-jinke-music-player-main svg{font-size:22px}}.react-jinke-music-player-main .react-jinke-music-player-mode-icon{animation:scaleTo .35s cubic-bezier(.43,-.1,.16,1.1)}.react-jinke-music-player-main .music-player-panel{background-color:rgba(0,0,0,.75);bottom:0;box-shadow:0 0 3px #403f3f;color:#fff;height:80px;left:0;position:fixed;transition:background-color .35s cubic-bezier(.43,-.1,.16,1.1);width:100%;z-index:99}.react-jinke-music-player-main .music-player-panel .panel-content{align-items:center;display:flex;height:100%;justify-content:center;overflow:hidden;padding:0 30px;position:relative}.react-jinke-music-player-main .music-player-panel .panel-content .rc-slider-rail{background-color:rgba(255,255,255,.6)}.react-jinke-music-player-main .music-player-panel .panel-content .rc-slider-handle,.react-jinke-music-player-main .music-player-panel .panel-content .rc-slider-track{background-color:#31c27c}.react-jinke-music-player-main .music-player-panel .panel-content .rc-slider-handle{border:2px solid #fff}.react-jinke-music-player-main .music-player-panel .panel-content .rc-slider-handle:active{box-shadow:0 0 2px #31c27c}.react-jinke-music-player-main .music-player-panel .panel-content .img-content{background-repeat:no-repeat;background-size:100%;border-radius:50%;box-shadow:0 0 10px rgba(0,34,77,.05);cursor:pointer;height:50px;overflow:hidden;width:50px}@media screen and (max-width:767px){.react-jinke-music-player-main .music-player-panel .panel-content .img-content{height:40px;width:40px}}.react-jinke-music-player-main .music-player-panel .panel-content .img-content img{width:100%}.react-jinke-music-player-main .music-player-panel .panel-content .img-rotate{animation:imgRotate 15s linear infinite}.react-jinke-music-player-main .music-player-panel .panel-content .hide-panel,.react-jinke-music-player-main .music-player-panel .panel-content .upload-music{cursor:pointer;flex-basis:10%;margin-left:15px}@media screen and (max-width:767px){.react-jinke-music-player-main .music-player-panel .panel-content .progress-bar-content{display:none!important}}.react-jinke-music-player-main .music-player-panel .panel-content .progress-bar-content{flex:1;overflow:hidden;padding:0 20px}.react-jinke-music-player-main .music-player-panel .panel-content .progress-bar-content .audio-title{display:inline-block;overflow:hidden;text-overflow:ellipsis;transition:color .35s cubic-bezier(.43,-.1,.16,1.1);white-space:nowrap;width:100%}.react-jinke-music-player-main .music-player-panel .panel-content .progress-bar-content .audio-main{display:inline-flex;justify-content:center;margin-top:6px;width:100%}.react-jinke-music-player-main .music-player-panel .panel-content .progress-bar-content .audio-main .current-time,.react-jinke-music-player-main .music-player-panel .panel-content .progress-bar-content .audio-main .duration{flex-basis:5%;font-size:12px;transition:color .35s cubic-bezier(.43,-.1,.16,1.1)}.react-jinke-music-player-main .music-player-panel .panel-content .progress-bar-content .progress-bar{flex:1 1 auto;margin:2px 20px 0;position:relative;width:100%}.react-jinke-music-player-main .music-player-panel .panel-content .progress-bar-content .progress-bar .progress{background:linear-gradient(135deg,transparent,transparent 31%,rgba(0,0,0,.05) 33%,rgba(0,0,0,.05) 67%,transparent 69%);background-color:#31c27c;display:inline-block;height:5px;left:0;position:absolute;top:0;transition:width .35s cubic-bezier(.43,-.1,.16,1.1)}.react-jinke-music-player-main .music-player-panel .panel-content .progress-bar-content .progress-bar .progress .progress-change{background-color:#fff;border-radius:50%;bottom:-2px;box-shadow:0 0 2px rgba(0,0,0,.4);cursor:pointer;height:10px;position:absolute;right:0;width:10px}.react-jinke-music-player-main .music-player-panel .panel-content .progress-bar-content .progress-bar .progress-load-bar{background-color:rgba(0,0,0,.11);border-radius:6px;height:4px;left:0;position:absolute;top:5px;transition:width,background-color .35s cubic-bezier(.43,-.1,.16,1.1);width:0;z-index:77}.react-jinke-music-player-main .music-player-panel .panel-content .progress-bar-content .progress-bar .rc-slider-track{z-index:78}.react-jinke-music-player-main .music-player-panel .panel-content .progress-bar-content .progress-bar .rc-slider-handle{z-index:79}.react-jinke-music-player-main .music-player-panel .panel-content .player-content{align-content:center;align-items:center;display:inline-flex;flex-basis:15%;padding-left:5%}.react-jinke-music-player-main .music-player-panel .panel-content .player-content>.group{align-items:center;display:inline-flex;flex:1;justify-content:center;margin:0 10px;text-align:center}.react-jinke-music-player-main .music-player-panel .panel-content .player-content>.group,.react-jinke-music-player-main .music-player-panel .panel-content .player-content>.group>svg{cursor:pointer}.react-jinke-music-player-main .music-player-panel .panel-content .player-content>.group .group{display:flex}@media screen and (max-width:767px){.react-jinke-music-player-main .music-player-panel .panel-content .player-content>.group{margin:0 6px}}@media screen and (max-width:320px){.react-jinke-music-player-main .music-player-panel .panel-content .player-content>.group{margin:0 4px}}.react-jinke-music-player-main .music-player-panel .panel-content .player-content>.group>i{color:#31c27c;cursor:pointer;font-size:25px;vertical-align:middle}.react-jinke-music-player-main .music-player-panel .panel-content .player-content .theme-switch .rc-switch{background-color:transparent}@media screen and (max-width:767px){.react-jinke-music-player-main .music-player-panel .panel-content .player-content .play-sounds{display:none!important}}.react-jinke-music-player-main .music-player-panel .panel-content .player-content .next-audio svg,.react-jinke-music-player-main .music-player-panel .panel-content .player-content .prev-audio svg{font-size:35px}.react-jinke-music-player-main .music-player-panel .panel-content .player-content .loading-icon,.react-jinke-music-player-main .music-player-panel .panel-content .player-content .play-btn{padding:0 18px}.react-jinke-music-player-main .music-player-panel .panel-content .player-content .play-btn svg{font-size:26px}.react-jinke-music-player-main .music-player-panel .panel-content .player-content .loop-btn.active{color:#31c27c}.react-jinke-music-player-main .music-player-panel .panel-content .player-content .play-sounds{align-items:center}.react-jinke-music-player-main .music-player-panel .panel-content .player-content .play-sounds svg{font-size:28px}.react-jinke-music-player-main .music-player-panel .panel-content .player-content .play-sounds .sounds-icon{display:flex;flex:1 1 auto;margin-right:15px}.react-jinke-music-player-main .music-player-panel .panel-content .player-content .play-sounds .sound-operation{width:100px}.react-jinke-music-player-main .music-player-panel .panel-content .player-content .destroy-btn svg{font-size:28px}.react-jinke-music-player-main .music-player-panel .panel-content .player-content .audio-lists-btn{background-color:rgba(0,0,0,.3);border-radius:40px;box-shadow:0 0 1px 1px rgba(255,255,255,.02);height:28px;min-width:60px;padding:0 10px;position:relative;transition:color,background-color .35s cubic-bezier(.43,-.1,.16,1.1);user-select:none}.react-jinke-music-player-main .music-player-panel .panel-content .player-content .audio-lists-btn .audio-lists-icon{display:flex}.react-jinke-music-player-main .music-player-panel .panel-content .player-content .audio-lists-btn>.group:hover,.react-jinke-music-player-main .music-player-panel .panel-content .player-content .audio-lists-btn>.group:hover>svg{color:#31c27c}.react-jinke-music-player-main .music-player-panel .panel-content .player-content .audio-lists-btn .audio-lists-num{margin-left:8px}.react-jinke-music-player-main .music-player-panel .rc-switch-inner svg{font-size:13px}.react-jinke-music-player-main .rc-slider-rail{background-color:#fff!important;transition:background-color .35s cubic-bezier(.43,-.1,.16,1.1)}.react-jinke-music-player-main.light-theme svg{color:#31c27c}.react-jinke-music-player-main.light-theme svg:active,.react-jinke-music-player-main.light-theme svg:hover{color:#3ece89}.react-jinke-music-player-main.light-theme .rc-slider-rail{background-color:rgba(0,0,0,.09)!important}.react-jinke-music-player-main.light-theme .music-player-controller{background-color:#fff;border-color:#fff}.react-jinke-music-player-main.light-theme .music-player-panel{background-color:#fff;box-shadow:0 1px 2px rgba(0,34,77,.05);color:#7d7d7d}.react-jinke-music-player-main.light-theme .music-player-panel .img-content{box-shadow:0 0 10px #dcdcdc}.react-jinke-music-player-main.light-theme .music-player-panel .progress-load-bar{background-color:rgba(0,0,0,.06)!important}.react-jinke-music-player-main.light-theme .rc-switch{color:#fff}.react-jinke-music-player-main.light-theme .rc-switch:after{background-color:#fff}.react-jinke-music-player-main.light-theme .rc-switch-checked{background-color:#31c27c!important;border:1px solid #31c27c}.react-jinke-music-player-main.light-theme .rc-switch-inner{color:#fff}.react-jinke-music-player-main.light-theme .audio-lists-btn{background-color:#f7f8fa!important}.react-jinke-music-player-main.light-theme .audio-lists-btn:active,.react-jinke-music-player-main.light-theme .audio-lists-btn:hover{background-color:#fdfdfe;color:#444}.react-jinke-music-player-main.light-theme .audio-lists-btn>.group:hover,.react-jinke-music-player-main.light-theme .audio-lists-btn>.group:hover>svg{color:#444}.react-jinke-music-player-main.light-theme .audio-lists-panel{background-color:#fff;box-shadow:0 0 2px #dcdcdc;color:#444}.react-jinke-music-player-main.light-theme .audio-lists-panel .audio-item{background-color:#fff}.react-jinke-music-player-main.light-theme .audio-lists-panel .audio-item:nth-child(odd){background-color:#fafafa!important}.react-jinke-music-player-main.light-theme .audio-lists-panel .audio-item.playing{background-color:#f2f2f2!important}.react-jinke-music-player-main.light-theme .audio-lists-panel .audio-item.playing,.react-jinke-music-player-main.light-theme .audio-lists-panel .audio-item.playing svg{color:#31c27c!important}@media screen and (max-width:767px){.react-jinke-music-player-main.light-theme .audio-lists-panel .audio-item{background-color:#fff!important}.react-jinke-music-player-main.light-theme .audio-lists-panel .audio-item.playing{background-color:#f2f2f2!important}.react-jinke-music-player-main.light-theme .audio-lists-panel .audio-item.playing,.react-jinke-music-player-main.light-theme .audio-lists-panel .audio-item.playing svg{color:#31c27c!important}}.react-jinke-music-player-main.light-theme .audio-lists-panel-header{background-color:#fff;border-bottom:1px solid #f4f4f7;color:#444}.react-jinke-music-player-main.light-theme .audio-lists-panel-header-line{background-color:#f4f4f7}.react-jinke-music-player-main.light-theme .audio-item{background-color:rgba(64,68,75,.65);border-bottom:1px solid hsla(0,0%,86.3%,.26);box-shadow:0 0 2px transparent!important}.react-jinke-music-player-main.light-theme .audio-item:active,.react-jinke-music-player-main.light-theme .audio-item:hover{background-color:#fafafa!important}.react-jinke-music-player-main.light-theme .audio-item:active svg,.react-jinke-music-player-main.light-theme .audio-item:hover svg{color:#31c27c}.react-jinke-music-player-main.light-theme .audio-item.playing{background-color:#fafafa!important}.react-jinke-music-player-main.light-theme .audio-item.playing svg{color:#31c27c}.react-jinke-music-player-main.light-theme .audio-item.playing .player-singer{color:#31c27c!important}.react-jinke-music-player-main.light-theme .audio-item .player-singer{color:rgba(162,162,162,.45)!important}.react-jinke-music-player-main.light-theme .react-jinke-music-player-mobile{background-color:#fff;color:#444}.react-jinke-music-player-main.light-theme .react-jinke-music-player-mobile-cover{border:5px solid transparent;box-shadow:0 0 30px 2px rgba(0,0,0,.2)}.react-jinke-music-player-main.light-theme .react-jinke-music-player-mobile .current-time,.react-jinke-music-player-main.light-theme .react-jinke-music-player-mobile .duration{color:#444}.react-jinke-music-player-main.light-theme .react-jinke-music-player-mobile .rc-slider-rail{background-color:#e9e9e9}.react-jinke-music-player-main.light-theme .react-jinke-music-player-mobile-operation svg{color:#444}.react-jinke-music-player-main.light-theme .react-jinke-music-player-mobile-tip svg{color:#fff!important}.react-jinke-music-player-main.light-theme .react-jinke-music-player-mobile-singer-name{color:#444;transition:color .35s cubic-bezier(.43,-.1,.16,1.1)}.react-jinke-music-player-main.light-theme .react-jinke-music-player-mobile-singer-name:after,.react-jinke-music-player-main.light-theme .react-jinke-music-player-mobile-singer-name:before{background-color:#444}.react-jinke-music-player-main.light-theme .play-mode-title{background-color:#fff;color:#31c27c}.react-jinke-music-player{height:80px;position:fixed;width:80px;z-index:999}@media screen and (max-width:767px){.react-jinke-music-player{height:60px;width:60px}}.react-jinke-music-player:focus{outline:none}.react-jinke-music-player .music-player{cursor:pointer;height:80px;position:relative;width:80px}@media screen and (max-width:767px){.react-jinke-music-player .music-player{height:60px;width:60px}}.react-jinke-music-player .music-player:focus{outline:none}.react-jinke-music-player .music-player-audio{display:none!important}.react-jinke-music-player .music-player .destroy-btn{position:absolute;right:0;top:0;z-index:100}@media screen and (max-width:767px){.react-jinke-music-player .music-player .destroy-btn{right:-3px}}.react-jinke-music-player .music-player-controller{align-items:center;background-color:#e6e6e6;background-repeat:no-repeat;background-size:100%;border:1px solid #e6e6e6;border-radius:50%;box-shadow:0 0 10px rgba(0,0,0,.15);color:#31c27c;cursor:pointer;display:flex;font-size:20px;height:80px;justify-content:center;padding:10px;position:fixed;text-align:center;transition:all .3s cubic-bezier(.43,-.1,.16,1.1);width:80px;z-index:99}.react-jinke-music-player .music-player-controller:focus{outline:none}.react-jinke-music-player .music-player-controller.music-player-playing:before{animation:scale 5s linear infinite;border:1px solid hsla(0,0%,100%,.2);border-radius:50%;content:\"\";cursor:pointer;height:80px;position:fixed;width:80px;z-index:-1}@media screen and (max-width:767px){.react-jinke-music-player .music-player-controller{height:60px;width:60px}.react-jinke-music-player .music-player-controller.music-player-playing:before{height:60px;width:60px}}.react-jinke-music-player .music-player-controller i{font-size:28px}.react-jinke-music-player .music-player-controller:active{box-shadow:0 0 30px rgba(0,0,0,.2)}.react-jinke-music-player .music-player-controller:hover{font-size:16px}.react-jinke-music-player .music-player-controller:hover .music-player-controller-setting{transform:scale(1)}.react-jinke-music-player .music-player-controller .controller-title{font-size:14px}@media screen and (max-width:767px){.react-jinke-music-player .music-player-controller i{font-size:20px}.react-jinke-music-player .music-player-controller:active,.react-jinke-music-player .music-player-controller:hover{font-size:12px}.react-jinke-music-player .music-player-controller:active .music-player-controller-setting,.react-jinke-music-player .music-player-controller:hover .music-player-controller-setting{transform:scale(1)}}.react-jinke-music-player .music-player-controller .music-player-controller-setting{align-items:center;background:rgba(49,194,124,.3);border-radius:50%;color:#fff;display:flex;height:100%;justify-content:center;left:0;position:absolute;top:0;transform:scale(0);transition:all .4s cubic-bezier(.43,-.1,.16,1.1);width:100%}.react-jinke-music-player .audio-circle-process-bar{stroke-width:3px;stroke-linejoin:round;animation:scaleTo .35s cubic-bezier(.43,-.1,.16,1.1);height:80px;left:0;pointer-events:none;position:absolute;top:-80px;width:80px;z-index:100}.react-jinke-music-player .audio-circle-process-bar circle[class=bg]{stroke:#fff}.react-jinke-music-player .audio-circle-process-bar circle[class=stroke]{stroke:#31c27c}.react-jinke-music-player .audio-circle-process-bar,.react-jinke-music-player .audio-circle-process-bar circle{transform:matrix(0,-1,1,0,0,80);transition:stroke-dasharray .35s cubic-bezier(.43,-.1,.16,1.1)}@media screen and (max-width:767px){.react-jinke-music-player .audio-circle-process-bar,.react-jinke-music-player .audio-circle-process-bar circle{transform:matrix(0,-1,1,0,0,60)}}\n";document.head.appendChild(__vite_style__);System.register(['./vendor-legacy.75b6488b.js','./clsx.m-legacy.06e05998.js','./index.esm-legacy.fe6c3c2e.js','./index-legacy.7f936a63.js','./useTitle-legacy.6343c09e.js','./index-legacy.5c7fb3bb.js','./copy-clip-legacy.98530339.js'],function(exports){'use strict';var commonjsGlobal,react,reactDom,getAugmentedNamespace,propTypes$1,React$1,PropTypes,useColorModeValue,useTranslation,useBreakpointValue,Box,Center,Heading,Icon,commonjsRequire,Image$1,Spinner,VStack,HStack,Button,Link,useLocation,RadioGroup,Stack,Radio,getDefaultExportFromCjs,useHistory,Menu,MenuButton,Text$1,MenuList,MenuItem,Link$1,Wrap,chakra,clsx_m,IContext,useLocalStorage,instance,BsCardList,useFileUrl,getIcon,useFolderLink,__glob_7_1,__glob_7_5,useTitle;return{setters:[function(module){commonjsGlobal=module.ae;react=module.r;reactDom=module.ad;getAugmentedNamespace=module.an;propTypes$1=module.ao;React$1=module.R;PropTypes=module.J;useColorModeValue=module.l;useTranslation=module.j;useBreakpointValue=module.am;Box=module.n;Center=module.C;Heading=module.H;Icon=module.s;commonjsRequire=module.ap;Image$1=module.t;Spinner=module.v;VStack=module.V;HStack=module.p;Button=module.G;Link=module.y;useLocation=module.u;RadioGroup=module.aq;Stack=module.a8;Radio=module.ar;getDefaultExportFromCjs=module.af;useHistory=module.o;Menu=module.a4;MenuButton=module.a5;Text$1=module.E;MenuList=module.a6;MenuItem=module.a7;Link$1=module.L;Wrap=module.as;chakra=module.aj;},function(module){clsx_m=module.a;},function(module){IContext=module.I;useLocalStorage=module.R;instance=module.i;BsCardList=module.S;},function(module){useFileUrl=module.e;getIcon=module.q;useFolderLink=module.u;__glob_7_1=module._;__glob_7_5=module.s;},function(module){useTitle=module.u;},function(){},function(){}],execute:function execute(){var _Object$freeze,_Object$freeze2,_Object$freeze3,_Object$freeze4,_Object$freeze5,_Object$freeze6,_Object$freeze7,_Object$freeze8,_Object$freeze9,_Object$freeze10;var classnames={exports:{}};/*!
			  Copyright (c) 2018 Jed Watson.
			  Licensed under the MIT License (MIT), see
			  http://jedwatson.github.io/classnames
			*/(function(module){/* global define */(function(){var hasOwn={}.hasOwnProperty;function classNames(){var classes=[];for(var i=0;i<arguments.length;i++){var arg=arguments[i];if(!arg)continue;var argType=_typeof3(arg);if(argType==='string'||argType==='number'){classes.push(arg);}else if(Array.isArray(arg)){if(arg.length){var inner=classNames.apply(null,arg);if(inner){classes.push(inner);}}}else if(argType==='object'){if(arg.toString===Object.prototype.toString){for(var key in arg){if(hasOwn.call(arg,key)&&arg[key]){classes.push(key);}}}else{classes.push(arg.toString());}}}return classes.join(' ');}if(module.exports){classNames.default=classNames;module.exports=classNames;}else{window.classNames=classNames;}})();})(classnames);var cls=classnames.exports;var download$1={exports:{}};(function(module,exports){//download.js v4.2, by dandavis; 2008-2016. [MIT] see http://danml.com/download.html for tests/usage
// v1 landed a FF+Chrome compat way of downloading strings to local un-named files, upgraded to use a hidden frame and optional mime
// v2 added named files via a[download], msSaveBlob, IE (10+) support, and window.URL support for larger+faster saves than dataURLs
// v3 added dataURL and Blob Input, bind-toggle arity, and legacy dataURL fallback was improved with force-download mime and base64 support. 3.1 improved safari handling.
// v4 adds AMD/UMD, commonJS, and plain browser support
// v4.1 adds url download capability via solo URL argument (same domain/CORS only)
// v4.2 adds semantic variable names, long (over 2MB) dataURL support, and hidden by default temp anchors
// https://github.com/rndme/download
(function(root,factory){{// Node. Does not work with strict CommonJS, but
// only CommonJS-like environments that support module.exports,
// like Node.
module.exports=factory();}})(commonjsGlobal,function(){return function download(data,strFileName,strMimeType){var self=window,// this script is only for browsers anyway...
defaultMime="application/octet-stream",// this default mime also triggers iframe downloads
mimeType=strMimeType||defaultMime,payload=data,url=!strFileName&&!strMimeType&&payload,anchor=document.createElement("a"),toString=function toString(a){return String(a);},myBlob=self.Blob||self.MozBlob||self.WebKitBlob||toString,fileName=strFileName||"download",blob,reader;myBlob=myBlob.call?myBlob.bind(self):Blob;if(String(this)==="true"){//reverse arguments, allowing download.bind(true, "text/xml", "export.xml") to act as a callback
payload=[payload,mimeType];mimeType=payload[0];payload=payload[1];}if(url&&url.length<2048){// if no filename and no mime, assume a url was passed as the only argument
fileName=url.split("/").pop().split("?")[0];anchor.href=url;// assign href prop to temp anchor
if(anchor.href.indexOf(url)!==-1){// if the browser determines that it's a potentially valid url path:
var ajax=new XMLHttpRequest();ajax.open("GET",url,true);ajax.responseType='blob';ajax.onload=function(e){download(e.target.response,fileName,defaultMime);};setTimeout(function(){ajax.send();},0);// allows setting custom ajax headers using the return:
return ajax;}// end if valid url?
}// end if url?
//go ahead and download dataURLs right away
if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(payload)){if(payload.length>1024*1024*1.999&&myBlob!==toString){payload=dataUrlToBlob(payload);mimeType=payload.type||defaultMime;}else{return navigator.msSaveBlob?// IE10 can't do a[download], only Blobs:
navigator.msSaveBlob(dataUrlToBlob(payload),fileName):saver(payload);// everyone else can save dataURLs un-processed
}}else{//not data url, is it a string with special needs?
if(/([\x80-\xff])/.test(payload)){var i=0,tempUiArr=new Uint8Array(payload.length),mx=tempUiArr.length;for(i;i<mx;++i){tempUiArr[i]=payload.charCodeAt(i);}payload=new myBlob([tempUiArr],{type:mimeType});}}blob=payload instanceof myBlob?payload:new myBlob([payload],{type:mimeType});function dataUrlToBlob(strUrl){var parts=strUrl.split(/[:;,]/),type=parts[1],decoder=parts[2]=="base64"?atob:decodeURIComponent,binData=decoder(parts.pop()),mx=binData.length,i=0,uiArr=new Uint8Array(mx);for(i;i<mx;++i){uiArr[i]=binData.charCodeAt(i);}return new myBlob([uiArr],{type:type});}function saver(url,winMode){if('download'in anchor){//html5 A[download]
anchor.href=url;anchor.setAttribute("download",fileName);anchor.className="download-js-link";anchor.innerHTML="downloading...";anchor.style.display="none";document.body.appendChild(anchor);setTimeout(function(){anchor.click();document.body.removeChild(anchor);if(winMode===true){setTimeout(function(){self.URL.revokeObjectURL(anchor.href);},250);}},66);return true;}// handle non-a[download] safari as best we can:
if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent)){if(/^data:/.test(url))url="data:"+url.replace(/^data:([\w\/\-\+]+)/,defaultMime);if(!window.open(url)){// popup blocked, offer direct download:
if(confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")){location.href=url;}}return true;}//do iframe dataURL download (old ch+FF):
var f=document.createElement("iframe");document.body.appendChild(f);if(!winMode&&/^data:/.test(url)){// force a mime that will download:
url="data:"+url.replace(/^data:([\w\/\-\+]+)/,defaultMime);}f.src=url;setTimeout(function(){document.body.removeChild(f);},333);}//end saver
if(navigator.msSaveBlob){// IE10+ : (has Blob, but not a[download] or URL)
return navigator.msSaveBlob(blob,fileName);}if(self.URL){// simple fast and modern way using Blob and URL:
saver(self.URL.createObjectURL(blob),true);}else{// handle non-Blob()+non-URL browsers:
if(typeof blob==="string"||blob.constructor===toString){try{return saver("data:"+mimeType+";base64,"+self.btoa(blob));}catch(y){return saver("data:"+mimeType+","+encodeURIComponent(blob));}}// Blob but not URL support:
reader=new FileReader();reader.onload=function(e){saver(this.result);};reader.readAsDataURL(blob);}return true;};/* end download() */});})(download$1);var download=download$1.exports;var isMobile$2={exports:{}};isMobile$2.exports=isMobile$1;isMobile$2.exports.isMobile=isMobile$1;isMobile$2.exports.default=isMobile$1;var mobileRE=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series[46]0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i;var tabletRE=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series[46]0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino|android|ipad|playbook|silk/i;function isMobile$1(opts){if(!opts)opts={};var ua=opts.ua;if(!ua&&typeof navigator!=='undefined')ua=navigator.userAgent;if(ua&&ua.headers&&typeof ua.headers['user-agent']==='string'){ua=ua.headers['user-agent'];}if(typeof ua!=='string')return false;var result=opts.tablet?tabletRE.test(ua):mobileRE.test(ua);if(!result&&opts.tablet&&opts.featureDetect&&navigator&&navigator.maxTouchPoints>1&&ua.indexOf('Macintosh')!==-1&&ua.indexOf('Safari')!==-1){result=true;}return result;}var getIsMobile=isMobile$2.exports;var Slider$1={};var interopRequireWildcard={exports:{}};var _typeof$6={exports:{}};(function(module){function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){module.exports=_typeof=function _typeof(obj){return typeof obj;};module.exports["default"]=module.exports,module.exports.__esModule=true;}else{module.exports=_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};module.exports["default"]=module.exports,module.exports.__esModule=true;}return _typeof(obj);}module.exports=_typeof;module.exports["default"]=module.exports,module.exports.__esModule=true;})(_typeof$6);(function(module){var _typeof=_typeof$6.exports["default"];function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap();var cacheNodeInterop=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj;}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{"default":obj};}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj["default"]=obj;if(cache){cache.set(obj,newObj);}return newObj;}module.exports=_interopRequireWildcard;module.exports["default"]=module.exports,module.exports.__esModule=true;})(interopRequireWildcard);var interopRequireDefault$1={exports:{}};(function(module){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj};}module.exports=_interopRequireDefault;module.exports["default"]=module.exports,module.exports.__esModule=true;})(interopRequireDefault$1);var objectSpread2={exports:{}};var defineProperty={exports:{}};(function(module){function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}module.exports=_defineProperty;module.exports["default"]=module.exports,module.exports.__esModule=true;})(defineProperty);(function(module){var defineProperty$1=defineProperty.exports;function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});}keys.push.apply(keys,symbols);}return keys;}function _objectSpread2(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){defineProperty$1(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}module.exports=_objectSpread2;module.exports["default"]=module.exports,module.exports.__esModule=true;})(objectSpread2);var classCallCheck={exports:{}};(function(module){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}module.exports=_classCallCheck;module.exports["default"]=module.exports,module.exports.__esModule=true;})(classCallCheck);var createClass={exports:{}};(function(module){function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}module.exports=_createClass;module.exports["default"]=module.exports,module.exports.__esModule=true;})(createClass);var inherits={exports:{}};var setPrototypeOf={exports:{}};(function(module){function _setPrototypeOf(o,p){module.exports=_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};module.exports["default"]=module.exports,module.exports.__esModule=true;return _setPrototypeOf(o,p);}module.exports=_setPrototypeOf;module.exports["default"]=module.exports,module.exports.__esModule=true;})(setPrototypeOf);(function(module){var setPrototypeOf$1=setPrototypeOf.exports;function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function");}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)setPrototypeOf$1(subClass,superClass);}module.exports=_inherits;module.exports["default"]=module.exports,module.exports.__esModule=true;})(inherits);var createSuper={exports:{}};var getPrototypeOf={exports:{}};(function(module){function _getPrototypeOf(o){module.exports=_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};module.exports["default"]=module.exports,module.exports.__esModule=true;return _getPrototypeOf(o);}module.exports=_getPrototypeOf;module.exports["default"]=module.exports,module.exports.__esModule=true;})(getPrototypeOf);var isNativeReflectConstruct={exports:{}};(function(module){function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}module.exports=_isNativeReflectConstruct;module.exports["default"]=module.exports,module.exports.__esModule=true;})(isNativeReflectConstruct);var possibleConstructorReturn={exports:{}};var assertThisInitialized={exports:{}};(function(module){function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}module.exports=_assertThisInitialized;module.exports["default"]=module.exports,module.exports.__esModule=true;})(assertThisInitialized);(function(module){var _typeof=_typeof$6.exports["default"];var assertThisInitialized$1=assertThisInitialized.exports;function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call;}else if(call!==void 0){throw new TypeError("Derived constructors may only return object or undefined");}return assertThisInitialized$1(self);}module.exports=_possibleConstructorReturn;module.exports["default"]=module.exports,module.exports.__esModule=true;})(possibleConstructorReturn);(function(module){var getPrototypeOf$1=getPrototypeOf.exports;var isNativeReflectConstruct$1=isNativeReflectConstruct.exports;var possibleConstructorReturn$1=possibleConstructorReturn.exports;function _createSuper(Derived){var hasNativeReflectConstruct=isNativeReflectConstruct$1();return function _createSuperInternal(){var Super=getPrototypeOf$1(Derived),result;if(hasNativeReflectConstruct){var NewTarget=getPrototypeOf$1(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return possibleConstructorReturn$1(this,result);};}module.exports=_createSuper;module.exports["default"]=module.exports,module.exports.__esModule=true;})(createSuper);var warning$1={};Object.defineProperty(warning$1,"__esModule",{value:true});warning$1.warning=warning;warning$1.note=note;warning$1.resetWarned=resetWarned;warning$1.call=call;warning$1.warningOnce=warningOnce;warning$1.noteOnce=noteOnce;warning$1.default=void 0;/* eslint-disable no-console */var warned={};function warning(valid,message){}function note(valid,message){}function resetWarned(){warned={};}function call(method,valid,message){if(!valid&&!warned[message]){method(false,message);warned[message]=true;}}function warningOnce(valid,message){call(warning,valid,message);}function noteOnce(valid,message){call(note,valid,message);}var _default$H=warningOnce;/* eslint-enable */warning$1.default=_default$H;var Track$1={};var _interopRequireDefault$A=interopRequireDefault$1.exports;Object.defineProperty(Track$1,"__esModule",{value:true});Track$1.default=void 0;var _objectSpread2$5=_interopRequireDefault$A(objectSpread2.exports);var _defineProperty2$4=_interopRequireDefault$A(defineProperty.exports);var _react$7=_interopRequireDefault$A(react.exports);var Track=function Track(props){var _ref,_ref2;var className=props.className,included=props.included,vertical=props.vertical,style=props.style;var length=props.length,offset=props.offset,reverse=props.reverse;if(length<0){reverse=!reverse;length=Math.abs(length);offset=100-offset;}var positonStyle=vertical?(_ref={},(0,_defineProperty2$4.default)(_ref,reverse?'top':'bottom',"".concat(offset,"%")),(0,_defineProperty2$4.default)(_ref,reverse?'bottom':'top','auto'),(0,_defineProperty2$4.default)(_ref,"height","".concat(length,"%")),_ref):(_ref2={},(0,_defineProperty2$4.default)(_ref2,reverse?'right':'left',"".concat(offset,"%")),(0,_defineProperty2$4.default)(_ref2,reverse?'left':'right','auto'),(0,_defineProperty2$4.default)(_ref2,"width","".concat(length,"%")),_ref2);var elStyle=(0,_objectSpread2$5.default)((0,_objectSpread2$5.default)({},style),positonStyle);return included?/*#__PURE__*/_react$7.default.createElement("div",{className:className,style:elStyle}):null;};var _default$G=Track;Track$1.default=_default$G;var createSlider$1={};var _extends$5={exports:{}};(function(module){function _extends(){module.exports=_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};module.exports["default"]=module.exports,module.exports.__esModule=true;return _extends.apply(this,arguments);}module.exports=_extends;module.exports["default"]=module.exports,module.exports.__esModule=true;})(_extends$5);var objectWithoutProperties={exports:{}};var objectWithoutPropertiesLoose={exports:{}};(function(module){function _objectWithoutPropertiesLoose(source,excluded){if(source==null)return{};var target={};var sourceKeys=Object.keys(source);var key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(excluded.indexOf(key)>=0)continue;target[key]=source[key];}return target;}module.exports=_objectWithoutPropertiesLoose;module.exports["default"]=module.exports,module.exports.__esModule=true;})(objectWithoutPropertiesLoose);(function(module){var objectWithoutPropertiesLoose$1=objectWithoutPropertiesLoose.exports;function _objectWithoutProperties(source,excluded){if(source==null)return{};var target=objectWithoutPropertiesLoose$1(source,excluded);var key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];if(excluded.indexOf(key)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(source,key))continue;target[key]=source[key];}}return target;}module.exports=_objectWithoutProperties;module.exports["default"]=module.exports,module.exports.__esModule=true;})(objectWithoutProperties);var toConsumableArray={exports:{}};var arrayWithoutHoles={exports:{}};var arrayLikeToArray={exports:{}};(function(module){function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}module.exports=_arrayLikeToArray;module.exports["default"]=module.exports,module.exports.__esModule=true;})(arrayLikeToArray);(function(module){var arrayLikeToArray$1=arrayLikeToArray.exports;function _arrayWithoutHoles(arr){if(Array.isArray(arr))return arrayLikeToArray$1(arr);}module.exports=_arrayWithoutHoles;module.exports["default"]=module.exports,module.exports.__esModule=true;})(arrayWithoutHoles);var iterableToArray={exports:{}};(function(module){function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter);}module.exports=_iterableToArray;module.exports["default"]=module.exports,module.exports.__esModule=true;})(iterableToArray);var unsupportedIterableToArray={exports:{}};(function(module){var arrayLikeToArray$1=arrayLikeToArray.exports;function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return arrayLikeToArray$1(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return arrayLikeToArray$1(o,minLen);}module.exports=_unsupportedIterableToArray;module.exports["default"]=module.exports,module.exports.__esModule=true;})(unsupportedIterableToArray);var nonIterableSpread={exports:{}};(function(module){function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}module.exports=_nonIterableSpread;module.exports["default"]=module.exports,module.exports.__esModule=true;})(nonIterableSpread);(function(module){var arrayWithoutHoles$1=arrayWithoutHoles.exports;var iterableToArray$1=iterableToArray.exports;var unsupportedIterableToArray$1=unsupportedIterableToArray.exports;var nonIterableSpread$1=nonIterableSpread.exports;function _toConsumableArray(arr){return arrayWithoutHoles$1(arr)||iterableToArray$1(arr)||unsupportedIterableToArray$1(arr)||nonIterableSpread$1();}module.exports=_toConsumableArray;module.exports["default"]=module.exports,module.exports.__esModule=true;})(toConsumableArray);var get={exports:{}};var superPropBase={exports:{}};(function(module){var getPrototypeOf$1=getPrototypeOf.exports;function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=getPrototypeOf$1(object);if(object===null)break;}return object;}module.exports=_superPropBase;module.exports["default"]=module.exports,module.exports.__esModule=true;})(superPropBase);(function(module){var superPropBase$1=superPropBase.exports;function _get(target,property,receiver){if(typeof Reflect!=="undefined"&&Reflect.get){module.exports=_get=Reflect.get;module.exports["default"]=module.exports,module.exports.__esModule=true;}else{module.exports=_get=function _get(target,property,receiver){var base=superPropBase$1(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver);}return desc.value;};module.exports["default"]=module.exports,module.exports.__esModule=true;}return _get(target,property,receiver||target);}module.exports=_get;module.exports["default"]=module.exports,module.exports.__esModule=true;})(get);var addEventListener={};var interopRequireDefault={exports:{}};(function(module){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj};}module.exports=_interopRequireDefault;module.exports["default"]=module.exports,module.exports.__esModule=true;})(interopRequireDefault);var _interopRequireDefault$z=interopRequireDefault.exports;Object.defineProperty(addEventListener,"__esModule",{value:true});addEventListener.default=addEventListenerWrap;var _reactDom$2=_interopRequireDefault$z(reactDom.exports);function addEventListenerWrap(target,eventType,cb,option){/* eslint camelcase: 2 */var callback=_reactDom$2.default.unstable_batchedUpdates?function run(e){_reactDom$2.default.unstable_batchedUpdates(cb,e);}:cb;if(target.addEventListener){target.addEventListener(eventType,callback,option);}return{remove:function remove(){if(target.removeEventListener){target.removeEventListener(eventType,callback);}}};}var Steps$1={};var _interopRequireDefault$y=interopRequireDefault$1.exports;Object.defineProperty(Steps$1,"__esModule",{value:true});Steps$1.default=void 0;var _defineProperty2$3=_interopRequireDefault$y(defineProperty.exports);var _objectSpread4=_interopRequireDefault$y(objectSpread2.exports);var _react$6=_interopRequireDefault$y(react.exports);var _classnames$3=_interopRequireDefault$y(classnames.exports);var _warning$2=_interopRequireDefault$y(warning$1);var calcPoints=function calcPoints(vertical,marks,dots,step,min,max){(0,_warning$2.default)(dots?step>0:true,'`Slider[step]` should be a positive number in order to make Slider[dots] work.');var points=Object.keys(marks).map(parseFloat).sort(function(a,b){return a-b;});if(dots&&step){for(var i=min;i<=max;i+=step){if(points.indexOf(i)===-1){points.push(i);}}}return points;};var Steps=function Steps(_ref){var prefixCls=_ref.prefixCls,vertical=_ref.vertical,reverse=_ref.reverse,marks=_ref.marks,dots=_ref.dots,step=_ref.step,included=_ref.included,lowerBound=_ref.lowerBound,upperBound=_ref.upperBound,max=_ref.max,min=_ref.min,dotStyle=_ref.dotStyle,activeDotStyle=_ref.activeDotStyle;var range=max-min;var elements=calcPoints(vertical,marks,dots,step,min,max).map(function(point){var _classNames;var offset="".concat(Math.abs(point-min)/range*100,"%");var isActived=!included&&point===upperBound||included&&point<=upperBound&&point>=lowerBound;var style=vertical?(0,_objectSpread4.default)((0,_objectSpread4.default)({},dotStyle),{},(0,_defineProperty2$3.default)({},reverse?'top':'bottom',offset)):(0,_objectSpread4.default)((0,_objectSpread4.default)({},dotStyle),{},(0,_defineProperty2$3.default)({},reverse?'right':'left',offset));if(isActived){style=(0,_objectSpread4.default)((0,_objectSpread4.default)({},style),activeDotStyle);}var pointClassName=(0,_classnames$3.default)((_classNames={},(0,_defineProperty2$3.default)(_classNames,"".concat(prefixCls,"-dot"),true),(0,_defineProperty2$3.default)(_classNames,"".concat(prefixCls,"-dot-active"),isActived),(0,_defineProperty2$3.default)(_classNames,"".concat(prefixCls,"-dot-reverse"),reverse),_classNames));return/*#__PURE__*/_react$6.default.createElement("span",{className:pointClassName,style:style,key:point});});return/*#__PURE__*/_react$6.default.createElement("div",{className:"".concat(prefixCls,"-step")},elements);};var _default$F=Steps;Steps$1.default=_default$F;var Marks$1={};var _interopRequireDefault$x=interopRequireDefault$1.exports;Object.defineProperty(Marks$1,"__esModule",{value:true});Marks$1.default=void 0;var _objectSpread2$4=_interopRequireDefault$x(objectSpread2.exports);var _defineProperty2$2=_interopRequireDefault$x(defineProperty.exports);var _typeof2=_interopRequireDefault$x(_typeof$6.exports);var _react$5=_interopRequireDefault$x(react.exports);var _classnames$2=_interopRequireDefault$x(classnames.exports);var Marks=function Marks(_ref){var className=_ref.className,vertical=_ref.vertical,reverse=_ref.reverse,marks=_ref.marks,included=_ref.included,upperBound=_ref.upperBound,lowerBound=_ref.lowerBound,max=_ref.max,min=_ref.min,onClickLabel=_ref.onClickLabel;var marksKeys=Object.keys(marks);var range=max-min;var elements=marksKeys.map(parseFloat).sort(function(a,b){return a-b;}).map(function(point){var _classNames;var markPoint=marks[point];var markPointIsObject=(0,_typeof2.default)(markPoint)==='object'&&!/*#__PURE__*/_react$5.default.isValidElement(markPoint);var markLabel=markPointIsObject?markPoint.label:markPoint;if(!markLabel&&markLabel!==0){return null;}var isActive=!included&&point===upperBound||included&&point<=upperBound&&point>=lowerBound;var markClassName=(0,_classnames$2.default)((_classNames={},(0,_defineProperty2$2.default)(_classNames,"".concat(className,"-text"),true),(0,_defineProperty2$2.default)(_classNames,"".concat(className,"-text-active"),isActive),_classNames));var bottomStyle=(0,_defineProperty2$2.default)({marginBottom:'-50%'},reverse?'top':'bottom',"".concat((point-min)/range*100,"%"));var leftStyle=(0,_defineProperty2$2.default)({transform:"translateX(".concat(reverse?"50%":"-50%",")"),msTransform:"translateX(".concat(reverse?"50%":"-50%",")")},reverse?'right':'left',"".concat((point-min)/range*100,"%"));var style=vertical?bottomStyle:leftStyle;var markStyle=markPointIsObject?(0,_objectSpread2$4.default)((0,_objectSpread2$4.default)({},style),markPoint.style):style;return/*#__PURE__*/_react$5.default.createElement("span",{className:markClassName,style:markStyle,key:point,onMouseDown:function onMouseDown(e){return onClickLabel(e,point);},onTouchStart:function onTouchStart(e){return onClickLabel(e,point);}},markLabel);});return/*#__PURE__*/_react$5.default.createElement("div",{className:className},elements);};var _default$E=Marks;Marks$1.default=_default$E;var Handle$1={};var _interopRequireDefault$w=interopRequireDefault$1.exports;Object.defineProperty(Handle$1,"__esModule",{value:true});Handle$1.default=void 0;var _extends2$1=_interopRequireDefault$w(_extends$5.exports);var _objectSpread2$3=_interopRequireDefault$w(objectSpread2.exports);var _defineProperty2$1=_interopRequireDefault$w(defineProperty.exports);var _objectWithoutProperties2$1=_interopRequireDefault$w(objectWithoutProperties.exports);var _classCallCheck2$2=_interopRequireDefault$w(classCallCheck.exports);var _createClass2$2=_interopRequireDefault$w(createClass.exports);var _inherits2$2=_interopRequireDefault$w(inherits.exports);var _createSuper2$2=_interopRequireDefault$w(createSuper.exports);var _react$4=_interopRequireDefault$w(react.exports);var _classnames$1=_interopRequireDefault$w(classnames.exports);var _addEventListener$1=_interopRequireDefault$w(addEventListener);var _excluded$3=["prefixCls","vertical","reverse","offset","style","disabled","min","max","value","tabIndex","ariaLabel","ariaLabelledBy","ariaValueTextFormatter"];var Handle=/*#__PURE__*/function(_React$Component){(0,_inherits2$2.default)(Handle,_React$Component);var _super=(0,_createSuper2$2.default)(Handle);function Handle(){var _this;(0,_classCallCheck2$2.default)(this,Handle);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={clickFocused:false};_this.onMouseUpListener=void 0;_this.handle=void 0;_this.setHandleRef=function(node){_this.handle=node;};_this.handleMouseUp=function(){if(document.activeElement===_this.handle){_this.setClickFocus(true);}};_this.handleMouseDown=function(e){// avoid selecting text during drag
// https://github.com/ant-design/ant-design/issues/25010
e.preventDefault();// fix https://github.com/ant-design/ant-design/issues/15324
_this.focus();};_this.handleBlur=function(){_this.setClickFocus(false);};_this.handleKeyDown=function(){_this.setClickFocus(false);};return _this;}(0,_createClass2$2.default)(Handle,[{key:"componentDidMount",value:function componentDidMount(){// mouseup won't trigger if mouse moved out of handle,
// so we listen on document here.
this.onMouseUpListener=(0,_addEventListener$1.default)(document,'mouseup',this.handleMouseUp);}},{key:"componentWillUnmount",value:function componentWillUnmount(){if(this.onMouseUpListener){this.onMouseUpListener.remove();}}},{key:"setClickFocus",value:function setClickFocus(focused){this.setState({clickFocused:focused});}},{key:"clickFocus",value:function clickFocus(){this.setClickFocus(true);this.focus();}},{key:"focus",value:function focus(){this.handle.focus();}},{key:"blur",value:function blur(){this.handle.blur();}},{key:"render",value:function render(){var _ref,_ref2;var _this$props=this.props,prefixCls=_this$props.prefixCls,vertical=_this$props.vertical,reverse=_this$props.reverse,offset=_this$props.offset,style=_this$props.style,disabled=_this$props.disabled,min=_this$props.min,max=_this$props.max,value=_this$props.value,tabIndex=_this$props.tabIndex,ariaLabel=_this$props.ariaLabel,ariaLabelledBy=_this$props.ariaLabelledBy,ariaValueTextFormatter=_this$props.ariaValueTextFormatter,restProps=(0,_objectWithoutProperties2$1.default)(_this$props,_excluded$3);var className=(0,_classnames$1.default)(this.props.className,(0,_defineProperty2$1.default)({},"".concat(prefixCls,"-handle-click-focused"),this.state.clickFocused));var positionStyle=vertical?(_ref={},(0,_defineProperty2$1.default)(_ref,reverse?'top':'bottom',"".concat(offset,"%")),(0,_defineProperty2$1.default)(_ref,reverse?'bottom':'top','auto'),(0,_defineProperty2$1.default)(_ref,"transform",reverse?null:"translateY(+50%)"),_ref):(_ref2={},(0,_defineProperty2$1.default)(_ref2,reverse?'right':'left',"".concat(offset,"%")),(0,_defineProperty2$1.default)(_ref2,reverse?'left':'right','auto'),(0,_defineProperty2$1.default)(_ref2,"transform","translateX(".concat(reverse?'+':'-',"50%)")),_ref2);var elStyle=(0,_objectSpread2$3.default)((0,_objectSpread2$3.default)({},style),positionStyle);var mergedTabIndex=tabIndex||0;if(disabled||tabIndex===null){mergedTabIndex=null;}var ariaValueText;if(ariaValueTextFormatter){ariaValueText=ariaValueTextFormatter(value);}return/*#__PURE__*/_react$4.default.createElement("div",(0,_extends2$1.default)({ref:this.setHandleRef,tabIndex:mergedTabIndex},restProps,{className:className,style:elStyle,onBlur:this.handleBlur,onKeyDown:this.handleKeyDown,onMouseDown:this.handleMouseDown// aria attribute
,role:"slider","aria-valuemin":min,"aria-valuemax":max,"aria-valuenow":value,"aria-disabled":!!disabled,"aria-label":ariaLabel,"aria-labelledby":ariaLabelledBy,"aria-valuetext":ariaValueText}));}}]);return Handle;}(_react$4.default.Component);Handle$1.default=Handle;var utils$3={};var KeyCode$2={};Object.defineProperty(KeyCode$2,"__esModule",{value:true});KeyCode$2.default=void 0;/**
			 * @ignore
			 * some key-codes definition and utils from closure-library
			 * @author yiminghe@gmail.com
			 */var KeyCode$1={/**
			   * MAC_ENTER
			   */MAC_ENTER:3,/**
			   * BACKSPACE
			   */BACKSPACE:8,/**
			   * TAB
			   */TAB:9,/**
			   * NUMLOCK on FF/Safari Mac
			   */NUM_CENTER:12,/**
			   * ENTER
			   */ENTER:13,/**
			   * SHIFT
			   */SHIFT:16,/**
			   * CTRL
			   */CTRL:17,/**
			   * ALT
			   */ALT:18,/**
			   * PAUSE
			   */PAUSE:19,/**
			   * CAPS_LOCK
			   */CAPS_LOCK:20,/**
			   * ESC
			   */ESC:27,/**
			   * SPACE
			   */SPACE:32,/**
			   * PAGE_UP
			   */PAGE_UP:33,/**
			   * PAGE_DOWN
			   */PAGE_DOWN:34,/**
			   * END
			   */END:35,/**
			   * HOME
			   */HOME:36,/**
			   * LEFT
			   */LEFT:37,/**
			   * UP
			   */UP:38,/**
			   * RIGHT
			   */RIGHT:39,/**
			   * DOWN
			   */DOWN:40,/**
			   * PRINT_SCREEN
			   */PRINT_SCREEN:44,/**
			   * INSERT
			   */INSERT:45,/**
			   * DELETE
			   */DELETE:46,/**
			   * ZERO
			   */ZERO:48,/**
			   * ONE
			   */ONE:49,/**
			   * TWO
			   */TWO:50,/**
			   * THREE
			   */THREE:51,/**
			   * FOUR
			   */FOUR:52,/**
			   * FIVE
			   */FIVE:53,/**
			   * SIX
			   */SIX:54,/**
			   * SEVEN
			   */SEVEN:55,/**
			   * EIGHT
			   */EIGHT:56,/**
			   * NINE
			   */NINE:57,/**
			   * QUESTION_MARK
			   */QUESTION_MARK:63,/**
			   * A
			   */A:65,/**
			   * B
			   */B:66,/**
			   * C
			   */C:67,/**
			   * D
			   */D:68,/**
			   * E
			   */E:69,/**
			   * F
			   */F:70,/**
			   * G
			   */G:71,/**
			   * H
			   */H:72,/**
			   * I
			   */I:73,/**
			   * J
			   */J:74,/**
			   * K
			   */K:75,/**
			   * L
			   */L:76,/**
			   * M
			   */M:77,/**
			   * N
			   */N:78,/**
			   * O
			   */O:79,/**
			   * P
			   */P:80,/**
			   * Q
			   */Q:81,/**
			   * R
			   */R:82,/**
			   * S
			   */S:83,/**
			   * T
			   */T:84,/**
			   * U
			   */U:85,/**
			   * V
			   */V:86,/**
			   * W
			   */W:87,/**
			   * X
			   */X:88,/**
			   * Y
			   */Y:89,/**
			   * Z
			   */Z:90,/**
			   * META
			   */META:91,/**
			   * WIN_KEY_RIGHT
			   */WIN_KEY_RIGHT:92,/**
			   * CONTEXT_MENU
			   */CONTEXT_MENU:93,/**
			   * NUM_ZERO
			   */NUM_ZERO:96,/**
			   * NUM_ONE
			   */NUM_ONE:97,/**
			   * NUM_TWO
			   */NUM_TWO:98,/**
			   * NUM_THREE
			   */NUM_THREE:99,/**
			   * NUM_FOUR
			   */NUM_FOUR:100,/**
			   * NUM_FIVE
			   */NUM_FIVE:101,/**
			   * NUM_SIX
			   */NUM_SIX:102,/**
			   * NUM_SEVEN
			   */NUM_SEVEN:103,/**
			   * NUM_EIGHT
			   */NUM_EIGHT:104,/**
			   * NUM_NINE
			   */NUM_NINE:105,/**
			   * NUM_MULTIPLY
			   */NUM_MULTIPLY:106,/**
			   * NUM_PLUS
			   */NUM_PLUS:107,/**
			   * NUM_MINUS
			   */NUM_MINUS:109,/**
			   * NUM_PERIOD
			   */NUM_PERIOD:110,/**
			   * NUM_DIVISION
			   */NUM_DIVISION:111,/**
			   * F1
			   */F1:112,/**
			   * F2
			   */F2:113,/**
			   * F3
			   */F3:114,/**
			   * F4
			   */F4:115,/**
			   * F5
			   */F5:116,/**
			   * F6
			   */F6:117,/**
			   * F7
			   */F7:118,/**
			   * F8
			   */F8:119,/**
			   * F9
			   */F9:120,/**
			   * F10
			   */F10:121,/**
			   * F11
			   */F11:122,/**
			   * F12
			   */F12:123,/**
			   * NUMLOCK
			   */NUMLOCK:144,/**
			   * SEMICOLON
			   */SEMICOLON:186,/**
			   * DASH
			   */DASH:189,/**
			   * EQUALS
			   */EQUALS:187,/**
			   * COMMA
			   */COMMA:188,/**
			   * PERIOD
			   */PERIOD:190,/**
			   * SLASH
			   */SLASH:191,/**
			   * APOSTROPHE
			   */APOSTROPHE:192,/**
			   * SINGLE_QUOTE
			   */SINGLE_QUOTE:222,/**
			   * OPEN_SQUARE_BRACKET
			   */OPEN_SQUARE_BRACKET:219,/**
			   * BACKSLASH
			   */BACKSLASH:220,/**
			   * CLOSE_SQUARE_BRACKET
			   */CLOSE_SQUARE_BRACKET:221,/**
			   * WIN_KEY
			   */WIN_KEY:224,/**
			   * MAC_FF_META
			   */MAC_FF_META:224,/**
			   * WIN_IME
			   */WIN_IME:229,// ======================== Function ========================
/**
			   * whether text and modified key is entered at the same time.
			   */isTextModifyingKeyEvent:function isTextModifyingKeyEvent(e){var keyCode=e.keyCode;if(e.altKey&&!e.ctrlKey||e.metaKey||keyCode>=KeyCode$1.F1&&keyCode<=KeyCode$1.F12){return false;}// The following keys are quite harmless, even in combination with
// CTRL, ALT or SHIFT.
switch(keyCode){case KeyCode$1.ALT:case KeyCode$1.CAPS_LOCK:case KeyCode$1.CONTEXT_MENU:case KeyCode$1.CTRL:case KeyCode$1.DOWN:case KeyCode$1.END:case KeyCode$1.ESC:case KeyCode$1.HOME:case KeyCode$1.INSERT:case KeyCode$1.LEFT:case KeyCode$1.MAC_FF_META:case KeyCode$1.META:case KeyCode$1.NUMLOCK:case KeyCode$1.NUM_CENTER:case KeyCode$1.PAGE_DOWN:case KeyCode$1.PAGE_UP:case KeyCode$1.PAUSE:case KeyCode$1.PRINT_SCREEN:case KeyCode$1.RIGHT:case KeyCode$1.SHIFT:case KeyCode$1.UP:case KeyCode$1.WIN_KEY:case KeyCode$1.WIN_KEY_RIGHT:return false;default:return true;}},/**
			   * whether character is entered.
			   */isCharacterKey:function isCharacterKey(keyCode){if(keyCode>=KeyCode$1.ZERO&&keyCode<=KeyCode$1.NINE){return true;}if(keyCode>=KeyCode$1.NUM_ZERO&&keyCode<=KeyCode$1.NUM_MULTIPLY){return true;}if(keyCode>=KeyCode$1.A&&keyCode<=KeyCode$1.Z){return true;}// Safari sends zero key code for non-latin characters.
if(window.navigator.userAgent.indexOf('WebKit')!==-1&&keyCode===0){return true;}switch(keyCode){case KeyCode$1.SPACE:case KeyCode$1.QUESTION_MARK:case KeyCode$1.NUM_PLUS:case KeyCode$1.NUM_MINUS:case KeyCode$1.NUM_PERIOD:case KeyCode$1.NUM_DIVISION:case KeyCode$1.SEMICOLON:case KeyCode$1.DASH:case KeyCode$1.EQUALS:case KeyCode$1.COMMA:case KeyCode$1.PERIOD:case KeyCode$1.SLASH:case KeyCode$1.APOSTROPHE:case KeyCode$1.SINGLE_QUOTE:case KeyCode$1.OPEN_SQUARE_BRACKET:case KeyCode$1.BACKSLASH:case KeyCode$1.CLOSE_SQUARE_BRACKET:return true;default:return false;}}};var _default$D=KeyCode$1;KeyCode$2.default=_default$D;var _interopRequireDefault$v=interopRequireDefault$1.exports;Object.defineProperty(utils$3,"__esModule",{value:true});utils$3.calculateNextValue=calculateNextValue;utils$3.ensureValueInRange=ensureValueInRange;utils$3.ensureValuePrecision=ensureValuePrecision;utils$3.getClosestPoint=getClosestPoint;utils$3.getHandleCenterPosition=getHandleCenterPosition;utils$3.getKeyboardValueMutator=getKeyboardValueMutator;utils$3.getMousePosition=getMousePosition;utils$3.getPrecision=getPrecision;utils$3.getTouchPosition=getTouchPosition;utils$3.isEventFromHandle=isEventFromHandle;utils$3.isNotTouchEvent=isNotTouchEvent;utils$3.isValueOutOfRange=isValueOutOfRange;utils$3.pauseEvent=pauseEvent;var _toConsumableArray2$1=_interopRequireDefault$v(toConsumableArray.exports);var _reactDom$1=reactDom.exports;var _KeyCode=_interopRequireDefault$v(KeyCode$2);function isEventFromHandle(e,handles){try{return Object.keys(handles).some(function(key){return e.target===(0,_reactDom$1.findDOMNode)(handles[key]);});}catch(error){return false;}}function isValueOutOfRange(value,_ref){var min=_ref.min,max=_ref.max;return value<min||value>max;}function isNotTouchEvent(e){return e.touches.length>1||e.type.toLowerCase()==='touchend'&&e.touches.length>0;}function getClosestPoint(val,_ref2){var marks=_ref2.marks,step=_ref2.step,min=_ref2.min,max=_ref2.max;var points=Object.keys(marks).map(parseFloat);if(step!==null){var baseNum=Math.pow(10,getPrecision(step));var maxSteps=Math.floor((max*baseNum-min*baseNum)/(step*baseNum));var steps=Math.min((val-min)/step,maxSteps);var closestStep=Math.round(steps)*step+min;points.push(closestStep);}var diffs=points.map(function(point){return Math.abs(val-point);});return points[diffs.indexOf(Math.min.apply(Math,(0,_toConsumableArray2$1.default)(diffs)))];}function getPrecision(step){var stepString=step.toString();var precision=0;if(stepString.indexOf('.')>=0){precision=stepString.length-stepString.indexOf('.')-1;}return precision;}function getMousePosition(vertical,e){return vertical?e.clientY:e.pageX;}function getTouchPosition(vertical,e){return vertical?e.touches[0].clientY:e.touches[0].pageX;}function getHandleCenterPosition(vertical,handle){var coords=handle.getBoundingClientRect();return vertical?coords.top+coords.height*0.5:window.pageXOffset+coords.left+coords.width*0.5;}function ensureValueInRange(val,_ref3){var max=_ref3.max,min=_ref3.min;if(val<=min){return min;}if(val>=max){return max;}return val;}function ensureValuePrecision(val,props){var step=props.step;var closestPoint=isFinite(getClosestPoint(val,props))?getClosestPoint(val,props):0;// eslint-disable-line
return step===null?closestPoint:parseFloat(closestPoint.toFixed(getPrecision(step)));}function pauseEvent(e){e.stopPropagation();e.preventDefault();}function calculateNextValue(func,value,props){var operations={increase:function increase(a,b){return a+b;},decrease:function decrease(a,b){return a-b;}};var indexToGet=operations[func](Object.keys(props.marks).indexOf(JSON.stringify(value)),1);var keyToGet=Object.keys(props.marks)[indexToGet];if(props.step){return operations[func](value,props.step);}if(!!Object.keys(props.marks).length&&!!props.marks[keyToGet]){return props.marks[keyToGet];}return value;}function getKeyboardValueMutator(e,vertical,reverse){var increase='increase';var decrease='decrease';var method=increase;switch(e.keyCode){case _KeyCode.default.UP:method=vertical&&reverse?decrease:increase;break;case _KeyCode.default.RIGHT:method=!vertical&&reverse?decrease:increase;break;case _KeyCode.default.DOWN:method=vertical&&reverse?increase:decrease;break;case _KeyCode.default.LEFT:method=!vertical&&reverse?increase:decrease;break;case _KeyCode.default.END:return function(value,props){return props.max;};case _KeyCode.default.HOME:return function(value,props){return props.min;};case _KeyCode.default.PAGE_UP:return function(value,props){return value+props.step*2;};case _KeyCode.default.PAGE_DOWN:return function(value,props){return value-props.step*2;};default:return undefined;}return function(value,props){return calculateNextValue(method,value,props);};}var _interopRequireDefault$u=interopRequireDefault$1.exports;var _interopRequireWildcard$6=interopRequireWildcard.exports;Object.defineProperty(createSlider$1,"__esModule",{value:true});createSlider$1.default=createSlider;var _extends2=_interopRequireDefault$u(_extends$5.exports);var _objectWithoutProperties2=_interopRequireDefault$u(objectWithoutProperties.exports);var _objectSpread2$2=_interopRequireDefault$u(objectSpread2.exports);var _defineProperty2=_interopRequireDefault$u(defineProperty.exports);var _toConsumableArray2=_interopRequireDefault$u(toConsumableArray.exports);var _classCallCheck2$1=_interopRequireDefault$u(classCallCheck.exports);var _createClass2$1=_interopRequireDefault$u(createClass.exports);var _get2=_interopRequireDefault$u(get.exports);var _getPrototypeOf2=_interopRequireDefault$u(getPrototypeOf.exports);var _inherits2$1=_interopRequireDefault$u(inherits.exports);var _createSuper2$1=_interopRequireDefault$u(createSuper.exports);var _react$3=_interopRequireDefault$u(react.exports);var _addEventListener=_interopRequireDefault$u(addEventListener);var _classnames=_interopRequireDefault$u(classnames.exports);var _warning$1=_interopRequireDefault$u(warning$1);var _Steps=_interopRequireDefault$u(Steps$1);var _Marks=_interopRequireDefault$u(Marks$1);var _Handle=_interopRequireDefault$u(Handle$1);var utils$2=_interopRequireWildcard$6(utils$3);var _excluded$2=["index"];/* eslint-disable @typescript-eslint/no-explicit-any */function noop$1(){}function createSlider(Component){var _class,_temp;// eslint-disable-next-line @typescript-eslint/no-unused-vars
return _temp=_class=/*#__PURE__*/function(_Component){(0,_inherits2$1.default)(ComponentEnhancer,_Component);var _super=(0,_createSuper2$1.default)(ComponentEnhancer);function ComponentEnhancer(props){var _this;(0,_classCallCheck2$1.default)(this,ComponentEnhancer);_this=_super.call(this,props);_this.handlesRefs=void 0;_this.sliderRef=void 0;_this.document=void 0;_this.dragOffset=void 0;_this.prevMovedHandleIndex=void 0;_this.onTouchMoveListener=void 0;_this.onTouchUpListener=void 0;_this.onMouseMoveListener=void 0;_this.onMouseUpListener=void 0;_this.dragTrack=void 0;_this.startBounds=void 0;_this.onDown=function(e,position){var p=position;var _this$props=_this.props,draggableTrack=_this$props.draggableTrack,isVertical=_this$props.vertical;var bounds=_this.state.bounds;var value=draggableTrack&&_this.positionGetValue?_this.positionGetValue(p)||[]:[];var inPoint=utils$2.isEventFromHandle(e,_this.handlesRefs);_this.dragTrack=draggableTrack&&bounds.length>=2&&!inPoint&&!value.map(function(n,i){var v=!i?n>=bounds[i]:true;return i===value.length-1?n<=bounds[i]:v;}).some(function(c){return!c;});if(_this.dragTrack){_this.dragOffset=p;_this.startBounds=(0,_toConsumableArray2.default)(bounds);}else{if(!inPoint){_this.dragOffset=0;}else{var handlePosition=utils$2.getHandleCenterPosition(isVertical,e.target);_this.dragOffset=p-handlePosition;p=handlePosition;}_this.onStart(p);}};_this.onMouseDown=function(e){if(e.button!==0){return;}_this.removeDocumentEvents();var isVertical=_this.props.vertical;var position=utils$2.getMousePosition(isVertical,e);_this.onDown(e,position);_this.addDocumentMouseEvents();};_this.onTouchStart=function(e){if(utils$2.isNotTouchEvent(e))return;var isVertical=_this.props.vertical;var position=utils$2.getTouchPosition(isVertical,e);_this.onDown(e,position);_this.addDocumentTouchEvents();utils$2.pauseEvent(e);};_this.onFocus=function(e){var _this$props2=_this.props,onFocus=_this$props2.onFocus,vertical=_this$props2.vertical;if(utils$2.isEventFromHandle(e,_this.handlesRefs)&&!_this.dragTrack){var handlePosition=utils$2.getHandleCenterPosition(vertical,e.target);_this.dragOffset=0;_this.onStart(handlePosition);utils$2.pauseEvent(e);if(onFocus){onFocus(e);}}};_this.onBlur=function(e){var onBlur=_this.props.onBlur;if(!_this.dragTrack){_this.onEnd();}if(onBlur){onBlur(e);}};_this.onMouseUp=function(){if(_this.handlesRefs[_this.prevMovedHandleIndex]){_this.handlesRefs[_this.prevMovedHandleIndex].clickFocus();}};_this.onMouseMove=function(e){if(!_this.sliderRef){_this.onEnd();return;}var position=utils$2.getMousePosition(_this.props.vertical,e);_this.onMove(e,position-_this.dragOffset,_this.dragTrack,_this.startBounds);};_this.onTouchMove=function(e){if(utils$2.isNotTouchEvent(e)||!_this.sliderRef){_this.onEnd();return;}var position=utils$2.getTouchPosition(_this.props.vertical,e);_this.onMove(e,position-_this.dragOffset,_this.dragTrack,_this.startBounds);};_this.onKeyDown=function(e){if(_this.sliderRef&&utils$2.isEventFromHandle(e,_this.handlesRefs)){_this.onKeyboard(e);}};_this.onClickMarkLabel=function(e,value){e.stopPropagation();_this.onChange({value:value});// eslint-disable-next-line react/no-unused-state
_this.setState({value:value},function(){return _this.onEnd(true);});};_this.saveSlider=function(slider){_this.sliderRef=slider;};var step=props.step,max=props.max,min=props.min;var isPointDiffEven=isFinite(max-min)?(max-min)%step===0:true;// eslint-disable-line
(0,_warning$1.default)(step&&Math.floor(step)===step?isPointDiffEven:true,"Slider[max] - Slider[min] (".concat(max-min,") should be a multiple of Slider[step] (").concat(step,")"));_this.handlesRefs={};return _this;}(0,_createClass2$1.default)(ComponentEnhancer,[{key:"componentDidMount",value:function componentDidMount(){// Snapshot testing cannot handle refs, so be sure to null-check this.
this.document=this.sliderRef&&this.sliderRef.ownerDocument;var _this$props3=this.props,autoFocus=_this$props3.autoFocus,disabled=_this$props3.disabled;if(autoFocus&&!disabled){this.focus();}}},{key:"componentWillUnmount",value:function componentWillUnmount(){if((0,_get2.default)((0,_getPrototypeOf2.default)(ComponentEnhancer.prototype),"componentWillUnmount",this))(0,_get2.default)((0,_getPrototypeOf2.default)(ComponentEnhancer.prototype),"componentWillUnmount",this).call(this);this.removeDocumentEvents();}},{key:"getSliderStart",value:function getSliderStart(){var slider=this.sliderRef;var _this$props4=this.props,vertical=_this$props4.vertical,reverse=_this$props4.reverse;var rect=slider.getBoundingClientRect();if(vertical){return reverse?rect.bottom:rect.top;}return window.pageXOffset+(reverse?rect.right:rect.left);}},{key:"getSliderLength",value:function getSliderLength(){var slider=this.sliderRef;if(!slider){return 0;}var coords=slider.getBoundingClientRect();return this.props.vertical?coords.height:coords.width;}},{key:"addDocumentTouchEvents",value:function addDocumentTouchEvents(){// just work for Chrome iOS Safari and Android Browser
this.onTouchMoveListener=(0,_addEventListener.default)(this.document,'touchmove',this.onTouchMove);this.onTouchUpListener=(0,_addEventListener.default)(this.document,'touchend',this.onEnd);}},{key:"addDocumentMouseEvents",value:function addDocumentMouseEvents(){this.onMouseMoveListener=(0,_addEventListener.default)(this.document,'mousemove',this.onMouseMove);this.onMouseUpListener=(0,_addEventListener.default)(this.document,'mouseup',this.onEnd);}},{key:"removeDocumentEvents",value:function removeDocumentEvents(){/* eslint-disable @typescript-eslint/no-unused-expressions */this.onTouchMoveListener&&this.onTouchMoveListener.remove();this.onTouchUpListener&&this.onTouchUpListener.remove();this.onMouseMoveListener&&this.onMouseMoveListener.remove();this.onMouseUpListener&&this.onMouseUpListener.remove();/* eslint-enable no-unused-expressions */}},{key:"focus",value:function focus(){var _this$handlesRefs$;if(this.props.disabled){return;}(_this$handlesRefs$=this.handlesRefs[0])===null||_this$handlesRefs$===void 0?void 0:_this$handlesRefs$.focus();}},{key:"blur",value:function blur(){var _this2=this;if(this.props.disabled){return;}Object.keys(this.handlesRefs).forEach(function(key){var _this2$handlesRefs$ke,_this2$handlesRefs$ke2;(_this2$handlesRefs$ke=_this2.handlesRefs[key])===null||_this2$handlesRefs$ke===void 0?void 0:(_this2$handlesRefs$ke2=_this2$handlesRefs$ke.blur)===null||_this2$handlesRefs$ke2===void 0?void 0:_this2$handlesRefs$ke2.call(_this2$handlesRefs$ke);});}},{key:"calcValue",value:function calcValue(offset){var _this$props5=this.props,vertical=_this$props5.vertical,min=_this$props5.min,max=_this$props5.max;var ratio=Math.abs(Math.max(offset,0)/this.getSliderLength());var value=vertical?(1-ratio)*(max-min)+min:ratio*(max-min)+min;return value;}},{key:"calcValueByPos",value:function calcValueByPos(position){var sign=this.props.reverse?-1:+1;var pixelOffset=sign*(position-this.getSliderStart());var nextValue=this.trimAlignValue(this.calcValue(pixelOffset));return nextValue;}},{key:"calcOffset",value:function calcOffset(value){var _this$props6=this.props,min=_this$props6.min,max=_this$props6.max;var ratio=(value-min)/(max-min);return Math.max(0,ratio*100);}},{key:"saveHandle",value:function saveHandle(index,handle){this.handlesRefs[index]=handle;}},{key:"render",value:function render(){var _classNames;var _this$props7=this.props,prefixCls=_this$props7.prefixCls,className=_this$props7.className,marks=_this$props7.marks,dots=_this$props7.dots,step=_this$props7.step,included=_this$props7.included,disabled=_this$props7.disabled,vertical=_this$props7.vertical,reverse=_this$props7.reverse,min=_this$props7.min,max=_this$props7.max,children=_this$props7.children,maximumTrackStyle=_this$props7.maximumTrackStyle,style=_this$props7.style,railStyle=_this$props7.railStyle,dotStyle=_this$props7.dotStyle,activeDotStyle=_this$props7.activeDotStyle;var _get$call=(0,_get2.default)((0,_getPrototypeOf2.default)(ComponentEnhancer.prototype),"render",this).call(this),tracks=_get$call.tracks,handles=_get$call.handles;var sliderClassName=(0,_classnames.default)(prefixCls,(_classNames={},(0,_defineProperty2.default)(_classNames,"".concat(prefixCls,"-with-marks"),Object.keys(marks).length),(0,_defineProperty2.default)(_classNames,"".concat(prefixCls,"-disabled"),disabled),(0,_defineProperty2.default)(_classNames,"".concat(prefixCls,"-vertical"),vertical),(0,_defineProperty2.default)(_classNames,className,className),_classNames));return/*#__PURE__*/_react$3.default.createElement("div",{ref:this.saveSlider,className:sliderClassName,onTouchStart:disabled?noop$1:this.onTouchStart,onMouseDown:disabled?noop$1:this.onMouseDown,onMouseUp:disabled?noop$1:this.onMouseUp,onKeyDown:disabled?noop$1:this.onKeyDown,onFocus:disabled?noop$1:this.onFocus,onBlur:disabled?noop$1:this.onBlur,style:style},/*#__PURE__*/_react$3.default.createElement("div",{className:"".concat(prefixCls,"-rail"),style:(0,_objectSpread2$2.default)((0,_objectSpread2$2.default)({},maximumTrackStyle),railStyle)}),tracks,/*#__PURE__*/_react$3.default.createElement(_Steps.default,{prefixCls:prefixCls,vertical:vertical,reverse:reverse,marks:marks,dots:dots,step:step,included:included,lowerBound:this.getLowerBound(),upperBound:this.getUpperBound(),max:max,min:min,dotStyle:dotStyle,activeDotStyle:activeDotStyle}),handles,/*#__PURE__*/_react$3.default.createElement(_Marks.default,{className:"".concat(prefixCls,"-mark"),onClickLabel:disabled?noop$1:this.onClickMarkLabel,vertical:vertical,marks:marks,included:included,lowerBound:this.getLowerBound(),upperBound:this.getUpperBound(),max:max,min:min,reverse:reverse}),children);}}]);return ComponentEnhancer;}(Component),_class.displayName="ComponentEnhancer(".concat(Component.displayName,")"),_class.defaultProps=(0,_objectSpread2$2.default)((0,_objectSpread2$2.default)({},Component.defaultProps),{},{prefixCls:'rc-slider',className:'',min:0,max:100,step:1,marks:{},handle:function handle(props){var index=props.index,restProps=(0,_objectWithoutProperties2.default)(props,_excluded$2);delete restProps.dragging;if(restProps.value===null){return null;}return/*#__PURE__*/_react$3.default.createElement(_Handle.default,(0,_extends2.default)({},restProps,{key:index}));},onBeforeChange:noop$1,onChange:noop$1,onAfterChange:noop$1,included:true,disabled:false,dots:false,vertical:false,reverse:false,trackStyle:[{}],handleStyle:[{}],railStyle:{},dotStyle:{},activeDotStyle:{}}),_temp;}var _interopRequireWildcard$5=interopRequireWildcard.exports;var _interopRequireDefault$t=interopRequireDefault$1.exports;Object.defineProperty(Slider$1,"__esModule",{value:true});var default_1=Slider$1.default=void 0;var _objectSpread2$1=_interopRequireDefault$t(objectSpread2.exports);var _classCallCheck2=_interopRequireDefault$t(classCallCheck.exports);var _createClass2=_interopRequireDefault$t(createClass.exports);var _inherits2=_interopRequireDefault$t(inherits.exports);var _createSuper2=_interopRequireDefault$t(createSuper.exports);var _react$2=_interopRequireDefault$t(react.exports);var _warning=_interopRequireDefault$t(warning$1);var _Track=_interopRequireDefault$t(Track$1);var _createSlider=_interopRequireDefault$t(createSlider$1);var utils$1=_interopRequireWildcard$5(utils$3);var Slider=/*#__PURE__*/function(_React$Component){(0,_inherits2.default)(Slider,_React$Component);var _super=(0,_createSuper2.default)(Slider);/* eslint-enable */function Slider(props){var _this;(0,_classCallCheck2.default)(this,Slider);_this=_super.call(this,props);_this.positionGetValue=function(position){return[];};_this.startValue=void 0;_this.startPosition=void 0;_this.prevMovedHandleIndex=void 0;_this.onEnd=function(force){var dragging=_this.state.dragging;_this.removeDocumentEvents();if(dragging||force){_this.props.onAfterChange(_this.getValue());}_this.setState({dragging:false});};var defaultValue=props.defaultValue!==undefined?props.defaultValue:props.min;var value=props.value!==undefined?props.value:defaultValue;_this.state={value:_this.trimAlignValue(value),dragging:false};(0,_warning.default)(!('minimumTrackStyle'in props),'minimumTrackStyle will be deprecated, please use trackStyle instead.');(0,_warning.default)(!('maximumTrackStyle'in props),'maximumTrackStyle will be deprecated, please use railStyle instead.');return _this;}(0,_createClass2.default)(Slider,[{key:"calcValueByPos",value:/**
			     * [Legacy] Used for inherit other component.
			     * It's a bad code style which should be refactor.
			     */ /* eslint-disable @typescript-eslint/no-unused-vars, class-methods-use-this */function calcValueByPos(value){return 0;}},{key:"calcOffset",value:function calcOffset(value){return 0;}},{key:"saveHandle",value:function saveHandle(index,h){}},{key:"removeDocumentEvents",value:function removeDocumentEvents(){}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps,prevState){var _this$props=this.props,min=_this$props.min,max=_this$props.max,value=_this$props.value,onChange=_this$props.onChange;if(!('min'in this.props||'max'in this.props)){return;}var theValue=value!==undefined?value:prevState.value;var nextValue=this.trimAlignValue(theValue,this.props);if(nextValue===prevState.value){return;}// eslint-disable-next-line
this.setState({value:nextValue});if(!(min===prevProps.min&&max===prevProps.max)&&utils$1.isValueOutOfRange(theValue,this.props)){onChange(nextValue);}}},{key:"onChange",value:function onChange(state){var props=this.props;var isNotControlled=!('value'in props);var nextState=state.value>this.props.max?(0,_objectSpread2$1.default)((0,_objectSpread2$1.default)({},state),{},{value:this.props.max}):state;if(isNotControlled){this.setState(nextState);}var changedValue=nextState.value;props.onChange(changedValue);}},{key:"onStart",value:function onStart(position){this.setState({dragging:true});var props=this.props;var prevValue=this.getValue();props.onBeforeChange(prevValue);var value=this.calcValueByPos(position);this.startValue=value;this.startPosition=position;if(value===prevValue)return;this.prevMovedHandleIndex=0;this.onChange({value:value});}},{key:"onMove",value:function onMove(e,position){utils$1.pauseEvent(e);var oldValue=this.state.value;var value=this.calcValueByPos(position);if(value===oldValue)return;this.onChange({value:value});}},{key:"onKeyboard",value:function onKeyboard(e){var _this$props2=this.props,reverse=_this$props2.reverse,vertical=_this$props2.vertical;var valueMutator=utils$1.getKeyboardValueMutator(e,vertical,reverse);if(valueMutator){utils$1.pauseEvent(e);var state=this.state;var oldValue=state.value;var mutatedValue=valueMutator(oldValue,this.props);var value=this.trimAlignValue(mutatedValue);if(value===oldValue)return;this.onChange({value:value});this.props.onAfterChange(value);this.onEnd();}}},{key:"getValue",value:function getValue(){return this.state.value;}},{key:"getLowerBound",value:function getLowerBound(){var minPoint=this.props.startPoint||this.props.min;return this.state.value>minPoint?minPoint:this.state.value;}},{key:"getUpperBound",value:function getUpperBound(){if(this.state.value<this.props.startPoint){return this.props.startPoint;}return this.state.value;}},{key:"trimAlignValue",value:function trimAlignValue(v){var nextProps=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(v===null){return null;}var mergedProps=(0,_objectSpread2$1.default)((0,_objectSpread2$1.default)({},this.props),nextProps);var val=utils$1.ensureValueInRange(v,mergedProps);return utils$1.ensureValuePrecision(val,mergedProps);}},{key:"render",value:function render(){var _this2=this;var _this$props3=this.props,prefixCls=_this$props3.prefixCls,vertical=_this$props3.vertical,included=_this$props3.included,disabled=_this$props3.disabled,minimumTrackStyle=_this$props3.minimumTrackStyle,trackStyle=_this$props3.trackStyle,handleStyle=_this$props3.handleStyle,tabIndex=_this$props3.tabIndex,ariaLabelForHandle=_this$props3.ariaLabelForHandle,ariaLabelledByForHandle=_this$props3.ariaLabelledByForHandle,ariaValueTextFormatterForHandle=_this$props3.ariaValueTextFormatterForHandle,min=_this$props3.min,max=_this$props3.max,startPoint=_this$props3.startPoint,reverse=_this$props3.reverse,handleGenerator=_this$props3.handle;var _this$state=this.state,value=_this$state.value,dragging=_this$state.dragging;var offset=this.calcOffset(value);var handle=handleGenerator({className:"".concat(prefixCls,"-handle"),prefixCls:prefixCls,vertical:vertical,offset:offset,value:value,dragging:dragging,disabled:disabled,min:min,max:max,reverse:reverse,index:0,tabIndex:tabIndex,ariaLabel:ariaLabelForHandle,ariaLabelledBy:ariaLabelledByForHandle,ariaValueTextFormatter:ariaValueTextFormatterForHandle,style:handleStyle[0]||handleStyle,ref:function ref(h){return _this2.saveHandle(0,h);}});var trackOffset=startPoint!==undefined?this.calcOffset(startPoint):0;var mergedTrackStyle=trackStyle[0]||trackStyle;var track=/*#__PURE__*/_react$2.default.createElement(_Track.default,{className:"".concat(prefixCls,"-track"),vertical:vertical,included:included,offset:trackOffset,reverse:reverse,length:offset-trackOffset,style:(0,_objectSpread2$1.default)((0,_objectSpread2$1.default)({},minimumTrackStyle),mergedTrackStyle)});return{tracks:track,handles:handle};}}]);return Slider;}(_react$2.default.Component);var _default$C=(0,_createSlider.default)(Slider);default_1=Slider$1.default=_default$C;function _defineProperty$7(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _arrayWithHoles$2(arr){if(Array.isArray(arr))return arr;}function _iterableToArrayLimit$2(arr,i){var _i=arr==null?null:typeof Symbol!=="undefined"&&arr[Symbol.iterator]||arr["@@iterator"];if(_i==null)return;var _arr=[];var _n=true;var _d=false;var _s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"]!=null)_i["return"]();}finally{if(_d)throw _e;}}return _arr;}function _arrayLikeToArray$3(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function _unsupportedIterableToArray$3(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray$3(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray$3(o,minLen);}function _nonIterableRest$2(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _slicedToArray$2(arr,i){return _arrayWithHoles$2(arr)||_iterableToArrayLimit$2(arr,i)||_unsupportedIterableToArray$3(arr,i)||_nonIterableRest$2();}function _objectWithoutPropertiesLoose$3(source,excluded){if(source==null)return{};var target={};var sourceKeys=Object.keys(source);var key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(excluded.indexOf(key)>=0)continue;target[key]=source[key];}return target;}function _objectWithoutProperties$3(source,excluded){if(source==null)return{};var target=_objectWithoutPropertiesLoose$3(source,excluded);var key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];if(excluded.indexOf(key)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(source,key))continue;target[key]=source[key];}}return target;}function _arrayWithHoles$1(arr){if(Array.isArray(arr))return arr;}function _iterableToArrayLimit$1(arr,i){var _i=arr==null?null:typeof Symbol!=="undefined"&&arr[Symbol.iterator]||arr["@@iterator"];if(_i==null)return;var _arr=[];var _n=true;var _d=false;var _s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"]!=null)_i["return"]();}finally{if(_d)throw _e;}}return _arr;}function _arrayLikeToArray$2(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function _unsupportedIterableToArray$2(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray$2(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray$2(o,minLen);}function _nonIterableRest$1(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _slicedToArray$1(arr,i){return _arrayWithHoles$1(arr)||_iterableToArrayLimit$1(arr,i)||_unsupportedIterableToArray$2(arr,i)||_nonIterableRest$1();}function useControlledState(defaultStateValue,option){var _ref=option||{},defaultValue=_ref.defaultValue,value=_ref.value,onChange=_ref.onChange,postState=_ref.postState;var _React$useState=react.exports.useState(function(){if(value!==undefined){return value;}if(defaultValue!==undefined){return typeof defaultValue==='function'?defaultValue():defaultValue;}return typeof defaultStateValue==='function'?defaultStateValue():defaultStateValue;}),_React$useState2=_slicedToArray$1(_React$useState,2),innerValue=_React$useState2[0],setInnerValue=_React$useState2[1];var mergedValue=value!==undefined?value:innerValue;if(postState){mergedValue=postState(mergedValue);}function triggerChange(newValue){setInnerValue(newValue);if(mergedValue!==newValue&&onChange){onChange(newValue,mergedValue);}}// Effect of reset value to `undefined`
var firstRenderRef=react.exports.useRef(true);react.exports.useEffect(function(){if(firstRenderRef.current){firstRenderRef.current=false;return;}if(value===undefined){setInnerValue(value);}},[value]);return[mergedValue,triggerChange];}/**
			 * @ignore
			 * some key-codes definition and utils from closure-library
			 * @author yiminghe@gmail.com
			 */var KeyCode={/**
			   * MAC_ENTER
			   */MAC_ENTER:3,/**
			   * BACKSPACE
			   */BACKSPACE:8,/**
			   * TAB
			   */TAB:9,/**
			   * NUMLOCK on FF/Safari Mac
			   */NUM_CENTER:12,/**
			   * ENTER
			   */ENTER:13,/**
			   * SHIFT
			   */SHIFT:16,/**
			   * CTRL
			   */CTRL:17,/**
			   * ALT
			   */ALT:18,/**
			   * PAUSE
			   */PAUSE:19,/**
			   * CAPS_LOCK
			   */CAPS_LOCK:20,/**
			   * ESC
			   */ESC:27,/**
			   * SPACE
			   */SPACE:32,/**
			   * PAGE_UP
			   */PAGE_UP:33,/**
			   * PAGE_DOWN
			   */PAGE_DOWN:34,/**
			   * END
			   */END:35,/**
			   * HOME
			   */HOME:36,/**
			   * LEFT
			   */LEFT:37,/**
			   * UP
			   */UP:38,/**
			   * RIGHT
			   */RIGHT:39,/**
			   * DOWN
			   */DOWN:40,/**
			   * PRINT_SCREEN
			   */PRINT_SCREEN:44,/**
			   * INSERT
			   */INSERT:45,/**
			   * DELETE
			   */DELETE:46,/**
			   * ZERO
			   */ZERO:48,/**
			   * ONE
			   */ONE:49,/**
			   * TWO
			   */TWO:50,/**
			   * THREE
			   */THREE:51,/**
			   * FOUR
			   */FOUR:52,/**
			   * FIVE
			   */FIVE:53,/**
			   * SIX
			   */SIX:54,/**
			   * SEVEN
			   */SEVEN:55,/**
			   * EIGHT
			   */EIGHT:56,/**
			   * NINE
			   */NINE:57,/**
			   * QUESTION_MARK
			   */QUESTION_MARK:63,/**
			   * A
			   */A:65,/**
			   * B
			   */B:66,/**
			   * C
			   */C:67,/**
			   * D
			   */D:68,/**
			   * E
			   */E:69,/**
			   * F
			   */F:70,/**
			   * G
			   */G:71,/**
			   * H
			   */H:72,/**
			   * I
			   */I:73,/**
			   * J
			   */J:74,/**
			   * K
			   */K:75,/**
			   * L
			   */L:76,/**
			   * M
			   */M:77,/**
			   * N
			   */N:78,/**
			   * O
			   */O:79,/**
			   * P
			   */P:80,/**
			   * Q
			   */Q:81,/**
			   * R
			   */R:82,/**
			   * S
			   */S:83,/**
			   * T
			   */T:84,/**
			   * U
			   */U:85,/**
			   * V
			   */V:86,/**
			   * W
			   */W:87,/**
			   * X
			   */X:88,/**
			   * Y
			   */Y:89,/**
			   * Z
			   */Z:90,/**
			   * META
			   */META:91,/**
			   * WIN_KEY_RIGHT
			   */WIN_KEY_RIGHT:92,/**
			   * CONTEXT_MENU
			   */CONTEXT_MENU:93,/**
			   * NUM_ZERO
			   */NUM_ZERO:96,/**
			   * NUM_ONE
			   */NUM_ONE:97,/**
			   * NUM_TWO
			   */NUM_TWO:98,/**
			   * NUM_THREE
			   */NUM_THREE:99,/**
			   * NUM_FOUR
			   */NUM_FOUR:100,/**
			   * NUM_FIVE
			   */NUM_FIVE:101,/**
			   * NUM_SIX
			   */NUM_SIX:102,/**
			   * NUM_SEVEN
			   */NUM_SEVEN:103,/**
			   * NUM_EIGHT
			   */NUM_EIGHT:104,/**
			   * NUM_NINE
			   */NUM_NINE:105,/**
			   * NUM_MULTIPLY
			   */NUM_MULTIPLY:106,/**
			   * NUM_PLUS
			   */NUM_PLUS:107,/**
			   * NUM_MINUS
			   */NUM_MINUS:109,/**
			   * NUM_PERIOD
			   */NUM_PERIOD:110,/**
			   * NUM_DIVISION
			   */NUM_DIVISION:111,/**
			   * F1
			   */F1:112,/**
			   * F2
			   */F2:113,/**
			   * F3
			   */F3:114,/**
			   * F4
			   */F4:115,/**
			   * F5
			   */F5:116,/**
			   * F6
			   */F6:117,/**
			   * F7
			   */F7:118,/**
			   * F8
			   */F8:119,/**
			   * F9
			   */F9:120,/**
			   * F10
			   */F10:121,/**
			   * F11
			   */F11:122,/**
			   * F12
			   */F12:123,/**
			   * NUMLOCK
			   */NUMLOCK:144,/**
			   * SEMICOLON
			   */SEMICOLON:186,/**
			   * DASH
			   */DASH:189,/**
			   * EQUALS
			   */EQUALS:187,/**
			   * COMMA
			   */COMMA:188,/**
			   * PERIOD
			   */PERIOD:190,/**
			   * SLASH
			   */SLASH:191,/**
			   * APOSTROPHE
			   */APOSTROPHE:192,/**
			   * SINGLE_QUOTE
			   */SINGLE_QUOTE:222,/**
			   * OPEN_SQUARE_BRACKET
			   */OPEN_SQUARE_BRACKET:219,/**
			   * BACKSLASH
			   */BACKSLASH:220,/**
			   * CLOSE_SQUARE_BRACKET
			   */CLOSE_SQUARE_BRACKET:221,/**
			   * WIN_KEY
			   */WIN_KEY:224,/**
			   * MAC_FF_META
			   */MAC_FF_META:224,/**
			   * WIN_IME
			   */WIN_IME:229,// ======================== Function ========================
/**
			   * whether text and modified key is entered at the same time.
			   */isTextModifyingKeyEvent:function isTextModifyingKeyEvent(e){var keyCode=e.keyCode;if(e.altKey&&!e.ctrlKey||e.metaKey||keyCode>=KeyCode.F1&&keyCode<=KeyCode.F12){return false;}// The following keys are quite harmless, even in combination with
// CTRL, ALT or SHIFT.
switch(keyCode){case KeyCode.ALT:case KeyCode.CAPS_LOCK:case KeyCode.CONTEXT_MENU:case KeyCode.CTRL:case KeyCode.DOWN:case KeyCode.END:case KeyCode.ESC:case KeyCode.HOME:case KeyCode.INSERT:case KeyCode.LEFT:case KeyCode.MAC_FF_META:case KeyCode.META:case KeyCode.NUMLOCK:case KeyCode.NUM_CENTER:case KeyCode.PAGE_DOWN:case KeyCode.PAGE_UP:case KeyCode.PAUSE:case KeyCode.PRINT_SCREEN:case KeyCode.RIGHT:case KeyCode.SHIFT:case KeyCode.UP:case KeyCode.WIN_KEY:case KeyCode.WIN_KEY_RIGHT:return false;default:return true;}},/**
			   * whether character is entered.
			   */isCharacterKey:function isCharacterKey(keyCode){if(keyCode>=KeyCode.ZERO&&keyCode<=KeyCode.NINE){return true;}if(keyCode>=KeyCode.NUM_ZERO&&keyCode<=KeyCode.NUM_MULTIPLY){return true;}if(keyCode>=KeyCode.A&&keyCode<=KeyCode.Z){return true;}// Safari sends zero key code for non-latin characters.
if(window.navigator.userAgent.indexOf('WebKit')!==-1&&keyCode===0){return true;}switch(keyCode){case KeyCode.SPACE:case KeyCode.QUESTION_MARK:case KeyCode.NUM_PLUS:case KeyCode.NUM_MINUS:case KeyCode.NUM_PERIOD:case KeyCode.NUM_DIVISION:case KeyCode.SEMICOLON:case KeyCode.DASH:case KeyCode.EQUALS:case KeyCode.COMMA:case KeyCode.PERIOD:case KeyCode.SLASH:case KeyCode.APOSTROPHE:case KeyCode.SINGLE_QUOTE:case KeyCode.OPEN_SQUARE_BRACKET:case KeyCode.BACKSLASH:case KeyCode.CLOSE_SQUARE_BRACKET:return true;default:return false;}}};var Switch=react.exports.forwardRef(function(_ref,ref){var _classNames;var _ref$prefixCls=_ref.prefixCls,prefixCls=_ref$prefixCls===void 0?'rc-switch':_ref$prefixCls,className=_ref.className,checked=_ref.checked,defaultChecked=_ref.defaultChecked,disabled=_ref.disabled,loadingIcon=_ref.loadingIcon,checkedChildren=_ref.checkedChildren,unCheckedChildren=_ref.unCheckedChildren,onClick=_ref.onClick,onChange=_ref.onChange,onKeyDown=_ref.onKeyDown,restProps=_objectWithoutProperties$3(_ref,["prefixCls","className","checked","defaultChecked","disabled","loadingIcon","checkedChildren","unCheckedChildren","onClick","onChange","onKeyDown"]);var _useMergedState=useControlledState(false,{value:checked,defaultValue:defaultChecked}),_useMergedState2=_slicedToArray$2(_useMergedState,2),innerChecked=_useMergedState2[0],setInnerChecked=_useMergedState2[1];function triggerChange(newChecked,event){var mergedChecked=innerChecked;if(!disabled){mergedChecked=newChecked;setInnerChecked(mergedChecked);onChange===null||onChange===void 0?void 0:onChange(mergedChecked,event);}return mergedChecked;}function onInternalKeyDown(e){if(e.which===KeyCode.LEFT){triggerChange(false,e);}else if(e.which===KeyCode.RIGHT){triggerChange(true,e);}onKeyDown===null||onKeyDown===void 0?void 0:onKeyDown(e);}function onInternalClick(e){var ret=triggerChange(!innerChecked,e);// [Legacy] trigger onClick with value
onClick===null||onClick===void 0?void 0:onClick(ret,e);}var switchClassName=cls(prefixCls,className,(_classNames={},_defineProperty$7(_classNames,"".concat(prefixCls,"-checked"),innerChecked),_defineProperty$7(_classNames,"".concat(prefixCls,"-disabled"),disabled),_classNames));return react.exports.createElement("button",Object.assign({},restProps,{type:"button",role:"switch","aria-checked":innerChecked,disabled:disabled,className:switchClassName,ref:ref,onKeyDown:onInternalKeyDown,onClick:onInternalClick}),loadingIcon,react.exports.createElement("span",{className:"".concat(prefixCls,"-inner")},innerChecked?checkedChildren:unCheckedChildren));});Switch.displayName='Switch';var cjs={exports:{}};var Draggable$2={};var require$$3=/*@__PURE__*/getAugmentedNamespace(clsx_m);var domFns={};var shims={};Object.defineProperty(shims,"__esModule",{value:true});shims.findInArray=findInArray;shims.isFunction=isFunction$1;shims.isNum=isNum;shims.int=int;shims.dontSetMe=dontSetMe;// @credits https://gist.github.com/rogozhnikoff/a43cfed27c41e4e68cdc
function findInArray(array/*: Array<any> | TouchList*/,callback/*: Function*/)/*: any*/{for(var i=0,length=array.length;i<length;i++){if(callback.apply(callback,[array[i],i,array]))return array[i];}}function isFunction$1(func/*: any*/)/*: boolean %checks*/{// $FlowIgnore[method-unbinding]
return typeof func==='function'||Object.prototype.toString.call(func)==='[object Function]';}function isNum(num/*: any*/)/*: boolean %checks*/{return typeof num==='number'&&!isNaN(num);}function int(a/*: string*/)/*: number*/{return parseInt(a,10);}function dontSetMe(props/*: Object*/,propName/*: string*/,componentName/*: string*/)/*: ?Error*/{if(props[propName]){return new Error("Invalid prop ".concat(propName," passed to ").concat(componentName," - do not set this, set it on the child."));}}var getPrefix$1={};Object.defineProperty(getPrefix$1,"__esModule",{value:true});getPrefix$1.getPrefix=getPrefix;getPrefix$1.browserPrefixToKey=browserPrefixToKey;getPrefix$1.browserPrefixToStyle=browserPrefixToStyle;getPrefix$1.default=void 0;var prefixes=['Moz','Webkit','O','ms'];function getPrefix()/*: string*/{var _window$document,_window$document$docu;var prop/*: string*/=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'transform';// Ensure we're running in an environment where there is actually a global
// `window` obj
if(typeof window==='undefined')return'';// If we're in a pseudo-browser server-side environment, this access
// path may not exist, so bail out if it doesn't.
var style=(_window$document=window.document)===null||_window$document===void 0?void 0:(_window$document$docu=_window$document.documentElement)===null||_window$document$docu===void 0?void 0:_window$document$docu.style;if(!style)return'';if(prop in style)return'';for(var i=0;i<prefixes.length;i++){if(browserPrefixToKey(prop,prefixes[i])in style)return prefixes[i];}return'';}function browserPrefixToKey(prop/*: string*/,prefix/*: string*/)/*: string*/{return prefix?"".concat(prefix).concat(kebabToTitleCase(prop)):prop;}function browserPrefixToStyle(prop/*: string*/,prefix/*: string*/)/*: string*/{return prefix?"-".concat(prefix.toLowerCase(),"-").concat(prop):prop;}function kebabToTitleCase(str/*: string*/)/*: string*/{var out='';var shouldCapitalize=true;for(var i=0;i<str.length;i++){if(shouldCapitalize){out+=str[i].toUpperCase();shouldCapitalize=false;}else if(str[i]==='-'){shouldCapitalize=true;}else{out+=str[i];}}return out;}// Default export is the prefix itself, like 'Moz', 'Webkit', etc
// Note that you may have to re-test for certain things; for instance, Chrome 50
// can handle unprefixed `transform`, but not unprefixed `user-select`
var _default$B=getPrefix()/*: string*/;getPrefix$1.default=_default$B;function _typeof$5(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof$5=function _typeof(obj){return typeof obj;};}else{_typeof$5=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};}return _typeof$5(obj);}Object.defineProperty(domFns,"__esModule",{value:true});domFns.matchesSelector=matchesSelector;domFns.matchesSelectorAndParentsTo=matchesSelectorAndParentsTo;domFns.addEvent=addEvent;domFns.removeEvent=removeEvent;domFns.outerHeight=outerHeight;domFns.outerWidth=outerWidth;domFns.innerHeight=innerHeight;domFns.innerWidth=innerWidth;domFns.offsetXYFromParent=offsetXYFromParent;domFns.createCSSTransform=createCSSTransform;domFns.createSVGTransform=createSVGTransform;domFns.getTranslation=getTranslation;domFns.getTouch=getTouch;domFns.getTouchIdentifier=getTouchIdentifier;domFns.addUserSelectStyles=addUserSelectStyles;domFns.removeUserSelectStyles=removeUserSelectStyles;domFns.addClassName=addClassName;domFns.removeClassName=removeClassName;var _shims$2=shims;var _getPrefix=_interopRequireWildcard$4(getPrefix$1);function _getRequireWildcardCache$4(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap();var cacheNodeInterop=new WeakMap();return(_getRequireWildcardCache$4=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard$4(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj;}if(obj===null||_typeof$5(obj)!=="object"&&typeof obj!=="function"){return{default:obj};}var cache=_getRequireWildcardCache$4(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj.default=obj;if(cache){cache.set(obj,newObj);}return newObj;}function ownKeys$3(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});}keys.push.apply(keys,symbols);}return keys;}function _objectSpread$2(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys$3(Object(source),true).forEach(function(key){_defineProperty$6(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys$3(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _defineProperty$6(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}var matchesSelectorFunc='';function matchesSelector(el/*: Node*/,selector/*: string*/)/*: boolean*/{if(!matchesSelectorFunc){matchesSelectorFunc=(0,_shims$2.findInArray)(['matches','webkitMatchesSelector','mozMatchesSelector','msMatchesSelector','oMatchesSelector'],function(method){// $FlowIgnore: Doesn't think elements are indexable
return(0,_shims$2.isFunction)(el[method]);});}// Might not be found entirely (not an Element?) - in that case, bail
// $FlowIgnore: Doesn't think elements are indexable
if(!(0,_shims$2.isFunction)(el[matchesSelectorFunc]))return false;// $FlowIgnore: Doesn't think elements are indexable
return el[matchesSelectorFunc](selector);}// Works up the tree to the draggable itself attempting to match selector.
function matchesSelectorAndParentsTo(el/*: Node*/,selector/*: string*/,baseNode/*: Node*/)/*: boolean*/{var node=el;do{if(matchesSelector(node,selector))return true;if(node===baseNode)return false;node=node.parentNode;}while(node);return false;}function addEvent(el/*: ?Node*/,event/*: string*/,handler/*: Function*/,inputOptions/*: Object*/)/*: void*/{if(!el)return;var options=_objectSpread$2({capture:true},inputOptions);// $FlowIgnore[method-unbinding]
if(el.addEventListener){el.addEventListener(event,handler,options);}else if(el.attachEvent){el.attachEvent('on'+event,handler);}else{// $FlowIgnore: Doesn't think elements are indexable
el['on'+event]=handler;}}function removeEvent(el/*: ?Node*/,event/*: string*/,handler/*: Function*/,inputOptions/*: Object*/)/*: void*/{if(!el)return;var options=_objectSpread$2({capture:true},inputOptions);// $FlowIgnore[method-unbinding]
if(el.removeEventListener){el.removeEventListener(event,handler,options);}else if(el.detachEvent){el.detachEvent('on'+event,handler);}else{// $FlowIgnore: Doesn't think elements are indexable
el['on'+event]=null;}}function outerHeight(node/*: HTMLElement*/)/*: number*/{// This is deliberately excluding margin for our calculations, since we are using
// offsetTop which is including margin. See getBoundPosition
var height=node.clientHeight;var computedStyle=node.ownerDocument.defaultView.getComputedStyle(node);height+=(0,_shims$2.int)(computedStyle.borderTopWidth);height+=(0,_shims$2.int)(computedStyle.borderBottomWidth);return height;}function outerWidth(node/*: HTMLElement*/)/*: number*/{// This is deliberately excluding margin for our calculations, since we are using
// offsetLeft which is including margin. See getBoundPosition
var width=node.clientWidth;var computedStyle=node.ownerDocument.defaultView.getComputedStyle(node);width+=(0,_shims$2.int)(computedStyle.borderLeftWidth);width+=(0,_shims$2.int)(computedStyle.borderRightWidth);return width;}function innerHeight(node/*: HTMLElement*/)/*: number*/{var height=node.clientHeight;var computedStyle=node.ownerDocument.defaultView.getComputedStyle(node);height-=(0,_shims$2.int)(computedStyle.paddingTop);height-=(0,_shims$2.int)(computedStyle.paddingBottom);return height;}function innerWidth(node/*: HTMLElement*/)/*: number*/{var width=node.clientWidth;var computedStyle=node.ownerDocument.defaultView.getComputedStyle(node);width-=(0,_shims$2.int)(computedStyle.paddingLeft);width-=(0,_shims$2.int)(computedStyle.paddingRight);return width;}/*:: interface EventWithOffset {
			  clientX: number, clientY: number
			}*/ // Get from offsetParent
function offsetXYFromParent(evt/*: EventWithOffset*/,offsetParent/*: HTMLElement*/,scale/*: number*/)/*: ControlPosition*/{var isBody=offsetParent===offsetParent.ownerDocument.body;var offsetParentRect=isBody?{left:0,top:0}:offsetParent.getBoundingClientRect();var x=(evt.clientX+offsetParent.scrollLeft-offsetParentRect.left)/scale;var y=(evt.clientY+offsetParent.scrollTop-offsetParentRect.top)/scale;return{x:x,y:y};}function createCSSTransform(controlPos/*: ControlPosition*/,positionOffset/*: PositionOffsetControlPosition*/)/*: Object*/{var translation=getTranslation(controlPos,positionOffset,'px');return _defineProperty$6({},(0,_getPrefix.browserPrefixToKey)('transform',_getPrefix.default),translation);}function createSVGTransform(controlPos/*: ControlPosition*/,positionOffset/*: PositionOffsetControlPosition*/)/*: string*/{var translation=getTranslation(controlPos,positionOffset,'');return translation;}function getTranslation(_ref2,positionOffset/*: PositionOffsetControlPosition*/,unitSuffix/*: string*/)/*: string*/{var x=_ref2.x,y=_ref2.y;var translation="translate(".concat(x).concat(unitSuffix,",").concat(y).concat(unitSuffix,")");if(positionOffset){var defaultX="".concat(typeof positionOffset.x==='string'?positionOffset.x:positionOffset.x+unitSuffix);var defaultY="".concat(typeof positionOffset.y==='string'?positionOffset.y:positionOffset.y+unitSuffix);translation="translate(".concat(defaultX,", ").concat(defaultY,")")+translation;}return translation;}function getTouch(e/*: MouseTouchEvent*/,identifier/*: number*/)/*: ?{clientX: number, clientY: number}*/{return e.targetTouches&&(0,_shims$2.findInArray)(e.targetTouches,function(t){return identifier===t.identifier;})||e.changedTouches&&(0,_shims$2.findInArray)(e.changedTouches,function(t){return identifier===t.identifier;});}function getTouchIdentifier(e/*: MouseTouchEvent*/)/*: ?number*/{if(e.targetTouches&&e.targetTouches[0])return e.targetTouches[0].identifier;if(e.changedTouches&&e.changedTouches[0])return e.changedTouches[0].identifier;}// User-select Hacks:
//
// Useful for preventing blue highlights all over everything when dragging.
// Note we're passing `document` b/c we could be iframed
function addUserSelectStyles(doc/*: ?Document*/){if(!doc)return;var styleEl=doc.getElementById('react-draggable-style-el');if(!styleEl){styleEl=doc.createElement('style');styleEl.type='text/css';styleEl.id='react-draggable-style-el';styleEl.innerHTML='.react-draggable-transparent-selection *::-moz-selection {all: inherit;}\n';styleEl.innerHTML+='.react-draggable-transparent-selection *::selection {all: inherit;}\n';doc.getElementsByTagName('head')[0].appendChild(styleEl);}if(doc.body)addClassName(doc.body,'react-draggable-transparent-selection');}function removeUserSelectStyles(doc/*: ?Document*/){if(!doc)return;try{if(doc.body)removeClassName(doc.body,'react-draggable-transparent-selection');// $FlowIgnore: IE
if(doc.selection){// $FlowIgnore: IE
doc.selection.empty();}else{// Remove selection caused by scroll, unless it's a focused input
// (we use doc.defaultView in case we're in an iframe)
var selection=(doc.defaultView||window).getSelection();if(selection&&selection.type!=='Caret'){selection.removeAllRanges();}}}catch(e){// probably IE
}}function addClassName(el/*: HTMLElement*/,className/*: string*/){if(el.classList){el.classList.add(className);}else{if(!el.className.match(new RegExp("(?:^|\\s)".concat(className,"(?!\\S)")))){el.className+=" ".concat(className);}}}function removeClassName(el/*: HTMLElement*/,className/*: string*/){if(el.classList){el.classList.remove(className);}else{el.className=el.className.replace(new RegExp("(?:^|\\s)".concat(className,"(?!\\S)"),'g'),'');}}var positionFns={};Object.defineProperty(positionFns,"__esModule",{value:true});positionFns.getBoundPosition=getBoundPosition;positionFns.snapToGrid=snapToGrid;positionFns.canDragX=canDragX;positionFns.canDragY=canDragY;positionFns.getControlPosition=getControlPosition;positionFns.createCoreData=createCoreData;positionFns.createDraggableData=createDraggableData;var _shims$1=shims;var _domFns$1=domFns;function getBoundPosition(draggable/*: Draggable*/,x/*: number*/,y/*: number*/)/*: [number, number]*/{// If no bounds, short-circuit and move on
if(!draggable.props.bounds)return[x,y];// Clone new bounds
var bounds=draggable.props.bounds;bounds=typeof bounds==='string'?bounds:cloneBounds(bounds);var node=findDOMNode(draggable);if(typeof bounds==='string'){var ownerDocument=node.ownerDocument;var ownerWindow=ownerDocument.defaultView;var boundNode;if(bounds==='parent'){boundNode=node.parentNode;}else{boundNode=ownerDocument.querySelector(bounds);}if(!(boundNode instanceof ownerWindow.HTMLElement)){throw new Error('Bounds selector "'+bounds+'" could not find an element.');}var boundNodeEl/*: HTMLElement*/=boundNode;// for Flow, can't seem to refine correctly
var nodeStyle=ownerWindow.getComputedStyle(node);var boundNodeStyle=ownerWindow.getComputedStyle(boundNodeEl);// Compute bounds. This is a pain with padding and offsets but this gets it exactly right.
bounds={left:-node.offsetLeft+(0,_shims$1.int)(boundNodeStyle.paddingLeft)+(0,_shims$1.int)(nodeStyle.marginLeft),top:-node.offsetTop+(0,_shims$1.int)(boundNodeStyle.paddingTop)+(0,_shims$1.int)(nodeStyle.marginTop),right:(0,_domFns$1.innerWidth)(boundNodeEl)-(0,_domFns$1.outerWidth)(node)-node.offsetLeft+(0,_shims$1.int)(boundNodeStyle.paddingRight)-(0,_shims$1.int)(nodeStyle.marginRight),bottom:(0,_domFns$1.innerHeight)(boundNodeEl)-(0,_domFns$1.outerHeight)(node)-node.offsetTop+(0,_shims$1.int)(boundNodeStyle.paddingBottom)-(0,_shims$1.int)(nodeStyle.marginBottom)};}// Keep x and y below right and bottom limits...
if((0,_shims$1.isNum)(bounds.right))x=Math.min(x,bounds.right);if((0,_shims$1.isNum)(bounds.bottom))y=Math.min(y,bounds.bottom);// But above left and top limits.
if((0,_shims$1.isNum)(bounds.left))x=Math.max(x,bounds.left);if((0,_shims$1.isNum)(bounds.top))y=Math.max(y,bounds.top);return[x,y];}function snapToGrid(grid/*: [number, number]*/,pendingX/*: number*/,pendingY/*: number*/)/*: [number, number]*/{var x=Math.round(pendingX/grid[0])*grid[0];var y=Math.round(pendingY/grid[1])*grid[1];return[x,y];}function canDragX(draggable/*: Draggable*/)/*: boolean*/{return draggable.props.axis==='both'||draggable.props.axis==='x';}function canDragY(draggable/*: Draggable*/)/*: boolean*/{return draggable.props.axis==='both'||draggable.props.axis==='y';}// Get {x, y} positions from event.
function getControlPosition(e/*: MouseTouchEvent*/,touchIdentifier/*: ?number*/,draggableCore/*: DraggableCore*/)/*: ?ControlPosition*/{var touchObj=typeof touchIdentifier==='number'?(0,_domFns$1.getTouch)(e,touchIdentifier):null;if(typeof touchIdentifier==='number'&&!touchObj)return null;// not the right touch
var node=findDOMNode(draggableCore);// User can provide an offsetParent if desired.
var offsetParent=draggableCore.props.offsetParent||node.offsetParent||node.ownerDocument.body;return(0,_domFns$1.offsetXYFromParent)(touchObj||e,offsetParent,draggableCore.props.scale);}// Create an data object exposed by <DraggableCore>'s events
function createCoreData(draggable/*: DraggableCore*/,x/*: number*/,y/*: number*/)/*: DraggableData*/{var state=draggable.state;var isStart=!(0,_shims$1.isNum)(state.lastX);var node=findDOMNode(draggable);if(isStart){// If this is our first move, use the x and y as last coords.
return{node:node,deltaX:0,deltaY:0,lastX:x,lastY:y,x:x,y:y};}else{// Otherwise calculate proper values.
return{node:node,deltaX:x-state.lastX,deltaY:y-state.lastY,lastX:state.lastX,lastY:state.lastY,x:x,y:y};}}// Create an data exposed by <Draggable>'s events
function createDraggableData(draggable/*: Draggable*/,coreData/*: DraggableData*/)/*: DraggableData*/{var scale=draggable.props.scale;return{node:coreData.node,x:draggable.state.x+coreData.deltaX/scale,y:draggable.state.y+coreData.deltaY/scale,deltaX:coreData.deltaX/scale,deltaY:coreData.deltaY/scale,lastX:draggable.state.x,lastY:draggable.state.y};}// A lot faster than stringify/parse
function cloneBounds(bounds/*: Bounds*/)/*: Bounds*/{return{left:bounds.left,top:bounds.top,right:bounds.right,bottom:bounds.bottom};}function findDOMNode(draggable/*: Draggable | DraggableCore*/)/*: HTMLElement*/{var node=draggable.findDOMNode();if(!node){throw new Error('<DraggableCore>: Unmounted during event!');}// $FlowIgnore we can't assert on HTMLElement due to tests... FIXME
return node;}var DraggableCore$2={};var log$1={};Object.defineProperty(log$1,"__esModule",{value:true});log$1.default=log;/*eslint no-console:0*/function log(){}function _typeof$4(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof$4=function _typeof(obj){return typeof obj;};}else{_typeof$4=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};}return _typeof$4(obj);}Object.defineProperty(DraggableCore$2,"__esModule",{value:true});DraggableCore$2.default=void 0;var React=_interopRequireWildcard$3(react.exports);var _propTypes$2=_interopRequireDefault$s(propTypes$1.exports);var _reactDom=_interopRequireDefault$s(reactDom.exports);var _domFns=domFns;var _positionFns=positionFns;var _shims=shims;var _log=_interopRequireDefault$s(log$1);function _interopRequireDefault$s(obj){return obj&&obj.__esModule?obj:{default:obj};}function _getRequireWildcardCache$3(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap();var cacheNodeInterop=new WeakMap();return(_getRequireWildcardCache$3=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard$3(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj;}if(obj===null||_typeof$4(obj)!=="object"&&typeof obj!=="function"){return{default:obj};}var cache=_getRequireWildcardCache$3(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj.default=obj;if(cache){cache.set(obj,newObj);}return newObj;}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray$1(arr,i)||_nonIterableRest();}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _unsupportedIterableToArray$1(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray$1(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray$1(o,minLen);}function _arrayLikeToArray$1(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function _iterableToArrayLimit(arr,i){var _i=arr==null?null:typeof Symbol!=="undefined"&&arr[Symbol.iterator]||arr["@@iterator"];if(_i==null)return;var _arr=[];var _n=true;var _d=false;var _s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"]!=null)_i["return"]();}finally{if(_d)throw _e;}}return _arr;}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr;}function _classCallCheck$5(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties$4(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass$5(Constructor,protoProps,staticProps){if(protoProps)_defineProperties$4(Constructor.prototype,protoProps);if(staticProps)_defineProperties$4(Constructor,staticProps);return Constructor;}function _inherits$4(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function");}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf$3(subClass,superClass);}function _setPrototypeOf$3(o,p){_setPrototypeOf$3=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf$3(o,p);}function _createSuper$3(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct$3();return function _createSuperInternal(){var Super=_getPrototypeOf$3(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf$3(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn$4(this,result);};}function _possibleConstructorReturn$4(self,call){if(call&&(_typeof$4(call)==="object"||typeof call==="function")){return call;}else if(call!==void 0){throw new TypeError("Derived constructors may only return object or undefined");}return _assertThisInitialized$3(self);}function _assertThisInitialized$3(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function _isNativeReflectConstruct$3(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}function _getPrototypeOf$3(o){_getPrototypeOf$3=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf$3(o);}function _defineProperty$5(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}// Simple abstraction for dragging events names.
var eventsFor={touch:{start:'touchstart',move:'touchmove',stop:'touchend'},mouse:{start:'mousedown',move:'mousemove',stop:'mouseup'}};// Default to mouse events.
var dragEventFor=eventsFor.mouse;/*:: type DraggableCoreState = {
			  dragging: boolean,
			  lastX: number,
			  lastY: number,
			  touchIdentifier: ?number
			};*/ /*:: export type DraggableData = {
			  node: HTMLElement,
			  x: number, y: number,
			  deltaX: number, deltaY: number,
			  lastX: number, lastY: number,
			};*/ /*:: export type DraggableEventHandler = (e: MouseEvent, data: DraggableData) => void | false;*/ /*:: export type ControlPosition = {x: number, y: number};*/ /*:: export type PositionOffsetControlPosition = {x: number|string, y: number|string};*/ /*:: export type DraggableCoreDefaultProps = {
			  allowAnyClick: boolean,
			  disabled: boolean,
			  enableUserSelectHack: boolean,
			  onStart: DraggableEventHandler,
			  onDrag: DraggableEventHandler,
			  onStop: DraggableEventHandler,
			  onMouseDown: (e: MouseEvent) => void,
			  scale: number,
			};*/ /*:: export type DraggableCoreProps = {
			  ...DraggableCoreDefaultProps,
			  cancel: string,
			  children: ReactElement<any>,
			  offsetParent: HTMLElement,
			  grid: [number, number],
			  handle: string,
			  nodeRef?: ?React.ElementRef<any>,
			};*/ //
// Define <DraggableCore>.
//
// <DraggableCore> is for advanced usage of <Draggable>. It maintains minimal internal state so it can
// work well with libraries that require more control over the element.
//
var DraggableCore$1=/*#__PURE__*/function(_React$Component){_inherits$4(DraggableCore,_React$Component);var _super=_createSuper$3(DraggableCore);function DraggableCore(){var _this;_classCallCheck$5(this,DraggableCore);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_defineProperty$5(_assertThisInitialized$3(_this),"state",{dragging:false,// Used while dragging to determine deltas.
lastX:NaN,lastY:NaN,touchIdentifier:null});_defineProperty$5(_assertThisInitialized$3(_this),"mounted",false);_defineProperty$5(_assertThisInitialized$3(_this),"handleDragStart",function(e){// Make it possible to attach event handlers on top of this one.
_this.props.onMouseDown(e);// Only accept left-clicks.
if(!_this.props.allowAnyClick&&typeof e.button==='number'&&e.button!==0)return false;// Get nodes. Be sure to grab relative document (could be iframed)
var thisNode=_this.findDOMNode();if(!thisNode||!thisNode.ownerDocument||!thisNode.ownerDocument.body){throw new Error('<DraggableCore> not mounted on DragStart!');}var ownerDocument=thisNode.ownerDocument;// Short circuit if handle or cancel prop was provided and selector doesn't match.
if(_this.props.disabled||!(e.target instanceof ownerDocument.defaultView.Node)||_this.props.handle&&!(0,_domFns.matchesSelectorAndParentsTo)(e.target,_this.props.handle,thisNode)||_this.props.cancel&&(0,_domFns.matchesSelectorAndParentsTo)(e.target,_this.props.cancel,thisNode)){return;}// Prevent scrolling on mobile devices, like ipad/iphone.
// Important that this is after handle/cancel.
if(e.type==='touchstart')e.preventDefault();// Set touch identifier in component state if this is a touch event. This allows us to
// distinguish between individual touches on multitouch screens by identifying which
// touchpoint was set to this element.
var touchIdentifier=(0,_domFns.getTouchIdentifier)(e);_this.setState({touchIdentifier:touchIdentifier});// Get the current drag point from the event. This is used as the offset.
var position=(0,_positionFns.getControlPosition)(e,touchIdentifier,_assertThisInitialized$3(_this));if(position==null)return;// not possible but satisfies flow
var x=position.x,y=position.y;// Create an event object with all the data parents need to make a decision here.
var coreEvent=(0,_positionFns.createCoreData)(_assertThisInitialized$3(_this),x,y);(0,_log.default)('DraggableCore: handleDragStart: %j',coreEvent);// Call event handler. If it returns explicit false, cancel.
(0,_log.default)('calling',_this.props.onStart);var shouldUpdate=_this.props.onStart(e,coreEvent);if(shouldUpdate===false||_this.mounted===false)return;// Add a style to the body to disable user-select. This prevents text from
// being selected all over the page.
if(_this.props.enableUserSelectHack)(0,_domFns.addUserSelectStyles)(ownerDocument);// Initiate dragging. Set the current x and y as offsets
// so we know how much we've moved during the drag. This allows us
// to drag elements around even if they have been moved, without issue.
_this.setState({dragging:true,lastX:x,lastY:y});// Add events to the document directly so we catch when the user's mouse/touch moves outside of
// this element. We use different events depending on whether or not we have detected that this
// is a touch-capable device.
(0,_domFns.addEvent)(ownerDocument,dragEventFor.move,_this.handleDrag);(0,_domFns.addEvent)(ownerDocument,dragEventFor.stop,_this.handleDragStop);});_defineProperty$5(_assertThisInitialized$3(_this),"handleDrag",function(e){// Get the current drag point from the event. This is used as the offset.
var position=(0,_positionFns.getControlPosition)(e,_this.state.touchIdentifier,_assertThisInitialized$3(_this));if(position==null)return;var x=position.x,y=position.y;// Snap to grid if prop has been provided
if(Array.isArray(_this.props.grid)){var deltaX=x-_this.state.lastX,deltaY=y-_this.state.lastY;var _snapToGrid=(0,_positionFns.snapToGrid)(_this.props.grid,deltaX,deltaY);var _snapToGrid2=_slicedToArray(_snapToGrid,2);deltaX=_snapToGrid2[0];deltaY=_snapToGrid2[1];if(!deltaX&&!deltaY)return;// skip useless drag
x=_this.state.lastX+deltaX,y=_this.state.lastY+deltaY;}var coreEvent=(0,_positionFns.createCoreData)(_assertThisInitialized$3(_this),x,y);(0,_log.default)('DraggableCore: handleDrag: %j',coreEvent);// Call event handler. If it returns explicit false, trigger end.
var shouldUpdate=_this.props.onDrag(e,coreEvent);if(shouldUpdate===false||_this.mounted===false){try{// $FlowIgnore
_this.handleDragStop(new MouseEvent('mouseup'));}catch(err){// Old browsers
var event=document.createEvent('MouseEvents')/*: any*/ /*: MouseTouchEvent*/;// I see why this insanity was deprecated
// $FlowIgnore
event.initMouseEvent('mouseup',true,true,window,0,0,0,0,0,false,false,false,false,0,null);_this.handleDragStop(event);}return;}_this.setState({lastX:x,lastY:y});});_defineProperty$5(_assertThisInitialized$3(_this),"handleDragStop",function(e){if(!_this.state.dragging)return;var position=(0,_positionFns.getControlPosition)(e,_this.state.touchIdentifier,_assertThisInitialized$3(_this));if(position==null)return;var x=position.x,y=position.y;var coreEvent=(0,_positionFns.createCoreData)(_assertThisInitialized$3(_this),x,y);// Call event handler
var shouldContinue=_this.props.onStop(e,coreEvent);if(shouldContinue===false||_this.mounted===false)return false;var thisNode=_this.findDOMNode();if(thisNode){// Remove user-select hack
if(_this.props.enableUserSelectHack)(0,_domFns.removeUserSelectStyles)(thisNode.ownerDocument);}(0,_log.default)('DraggableCore: handleDragStop: %j',coreEvent);// Reset the el.
_this.setState({dragging:false,lastX:NaN,lastY:NaN});if(thisNode){// Remove event handlers
(0,_log.default)('DraggableCore: Removing handlers');(0,_domFns.removeEvent)(thisNode.ownerDocument,dragEventFor.move,_this.handleDrag);(0,_domFns.removeEvent)(thisNode.ownerDocument,dragEventFor.stop,_this.handleDragStop);}});_defineProperty$5(_assertThisInitialized$3(_this),"onMouseDown",function(e){dragEventFor=eventsFor.mouse;// on touchscreen laptops we could switch back to mouse
return _this.handleDragStart(e);});_defineProperty$5(_assertThisInitialized$3(_this),"onMouseUp",function(e){dragEventFor=eventsFor.mouse;return _this.handleDragStop(e);});_defineProperty$5(_assertThisInitialized$3(_this),"onTouchStart",function(e){// We're on a touch device now, so change the event handlers
dragEventFor=eventsFor.touch;return _this.handleDragStart(e);});_defineProperty$5(_assertThisInitialized$3(_this),"onTouchEnd",function(e){// We're on a touch device now, so change the event handlers
dragEventFor=eventsFor.touch;return _this.handleDragStop(e);});return _this;}_createClass$5(DraggableCore,[{key:"componentDidMount",value:function componentDidMount(){this.mounted=true;// Touch handlers must be added with {passive: false} to be cancelable.
// https://developers.google.com/web/updates/2017/01/scrolling-intervention
var thisNode=this.findDOMNode();if(thisNode){(0,_domFns.addEvent)(thisNode,eventsFor.touch.start,this.onTouchStart,{passive:false});}}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.mounted=false;// Remove any leftover event handlers. Remove both touch and mouse handlers in case
// some browser quirk caused a touch event to fire during a mouse move, or vice versa.
var thisNode=this.findDOMNode();if(thisNode){var ownerDocument=thisNode.ownerDocument;(0,_domFns.removeEvent)(ownerDocument,eventsFor.mouse.move,this.handleDrag);(0,_domFns.removeEvent)(ownerDocument,eventsFor.touch.move,this.handleDrag);(0,_domFns.removeEvent)(ownerDocument,eventsFor.mouse.stop,this.handleDragStop);(0,_domFns.removeEvent)(ownerDocument,eventsFor.touch.stop,this.handleDragStop);(0,_domFns.removeEvent)(thisNode,eventsFor.touch.start,this.onTouchStart,{passive:false});if(this.props.enableUserSelectHack)(0,_domFns.removeUserSelectStyles)(ownerDocument);}}// React Strict Mode compatibility: if `nodeRef` is passed, we will use it instead of trying to find
// the underlying DOM node ourselves. See the README for more information.
},{key:"findDOMNode",value:function findDOMNode()/*: ?HTMLElement*/{var _this$props$nodeRef$c,_this$props,_this$props$nodeRef;return(_this$props$nodeRef$c=(_this$props=this.props)===null||_this$props===void 0?void 0:(_this$props$nodeRef=_this$props.nodeRef)===null||_this$props$nodeRef===void 0?void 0:_this$props$nodeRef.current)!==null&&_this$props$nodeRef$c!==void 0?_this$props$nodeRef$c:_reactDom.default.findDOMNode(this);}},{key:"render",value:function render()/*: React.Element<any>*/{// Reuse the child provided
// This makes it flexible to use whatever element is wanted (div, ul, etc)
return/*#__PURE__*/React.cloneElement(React.Children.only(this.props.children),{// Note: mouseMove handler is attached to document so it will still function
// when the user drags quickly and leaves the bounds of the element.
onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,// onTouchStart is added on `componentDidMount` so they can be added with
// {passive: false}, which allows it to cancel. See
// https://developers.google.com/web/updates/2017/01/scrolling-intervention
onTouchEnd:this.onTouchEnd});}}]);return DraggableCore;}(React.Component);DraggableCore$2.default=DraggableCore$1;_defineProperty$5(DraggableCore$1,"displayName",'DraggableCore');_defineProperty$5(DraggableCore$1,"propTypes",{/**
			   * `allowAnyClick` allows dragging using any mouse button.
			   * By default, we only accept the left button.
			   *
			   * Defaults to `false`.
			   */allowAnyClick:_propTypes$2.default.bool,/**
			   * `disabled`, if true, stops the <Draggable> from dragging. All handlers,
			   * with the exception of `onMouseDown`, will not fire.
			   */disabled:_propTypes$2.default.bool,/**
			   * By default, we add 'user-select:none' attributes to the document body
			   * to prevent ugly text selection during drag. If this is causing problems
			   * for your app, set this to `false`.
			   */enableUserSelectHack:_propTypes$2.default.bool,/**
			   * `offsetParent`, if set, uses the passed DOM node to compute drag offsets
			   * instead of using the parent node.
			   */offsetParent:function offsetParent(props/*: DraggableCoreProps*/,propName/*: $Keys<DraggableCoreProps>*/){if(props[propName]&&props[propName].nodeType!==1){throw new Error('Draggable\'s offsetParent must be a DOM Node.');}},/**
			   * `grid` specifies the x and y that dragging should snap to.
			   */grid:_propTypes$2.default.arrayOf(_propTypes$2.default.number),/**
			   * `handle` specifies a selector to be used as the handle that initiates drag.
			   *
			   * Example:
			   *
			   * ```jsx
			   *   let App = React.createClass({
			   *       render: function () {
			   *         return (
			   *            <Draggable handle=".handle">
			   *              <div>
			   *                  <div className="handle">Click me to drag</div>
			   *                  <div>This is some other content</div>
			   *              </div>
			   *           </Draggable>
			   *         );
			   *       }
			   *   });
			   * ```
			   */handle:_propTypes$2.default.string,/**
			   * `cancel` specifies a selector to be used to prevent drag initialization.
			   *
			   * Example:
			   *
			   * ```jsx
			   *   let App = React.createClass({
			   *       render: function () {
			   *           return(
			   *               <Draggable cancel=".cancel">
			   *                   <div>
			   *                     <div className="cancel">You can't drag from here</div>
			   *                     <div>Dragging here works fine</div>
			   *                   </div>
			   *               </Draggable>
			   *           );
			   *       }
			   *   });
			   * ```
			   */cancel:_propTypes$2.default.string,/* If running in React Strict mode, ReactDOM.findDOMNode() is deprecated.
			   * Unfortunately, in order for <Draggable> to work properly, we need raw access
			   * to the underlying DOM node. If you want to avoid the warning, pass a `nodeRef`
			   * as in this example:
			   *
			   * function MyComponent() {
			   *   const nodeRef = React.useRef(null);
			   *   return (
			   *     <Draggable nodeRef={nodeRef}>
			   *       <div ref={nodeRef}>Example Target</div>
			   *     </Draggable>
			   *   );
			   * }
			   *
			   * This can be used for arbitrarily nested components, so long as the ref ends up
			   * pointing to the actual child DOM node and not a custom component.
			   */nodeRef:_propTypes$2.default.object,/**
			   * Called when dragging starts.
			   * If this function returns the boolean false, dragging will be canceled.
			   */onStart:_propTypes$2.default.func,/**
			   * Called while dragging.
			   * If this function returns the boolean false, dragging will be canceled.
			   */onDrag:_propTypes$2.default.func,/**
			   * Called when dragging stops.
			   * If this function returns the boolean false, the drag will remain active.
			   */onStop:_propTypes$2.default.func,/**
			   * A workaround option which can be passed if onMouseDown needs to be accessed,
			   * since it'll always be blocked (as there is internal use of onMouseDown)
			   */onMouseDown:_propTypes$2.default.func,/**
			   * `scale`, if set, applies scaling while dragging an element
			   */scale:_propTypes$2.default.number,/**
			   * These properties should be defined on the child, not here.
			   */className:_shims.dontSetMe,style:_shims.dontSetMe,transform:_shims.dontSetMe});_defineProperty$5(DraggableCore$1,"defaultProps",{allowAnyClick:false,// by default only accept left click
disabled:false,enableUserSelectHack:true,onStart:function onStart(){},onDrag:function onDrag(){},onStop:function onStop(){},onMouseDown:function onMouseDown(){},scale:1});(function(exports){function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj;};}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};}return _typeof(obj);}Object.defineProperty(exports,"__esModule",{value:true});Object.defineProperty(exports,"DraggableCore",{enumerable:true,get:function get(){return _DraggableCore.default;}});exports.default=void 0;var React=_interopRequireWildcard(react.exports);var _propTypes=_interopRequireDefault(propTypes$1.exports);var _reactDom=_interopRequireDefault(reactDom.exports);var _clsx2=_interopRequireDefault(require$$3);var _domFns=domFns;var _positionFns=positionFns;var _shims=shims;var _DraggableCore=_interopRequireDefault(DraggableCore$2);var _log=_interopRequireDefault(log$1);var _excluded=["axis","bounds","children","defaultPosition","defaultClassName","defaultClassNameDragging","defaultClassNameDragged","position","positionOffset","scale"];function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap();var cacheNodeInterop=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj;}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{default:obj};}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj.default=obj;if(cache){cache.set(obj,newObj);}return newObj;}function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};return _extends.apply(this,arguments);}function _objectWithoutProperties(source,excluded){if(source==null)return{};var target=_objectWithoutPropertiesLoose(source,excluded);var key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];if(excluded.indexOf(key)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(source,key))continue;target[key]=source[key];}}return target;}function _objectWithoutPropertiesLoose(source,excluded){if(source==null)return{};var target={};var sourceKeys=Object.keys(source);var key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(excluded.indexOf(key)>=0)continue;target[key]=source[key];}return target;}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});}keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest();}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function _iterableToArrayLimit(arr,i){var _i=arr==null?null:typeof Symbol!=="undefined"&&arr[Symbol.iterator]||arr["@@iterator"];if(_i==null)return;var _arr=[];var _n=true;var _d=false;var _s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"]!=null)_i["return"]();}finally{if(_d)throw _e;}}return _arr;}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr;}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function");}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call;}else if(call!==void 0){throw new TypeError("Derived constructors may only return object or undefined");}return _assertThisInitialized(self);}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf(o);}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}//
// Define <Draggable>
//
var Draggable=/*#__PURE__*/function(_React$Component){_inherits(Draggable,_React$Component);var _super=_createSuper(Draggable);function Draggable(props/*: DraggableProps*/){var _this;_classCallCheck(this,Draggable);_this=_super.call(this,props);_defineProperty(_assertThisInitialized(_this),"onDragStart",function(e,coreData){(0,_log.default)('Draggable: onDragStart: %j',coreData);// Short-circuit if user's callback killed it.
var shouldStart=_this.props.onStart(e,(0,_positionFns.createDraggableData)(_assertThisInitialized(_this),coreData));// Kills start event on core as well, so move handlers are never bound.
if(shouldStart===false)return false;_this.setState({dragging:true,dragged:true});});_defineProperty(_assertThisInitialized(_this),"onDrag",function(e,coreData){if(!_this.state.dragging)return false;(0,_log.default)('Draggable: onDrag: %j',coreData);var uiData=(0,_positionFns.createDraggableData)(_assertThisInitialized(_this),coreData);var newState/*: $Shape<DraggableState>*/={x:uiData.x,y:uiData.y};// Keep within bounds.
if(_this.props.bounds){// Save original x and y.
var x=newState.x,y=newState.y;// Add slack to the values used to calculate bound position. This will ensure that if
// we start removing slack, the element won't react to it right away until it's been
// completely removed.
newState.x+=_this.state.slackX;newState.y+=_this.state.slackY;// Get bound position. This will ceil/floor the x and y within the boundaries.
var _getBoundPosition=(0,_positionFns.getBoundPosition)(_assertThisInitialized(_this),newState.x,newState.y),_getBoundPosition2=_slicedToArray(_getBoundPosition,2),newStateX=_getBoundPosition2[0],newStateY=_getBoundPosition2[1];newState.x=newStateX;newState.y=newStateY;// Recalculate slack by noting how much was shaved by the boundPosition handler.
newState.slackX=_this.state.slackX+(x-newState.x);newState.slackY=_this.state.slackY+(y-newState.y);// Update the event we fire to reflect what really happened after bounds took effect.
uiData.x=newState.x;uiData.y=newState.y;uiData.deltaX=newState.x-_this.state.x;uiData.deltaY=newState.y-_this.state.y;}// Short-circuit if user's callback killed it.
var shouldUpdate=_this.props.onDrag(e,uiData);if(shouldUpdate===false)return false;_this.setState(newState);});_defineProperty(_assertThisInitialized(_this),"onDragStop",function(e,coreData){if(!_this.state.dragging)return false;// Short-circuit if user's callback killed it.
var shouldContinue=_this.props.onStop(e,(0,_positionFns.createDraggableData)(_assertThisInitialized(_this),coreData));if(shouldContinue===false)return false;(0,_log.default)('Draggable: onDragStop: %j',coreData);var newState/*: $Shape<DraggableState>*/={dragging:false,slackX:0,slackY:0};// If this is a controlled component, the result of this operation will be to
// revert back to the old position. We expect a handler on `onDragStop`, at the least.
var controlled=Boolean(_this.props.position);if(controlled){var _this$props$position=_this.props.position,x=_this$props$position.x,y=_this$props$position.y;newState.x=x;newState.y=y;}_this.setState(newState);});_this.state={// Whether or not we are currently dragging.
dragging:false,// Whether or not we have been dragged before.
dragged:false,// Current transform x and y.
x:props.position?props.position.x:props.defaultPosition.x,y:props.position?props.position.y:props.defaultPosition.y,prevPropsPosition:_objectSpread({},props.position),// Used for compensating for out-of-bounds drags
slackX:0,slackY:0,// Can only determine if SVG after mounting
isElementSVG:false};if(props.position&&!(props.onDrag||props.onStop)){// eslint-disable-next-line no-console
console.warn('A `position` was applied to this <Draggable>, without drag handlers. This will make this '+'component effectively undraggable. Please attach `onDrag` or `onStop` handlers so you can adjust the '+'`position` of this element.');}return _this;}_createClass(Draggable,[{key:"componentDidMount",value:function componentDidMount(){// Check to see if the element passed is an instanceof SVGElement
if(typeof window.SVGElement!=='undefined'&&this.findDOMNode()instanceof window.SVGElement){this.setState({isElementSVG:true});}}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.setState({dragging:false});// prevents invariant if unmounted while dragging
}// React Strict Mode compatibility: if `nodeRef` is passed, we will use it instead of trying to find
// the underlying DOM node ourselves. See the README for more information.
},{key:"findDOMNode",value:function findDOMNode()/*: ?HTMLElement*/{var _this$props$nodeRef$c,_this$props,_this$props$nodeRef;return(_this$props$nodeRef$c=(_this$props=this.props)===null||_this$props===void 0?void 0:(_this$props$nodeRef=_this$props.nodeRef)===null||_this$props$nodeRef===void 0?void 0:_this$props$nodeRef.current)!==null&&_this$props$nodeRef$c!==void 0?_this$props$nodeRef$c:_reactDom.default.findDOMNode(this);}},{key:"render",value:function render()/*: ReactElement<any>*/{var _clsx;var _this$props2=this.props;_this$props2.axis;_this$props2.bounds;var children=_this$props2.children,defaultPosition=_this$props2.defaultPosition,defaultClassName=_this$props2.defaultClassName,defaultClassNameDragging=_this$props2.defaultClassNameDragging,defaultClassNameDragged=_this$props2.defaultClassNameDragged,position=_this$props2.position,positionOffset=_this$props2.positionOffset;_this$props2.scale;var draggableCoreProps=_objectWithoutProperties(_this$props2,_excluded);var style={};var svgTransform=null;// If this is controlled, we don't want to move it - unless it's dragging.
var controlled=Boolean(position);var draggable=!controlled||this.state.dragging;var validPosition=position||defaultPosition;var transformOpts={// Set left if horizontal drag is enabled
x:(0,_positionFns.canDragX)(this)&&draggable?this.state.x:validPosition.x,// Set top if vertical drag is enabled
y:(0,_positionFns.canDragY)(this)&&draggable?this.state.y:validPosition.y};// If this element was SVG, we use the `transform` attribute.
if(this.state.isElementSVG){svgTransform=(0,_domFns.createSVGTransform)(transformOpts,positionOffset);}else{// Add a CSS transform to move the element around. This allows us to move the element around
// without worrying about whether or not it is relatively or absolutely positioned.
// If the item you are dragging already has a transform set, wrap it in a <span> so <Draggable>
// has a clean slate.
style=(0,_domFns.createCSSTransform)(transformOpts,positionOffset);}// Mark with class while dragging
var className=(0,_clsx2.default)(children.props.className||'',defaultClassName,(_clsx={},_defineProperty(_clsx,defaultClassNameDragging,this.state.dragging),_defineProperty(_clsx,defaultClassNameDragged,this.state.dragged),_clsx));// Reuse the child provided
// This makes it flexible to use whatever element is wanted (div, ul, etc)
return/*#__PURE__*/React.createElement(_DraggableCore.default,_extends({},draggableCoreProps,{onStart:this.onDragStart,onDrag:this.onDrag,onStop:this.onDragStop}),/*#__PURE__*/React.cloneElement(React.Children.only(children),{className:className,style:_objectSpread(_objectSpread({},children.props.style),style),transform:svgTransform}));}}],[{key:"getDerivedStateFromProps",value:// React 16.3+
// Arity (props, state)
function getDerivedStateFromProps(_ref,_ref2)/*: ?$Shape<DraggableState>*/{var position=_ref.position;var prevPropsPosition=_ref2.prevPropsPosition;// Set x/y if a new position is provided in props that is different than the previous.
if(position&&(!prevPropsPosition||position.x!==prevPropsPosition.x||position.y!==prevPropsPosition.y)){(0,_log.default)('Draggable: getDerivedStateFromProps %j',{position:position,prevPropsPosition:prevPropsPosition});return{x:position.x,y:position.y,prevPropsPosition:_objectSpread({},position)};}return null;}}]);return Draggable;}(React.Component);exports.default=Draggable;_defineProperty(Draggable,"displayName",'Draggable');_defineProperty(Draggable,"propTypes",_objectSpread(_objectSpread({},_DraggableCore.default.propTypes),{},{/**
			   * `axis` determines which axis the draggable can move.
			   *
			   *  Note that all callbacks will still return data as normal. This only
			   *  controls flushing to the DOM.
			   *
			   * 'both' allows movement horizontally and vertically.
			   * 'x' limits movement to horizontal axis.
			   * 'y' limits movement to vertical axis.
			   * 'none' limits all movement.
			   *
			   * Defaults to 'both'.
			   */axis:_propTypes.default.oneOf(['both','x','y','none']),/**
			   * `bounds` determines the range of movement available to the element.
			   * Available values are:
			   *
			   * 'parent' restricts movement within the Draggable's parent node.
			   *
			   * Alternatively, pass an object with the following properties, all of which are optional:
			   *
			   * {left: LEFT_BOUND, right: RIGHT_BOUND, bottom: BOTTOM_BOUND, top: TOP_BOUND}
			   *
			   * All values are in px.
			   *
			   * Example:
			   *
			   * ```jsx
			   *   let App = React.createClass({
			   *       render: function () {
			   *         return (
			   *            <Draggable bounds={{right: 300, bottom: 300}}>
			   *              <div>Content</div>
			   *           </Draggable>
			   *         );
			   *       }
			   *   });
			   * ```
			   */bounds:_propTypes.default.oneOfType([_propTypes.default.shape({left:_propTypes.default.number,right:_propTypes.default.number,top:_propTypes.default.number,bottom:_propTypes.default.number}),_propTypes.default.string,_propTypes.default.oneOf([false])]),defaultClassName:_propTypes.default.string,defaultClassNameDragging:_propTypes.default.string,defaultClassNameDragged:_propTypes.default.string,/**
			   * `defaultPosition` specifies the x and y that the dragged item should start at
			   *
			   * Example:
			   *
			   * ```jsx
			   *      let App = React.createClass({
			   *          render: function () {
			   *              return (
			   *                  <Draggable defaultPosition={{x: 25, y: 25}}>
			   *                      <div>I start with transformX: 25px and transformY: 25px;</div>
			   *                  </Draggable>
			   *              );
			   *          }
			   *      });
			   * ```
			   */defaultPosition:_propTypes.default.shape({x:_propTypes.default.number,y:_propTypes.default.number}),positionOffset:_propTypes.default.shape({x:_propTypes.default.oneOfType([_propTypes.default.number,_propTypes.default.string]),y:_propTypes.default.oneOfType([_propTypes.default.number,_propTypes.default.string])}),/**
			   * `position`, if present, defines the current position of the element.
			   *
			   *  This is similar to how form elements in React work - if no `position` is supplied, the component
			   *  is uncontrolled.
			   *
			   * Example:
			   *
			   * ```jsx
			   *      let App = React.createClass({
			   *          render: function () {
			   *              return (
			   *                  <Draggable position={{x: 25, y: 25}}>
			   *                      <div>I start with transformX: 25px and transformY: 25px;</div>
			   *                  </Draggable>
			   *              );
			   *          }
			   *      });
			   * ```
			   */position:_propTypes.default.shape({x:_propTypes.default.number,y:_propTypes.default.number}),/**
			   * These properties should be defined on the child, not here.
			   */className:_shims.dontSetMe,style:_shims.dontSetMe,transform:_shims.dontSetMe}));_defineProperty(Draggable,"defaultProps",_objectSpread(_objectSpread({},_DraggableCore.default.defaultProps),{},{axis:'both',bounds:false,defaultClassName:'react-draggable',defaultClassNameDragging:'react-draggable-dragging',defaultClassNameDragged:'react-draggable-dragged',defaultPosition:{x:0,y:0},scale:1}));})(Draggable$2);var _require=Draggable$2,Draggable=_require.default,DraggableCore=_require.DraggableCore;// Previous versions of this lib exported <Draggable> as the root export. As to no-// them, or TypeScript, we export *both* as the root and as 'default'.
// See https://github.com/mzabriskie/react-draggable/pull/254
// and https://github.com/mzabriskie/react-draggable/issues/266
cjs.exports=Draggable;cjs.exports.default=Draggable;cjs.exports.DraggableCore=DraggableCore;var Draggable$1=cjs.exports;/**!
			 * Sortable 1.14.0
			 * @author	RubaXa   <trash@rubaxa.org>
			 * @author	owenm    <owen23355@gmail.com>
			 * @license MIT
			 */function ownKeys$2(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});}keys.push.apply(keys,symbols);}return keys;}function _objectSpread2(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys$2(Object(source),true).forEach(function(key){_defineProperty$4(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys$2(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _typeof$3(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof$3=function _typeof$3(obj){return typeof obj;};}else{_typeof$3=function _typeof$3(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};}return _typeof$3(obj);}function _defineProperty$4(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _extends$4(){_extends$4=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};return _extends$4.apply(this,arguments);}function _objectWithoutPropertiesLoose$2(source,excluded){if(source==null)return{};var target={};var sourceKeys=Object.keys(source);var key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(excluded.indexOf(key)>=0)continue;target[key]=source[key];}return target;}function _objectWithoutProperties$2(source,excluded){if(source==null)return{};var target=_objectWithoutPropertiesLoose$2(source,excluded);var key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];if(excluded.indexOf(key)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(source,key))continue;target[key]=source[key];}}return target;}var version="1.14.0";function userAgent$1(pattern){if(typeof window!=='undefined'&&window.navigator){return!!/*@__PURE__*/navigator.userAgent.match(pattern);}}var IE11OrLess=userAgent$1(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i);var Edge=userAgent$1(/Edge/i);var FireFox=userAgent$1(/firefox/i);var Safari=userAgent$1(/safari/i)&&!userAgent$1(/chrome/i)&&!userAgent$1(/android/i);var IOS=userAgent$1(/iP(ad|od|hone)/i);var ChromeForAndroid=userAgent$1(/chrome/i)&&userAgent$1(/android/i);var captureMode={capture:false,passive:false};function on(el,event,fn){el.addEventListener(event,fn,!IE11OrLess&&captureMode);}function off(el,event,fn){el.removeEventListener(event,fn,!IE11OrLess&&captureMode);}function matches(/**HTMLElement*/el,/**String*/selector){if(!selector)return;selector[0]==='>'&&(selector=selector.substring(1));if(el){try{if(el.matches){return el.matches(selector);}else if(el.msMatchesSelector){return el.msMatchesSelector(selector);}else if(el.webkitMatchesSelector){return el.webkitMatchesSelector(selector);}}catch(_){return false;}}return false;}function getParentOrHost(el){return el.host&&el!==document&&el.host.nodeType?el.host:el.parentNode;}function closest(/**HTMLElement*/el,/**String*/selector,/**HTMLElement*/ctx,includeCTX){if(el){ctx=ctx||document;do{if(selector!=null&&(selector[0]==='>'?el.parentNode===ctx&&matches(el,selector):matches(el,selector))||includeCTX&&el===ctx){return el;}if(el===ctx)break;/* jshint boss:true */}while(el=getParentOrHost(el));}return null;}var R_SPACE=/\s+/g;function toggleClass(el,name,state){if(el&&name){if(el.classList){el.classList[state?'add':'remove'](name);}else{var className=(' '+el.className+' ').replace(R_SPACE,' ').replace(' '+name+' ',' ');el.className=(className+(state?' '+name:'')).replace(R_SPACE,' ');}}}function css(el,prop,val){var style=el&&el.style;if(style){if(val===void 0){if(document.defaultView&&document.defaultView.getComputedStyle){val=document.defaultView.getComputedStyle(el,'');}else if(el.currentStyle){val=el.currentStyle;}return prop===void 0?val:val[prop];}else{if(!(prop in style)&&prop.indexOf('webkit')===-1){prop='-webkit-'+prop;}style[prop]=val+(typeof val==='string'?'':'px');}}}function matrix(el,selfOnly){var appliedTransforms='';if(typeof el==='string'){appliedTransforms=el;}else{do{var transform=css(el,'transform');if(transform&&transform!=='none'){appliedTransforms=transform+' '+appliedTransforms;}/* jshint boss:true */}while(!selfOnly&&(el=el.parentNode));}var matrixFn=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;/*jshint -W056 */return matrixFn&&new matrixFn(appliedTransforms);}function find(ctx,tagName,iterator){if(ctx){var list=ctx.getElementsByTagName(tagName),i=0,n=list.length;if(iterator){for(;i<n;i++){iterator(list[i],i);}}return list;}return[];}function getWindowScrollingElement(){var scrollingElement=document.scrollingElement;if(scrollingElement){return scrollingElement;}else{return document.documentElement;}}/**
			 * Returns the "bounding client rect" of given element
			 * @param  {HTMLElement} el                       The element whose boundingClientRect is wanted
			 * @param  {[Boolean]} relativeToContainingBlock  Whether the rect should be relative to the containing block of (including) the container
			 * @param  {[Boolean]} relativeToNonStaticParent  Whether the rect should be relative to the relative parent of (including) the contaienr
			 * @param  {[Boolean]} undoScale                  Whether the container's scale() should be undone
			 * @param  {[HTMLElement]} container              The parent the element will be placed in
			 * @return {Object}                               The boundingClientRect of el, with specified adjustments
			 */function getRect(el,relativeToContainingBlock,relativeToNonStaticParent,undoScale,container){if(!el.getBoundingClientRect&&el!==window)return;var elRect,top,left,bottom,right,height,width;if(el!==window&&el.parentNode&&el!==getWindowScrollingElement()){elRect=el.getBoundingClientRect();top=elRect.top;left=elRect.left;bottom=elRect.bottom;right=elRect.right;height=elRect.height;width=elRect.width;}else{top=0;left=0;bottom=window.innerHeight;right=window.innerWidth;height=window.innerHeight;width=window.innerWidth;}if((relativeToContainingBlock||relativeToNonStaticParent)&&el!==window){// Adjust for translate()
container=container||el.parentNode;// solves #1123 (see: https://stackoverflow.com/a/37953806/6088312)
// Not needed on <= IE11
if(!IE11OrLess){do{if(container&&container.getBoundingClientRect&&(css(container,'transform')!=='none'||relativeToNonStaticParent&&css(container,'position')!=='static')){var containerRect=container.getBoundingClientRect();// Set relative to edges of padding box of container
top-=containerRect.top+parseInt(css(container,'border-top-width'));left-=containerRect.left+parseInt(css(container,'border-left-width'));bottom=top+elRect.height;right=left+elRect.width;break;}/* jshint boss:true */}while(container=container.parentNode);}}if(undoScale&&el!==window){// Adjust for scale()
var elMatrix=matrix(container||el),scaleX=elMatrix&&elMatrix.a,scaleY=elMatrix&&elMatrix.d;if(elMatrix){top/=scaleY;left/=scaleX;width/=scaleX;height/=scaleY;bottom=top+height;right=left+width;}}return{top:top,left:left,bottom:bottom,right:right,width:width,height:height};}/**
			 * Checks if a side of an element is scrolled past a side of its parents
			 * @param  {HTMLElement}  el           The element who's side being scrolled out of view is in question
			 * @param  {String}       elSide       Side of the element in question ('top', 'left', 'right', 'bottom')
			 * @param  {String}       parentSide   Side of the parent in question ('top', 'left', 'right', 'bottom')
			 * @return {HTMLElement}               The parent scroll element that the el's side is scrolled past, or null if there is no such element
			 */function isScrolledPast(el,elSide,parentSide){var parent=getParentAutoScrollElement(el,true),elSideVal=getRect(el)[elSide];/* jshint boss:true */while(parent){var parentSideVal=getRect(parent)[parentSide],visible=void 0;if(parentSide==='top'||parentSide==='left'){visible=elSideVal>=parentSideVal;}else{visible=elSideVal<=parentSideVal;}if(!visible)return parent;if(parent===getWindowScrollingElement())break;parent=getParentAutoScrollElement(parent,false);}return false;}/**
			 * Gets nth child of el, ignoring hidden children, sortable's elements (does not ignore clone if it's visible)
			 * and non-draggable elements
			 * @param  {HTMLElement} el       The parent element
			 * @param  {Number} childNum      The index of the child
			 * @param  {Object} options       Parent Sortable's options
			 * @return {HTMLElement}          The child at index childNum, or null if not found
			 */function getChild(el,childNum,options,includeDragEl){var currentChild=0,i=0,children=el.children;while(i<children.length){if(children[i].style.display!=='none'&&children[i]!==Sortable.ghost&&(includeDragEl||children[i]!==Sortable.dragged)&&closest(children[i],options.draggable,el,false)){if(currentChild===childNum){return children[i];}currentChild++;}i++;}return null;}/**
			 * Gets the last child in the el, ignoring ghostEl or invisible elements (clones)
			 * @param  {HTMLElement} el       Parent element
			 * @param  {selector} selector    Any other elements that should be ignored
			 * @return {HTMLElement}          The last child, ignoring ghostEl
			 */function lastChild(el,selector){var last=el.lastElementChild;while(last&&(last===Sortable.ghost||css(last,'display')==='none'||selector&&!matches(last,selector))){last=last.previousElementSibling;}return last||null;}/**
			 * Returns the index of an element within its parent for a selected set of
			 * elements
			 * @param  {HTMLElement} el
			 * @param  {selector} selector
			 * @return {number}
			 */function index$1(el,selector){var index=0;if(!el||!el.parentNode){return-1;}/* jshint boss:true */while(el=el.previousElementSibling){if(el.nodeName.toUpperCase()!=='TEMPLATE'&&el!==Sortable.clone&&(!selector||matches(el,selector))){index++;}}return index;}/**
			 * Returns the scroll offset of the given element, added with all the scroll offsets of parent elements.
			 * The value is returned in real pixels.
			 * @param  {HTMLElement} el
			 * @return {Array}             Offsets in the format of [left, top]
			 */function getRelativeScrollOffset(el){var offsetLeft=0,offsetTop=0,winScroller=getWindowScrollingElement();if(el){do{var elMatrix=matrix(el),scaleX=elMatrix.a,scaleY=elMatrix.d;offsetLeft+=el.scrollLeft*scaleX;offsetTop+=el.scrollTop*scaleY;}while(el!==winScroller&&(el=el.parentNode));}return[offsetLeft,offsetTop];}/**
			 * Returns the index of the object within the given array
			 * @param  {Array} arr   Array that may or may not hold the object
			 * @param  {Object} obj  An object that has a key-value pair unique to and identical to a key-value pair in the object you want to find
			 * @return {Number}      The index of the object in the array, or -1
			 */function indexOfObject(arr,obj){for(var i in arr){if(!arr.hasOwnProperty(i))continue;for(var key in obj){if(obj.hasOwnProperty(key)&&obj[key]===arr[i][key])return Number(i);}}return-1;}function getParentAutoScrollElement(el,includeSelf){// skip to window
if(!el||!el.getBoundingClientRect)return getWindowScrollingElement();var elem=el;var gotSelf=false;do{// we don't need to get elem css if it isn't even overflowing in the first place (performance)
if(elem.clientWidth<elem.scrollWidth||elem.clientHeight<elem.scrollHeight){var elemCSS=css(elem);if(elem.clientWidth<elem.scrollWidth&&(elemCSS.overflowX=='auto'||elemCSS.overflowX=='scroll')||elem.clientHeight<elem.scrollHeight&&(elemCSS.overflowY=='auto'||elemCSS.overflowY=='scroll')){if(!elem.getBoundingClientRect||elem===document.body)return getWindowScrollingElement();if(gotSelf||includeSelf)return elem;gotSelf=true;}}/* jshint boss:true */}while(elem=elem.parentNode);return getWindowScrollingElement();}function extend$1(dst,src){if(dst&&src){for(var key in src){if(src.hasOwnProperty(key)){dst[key]=src[key];}}}return dst;}function isRectEqual(rect1,rect2){return Math.round(rect1.top)===Math.round(rect2.top)&&Math.round(rect1.left)===Math.round(rect2.left)&&Math.round(rect1.height)===Math.round(rect2.height)&&Math.round(rect1.width)===Math.round(rect2.width);}var _throttleTimeout;function throttle$1(callback,ms){return function(){if(!_throttleTimeout){var args=arguments,_this=this;if(args.length===1){callback.call(_this,args[0]);}else{callback.apply(_this,args);}_throttleTimeout=setTimeout(function(){_throttleTimeout=void 0;},ms);}};}function cancelThrottle(){clearTimeout(_throttleTimeout);_throttleTimeout=void 0;}function scrollBy(el,x,y){el.scrollLeft+=x;el.scrollTop+=y;}function clone$1(el){var Polymer=window.Polymer;var $=window.jQuery||window.Zepto;if(Polymer&&Polymer.dom){return Polymer.dom(el).cloneNode(true);}else if($){return $(el).clone(true)[0];}else{return el.cloneNode(true);}}var expando='Sortable'+new Date().getTime();function AnimationStateManager(){var animationStates=[],animationCallbackId;return{captureAnimationState:function captureAnimationState(){animationStates=[];if(!this.options.animation)return;var children=[].slice.call(this.el.children);children.forEach(function(child){if(css(child,'display')==='none'||child===Sortable.ghost)return;animationStates.push({target:child,rect:getRect(child)});var fromRect=_objectSpread2({},animationStates[animationStates.length-1].rect);// If animating: compensate for current animation
if(child.thisAnimationDuration){var childMatrix=matrix(child,true);if(childMatrix){fromRect.top-=childMatrix.f;fromRect.left-=childMatrix.e;}}child.fromRect=fromRect;});},addAnimationState:function addAnimationState(state){animationStates.push(state);},removeAnimationState:function removeAnimationState(target){animationStates.splice(indexOfObject(animationStates,{target:target}),1);},animateAll:function animateAll(callback){var _this=this;if(!this.options.animation){clearTimeout(animationCallbackId);if(typeof callback==='function')callback();return;}var animating=false,animationTime=0;animationStates.forEach(function(state){var time=0,target=state.target,fromRect=target.fromRect,toRect=getRect(target),prevFromRect=target.prevFromRect,prevToRect=target.prevToRect,animatingRect=state.rect,targetMatrix=matrix(target,true);if(targetMatrix){// Compensate for current animation
toRect.top-=targetMatrix.f;toRect.left-=targetMatrix.e;}target.toRect=toRect;if(target.thisAnimationDuration){// Could also check if animatingRect is between fromRect and toRect
if(isRectEqual(prevFromRect,toRect)&&!isRectEqual(fromRect,toRect)&&// Make sure animatingRect is on line between toRect & fromRect
(animatingRect.top-toRect.top)/(animatingRect.left-toRect.left)===(fromRect.top-toRect.top)/(fromRect.left-toRect.left)){// If returning to same place as started from animation and on same axis
time=calculateRealTime(animatingRect,prevFromRect,prevToRect,_this.options);}}// if fromRect != toRect: animate
if(!isRectEqual(toRect,fromRect)){target.prevFromRect=fromRect;target.prevToRect=toRect;if(!time){time=_this.options.animation;}_this.animate(target,animatingRect,toRect,time);}if(time){animating=true;animationTime=Math.max(animationTime,time);clearTimeout(target.animationResetTimer);target.animationResetTimer=setTimeout(function(){target.animationTime=0;target.prevFromRect=null;target.fromRect=null;target.prevToRect=null;target.thisAnimationDuration=null;},time);target.thisAnimationDuration=time;}});clearTimeout(animationCallbackId);if(!animating){if(typeof callback==='function')callback();}else{animationCallbackId=setTimeout(function(){if(typeof callback==='function')callback();},animationTime);}animationStates=[];},animate:function animate(target,currentRect,toRect,duration){if(duration){css(target,'transition','');css(target,'transform','');var elMatrix=matrix(this.el),scaleX=elMatrix&&elMatrix.a,scaleY=elMatrix&&elMatrix.d,translateX=(currentRect.left-toRect.left)/(scaleX||1),translateY=(currentRect.top-toRect.top)/(scaleY||1);target.animatingX=!!translateX;target.animatingY=!!translateY;css(target,'transform','translate3d('+translateX+'px,'+translateY+'px,0)');this.forRepaintDummy=repaint(target);// repaint
css(target,'transition','transform '+duration+'ms'+(this.options.easing?' '+this.options.easing:''));css(target,'transform','translate3d(0,0,0)');typeof target.animated==='number'&&clearTimeout(target.animated);target.animated=setTimeout(function(){css(target,'transition','');css(target,'transform','');target.animated=false;target.animatingX=false;target.animatingY=false;},duration);}}};}function repaint(target){return target.offsetWidth;}function calculateRealTime(animatingRect,fromRect,toRect,options){return Math.sqrt(Math.pow(fromRect.top-animatingRect.top,2)+Math.pow(fromRect.left-animatingRect.left,2))/Math.sqrt(Math.pow(fromRect.top-toRect.top,2)+Math.pow(fromRect.left-toRect.left,2))*options.animation;}var plugins=[];var defaults$1={initializeByDefault:true};var PluginManager={mount:function mount(plugin){// Set default static properties
for(var option in defaults$1){if(defaults$1.hasOwnProperty(option)&&!(option in plugin)){plugin[option]=defaults$1[option];}}plugins.forEach(function(p){if(p.pluginName===plugin.pluginName){throw"Sortable: Cannot mount plugin ".concat(plugin.pluginName," more than once");}});plugins.push(plugin);},pluginEvent:function pluginEvent(eventName,sortable,evt){var _this=this;this.eventCanceled=false;evt.cancel=function(){_this.eventCanceled=true;};var eventNameGlobal=eventName+'Global';plugins.forEach(function(plugin){if(!sortable[plugin.pluginName])return;// Fire global events if it exists in this sortable
if(sortable[plugin.pluginName][eventNameGlobal]){sortable[plugin.pluginName][eventNameGlobal](_objectSpread2({sortable:sortable},evt));}// Only fire plugin event if plugin is enabled in this sortable,
// and plugin has event defined
if(sortable.options[plugin.pluginName]&&sortable[plugin.pluginName][eventName]){sortable[plugin.pluginName][eventName](_objectSpread2({sortable:sortable},evt));}});},initializePlugins:function initializePlugins(sortable,el,defaults,options){plugins.forEach(function(plugin){var pluginName=plugin.pluginName;if(!sortable.options[pluginName]&&!plugin.initializeByDefault)return;var initialized=new plugin(sortable,el,sortable.options);initialized.sortable=sortable;initialized.options=sortable.options;sortable[pluginName]=initialized;// Add default options from plugin
_extends$4(defaults,initialized.defaults);});for(var option in sortable.options){if(!sortable.options.hasOwnProperty(option))continue;var modified=this.modifyOption(sortable,option,sortable.options[option]);if(typeof modified!=='undefined'){sortable.options[option]=modified;}}},getEventProperties:function getEventProperties(name,sortable){var eventProperties={};plugins.forEach(function(plugin){if(typeof plugin.eventProperties!=='function')return;_extends$4(eventProperties,plugin.eventProperties.call(sortable[plugin.pluginName],name));});return eventProperties;},modifyOption:function modifyOption(sortable,name,value){var modifiedValue;plugins.forEach(function(plugin){// Plugin must exist on the Sortable
if(!sortable[plugin.pluginName])return;// If static option listener exists for this option, call in the context of the Sortable's instance of this plugin
if(plugin.optionListeners&&typeof plugin.optionListeners[name]==='function'){modifiedValue=plugin.optionListeners[name].call(sortable[plugin.pluginName],value);}});return modifiedValue;}};function dispatchEvent(_ref){var sortable=_ref.sortable,rootEl=_ref.rootEl,name=_ref.name,targetEl=_ref.targetEl,cloneEl=_ref.cloneEl,toEl=_ref.toEl,fromEl=_ref.fromEl,oldIndex=_ref.oldIndex,newIndex=_ref.newIndex,oldDraggableIndex=_ref.oldDraggableIndex,newDraggableIndex=_ref.newDraggableIndex,originalEvent=_ref.originalEvent,putSortable=_ref.putSortable,extraEventProperties=_ref.extraEventProperties;sortable=sortable||rootEl&&rootEl[expando];if(!sortable)return;var evt,options=sortable.options,onName='on'+name.charAt(0).toUpperCase()+name.substr(1);// Support for new CustomEvent feature
if(window.CustomEvent&&!IE11OrLess&&!Edge){evt=new CustomEvent(name,{bubbles:true,cancelable:true});}else{evt=document.createEvent('Event');evt.initEvent(name,true,true);}evt.to=toEl||rootEl;evt.from=fromEl||rootEl;evt.item=targetEl||rootEl;evt.clone=cloneEl;evt.oldIndex=oldIndex;evt.newIndex=newIndex;evt.oldDraggableIndex=oldDraggableIndex;evt.newDraggableIndex=newDraggableIndex;evt.originalEvent=originalEvent;evt.pullMode=putSortable?putSortable.lastPutMode:undefined;var allEventProperties=_objectSpread2(_objectSpread2({},extraEventProperties),PluginManager.getEventProperties(name,sortable));for(var option in allEventProperties){evt[option]=allEventProperties[option];}if(rootEl){rootEl.dispatchEvent(evt);}if(options[onName]){options[onName].call(sortable,evt);}}var _excluded$1=["evt"];var pluginEvent=function pluginEvent(eventName,sortable){var _ref=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{},originalEvent=_ref.evt,data=_objectWithoutProperties$2(_ref,_excluded$1);PluginManager.pluginEvent.bind(Sortable)(eventName,sortable,_objectSpread2({dragEl:dragEl,parentEl:parentEl,ghostEl:ghostEl,rootEl:rootEl,nextEl:nextEl,lastDownEl:lastDownEl,cloneEl:cloneEl,cloneHidden:cloneHidden,dragStarted:moved,putSortable:putSortable,activeSortable:Sortable.active,originalEvent:originalEvent,oldIndex:oldIndex,oldDraggableIndex:oldDraggableIndex,newIndex:newIndex,newDraggableIndex:newDraggableIndex,hideGhostForTarget:_hideGhostForTarget,unhideGhostForTarget:_unhideGhostForTarget,cloneNowHidden:function cloneNowHidden(){cloneHidden=true;},cloneNowShown:function cloneNowShown(){cloneHidden=false;},dispatchSortableEvent:function dispatchSortableEvent(name){_dispatchEvent({sortable:sortable,name:name,originalEvent:originalEvent});}},data));};function _dispatchEvent(info){dispatchEvent(_objectSpread2({putSortable:putSortable,cloneEl:cloneEl,targetEl:dragEl,rootEl:rootEl,oldIndex:oldIndex,oldDraggableIndex:oldDraggableIndex,newIndex:newIndex,newDraggableIndex:newDraggableIndex},info));}var dragEl,parentEl,ghostEl,rootEl,nextEl,lastDownEl,cloneEl,cloneHidden,oldIndex,newIndex,oldDraggableIndex,newDraggableIndex,activeGroup,putSortable,awaitingDragStarted=false,ignoreNextClick=false,sortables=[],tapEvt,touchEvt,lastDx,lastDy,tapDistanceLeft,tapDistanceTop,moved,lastTarget,lastDirection,pastFirstInvertThresh=false,isCircumstantialInvert=false,targetMoveDistance,// For positioning ghost absolutely
ghostRelativeParent,ghostRelativeParentInitialScroll=[],// (left, top)
_silent=false,savedInputChecked=[];/** @const */var documentExists=typeof document!=='undefined',PositionGhostAbsolutely=IOS,CSSFloatProperty=Edge||IE11OrLess?'cssFloat':'float',// This will not pass for IE9, because IE9 DnD only works on anchors
supportDraggable=documentExists&&!ChromeForAndroid&&!IOS&&'draggable'in document.createElement('div'),supportCssPointerEvents=function(){if(!documentExists)return;// false when <= IE11
if(IE11OrLess){return false;}var el=document.createElement('x');el.style.cssText='pointer-events:auto';return el.style.pointerEvents==='auto';}(),_detectDirection=function _detectDirection(el,options){var elCSS=css(el),elWidth=parseInt(elCSS.width)-parseInt(elCSS.paddingLeft)-parseInt(elCSS.paddingRight)-parseInt(elCSS.borderLeftWidth)-parseInt(elCSS.borderRightWidth),child1=getChild(el,0,options),child2=getChild(el,1,options),firstChildCSS=child1&&css(child1),secondChildCSS=child2&&css(child2),firstChildWidth=firstChildCSS&&parseInt(firstChildCSS.marginLeft)+parseInt(firstChildCSS.marginRight)+getRect(child1).width,secondChildWidth=secondChildCSS&&parseInt(secondChildCSS.marginLeft)+parseInt(secondChildCSS.marginRight)+getRect(child2).width;if(elCSS.display==='flex'){return elCSS.flexDirection==='column'||elCSS.flexDirection==='column-reverse'?'vertical':'horizontal';}if(elCSS.display==='grid'){return elCSS.gridTemplateColumns.split(' ').length<=1?'vertical':'horizontal';}if(child1&&firstChildCSS["float"]&&firstChildCSS["float"]!=='none'){var touchingSideChild2=firstChildCSS["float"]==='left'?'left':'right';return child2&&(secondChildCSS.clear==='both'||secondChildCSS.clear===touchingSideChild2)?'vertical':'horizontal';}return child1&&(firstChildCSS.display==='block'||firstChildCSS.display==='flex'||firstChildCSS.display==='table'||firstChildCSS.display==='grid'||firstChildWidth>=elWidth&&elCSS[CSSFloatProperty]==='none'||child2&&elCSS[CSSFloatProperty]==='none'&&firstChildWidth+secondChildWidth>elWidth)?'vertical':'horizontal';},_dragElInRowColumn=function _dragElInRowColumn(dragRect,targetRect,vertical){var dragElS1Opp=vertical?dragRect.left:dragRect.top,dragElS2Opp=vertical?dragRect.right:dragRect.bottom,dragElOppLength=vertical?dragRect.width:dragRect.height,targetS1Opp=vertical?targetRect.left:targetRect.top,targetS2Opp=vertical?targetRect.right:targetRect.bottom,targetOppLength=vertical?targetRect.width:targetRect.height;return dragElS1Opp===targetS1Opp||dragElS2Opp===targetS2Opp||dragElS1Opp+dragElOppLength/2===targetS1Opp+targetOppLength/2;},/**
			 * Detects first nearest empty sortable to X and Y position using emptyInsertThreshold.
			 * @param  {Number} x      X position
			 * @param  {Number} y      Y position
			 * @return {HTMLElement}   Element of the first found nearest Sortable
			 */_detectNearestEmptySortable=function _detectNearestEmptySortable(x,y){var ret;sortables.some(function(sortable){var threshold=sortable[expando].options.emptyInsertThreshold;if(!threshold||lastChild(sortable))return;var rect=getRect(sortable),insideHorizontally=x>=rect.left-threshold&&x<=rect.right+threshold,insideVertically=y>=rect.top-threshold&&y<=rect.bottom+threshold;if(insideHorizontally&&insideVertically){return ret=sortable;}});return ret;},_prepareGroup=function _prepareGroup(options){function toFn(value,pull){return function(to,from,dragEl,evt){var sameGroup=to.options.group.name&&from.options.group.name&&to.options.group.name===from.options.group.name;if(value==null&&(pull||sameGroup)){// Default pull value
// Default pull and put value if same group
return true;}else if(value==null||value===false){return false;}else if(pull&&value==='clone'){return value;}else if(typeof value==='function'){return toFn(value(to,from,dragEl,evt),pull)(to,from,dragEl,evt);}else{var otherGroup=(pull?to:from).options.group.name;return value===true||typeof value==='string'&&value===otherGroup||value.join&&value.indexOf(otherGroup)>-1;}};}var group={};var originalGroup=options.group;if(!originalGroup||_typeof$3(originalGroup)!='object'){originalGroup={name:originalGroup};}group.name=originalGroup.name;group.checkPull=toFn(originalGroup.pull,true);group.checkPut=toFn(originalGroup.put);group.revertClone=originalGroup.revertClone;options.group=group;},_hideGhostForTarget=function _hideGhostForTarget(){if(!supportCssPointerEvents&&ghostEl){css(ghostEl,'display','none');}},_unhideGhostForTarget=function _unhideGhostForTarget(){if(!supportCssPointerEvents&&ghostEl){css(ghostEl,'display','');}};// #1184 fix - Prevent click event on fallback if dragged but item not changed position
if(documentExists){document.addEventListener('click',function(evt){if(ignoreNextClick){evt.preventDefault();evt.stopPropagation&&evt.stopPropagation();evt.stopImmediatePropagation&&evt.stopImmediatePropagation();ignoreNextClick=false;return false;}},true);}var nearestEmptyInsertDetectEvent=function nearestEmptyInsertDetectEvent(evt){if(dragEl){evt=evt.touches?evt.touches[0]:evt;var nearest=_detectNearestEmptySortable(evt.clientX,evt.clientY);if(nearest){// Create imitation event
var event={};for(var i in evt){if(evt.hasOwnProperty(i)){event[i]=evt[i];}}event.target=event.rootEl=nearest;event.preventDefault=void 0;event.stopPropagation=void 0;nearest[expando]._onDragOver(event);}}};var _checkOutsideTargetEl=function _checkOutsideTargetEl(evt){if(dragEl){dragEl.parentNode[expando]._isOutsideThisEl(evt.target);}};/**
			 * @class  Sortable
			 * @param  {HTMLElement}  el
			 * @param  {Object}       [options]
			 */function Sortable(el,options){if(!(el&&el.nodeType&&el.nodeType===1)){throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(el));}this.el=el;// root element
this.options=options=_extends$4({},options);// Export instance
el[expando]=this;var defaults={group:null,sort:true,disabled:false,store:null,handle:null,draggable:/^[uo]l$/i.test(el.nodeName)?'>li':'>*',swapThreshold:1,// percentage; 0 <= x <= 1
invertSwap:false,// invert always
invertedSwapThreshold:null,// will be set to same as swapThreshold if default
removeCloneOnHide:true,direction:function direction(){return _detectDirection(el,this.options);},ghostClass:'sortable-ghost',chosenClass:'sortable-chosen',dragClass:'sortable-drag',ignore:'a, img',filter:null,preventOnFilter:true,animation:0,easing:null,setData:function setData(dataTransfer,dragEl){dataTransfer.setData('Text',dragEl.textContent);},dropBubble:false,dragoverBubble:false,dataIdAttr:'data-id',delay:0,delayOnTouchOnly:false,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:false,fallbackClass:'sortable-fallback',fallbackOnBody:false,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:Sortable.supportPointer!==false&&'PointerEvent'in window&&!Safari,emptyInsertThreshold:5};PluginManager.initializePlugins(this,el,defaults);// Set default options
for(var name in defaults){!(name in options)&&(options[name]=defaults[name]);}_prepareGroup(options);// Bind all private methods
for(var fn in this){if(fn.charAt(0)==='_'&&typeof this[fn]==='function'){this[fn]=this[fn].bind(this);}}// Setup drag mode
this.nativeDraggable=options.forceFallback?false:supportDraggable;if(this.nativeDraggable){// Touch start threshold cannot be greater than the native dragstart threshold
this.options.touchStartThreshold=1;}// Bind events
if(options.supportPointer){on(el,'pointerdown',this._onTapStart);}else{on(el,'mousedown',this._onTapStart);on(el,'touchstart',this._onTapStart);}if(this.nativeDraggable){on(el,'dragover',this);on(el,'dragenter',this);}sortables.push(this.el);// Restore sorting
options.store&&options.store.get&&this.sort(options.store.get(this)||[]);// Add animation state manager
_extends$4(this,AnimationStateManager());}Sortable.prototype=/** @lends Sortable.prototype */{constructor:Sortable,_isOutsideThisEl:function _isOutsideThisEl(target){if(!this.el.contains(target)&&target!==this.el){lastTarget=null;}},_getDirection:function _getDirection(evt,target){return typeof this.options.direction==='function'?this.options.direction.call(this,evt,target,dragEl):this.options.direction;},_onTapStart:function _onTapStart(/** Event|TouchEvent */evt){if(!evt.cancelable)return;var _this=this,el=this.el,options=this.options,preventOnFilter=options.preventOnFilter,type=evt.type,touch=evt.touches&&evt.touches[0]||evt.pointerType&&evt.pointerType==='touch'&&evt,target=(touch||evt).target,originalTarget=evt.target.shadowRoot&&(evt.path&&evt.path[0]||evt.composedPath&&evt.composedPath()[0])||target,filter=options.filter;_saveInputCheckedState(el);// Don't trigger start event when an element is been dragged, otherwise the evt.oldindex always wrong when set option.group.
if(dragEl){return;}if(/mousedown|pointerdown/.test(type)&&evt.button!==0||options.disabled){return;// only left button and enabled
}// cancel dnd if original target is content editable
if(originalTarget.isContentEditable){return;}// Safari ignores further event handling after mousedown
if(!this.nativeDraggable&&Safari&&target&&target.tagName.toUpperCase()==='SELECT'){return;}target=closest(target,options.draggable,el,false);if(target&&target.animated){return;}if(lastDownEl===target){// Ignoring duplicate `down`
return;}// Get the index of the dragged element within its parent
oldIndex=index$1(target);oldDraggableIndex=index$1(target,options.draggable);// Check filter
if(typeof filter==='function'){if(filter.call(this,evt,target,this)){_dispatchEvent({sortable:_this,rootEl:originalTarget,name:'filter',targetEl:target,toEl:el,fromEl:el});pluginEvent('filter',_this,{evt:evt});preventOnFilter&&evt.cancelable&&evt.preventDefault();return;// cancel dnd
}}else if(filter){filter=filter.split(',').some(function(criteria){criteria=closest(originalTarget,criteria.trim(),el,false);if(criteria){_dispatchEvent({sortable:_this,rootEl:criteria,name:'filter',targetEl:target,fromEl:el,toEl:el});pluginEvent('filter',_this,{evt:evt});return true;}});if(filter){preventOnFilter&&evt.cancelable&&evt.preventDefault();return;// cancel dnd
}}if(options.handle&&!closest(originalTarget,options.handle,el,false)){return;}// Prepare `dragstart`
this._prepareDragStart(evt,touch,target);},_prepareDragStart:function _prepareDragStart(/** Event */evt,/** Touch */touch,/** HTMLElement */target){var _this=this,el=_this.el,options=_this.options,ownerDocument=el.ownerDocument,dragStartFn;if(target&&!dragEl&&target.parentNode===el){var dragRect=getRect(target);rootEl=el;dragEl=target;parentEl=dragEl.parentNode;nextEl=dragEl.nextSibling;lastDownEl=target;activeGroup=options.group;Sortable.dragged=dragEl;tapEvt={target:dragEl,clientX:(touch||evt).clientX,clientY:(touch||evt).clientY};tapDistanceLeft=tapEvt.clientX-dragRect.left;tapDistanceTop=tapEvt.clientY-dragRect.top;this._lastX=(touch||evt).clientX;this._lastY=(touch||evt).clientY;dragEl.style['will-change']='all';dragStartFn=function dragStartFn(){pluginEvent('delayEnded',_this,{evt:evt});if(Sortable.eventCanceled){_this._onDrop();return;}// Delayed drag has been triggered
// we can re-enable the events: touchmove/mousemove
_this._disableDelayedDragEvents();if(!FireFox&&_this.nativeDraggable){dragEl.draggable=true;}// Bind the events: dragstart/dragend
_this._triggerDragStart(evt,touch);// Drag start event
_dispatchEvent({sortable:_this,name:'choose',originalEvent:evt});// Chosen item
toggleClass(dragEl,options.chosenClass,true);};// Disable "draggable"
options.ignore.split(',').forEach(function(criteria){find(dragEl,criteria.trim(),_disableDraggable);});on(ownerDocument,'dragover',nearestEmptyInsertDetectEvent);on(ownerDocument,'mousemove',nearestEmptyInsertDetectEvent);on(ownerDocument,'touchmove',nearestEmptyInsertDetectEvent);on(ownerDocument,'mouseup',_this._onDrop);on(ownerDocument,'touchend',_this._onDrop);on(ownerDocument,'touchcancel',_this._onDrop);// Make dragEl draggable (must be before delay for FireFox)
if(FireFox&&this.nativeDraggable){this.options.touchStartThreshold=4;dragEl.draggable=true;}pluginEvent('delayStart',this,{evt:evt});// Delay is impossible for native DnD in Edge or IE
if(options.delay&&(!options.delayOnTouchOnly||touch)&&(!this.nativeDraggable||!(Edge||IE11OrLess))){if(Sortable.eventCanceled){this._onDrop();return;}// If the user moves the pointer or let go the click or touch
// before the delay has been reached:
// disable the delayed drag
on(ownerDocument,'mouseup',_this._disableDelayedDrag);on(ownerDocument,'touchend',_this._disableDelayedDrag);on(ownerDocument,'touchcancel',_this._disableDelayedDrag);on(ownerDocument,'mousemove',_this._delayedDragTouchMoveHandler);on(ownerDocument,'touchmove',_this._delayedDragTouchMoveHandler);options.supportPointer&&on(ownerDocument,'pointermove',_this._delayedDragTouchMoveHandler);_this._dragStartTimer=setTimeout(dragStartFn,options.delay);}else{dragStartFn();}}},_delayedDragTouchMoveHandler:function _delayedDragTouchMoveHandler(/** TouchEvent|PointerEvent **/e){var touch=e.touches?e.touches[0]:e;if(Math.max(Math.abs(touch.clientX-this._lastX),Math.abs(touch.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))){this._disableDelayedDrag();}},_disableDelayedDrag:function _disableDelayedDrag(){dragEl&&_disableDraggable(dragEl);clearTimeout(this._dragStartTimer);this._disableDelayedDragEvents();},_disableDelayedDragEvents:function _disableDelayedDragEvents(){var ownerDocument=this.el.ownerDocument;off(ownerDocument,'mouseup',this._disableDelayedDrag);off(ownerDocument,'touchend',this._disableDelayedDrag);off(ownerDocument,'touchcancel',this._disableDelayedDrag);off(ownerDocument,'mousemove',this._delayedDragTouchMoveHandler);off(ownerDocument,'touchmove',this._delayedDragTouchMoveHandler);off(ownerDocument,'pointermove',this._delayedDragTouchMoveHandler);},_triggerDragStart:function _triggerDragStart(/** Event */evt,/** Touch */touch){touch=touch||evt.pointerType=='touch'&&evt;if(!this.nativeDraggable||touch){if(this.options.supportPointer){on(document,'pointermove',this._onTouchMove);}else if(touch){on(document,'touchmove',this._onTouchMove);}else{on(document,'mousemove',this._onTouchMove);}}else{on(dragEl,'dragend',this);on(rootEl,'dragstart',this._onDragStart);}try{if(document.selection){// Timeout neccessary for IE9
_nextTick(function(){document.selection.empty();});}else{window.getSelection().removeAllRanges();}}catch(err){}},_dragStarted:function _dragStarted(fallback,evt){awaitingDragStarted=false;if(rootEl&&dragEl){pluginEvent('dragStarted',this,{evt:evt});if(this.nativeDraggable){on(document,'dragover',_checkOutsideTargetEl);}var options=this.options;// Apply effect
!fallback&&toggleClass(dragEl,options.dragClass,false);toggleClass(dragEl,options.ghostClass,true);Sortable.active=this;fallback&&this._appendGhost();// Drag start event
_dispatchEvent({sortable:this,name:'start',originalEvent:evt});}else{this._nulling();}},_emulateDragOver:function _emulateDragOver(){if(touchEvt){this._lastX=touchEvt.clientX;this._lastY=touchEvt.clientY;_hideGhostForTarget();var target=document.elementFromPoint(touchEvt.clientX,touchEvt.clientY);var parent=target;while(target&&target.shadowRoot){target=target.shadowRoot.elementFromPoint(touchEvt.clientX,touchEvt.clientY);if(target===parent)break;parent=target;}dragEl.parentNode[expando]._isOutsideThisEl(target);if(parent){do{if(parent[expando]){var inserted=void 0;inserted=parent[expando]._onDragOver({clientX:touchEvt.clientX,clientY:touchEvt.clientY,target:target,rootEl:parent});if(inserted&&!this.options.dragoverBubble){break;}}target=parent;// store last element
}/* jshint boss:true */while(parent=parent.parentNode);}_unhideGhostForTarget();}},_onTouchMove:function _onTouchMove(/**TouchEvent*/evt){if(tapEvt){var options=this.options,fallbackTolerance=options.fallbackTolerance,fallbackOffset=options.fallbackOffset,touch=evt.touches?evt.touches[0]:evt,ghostMatrix=ghostEl&&matrix(ghostEl,true),scaleX=ghostEl&&ghostMatrix&&ghostMatrix.a,scaleY=ghostEl&&ghostMatrix&&ghostMatrix.d,relativeScrollOffset=PositionGhostAbsolutely&&ghostRelativeParent&&getRelativeScrollOffset(ghostRelativeParent),dx=(touch.clientX-tapEvt.clientX+fallbackOffset.x)/(scaleX||1)+(relativeScrollOffset?relativeScrollOffset[0]-ghostRelativeParentInitialScroll[0]:0)/(scaleX||1),dy=(touch.clientY-tapEvt.clientY+fallbackOffset.y)/(scaleY||1)+(relativeScrollOffset?relativeScrollOffset[1]-ghostRelativeParentInitialScroll[1]:0)/(scaleY||1);// only set the status to dragging, when we are actually dragging
if(!Sortable.active&&!awaitingDragStarted){if(fallbackTolerance&&Math.max(Math.abs(touch.clientX-this._lastX),Math.abs(touch.clientY-this._lastY))<fallbackTolerance){return;}this._onDragStart(evt,true);}if(ghostEl){if(ghostMatrix){ghostMatrix.e+=dx-(lastDx||0);ghostMatrix.f+=dy-(lastDy||0);}else{ghostMatrix={a:1,b:0,c:0,d:1,e:dx,f:dy};}var cssMatrix="matrix(".concat(ghostMatrix.a,",").concat(ghostMatrix.b,",").concat(ghostMatrix.c,",").concat(ghostMatrix.d,",").concat(ghostMatrix.e,",").concat(ghostMatrix.f,")");css(ghostEl,'webkitTransform',cssMatrix);css(ghostEl,'mozTransform',cssMatrix);css(ghostEl,'msTransform',cssMatrix);css(ghostEl,'transform',cssMatrix);lastDx=dx;lastDy=dy;touchEvt=touch;}evt.cancelable&&evt.preventDefault();}},_appendGhost:function _appendGhost(){// Bug if using scale(): https://stackoverflow.com/questions/2637058
// Not being adjusted for
if(!ghostEl){var container=this.options.fallbackOnBody?document.body:rootEl,rect=getRect(dragEl,true,PositionGhostAbsolutely,true,container),options=this.options;// Position absolutely
if(PositionGhostAbsolutely){// Get relatively positioned parent
ghostRelativeParent=container;while(css(ghostRelativeParent,'position')==='static'&&css(ghostRelativeParent,'transform')==='none'&&ghostRelativeParent!==document){ghostRelativeParent=ghostRelativeParent.parentNode;}if(ghostRelativeParent!==document.body&&ghostRelativeParent!==document.documentElement){if(ghostRelativeParent===document)ghostRelativeParent=getWindowScrollingElement();rect.top+=ghostRelativeParent.scrollTop;rect.left+=ghostRelativeParent.scrollLeft;}else{ghostRelativeParent=getWindowScrollingElement();}ghostRelativeParentInitialScroll=getRelativeScrollOffset(ghostRelativeParent);}ghostEl=dragEl.cloneNode(true);toggleClass(ghostEl,options.ghostClass,false);toggleClass(ghostEl,options.fallbackClass,true);toggleClass(ghostEl,options.dragClass,true);css(ghostEl,'transition','');css(ghostEl,'transform','');css(ghostEl,'box-sizing','border-box');css(ghostEl,'margin',0);css(ghostEl,'top',rect.top);css(ghostEl,'left',rect.left);css(ghostEl,'width',rect.width);css(ghostEl,'height',rect.height);css(ghostEl,'opacity','0.8');css(ghostEl,'position',PositionGhostAbsolutely?'absolute':'fixed');css(ghostEl,'zIndex','100000');css(ghostEl,'pointerEvents','none');Sortable.ghost=ghostEl;container.appendChild(ghostEl);// Set transform-origin
css(ghostEl,'transform-origin',tapDistanceLeft/parseInt(ghostEl.style.width)*100+'% '+tapDistanceTop/parseInt(ghostEl.style.height)*100+'%');}},_onDragStart:function _onDragStart(/**Event*/evt,/**boolean*/fallback){var _this=this;var dataTransfer=evt.dataTransfer;var options=_this.options;pluginEvent('dragStart',this,{evt:evt});if(Sortable.eventCanceled){this._onDrop();return;}pluginEvent('setupClone',this);if(!Sortable.eventCanceled){cloneEl=clone$1(dragEl);cloneEl.draggable=false;cloneEl.style['will-change']='';this._hideClone();toggleClass(cloneEl,this.options.chosenClass,false);Sortable.clone=cloneEl;}// #1143: IFrame support workaround
_this.cloneId=_nextTick(function(){pluginEvent('clone',_this);if(Sortable.eventCanceled)return;if(!_this.options.removeCloneOnHide){rootEl.insertBefore(cloneEl,dragEl);}_this._hideClone();_dispatchEvent({sortable:_this,name:'clone'});});!fallback&&toggleClass(dragEl,options.dragClass,true);// Set proper drop events
if(fallback){ignoreNextClick=true;_this._loopId=setInterval(_this._emulateDragOver,50);}else{// Undo what was set in _prepareDragStart before drag started
off(document,'mouseup',_this._onDrop);off(document,'touchend',_this._onDrop);off(document,'touchcancel',_this._onDrop);if(dataTransfer){dataTransfer.effectAllowed='move';options.setData&&options.setData.call(_this,dataTransfer,dragEl);}on(document,'drop',_this);// #1276 fix:
css(dragEl,'transform','translateZ(0)');}awaitingDragStarted=true;_this._dragStartId=_nextTick(_this._dragStarted.bind(_this,fallback,evt));on(document,'selectstart',_this);moved=true;if(Safari){css(document.body,'user-select','none');}},// Returns true - if no further action is needed (either inserted or another condition)
_onDragOver:function _onDragOver(/**Event*/evt){var el=this.el,target=evt.target,dragRect,targetRect,revert,options=this.options,group=options.group,activeSortable=Sortable.active,isOwner=activeGroup===group,canSort=options.sort,fromSortable=putSortable||activeSortable,vertical,_this=this,completedFired=false;if(_silent)return;function dragOverEvent(name,extra){pluginEvent(name,_this,_objectSpread2({evt:evt,isOwner:isOwner,axis:vertical?'vertical':'horizontal',revert:revert,dragRect:dragRect,targetRect:targetRect,canSort:canSort,fromSortable:fromSortable,target:target,completed:completed,onMove:function onMove(target,after){return _onMove(rootEl,el,dragEl,dragRect,target,getRect(target),evt,after);},changed:changed},extra));}// Capture animation state
function capture(){dragOverEvent('dragOverAnimationCapture');_this.captureAnimationState();if(_this!==fromSortable){fromSortable.captureAnimationState();}}// Return invocation when dragEl is inserted (or completed)
function completed(insertion){dragOverEvent('dragOverCompleted',{insertion:insertion});if(insertion){// Clones must be hidden before folding animation to capture dragRectAbsolute properly
if(isOwner){activeSortable._hideClone();}else{activeSortable._showClone(_this);}if(_this!==fromSortable){// Set ghost class to new sortable's ghost class
toggleClass(dragEl,putSortable?putSortable.options.ghostClass:activeSortable.options.ghostClass,false);toggleClass(dragEl,options.ghostClass,true);}if(putSortable!==_this&&_this!==Sortable.active){putSortable=_this;}else if(_this===Sortable.active&&putSortable){putSortable=null;}// Animation
if(fromSortable===_this){_this._ignoreWhileAnimating=target;}_this.animateAll(function(){dragOverEvent('dragOverAnimationComplete');_this._ignoreWhileAnimating=null;});if(_this!==fromSortable){fromSortable.animateAll();fromSortable._ignoreWhileAnimating=null;}}// Null lastTarget if it is not inside a previously swapped element
if(target===dragEl&&!dragEl.animated||target===el&&!target.animated){lastTarget=null;}// no bubbling and not fallback
if(!options.dragoverBubble&&!evt.rootEl&&target!==document){dragEl.parentNode[expando]._isOutsideThisEl(evt.target);// Do not detect for empty insert if already inserted
!insertion&&nearestEmptyInsertDetectEvent(evt);}!options.dragoverBubble&&evt.stopPropagation&&evt.stopPropagation();return completedFired=true;}// Call when dragEl has been inserted
function changed(){newIndex=index$1(dragEl);newDraggableIndex=index$1(dragEl,options.draggable);_dispatchEvent({sortable:_this,name:'change',toEl:el,newIndex:newIndex,newDraggableIndex:newDraggableIndex,originalEvent:evt});}if(evt.preventDefault!==void 0){evt.cancelable&&evt.preventDefault();}target=closest(target,options.draggable,el,true);dragOverEvent('dragOver');if(Sortable.eventCanceled)return completedFired;if(dragEl.contains(evt.target)||target.animated&&target.animatingX&&target.animatingY||_this._ignoreWhileAnimating===target){return completed(false);}ignoreNextClick=false;if(activeSortable&&!options.disabled&&(isOwner?canSort||(revert=parentEl!==rootEl)// Reverting item into the original list
:putSortable===this||(this.lastPutMode=activeGroup.checkPull(this,activeSortable,dragEl,evt))&&group.checkPut(this,activeSortable,dragEl,evt))){vertical=this._getDirection(evt,target)==='vertical';dragRect=getRect(dragEl);dragOverEvent('dragOverValid');if(Sortable.eventCanceled)return completedFired;if(revert){parentEl=rootEl;// actualization
capture();this._hideClone();dragOverEvent('revert');if(!Sortable.eventCanceled){if(nextEl){rootEl.insertBefore(dragEl,nextEl);}else{rootEl.appendChild(dragEl);}}return completed(true);}var elLastChild=lastChild(el,options.draggable);if(!elLastChild||_ghostIsLast(evt,vertical,this)&&!elLastChild.animated){// Insert to end of list
// If already at end of list: Do not insert
if(elLastChild===dragEl){return completed(false);}// if there is a last element, it is the target
if(elLastChild&&el===evt.target){target=elLastChild;}if(target){targetRect=getRect(target);}if(_onMove(rootEl,el,dragEl,dragRect,target,targetRect,evt,!!target)!==false){capture();el.appendChild(dragEl);parentEl=el;// actualization
changed();return completed(true);}}else if(elLastChild&&_ghostIsFirst(evt,vertical,this)){// Insert to start of list
var firstChild=getChild(el,0,options,true);if(firstChild===dragEl){return completed(false);}target=firstChild;targetRect=getRect(target);if(_onMove(rootEl,el,dragEl,dragRect,target,targetRect,evt,false)!==false){capture();el.insertBefore(dragEl,firstChild);parentEl=el;// actualization
changed();return completed(true);}}else if(target.parentNode===el){targetRect=getRect(target);var direction=0,targetBeforeFirstSwap,differentLevel=dragEl.parentNode!==el,differentRowCol=!_dragElInRowColumn(dragEl.animated&&dragEl.toRect||dragRect,target.animated&&target.toRect||targetRect,vertical),side1=vertical?'top':'left',scrolledPastTop=isScrolledPast(target,'top','top')||isScrolledPast(dragEl,'top','top'),scrollBefore=scrolledPastTop?scrolledPastTop.scrollTop:void 0;if(lastTarget!==target){targetBeforeFirstSwap=targetRect[side1];pastFirstInvertThresh=false;isCircumstantialInvert=!differentRowCol&&options.invertSwap||differentLevel;}direction=_getSwapDirection(evt,target,targetRect,vertical,differentRowCol?1:options.swapThreshold,options.invertedSwapThreshold==null?options.swapThreshold:options.invertedSwapThreshold,isCircumstantialInvert,lastTarget===target);var sibling;if(direction!==0){// Check if target is beside dragEl in respective direction (ignoring hidden elements)
var dragIndex=index$1(dragEl);do{dragIndex-=direction;sibling=parentEl.children[dragIndex];}while(sibling&&(css(sibling,'display')==='none'||sibling===ghostEl));}// If dragEl is already beside target: Do not insert
if(direction===0||sibling===target){return completed(false);}lastTarget=target;lastDirection=direction;var nextSibling=target.nextElementSibling,after=false;after=direction===1;var moveVector=_onMove(rootEl,el,dragEl,dragRect,target,targetRect,evt,after);if(moveVector!==false){if(moveVector===1||moveVector===-1){after=moveVector===1;}_silent=true;setTimeout(_unsilent,30);capture();if(after&&!nextSibling){el.appendChild(dragEl);}else{target.parentNode.insertBefore(dragEl,after?nextSibling:target);}// Undo chrome's scroll adjustment (has no effect on other browsers)
if(scrolledPastTop){scrollBy(scrolledPastTop,0,scrollBefore-scrolledPastTop.scrollTop);}parentEl=dragEl.parentNode;// actualization
// must be done before animation
if(targetBeforeFirstSwap!==undefined&&!isCircumstantialInvert){targetMoveDistance=Math.abs(targetBeforeFirstSwap-getRect(target)[side1]);}changed();return completed(true);}}if(el.contains(dragEl)){return completed(false);}}return false;},_ignoreWhileAnimating:null,_offMoveEvents:function _offMoveEvents(){off(document,'mousemove',this._onTouchMove);off(document,'touchmove',this._onTouchMove);off(document,'pointermove',this._onTouchMove);off(document,'dragover',nearestEmptyInsertDetectEvent);off(document,'mousemove',nearestEmptyInsertDetectEvent);off(document,'touchmove',nearestEmptyInsertDetectEvent);},_offUpEvents:function _offUpEvents(){var ownerDocument=this.el.ownerDocument;off(ownerDocument,'mouseup',this._onDrop);off(ownerDocument,'touchend',this._onDrop);off(ownerDocument,'pointerup',this._onDrop);off(ownerDocument,'touchcancel',this._onDrop);off(document,'selectstart',this);},_onDrop:function _onDrop(/**Event*/evt){var el=this.el,options=this.options;// Get the index of the dragged element within its parent
newIndex=index$1(dragEl);newDraggableIndex=index$1(dragEl,options.draggable);pluginEvent('drop',this,{evt:evt});parentEl=dragEl&&dragEl.parentNode;// Get again after plugin event
newIndex=index$1(dragEl);newDraggableIndex=index$1(dragEl,options.draggable);if(Sortable.eventCanceled){this._nulling();return;}awaitingDragStarted=false;isCircumstantialInvert=false;pastFirstInvertThresh=false;clearInterval(this._loopId);clearTimeout(this._dragStartTimer);_cancelNextTick(this.cloneId);_cancelNextTick(this._dragStartId);// Unbind events
if(this.nativeDraggable){off(document,'drop',this);off(el,'dragstart',this._onDragStart);}this._offMoveEvents();this._offUpEvents();if(Safari){css(document.body,'user-select','');}css(dragEl,'transform','');if(evt){if(moved){evt.cancelable&&evt.preventDefault();!options.dropBubble&&evt.stopPropagation();}ghostEl&&ghostEl.parentNode&&ghostEl.parentNode.removeChild(ghostEl);if(rootEl===parentEl||putSortable&&putSortable.lastPutMode!=='clone'){// Remove clone(s)
cloneEl&&cloneEl.parentNode&&cloneEl.parentNode.removeChild(cloneEl);}if(dragEl){if(this.nativeDraggable){off(dragEl,'dragend',this);}_disableDraggable(dragEl);dragEl.style['will-change']='';// Remove classes
// ghostClass is added in dragStarted
if(moved&&!awaitingDragStarted){toggleClass(dragEl,putSortable?putSortable.options.ghostClass:this.options.ghostClass,false);}toggleClass(dragEl,this.options.chosenClass,false);// Drag stop event
_dispatchEvent({sortable:this,name:'unchoose',toEl:parentEl,newIndex:null,newDraggableIndex:null,originalEvent:evt});if(rootEl!==parentEl){if(newIndex>=0){// Add event
_dispatchEvent({rootEl:parentEl,name:'add',toEl:parentEl,fromEl:rootEl,originalEvent:evt});// Remove event
_dispatchEvent({sortable:this,name:'remove',toEl:parentEl,originalEvent:evt});// drag from one list and drop into another
_dispatchEvent({rootEl:parentEl,name:'sort',toEl:parentEl,fromEl:rootEl,originalEvent:evt});_dispatchEvent({sortable:this,name:'sort',toEl:parentEl,originalEvent:evt});}putSortable&&putSortable.save();}else{if(newIndex!==oldIndex){if(newIndex>=0){// drag & drop within the same list
_dispatchEvent({sortable:this,name:'update',toEl:parentEl,originalEvent:evt});_dispatchEvent({sortable:this,name:'sort',toEl:parentEl,originalEvent:evt});}}}if(Sortable.active){/* jshint eqnull:true */if(newIndex==null||newIndex===-1){newIndex=oldIndex;newDraggableIndex=oldDraggableIndex;}_dispatchEvent({sortable:this,name:'end',toEl:parentEl,originalEvent:evt});// Save sorting
this.save();}}}this._nulling();},_nulling:function _nulling(){pluginEvent('nulling',this);rootEl=dragEl=parentEl=ghostEl=nextEl=cloneEl=lastDownEl=cloneHidden=tapEvt=touchEvt=moved=newIndex=newDraggableIndex=oldIndex=oldDraggableIndex=lastTarget=lastDirection=putSortable=activeGroup=Sortable.dragged=Sortable.ghost=Sortable.clone=Sortable.active=null;savedInputChecked.forEach(function(el){el.checked=true;});savedInputChecked.length=lastDx=lastDy=0;},handleEvent:function handleEvent(/**Event*/evt){switch(evt.type){case'drop':case'dragend':this._onDrop(evt);break;case'dragenter':case'dragover':if(dragEl){this._onDragOver(evt);_globalDragOver(evt);}break;case'selectstart':evt.preventDefault();break;}},/**
			   * Serializes the item into an array of string.
			   * @returns {String[]}
			   */toArray:function toArray(){var order=[],el,children=this.el.children,i=0,n=children.length,options=this.options;for(;i<n;i++){el=children[i];if(closest(el,options.draggable,this.el,false)){order.push(el.getAttribute(options.dataIdAttr)||_generateId(el));}}return order;},/**
			   * Sorts the elements according to the array.
			   * @param  {String[]}  order  order of the items
			   */sort:function sort(order,useAnimation){var items={},rootEl=this.el;this.toArray().forEach(function(id,i){var el=rootEl.children[i];if(closest(el,this.options.draggable,rootEl,false)){items[id]=el;}},this);useAnimation&&this.captureAnimationState();order.forEach(function(id){if(items[id]){rootEl.removeChild(items[id]);rootEl.appendChild(items[id]);}});useAnimation&&this.animateAll();},/**
			   * Save the current sorting
			   */save:function save(){var store=this.options.store;store&&store.set&&store.set(this);},/**
			   * For each element in the set, get the first element that matches the selector by testing the element itself and traversing up through its ancestors in the DOM tree.
			   * @param   {HTMLElement}  el
			   * @param   {String}       [selector]  default: `options.draggable`
			   * @returns {HTMLElement|null}
			   */closest:function closest$1(el,selector){return closest(el,selector||this.options.draggable,this.el,false);},/**
			   * Set/get option
			   * @param   {string} name
			   * @param   {*}      [value]
			   * @returns {*}
			   */option:function option(name,value){var options=this.options;if(value===void 0){return options[name];}else{var modifiedValue=PluginManager.modifyOption(this,name,value);if(typeof modifiedValue!=='undefined'){options[name]=modifiedValue;}else{options[name]=value;}if(name==='group'){_prepareGroup(options);}}},/**
			   * Destroy
			   */destroy:function destroy(){pluginEvent('destroy',this);var el=this.el;el[expando]=null;off(el,'mousedown',this._onTapStart);off(el,'touchstart',this._onTapStart);off(el,'pointerdown',this._onTapStart);if(this.nativeDraggable){off(el,'dragover',this);off(el,'dragenter',this);}// Remove draggable attributes
Array.prototype.forEach.call(el.querySelectorAll('[draggable]'),function(el){el.removeAttribute('draggable');});this._onDrop();this._disableDelayedDragEvents();sortables.splice(sortables.indexOf(this.el),1);this.el=el=null;},_hideClone:function _hideClone(){if(!cloneHidden){pluginEvent('hideClone',this);if(Sortable.eventCanceled)return;css(cloneEl,'display','none');if(this.options.removeCloneOnHide&&cloneEl.parentNode){cloneEl.parentNode.removeChild(cloneEl);}cloneHidden=true;}},_showClone:function _showClone(putSortable){if(putSortable.lastPutMode!=='clone'){this._hideClone();return;}if(cloneHidden){pluginEvent('showClone',this);if(Sortable.eventCanceled)return;// show clone at dragEl or original position
if(dragEl.parentNode==rootEl&&!this.options.group.revertClone){rootEl.insertBefore(cloneEl,dragEl);}else if(nextEl){rootEl.insertBefore(cloneEl,nextEl);}else{rootEl.appendChild(cloneEl);}if(this.options.group.revertClone){this.animate(dragEl,cloneEl);}css(cloneEl,'display','');cloneHidden=false;}}};function _globalDragOver(/**Event*/evt){if(evt.dataTransfer){evt.dataTransfer.dropEffect='move';}evt.cancelable&&evt.preventDefault();}function _onMove(fromEl,toEl,dragEl,dragRect,targetEl,targetRect,originalEvent,willInsertAfter){var evt,sortable=fromEl[expando],onMoveFn=sortable.options.onMove,retVal;// Support for new CustomEvent feature
if(window.CustomEvent&&!IE11OrLess&&!Edge){evt=new CustomEvent('move',{bubbles:true,cancelable:true});}else{evt=document.createEvent('Event');evt.initEvent('move',true,true);}evt.to=toEl;evt.from=fromEl;evt.dragged=dragEl;evt.draggedRect=dragRect;evt.related=targetEl||toEl;evt.relatedRect=targetRect||getRect(toEl);evt.willInsertAfter=willInsertAfter;evt.originalEvent=originalEvent;fromEl.dispatchEvent(evt);if(onMoveFn){retVal=onMoveFn.call(sortable,evt,originalEvent);}return retVal;}function _disableDraggable(el){el.draggable=false;}function _unsilent(){_silent=false;}function _ghostIsFirst(evt,vertical,sortable){var rect=getRect(getChild(sortable.el,0,sortable.options,true));var spacer=10;return vertical?evt.clientX<rect.left-spacer||evt.clientY<rect.top&&evt.clientX<rect.right:evt.clientY<rect.top-spacer||evt.clientY<rect.bottom&&evt.clientX<rect.left;}function _ghostIsLast(evt,vertical,sortable){var rect=getRect(lastChild(sortable.el,sortable.options.draggable));var spacer=10;return vertical?evt.clientX>rect.right+spacer||evt.clientX<=rect.right&&evt.clientY>rect.bottom&&evt.clientX>=rect.left:evt.clientX>rect.right&&evt.clientY>rect.top||evt.clientX<=rect.right&&evt.clientY>rect.bottom+spacer;}function _getSwapDirection(evt,target,targetRect,vertical,swapThreshold,invertedSwapThreshold,invertSwap,isLastTarget){var mouseOnAxis=vertical?evt.clientY:evt.clientX,targetLength=vertical?targetRect.height:targetRect.width,targetS1=vertical?targetRect.top:targetRect.left,targetS2=vertical?targetRect.bottom:targetRect.right,invert=false;if(!invertSwap){// Never invert or create dragEl shadow when target movemenet causes mouse to move past the end of regular swapThreshold
if(isLastTarget&&targetMoveDistance<targetLength*swapThreshold){// multiplied only by swapThreshold because mouse will already be inside target by (1 - threshold) * targetLength / 2
// check if past first invert threshold on side opposite of lastDirection
if(!pastFirstInvertThresh&&(lastDirection===1?mouseOnAxis>targetS1+targetLength*invertedSwapThreshold/2:mouseOnAxis<targetS2-targetLength*invertedSwapThreshold/2)){// past first invert threshold, do not restrict inverted threshold to dragEl shadow
pastFirstInvertThresh=true;}if(!pastFirstInvertThresh){// dragEl shadow (target move distance shadow)
if(lastDirection===1?mouseOnAxis<targetS1+targetMoveDistance// over dragEl shadow
:mouseOnAxis>targetS2-targetMoveDistance){return-lastDirection;}}else{invert=true;}}else{// Regular
if(mouseOnAxis>targetS1+targetLength*(1-swapThreshold)/2&&mouseOnAxis<targetS2-targetLength*(1-swapThreshold)/2){return _getInsertDirection(target);}}}invert=invert||invertSwap;if(invert){// Invert of regular
if(mouseOnAxis<targetS1+targetLength*invertedSwapThreshold/2||mouseOnAxis>targetS2-targetLength*invertedSwapThreshold/2){return mouseOnAxis>targetS1+targetLength/2?1:-1;}}return 0;}/**
			 * Gets the direction dragEl must be swapped relative to target in order to make it
			 * seem that dragEl has been "inserted" into that element's position
			 * @param  {HTMLElement} target       The target whose position dragEl is being inserted at
			 * @return {Number}                   Direction dragEl must be swapped
			 */function _getInsertDirection(target){if(index$1(dragEl)<index$1(target)){return 1;}else{return-1;}}/**
			 * Generate id
			 * @param   {HTMLElement} el
			 * @returns {String}
			 * @private
			 */function _generateId(el){var str=el.tagName+el.className+el.src+el.href+el.textContent,i=str.length,sum=0;while(i--){sum+=str.charCodeAt(i);}return sum.toString(36);}function _saveInputCheckedState(root){savedInputChecked.length=0;var inputs=root.getElementsByTagName('input');var idx=inputs.length;while(idx--){var el=inputs[idx];el.checked&&savedInputChecked.push(el);}}function _nextTick(fn){return setTimeout(fn,0);}function _cancelNextTick(id){return clearTimeout(id);}// Fixed #973:
if(documentExists){on(document,'touchmove',function(evt){if((Sortable.active||awaitingDragStarted)&&evt.cancelable){evt.preventDefault();}});}// Export utils
Sortable.utils={on:on,off:off,css:css,find:find,is:function is(el,selector){return!!closest(el,selector,el,false);},extend:extend$1,throttle:throttle$1,closest:closest,toggleClass:toggleClass,clone:clone$1,index:index$1,nextTick:_nextTick,cancelNextTick:_cancelNextTick,detectDirection:_detectDirection,getChild:getChild};/**
			 * Get the Sortable instance of an element
			 * @param  {HTMLElement} element The element
			 * @return {Sortable|undefined}         The instance of Sortable
			 */Sortable.get=function(element){return element[expando];};/**
			 * Mount a plugin to Sortable
			 * @param  {...SortablePlugin|SortablePlugin[]} plugins       Plugins being mounted
			 */Sortable.mount=function(){for(var _len=arguments.length,plugins=new Array(_len),_key=0;_key<_len;_key++){plugins[_key]=arguments[_key];}if(plugins[0].constructor===Array)plugins=plugins[0];plugins.forEach(function(plugin){if(!plugin.prototype||!plugin.prototype.constructor){throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(plugin));}if(plugin.utils)Sortable.utils=_objectSpread2(_objectSpread2({},Sortable.utils),plugin.utils);PluginManager.mount(plugin);});};/**
			 * Create sortable instance
			 * @param {HTMLElement}  el
			 * @param {Object}      [options]
			 */Sortable.create=function(el,options){return new Sortable(el,options);};// Export
Sortable.version=version;var autoScrolls=[],scrollEl,scrollRootEl,scrolling=false,lastAutoScrollX,lastAutoScrollY,touchEvt$1,pointerElemChangedInterval;function AutoScrollPlugin(){function AutoScroll(){this.defaults={scroll:true,forceAutoScrollFallback:false,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:true};// Bind all private methods
for(var fn in this){if(fn.charAt(0)==='_'&&typeof this[fn]==='function'){this[fn]=this[fn].bind(this);}}}AutoScroll.prototype={dragStarted:function dragStarted(_ref){var originalEvent=_ref.originalEvent;if(this.sortable.nativeDraggable){on(document,'dragover',this._handleAutoScroll);}else{if(this.options.supportPointer){on(document,'pointermove',this._handleFallbackAutoScroll);}else if(originalEvent.touches){on(document,'touchmove',this._handleFallbackAutoScroll);}else{on(document,'mousemove',this._handleFallbackAutoScroll);}}},dragOverCompleted:function dragOverCompleted(_ref2){var originalEvent=_ref2.originalEvent;// For when bubbling is canceled and using fallback (fallback 'touchmove' always reached)
if(!this.options.dragOverBubble&&!originalEvent.rootEl){this._handleAutoScroll(originalEvent);}},drop:function drop(){if(this.sortable.nativeDraggable){off(document,'dragover',this._handleAutoScroll);}else{off(document,'pointermove',this._handleFallbackAutoScroll);off(document,'touchmove',this._handleFallbackAutoScroll);off(document,'mousemove',this._handleFallbackAutoScroll);}clearPointerElemChangedInterval();clearAutoScrolls();cancelThrottle();},nulling:function nulling(){touchEvt$1=scrollRootEl=scrollEl=scrolling=pointerElemChangedInterval=lastAutoScrollX=lastAutoScrollY=null;autoScrolls.length=0;},_handleFallbackAutoScroll:function _handleFallbackAutoScroll(evt){this._handleAutoScroll(evt,true);},_handleAutoScroll:function _handleAutoScroll(evt,fallback){var _this=this;var x=(evt.touches?evt.touches[0]:evt).clientX,y=(evt.touches?evt.touches[0]:evt).clientY,elem=document.elementFromPoint(x,y);touchEvt$1=evt;// IE does not seem to have native autoscroll,
// Edge's autoscroll seems too conditional,
// MACOS Safari does not have autoscroll,
// Firefox and Chrome are good
if(fallback||this.options.forceAutoScrollFallback||Edge||IE11OrLess||Safari){autoScroll(evt,this.options,elem,fallback);// Listener for pointer element change
var ogElemScroller=getParentAutoScrollElement(elem,true);if(scrolling&&(!pointerElemChangedInterval||x!==lastAutoScrollX||y!==lastAutoScrollY)){pointerElemChangedInterval&&clearPointerElemChangedInterval();// Detect for pointer elem change, emulating native DnD behaviour
pointerElemChangedInterval=setInterval(function(){var newElem=getParentAutoScrollElement(document.elementFromPoint(x,y),true);if(newElem!==ogElemScroller){ogElemScroller=newElem;clearAutoScrolls();}autoScroll(evt,_this.options,newElem,fallback);},10);lastAutoScrollX=x;lastAutoScrollY=y;}}else{// if DnD is enabled (and browser has good autoscrolling), first autoscroll will already scroll, so get parent autoscroll of first autoscroll
if(!this.options.bubbleScroll||getParentAutoScrollElement(elem,true)===getWindowScrollingElement()){clearAutoScrolls();return;}autoScroll(evt,this.options,getParentAutoScrollElement(elem,false),false);}}};return _extends$4(AutoScroll,{pluginName:'scroll',initializeByDefault:true});}function clearAutoScrolls(){autoScrolls.forEach(function(autoScroll){clearInterval(autoScroll.pid);});autoScrolls=[];}function clearPointerElemChangedInterval(){clearInterval(pointerElemChangedInterval);}var autoScroll=throttle$1(function(evt,options,rootEl,isFallback){// Bug: https://bugzilla.mozilla.org/show_bug.cgi?id=505521
if(!options.scroll)return;var x=(evt.touches?evt.touches[0]:evt).clientX,y=(evt.touches?evt.touches[0]:evt).clientY,sens=options.scrollSensitivity,speed=options.scrollSpeed,winScroller=getWindowScrollingElement();var scrollThisInstance=false,scrollCustomFn;// New scroll root, set scrollEl
if(scrollRootEl!==rootEl){scrollRootEl=rootEl;clearAutoScrolls();scrollEl=options.scroll;scrollCustomFn=options.scrollFn;if(scrollEl===true){scrollEl=getParentAutoScrollElement(rootEl,true);}}var layersOut=0;var currentParent=scrollEl;do{var el=currentParent,rect=getRect(el),top=rect.top,bottom=rect.bottom,left=rect.left,right=rect.right,width=rect.width,height=rect.height,canScrollX=void 0,canScrollY=void 0,scrollWidth=el.scrollWidth,scrollHeight=el.scrollHeight,elCSS=css(el),scrollPosX=el.scrollLeft,scrollPosY=el.scrollTop;if(el===winScroller){canScrollX=width<scrollWidth&&(elCSS.overflowX==='auto'||elCSS.overflowX==='scroll'||elCSS.overflowX==='visible');canScrollY=height<scrollHeight&&(elCSS.overflowY==='auto'||elCSS.overflowY==='scroll'||elCSS.overflowY==='visible');}else{canScrollX=width<scrollWidth&&(elCSS.overflowX==='auto'||elCSS.overflowX==='scroll');canScrollY=height<scrollHeight&&(elCSS.overflowY==='auto'||elCSS.overflowY==='scroll');}var vx=canScrollX&&(Math.abs(right-x)<=sens&&scrollPosX+width<scrollWidth)-(Math.abs(left-x)<=sens&&!!scrollPosX);var vy=canScrollY&&(Math.abs(bottom-y)<=sens&&scrollPosY+height<scrollHeight)-(Math.abs(top-y)<=sens&&!!scrollPosY);if(!autoScrolls[layersOut]){for(var i=0;i<=layersOut;i++){if(!autoScrolls[i]){autoScrolls[i]={};}}}if(autoScrolls[layersOut].vx!=vx||autoScrolls[layersOut].vy!=vy||autoScrolls[layersOut].el!==el){autoScrolls[layersOut].el=el;autoScrolls[layersOut].vx=vx;autoScrolls[layersOut].vy=vy;clearInterval(autoScrolls[layersOut].pid);if(vx!=0||vy!=0){scrollThisInstance=true;/* jshint loopfunc:true */autoScrolls[layersOut].pid=setInterval(function(){// emulate drag over during autoscroll (fallback), emulating native DnD behaviour
if(isFallback&&this.layer===0){Sortable.active._onTouchMove(touchEvt$1);// To move ghost if it is positioned absolutely
}var scrollOffsetY=autoScrolls[this.layer].vy?autoScrolls[this.layer].vy*speed:0;var scrollOffsetX=autoScrolls[this.layer].vx?autoScrolls[this.layer].vx*speed:0;if(typeof scrollCustomFn==='function'){if(scrollCustomFn.call(Sortable.dragged.parentNode[expando],scrollOffsetX,scrollOffsetY,evt,touchEvt$1,autoScrolls[this.layer].el)!=='continue'){return;}}scrollBy(autoScrolls[this.layer].el,scrollOffsetX,scrollOffsetY);}.bind({layer:layersOut}),24);}}layersOut++;}while(options.bubbleScroll&&currentParent!==winScroller&&(currentParent=getParentAutoScrollElement(currentParent,false)));scrolling=scrollThisInstance;// in case another function catches scrolling as false in between when it is not
},30);var drop=function drop(_ref){var originalEvent=_ref.originalEvent,putSortable=_ref.putSortable,dragEl=_ref.dragEl,activeSortable=_ref.activeSortable,dispatchSortableEvent=_ref.dispatchSortableEvent,hideGhostForTarget=_ref.hideGhostForTarget,unhideGhostForTarget=_ref.unhideGhostForTarget;if(!originalEvent)return;var toSortable=putSortable||activeSortable;hideGhostForTarget();var touch=originalEvent.changedTouches&&originalEvent.changedTouches.length?originalEvent.changedTouches[0]:originalEvent;var target=document.elementFromPoint(touch.clientX,touch.clientY);unhideGhostForTarget();if(toSortable&&!toSortable.el.contains(target)){dispatchSortableEvent('spill');this.onSpill({dragEl:dragEl,putSortable:putSortable});}};function Revert(){}Revert.prototype={startIndex:null,dragStart:function dragStart(_ref2){var oldDraggableIndex=_ref2.oldDraggableIndex;this.startIndex=oldDraggableIndex;},onSpill:function onSpill(_ref3){var dragEl=_ref3.dragEl,putSortable=_ref3.putSortable;this.sortable.captureAnimationState();if(putSortable){putSortable.captureAnimationState();}var nextSibling=getChild(this.sortable.el,this.startIndex,this.options);if(nextSibling){this.sortable.el.insertBefore(dragEl,nextSibling);}else{this.sortable.el.appendChild(dragEl);}this.sortable.animateAll();if(putSortable){putSortable.animateAll();}},drop:drop};_extends$4(Revert,{pluginName:'revertOnSpill'});function Remove(){}Remove.prototype={onSpill:function onSpill(_ref4){var dragEl=_ref4.dragEl,putSortable=_ref4.putSortable;var parentSortable=putSortable||this.sortable;parentSortable.captureAnimationState();dragEl.parentNode&&dragEl.parentNode.removeChild(dragEl);parentSortable.animateAll();},drop:drop};_extends$4(Remove,{pluginName:'removeOnSpill'});var lastSwapEl;function SwapPlugin(){function Swap(){this.defaults={swapClass:'sortable-swap-highlight'};}Swap.prototype={dragStart:function dragStart(_ref){var dragEl=_ref.dragEl;lastSwapEl=dragEl;},dragOverValid:function dragOverValid(_ref2){var completed=_ref2.completed,target=_ref2.target,onMove=_ref2.onMove,activeSortable=_ref2.activeSortable,changed=_ref2.changed,cancel=_ref2.cancel;if(!activeSortable.options.swap)return;var el=this.sortable.el,options=this.options;if(target&&target!==el){var prevSwapEl=lastSwapEl;if(onMove(target)!==false){toggleClass(target,options.swapClass,true);lastSwapEl=target;}else{lastSwapEl=null;}if(prevSwapEl&&prevSwapEl!==lastSwapEl){toggleClass(prevSwapEl,options.swapClass,false);}}changed();completed(true);cancel();},drop:function drop(_ref3){var activeSortable=_ref3.activeSortable,putSortable=_ref3.putSortable,dragEl=_ref3.dragEl;var toSortable=putSortable||this.sortable;var options=this.options;lastSwapEl&&toggleClass(lastSwapEl,options.swapClass,false);if(lastSwapEl&&(options.swap||putSortable&&putSortable.options.swap)){if(dragEl!==lastSwapEl){toSortable.captureAnimationState();if(toSortable!==activeSortable)activeSortable.captureAnimationState();swapNodes(dragEl,lastSwapEl);toSortable.animateAll();if(toSortable!==activeSortable)activeSortable.animateAll();}}},nulling:function nulling(){lastSwapEl=null;}};return _extends$4(Swap,{pluginName:'swap',eventProperties:function eventProperties(){return{swapItem:lastSwapEl};}});}function swapNodes(n1,n2){var p1=n1.parentNode,p2=n2.parentNode,i1,i2;if(!p1||!p2||p1.isEqualNode(n2)||p2.isEqualNode(n1))return;i1=index$1(n1);i2=index$1(n2);if(p1.isEqualNode(p2)&&i1<i2){i2++;}p1.insertBefore(n2,p1.children[i1]);p2.insertBefore(n1,p2.children[i2]);}Sortable.mount(new AutoScrollPlugin());Sortable.mount(Remove,Revert);var DEFAULT_PLAY_INDEX=0;var DEFAULT_VOLUME=1;var DEFAULT_REMOVE_ID=-1;var PLAYER_KEY='__PLAYER_KEY__';var SORTABLE_CONFIG={selector:'audio-lists-panel-content-wrap',swapClass:'audio-lists-panel-sortable-highlight-bg',swap:true,animation:100,easing:'cubic-bezier(0.43, -0.1, 0.16, 1.1)'};var AudioListsPanel=function AudioListsPanel(_ref){var audioLists=_ref.audioLists,onCancel=_ref.onCancel,onDelete=_ref.onDelete,onPlay=_ref.onPlay,playId=_ref.playId,loading=_ref.loading,panelToggleAnimate=_ref.panelToggleAnimate,glassBg=_ref.glassBg,remove=_ref.remove,removeId=_ref.removeId,isMobile=_ref.isMobile,locale=_ref.locale,icon=_ref.icon,playing=_ref.playing;return/*#__PURE__*/React$1.createElement("div",{className:cls('audio-lists-panel',panelToggleAnimate,{'audio-lists-panel-mobile':isMobile,'glass-bg':glassBg})},/*#__PURE__*/React$1.createElement("div",{className:"audio-lists-panel-header"},/*#__PURE__*/React$1.createElement("h2",{className:"audio-lists-panel-header-title"},/*#__PURE__*/React$1.createElement("span",null,locale.playListsText," / "),/*#__PURE__*/React$1.createElement("span",{className:"audio-lists-panel-header-num"},audioLists.length),/*#__PURE__*/React$1.createElement("span",{className:"audio-lists-panel-header-actions"},remove&&/*#__PURE__*/React$1.createElement(React$1.Fragment,null,/*#__PURE__*/React$1.createElement("span",{className:"audio-lists-panel-header-delete-btn",title:locale.removeAudioListsText,onClick:onDelete()},icon["delete"]),/*#__PURE__*/React$1.createElement("span",{className:"audio-lists-panel-header-line"})),/*#__PURE__*/React$1.createElement("span",{className:"audio-lists-panel-header-close-btn",title:locale.closeText,onClick:onCancel},isMobile?icon.packUpPanelMobile:icon.close)))),/*#__PURE__*/React$1.createElement("div",{className:cls('audio-lists-panel-content',{'no-content':audioLists.length<1})},audioLists.length>=1?/*#__PURE__*/React$1.createElement("ul",{className:SORTABLE_CONFIG.selector},audioLists.map(function(audio){var name=audio.name,singer=audio.singer;var audioId=audio[PLAYER_KEY];var isCurrentPlaying=playId===audioId;return/*#__PURE__*/React$1.createElement("li",{key:audioId,title:!playing?locale.clickToPlayText:isCurrentPlaying?locale.clickToPauseText:locale.clickToPlayText,className:cls('audio-item',{playing:isCurrentPlaying},{pause:!playing},{remove:removeId===audioId}),onClick:function onClick(){return onPlay(audioId);}},/*#__PURE__*/React$1.createElement("span",{className:"group player-status"},/*#__PURE__*/React$1.createElement("span",{className:"player-icons"},isCurrentPlaying&&loading?icon.loading:isCurrentPlaying?playing?icon.pause:icon.play:undefined)),/*#__PURE__*/React$1.createElement("span",{className:"group player-name",title:name},name),/*#__PURE__*/React$1.createElement("span",{className:"group player-singer",title:singer},singer),remove&&/*#__PURE__*/React$1.createElement("span",{className:"group player-delete",title:locale.clickToDeleteText(name),onClick:onDelete(audioId)},icon.close));})):/*#__PURE__*/React$1.createElement(React$1.Fragment,null,/*#__PURE__*/React$1.createElement("span",null,icon.empty),/*#__PURE__*/React$1.createElement("span",{className:"no-data"},locale.emptyText||locale.notContentText))));};var AudioListsPanel$1=/*#__PURE__*/react.exports.memo(AudioListsPanel);// 迷你模式进度条
var CircleProcessBar=function CircleProcessBar(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$progress=_ref.progress,progress=_ref$progress===void 0?0:_ref$progress,_ref$r=_ref.r,r=_ref$r===void 0?40:_ref$r;var currentProgress=progress.toFixed(2);var perimeter=Math.PI*2*r;var strokeDasharray="".concat(Math.floor(perimeter*currentProgress)," ").concat(Math.floor(perimeter*(1-currentProgress)));return/*#__PURE__*/React$1.createElement("svg",{className:"audio-circle-process-bar"},/*#__PURE__*/React$1.createElement("circle",{cx:r,cy:r,r:r-1,fill:"none",className:"stroke",strokeDasharray:strokeDasharray}),/*#__PURE__*/React$1.createElement("circle",{cx:r,cy:r,r:r-1,fill:"none",className:"bg",strokeDasharray:"0 1000"}));};var CircleProcessBar$1=/*#__PURE__*/react.exports.memo(CircleProcessBar);var IconsManifest=[{"id":"fa","name":"Font Awesome","projectUrl":"https://fontawesome.com/","license":"CC BY 4.0 License","licenseUrl":"https://creativecommons.org/licenses/by/4.0/"},{"id":"io","name":"Ionicons 4","projectUrl":"https://ionicons.com/","license":"MIT","licenseUrl":"https://github.com/ionic-team/ionicons/blob/master/LICENSE"},{"id":"io5","name":"Ionicons 5","projectUrl":"https://ionicons.com/","license":"MIT","licenseUrl":"https://github.com/ionic-team/ionicons/blob/master/LICENSE"},{"id":"md","name":"Material Design icons","projectUrl":"http://google.github.io/material-design-icons/","license":"Apache License Version 2.0","licenseUrl":"https://github.com/google/material-design-icons/blob/master/LICENSE"},{"id":"ti","name":"Typicons","projectUrl":"http://s-ings.com/typicons/","license":"CC BY-SA 3.0","licenseUrl":"https://creativecommons.org/licenses/by-sa/3.0/"},{"id":"go","name":"Github Octicons icons","projectUrl":"https://octicons.github.com/","license":"MIT","licenseUrl":"https://github.com/primer/octicons/blob/master/LICENSE"},{"id":"fi","name":"Feather","projectUrl":"https://feathericons.com/","license":"MIT","licenseUrl":"https://github.com/feathericons/feather/blob/master/LICENSE"},{"id":"gi","name":"Game Icons","projectUrl":"https://game-icons.net/","license":"CC BY 3.0","licenseUrl":"https://creativecommons.org/licenses/by/3.0/"},{"id":"wi","name":"Weather Icons","projectUrl":"https://erikflowers.github.io/weather-icons/","license":"SIL OFL 1.1","licenseUrl":"http://scripts.sil.org/OFL"},{"id":"di","name":"Devicons","projectUrl":"https://vorillaz.github.io/devicons/","license":"MIT","licenseUrl":"https://opensource.org/licenses/MIT"},{"id":"ai","name":"Ant Design Icons","projectUrl":"https://github.com/ant-design/ant-design-icons","license":"MIT","licenseUrl":"https://opensource.org/licenses/MIT"},{"id":"bs","name":"Bootstrap Icons","projectUrl":"https://github.com/twbs/icons","license":"MIT","licenseUrl":"https://opensource.org/licenses/MIT"},{"id":"ri","name":"Remix Icon","projectUrl":"https://github.com/Remix-Design/RemixIcon","license":"Apache License Version 2.0","licenseUrl":"http://www.apache.org/licenses/"},{"id":"fc","name":"Flat Color Icons","projectUrl":"https://github.com/icons8/flat-color-icons","license":"MIT","licenseUrl":"https://opensource.org/licenses/MIT"},{"id":"gr","name":"Grommet-Icons","projectUrl":"https://github.com/grommet/grommet-icons","license":"Apache License Version 2.0","licenseUrl":"http://www.apache.org/licenses/"},{"id":"hi","name":"Heroicons","projectUrl":"https://github.com/refactoringui/heroicons","license":"MIT","licenseUrl":"https://opensource.org/licenses/MIT"},{"id":"si","name":"Simple Icons","projectUrl":"https://simpleicons.org/","license":"CC0 1.0 Universal","licenseUrl":"https://creativecommons.org/publicdomain/zero/1.0/"},{"id":"im","name":"IcoMoon Free","projectUrl":"https://github.com/Keyamoon/IcoMoon-Free","license":"CC BY 4.0 License"},{"id":"bi","name":"BoxIcons","projectUrl":"https://github.com/atisawd/boxicons","license":"CC BY 4.0 License"},{"id":"cg","name":"css.gg","projectUrl":"https://github.com/astrit/css.gg","license":"MIT","licenseUrl":"https://opensource.org/licenses/MIT"},{"id":"vsc","name":"VS Code Icons","projectUrl":"https://github.com/microsoft/vscode-codicons","license":"CC BY 4.0","licenseUrl":"https://creativecommons.org/licenses/by/4.0/"}];var DefaultContext={color:undefined,size:undefined,className:undefined,style:undefined,attr:undefined};var IconContext=React$1.createContext&&React$1.createContext(DefaultContext);var __assign=globalThis&&globalThis.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s){if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p];}}return t;};return __assign.apply(this,arguments);};var __rest=globalThis&&globalThis.__rest||function(s,e){var t={};for(var p in s){if(Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0)t[p]=s[p];}if(s!=null&&typeof Object.getOwnPropertySymbols==="function")for(var i=0,p=Object.getOwnPropertySymbols(s);i<p.length;i++){if(e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i]))t[p[i]]=s[p[i]];}return t;};function Tree2Element(tree){return tree&&tree.map(function(node,i){return React$1.createElement(node.tag,__assign({key:i},node.attr),Tree2Element(node.child));});}function GenIcon$l(data){return function(props){return React$1.createElement(IconBase,__assign({attr:__assign({},data.attr)},props),Tree2Element(data.child));};}function IconBase(props){var elem=function elem(conf){var attr=props.attr,size=props.size,title=props.title,svgProps=__rest(props,["attr","size","title"]);var computedSize=size||conf.size||"1em";var className;if(conf.className)className=conf.className;if(props.className)className=(className?className+' ':'')+props.className;return React$1.createElement("svg",__assign({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},conf.attr,attr,svgProps,{className:className,style:__assign(__assign({color:props.color||conf.color},conf.style),props.style),height:computedSize,width:computedSize,xmlns:"http://www.w3.org/2000/svg"}),title&&React$1.createElement("title",null,title),props.children);};return IconContext!==undefined?React$1.createElement(IconContext.Consumer,null,function(conf){return elem(conf);}):elem(DefaultContext);}var esm=/*#__PURE__*/Object.freeze((_Object$freeze={__proto__:null},_defineProperty3(_Object$freeze,Symbol.toStringTag,'Module'),_defineProperty3(_Object$freeze,"IconsManifest",IconsManifest),_defineProperty3(_Object$freeze,"GenIcon",GenIcon$l),_defineProperty3(_Object$freeze,"IconBase",IconBase),_defineProperty3(_Object$freeze,"DefaultContext",DefaultContext),_defineProperty3(_Object$freeze,"IconContext",IconContext),_Object$freeze));var require$$0=/*@__PURE__*/getAugmentedNamespace(esm);// THIS FILE IS AUTO GENERATED
var GenIcon$k=require$$0.GenIcon;var FaPauseCircle_1=function FaPauseCircle(props){return GenIcon$k({"tag":"svg","attr":{"viewBox":"0 0 512 512"},"child":[{"tag":"path","attr":{"d":"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm-16 328c0 8.8-7.2 16-16 16h-48c-8.8 0-16-7.2-16-16V176c0-8.8 7.2-16 16-16h48c8.8 0 16 7.2 16 16v160zm112 0c0 8.8-7.2 16-16 16h-48c-8.8 0-16-7.2-16-16V176c0-8.8 7.2-16 16-16h48c8.8 0 16 7.2 16 16v160z"}}]})(props);};// THIS FILE IS AUTO GENERATED
var GenIcon$j=require$$0.GenIcon;var FaPlayCircle_1=function FaPlayCircle(props){return GenIcon$j({"tag":"svg","attr":{"viewBox":"0 0 512 512"},"child":[{"tag":"path","attr":{"d":"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z"}}]})(props);};// THIS FILE IS AUTO GENERATED
var GenIcon$i=require$$0.GenIcon;var FaBook_1=function FaBook(props){return GenIcon$i({"tag":"svg","attr":{"viewBox":"0 0 448 512"},"child":[{"tag":"path","attr":{"d":"M448 360V24c0-13.3-10.7-24-24-24H96C43 0 0 43 0 96v320c0 53 43 96 96 96h328c13.3 0 24-10.7 24-24v-16c0-7.5-3.5-14.3-8.9-18.7-4.2-15.4-4.2-59.3 0-74.7 5.4-4.3 8.9-11.1 8.9-18.6zM128 134c0-3.3 2.7-6 6-6h212c3.3 0 6 2.7 6 6v20c0 3.3-2.7 6-6 6H134c-3.3 0-6-2.7-6-6v-20zm0 64c0-3.3 2.7-6 6-6h212c3.3 0 6 2.7 6 6v20c0 3.3-2.7 6-6 6H134c-3.3 0-6-2.7-6-6v-20zm253.4 250H96c-17.7 0-32-14.3-32-32 0-17.6 14.4-32 32-32h285.4c-1.9 17.1-1.9 46.9 0 64z"}}]})(props);};// THIS FILE IS AUTO GENERATED
var GenIcon$h=require$$0.GenIcon;var FaHeadphones_1=function FaHeadphones(props){return GenIcon$h({"tag":"svg","attr":{"viewBox":"0 0 512 512"},"child":[{"tag":"path","attr":{"d":"M256 32C114.52 32 0 146.496 0 288v48a32 32 0 0 0 17.689 28.622l14.383 7.191C34.083 431.903 83.421 480 144 480h24c13.255 0 24-10.745 24-24V280c0-13.255-10.745-24-24-24h-24c-31.342 0-59.671 12.879-80 33.627V288c0-105.869 86.131-192 192-192s192 86.131 192 192v1.627C427.671 268.879 399.342 256 368 256h-24c-13.255 0-24 10.745-24 24v176c0 13.255 10.745 24 24 24h24c60.579 0 109.917-48.098 111.928-108.187l14.382-7.191A32 32 0 0 0 512 336v-48c0-141.479-114.496-256-256-256z"}}]})(props);};// THIS FILE IS AUTO GENERATED
var GenIcon$g=require$$0.GenIcon;var FaRegMinusSquare_1=function FaRegMinusSquare(props){return GenIcon$g({"tag":"svg","attr":{"viewBox":"0 0 448 512"},"child":[{"tag":"path","attr":{"d":"M108 284c-6.6 0-12-5.4-12-12v-32c0-6.6 5.4-12 12-12h232c6.6 0 12 5.4 12 12v32c0 6.6-5.4 12-12 12H108zM448 80v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V80c0-26.5 21.5-48 48-48h352c26.5 0 48 21.5 48 48zm-48 346V86c0-3.3-2.7-6-6-6H54c-3.3 0-6 2.7-6 6v340c0 3.3 2.7 6 6 6h340c3.3 0 6-2.7 6-6z"}}]})(props);};// THIS FILE IS AUTO GENERATED
var GenIcon$f=require$$0.GenIcon;var FaSpinner_1=function FaSpinner(props){return GenIcon$f({"tag":"svg","attr":{"viewBox":"0 0 512 512"},"child":[{"tag":"path","attr":{"d":"M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"}}]})(props);};// THIS FILE IS AUTO GENERATED
var GenIcon$e=require$$0.GenIcon;var FaSyncAlt_1=function FaSyncAlt(props){return GenIcon$e({"tag":"svg","attr":{"viewBox":"0 0 512 512"},"child":[{"tag":"path","attr":{"d":"M370.72 133.28C339.458 104.008 298.888 87.962 255.848 88c-77.458.068-144.328 53.178-162.791 126.85-1.344 5.363-6.122 9.15-11.651 9.15H24.103c-7.498 0-13.194-6.807-11.807-14.176C33.933 94.924 134.813 8 256 8c66.448 0 126.791 26.136 171.315 68.685L463.03 40.97C478.149 25.851 504 36.559 504 57.941V192c0 13.255-10.745 24-24 24H345.941c-21.382 0-32.09-25.851-16.971-40.971l41.75-41.749zM32 296h134.059c21.382 0 32.09 25.851 16.971 40.971l-41.75 41.75c31.262 29.273 71.835 45.319 114.876 45.28 77.418-.07 144.315-53.144 162.787-126.849 1.344-5.363 6.122-9.15 11.651-9.15h57.304c7.498 0 13.194 6.807 11.807 14.176C478.067 417.076 377.187 504 256 504c-66.448 0-126.791-26.136-171.315-68.685L48.97 471.03C33.851 486.149 8 475.441 8 454.059V320c0-13.255 10.745-24 24-24z"}}]})(props);};// THIS FILE IS AUTO GENERATED
var GenIcon$d=require$$0.GenIcon;var FiChevronsDown_1=function FiChevronsDown(props){return GenIcon$d({"tag":"svg","attr":{"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":"2","strokeLinecap":"round","strokeLinejoin":"round"},"child":[{"tag":"polyline","attr":{"points":"7 13 12 18 17 13"}},{"tag":"polyline","attr":{"points":"7 6 12 11 17 6"}}]})(props);};// THIS FILE IS AUTO GENERATED
var GenIcon$c=require$$0.GenIcon;var GoMute_1=function GoMute(props){return GenIcon$c({"tag":"svg","attr":{"viewBox":"0 0 16 16"},"child":[{"tag":"path","attr":{"fillRule":"evenodd","d":"M8 2.81v10.38c0 .67-.81 1-1.28.53L3 10H1c-.55 0-1-.45-1-1V7c0-.55.45-1 1-1h2l3.72-3.72C7.19 1.81 8 2.14 8 2.81zm7.53 3.22l-1.06-1.06-1.97 1.97-1.97-1.97-1.06 1.06L11.44 8 9.47 9.97l1.06 1.06 1.97-1.97 1.97 1.97 1.06-1.06L13.56 8l1.97-1.97z"}}]})(props);};// THIS FILE IS AUTO GENERATED
var GenIcon$b=require$$0.GenIcon;var GoUnmute_1=function GoUnmute(props){return GenIcon$b({"tag":"svg","attr":{"viewBox":"0 0 16 16"},"child":[{"tag":"path","attr":{"fillRule":"evenodd","d":"M12 8.02c0 1.09-.45 2.09-1.17 2.83l-.67-.67c.55-.56.89-1.31.89-2.16 0-.85-.34-1.61-.89-2.16l.67-.67A3.99 3.99 0 0 1 12 8.02zM7.72 2.28L4 6H2c-.55 0-1 .45-1 1v2c0 .55.45 1 1 1h2l3.72 3.72c.47.47 1.28.14 1.28-.53V2.81c0-.67-.81-1-1.28-.53zm5.94.08l-.67.67a6.996 6.996 0 0 1 2.06 4.98c0 1.94-.78 3.7-2.06 4.98l.67.67A7.973 7.973 0 0 0 16 8c0-2.22-.89-4.22-2.34-5.66v.02zm-1.41 1.41l-.69.67a5.05 5.05 0 0 1 1.48 3.58c0 1.39-.56 2.66-1.48 3.56l.69.67A5.971 5.971 0 0 0 14 8.02c0-1.65-.67-3.16-1.75-4.25z"}}]})(props);};// THIS FILE IS AUTO GENERATED
var GenIcon$a=require$$0.GenIcon;var MdClose_1=function MdClose(props){return GenIcon$a({"tag":"svg","attr":{"viewBox":"0 0 24 24"},"child":[{"tag":"path","attr":{"d":"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}}]})(props);};// THIS FILE IS AUTO GENERATED
var GenIcon$9=require$$0.GenIcon;var MdLibraryMusic_1=function MdLibraryMusic(props){return GenIcon$9({"tag":"svg","attr":{"viewBox":"0 0 24 24"},"child":[{"tag":"path","attr":{"d":"M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 5h-3v5.5c0 1.38-1.12 2.5-2.5 2.5S10 13.88 10 12.5s1.12-2.5 2.5-2.5c.57 0 1.08.19 1.5.51V5h4v2zM4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6z"}}]})(props);};// THIS FILE IS AUTO GENERATED
var GenIcon$8=require$$0.GenIcon;var MdRepeat_1=function MdRepeat(props){return GenIcon$8({"tag":"svg","attr":{"viewBox":"0 0 24 24"},"child":[{"tag":"path","attr":{"d":"M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"}}]})(props);};// THIS FILE IS AUTO GENERATED
var GenIcon$7=require$$0.GenIcon;var MdRepeatOne_1=function MdRepeatOne(props){return GenIcon$7({"tag":"svg","attr":{"viewBox":"0 0 24 24"},"child":[{"tag":"path","attr":{"d":"M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4zm-4-2V9h-1l-2 1v1h1.5v4H13z"}}]})(props);};// THIS FILE IS AUTO GENERATED
var GenIcon$6=require$$0.GenIcon;var MdSkipPrevious_1=function MdSkipPrevious(props){return GenIcon$6({"tag":"svg","attr":{"viewBox":"0 0 24 24"},"child":[{"tag":"path","attr":{"d":"M6 6h2v12H6zm3.5 6l8.5 6V6z"}}]})(props);};// THIS FILE IS AUTO GENERATED
var GenIcon$5=require$$0.GenIcon;var MdViewHeadline_1=function MdViewHeadline(props){return GenIcon$5({"tag":"svg","attr":{"viewBox":"0 0 24 24"},"child":[{"tag":"path","attr":{"d":"M4 15h16v-2H4v2zm0 4h16v-2H4v2zm0-8h16V9H4v2zm0-6v2h16V5H4z"}}]})(props);};// THIS FILE IS AUTO GENERATED
var GenIcon$4=require$$0.GenIcon;var MdSkipNext_1=function MdSkipNext(props){return GenIcon$4({"tag":"svg","attr":{"viewBox":"0 0 24 24"},"child":[{"tag":"path","attr":{"d":"M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"}}]})(props);};// THIS FILE IS AUTO GENERATED
var GenIcon$3=require$$0.GenIcon;var RiDeleteBinLine_1=function RiDeleteBinLine(props){return GenIcon$3({"tag":"svg","attr":{"viewBox":"0 0 24 24"},"child":[{"tag":"g","attr":{},"child":[{"tag":"path","attr":{"fill":"none","d":"M0 0h24v24H0z"}},{"tag":"path","attr":{"d":"M17 6h5v2h-2v13a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V8H2V6h5V3a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v3zm1 2H6v12h12V8zm-9 3h2v6H9v-6zm4 0h2v6h-2v-6zM9 4v2h6V4H9z"}}]}]})(props);};// THIS FILE IS AUTO GENERATED
var GenIcon$2=require$$0.GenIcon;var RiPlayList2Fill_1=function RiPlayList2Fill(props){return GenIcon$2({"tag":"svg","attr":{"viewBox":"0 0 24 24"},"child":[{"tag":"g","attr":{},"child":[{"tag":"path","attr":{"fill":"none","d":"M0 0H24V24H0z"}},{"tag":"path","attr":{"d":"M22 18v2H2v-2h20zM2 3.5l8 5-8 5v-10zM22 11v2H12v-2h10zm0-7v2H12V4h10z"}}]}]})(props);};// THIS FILE IS AUTO GENERATED
var GenIcon$1=require$$0.GenIcon;var TiArrowShuffle_1=function TiArrowShuffle(props){return GenIcon$1({"tag":"svg","attr":{"version":"1.2","baseProfile":"tiny","viewBox":"0 0 24 24"},"child":[{"tag":"path","attr":{"d":"M4 9h3.5c.736 0 1.393.391 1.851 1.001.325-.604.729-1.163 1.191-1.662-.803-.823-1.866-1.339-3.042-1.339h-3.5c-.553 0-1 .448-1 1s.447 1 1 1zM11.685 12.111c.551-1.657 2.256-3.111 3.649-3.111h1.838l-1.293 1.293c-.391.391-.391 1.023 0 1.414.195.195.451.293.707.293s.512-.098.707-.293l3.707-3.707-3.707-3.707c-.391-.391-1.023-.391-1.414 0s-.391 1.023 0 1.414l1.293 1.293h-1.838c-2.274 0-4.711 1.967-5.547 4.479l-.472 1.411c-.641 1.926-2.072 3.11-2.815 3.11h-2.5c-.553 0-1 .448-1 1s.447 1 1 1h2.5c1.837 0 3.863-1.925 4.713-4.479l.472-1.41zM15.879 13.293c-.391.391-.391 1.023 0 1.414l1.293 1.293h-2.338c-1.268 0-2.33-.891-2.691-2.108-.256.75-.627 1.499-1.09 2.185.886 1.162 2.243 1.923 3.781 1.923h2.338l-1.293 1.293c-.391.391-.391 1.023 0 1.414.195.195.451.293.707.293s.512-.098.707-.293l3.707-3.707-3.707-3.707c-.391-.391-1.023-.391-1.414 0z"}}]})(props);};// THIS FILE IS AUTO GENERATED
var GenIcon=require$$0.GenIcon;var TiDownload_1=function TiDownload(props){return GenIcon({"tag":"svg","attr":{"version":"1.2","baseProfile":"tiny","viewBox":"0 0 24 24"},"child":[{"tag":"path","attr":{"d":"M16.707 7.404c-.189-.188-.448-.283-.707-.283s-.518.095-.707.283l-2.293 2.293v-6.697c0-.552-.448-1-1-1s-1 .448-1 1v6.697l-2.293-2.293c-.189-.188-.44-.293-.707-.293s-.518.105-.707.293c-.39.39-.39 1.024 0 1.414l4.707 4.682 4.709-4.684c.388-.387.388-1.022-.002-1.412zM20.987 16c0-.105-.004-.211-.039-.316l-2-6c-.136-.409-.517-.684-.948-.684h-.219c-.094.188-.21.368-.367.525l-1.482 1.475h1.348l1.667 5h-13.893l1.667-5h1.348l-1.483-1.475c-.157-.157-.274-.337-.367-.525h-.219c-.431 0-.812.275-.948.684l-2 6c-.035.105-.039.211-.039.316-.013 0-.013 5-.013 5 0 .553.447 1 1 1h16c.553 0 1-.447 1-1 0 0 0-5-.013-5z"}}]})(props);};var AnimatePlayIcon=function AnimatePlayIcon(){return/*#__PURE__*/React$1.createElement(FaPlayCircle_1,{className:"react-jinke-music-player-play-icon"});};var AnimatePauseIcon=function AnimatePauseIcon(){return/*#__PURE__*/React$1.createElement(FaPauseCircle_1,{className:"react-jinke-music-player-pause-icon"});};var PlayModeTip=function PlayModeTip(_ref){var prefix=_ref.prefix,visible=_ref.visible,title=_ref.title,text=_ref.text;return/*#__PURE__*/React$1.createElement("div",{className:cls("".concat(prefix,"-play-model-tip"),{show:visible})},/*#__PURE__*/React$1.createElement("span",{className:"".concat(prefix,"-play-model-tip-title")},title),/*#__PURE__*/React$1.createElement("span",{className:"".concat(prefix,"-play-model-tip-text")},text));};var PlayModeTip$1=/*#__PURE__*/react.exports.memo(PlayModeTip);var prefix='react-jinke-music-player-mobile';var PlayerMobile=function PlayerMobile(_ref){var name=_ref.name,cover=_ref.cover,singer=_ref.singer,playing=_ref.playing,duration=_ref.duration,currentTime=_ref.currentTime,loading=_ref.loading,themeSwitch=_ref.themeSwitch,progressBar=_ref.progressBar,openAudioListsPanel=_ref.openAudioListsPanel,audioPrevPlay=_ref.audioPrevPlay,audioNextPlay=_ref.audioNextPlay,playMode=_ref.playMode,onClose=_ref.onClose,playModeTipVisible=_ref.playModeTipVisible,currentPlayModeName=_ref.currentPlayModeName,extendsContent=_ref.extendsContent,onPlay=_ref.onPlay,glassBg=_ref.glassBg,onCoverClick=_ref.onCoverClick,autoHiddenCover=_ref.autoHiddenCover,icon=_ref.icon,locale=_ref.locale,toggleMode=_ref.toggleMode,renderAudioTitle=_ref.renderAudioTitle,shouldShowPlayIcon=_ref.shouldShowPlayIcon,isResetCoverRotate=_ref.isResetCoverRotate;return/*#__PURE__*/React$1.createElement("div",{className:cls(prefix,{'default-bg':!glassBg,'glass-bg':glassBg})},/*#__PURE__*/React$1.createElement(PlayModeTip$1,{prefix:prefix,visible:playModeTipVisible,title:playMode,text:currentPlayModeName}),/*#__PURE__*/React$1.createElement("div",{className:"".concat(prefix,"-header group")},/*#__PURE__*/React$1.createElement("div",{className:"".concat(prefix,"-header-title"),title:name},renderAudioTitle()),toggleMode&&/*#__PURE__*/React$1.createElement("div",{className:"".concat(prefix,"-header-right"),onClick:onClose},icon.close)),/*#__PURE__*/React$1.createElement("div",{className:"".concat(prefix,"-singer text-center group")},/*#__PURE__*/React$1.createElement("span",{className:"".concat(prefix,"-singer-name"),title:singer},singer)),/*#__PURE__*/React$1.createElement("div",{className:"".concat(prefix,"-switch text-center group")},themeSwitch),(!autoHiddenCover||autoHiddenCover&&cover)&&/*#__PURE__*/React$1.createElement("div",{className:"".concat(prefix,"-cover text-center"),onClick:function onClick(){return onCoverClick();}},/*#__PURE__*/React$1.createElement("img",{src:cover,alt:"cover",className:cls('cover',{'img-rotate-pause':!playing||!cover,'img-rotate-reset':isResetCoverRotate})})),/*#__PURE__*/React$1.createElement("div",{className:"".concat(prefix,"-progress group")},/*#__PURE__*/React$1.createElement("span",{className:"current-time"},loading?'--':currentTime),/*#__PURE__*/React$1.createElement("span",{className:"".concat(prefix,"-progress-bar")},progressBar),/*#__PURE__*/React$1.createElement("span",{className:"duration text-right"},loading?'--':duration)),/*#__PURE__*/React$1.createElement("div",{className:"".concat(prefix,"-toggle text-center group")},/*#__PURE__*/React$1.createElement("span",{className:"group prev-audio",title:locale.previousTrackText,onClick:audioPrevPlay},icon.prev),loading?/*#__PURE__*/React$1.createElement("span",{className:"group loading-icon"},icon.loading):/*#__PURE__*/React$1.createElement("span",{className:"group play-btn",title:shouldShowPlayIcon?locale.clickToPlayText:locale.clickToPauseText,onClick:onPlay},shouldShowPlayIcon?icon.play:icon.pause),/*#__PURE__*/React$1.createElement("span",{className:"group next-audio",title:locale.nextTrackText,onClick:audioNextPlay},icon.next)),/*#__PURE__*/React$1.createElement("div",{className:"".concat(prefix,"-operation group")},/*#__PURE__*/React$1.createElement("ul",{className:"items"},[playMode,icon.download,icon.reload,icon.lyric].filter(react.exports.isValidElement).map(function(item){return/*#__PURE__*/React$1.createElement("li",{className:"item",key:item.props.className},item);}),extendsContent,/*#__PURE__*/React$1.createElement("li",{className:"item",onClick:openAudioListsPanel},icon.playLists))));};PlayerMobile.defaultProps={icon:{},renderAudioTitle:function renderAudioTitle(){}};var AudioPlayerMobile=/*#__PURE__*/react.exports.memo(PlayerMobile);var PlayModel=function PlayModel(_ref){var visible=_ref.visible,value=_ref.value;return/*#__PURE__*/React$1.createElement("div",{className:cls('play-mode-title',{'play-mode-title-visible':visible})},value);};var PlayModel$1=/*#__PURE__*/react.exports.memo(PlayModel);var AUDIO_LIST_REMOVE_ANIMATE_TIME=350;// 列表删除动画时间(ms)
var SPACE_BAR_KEYCODE=32;var LOCALE={en_US:'en_US',zh_CN:'zh_CN'};var MEDIA_QUERY={MOBILE:'(max-width: 768px) and (orientation : portrait)',DARK_THEME:'screen and (prefers-color-scheme: dark)',LIGHT_THEME:'screen and (prefers-color-scheme: light)'};var MODE={FULL:'full',MINI:'mini'};var AUDIO_NETWORK_STATE={NETWORK_EMPTY:0,// 未初始化
NETWORK_IDLE:1,// 未使用网络 304 缓存
NETWORK_LOADING:2,// 浏览器正在下载数据
NETWORK_NO_SOURCE:3,// 未找到资源
NETWORK_READY_SUCCESS_STATE:4// 成功
};var AUDIO_READY_STATE={HAVE_NOTHING:0,// 没有关于音频/视频是否就绪的信息
HAVE_METADATA:1,// 关于音频/视频就绪的元数据
HAVE_CURRENT_DATA:2,// 关于当前播放位置的数据是可用的，但没有足够的数据来播放下一帧/毫秒
HAVE_FUTURE_DATA:3,// 当前及至少下一帧的数据是可用的
HAVE_ENOUGH_DATA:4// 可用数据足以开始播放
};var PLAY_MODE={order:'order',orderLoop:'orderLoop',singleLoop:'singleLoop',shufflePlay:'shufflePlay'};var THEME={LIGHT:'light',DARK:'dark',AUTO:'auto'};var playModePropTypes=PropTypes.oneOf(['order','orderLoop','singleLoop','shufflePlay']);var PROP_TYPES={audioLists:PropTypes.array.isRequired,locale:PropTypes.oneOfType([PropTypes.object,PropTypes.oneOf(Object.values(LOCALE))]),theme:PropTypes.oneOf(Object.values(THEME)),mode:PropTypes.oneOf(Object.values(MODE)),defaultPlayMode:playModePropTypes,playMode:playModePropTypes,drag:PropTypes.bool,seeked:PropTypes.bool,autoPlay:PropTypes.bool,clearPriorAudioLists:PropTypes.bool,autoPlayInitLoadPlayList:PropTypes.bool,playModeText:PropTypes.object,panelTitle:PropTypes.string,closeText:PropTypes.oneOfType([PropTypes.string,PropTypes.object]),openText:PropTypes.oneOfType([PropTypes.string,PropTypes.object]),clickToPlayText:PropTypes.oneOfType([PropTypes.string,PropTypes.object]),clickToPauseText:PropTypes.oneOfType([PropTypes.string,PropTypes.object]),nextTrackText:PropTypes.oneOfType([PropTypes.string,PropTypes.object]),previousTrackText:PropTypes.oneOfType([PropTypes.string,PropTypes.object]),reloadText:PropTypes.oneOfType([PropTypes.string,PropTypes.object]),volumeText:PropTypes.oneOfType([PropTypes.string,PropTypes.object]),playListsText:PropTypes.oneOfType([PropTypes.string,PropTypes.object]),toggleLyricText:PropTypes.oneOfType([PropTypes.string,PropTypes.object]),toggleMiniModeText:PropTypes.oneOfType([PropTypes.string,PropTypes.object]),destroyText:PropTypes.oneOfType([PropTypes.string,PropTypes.object]),downloadText:PropTypes.oneOfType([PropTypes.string,PropTypes.object]),emptyText:PropTypes.oneOfType([PropTypes.string,PropTypes.object]),controllerTitle:PropTypes.oneOfType([PropTypes.string,PropTypes.object]),defaultPosition:PropTypes.shape({top:PropTypes.oneOfType([PropTypes.number,PropTypes.string]),left:PropTypes.oneOfType([PropTypes.number,PropTypes.string]),right:PropTypes.oneOfType([PropTypes.number,PropTypes.string]),bottom:PropTypes.oneOfType([PropTypes.number,PropTypes.string])}),onAudioPlay:PropTypes.func,onAudioPause:PropTypes.func,onAudioEnded:PropTypes.func,onAudioAbort:PropTypes.func,onAudioVolumeChange:PropTypes.func,onAudioError:PropTypes.func,onAudioProgress:PropTypes.func,onAudioSeeked:PropTypes.func,onAudioDownload:PropTypes.func,onAudioReload:PropTypes.func,onThemeChange:PropTypes.func,onAudioListsChange:PropTypes.func,onPlayModeChange:PropTypes.func,onModeChange:PropTypes.func,onAudioListsPanelChange:PropTypes.func,onAudioPlayTrackChange:PropTypes.func,onAudioListsSortEnd:PropTypes.func,onAudioLyricChange:PropTypes.func,showDownload:PropTypes.bool,showPlay:PropTypes.bool,showReload:PropTypes.bool,showPlayMode:PropTypes.bool,showThemeSwitch:PropTypes.bool,showMiniModeCover:PropTypes.bool,toggleMode:PropTypes.bool,once:PropTypes.bool,extendsContent:PropTypes.oneOfType([PropTypes.array,PropTypes.bool,PropTypes.object,PropTypes.node,PropTypes.element,PropTypes.string]),checkedText:PropTypes.oneOfType([PropTypes.string,PropTypes.object]),unCheckedText:PropTypes.oneOfType([PropTypes.string,PropTypes.object]),defaultVolume:PropTypes.number,playModeShowTime:PropTypes.number,bounds:PropTypes.oneOfType([PropTypes.string,PropTypes.object]),showMiniProcessBar:PropTypes.bool,loadAudioErrorPlayNext:PropTypes.bool,preload:PropTypes.oneOfType([PropTypes.bool,PropTypes.oneOf(['auto','metadata','none'])]),glassBg:PropTypes.bool,remember:PropTypes.bool,remove:PropTypes.bool,defaultPlayIndex:PropTypes.number,playIndex:PropTypes.number,lyricClassName:PropTypes.string,emptyLyricText:PropTypes.oneOfType([PropTypes.string,PropTypes.object]),showLyric:PropTypes.bool,getContainer:PropTypes.func,getAudioInstance:PropTypes.func,onBeforeAudioDownload:PropTypes.func,autoHiddenCover:PropTypes.bool,spaceBar:PropTypes.bool,showDestroy:PropTypes.bool,onBeforeDestroy:PropTypes.func,onDestroyed:PropTypes.func,customDownloader:PropTypes.func,audioTitle:PropTypes.oneOfType([PropTypes.string,PropTypes.func]),responsive:PropTypes.bool,quietUpdate:PropTypes.bool,renderAudioTitle:PropTypes.func,mobileMediaQuery:PropTypes.string,volumeFade:PropTypes.shape({fadeIn:PropTypes.number,fadeOut:PropTypes.number}),sortableOptions:PropTypes.object};var PROGRESS_BAR_SLIDER_OPTIONS={min:0,step:1};var VOLUME_BAR_SLIDER_OPTIONS={min:0,max:1,step:0.01};var VOLUME_FADE={IN:'in',OUT:'out',NONE:'none'};var en_US={playModeText:{order:'Play in order',orderLoop:'List loop',singleLoop:'Single loop',shufflePlay:'Shuffle playback'},openText:'Open',closeText:'Close',emptyText:'No music',clickToPlayText:'Click to play',clickToPauseText:'Click to pause',nextTrackText:'Next track',previousTrackText:'Previous track',reloadText:'Reload',volumeText:'Volume',playListsText:'Playlists',toggleLyricText:'Toggle lyric',toggleMiniModeText:'Minimize',destroyText:'Destroy',downloadText:'Download',lightThemeText:'L',darkThemeText:'D',switchThemeText:'Dark/Light mode',removeAudioListsText:'Delete audio lists',clickToDeleteText:function clickToDeleteText(name){return"Click to delete ".concat(name);},controllerTitle:/*#__PURE__*/React$1.createElement(FaHeadphones_1,null),emptyLyricText:'No lyric',loadingText:'Loading'};var zh_CN={playModeText:{order:'顺序播放',orderLoop:'列表循环',singleLoop:'单曲循环',shufflePlay:'随机播放'},openText:'打开',closeText:'关闭',emptyText:'音乐播放列表为空',clickToPlayText:'点击播放',clickToPauseText:'点击暂停',nextTrackText:'下一首',previousTrackText:'上一首',reloadText:'重新播放',volumeText:'音量',playListsText:'播放列表',toggleLyricText:'显示/隐藏 歌词',toggleMiniModeText:'切换至迷你模式',destroyText:'移除播放器',downloadText:'下载',lightThemeText:'亮',darkThemeText:'暗',switchThemeText:'暗黑/明亮 主题',removeAudioListsText:'清空播放列表',clickToDeleteText:function clickToDeleteText(name){return"\u70B9\u51FB\u5220\u9664 ".concat(name);},controllerTitle:/*#__PURE__*/React$1.createElement(FaHeadphones_1,null),emptyLyricText:'暂无歌词',loadingText:'加载中'};var _locale;function _defineProperty$3(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}var locale=(_locale={},_defineProperty$3(_locale,LOCALE.en_US,en_US),_defineProperty$3(_locale,LOCALE.zh_CN,zh_CN),_locale);var LOCALE_CONFIG=locale;function _classCallCheck$4(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties$3(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass$4(Constructor,protoProps,staticProps){if(protoProps)_defineProperties$3(Constructor.prototype,protoProps);if(staticProps)_defineProperties$3(Constructor,staticProps);return Constructor;}// use by https://github.com/ustbhuangyi/lyric-parser
var timeExp=/\[(\d{2,}):(\d{2})(?:\.(\d{2,3}))?]/g;var STATE_PAUSE=0;var STATE_PLAYING=1;var tagRegMap={title:'ti',artist:'ar',album:'al',offset:'offset',by:'by'};var Lyric=/*#__PURE__*/function(){function Lyric(lrc){var handler=arguments.length>1&&arguments[1]!==undefined?arguments[1]:function(){};_classCallCheck$4(this,Lyric);this.lrc=lrc;this.tags={};this.lines=[];this.handler=handler;this.state=STATE_PAUSE;this.curLine=0;this._init();}_createClass$4(Lyric,[{key:"_init",value:function _init(){this._initTag();this._initLines();}},{key:"_initTag",value:function _initTag(){for(var tag in tagRegMap){var matches=this.lrc.match(new RegExp("\\[".concat(tagRegMap[tag],":([^\\]]*)]"),'i'));this.tags[tag]=matches&&matches[1]||'';}}},{key:"_initLines",value:function _initLines(){var lines=this.lrc.split('\n');var offset=parseInt(this.tags.offset,10)||0;for(var i=0;i<lines.length;i++){var line=lines[i];var result=timeExp.exec(line);if(result){var txt=line.replace(timeExp,'').trim();if(txt){this.lines.push({time:result[1]*60*1000+result[2]*1000+(result[3]||0)*10+offset,txt:txt});}}}this.lines.sort(function(a,b){return a.time-b.time;});}},{key:"_findCurNum",value:function _findCurNum(time){for(var i=0;i<this.lines.length;i++){if(time<=this.lines[i].time){return i;}}return this.lines.length-1;}},{key:"_callHandler",value:function _callHandler(i){if(i<0){return;}this.handler({txt:this.lines[i].txt,lineNum:i});}},{key:"_playRest",value:function _playRest(){var _this=this;var line=this.lines[this.curNum];var delay=line.time-(+new Date()-this.startStamp);this.timer=setTimeout(function(){_this._callHandler(_this.curNum++);if(_this.curNum<_this.lines.length&&_this.state===STATE_PLAYING){_this._playRest();}},delay);}},{key:"play",value:function play(){var startTime=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var skipLast=arguments.length>1?arguments[1]:undefined;if(!this.lines.length){return;}this.state=STATE_PLAYING;this.curNum=this._findCurNum(startTime);this.startStamp=+new Date()-startTime;if(!skipLast){this._callHandler(this.curNum-1);}if(this.curNum<this.lines.length){clearTimeout(this.timer);this._playRest();}}},{key:"togglePlay",value:function togglePlay(){var now=+new Date();if(this.state===STATE_PLAYING){this.stop();this.pauseStamp=now;}else{this.state=STATE_PLAYING;this.play((this.pauseStamp||now)-(this.startStamp||now),true);this.pauseStamp=0;}}},{key:"stop",value:function stop(){this.state=STATE_PAUSE;clearTimeout(this.timer);}},{key:"seek",value:function seek(offset){this.play(offset);}}]);return Lyric;}();/* eslint-disable no-param-reassign */ /* eslint-disable radix */ /* eslint-disable no-bitwise */function formatTime(second){var i=0;var h=0;var s=parseInt(second);if(s>=60){i=parseInt(s/60);s=parseInt(s%60);if(i>=60){h=parseInt(i/60);i=parseInt(i%60);}}// 补零
var zero=function zero(v){return v>>0<10?"0".concat(v):v;};if(h>0)return[zero(h),zero(i),zero(s)].join(':');return[zero(i),zero(s)].join(':');}function createRandomNum(minNum,maxNum){return parseInt(Math.random()*(maxNum-minNum+1)+minNum,10);}var arrayEqual=function arrayEqual(arr1){return function(arr2){return JSON.stringify(arr1)===JSON.stringify(arr2);};};var s4=function s4(){return((1+Math.random())*0x10000|0).toString(16).substring(1);};// Generate a pseudo-GUID by concatenating random hexadecimal.
var uuId=function uuId(){return"".concat(s4()+s4(),"-").concat(s4(),"-").concat(s4(),"-").concat(s4(),"-").concat(s4()).concat(s4()).concat(s4());};var isSafari=function isSafari(){return /Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent);};// https://stackoverflow.com/a/9039885/2789451
function isIOS(){return['iPad Simulator','iPhone Simulator','iPod Simulator','iPad','iPhone','iPod'].includes(navigator.platform)||// iPad on iOS 13 detection
navigator.userAgent.includes('Mac')&&'ontouchend'in document;}// https://stackoverflow.com/questions/7451508/html5-audio-playback-with-fade-in-and-fade-out
function swing(p){return 0.5-Math.cos(p*Math.PI)/2;}function adjustVolume(element,startVolume,endVolume){var _ref=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{},_ref$duration=_ref.duration,duration=_ref$duration===void 0?1000:_ref$duration,_ref$easing=_ref.easing,easing=_ref$easing===void 0?swing:_ref$easing,_ref$interval=_ref.interval,interval=_ref$interval===void 0?13:_ref$interval;var callback=arguments.length>4?arguments[4]:undefined;var delta=endVolume-startVolume;if(!delta||!duration||!easing||!interval||isIOS()){element.volume=endVolume;callback();return{fadeInterval:undefined,updateIntervalEndVolume:undefined};}var ticks=Math.floor(duration/interval);var tick=1;var updateIntervalEndVolume=function updateIntervalEndVolume(newVolume){endVolume=newVolume;};var timer=setInterval(function(){// End volume may have changed in middle of fading
var newDelta=endVolume-startVolume;if(newDelta!==delta){delta=newDelta;}element.volume=startVolume+easing(tick/ticks)*delta;if(++tick>=ticks){element.volume=endVolume;clearInterval(timer);callback();}},interval);return{fadeInterval:timer,updateIntervalEndVolume:updateIntervalEndVolume};}function _extends$3(){_extends$3=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};return _extends$3.apply(this,arguments);}function _objectWithoutProperties$1(source,excluded){if(source==null)return{};var target=_objectWithoutPropertiesLoose$1(source,excluded);var key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];if(excluded.indexOf(key)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(source,key))continue;target[key]=source[key];}}return target;}function _objectWithoutPropertiesLoose$1(source,excluded){if(source==null)return{};var target={};var sourceKeys=Object.keys(source);var key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(excluded.indexOf(key)>=0)continue;target[key]=source[key];}return target;}function ownKeys$1(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});}keys.push.apply(keys,symbols);}return keys;}function _objectSpread$1(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys$1(Object(source),true).forEach(function(key){_defineProperty$2(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys$1(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread();}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter);}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function _typeof$2(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof$2=function _typeof(obj){return typeof obj;};}else{_typeof$2=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};}return _typeof$2(obj);}function _classCallCheck$3(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties$2(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass$3(Constructor,protoProps,staticProps){if(protoProps)_defineProperties$2(Constructor.prototype,protoProps);if(staticProps)_defineProperties$2(Constructor,staticProps);return Constructor;}function _inherits$3(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function");}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf$2(subClass,superClass);}function _setPrototypeOf$2(o,p){_setPrototypeOf$2=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf$2(o,p);}function _createSuper$2(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct$2();return function _createSuperInternal(){var Super=_getPrototypeOf$2(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf$2(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn$3(this,result);};}function _possibleConstructorReturn$3(self,call){if(call&&(_typeof$2(call)==="object"||typeof call==="function")){return call;}return _assertThisInitialized$2(self);}function _assertThisInitialized$2(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function _isNativeReflectConstruct$2(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}function _getPrototypeOf$2(o){_getPrototypeOf$2=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf$2(o);}function _defineProperty$2(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}Sortable.mount(new SwapPlugin());var IS_MOBILE=getIsMobile();var DEFAULT_ICON={pause:/*#__PURE__*/React$1.createElement(AnimatePauseIcon,null),play:/*#__PURE__*/React$1.createElement(AnimatePlayIcon,null),destroy:/*#__PURE__*/React$1.createElement(MdClose_1,null),close:/*#__PURE__*/React$1.createElement(MdClose_1,null),"delete":/*#__PURE__*/React$1.createElement(RiDeleteBinLine_1,{size:24}),download:/*#__PURE__*/React$1.createElement(TiDownload_1,{size:26}),toggle:/*#__PURE__*/React$1.createElement(FaRegMinusSquare_1,null),lyric:/*#__PURE__*/React$1.createElement(FaBook_1,null),volume:/*#__PURE__*/React$1.createElement(GoUnmute_1,{size:26}),mute:/*#__PURE__*/React$1.createElement(GoMute_1,{size:26}),next:/*#__PURE__*/React$1.createElement(MdSkipNext_1,null),prev:/*#__PURE__*/React$1.createElement(MdSkipPrevious_1,null),playLists:/*#__PURE__*/React$1.createElement(RiPlayList2Fill_1,null),reload:/*#__PURE__*/React$1.createElement(FaSyncAlt_1,{size:22}),loop:/*#__PURE__*/React$1.createElement(MdRepeatOne_1,{size:26}),order:/*#__PURE__*/React$1.createElement(MdViewHeadline_1,{size:26}),orderLoop:/*#__PURE__*/React$1.createElement(MdRepeat_1,{size:26}),shuffle:/*#__PURE__*/React$1.createElement(TiArrowShuffle_1,{size:26}),loading:/*#__PURE__*/React$1.createElement(FaSpinner_1,null),packUpPanelMobile:/*#__PURE__*/React$1.createElement(FiChevronsDown_1,{size:26}),empty:/*#__PURE__*/React$1.createElement(MdLibraryMusic_1,null)};var ReactJkMusicPlayer=/*#__PURE__*/function(_PureComponent){_inherits$3(ReactJkMusicPlayer,_PureComponent);var _super=_createSuper$2(ReactJkMusicPlayer);function ReactJkMusicPlayer(props){var _this;_classCallCheck$3(this,ReactJkMusicPlayer);_this=_super.call(this,props);_defineProperty$2(_assertThisInitialized$2(_this),"isDrag",false);_defineProperty$2(_assertThisInitialized$2(_this),"initPlayId",'');_defineProperty$2(_assertThisInitialized$2(_this),"state",{audioLists:[],playId:_this.initPlayId,// 播放id
name:'',// 当前歌曲名
cover:'',// 当前歌曲封面
singer:'',// 当前歌手
musicSrc:'',// 当前歌曲链
lyric:'',// 当前歌词
currentLyric:'',isMobile:IS_MOBILE,toggle:_this.props.mode===MODE.FULL,playing:false,currentTime:0,soundValue:DEFAULT_VOLUME,moveX:0,moveY:0,loading:false,audioListsPanelVisible:false,playModelNameVisible:false,theme:_this.props.theme||_this.darkThemeName,playMode:_this.props.playMode||_this.props.defaultPlayMode||'',// 当前播放模式
currentAudioVolume:0,// 当前音量  静音后恢复到之前记录的音量
initAnimate:false,isInitAutoPlay:_this.props.autoPlay,isInitRemember:false,loadedProgress:0,removeId:DEFAULT_REMOVE_ID,isNeedMobileHack:IS_MOBILE,audioLyricVisible:false,isAutoPlayWhenUserClicked:false,playIndex:_this.props.playIndex||_this.props.defaultPlayIndex||DEFAULT_PLAY_INDEX,canPlay:false,currentVolumeFade:VOLUME_FADE.NONE,currentVolumeFadeInterval:undefined,updateIntervalEndVolume:undefined,isAudioSeeking:false,isResetCoverRotate:false});_defineProperty$2(_assertThisInitialized$2(_this),"getPlayIndex",function(){var playIndex=arguments.length>0&&arguments[0]!==undefined?arguments[0]:_this.state.playIndex;var audioLists=arguments.length>1&&arguments[1]!==undefined?arguments[1]:_this.state.audioLists;return Math.max(DEFAULT_PLAY_INDEX,Math.min(audioLists.length-1,playIndex));});_defineProperty$2(_assertThisInitialized$2(_this),"onCoverClick",function(){var mode=arguments.length>0&&arguments[0]!==undefined?arguments[0]:MODE.FULL;var showMiniModeCover=_this.props.showMiniModeCover;var cover=_this.state.cover;if(!showMiniModeCover&&mode===MODE.MINI){return;}if(_this.props.onCoverClick&&cover){_this.props.onCoverClick(mode,_this.state.audioLists,_this.getBaseAudioInfo());}});_defineProperty$2(_assertThisInitialized$2(_this),"getAudioTitle",function(){var _ref=_this.locale||{},audioTitle=_ref.audioTitle;var _this$state=_this.state,name=_this$state.name,singer=_this$state.singer;if(typeof audioTitle==='function'&&_this.audio){return audioTitle(_this.getBaseAudioInfo());}return audioTitle||"".concat(name).concat(singer?" - ".concat(singer):'');});_defineProperty$2(_assertThisInitialized$2(_this),"renderAudioTitle",function(){var _this$state2=_this.state,isMobile=_this$state2.isMobile,name=_this$state2.name;if(_this.props.renderAudioTitle){return _this.props.renderAudioTitle(_this.getBaseAudioInfo(),isMobile);}return isMobile?name:_this.getAudioTitle();});_defineProperty$2(_assertThisInitialized$2(_this),"toggleAudioLyric",function(){_this.setState({audioLyricVisible:!_this.state.audioLyricVisible});});_defineProperty$2(_assertThisInitialized$2(_this),"togglePlayMode",function(){var index=_this._PLAY_MODE_.findIndex(function(mode){return mode===_this.state.playMode;});var playMode=index===_this._PLAY_MODE_LENGTH_-1?_this._PLAY_MODE_[0]:_this._PLAY_MODE_[++index];_this.setState({playMode:playMode,playModelNameVisible:true,playModeTipVisible:true});_this.props.onPlayModeChange&&_this.props.onPlayModeChange(playMode);clearTimeout(_this.playModelTimer);_this.playModelTimer=setTimeout(function(){_this.setState({playModelNameVisible:false,playModeTipVisible:false});},_this.props.playModeShowTime);});_defineProperty$2(_assertThisInitialized$2(_this),"renderPlayModeIcon",function(playMode){var animateProps={className:'react-jinke-music-player-mode-icon'};var IconNode=null;switch(playMode){case PLAY_MODE.order:IconNode=/*#__PURE__*/react.exports.cloneElement(_this.iconMap.order,animateProps);break;case PLAY_MODE.orderLoop:IconNode=/*#__PURE__*/react.exports.cloneElement(_this.iconMap.orderLoop,animateProps);break;case PLAY_MODE.singleLoop:IconNode=/*#__PURE__*/react.exports.cloneElement(_this.iconMap.loop,animateProps);break;case PLAY_MODE.shufflePlay:IconNode=/*#__PURE__*/react.exports.cloneElement(_this.iconMap.shuffle,animateProps);break;default:IconNode=/*#__PURE__*/react.exports.cloneElement(_this.iconMap.order,animateProps);}return IconNode;});_defineProperty$2(_assertThisInitialized$2(_this),"audioListsPlay",function(playId){var ignore=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var state=arguments.length>2&&arguments[2]!==undefined?arguments[2]:_this.state;var currentPlayId=state.playId,playing=state.playing,audioLists=state.audioLists,loading=state.loading,canPlay=state.canPlay;if(Array.isArray(audioLists)&&audioLists.length===0){// eslint-disable-next-line no-console
return console.warn('Warning: Your playlist has no songs. and cannot play !');}if(loading&&playId===currentPlayId){return;}var playIndex=audioLists.findIndex(function(audio){return audio[PLAYER_KEY]===playId;});var _ref2=audioLists[playIndex]||{},name=_ref2.name,cover=_ref2.cover,musicSrc=_ref2.musicSrc,singer=_ref2.singer,_ref2$lyric=_ref2.lyric,lyric=_ref2$lyric===void 0?'':_ref2$lyric;var loadAudio=function loadAudio(originMusicSrc){_this.setState({name:name,cover:cover,musicSrc:originMusicSrc,singer:singer,playId:playId,lyric:lyric,currentTime:0,playing:false,loading:true,canPlay:false,loadedProgress:0,playIndex:playIndex,isAutoPlayWhenUserClicked:true},function(){_this.lyric&&_this.lyric.stop();_this.audio.load();_this.updateMediaSessionMetadata();setTimeout(function(){_this.initLyricParser();},0);});};// 如果点击当前项 就暂停 或者播放
if(playId===currentPlayId&&!ignore){_this.setState({playing:!playing});if(!playing){if(canPlay){_this.play();return;}return loadAudio(musicSrc);}return _this.audio.pause();}_this.props.onAudioPlayTrackChange&&_this.props.onAudioPlayTrackChange(playId,audioLists,_this.getBaseAudioInfo());_this.props.onPlayIndexChange&&_this.props.onPlayIndexChange(playIndex);switch(_typeof$2(musicSrc)){case'function':musicSrc().then(loadAudio,_this.onAudioError);break;default:loadAudio(musicSrc);}});_defineProperty$2(_assertThisInitialized$2(_this),"resetAudioStatus",function(){_this.audio.pause();_this.lyric&&_this.lyric.stop();_this.initPlayInfo([]);_this.resetAudioPlayStatus();_this.resetAudioPlayId();});_defineProperty$2(_assertThisInitialized$2(_this),"resetAudioPlayId",function(){_this.setState({playId:_this.initPlayId});});_defineProperty$2(_assertThisInitialized$2(_this),"clearAudioLists",function(){_this.props.onAudioListsChange&&_this.props.onAudioListsChange('',[],{});_this.resetAudioStatus();});_defineProperty$2(_assertThisInitialized$2(_this),"onDeleteAudioLists",function(audioId){return function(e){e.stopPropagation();// 如果不 传 id  删除全部
var _this$state3=_this.state,audioLists=_this$state3.audioLists,playId=_this$state3.playId;if(audioLists.length<1){return;}_this.lyric&&_this.lyric.stop();if(!audioId){_this.clearAudioLists();return;}var newAudioLists=_toConsumableArray(audioLists).filter(function(audio){return audio[PLAYER_KEY]!==audioId;});// 触发删除动画,等动画结束 删除列表
_this.setState({removeId:audioId});setTimeout(function(){_this.setState({audioLists:newAudioLists,removeId:-1},function(){if(!newAudioLists.length){return _this.resetAudioStatus();}// 如果删除的是当前正在播放的 顺延下一首播放
if(audioId===playId){_this.handlePlay(PLAY_MODE.orderLoop);}});},AUDIO_LIST_REMOVE_ANIMATE_TIME);_this.props.onAudioListsChange&&_this.props.onAudioListsChange(playId,newAudioLists,_this.getBaseAudioInfo());};});_defineProperty$2(_assertThisInitialized$2(_this),"openAudioListsPanel",function(){_this.setState(function(_ref3){var audioListsPanelVisible=_ref3.audioListsPanelVisible;return{initAnimate:true,audioListsPanelVisible:!audioListsPanelVisible};});_this.props.onAudioListsPanelChange&&_this.props.onAudioListsPanelChange(!_this.state.audioListsPanelVisible);});_defineProperty$2(_assertThisInitialized$2(_this),"closeAudioListsPanel",function(e){e.stopPropagation();_this._closeAudioListsPanel();});_defineProperty$2(_assertThisInitialized$2(_this),"_closeAudioListsPanel",function(){var audioListsPanelVisible=_this.state.audioListsPanelVisible;_this.setState({audioListsPanelVisible:false});if(audioListsPanelVisible){_this.props.onAudioListsPanelChange&&_this.props.onAudioListsPanelChange(false);}});_defineProperty$2(_assertThisInitialized$2(_this),"themeChange",function(isLight){var theme=isLight?THEME.LIGHT:THEME.DARK;_this.setState({theme:theme});_this.props.onThemeChange&&_this.props.onThemeChange(theme);});_defineProperty$2(_assertThisInitialized$2(_this),"onAudioDownload",function(){var musicSrc=_this.state.musicSrc;if(_this.state.musicSrc){var customDownloader=_this.props.customDownloader;var baseAudioInfo=_this.getBaseAudioInfo();var onBeforeAudioDownload=_this.props.onBeforeAudioDownload(baseAudioInfo);var transformedDownloadAudioInfo={};if(onBeforeAudioDownload&&onBeforeAudioDownload.then){onBeforeAudioDownload.then(function(info){var src=info.src,filename=info.filename,mimeType=info.mimeType;transformedDownloadAudioInfo=info;if(customDownloader){customDownloader(info);}else{download(src,filename,mimeType);}});}else{customDownloader?customDownloader({src:musicSrc}):download(musicSrc);}_this.props.onAudioDownload&&_this.props.onAudioDownload(baseAudioInfo,transformedDownloadAudioInfo);}});_defineProperty$2(_assertThisInitialized$2(_this),"onControllerDrag",function(e,_ref4){var x=_ref4.x,y=_ref4.y;var _this$state4=_this.state,moveX=_this$state4.moveX,moveY=_this$state4.moveY;_this.isDrag=true;// mousedown will trigger drag event on android devices (react-draggable) :(
if(moveX===x&&moveY===y){_this.isDrag=false;}});_defineProperty$2(_assertThisInitialized$2(_this),"onControllerDragStart",function(e,_ref5){var x=_ref5.x,y=_ref5.y;_this.isDrag=false;_this.setState({moveX:x,moveY:y});});_defineProperty$2(_assertThisInitialized$2(_this),"onControllerDragStop",function(e,_ref6){var x=_ref6.x,y=_ref6.y;if(_this.props.showDestroy&&_this.destroyBtn&&_this.destroyBtn.current&&_this.destroyBtn.current.contains(e.target)){_this.onDestroyPlayer();return;}if(!_this.isDrag){if(_this.state.isNeedMobileHack){_this.loadAndPlayAudio();_this.setState({isNeedMobileHack:false});}_this.onOpenPanel();}_this.setState({moveX:x,moveY:y});});_defineProperty$2(_assertThisInitialized$2(_this),"onResetVolume",function(){var currentAudioVolume=_this.state.currentAudioVolume;_this.setAudioVolume(_this.getVolumeBarValue(currentAudioVolume||0.1));});_defineProperty$2(_assertThisInitialized$2(_this),"setAudioVolume",function(volumeBarValue){_this.audio.volume=_this.getListeningVolume(volumeBarValue);_this.setState({currentAudioVolume:volumeBarValue,soundValue:volumeBarValue});// Update fade-in interval to transition to new volume
if(_this.state.currentVolumeFade===VOLUME_FADE.IN){_this.state.updateIntervalEndVolume&&_this.state.updateIntervalEndVolume(volumeBarValue);}});_defineProperty$2(_assertThisInitialized$2(_this),"stopAll",function(target){target.stopPropagation();target.preventDefault();});_defineProperty$2(_assertThisInitialized$2(_this),"getBoundingClientRect",function(ele){var _ele$getBoundingClien=ele.getBoundingClientRect(),left=_ele$getBoundingClien.left,top=_ele$getBoundingClien.top;return{left:left,top:top};});_defineProperty$2(_assertThisInitialized$2(_this),"getListeningVolume",function(volumeBarValue){return Math.pow(volumeBarValue,2);});_defineProperty$2(_assertThisInitialized$2(_this),"getVolumeBarValue",function(listeningVolume){return Math.sqrt(listeningVolume);});_defineProperty$2(_assertThisInitialized$2(_this),"onAudioReload",function(){if(_this.props.audioLists.length){_this.handlePlay(PLAY_MODE.singleLoop);_this.props.onAudioReload&&_this.props.onAudioReload(_this.getBaseAudioInfo());}});_defineProperty$2(_assertThisInitialized$2(_this),"onOpenPanel",function(){var _this$props=_this.props,toggleMode=_this$props.toggleMode,spaceBar=_this$props.spaceBar;if(toggleMode){_this.setState({toggle:true});_this.props.onModeChange&&_this.props.onModeChange(MODE.FULL);if(spaceBar&&_this.player.current){_this.player.current.focus({preventScroll:true});}}_this.onCoverClick(MODE.MINI);});_defineProperty$2(_assertThisInitialized$2(_this),"onHidePanel",function(){_this.setState({toggle:false,audioListsPanelVisible:false});_this.props.onModeChange&&_this.props.onModeChange(MODE.MINI);});_defineProperty$2(_assertThisInitialized$2(_this),"onDestroyPlayer",function(){if(_this.props.onBeforeDestroy){var onBeforeDestroy=Promise.resolve(_this.props.onBeforeDestroy(_this.state.playId,_this.state.audioLists,_this.getBaseAudioInfo()));if(onBeforeDestroy&&onBeforeDestroy.then){onBeforeDestroy.then(function(){_this._onDestroyPlayer();})// ignore unhandledrejection handler
["catch"](function(){});}return;}_this._onDestroyPlayer();});_defineProperty$2(_assertThisInitialized$2(_this),"_onDestroyPlayer",function(){_this.unInstallPlayer();});_defineProperty$2(_assertThisInitialized$2(_this),"_onDestroyed",function(){_this.setState({isPlayDestroyed:true});if(_this.props.onDestroyed){_this.props.onDestroyed(_this.state.playId,_this.state.audioLists,_this.getBaseAudioInfo());}});_defineProperty$2(_assertThisInitialized$2(_this),"getCurrentPlayIndex",function(){return _this.state.audioLists.findIndex(function(audio){return audio[PLAYER_KEY]===_this.state.playId;});});_defineProperty$2(_assertThisInitialized$2(_this),"resetAudioPlayStatus",function(){return new Promise(function(res){_this.setState({currentTime:0,loading:false,playing:false,canPlay:false,lyric:'',currentLyric:'',loadedProgress:0,playIndex:DEFAULT_PLAY_INDEX},res);});});_defineProperty$2(_assertThisInitialized$2(_this),"onTogglePlay",function(){_this.setState({isAudioSeeking:false});if(_this.state.audioLists.length>=1){var _ref7=_this.props.volumeFade||{},fadeIn=_ref7.fadeIn,fadeOut=_ref7.fadeOut;var _this$state5=_this.state,currentVolumeFade=_this$state5.currentVolumeFade,currentVolumeFadeInterval=_this$state5.currentVolumeFadeInterval;var isCurrentlyFading=currentVolumeFade===VOLUME_FADE.IN||currentVolumeFade===VOLUME_FADE.OUT;/**
			         * Currently in middle of fading in/out, so need to cancel the current interval and do the opposite action.
			         * E.g. if currently fading out, then we need to cancel the fade-out and do a fade-in starting at current volume.
			         */if(isCurrentlyFading){// Clear current fade-in/out
clearInterval(currentVolumeFadeInterval);_this.setState({currentVolumeFadeInterval:undefined,updateIntervalEndVolume:undefined});}// Currently playing track or in the middle of fading in
if(!isCurrentlyFading&&_this.state.playing||currentVolumeFade===VOLUME_FADE.IN){_this.setState({currentVolumeFade:VOLUME_FADE.OUT});// Fade in from current volume to 0
var _adjustVolume=adjustVolume(_this.audio,_this.audio.volume,0,{duration:fadeOut},function(){_this.audio.pause();_this.setState({currentVolumeFade:VOLUME_FADE.NONE,currentVolumeFadeInterval:undefined,playing:false,updateIntervalEndVolume:undefined});// Restore volume so slider does not reset to zero
// Restore volume so slider does not reset to zero
_this.audio.volume=_this.getListeningVolume(_this.state.soundValue);}),fadeOutInterval=_adjustVolume.fadeInterval,updateIntervalEndVolume=_adjustVolume.updateIntervalEndVolume;_this.setState({currentVolumeFadeInterval:fadeOutInterval,updateIntervalEndVolume:updateIntervalEndVolume});}else{_this.setState({currentVolumeFade:VOLUME_FADE.IN});// Start volume may not be 0 if interrupting a fade-out
var startVolume=isCurrentlyFading?_this.audio.volume:0;var endVolume=_this.getListeningVolume(_this.state.soundValue);var _adjustVolume2=adjustVolume(_this.audio,startVolume,endVolume,{duration:fadeIn},function(){_this.setState({currentVolumeFade:VOLUME_FADE.NONE,currentVolumeFadeInterval:undefined,updateIntervalEndVolume:undefined});// It's possible that the volume level in the UI has changed since beginning of fade
// It's possible that the volume level in the UI has changed since beginning of fade
_this.audio.volume=_this.getListeningVolume(_this.state.soundValue);}),fadeInInterval=_adjustVolume2.fadeInterval,_updateIntervalEndVolume=_adjustVolume2.updateIntervalEndVolume;_this.setState({currentVolumeFadeInterval:fadeInInterval,updateIntervalEndVolume:_updateIntervalEndVolume,isAutoPlayWhenUserClicked:true},function(){if(fadeInInterval){_this.audio.volume=startVolume;}_this.loadAndPlayAudio();});}}});_defineProperty$2(_assertThisInitialized$2(_this),"playAudio",function(){var isLoaded=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(_this.isAudioCanPlay||isLoaded){if(isLoaded){_this.setAudioLoaded();}_this.loadAndPlayAudio(isLoaded);}});_defineProperty$2(_assertThisInitialized$2(_this),"setAudioLoaded",function(){_this.setState({loading:false,playing:false});});_defineProperty$2(_assertThisInitialized$2(_this),"onAudioPause",function(){_this.setState({playing:false});_this.props.onAudioPause&&_this.props.onAudioPause(_this.getBaseAudioInfo());if(_this.state.lyric&&_this.lyric){_this.lyric.togglePlay();}});_defineProperty$2(_assertThisInitialized$2(_this),"onAudioPlay",function(){// Audio currentTime changed will be trigger audio playing event
if(_this.state.isAudioSeeking){return;}_this.setState({playing:true,loading:false});_this.props.onAudioPlay&&_this.props.onAudioPlay(_this.getBaseAudioInfo());if(_this.state.lyric&&_this.lyric){_this.lyric.togglePlay();}});_defineProperty$2(_assertThisInitialized$2(_this),"onSetAudioLoadedProgress",function(){var _this$audio=_this.audio,timeRanges=_this$audio.buffered,duration=_this$audio.duration;if(timeRanges.length&&timeRanges.end){var loadedProgress=timeRanges.end(timeRanges.length-1)/duration*100;_this.setState({loadedProgress:loadedProgress});}});_defineProperty$2(_assertThisInitialized$2(_this),"loadAndPlayAudio",function(){var isLoaded=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var remember=_this.props.remember;var _this$state6=_this.state,isInitRemember=_this$state6.isInitRemember,musicSrc=_this$state6.musicSrc;var _this$audio2=_this.audio,networkState=_this$audio2.networkState,readyState=_this$audio2.readyState;if(!musicSrc){return;}if(networkState===AUDIO_NETWORK_STATE.NETWORK_NO_SOURCE||networkState===AUDIO_NETWORK_STATE.NETWORK_EMPTY){return _this.onAudioError({reason:"\n          [loadAndPlayAudio]: Failed to load because no supported source was found.\n          current network status is ".concat(networkState,".\n        ")});}_this.setState({playing:false,loading:true,isAudioSeeking:false,isResetCoverRotate:false});if(isLoaded||readyState>=AUDIO_READY_STATE.HAVE_FUTURE_DATA){var _this$getLastPlayStat=_this.getLastPlayStatus(),playing=_this$getLastPlayStat.playing;var isLastPause=remember&&!isInitRemember&&!playing;var canPlay=remember?!isLastPause:_this.isAudioCanPlay;_this.setState({playing:canPlay,loading:false},function(){if(canPlay){_this.play();}_this.setState({isInitAutoPlay:true,isInitRemember:true,isAutoPlayWhenUserClicked:false});});}else{_this.audio.load();}});_defineProperty$2(_assertThisInitialized$2(_this),"onAudioError",function(error){var _this$state7=_this.state,playMode=_this$state7.playMode,audioLists=_this$state7.audioLists,playId=_this$state7.playId,musicSrc=_this$state7.musicSrc;var loadAudioErrorPlayNext=_this.props.loadAudioErrorPlayNext;var isSingleLoop=playMode===PLAY_MODE.singleLoop;var currentPlayMode=isSingleLoop?PLAY_MODE.order:playMode;_this.lyric&&_this.lyric.stop();// 如果删除歌曲或其他原因导致列表为空时
// 这时候会触发 https://developer.mozilla.org/en-US/docs/Web/API/MediaError
if(musicSrc){// 如果当前音乐加载出错 尝试播放下一首
if(loadAudioErrorPlayNext&&audioLists.length){var isLastAudio=(playMode===PLAY_MODE.order||playMode===PLAY_MODE.orderLoop)&&playId===audioLists[audioLists.length-1][PLAYER_KEY];if(!isLastAudio){_this.handlePlay(currentPlayMode,true);}}_this.props.onAudioError&&_this.props.onAudioError(_this.audio.error||error&&error.reason||null,playId,audioLists,_this.getBaseAudioInfo());}});_defineProperty$2(_assertThisInitialized$2(_this),"handlePlay",function(playMode){var isNext=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var _this$state8=_this.state,playId=_this$state8.playId,audioLists=_this$state8.audioLists;var audioListsLen=audioLists.length;if(!audioListsLen){return;}var currentPlayIndex=_this.getCurrentPlayIndex();switch(playMode){// 顺序播放
case PLAY_MODE.order:// 拖拽排序后 或者 正常播放 到最后一首歌 就暂停
if(currentPlayIndex===audioListsLen-1){_this.audio.pause();return;}_this.audioListsPlay(isNext?audioLists[currentPlayIndex+1][PLAYER_KEY]:audioLists[currentPlayIndex-1][PLAYER_KEY]);break;// 列表循环
case PLAY_MODE.orderLoop:if(isNext){if(currentPlayIndex===audioListsLen-1){return _this.audioListsPlay(audioLists[0][PLAYER_KEY]);}_this.audioListsPlay(audioLists[currentPlayIndex+1][PLAYER_KEY]);}else{if(currentPlayIndex===0){return _this.audioListsPlay(audioLists[audioListsLen-1][PLAYER_KEY]);}_this.audioListsPlay(audioLists[currentPlayIndex-1][PLAYER_KEY]);}break;// 单曲循环
case PLAY_MODE.singleLoop:_this.audio.currentTime=0;_this.audioListsPlay(playId,true);break;// 随机播放
case PLAY_MODE.shufflePlay:{var randomIndex=createRandomNum(0,audioListsLen-1);if(randomIndex===_this.getCurrentPlayIndex()){randomIndex=_this.getPlayIndex(randomIndex+1);}var randomPlayId=(audioLists[randomIndex]||{})[PLAYER_KEY];_this.audioListsPlay(randomPlayId,true);}break;}});_defineProperty$2(_assertThisInitialized$2(_this),"onAudioEnd",function(){_this.props.onAudioEnded&&_this.props.onAudioEnded(_this.state.playId,_this.state.audioLists,_this.getBaseAudioInfo());_this.handlePlay(_this.state.playMode);});_defineProperty$2(_assertThisInitialized$2(_this),"audioPrevAndNextBasePlayHandle",function(){var isNext=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var playMode=_this.state.playMode;var _playMode='';switch(playMode){case PLAY_MODE.shufflePlay:_playMode=playMode;break;default:_playMode=PLAY_MODE.orderLoop;break;}_this.handlePlay(_playMode,isNext);});_defineProperty$2(_assertThisInitialized$2(_this),"onPlayPrevAudio",function(){var restartCurrentOnPrev=_this.props.restartCurrentOnPrev;if(restartCurrentOnPrev&&_this.audio.currentTime>1){_this.audio.currentTime=0;return;}_this.audioPrevAndNextBasePlayHandle(false);});_defineProperty$2(_assertThisInitialized$2(_this),"onPlayNextAudio",function(){_this.audioPrevAndNextBasePlayHandle(true);});_defineProperty$2(_assertThisInitialized$2(_this),"audioTimeUpdate",function(){var currentTime=_this.audio.currentTime;_this.setState({currentTime:currentTime});if(_this.props.remember){_this.saveLastPlayStatus();}_this.props.onAudioProgress&&_this.props.onAudioProgress(_this.getBaseAudioInfo());});_defineProperty$2(_assertThisInitialized$2(_this),"onAudioSoundChange",function(value){_this.setAudioVolume(value);});_defineProperty$2(_assertThisInitialized$2(_this),"onAudioVolumeChange",function(){var volume=_this.audio.volume;var _this$state9=_this.state,currentVolumeFade=_this$state9.currentVolumeFade,currentAudioVolume=_this$state9.currentAudioVolume;if(currentVolumeFade!==VOLUME_FADE.NONE||currentAudioVolume===volume){return;}var volumeBarValue=_this.getVolumeBarValue(volume);_this.setState({soundValue:volumeBarValue});if(_this.props.onAudioVolumeChange){var formattedVolume=parseFloat(volume.toFixed(4));_this.props.onAudioVolumeChange(formattedVolume);}});_defineProperty$2(_assertThisInitialized$2(_this),"onProgressChange",function(currentTime){if(_this.audio){_this.audio.currentTime=currentTime;}_this.setState({currentTime:currentTime,isAudioSeeking:true});});_defineProperty$2(_assertThisInitialized$2(_this),"onAudioSeeked",function(currentTime){_this.setState({isAudioSeeking:true});if(!_this.state.audioLists.length){return;}_this.lyric&&_this.lyric.seek(currentTime*1000);if(!_this.state.playing){_this.lyric&&_this.lyric.stop();}if(_this.audio){_this.audio.currentTime=currentTime;}_this.props.onAudioSeeked&&_this.props.onAudioSeeked(_this.getBaseAudioInfo());setTimeout(function(){_this.setState({isAudioSeeking:false});},500);});_defineProperty$2(_assertThisInitialized$2(_this),"onAudioMute",function(){_this.setState({soundValue:0,currentAudioVolume:_this.audio.volume},function(){_this.audio.volume=0;});});_defineProperty$2(_assertThisInitialized$2(_this),"onAudioAbort",function(e){var _this$state10=_this.state,audioLists=_this$state10.audioLists,playId=_this$state10.playId;var audioInfo=_this.getBaseAudioInfo();var mergedAudioInfo=_objectSpread$1(_objectSpread$1({},e),audioInfo);_this.props.onAudioAbort&&_this.props.onAudioAbort(playId,audioLists,mergedAudioInfo);});_defineProperty$2(_assertThisInitialized$2(_this),"toggleMode",function(mode){if(mode===MODE.FULL){_this.setState({toggle:true});}});_defineProperty$2(_assertThisInitialized$2(_this),"toggleTheme",function(theme){_this.setState({theme:theme});});_defineProperty$2(_assertThisInitialized$2(_this),"onAudioListsSortEnd",function(_ref8){var oldIndex=_ref8.oldIndex,newIndex=_ref8.newIndex;if(oldIndex===newIndex){return;}var _this$state11=_this.state,playId=_this$state11.playId,audioLists=_this$state11.audioLists;var _audioLists=_toConsumableArray(audioLists);var item=_audioLists.splice(oldIndex,1)[0];_audioLists.splice(newIndex,0,item);// 如果拖动正在播放的歌曲 播放Id 等于 拖动后的index
var _playId=oldIndex===playId?newIndex:playId;_this.setState({audioLists:_audioLists,playId:_playId});_this.props.onAudioListsSortEnd&&_this.props.onAudioListsSortEnd(oldIndex,newIndex);_this.props.onAudioListsChange&&_this.props.onAudioListsChange(_playId,_audioLists,_this.getBaseAudioInfo());// TODO: remove
if(_this.props.onAudioListsDragEnd){// eslint-disable-next-line no-console
console.warn('[Deprecated] onAudioListsDragEnd is deprecated. please use onAudioListsSortEnd(oldIndex, newIndex){}');_this.props.onAudioListsDragEnd(oldIndex,newIndex);}});_defineProperty$2(_assertThisInitialized$2(_this),"saveLastPlayStatus",function(){var _this$state12=_this.state,currentTime=_this$state12.currentTime,playId=_this$state12.playId,theme=_this$state12.theme,soundValue=_this$state12.soundValue,playMode=_this$state12.playMode,name=_this$state12.name,cover=_this$state12.cover,singer=_this$state12.singer,musicSrc=_this$state12.musicSrc;var lastPlayStatus=JSON.stringify({currentTime:currentTime,playId:playId,theme:theme,playMode:playMode,soundValue:soundValue,name:name,cover:cover,singer:singer,musicSrc:musicSrc});localStorage.setItem('lastPlayStatus',lastPlayStatus);});_defineProperty$2(_assertThisInitialized$2(_this),"getLastPlayStatus",function(){var _this$props2=_this.props,theme=_this$props2.theme,defaultPlayMode=_this$props2.defaultPlayMode,playMode=_this$props2.playMode,defaultPlayIndex=_this$props2.defaultPlayIndex,playIndex=_this$props2.playIndex;var status={currentTime:0,playMode:playMode||defaultPlayMode||PLAY_MODE.order,name:'',cover:'',singer:'',musicSrc:'',lyric:'',playId:_this.getDefaultPlayId(),theme:theme,playing:true,playIndex:playIndex||defaultPlayIndex||0};try{return JSON.parse(localStorage.getItem('lastPlayStatus'))||status;}catch(error){return status;}});_defineProperty$2(_assertThisInitialized$2(_this),"checkCurrentPlayingAudioIsInUpdatedAudioLists",function(){var nextProps=arguments.length>0&&arguments[0]!==undefined?arguments[0]:_this.props;var _this$state13=_this.state,playId=_this$state13.playId,musicSrc=_this$state13.musicSrc;if(!nextProps.quietUpdate||!Array.isArray(nextProps.audioLists)){return false;}return playId&&nextProps.audioLists.some(function(newAudioInfo){return newAudioInfo[PLAYER_KEY]===playId||newAudioInfo.musicSrc===musicSrc;});});_defineProperty$2(_assertThisInitialized$2(_this),"play",function(){// https://developers.google.com/web/updates/2017/06/play-request-was-interrupted
var playPromise=_this.audio.play();if(playPromise&&playPromise.then){playPromise.then(function(){_this.setState({loading:false,playing:true});})["catch"](function(){_this.setState({loading:false,playing:false});});}});_defineProperty$2(_assertThisInitialized$2(_this),"mockAutoPlayForMobile",function(){if(_this.props.autoPlay&&!_this.state.playing){_this.audio.load();_this.play();}});_defineProperty$2(_assertThisInitialized$2(_this),"bindMobileAutoPlayEvents",function(){document.addEventListener('touchstart',function(){_this.mockAutoPlayForMobile();},{once:true});// 监听微信准备就绪事件
document.addEventListener('WeixinJSBridgeReady',function(){_this.mockAutoPlayForMobile();});});_defineProperty$2(_assertThisInitialized$2(_this),"bindSafariAutoPlayEvents",function(){document.addEventListener('click',function(){_this.mockAutoPlayForMobile();},{once:true});});_defineProperty$2(_assertThisInitialized$2(_this),"unBindEvents",function(){var _this2;(_this2=_this).bindEvents.apply(_this2,arguments);});_defineProperty$2(_assertThisInitialized$2(_this),"bindEvents",function(){var target=arguments.length>0&&arguments[0]!==undefined?arguments[0]:_this.audio;var eventsNames=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{waiting:_this.loadAndPlayAudio,canplay:_this.onAudioCanPlay,error:_this.onAudioError,ended:_this.onAudioEnd,pause:_this.onAudioPause,play:_this.onAudioPlay,timeupdate:_this.audioTimeUpdate,volumechange:_this.onAudioVolumeChange,abort:_this.onAudioAbort,progress:_this.onSetAudioLoadedProgress};var bind=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var once=_this.props.once;for(var name in eventsNames){var _events=eventsNames[name];if(target){bind?target.addEventListener(name,_events,{once:!!(once&&name==='play')}):target.removeEventListener(name,_events);}}});_defineProperty$2(_assertThisInitialized$2(_this),"getPlayId",function(){var audioLists=arguments.length>0&&arguments[0]!==undefined?arguments[0]:_this.state.audioLists;var playIndex=_this.getPlayIndex(undefined,audioLists);var playId=_this.state.playId||audioLists[playIndex]&&audioLists[playIndex][PLAYER_KEY];return playId;});_defineProperty$2(_assertThisInitialized$2(_this),"_getPlayInfo",function(){var audioLists=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var playId=_this.getPlayId(audioLists);var _ref9=audioLists.find(function(audio){return audio[PLAYER_KEY]===playId;})||{},_ref9$name=_ref9.name,name=_ref9$name===void 0?'':_ref9$name,_ref9$cover=_ref9.cover,cover=_ref9$cover===void 0?'':_ref9$cover,_ref9$singer=_ref9.singer,singer=_ref9$singer===void 0?'':_ref9$singer,_ref9$musicSrc=_ref9.musicSrc,musicSrc=_ref9$musicSrc===void 0?'':_ref9$musicSrc,_ref9$lyric=_ref9.lyric,lyric=_ref9$lyric===void 0?'':_ref9$lyric;return{name:name,cover:cover,singer:singer,musicSrc:musicSrc,lyric:lyric,audioLists:audioLists,playId:playId};});_defineProperty$2(_assertThisInitialized$2(_this),"getPlayInfo",function(){var audioLists=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var newAudioLists=audioLists.filter(function(audio){return!audio[PLAYER_KEY];});var lastAudioLists=audioLists.filter(function(audio){return audio[PLAYER_KEY];});var mergedAudioLists=[].concat(_toConsumableArray(lastAudioLists),_toConsumableArray(newAudioLists.map(function(info){return _objectSpread$1(_objectSpread$1({},info),{},_defineProperty$2({},PLAYER_KEY,uuId()));})));return _this._getPlayInfo(mergedAudioLists);});_defineProperty$2(_assertThisInitialized$2(_this),"getPlayInfoOfNewList",function(nextProps){var _nextProps$audioLists=nextProps.audioLists,audioLists=_nextProps$audioLists===void 0?[]:_nextProps$audioLists;var _audioLists=audioLists.map(function(info){var prevAudioBeforeUpdate=nextProps.quietUpdate&&_this.state.audioLists.find(function(_ref10){var musicSrc=_ref10.musicSrc;return musicSrc===info.musicSrc;})||{};return _objectSpread$1(_objectSpread$1({},info),{},_defineProperty$2({},PLAYER_KEY,prevAudioBeforeUpdate[PLAYER_KEY]||uuId()));});return _this._getPlayInfo(_audioLists);});_defineProperty$2(_assertThisInitialized$2(_this),"initPlayInfo",function(audioLists,cb){var info=_this.getPlayInfo(audioLists);switch(_typeof$2(info.musicSrc)){case'function':info.musicSrc().then(function(originMusicSrc){_this.setState(_objectSpread$1(_objectSpread$1({},info),{},{musicSrc:originMusicSrc}),cb);},_this.onAudioError);break;default:_this.setState(info,cb);}});_defineProperty$2(_assertThisInitialized$2(_this),"addMatchMediaListener",function(query,handler){var media=window.matchMedia(query);handler(media);if('addEventListener'in media){media.addEventListener('change',handler);}else{media.addListener(handler);}return media;});_defineProperty$2(_assertThisInitialized$2(_this),"removeMatchMediaListener",function(media,handler){if(media){if('removeEventListener'in media){media.removeEventListener('change',handler);}else{media.removeListener&&media.removeListener(handler);}}});_defineProperty$2(_assertThisInitialized$2(_this),"addMobileListener",function(){_this.mobileMedia=_this.addMatchMediaListener(_this.props.mobileMediaQuery,_this.mobileMediaHandler);});_defineProperty$2(_assertThisInitialized$2(_this),"removeMobileListener",function(){_this.removeMatchMediaListener(_this.mobileMedia,_this.mobileMediaHandler);});_defineProperty$2(_assertThisInitialized$2(_this),"addSystemThemeListener",function(){_this.systemThemeMedia=_this.addMatchMediaListener(MEDIA_QUERY.DARK_THEME,_this.systemThemeMediaHandler);});_defineProperty$2(_assertThisInitialized$2(_this),"removeSystemThemeListener",function(){_this.removeMatchMediaListener(_this.systemThemeMedia,_this.systemThemeMediaHandler);});_defineProperty$2(_assertThisInitialized$2(_this),"mobileMediaHandler",function(_ref11){var matches=_ref11.matches;_this.setState({isMobile:!!matches});});_defineProperty$2(_assertThisInitialized$2(_this),"systemThemeMediaHandler",function(_ref12){var matches=_ref12.matches;if(_this.props.theme===THEME.AUTO){var theme=matches?THEME.DARK:THEME.LIGHT;_this.updateTheme(theme);}});_defineProperty$2(_assertThisInitialized$2(_this),"setDefaultAudioVolume",function(){var _this$props3=_this.props,defaultVolume=_this$props3.defaultVolume,remember=_this$props3.remember;// 音量 [0-1]
_this.defaultVolume=Math.max(0,Math.min(defaultVolume,1));var _this$getLastPlayStat2=_this.getLastPlayStatus(),_this$getLastPlayStat3=_this$getLastPlayStat2.soundValue,soundValue=_this$getLastPlayStat3===void 0?_this.defaultVolume:_this$getLastPlayStat3;_this.setAudioVolume(remember?soundValue:_this.defaultVolume);});_defineProperty$2(_assertThisInitialized$2(_this),"getDefaultPlayId",function(){var audioLists=arguments.length>0&&arguments[0]!==undefined?arguments[0]:_this.props.audioLists;var playIndex=_this.getPlayIndex();return audioLists[playIndex]&&audioLists[playIndex][PLAYER_KEY];});_defineProperty$2(_assertThisInitialized$2(_this),"initLyricParser",function(){_this.lyric=new Lyric(_this.state.lyric,_this.onLyricChange);_this.setState({currentLyric:_this.lyric.lines[0]&&_this.lyric.lines[0].text});});_defineProperty$2(_assertThisInitialized$2(_this),"onLyricChange",function(_ref13){var lineNum=_ref13.lineNum,txt=_ref13.txt;_this.setState({currentLyric:txt});_this.props.onAudioLyricChange&&_this.props.onAudioLyricChange(lineNum,txt);});_defineProperty$2(_assertThisInitialized$2(_this),"updateTheme",function(theme){if(theme&&theme!==_this.props.theme&&Object.values(THEME).includes(theme)){_this.setState({theme:theme});}});_defineProperty$2(_assertThisInitialized$2(_this),"updateMode",function(mode){if(mode&&mode!==_this.props.mode&&Object.values(MODE).includes(mode)){_this.setState({toggle:mode===MODE.FULL});if(mode===MODE.MINI){_this._closeAudioListsPanel();}}});_defineProperty$2(_assertThisInitialized$2(_this),"updatePlayMode",function(playMode){if(!Object.values(PLAY_MODE).includes(playMode)){return;}if(playMode!==_this.props.playMode){_this.setState({playMode:playMode});}});_defineProperty$2(_assertThisInitialized$2(_this),"updateAudioLists",function(audioLists){var newAudioLists=[].concat(_toConsumableArray(_this.state.audioLists),_toConsumableArray(audioLists.filter(function(audio){return _this.state.audioLists.findIndex(function(v){return v.musicSrc===audio.musicSrc;})===-1;})));_this.initPlayInfo(newAudioLists);_this.bindEvents(_this.audio);_this.props.onAudioListsChange&&_this.props.onAudioListsChange(_this.state.playId,audioLists,_this.getBaseAudioInfo());});_defineProperty$2(_assertThisInitialized$2(_this),"loadNewAudioLists",function(nextProps){var audioLists=nextProps.audioLists,remember=nextProps.remember,playMode=nextProps.playMode,theme=nextProps.theme,autoPlayInitLoadPlayList=nextProps.autoPlayInitLoadPlayList,playIndex=nextProps.playIndex;if(!Array.isArray(audioLists)||!audioLists.length){return;}var info=_this.getPlayInfoOfNewList(nextProps);var lastPlayStatus=remember?_this.getLastPlayStatus():{playMode:playMode||PLAY_MODE.order,playIndex:playIndex||DEFAULT_PLAY_INDEX};if(theme!==THEME.AUTO){lastPlayStatus.theme=theme;}var audioInfo=_objectSpread$1(_objectSpread$1(_objectSpread$1({},info),lastPlayStatus),{},{isInitAutoPlay:autoPlayInitLoadPlayList,playing:_this.isAudioCanPlay});if(_this.checkCurrentPlayingAudioIsInUpdatedAudioLists(nextProps)){_this.setState({audioLists:info.audioLists});return;}switch(_typeof$2(info.musicSrc)){case'function':info.musicSrc().then(function(musicSrc){_this.setState(_objectSpread$1(_objectSpread$1({},audioInfo),{},{musicSrc:musicSrc}));},_this.onAudioError);break;default:_this.setState(audioInfo);}});_defineProperty$2(_assertThisInitialized$2(_this),"resetPlayId",function(){return new Promise(function(res){_this.setState({playId:_this.initPlayId},res);});});_defineProperty$2(_assertThisInitialized$2(_this),"changeAudioLists",function(nextProps){if(!_this.checkCurrentPlayingAudioIsInUpdatedAudioLists(nextProps)){_this.resetAudioStatus();}_this.resetPlayId().then(function(){_this.loadNewAudioLists(nextProps);_this.props.onAudioListsChange&&_this.props.onAudioListsChange(_this.state.playId,nextProps.audioLists,_this.getBaseAudioInfo());});});_defineProperty$2(_assertThisInitialized$2(_this),"updatePlayIndex",function(playIndex){var currentPlayIndex=_this.getCurrentPlayIndex();if(playIndex!==undefined&&currentPlayIndex!==playIndex){_this.resetAudioPlayStatus().then(function(){var currentPlayAudio=_this.state.audioLists[_this.getPlayIndex(playIndex)];if(currentPlayAudio&&currentPlayAudio[PLAYER_KEY]){_this.audioListsPlay(currentPlayAudio[PLAYER_KEY],true);}});}});_defineProperty$2(_assertThisInitialized$2(_this),"playByIndex",function(index){_this.updatePlayIndex(index);});_defineProperty$2(_assertThisInitialized$2(_this),"getEnhanceAudio",function(){var _assertThisInitialize=_assertThisInitialized$2(_this),audio=_assertThisInitialize.audio;[{name:'destroy',value:_this.onDestroyPlayer},{name:'updatePlayIndex',value:_this.updatePlayIndex},{name:'playByIndex',value:_this.playByIndex},{name:'playNext',value:_this.onPlayNextAudio},{name:'playPrev',value:_this.onPlayPrevAudio},{name:'togglePlay',value:_this.onTogglePlay},{name:'clear',value:_this.clearAudioLists},{name:'sortable',value:_this.sortable}].forEach(function(_ref14){var name=_ref14.name,value=_ref14.value;Object.defineProperty(audio,name,{value:value,writable:false});});return audio;});_defineProperty$2(_assertThisInitialized$2(_this),"onGetAudioInstance",function(){if(_this.props.getAudioInstance){_this.props.getAudioInstance(_this.getEnhanceAudio());}});_defineProperty$2(_assertThisInitialized$2(_this),"updateMediaSessionMetadata",function(){if('mediaSession'in navigator&&_this.props.showMediaSession){var _this$state14=_this.state,name=_this$state14.name,cover=_this$state14.cover,singer=_this$state14.singer;var mediaMetaDataConfig={title:name,artist:singer,album:name};if(cover){mediaMetaDataConfig.artwork=['96x96','128x128','192x192','256x256','384x384','512x512'].map(function(size){return{src:cover,sizes:size,type:'image/png'};});}navigator.mediaSession.metadata=new MediaMetadata(mediaMetaDataConfig);_this.updateMediaSessionPositionState();}});_defineProperty$2(_assertThisInitialized$2(_this),"updateMediaSessionPositionState",function(){if('setPositionState'in navigator.mediaSession){try{var _assertThisInitialize2=_assertThisInitialized$2(_this),audio=_assertThisInitialize2.audio;navigator.mediaSession.setPositionState({duration:_this.audioDuration,playbackRate:audio.playbackRate||1,position:audio.currentTime||0});}catch(error){// eslint-disable-next-line no-console
console.error('Update media session position state failed: ',error);}}});_defineProperty$2(_assertThisInitialized$2(_this),"onAddMediaSession",function(){if('mediaSession'in navigator&&_this.props.showMediaSession){var defaultSkipTime=10;navigator.mediaSession.setActionHandler('play',_this.onTogglePlay);navigator.mediaSession.setActionHandler('pause',_this.onTogglePlay);navigator.mediaSession.setActionHandler('seekbackward',function(details){var skipTime=details.seekOffset||defaultSkipTime;_this.audio.currentTime=Math.max(_this.audio.currentTime-skipTime,0);_this.props.onAudioSeeked&&_this.props.onAudioSeeked(_this.getBaseAudioInfo());});navigator.mediaSession.setActionHandler('seekforward',function(details){var skipTime=details.seekOffset||defaultSkipTime;_this.audio.currentTime=Math.min(_this.audio.currentTime+skipTime,_this.audioDuration);_this.props.onAudioSeeked&&_this.props.onAudioSeeked(_this.getBaseAudioInfo());});navigator.mediaSession.setActionHandler('previoustrack',_this.onPlayPrevAudio);navigator.mediaSession.setActionHandler('nexttrack',_this.onPlayNextAudio);setTimeout(function(){_this.updateMediaSessionMetadata();},0);try{navigator.mediaSession.setActionHandler('seekto',function(event){if(event.fastSeek&&'fastSeek'in _this.audio){_this.audio.fastSeek(event.seekTime);return;}_this.audio.currentTime=event.seekTime;_this.updateMediaSessionPositionState();});}catch(error){// eslint-disable-next-line no-console
console.warn('Warning! The "seekto" media session action is not supported.');}}});_defineProperty$2(_assertThisInitialized$2(_this),"bindUnhandledRejection",function(){window.addEventListener('unhandledrejection',_this.onAudioError);});_defineProperty$2(_assertThisInitialized$2(_this),"unBindUnhandledRejection",function(){window.removeEventListener('unhandledrejection',_this.onAudioError);});_defineProperty$2(_assertThisInitialized$2(_this),"bindKeyDownEvents",function(){if(_this.props.spaceBar&&_this.player.current){_this.player.current.addEventListener('keydown',_this.onKeyDown,false);_this.player.current.focus({preventScroll:true});}});_defineProperty$2(_assertThisInitialized$2(_this),"unBindKeyDownEvents",function(){if(_this.player.current){_this.player.current.removeEventListener('keydown',_this.onKeyDown,false);}});_defineProperty$2(_assertThisInitialized$2(_this),"onKeyDown",function(e){var spaceBar=_this.props.spaceBar;if(spaceBar&&e.keyCode===SPACE_BAR_KEYCODE){_this.onTogglePlay();}});_defineProperty$2(_assertThisInitialized$2(_this),"initPlayer",function(){var audioLists=arguments.length>0&&arguments[0]!==undefined?arguments[0]:_this.props.audioLists;var isBindKeyDownEvents=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var resetAudioVolume=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;if(resetAudioVolume){_this.setDefaultAudioVolume();}if(!Array.isArray(audioLists)||!audioLists.length){return;}_this.bindUnhandledRejection();_this.bindEvents(_this.audio);_this.initLyricParser();_this.onAddMediaSession();if(IS_MOBILE){_this.bindMobileAutoPlayEvents();}else{if(isBindKeyDownEvents){_this.bindKeyDownEvents();}if(isSafari()){_this.bindSafariAutoPlayEvents();}}});_defineProperty$2(_assertThisInitialized$2(_this),"removeLyric",function(){if(_this.lyric){_this.lyric.stop();_this.lyric=undefined;}});_defineProperty$2(_assertThisInitialized$2(_this),"unInstallPlayer",function(){_this.unBindEvents(_this.audio,undefined,false);_this.unBindUnhandledRejection();_this.unBindKeyDownEvents();_this.removeMobileListener();_this.removeLyric();_this._onDestroyed();_this.sortable&&_this.sortable.destroy();});_defineProperty$2(_assertThisInitialized$2(_this),"onAudioCanPlay",function(){if(_this.state.isAudioSeeking){return;}_this.setState({canPlay:true},function(){_this.playAudio(true);});});_defineProperty$2(_assertThisInitialized$2(_this),"initSortableAudioLists",function(){var _this$props4=_this.props,audioLists=_this$props4.audioLists,sortableOptions=_this$props4.sortableOptions;var selector=SORTABLE_CONFIG.selector,defaultOptions=_objectWithoutProperties$1(SORTABLE_CONFIG,["selector"]);var container=document.querySelector(".".concat(selector));if(Array.isArray(audioLists)&&!audioLists.length||!container){return;}if(_this.sortable){_this.sortable.destroy();}_this.sortable=new Sortable(container,_objectSpread$1(_objectSpread$1({onEnd:_this.onAudioListsSortEnd},defaultOptions),sortableOptions));});_this.audio=null;_this.targetId='music-player-controller';_this._PLAY_MODE_=Object.values(PLAY_MODE);_this._PLAY_MODE_LENGTH_=_this._PLAY_MODE_.length;_this.player=/*#__PURE__*/react.exports.createRef();_this.destroyBtn=/*#__PURE__*/react.exports.createRef();return _this;}_createClass$3(ReactJkMusicPlayer,[{key:"locale",get:// 初始播放id
function get(){var locale=this.props.locale;if(typeof locale==='string'){return LOCALE_CONFIG[this.props.locale];}return locale?_objectSpread$1(_objectSpread$1({},LOCALE_CONFIG[LOCALE.en_US]),locale):{};}},{key:"audioDuration",get:function get(){var _this$state15=this.state,audioLists=_this$state15.audioLists,playId=_this$state15.playId;if(!audioLists.length||!this.audio){return 0;}var _ref15=audioLists.find(function(audio){return audio[PLAYER_KEY]===playId;})||{},duration=_ref15.duration;return Math.max(Number(duration)||this.audio.duration||0,0);}},{key:"isAudioCanPlay",get:function get(){var autoPlay=this.props.autoPlay;var _this$state16=this.state,isInitAutoPlay=_this$state16.isInitAutoPlay,isAutoPlayWhenUserClicked=_this$state16.isAutoPlayWhenUserClicked,canPlay=_this$state16.canPlay;return canPlay&&(isInitAutoPlay||autoPlay||isAutoPlayWhenUserClicked);}},{key:"iconMap",get:function get(){var _this3=this;var Spin=function Spin(){return/*#__PURE__*/React$1.createElement("span",{className:"loading group"},_this3.props.icon.loading);};return _objectSpread$1(_objectSpread$1(_objectSpread$1({},DEFAULT_ICON),this.props.icon),{},{loading:/*#__PURE__*/React$1.createElement(Spin,null)});}},{key:"render",value:function render(){var _this4=this;var _this$props5=this.props,className=_this$props5.className,drag=_this$props5.drag,style=_this$props5.style,showDownload=_this$props5.showDownload,showPlay=_this$props5.showPlay,showReload=_this$props5.showReload,showPlayMode=_this$props5.showPlayMode,showThemeSwitch=_this$props5.showThemeSwitch,toggleMode=_this$props5.toggleMode,showMiniModeCover=_this$props5.showMiniModeCover,extendsContent=_this$props5.extendsContent,defaultPlayMode=_this$props5.defaultPlayMode,seeked=_this$props5.seeked,showProgressLoadBar=_this$props5.showProgressLoadBar,bounds=_this$props5.bounds,defaultPosition=_this$props5.defaultPosition,showMiniProcessBar=_this$props5.showMiniProcessBar,preload=_this$props5.preload,glassBg=_this$props5.glassBg,remove=_this$props5.remove,lyricClassName=_this$props5.lyricClassName,showLyric=_this$props5.showLyric,getContainer=_this$props5.getContainer,autoHiddenCover=_this$props5.autoHiddenCover,showDestroy=_this$props5.showDestroy,responsive=_this$props5.responsive;var locale=this.locale;var _this$state17=this.state,toggle=_this$state17.toggle,playing=_this$state17.playing,currentTime=_this$state17.currentTime,soundValue=_this$state17.soundValue,moveX=_this$state17.moveX,moveY=_this$state17.moveY,loading=_this$state17.loading,audioListsPanelVisible=_this$state17.audioListsPanelVisible,theme=_this$state17.theme,name=_this$state17.name,cover=_this$state17.cover,singer=_this$state17.singer,musicSrc=_this$state17.musicSrc,playId=_this$state17.playId,isMobile=_this$state17.isMobile,playMode=_this$state17.playMode,playModeTipVisible=_this$state17.playModeTipVisible,playModelNameVisible=_this$state17.playModelNameVisible,initAnimate=_this$state17.initAnimate,loadedProgress=_this$state17.loadedProgress,audioLists=_this$state17.audioLists,removeId=_this$state17.removeId,currentLyric=_this$state17.currentLyric,audioLyricVisible=_this$state17.audioLyricVisible,isPlayDestroyed=_this$state17.isPlayDestroyed,isResetCoverRotate=_this$state17.isResetCoverRotate;var preloadState=preload===false||preload==='none'?{}:preload===true?{preload:'auto'}:{preload:preload};var panelToggleAnimate=initAnimate?{show:audioListsPanelVisible,hide:!audioListsPanelVisible}:{show:audioListsPanelVisible};var currentPlayMode=PLAY_MODE[playMode||defaultPlayMode]||PLAY_MODE.order;var currentPlayModeName=locale.playModeText[currentPlayMode];var miniModeCoverConfig=showMiniModeCover&&!autoHiddenCover||autoHiddenCover&&cover?{style:{backgroundImage:"url(".concat(cover,")")}}:{};var formattedCurrentTime=formatTime(currentTime);var formattedAudioDuration=formatTime(this.audioDuration);var progressHandler=seeked?{onChange:this.onProgressChange,onAfterChange:this.onAudioSeeked}:{};var ProgressBar=/*#__PURE__*/React$1.createElement(React$1.Fragment,null,showProgressLoadBar&&/*#__PURE__*/React$1.createElement("div",{className:"progress-load-bar",style:{width:"".concat(Math.min(loadedProgress,100),"%")}}),/*#__PURE__*/React$1.createElement(default_1,_extends$3({max:Math.ceil(this.audioDuration),defaultValue:0,value:Math.ceil(currentTime)},progressHandler,PROGRESS_BAR_SLIDER_OPTIONS)));var DownloadComponent=showDownload&&/*#__PURE__*/React$1.createElement("span",{className:"group audio-download",onClick:this.onAudioDownload,title:locale.downloadText},this.iconMap.download);var ThemeSwitchComponent=showThemeSwitch&&/*#__PURE__*/React$1.createElement("span",{className:"group theme-switch"},/*#__PURE__*/React$1.createElement(Switch,{className:"theme-switch-container",onChange:this.themeChange,checkedChildren:locale.lightThemeText,unCheckedChildren:locale.darkThemeText,checked:theme===THEME.LIGHT,title:locale.switchThemeText}));var ReloadComponent=showReload&&/*#__PURE__*/React$1.createElement("span",{className:"group reload-btn",onClick:this.onAudioReload,title:locale.reloadText},this.iconMap.reload);var LyricComponent=showLyric&&/*#__PURE__*/React$1.createElement("span",{className:cls('group lyric-btn',{'lyric-btn-active':audioLyricVisible}),onClick:this.toggleAudioLyric,title:locale.toggleLyricText},this.iconMap.lyric);var PlayModeComponent=showPlayMode&&/*#__PURE__*/React$1.createElement("span",{className:cls('group loop-btn'),onClick:this.togglePlayMode,title:locale.playModeText[currentPlayMode]},this.renderPlayModeIcon(currentPlayMode));var miniProcessBarR=isMobile?30:40;var DestroyComponent=showDestroy&&/*#__PURE__*/React$1.createElement("span",{title:locale.destroyText,className:"group destroy-btn",ref:this.destroyBtn,onClick:!drag||toggle?this.onDestroyPlayer:undefined},this.iconMap.destroy);var AudioController=/*#__PURE__*/React$1.createElement("div",{className:cls('react-jinke-music-player'),style:defaultPosition,tabIndex:"-1"},/*#__PURE__*/React$1.createElement("div",{className:cls('music-player')},showMiniProcessBar&&/*#__PURE__*/React$1.createElement(CircleProcessBar$1,{progress:currentTime/this.audioDuration,r:miniProcessBarR}),/*#__PURE__*/React$1.createElement("div",_extends$3({id:this.targetId,className:cls('scale','music-player-controller',{'music-player-playing':playing})},miniModeCoverConfig,{onClick:!drag?this.onOpenPanel:undefined}),loading?this.iconMap.loading:/*#__PURE__*/React$1.createElement(React$1.Fragment,null,/*#__PURE__*/React$1.createElement("span",{className:"controller-title"},locale.controllerTitle),/*#__PURE__*/React$1.createElement("div",{className:"music-player-controller-setting"},toggle?locale.closeText:locale.openText))),DestroyComponent));var container=getContainer()||document.body;var audioTitle=this.getAudioTitle();if(isPlayDestroyed){return null;}var shouldShowPlayIcon=!playing||this.state.currentVolumeFade===VOLUME_FADE.OUT;return/*#__PURE__*/reactDom.exports.createPortal(/*#__PURE__*/React$1.createElement("div",{className:cls('react-jinke-music-player-main',{'light-theme':theme===THEME.LIGHT,'dark-theme':theme===THEME.DARK},className),style:style,ref:this.player,tabIndex:"-1"},toggle&&isMobile&&responsive&&/*#__PURE__*/React$1.createElement(AudioPlayerMobile,{playing:playing,loading:loading,name:name,singer:singer,cover:cover,themeSwitch:ThemeSwitchComponent,duration:formattedAudioDuration,currentTime:formattedCurrentTime,progressBar:ProgressBar,onPlay:this.onTogglePlay,currentPlayModeName:currentPlayModeName,playMode:PlayModeComponent,audioNextPlay:this.onPlayNextAudio,audioPrevPlay:this.onPlayPrevAudio,icon:_objectSpread$1(_objectSpread$1({},this.iconMap),{},{reload:ReloadComponent,download:DownloadComponent,lyric:LyricComponent}),playModeTipVisible:playModeTipVisible,openAudioListsPanel:this.openAudioListsPanel,onClose:this.onHidePanel,extendsContent:extendsContent,glassBg:glassBg,autoHiddenCover:autoHiddenCover,onCoverClick:this.onCoverClick,locale:locale,toggleMode:toggleMode,renderAudioTitle:this.renderAudioTitle,shouldShowPlayIcon:shouldShowPlayIcon,isResetCoverRotate:isResetCoverRotate}),toggle?undefined:drag?/*#__PURE__*/React$1.createElement(Draggable$1,{bounds:bounds,position:{x:moveX,y:moveY},onDrag:this.onControllerDrag,onStop:this.onControllerDragStop,onStart:this.onControllerDragStart},AudioController):AudioController,toggle&&(!isMobile||!responsive)&&/*#__PURE__*/React$1.createElement("div",{className:cls('music-player-panel','translate',{'glass-bg':glassBg})},/*#__PURE__*/React$1.createElement("section",{className:"panel-content"},(!autoHiddenCover||autoHiddenCover&&cover)&&/*#__PURE__*/React$1.createElement("div",{className:cls('img-content','img-rotate',{'img-rotate-pause':!playing||!cover,'img-rotate-reset':isResetCoverRotate}),style:{backgroundImage:"url(".concat(cover,")")},onClick:function onClick(){return _this4.onCoverClick();}}),/*#__PURE__*/React$1.createElement("div",{className:"progress-bar-content"},/*#__PURE__*/React$1.createElement("span",{className:"audio-title",title:audioTitle},this.renderAudioTitle()),/*#__PURE__*/React$1.createElement("section",{className:"audio-main"},/*#__PURE__*/React$1.createElement("span",{className:"current-time",title:formattedCurrentTime},loading?'--':formattedCurrentTime),/*#__PURE__*/React$1.createElement("div",{className:"progress-bar"},ProgressBar),/*#__PURE__*/React$1.createElement("span",{className:"duration",title:formattedAudioDuration},loading?'--':formattedAudioDuration))),/*#__PURE__*/React$1.createElement("div",{className:"player-content"},!showPlay?loading&&this.iconMap.loading:/*#__PURE__*/React$1.createElement("span",{className:"group"},/*#__PURE__*/React$1.createElement("span",{className:"group prev-audio",title:locale.previousTrackText,onClick:this.onPlayPrevAudio},this.iconMap.prev),loading?/*#__PURE__*/React$1.createElement("span",{className:"group loading-icon",title:locale.loadingText},this.iconMap.loading):/*#__PURE__*/React$1.createElement("span",{className:"group play-btn",onClick:this.onTogglePlay,title:shouldShowPlayIcon?locale.clickToPlayText:locale.clickToPauseText},shouldShowPlayIcon?this.iconMap.play:this.iconMap.pause),/*#__PURE__*/React$1.createElement("span",{className:"group next-audio",title:locale.nextTrackText,onClick:this.onPlayNextAudio},this.iconMap.next)),ReloadComponent,DownloadComponent,ThemeSwitchComponent,extendsContent||null,/*#__PURE__*/React$1.createElement("span",{className:"group play-sounds",title:locale.volumeText},soundValue===0?/*#__PURE__*/React$1.createElement("span",{className:"sounds-icon",onClick:this.onResetVolume},this.iconMap.mute):/*#__PURE__*/React$1.createElement("span",{className:"sounds-icon",onClick:this.onAudioMute},this.iconMap.volume),/*#__PURE__*/React$1.createElement(default_1,_extends$3({value:soundValue,onChange:this.onAudioSoundChange,className:"sound-operation"},VOLUME_BAR_SLIDER_OPTIONS))),PlayModeComponent,LyricComponent,/*#__PURE__*/React$1.createElement("span",{className:"group audio-lists-btn",title:locale.playListsText,onClick:this.openAudioListsPanel},/*#__PURE__*/React$1.createElement("span",{className:"audio-lists-icon"},this.iconMap.playLists),/*#__PURE__*/React$1.createElement("span",{className:"audio-lists-num"},audioLists.length)),toggleMode&&/*#__PURE__*/React$1.createElement("span",{className:"group hide-panel",title:locale.toggleMiniModeText,onClick:this.onHidePanel},this.iconMap.toggle),DestroyComponent))),/*#__PURE__*/React$1.createElement(AudioListsPanel$1,{playing:playing,playId:playId,loading:loading,visible:audioListsPanelVisible,audioLists:audioLists,onPlay:this.audioListsPlay,onCancel:this.closeAudioListsPanel,icon:this.iconMap,isMobile:isMobile,panelToggleAnimate:panelToggleAnimate,glassBg:glassBg,cover:cover,remove:remove,onDelete:this.onDeleteAudioLists,removeId:removeId,locale:locale}),!isMobile&&/*#__PURE__*/React$1.createElement(PlayModel$1,{visible:playModelNameVisible,value:currentPlayModeName}),audioLyricVisible&&/*#__PURE__*/React$1.createElement(Draggable$1,null,/*#__PURE__*/React$1.createElement("div",{className:cls('music-player-lyric',lyricClassName)},currentLyric||locale.emptyLyricText)),/*#__PURE__*/React$1.createElement("audio",_extends$3({className:"music-player-audio",title:audioTitle},preloadState,{src:musicSrc,ref:function ref(node){_this4.audio=node;}}))),container);}},{key:"getBaseAudioInfo",value:// 返回给使用者的 音乐信息
function getBaseAudioInfo(){var _this$state18=this.state,cover=_this$state18.cover,name=_this$state18.name,musicSrc=_this$state18.musicSrc,soundValue=_this$state18.soundValue,lyric=_this$state18.lyric,audioLists=_this$state18.audioLists,currentLyric=_this$state18.currentLyric;var _ref16=this.audio||{},currentTime=_ref16.currentTime,muted=_ref16.muted,networkState=_ref16.networkState,readyState=_ref16.readyState,played=_ref16.played,paused=_ref16.paused,ended=_ref16.ended,startDate=_ref16.startDate;var currentPlayIndex=this.getCurrentPlayIndex();var currentAudioListInfo=audioLists[currentPlayIndex]||{};return _objectSpread$1(_objectSpread$1({},currentAudioListInfo),{},{cover:cover,name:name,musicSrc:musicSrc,volume:soundValue,currentTime:currentTime,duration:this.audioDuration,muted:muted,networkState:networkState,readyState:readyState,played:played,paused:paused,ended:ended,startDate:startDate,lyric:lyric,currentLyric:currentLyric,playIndex:currentPlayIndex});}},{key:"componentDidUpdate",value:function componentDidUpdate(_,prevState){if(prevState.musicSrc!==this.state.musicSrc){// eslint-disable-next-line react/no-did-update-set-state
this.setState({isResetCoverRotate:true});}}// eslint-disable-next-line camelcase
},{key:"UNSAFE_componentWillReceiveProps",value:function UNSAFE_componentWillReceiveProps(nextProps){var _this5=this;var audioLists=nextProps.audioLists,playIndex=nextProps.playIndex,theme=nextProps.theme,mode=nextProps.mode,playMode=nextProps.playMode,clearPriorAudioLists=nextProps.clearPriorAudioLists;var isEqualAudioLists=arrayEqual(audioLists)(this.props.audioLists);if(!isEqualAudioLists){if(clearPriorAudioLists){this.changeAudioLists(nextProps);}else{this.updateAudioLists(audioLists);}if(!this.checkCurrentPlayingAudioIsInUpdatedAudioLists(nextProps)){this.initPlayer(audioLists,false,false);}setTimeout(function(){return _this5.initSortableAudioLists();},200);}this.updatePlayIndex(!isEqualAudioLists&&clearPriorAudioLists?DEFAULT_PLAY_INDEX:playIndex);this.updateTheme(theme);this.updateMode(mode);this.updatePlayMode(playMode);}// eslint-disable-next-line camelcase
},{key:"UNSAFE_componentWillMount",value:function UNSAFE_componentWillMount(){var _this6=this;var _this$props6=this.props,audioLists=_this$props6.audioLists,remember=_this$props6.remember;if(Array.isArray(audioLists)&&audioLists.length>=1){var playInfo=this.getPlayInfo(audioLists);var lastPlayStatus=remember?this.getLastPlayStatus():{};switch(_typeof$2(playInfo.musicSrc)){case'function':playInfo.musicSrc().then(function(val){_this6.setState(_objectSpread$1(_objectSpread$1({},playInfo),{},{musicSrc:val},lastPlayStatus));},this.onAudioError);break;default:this.setState(_objectSpread$1(_objectSpread$1({},playInfo),lastPlayStatus));}}}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.unInstallPlayer();}},{key:"componentDidMount",value:function componentDidMount(){this.addMobileListener();this.addSystemThemeListener();this.initPlayer();this.initSortableAudioLists();this.onGetAudioInstance();}}]);return ReactJkMusicPlayer;}(react.exports.PureComponent);_defineProperty$2(ReactJkMusicPlayer,"defaultProps",{audioLists:[],theme:THEME.DARK,mode:MODE.MINI,defaultPlayMode:PLAY_MODE.order,defaultPosition:{left:0,top:0},once:false,// onAudioPlay 事件  是否只触发一次
drag:true,toggleMode:true,// 能换在迷你 和完整模式下 互相切换
showMiniModeCover:true,// 迷你模式下 是否显示封面图
showDownload:true,showPlay:true,showReload:true,showPlayMode:true,showThemeSwitch:true,showLyric:false,playModeTipVisible:false,// 手机端切换播放模式
autoPlay:true,defaultVolume:1,showProgressLoadBar:true,// 音频预加载进度
seeked:true,playModeShowTime:600,// 播放模式提示 显示时间,
bounds:'body',// mini 模式拖拽的可移动边界
showMiniProcessBar:false,// 是否在迷你模式 显示进度条
loadAudioErrorPlayNext:true,// 加载音频失败时 是否尝试播放下一首
preload:false,// 是否在页面加载后立即加载音频
glassBg:false,// 是否是毛玻璃效果
remember:false,// 是否记住当前播放状态
remove:true,// 音乐是否可以删除
defaultPlayIndex:0,// 默认播放索引
getContainer:function getContainer(){return document.body;},// 播放器挂载的节点
autoHiddenCover:false,// 当前播放歌曲没有封面时是否自动隐藏
onBeforeAudioDownload:function onBeforeAudioDownload(){},// 下载前转换音频地址等
spaceBar:false,// 是否可以通过空格键 控制播放暂停
showDestroy:false,showMediaSession:false,locale:LOCALE.en_US,responsive:true,icon:DEFAULT_ICON,quietUpdate:false,// 更新后的播放列表如果有当前正在播放的歌曲不打断当前播放状态
mobileMediaQuery:MEDIA_QUERY.MOBILE,// 音频暂停播放 淡入淡出
volumeFade:{fadeIn:0,fadeOut:0},restartCurrentOnPrev:false,// https://github.com/SortableJS/Sortable#options
sortableOptions:{}});_defineProperty$2(ReactJkMusicPlayer,"propTypes",PROP_TYPES);var index='';var type$8=4;var exts$7=[];var Audio=function Audio(_ref17){var file=_ref17.file;var _react$exports$useCon=react.exports.useContext(IContext),lastFiles=_react$exports$useCon.lastFiles,getSetting=_react$exports$useCon.getSetting;var theme=useColorModeValue("light","dark");var _useTranslation=useTranslation(),t=_useTranslation.t,i18n=_useTranslation.i18n;var _React$1$useState=React$1.useState([]),_React$1$useState2=_slicedToArray2(_React$1$useState,2),audioLists=_React$1$useState2[0],setAudioLists=_React$1$useState2[1];var fileUrl=useFileUrl();var _useLocalStorage=useLocalStorage("volume",0.5),_useLocalStorage2=_slicedToArray2(_useLocalStorage,2),volume=_useLocalStorage2[0],setVolume=_useLocalStorage2[1];var mobile=useBreakpointValue({base:true,md:false});var cover=getSetting("music cover")||"https://store.heytapimage.com/cdo-portal/feedback/202110/30/d43c41c5d257c9bc36366e310374fb19.png";var singer=t("unknown");var _React$1$useState3=React$1.useState(0),_React$1$useState4=_slicedToArray2(_React$1$useState3,2),playIndex=_React$1$useState4[0],setPlayIndex=_React$1$useState4[1];react.exports.useEffect(function(){var audio={name:file.name,musicSrc:fileUrl(),cover:cover,singer:singer};if(file.thumbnail){audio.cover=file.thumbnail;}var audioList=lastFiles.filter(function(item){return item.type===type$8;}).map(function(item){var link=fileUrl(item);var audio2={name:item.name,musicSrc:link,cover:cover,singer:singer};if(item.thumbnail){audio2.cover=item.thumbnail;}return audio2;});if(audioList.length>0){setAudioLists(audioList);}else{setAudioLists([audio]);}setPlayIndex(audioList.findIndex(function(item){return item.name===file.name;}));},[]);return/* @__PURE__ */React$1.createElement(Box,{className:"audio-box",w:"full"},/* @__PURE__ */React$1.createElement(Center,{p:"8",w:"full"},/* @__PURE__ */React$1.createElement(Heading,{display:"inline-flex",alignItems:"center"},/* @__PURE__ */React$1.createElement(Icon,{color:getSetting("icon color")||"#1890ff",as:getIcon(file.type,"")}),t("Enjoy the music"),"...")),/* @__PURE__ */React$1.createElement(ReactJkMusicPlayer,{audioLists:audioLists,theme:theme,locale:i18n.language==="zh"?"zh_CN":"en_US",mode:"full",autoPlay:getSetting("autoplay audio")==="true",defaultPosition:{left:20,bottom:20},playIndex:playIndex,onPlayIndexChange:setPlayIndex,sortableOptions:{disabled:mobile},defaultVolume:volume,onAudioVolumeChange:function onAudioVolumeChange(v){return setVolume(v);}}));};var __glob_7_0=/*#__PURE__*/Object.freeze((_Object$freeze2={__proto__:null},_defineProperty3(_Object$freeze2,Symbol.toStringTag,'Module'),_defineProperty3(_Object$freeze2,"type",type$8),_defineProperty3(_Object$freeze2,"exts",exts$7),_defineProperty3(_Object$freeze2,'default',Audio),_Object$freeze2));var lib$2={};var EpubView$1={};var propTypes={exports:{}};/**
			 * Copyright (c) 2013-present, Facebook, Inc.
			 *
			 * This source code is licensed under the MIT license found in the
			 * LICENSE file in the root directory of this source tree.
			 */var ReactPropTypesSecret$1='SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED';var ReactPropTypesSecret_1=ReactPropTypesSecret$1;/**
			 * Copyright (c) 2013-present, Facebook, Inc.
			 *
			 * This source code is licensed under the MIT license found in the
			 * LICENSE file in the root directory of this source tree.
			 */var ReactPropTypesSecret=ReactPropTypesSecret_1;function emptyFunction(){}function emptyFunctionWithReset(){}emptyFunctionWithReset.resetWarningCache=emptyFunction;var factoryWithThrowingShims=function factoryWithThrowingShims(){function shim(props,propName,componentName,location,propFullName,secret){if(secret===ReactPropTypesSecret){// It is still safe when called from React.
return;}var err=new Error('Calling PropTypes validators directly is not supported by the `prop-types` package. '+'Use PropTypes.checkPropTypes() to call them. '+'Read more at http://fb.me/use-check-prop-types');err.name='Invariant Violation';throw err;}shim.isRequired=shim;function getShim(){return shim;}// Important!
// Keep this list in sync with production version in `./factoryWithTypeCheckers.js`.
var ReactPropTypes={array:shim,bigint:shim,bool:shim,func:shim,number:shim,object:shim,string:shim,symbol:shim,any:shim,arrayOf:getShim,element:shim,elementType:shim,instanceOf:getShim,node:shim,objectOf:getShim,oneOf:getShim,oneOfType:getShim,shape:getShim,exact:getShim,checkPropTypes:emptyFunctionWithReset,resetWarningCache:emptyFunction};ReactPropTypes.PropTypes=ReactPropTypes;return ReactPropTypes;};/**
			 * Copyright (c) 2013-present, Facebook, Inc.
			 *
			 * This source code is licensed under the MIT license found in the
			 * LICENSE file in the root directory of this source tree.
			 */{// By explicitly using `prop-types` you are opting into new production behavior.
// http://fb.me/prop-types-in-prod
propTypes.exports=factoryWithThrowingShims();}var lib$1={};var book={};var eventEmitter={exports:{}};var d$1={exports:{}};// ES3 safe
var _undefined$1=void 0;var is$4=function is$4(value){return value!==_undefined$1&&value!==null;};var isValue$5=is$4;// prettier-ignore
var possibleTypes={"object":true,"function":true,"undefined":true/* document.all */};var is$3=function is$3(value){if(!isValue$5(value))return false;return hasOwnProperty.call(possibleTypes,_typeof3(value));};var isObject$4=is$3;var is$2=function is$2(value){if(!isObject$4(value))return false;try{if(!value.constructor)return false;return value.constructor.prototype===value;}catch(error){return false;}};var isPrototype=is$2;var is$1=function is$1(value){if(typeof value!=="function")return false;if(!hasOwnProperty.call(value,"length"))return false;try{if(typeof value.length!=="number")return false;if(typeof value.call!=="function")return false;if(typeof value.apply!=="function")return false;}catch(error){return false;}return!isPrototype(value);};var isFunction=is$1;var classRe=/^\s*class[\s{/}]/,functionToString=Function.prototype.toString;var is=function is(value){if(!isFunction(value))return false;if(classRe.test(functionToString.call(value)))return false;return true;};var isImplemented$2=function isImplemented$2(){var assign=Object.assign,obj;if(typeof assign!=="function")return false;obj={foo:"raz"};assign(obj,{bar:"dwa"},{trzy:"trzy"});return obj.foo+obj.bar+obj.trzy==="razdwatrzy";};var isImplemented$1=function isImplemented$1(){try{Object.keys("primitive");return true;}catch(e){return false;}};// eslint-disable-next-line no-empty-function
var noop=function noop(){};var _undefined=noop();// Support ES3 engines
var isValue$4=function isValue$4(val){return val!==_undefined&&val!==null;};var isValue$3=isValue$4;var keys$2=Object.keys;var shim$2=function shim$2(object){return keys$2(isValue$3(object)?Object(object):object);};var keys$1=isImplemented$1()?Object.keys:shim$2;var isValue$2=isValue$4;var validValue=function validValue(value){if(!isValue$2(value))throw new TypeError("Cannot use null or undefined");return value;};var keys=keys$1,value=validValue,max=Math.max;var shim$1=function shim$1(dest,src/*, …srcn*/){var error,i,length=max(arguments.length,2),assign;dest=Object(value(dest));assign=function assign(key){try{dest[key]=src[key];}catch(e){if(!error)error=e;}};for(i=1;i<length;++i){src=arguments[i];keys(src).forEach(assign);}if(error!==undefined)throw error;return dest;};var assign$1=isImplemented$2()?Object.assign:shim$1;var isValue$1=isValue$4;var forEach=Array.prototype.forEach,create=Object.create;var process$2=function process$2(src,obj){var key;for(key in src){obj[key]=src[key];}};// eslint-disable-next-line no-unused-vars
var normalizeOptions=function normalizeOptions(opts1/*, …options*/){var result=create(null);forEach.call(arguments,function(options){if(!isValue$1(options))return;process$2(Object(options),result);});return result;};var str="razdwatrzy";var isImplemented=function isImplemented(){if(typeof str.contains!=="function")return false;return str.contains("dwa")===true&&str.contains("foo")===false;};var indexOf=String.prototype.indexOf;var shim=function shim(searchString/*, position*/){return indexOf.call(this,searchString,arguments[1])>-1;};var contains$3=isImplemented()?String.prototype.contains:shim;var isValue=is$4,isPlainFunction=is,assign=assign$1,normalizeOpts=normalizeOptions,contains$2=contains$3;var d=d$1.exports=function(dscr,value/*, options*/){var c,e,w,options,desc;if(arguments.length<2||typeof dscr!=="string"){options=value;value=dscr;dscr=null;}else{options=arguments[2];}if(isValue(dscr)){c=contains$2.call(dscr,"c");e=contains$2.call(dscr,"e");w=contains$2.call(dscr,"w");}else{c=w=true;e=false;}desc={value:value,configurable:c,enumerable:e,writable:w};return!options?desc:assign(normalizeOpts(options),desc);};d.gs=function(dscr,get,set/*, options*/){var c,e,options,desc;if(typeof dscr!=="string"){options=set;set=get;get=dscr;dscr=null;}else{options=arguments[3];}if(!isValue(get)){get=undefined;}else if(!isPlainFunction(get)){options=get;get=set=undefined;}else if(!isValue(set)){set=undefined;}else if(!isPlainFunction(set)){options=set;set=undefined;}if(isValue(dscr)){c=contains$2.call(dscr,"c");e=contains$2.call(dscr,"e");}else{c=true;e=false;}desc={get:get,set:set,configurable:c,enumerable:e};return!options?desc:assign(normalizeOpts(options),desc);};var validCallable=function validCallable(fn){if(typeof fn!=="function")throw new TypeError(fn+" is not a function");return fn;};(function(module,exports){var d=d$1.exports,callable=validCallable,apply=Function.prototype.apply,call=Function.prototype.call,create=Object.create,defineProperty=Object.defineProperty,defineProperties=Object.defineProperties,hasOwnProperty=Object.prototype.hasOwnProperty,descriptor={configurable:true,enumerable:false,writable:true},on,_once2,off,emit,methods,descriptors,base;on=function on(type,listener){var data;callable(listener);if(!hasOwnProperty.call(this,'__ee__')){data=descriptor.value=create(null);defineProperty(this,'__ee__',descriptor);descriptor.value=null;}else{data=this.__ee__;}if(!data[type])data[type]=listener;else if(_typeof3(data[type])==='object')data[type].push(listener);else data[type]=[data[type],listener];return this;};_once2=function once(type,listener){var _once,self;callable(listener);self=this;on.call(this,type,_once=function once(){off.call(self,type,_once);apply.call(listener,this,arguments);});_once.__eeOnceListener__=listener;return this;};off=function off(type,listener){var data,listeners,candidate,i;callable(listener);if(!hasOwnProperty.call(this,'__ee__'))return this;data=this.__ee__;if(!data[type])return this;listeners=data[type];if(_typeof3(listeners)==='object'){for(i=0;candidate=listeners[i];++i){if(candidate===listener||candidate.__eeOnceListener__===listener){if(listeners.length===2)data[type]=listeners[i?0:1];else listeners.splice(i,1);}}}else{if(listeners===listener||listeners.__eeOnceListener__===listener){delete data[type];}}return this;};emit=function emit(type){var i,l,listener,listeners,args;if(!hasOwnProperty.call(this,'__ee__'))return;listeners=this.__ee__[type];if(!listeners)return;if(_typeof3(listeners)==='object'){l=arguments.length;args=new Array(l-1);for(i=1;i<l;++i){args[i-1]=arguments[i];}listeners=listeners.slice();for(i=0;listener=listeners[i];++i){apply.call(listener,this,args);}}else{switch(arguments.length){case 1:call.call(listeners,this);break;case 2:call.call(listeners,this,arguments[1]);break;case 3:call.call(listeners,this,arguments[1],arguments[2]);break;default:l=arguments.length;args=new Array(l-1);for(i=1;i<l;++i){args[i-1]=arguments[i];}apply.call(listeners,this,args);}}};methods={on:on,once:_once2,off:off,emit:emit};descriptors={on:d(on),once:d(_once2),off:d(off),emit:d(emit)};base=defineProperties({},descriptors);module.exports=exports=function exports(o){return o==null?create(base):defineProperties(Object(o),descriptors);};exports.methods=methods;})(eventEmitter,eventEmitter.exports);var core={};var lib={};var dom$2={};var conventions$2={};/**
			 * "Shallow freezes" an object to render it immutable.
			 * Uses `Object.freeze` if available,
			 * otherwise the immutability is only in the type.
			 *
			 * Is used to create "enum like" objects.
			 *
			 * @template T
			 * @param {T} object the object to freeze
			 * @param {Pick<ObjectConstructor, 'freeze'> = Object} oc `Object` by default,
			 * 				allows to inject custom object constructor for tests
			 * @returns {Readonly<T>}
			 *
			 * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze
			 */function freeze(object,oc){if(oc===undefined){oc=Object;}return oc&&typeof oc.freeze==='function'?oc.freeze(object):object;}/**
			 * All mime types that are allowed as input to `DOMParser.parseFromString`
			 *
			 * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMParser/parseFromString#Argument02 MDN
			 * @see https://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#domparsersupportedtype WHATWG HTML Spec
			 * @see DOMParser.prototype.parseFromString
			 */var MIME_TYPE=freeze({/**
				 * `text/html`, the only mime type that triggers treating an XML document as HTML.
				 *
				 * @see DOMParser.SupportedType.isHTML
				 * @see https://www.iana.org/assignments/media-types/text/html IANA MimeType registration
				 * @see https://en.wikipedia.org/wiki/HTML Wikipedia
				 * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMParser/parseFromString MDN
				 * @see https://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#dom-domparser-parsefromstring WHATWG HTML Spec
				 */HTML:'text/html',/**
				 * Helper method to check a mime type if it indicates an HTML document
				 *
				 * @param {string} [value]
				 * @returns {boolean}
				 *
				 * @see https://www.iana.org/assignments/media-types/text/html IANA MimeType registration
				 * @see https://en.wikipedia.org/wiki/HTML Wikipedia
				 * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMParser/parseFromString MDN
				 * @see https://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#dom-domparser-parsefromstring 	 */isHTML:function isHTML(value){return value===MIME_TYPE.HTML;},/**
				 * `application/xml`, the standard mime type for XML documents.
				 *
				 * @see https://www.iana.org/assignments/media-types/application/xml IANA MimeType registration
				 * @see https://tools.ietf.org/html/rfc7303#section-9.1 RFC 7303
				 * @see https://en.wikipedia.org/wiki/XML_and_MIME Wikipedia
				 */XML_APPLICATION:'application/xml',/**
				 * `text/html`, an alias for `application/xml`.
				 *
				 * @see https://tools.ietf.org/html/rfc7303#section-9.2 RFC 7303
				 * @see https://www.iana.org/assignments/media-types/text/xml IANA MimeType registration
				 * @see https://en.wikipedia.org/wiki/XML_and_MIME Wikipedia
				 */XML_TEXT:'text/xml',/**
				 * `application/xhtml+xml`, indicates an XML document that has the default HTML namespace,
				 * but is parsed as an XML document.
				 *
				 * @see https://www.iana.org/assignments/media-types/application/xhtml+xml IANA MimeType registration
				 * @see https://dom.spec.whatwg.org/#dom-domimplementation-createdocument WHATWG DOM Spec
				 * @see https://en.wikipedia.org/wiki/XHTML Wikipedia
				 */XML_XHTML_APPLICATION:'application/xhtml+xml',/**
				 * `image/svg+xml`,
				 *
				 * @see https://www.iana.org/assignments/media-types/image/svg+xml IANA MimeType registration
				 * @see https://www.w3.org/TR/SVG11/ W3C SVG 1.1
				 * @see https://en.wikipedia.org/wiki/Scalable_Vector_Graphics Wikipedia
				 */XML_SVG_IMAGE:'image/svg+xml'});/**
			 * Namespaces that are used in this code base.
			 *
			 * @see http://www.w3.org/TR/REC-xml-names
			 */var NAMESPACE$3=freeze({/**
				 * The XHTML namespace.
				 *
				 * @see http://www.w3.org/1999/xhtml
				 */HTML:'http://www.w3.org/1999/xhtml',/**
				 * Checks if `uri` equals `NAMESPACE.HTML`.
				 *
				 * @param {string} [uri]
				 *
				 * @see NAMESPACE.HTML
				 */isHTML:function isHTML(uri){return uri===NAMESPACE$3.HTML;},/**
				 * The SVG namespace.
				 *
				 * @see http://www.w3.org/2000/svg
				 */SVG:'http://www.w3.org/2000/svg',/**
				 * The `xml:` namespace.
				 *
				 * @see http://www.w3.org/XML/1998/namespace
				 */XML:'http://www.w3.org/XML/1998/namespace',/**
				 * The `xmlns:` namespace
				 *
				 * @see https://www.w3.org/2000/xmlns/
				 */XMLNS:'http://www.w3.org/2000/xmlns/'});conventions$2.freeze=freeze;conventions$2.MIME_TYPE=MIME_TYPE;conventions$2.NAMESPACE=NAMESPACE$3;var conventions$1=conventions$2;var NAMESPACE$2=conventions$1.NAMESPACE;/**
			 * A prerequisite for `[].filter`, to drop elements that are empty
			 * @param {string} input
			 * @returns {boolean}
			 */function notEmptyString(input){return input!=='';}/**
			 * @see https://infra.spec.whatwg.org/#split-on-ascii-whitespace
			 * @see https://infra.spec.whatwg.org/#ascii-whitespace
			 *
			 * @param {string} input
			 * @returns {string[]} (can be empty)
			 */function splitOnASCIIWhitespace(input){// U+0009 TAB, U+000A LF, U+000C FF, U+000D CR, U+0020 SPACE
return input?input.split(/[\t\n\f\r ]+/).filter(notEmptyString):[];}/**
			 * Adds element as a key to current if it is not already present.
			 *
			 * @param {Record<string, boolean | undefined>} current
			 * @param {string} element
			 * @returns {Record<string, boolean | undefined>}
			 */function orderedSetReducer(current,element){if(!current.hasOwnProperty(element)){current[element]=true;}return current;}/**
			 * @see https://infra.spec.whatwg.org/#ordered-set
			 * @param {string} input
			 * @returns {string[]}
			 */function toOrderedSet(input){if(!input)return[];var list=splitOnASCIIWhitespace(input);return Object.keys(list.reduce(orderedSetReducer,{}));}/**
			 * Uses `list.indexOf` to implement something like `Array.prototype.includes`,
			 * which we can not rely on being available.
			 *
			 * @param {any[]} list
			 * @returns {function(any): boolean}
			 */function arrayIncludes(list){return function(element){return list&&list.indexOf(element)!==-1;};}function copy(src,dest){for(var p in src){dest[p]=src[p];}}/**
			^\w+\.prototype\.([_\w]+)\s*=\s*((?:.*\{\s*?[\r\n][\s\S]*?^})|\S.*?(?=[;\r\n]));?
			^\w+\.prototype\.([_\w]+)\s*=\s*(\S.*?(?=[;\r\n]));?
			 */function _extends$2(Class,Super){var pt=Class.prototype;if(!(pt instanceof Super)){function t(){}t.prototype=Super.prototype;t=new t();copy(pt,t);Class.prototype=pt=t;}if(pt.constructor!=Class){if(typeof Class!='function'){console.error("unknown Class:"+Class);}pt.constructor=Class;}}// Node Types
var NodeType={};var ELEMENT_NODE$3=NodeType.ELEMENT_NODE=1;var ATTRIBUTE_NODE=NodeType.ATTRIBUTE_NODE=2;var TEXT_NODE$2=NodeType.TEXT_NODE=3;var CDATA_SECTION_NODE=NodeType.CDATA_SECTION_NODE=4;var ENTITY_REFERENCE_NODE=NodeType.ENTITY_REFERENCE_NODE=5;var ENTITY_NODE=NodeType.ENTITY_NODE=6;var PROCESSING_INSTRUCTION_NODE=NodeType.PROCESSING_INSTRUCTION_NODE=7;var COMMENT_NODE=NodeType.COMMENT_NODE=8;var DOCUMENT_NODE$1=NodeType.DOCUMENT_NODE=9;var DOCUMENT_TYPE_NODE=NodeType.DOCUMENT_TYPE_NODE=10;var DOCUMENT_FRAGMENT_NODE=NodeType.DOCUMENT_FRAGMENT_NODE=11;var NOTATION_NODE=NodeType.NOTATION_NODE=12;// ExceptionCode
var ExceptionCode={};var ExceptionMessage={};ExceptionCode.INDEX_SIZE_ERR=(ExceptionMessage[1]="Index size error",1);ExceptionCode.DOMSTRING_SIZE_ERR=(ExceptionMessage[2]="DOMString size error",2);var HIERARCHY_REQUEST_ERR=ExceptionCode.HIERARCHY_REQUEST_ERR=(ExceptionMessage[3]="Hierarchy request error",3);ExceptionCode.WRONG_DOCUMENT_ERR=(ExceptionMessage[4]="Wrong document",4);ExceptionCode.INVALID_CHARACTER_ERR=(ExceptionMessage[5]="Invalid character",5);ExceptionCode.NO_DATA_ALLOWED_ERR=(ExceptionMessage[6]="No data allowed",6);ExceptionCode.NO_MODIFICATION_ALLOWED_ERR=(ExceptionMessage[7]="No modification allowed",7);var NOT_FOUND_ERR=ExceptionCode.NOT_FOUND_ERR=(ExceptionMessage[8]="Not found",8);ExceptionCode.NOT_SUPPORTED_ERR=(ExceptionMessage[9]="Not supported",9);var INUSE_ATTRIBUTE_ERR=ExceptionCode.INUSE_ATTRIBUTE_ERR=(ExceptionMessage[10]="Attribute in use",10);//level2
ExceptionCode.INVALID_STATE_ERR=(ExceptionMessage[11]="Invalid state",11);ExceptionCode.SYNTAX_ERR=(ExceptionMessage[12]="Syntax error",12);ExceptionCode.INVALID_MODIFICATION_ERR=(ExceptionMessage[13]="Invalid modification",13);ExceptionCode.NAMESPACE_ERR=(ExceptionMessage[14]="Invalid namespace",14);ExceptionCode.INVALID_ACCESS_ERR=(ExceptionMessage[15]="Invalid access",15);/**
			 * DOM Level 2
			 * Object DOMException
			 * @see http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/ecma-script-binding.html
			 * @see http://www.w3.org/TR/REC-DOM-Level-1/ecma-script-language-binding.html
			 */function DOMException$1(code,message){if(message instanceof Error){var error=message;}else{error=this;Error.call(this,ExceptionMessage[code]);this.message=ExceptionMessage[code];if(Error.captureStackTrace)Error.captureStackTrace(this,DOMException$1);}error.code=code;if(message)this.message=this.message+": "+message;return error;}DOMException$1.prototype=Error.prototype;copy(ExceptionCode,DOMException$1);/**
			 * @see http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/core.html#ID-536297177
			 * The NodeList interface provides the abstraction of an ordered collection of nodes, without defining or constraining how this collection is implemented. NodeList objects in the DOM are live.
			 * The items in the NodeList are accessible via an integral index, starting from 0.
			 */function NodeList(){}NodeList.prototype={/**
				 * The number of nodes in the list. The range of valid child node indices is 0 to length-1 inclusive.
				 * @standard level1
				 */length:0,/**
				 * Returns the indexth item in the collection. If index is greater than or equal to the number of nodes in the list, this returns null.
				 * @standard level1
				 * @param index  unsigned long 
				 *   Index into the collection.
				 * @return Node
				 * 	The node at the indexth position in the NodeList, or null if that is not a valid index. 
				 */item:function item(index){return this[index]||null;},toString:function toString(isHTML,nodeFilter){for(var buf=[],i=0;i<this.length;i++){serializeToString(this[i],buf,isHTML,nodeFilter);}return buf.join('');}};function LiveNodeList(node,refresh){this._node=node;this._refresh=refresh;_updateLiveList(this);}function _updateLiveList(list){var inc=list._node._inc||list._node.ownerDocument._inc;if(list._inc!=inc){var ls=list._refresh(list._node);//console.log(ls.length)
__set__(list,'length',ls.length);copy(ls,list);list._inc=inc;}}LiveNodeList.prototype.item=function(i){_updateLiveList(this);return this[i];};_extends$2(LiveNodeList,NodeList);/**
			 * Objects implementing the NamedNodeMap interface are used
			 * to represent collections of nodes that can be accessed by name.
			 * Note that NamedNodeMap does not inherit from NodeList;
			 * NamedNodeMaps are not maintained in any particular order.
			 * Objects contained in an object implementing NamedNodeMap may also be accessed by an ordinal index,
			 * but this is simply to allow convenient enumeration of the contents of a NamedNodeMap,
			 * and does not imply that the DOM specifies an order to these Nodes.
			 * NamedNodeMap objects in the DOM are live.
			 * used for attributes or DocumentType entities 
			 */function NamedNodeMap(){}function _findNodeIndex(list,node){var i=list.length;while(i--){if(list[i]===node){return i;}}}function _addNamedNode(el,list,newAttr,oldAttr){if(oldAttr){list[_findNodeIndex(list,oldAttr)]=newAttr;}else{list[list.length++]=newAttr;}if(el){newAttr.ownerElement=el;var doc=el.ownerDocument;if(doc){oldAttr&&_onRemoveAttribute(doc,el,oldAttr);_onAddAttribute(doc,el,newAttr);}}}function _removeNamedNode(el,list,attr){//console.log('remove attr:'+attr)
var i=_findNodeIndex(list,attr);if(i>=0){var lastIndex=list.length-1;while(i<lastIndex){list[i]=list[++i];}list.length=lastIndex;if(el){var doc=el.ownerDocument;if(doc){_onRemoveAttribute(doc,el,attr);attr.ownerElement=null;}}}else{throw DOMException$1(NOT_FOUND_ERR,new Error(el.tagName+'@'+attr));}}NamedNodeMap.prototype={length:0,item:NodeList.prototype.item,getNamedItem:function getNamedItem(key){//		if(key.indexOf(':')>0 || key == 'xmlns'){
//			return null;
//		}
//console.log()
var i=this.length;while(i--){var attr=this[i];//console.log(attr.nodeName,key)
if(attr.nodeName==key){return attr;}}},setNamedItem:function setNamedItem(attr){var el=attr.ownerElement;if(el&&el!=this._ownerElement){throw new DOMException$1(INUSE_ATTRIBUTE_ERR);}var oldAttr=this.getNamedItem(attr.nodeName);_addNamedNode(this._ownerElement,this,attr,oldAttr);return oldAttr;},/* returns Node */setNamedItemNS:function setNamedItemNS(attr){// raises: WRONG_DOCUMENT_ERR,NO_MODIFICATION_ALLOWED_ERR,INUSE_ATTRIBUTE_ERR
var el=attr.ownerElement,oldAttr;if(el&&el!=this._ownerElement){throw new DOMException$1(INUSE_ATTRIBUTE_ERR);}oldAttr=this.getNamedItemNS(attr.namespaceURI,attr.localName);_addNamedNode(this._ownerElement,this,attr,oldAttr);return oldAttr;},/* returns Node */removeNamedItem:function removeNamedItem(key){var attr=this.getNamedItem(key);_removeNamedNode(this._ownerElement,this,attr);return attr;},// raises: NOT_FOUND_ERR,NO_MODIFICATION_ALLOWED_ERR
//for level2
removeNamedItemNS:function removeNamedItemNS(namespaceURI,localName){var attr=this.getNamedItemNS(namespaceURI,localName);_removeNamedNode(this._ownerElement,this,attr);return attr;},getNamedItemNS:function getNamedItemNS(namespaceURI,localName){var i=this.length;while(i--){var node=this[i];if(node.localName==localName&&node.namespaceURI==namespaceURI){return node;}}return null;}};/**
			 * The DOMImplementation interface represents an object providing methods
			 * which are not dependent on any particular document.
			 * Such an object is returned by the `Document.implementation` property.
			 *
			 * __The individual methods describe the differences compared to the specs.__
			 *
			 * @constructor
			 *
			 * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMImplementation MDN
			 * @see https://www.w3.org/TR/REC-DOM-Level-1/level-one-core.html#ID-102161490 DOM Level 1 Core (Initial)
			 * @see https://www.w3.org/TR/DOM-Level-2-Core/core.html#ID-102161490 DOM Level 2 Core
			 * @see https://www.w3.org/TR/DOM-Level-3-Core/core.html#ID-102161490 DOM Level 3 Core
			 * @see https://dom.spec.whatwg.org/#domimplementation DOM Living Standard
			 */function DOMImplementation$1(){}DOMImplementation$1.prototype={/**
				 * The DOMImplementation.hasFeature() method returns a Boolean flag indicating if a given feature is supported.
				 * The different implementations fairly diverged in what kind of features were reported.
				 * The latest version of the spec settled to force this method to always return true, where the functionality was accurate and in use.
				 *
				 * @deprecated It is deprecated and modern browsers return true in all cases.
				 *
				 * @param {string} feature
				 * @param {string} [version]
				 * @returns {boolean} always true
				 *
				 * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMImplementation/hasFeature MDN
				 * @see https://www.w3.org/TR/REC-DOM-Level-1/level-one-core.html#ID-5CED94D7 DOM Level 1 Core
				 * @see https://dom.spec.whatwg.org/#dom-domimplementation-hasfeature DOM Living Standard
				 */hasFeature:function hasFeature(feature,version){return true;},/**
				 * Creates an XML Document object of the specified type with its document element.
				 *
				 * __It behaves slightly different from the description in the living standard__:
				 * - There is no interface/class `XMLDocument`, it returns a `Document` instance.
				 * - `contentType`, `encoding`, `mode`, `origin`, `url` fields are currently not declared.
				 * - this implementation is not validating names or qualified names
				 *   (when parsing XML strings, the SAX parser takes care of that)
				 *
				 * @param {string|null} namespaceURI
				 * @param {string} qualifiedName
				 * @param {DocumentType=null} doctype
				 * @returns {Document}
				 *
				 * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMImplementation/createDocument MDN
				 * @see https://www.w3.org/TR/DOM-Level-2-Core/core.html#Level-2-Core-DOM-createDocument DOM Level 2 Core (initial)
				 * @see https://dom.spec.whatwg.org/#dom-domimplementation-createdocument  DOM Level 2 Core
				 *
				 * @see https://dom.spec.whatwg.org/#validate-and-extract DOM: Validate and extract
				 * @see https://www.w3.org/TR/xml/#NT-NameStartChar XML Spec: Names
				 * @see https://www.w3.org/TR/xml-names/#ns-qualnames XML Namespaces: Qualified names
				 */createDocument:function createDocument(namespaceURI,qualifiedName,doctype){var doc=new Document();doc.implementation=this;doc.childNodes=new NodeList();doc.doctype=doctype||null;if(doctype){doc.appendChild(doctype);}if(qualifiedName){var root=doc.createElementNS(namespaceURI,qualifiedName);doc.appendChild(root);}return doc;},/**
				 * Returns a doctype, with the given `qualifiedName`, `publicId`, and `systemId`.
				 *
				 * __This behavior is slightly different from the in the specs__:
				 * - this implementation is not validating names or qualified names
				 *   (when parsing XML strings, the SAX parser takes care of that)
				 *
				 * @param {string} qualifiedName
				 * @param {string} [publicId]
				 * @param {string} [systemId]
				 * @returns {DocumentType} which can either be used with `DOMImplementation.createDocument` upon document creation
				 * 				  or can be put into the document via methods like `Node.insertBefore()` or `Node.replaceChild()`
				 *
				 * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMImplementation/createDocumentType MDN
				 * @see https://www.w3.org/TR/DOM-Level-2-Core/core.html#Level-2-Core-DOM-createDocType DOM Level 2 Core
				 * @see https://dom.spec.whatwg.org/#dom-domimplementation-createdocumenttype DOM Living Standard
				 *
				 * @see https://dom.spec.whatwg.org/#validate-and-extract DOM: Validate and extract
				 * @see https://www.w3.org/TR/xml/#NT-NameStartChar XML Spec: Names
				 * @see https://www.w3.org/TR/xml-names/#ns-qualnames XML Namespaces: Qualified names
				 */createDocumentType:function createDocumentType(qualifiedName,publicId,systemId){var node=new DocumentType();node.name=qualifiedName;node.nodeName=qualifiedName;node.publicId=publicId||'';node.systemId=systemId||'';return node;}};/**
			 * @see http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/core.html#ID-1950641247
			 */function Node$1(){}Node$1.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,// Modified in DOM Level 2:
insertBefore:function insertBefore(newChild,refChild){//raises 
return _insertBefore(this,newChild,refChild);},replaceChild:function replaceChild(newChild,oldChild){//raises 
this.insertBefore(newChild,oldChild);if(oldChild){this.removeChild(oldChild);}},removeChild:function removeChild(oldChild){return _removeChild(this,oldChild);},appendChild:function appendChild(newChild){return this.insertBefore(newChild,null);},hasChildNodes:function hasChildNodes(){return this.firstChild!=null;},cloneNode:function cloneNode(deep){return _cloneNode(this.ownerDocument||this,this,deep);},// Modified in DOM Level 2:
normalize:function normalize(){var child=this.firstChild;while(child){var next=child.nextSibling;if(next&&next.nodeType==TEXT_NODE$2&&child.nodeType==TEXT_NODE$2){this.removeChild(next);child.appendData(next.data);}else{child.normalize();child=next;}}},// Introduced in DOM Level 2:
isSupported:function isSupported(feature,version){return this.ownerDocument.implementation.hasFeature(feature,version);},// Introduced in DOM Level 2:
hasAttributes:function hasAttributes(){return this.attributes.length>0;},/**
				 * Look up the prefix associated to the given namespace URI, starting from this node.
				 * **The default namespace declarations are ignored by this method.**
				 * See Namespace Prefix Lookup for details on the algorithm used by this method.
				 *
				 * _Note: The implementation seems to be incomplete when compared to the algorithm described in the specs._
				 *
				 * @param {string | null} namespaceURI
				 * @returns {string | null}
				 * @see https://www.w3.org/TR/DOM-Level-3-Core/core.html#Node3-lookupNamespacePrefix
				 * @see https://www.w3.org/TR/DOM-Level-3-Core/namespaces-algorithms.html#lookupNamespacePrefixAlgo
				 * @see https://dom.spec.whatwg.org/#dom-node-lookupprefix
				 * @see https://github.com/xmldom/xmldom/issues/322
				 */lookupPrefix:function lookupPrefix(namespaceURI){var el=this;while(el){var map=el._nsMap;//console.dir(map)
if(map){for(var n in map){if(map[n]==namespaceURI){return n;}}}el=el.nodeType==ATTRIBUTE_NODE?el.ownerDocument:el.parentNode;}return null;},// Introduced in DOM Level 3:
lookupNamespaceURI:function lookupNamespaceURI(prefix){var el=this;while(el){var map=el._nsMap;//console.dir(map)
if(map){if(prefix in map){return map[prefix];}}el=el.nodeType==ATTRIBUTE_NODE?el.ownerDocument:el.parentNode;}return null;},// Introduced in DOM Level 3:
isDefaultNamespace:function isDefaultNamespace(namespaceURI){var prefix=this.lookupPrefix(namespaceURI);return prefix==null;}};function _xmlEncoder(c){return c=='<'&&'&lt;'||c=='>'&&'&gt;'||c=='&'&&'&amp;'||c=='"'&&'&quot;'||'&#'+c.charCodeAt()+';';}copy(NodeType,Node$1);copy(NodeType,Node$1.prototype);/**
			 * @param callback return true for continue,false for break
			 * @return boolean true: break visit;
			 */function _visitNode(node,callback){if(callback(node)){return true;}if(node=node.firstChild){do{if(_visitNode(node,callback)){return true;}}while(node=node.nextSibling);}}function Document(){}function _onAddAttribute(doc,el,newAttr){doc&&doc._inc++;var ns=newAttr.namespaceURI;if(ns===NAMESPACE$2.XMLNS){//update namespace
el._nsMap[newAttr.prefix?newAttr.localName:'']=newAttr.value;}}function _onRemoveAttribute(doc,el,newAttr,remove){doc&&doc._inc++;var ns=newAttr.namespaceURI;if(ns===NAMESPACE$2.XMLNS){//update namespace
delete el._nsMap[newAttr.prefix?newAttr.localName:''];}}function _onUpdateChild(doc,el,newChild){if(doc&&doc._inc){doc._inc++;//update childNodes
var cs=el.childNodes;if(newChild){cs[cs.length++]=newChild;}else{//console.log(1)
var child=el.firstChild;var i=0;while(child){cs[i++]=child;child=child.nextSibling;}cs.length=i;}}}/**
			 * attributes;
			 * children;
			 * 
			 * writeable properties:
			 * nodeValue,Attr:value,CharacterData:data
			 * prefix
			 */function _removeChild(parentNode,child){var previous=child.previousSibling;var next=child.nextSibling;if(previous){previous.nextSibling=next;}else{parentNode.firstChild=next;}if(next){next.previousSibling=previous;}else{parentNode.lastChild=previous;}_onUpdateChild(parentNode.ownerDocument,parentNode);return child;}/**
			 * preformance key(refChild == null)
			 */function _insertBefore(parentNode,newChild,nextChild){var cp=newChild.parentNode;if(cp){cp.removeChild(newChild);//remove and update
}if(newChild.nodeType===DOCUMENT_FRAGMENT_NODE){var newFirst=newChild.firstChild;if(newFirst==null){return newChild;}var newLast=newChild.lastChild;}else{newFirst=newLast=newChild;}var pre=nextChild?nextChild.previousSibling:parentNode.lastChild;newFirst.previousSibling=pre;newLast.nextSibling=nextChild;if(pre){pre.nextSibling=newFirst;}else{parentNode.firstChild=newFirst;}if(nextChild==null){parentNode.lastChild=newLast;}else{nextChild.previousSibling=newLast;}do{newFirst.parentNode=parentNode;}while(newFirst!==newLast&&(newFirst=newFirst.nextSibling));_onUpdateChild(parentNode.ownerDocument||parentNode,parentNode);//console.log(parentNode.lastChild.nextSibling == null)
if(newChild.nodeType==DOCUMENT_FRAGMENT_NODE){newChild.firstChild=newChild.lastChild=null;}return newChild;}function _appendSingleChild(parentNode,newChild){var cp=newChild.parentNode;if(cp){var pre=parentNode.lastChild;cp.removeChild(newChild);//remove and update
var pre=parentNode.lastChild;}var pre=parentNode.lastChild;newChild.parentNode=parentNode;newChild.previousSibling=pre;newChild.nextSibling=null;if(pre){pre.nextSibling=newChild;}else{parentNode.firstChild=newChild;}parentNode.lastChild=newChild;_onUpdateChild(parentNode.ownerDocument,parentNode,newChild);return newChild;//console.log("__aa",parentNode.lastChild.nextSibling == null)
}Document.prototype={//implementation : null,
nodeName:'#document',nodeType:DOCUMENT_NODE$1,/**
				 * The DocumentType node of the document.
				 *
				 * @readonly
				 * @type DocumentType
				 */doctype:null,documentElement:null,_inc:1,insertBefore:function insertBefore(newChild,refChild){//raises
if(newChild.nodeType==DOCUMENT_FRAGMENT_NODE){var child=newChild.firstChild;while(child){var next=child.nextSibling;this.insertBefore(child,refChild);child=next;}return newChild;}if(this.documentElement==null&&newChild.nodeType==ELEMENT_NODE$3){this.documentElement=newChild;}return _insertBefore(this,newChild,refChild),newChild.ownerDocument=this,newChild;},removeChild:function removeChild(oldChild){if(this.documentElement==oldChild){this.documentElement=null;}return _removeChild(this,oldChild);},// Introduced in DOM Level 2:
importNode:function importNode(importedNode,deep){return _importNode(this,importedNode,deep);},// Introduced in DOM Level 2:
getElementById:function getElementById(id){var rtv=null;_visitNode(this.documentElement,function(node){if(node.nodeType==ELEMENT_NODE$3){if(node.getAttribute('id')==id){rtv=node;return true;}}});return rtv;},/**
				 * The `getElementsByClassName` method of `Document` interface returns an array-like object
				 * of all child elements which have **all** of the given class name(s).
				 *
				 * Returns an empty list if `classeNames` is an empty string or only contains HTML white space characters.
				 *
				 *
				 * Warning: This is a live LiveNodeList.
				 * Changes in the DOM will reflect in the array as the changes occur.
				 * If an element selected by this array no longer qualifies for the selector,
				 * it will automatically be removed. Be aware of this for iteration purposes.
				 *
				 * @param {string} classNames is a string representing the class name(s) to match; multiple class names are separated by (ASCII-)whitespace
				 *
				 * @see https://developer.mozilla.org/en-US/docs/Web/API/Document/getElementsByClassName
				 * @see https://dom.spec.whatwg.org/#concept-getelementsbyclassname
				 */getElementsByClassName:function getElementsByClassName(classNames){var classNamesSet=toOrderedSet(classNames);return new LiveNodeList(this,function(base){var ls=[];if(classNamesSet.length>0){_visitNode(base.documentElement,function(node){if(node!==base&&node.nodeType===ELEMENT_NODE$3){var nodeClassNames=node.getAttribute('class');// can be null if the attribute does not exist
if(nodeClassNames){// before splitting and iterating just compare them for the most common case
var matches=classNames===nodeClassNames;if(!matches){var nodeClassNamesSet=toOrderedSet(nodeClassNames);matches=classNamesSet.every(arrayIncludes(nodeClassNamesSet));}if(matches){ls.push(node);}}}});}return ls;});},//document factory method:
createElement:function createElement(tagName){var node=new Element$1();node.ownerDocument=this;node.nodeName=tagName;node.tagName=tagName;node.localName=tagName;node.childNodes=new NodeList();var attrs=node.attributes=new NamedNodeMap();attrs._ownerElement=node;return node;},createDocumentFragment:function createDocumentFragment(){var node=new DocumentFragment();node.ownerDocument=this;node.childNodes=new NodeList();return node;},createTextNode:function createTextNode(data){var node=new Text();node.ownerDocument=this;node.appendData(data);return node;},createComment:function createComment(data){var node=new Comment();node.ownerDocument=this;node.appendData(data);return node;},createCDATASection:function createCDATASection(data){var node=new CDATASection();node.ownerDocument=this;node.appendData(data);return node;},createProcessingInstruction:function createProcessingInstruction(target,data){var node=new ProcessingInstruction();node.ownerDocument=this;node.tagName=node.target=target;node.nodeValue=node.data=data;return node;},createAttribute:function createAttribute(name){var node=new Attr();node.ownerDocument=this;node.name=name;node.nodeName=name;node.localName=name;node.specified=true;return node;},createEntityReference:function createEntityReference(name){var node=new EntityReference();node.ownerDocument=this;node.nodeName=name;return node;},// Introduced in DOM Level 2:
createElementNS:function createElementNS(namespaceURI,qualifiedName){var node=new Element$1();var pl=qualifiedName.split(':');var attrs=node.attributes=new NamedNodeMap();node.childNodes=new NodeList();node.ownerDocument=this;node.nodeName=qualifiedName;node.tagName=qualifiedName;node.namespaceURI=namespaceURI;if(pl.length==2){node.prefix=pl[0];node.localName=pl[1];}else{//el.prefix = null;
node.localName=qualifiedName;}attrs._ownerElement=node;return node;},// Introduced in DOM Level 2:
createAttributeNS:function createAttributeNS(namespaceURI,qualifiedName){var node=new Attr();var pl=qualifiedName.split(':');node.ownerDocument=this;node.nodeName=qualifiedName;node.name=qualifiedName;node.namespaceURI=namespaceURI;node.specified=true;if(pl.length==2){node.prefix=pl[0];node.localName=pl[1];}else{//el.prefix = null;
node.localName=qualifiedName;}return node;}};_extends$2(Document,Node$1);function Element$1(){this._nsMap={};}Element$1.prototype={nodeType:ELEMENT_NODE$3,hasAttribute:function hasAttribute(name){return this.getAttributeNode(name)!=null;},getAttribute:function getAttribute(name){var attr=this.getAttributeNode(name);return attr&&attr.value||'';},getAttributeNode:function getAttributeNode(name){return this.attributes.getNamedItem(name);},setAttribute:function setAttribute(name,value){var attr=this.ownerDocument.createAttribute(name);attr.value=attr.nodeValue=""+value;this.setAttributeNode(attr);},removeAttribute:function removeAttribute(name){var attr=this.getAttributeNode(name);attr&&this.removeAttributeNode(attr);},//four real opeartion method
appendChild:function appendChild(newChild){if(newChild.nodeType===DOCUMENT_FRAGMENT_NODE){return this.insertBefore(newChild,null);}else{return _appendSingleChild(this,newChild);}},setAttributeNode:function setAttributeNode(newAttr){return this.attributes.setNamedItem(newAttr);},setAttributeNodeNS:function setAttributeNodeNS(newAttr){return this.attributes.setNamedItemNS(newAttr);},removeAttributeNode:function removeAttributeNode(oldAttr){//console.log(this == oldAttr.ownerElement)
return this.attributes.removeNamedItem(oldAttr.nodeName);},//get real attribute name,and remove it by removeAttributeNode
removeAttributeNS:function removeAttributeNS(namespaceURI,localName){var old=this.getAttributeNodeNS(namespaceURI,localName);old&&this.removeAttributeNode(old);},hasAttributeNS:function hasAttributeNS(namespaceURI,localName){return this.getAttributeNodeNS(namespaceURI,localName)!=null;},getAttributeNS:function getAttributeNS(namespaceURI,localName){var attr=this.getAttributeNodeNS(namespaceURI,localName);return attr&&attr.value||'';},setAttributeNS:function setAttributeNS(namespaceURI,qualifiedName,value){var attr=this.ownerDocument.createAttributeNS(namespaceURI,qualifiedName);attr.value=attr.nodeValue=""+value;this.setAttributeNode(attr);},getAttributeNodeNS:function getAttributeNodeNS(namespaceURI,localName){return this.attributes.getNamedItemNS(namespaceURI,localName);},getElementsByTagName:function getElementsByTagName(tagName){return new LiveNodeList(this,function(base){var ls=[];_visitNode(base,function(node){if(node!==base&&node.nodeType==ELEMENT_NODE$3&&(tagName==='*'||node.tagName==tagName)){ls.push(node);}});return ls;});},getElementsByTagNameNS:function getElementsByTagNameNS(namespaceURI,localName){return new LiveNodeList(this,function(base){var ls=[];_visitNode(base,function(node){if(node!==base&&node.nodeType===ELEMENT_NODE$3&&(namespaceURI==='*'||node.namespaceURI===namespaceURI)&&(localName==='*'||node.localName==localName)){ls.push(node);}});return ls;});}};Document.prototype.getElementsByTagName=Element$1.prototype.getElementsByTagName;Document.prototype.getElementsByTagNameNS=Element$1.prototype.getElementsByTagNameNS;_extends$2(Element$1,Node$1);function Attr(){}Attr.prototype.nodeType=ATTRIBUTE_NODE;_extends$2(Attr,Node$1);function CharacterData(){}CharacterData.prototype={data:'',substringData:function substringData(offset,count){return this.data.substring(offset,offset+count);},appendData:function appendData(text){text=this.data+text;this.nodeValue=this.data=text;this.length=text.length;},insertData:function insertData(offset,text){this.replaceData(offset,0,text);},appendChild:function appendChild(newChild){throw new Error(ExceptionMessage[HIERARCHY_REQUEST_ERR]);},deleteData:function deleteData(offset,count){this.replaceData(offset,count,"");},replaceData:function replaceData(offset,count,text){var start=this.data.substring(0,offset);var end=this.data.substring(offset+count);text=start+text+end;this.nodeValue=this.data=text;this.length=text.length;}};_extends$2(CharacterData,Node$1);function Text(){}Text.prototype={nodeName:"#text",nodeType:TEXT_NODE$2,splitText:function splitText(offset){var text=this.data;var newText=text.substring(offset);text=text.substring(0,offset);this.data=this.nodeValue=text;this.length=text.length;var newNode=this.ownerDocument.createTextNode(newText);if(this.parentNode){this.parentNode.insertBefore(newNode,this.nextSibling);}return newNode;}};_extends$2(Text,CharacterData);function Comment(){}Comment.prototype={nodeName:"#comment",nodeType:COMMENT_NODE};_extends$2(Comment,CharacterData);function CDATASection(){}CDATASection.prototype={nodeName:"#cdata-section",nodeType:CDATA_SECTION_NODE};_extends$2(CDATASection,CharacterData);function DocumentType(){}DocumentType.prototype.nodeType=DOCUMENT_TYPE_NODE;_extends$2(DocumentType,Node$1);function Notation(){}Notation.prototype.nodeType=NOTATION_NODE;_extends$2(Notation,Node$1);function Entity(){}Entity.prototype.nodeType=ENTITY_NODE;_extends$2(Entity,Node$1);function EntityReference(){}EntityReference.prototype.nodeType=ENTITY_REFERENCE_NODE;_extends$2(EntityReference,Node$1);function DocumentFragment(){}DocumentFragment.prototype.nodeName="#document-fragment";DocumentFragment.prototype.nodeType=DOCUMENT_FRAGMENT_NODE;_extends$2(DocumentFragment,Node$1);function ProcessingInstruction(){}ProcessingInstruction.prototype.nodeType=PROCESSING_INSTRUCTION_NODE;_extends$2(ProcessingInstruction,Node$1);function XMLSerializer$1(){}XMLSerializer$1.prototype.serializeToString=function(node,isHtml,nodeFilter){return nodeSerializeToString.call(node,isHtml,nodeFilter);};Node$1.prototype.toString=nodeSerializeToString;function nodeSerializeToString(isHtml,nodeFilter){var buf=[];var refNode=this.nodeType==9&&this.documentElement||this;var prefix=refNode.prefix;var uri=refNode.namespaceURI;if(uri&&prefix==null){//console.log(prefix)
var prefix=refNode.lookupPrefix(uri);if(prefix==null){//isHTML = true;
var visibleNamespaces=[{namespace:uri,prefix:null}//{namespace:uri,prefix:''}
];}}serializeToString(this,buf,isHtml,nodeFilter,visibleNamespaces);//console.log('###',this.nodeType,uri,prefix,buf.join(''))
return buf.join('');}function needNamespaceDefine(node,isHTML,visibleNamespaces){var prefix=node.prefix||'';var uri=node.namespaceURI;// According to [Namespaces in XML 1.0](https://www.w3.org/TR/REC-xml-names/#ns-using) ,
// and more specifically https://www.w3.org/TR/REC-xml-names/#nsc-NoPrefixUndecl :
// > In a namespace declaration for a prefix [...], the attribute value MUST NOT be empty.
// in a similar manner [Namespaces in XML 1.1](https://www.w3.org/TR/xml-names11/#ns-using)
// and more specifically https://www.w3.org/TR/xml-names11/#nsc-NSDeclared :
// > [...] Furthermore, the attribute value [...] must not be an empty string.
// so serializing empty namespace value like xmlns:ds="" would produce an invalid XML document.
if(!uri){return false;}if(prefix==="xml"&&uri===NAMESPACE$2.XML||uri===NAMESPACE$2.XMLNS){return false;}var i=visibleNamespaces.length;while(i--){var ns=visibleNamespaces[i];// get namespace prefix
if(ns.prefix===prefix){return ns.namespace!==uri;}}return true;}/**
			 * Well-formed constraint: No < in Attribute Values
			 * The replacement text of any entity referred to directly or indirectly in an attribute value must not contain a <.
			 * @see https://www.w3.org/TR/xml/#CleanAttrVals
			 * @see https://www.w3.org/TR/xml/#NT-AttValue
			 */function addSerializedAttribute(buf,qualifiedName,value){buf.push(' ',qualifiedName,'="',value.replace(/[<&"]/g,_xmlEncoder),'"');}function serializeToString(node,buf,isHTML,nodeFilter,visibleNamespaces){if(!visibleNamespaces){visibleNamespaces=[];}if(nodeFilter){node=nodeFilter(node);if(node){if(typeof node=='string'){buf.push(node);return;}}else{return;}//buf.sort.apply(attrs, attributeSorter);
}switch(node.nodeType){case ELEMENT_NODE$3:var attrs=node.attributes;var len=attrs.length;var child=node.firstChild;var nodeName=node.tagName;isHTML=NAMESPACE$2.isHTML(node.namespaceURI)||isHTML;var prefixedNodeName=nodeName;if(!isHTML&&!node.prefix&&node.namespaceURI){var defaultNS;// lookup current default ns from `xmlns` attribute
for(var ai=0;ai<attrs.length;ai++){if(attrs.item(ai).name==='xmlns'){defaultNS=attrs.item(ai).value;break;}}if(!defaultNS){// lookup current default ns in visibleNamespaces
for(var nsi=visibleNamespaces.length-1;nsi>=0;nsi--){var namespace=visibleNamespaces[nsi];if(namespace.prefix===''&&namespace.namespace===node.namespaceURI){defaultNS=namespace.namespace;break;}}}if(defaultNS!==node.namespaceURI){for(var nsi=visibleNamespaces.length-1;nsi>=0;nsi--){var namespace=visibleNamespaces[nsi];if(namespace.namespace===node.namespaceURI){if(namespace.prefix){prefixedNodeName=namespace.prefix+':'+nodeName;}break;}}}}buf.push('<',prefixedNodeName);for(var i=0;i<len;i++){// add namespaces for attributes
var attr=attrs.item(i);if(attr.prefix=='xmlns'){visibleNamespaces.push({prefix:attr.localName,namespace:attr.value});}else if(attr.nodeName=='xmlns'){visibleNamespaces.push({prefix:'',namespace:attr.value});}}for(var i=0;i<len;i++){var attr=attrs.item(i);if(needNamespaceDefine(attr,isHTML,visibleNamespaces)){var prefix=attr.prefix||'';var uri=attr.namespaceURI;addSerializedAttribute(buf,prefix?'xmlns:'+prefix:"xmlns",uri);visibleNamespaces.push({prefix:prefix,namespace:uri});}serializeToString(attr,buf,isHTML,nodeFilter,visibleNamespaces);}// add namespace for current node		
if(nodeName===prefixedNodeName&&needNamespaceDefine(node,isHTML,visibleNamespaces)){var prefix=node.prefix||'';var uri=node.namespaceURI;addSerializedAttribute(buf,prefix?'xmlns:'+prefix:"xmlns",uri);visibleNamespaces.push({prefix:prefix,namespace:uri});}if(child||isHTML&&!/^(?:meta|link|img|br|hr|input)$/i.test(nodeName)){buf.push('>');//if is cdata child node
if(isHTML&&/^script$/i.test(nodeName)){while(child){if(child.data){buf.push(child.data);}else{serializeToString(child,buf,isHTML,nodeFilter,visibleNamespaces.slice());}child=child.nextSibling;}}else{while(child){serializeToString(child,buf,isHTML,nodeFilter,visibleNamespaces.slice());child=child.nextSibling;}}buf.push('</',prefixedNodeName,'>');}else{buf.push('/>');}// remove added visible namespaces
//visibleNamespaces.length = startVisibleNamespaces;
return;case DOCUMENT_NODE$1:case DOCUMENT_FRAGMENT_NODE:var child=node.firstChild;while(child){serializeToString(child,buf,isHTML,nodeFilter,visibleNamespaces.slice());child=child.nextSibling;}return;case ATTRIBUTE_NODE:return addSerializedAttribute(buf,node.name,node.value);case TEXT_NODE$2:/**
					 * The ampersand character (&) and the left angle bracket (<) must not appear in their literal form,
					 * except when used as markup delimiters, or within a comment, a processing instruction, or a CDATA section.
					 * If they are needed elsewhere, they must be escaped using either numeric character references or the strings
					 * `&amp;` and `&lt;` respectively.
					 * The right angle bracket (>) may be represented using the string " &gt; ", and must, for compatibility,
					 * be escaped using either `&gt;` or a character reference when it appears in the string `]]>` in content,
					 * when that string is not marking the end of a CDATA section.
					 *
					 * In the content of elements, character data is any string of characters
					 * which does not contain the start-delimiter of any markup
					 * and does not include the CDATA-section-close delimiter, `]]>`.
					 *
					 * @see https://www.w3.org/TR/xml/#NT-CharData
					 */return buf.push(node.data.replace(/[<&]/g,_xmlEncoder).replace(/]]>/g,']]&gt;'));case CDATA_SECTION_NODE:return buf.push('<![CDATA[',node.data,']]>');case COMMENT_NODE:return buf.push("<!--",node.data,"-->");case DOCUMENT_TYPE_NODE:var pubid=node.publicId;var sysid=node.systemId;buf.push('<!DOCTYPE ',node.name);if(pubid){buf.push(' PUBLIC ',pubid);if(sysid&&sysid!='.'){buf.push(' ',sysid);}buf.push('>');}else if(sysid&&sysid!='.'){buf.push(' SYSTEM ',sysid,'>');}else{var sub=node.internalSubset;if(sub){buf.push(" [",sub,"]");}buf.push(">");}return;case PROCESSING_INSTRUCTION_NODE:return buf.push("<?",node.target," ",node.data,"?>");case ENTITY_REFERENCE_NODE:return buf.push('&',node.nodeName,';');//case ENTITY_NODE:
//case NOTATION_NODE:
default:buf.push('??',node.nodeName);}}function _importNode(doc,node,deep){var node2;switch(node.nodeType){case ELEMENT_NODE$3:node2=node.cloneNode(false);node2.ownerDocument=doc;//var attrs = node2.attributes;
//var len = attrs.length;
//for(var i=0;i<len;i++){
//node2.setAttributeNodeNS(importNode(doc,attrs.item(i),deep));
//}
case DOCUMENT_FRAGMENT_NODE:break;case ATTRIBUTE_NODE:deep=true;break;//case ENTITY_REFERENCE_NODE:
//case PROCESSING_INSTRUCTION_NODE:
////case TEXT_NODE:
//case CDATA_SECTION_NODE:
//case COMMENT_NODE:
//	deep = false;
//	break;
//case DOCUMENT_NODE:
//case DOCUMENT_TYPE_NODE:
//cannot be imported.
//case ENTITY_NODE:
//case NOTATION_NODE：
//can not hit in level3
//default:throw e;
}if(!node2){node2=node.cloneNode(false);//false
}node2.ownerDocument=doc;node2.parentNode=null;if(deep){var child=node.firstChild;while(child){node2.appendChild(_importNode(doc,child,deep));child=child.nextSibling;}}return node2;}//
//var _relationMap = {firstChild:1,lastChild:1,previousSibling:1,nextSibling:1,
//					attributes:1,childNodes:1,parentNode:1,documentElement:1,doctype,};
function _cloneNode(doc,node,deep){var node2=new node.constructor();for(var n in node){var v=node[n];if(_typeof3(v)!='object'){if(v!=node2[n]){node2[n]=v;}}}if(node.childNodes){node2.childNodes=new NodeList();}node2.ownerDocument=doc;switch(node2.nodeType){case ELEMENT_NODE$3:var attrs=node.attributes;var attrs2=node2.attributes=new NamedNodeMap();var len=attrs.length;attrs2._ownerElement=node2;for(var i=0;i<len;i++){node2.setAttributeNode(_cloneNode(doc,attrs.item(i),true));}break;case ATTRIBUTE_NODE:deep=true;}if(deep){var child=node.firstChild;while(child){node2.appendChild(_cloneNode(doc,child,deep));child=child.nextSibling;}}return node2;}function __set__(object,key,value){object[key]=value;}//do dynamic
try{if(Object.defineProperty){Object.defineProperty(LiveNodeList.prototype,'length',{get:function get(){_updateLiveList(this);return this.$$length;}});Object.defineProperty(Node$1.prototype,'textContent',{get:function get(){return getTextContent(this);},set:function set(data){switch(this.nodeType){case ELEMENT_NODE$3:case DOCUMENT_FRAGMENT_NODE:while(this.firstChild){this.removeChild(this.firstChild);}if(data||String(data)){this.appendChild(this.ownerDocument.createTextNode(data));}break;default:this.data=data;this.value=data;this.nodeValue=data;}}});function getTextContent(node){switch(node.nodeType){case ELEMENT_NODE$3:case DOCUMENT_FRAGMENT_NODE:var buf=[];node=node.firstChild;while(node){if(node.nodeType!==7&&node.nodeType!==8){buf.push(getTextContent(node));}node=node.nextSibling;}return buf.join('');default:return node.nodeValue;}}__set__=function __set__(object,key,value){//console.log(value)
object['$$'+key]=value;};}}catch(e){//ie8
}//if(typeof require == 'function'){
dom$2.DocumentType=DocumentType;dom$2.DOMException=DOMException$1;dom$2.DOMImplementation=DOMImplementation$1;dom$2.Element=Element$1;dom$2.Node=Node$1;dom$2.NodeList=NodeList;dom$2.XMLSerializer=XMLSerializer$1;var domParser={};var entities$1={};(function(exports){var freeze=conventions$2.freeze;/**
			 * The entities that are predefined in every XML document.
			 *
			 * @see https://www.w3.org/TR/2006/REC-xml11-20060816/#sec-predefined-ent W3C XML 1.1
			 * @see https://www.w3.org/TR/2008/REC-xml-20081126/#sec-predefined-ent W3C XML 1.0
			 * @see https://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references#Predefined_entities_in_XML Wikipedia
			 */exports.XML_ENTITIES=freeze({amp:'&',apos:"'",gt:'>',lt:'<',quot:'"'});/**
			 * A map of currently 241 entities that are detected in an HTML document.
			 * They contain all entries from `XML_ENTITIES`.
			 *
			 * @see XML_ENTITIES
			 * @see DOMParser.parseFromString
			 * @see DOMImplementation.prototype.createHTMLDocument
			 * @see https://html.spec.whatwg.org/#named-character-references WHATWG HTML(5) Spec
			 * @see https://www.w3.org/TR/xml-entity-names/ W3C XML Entity Names
			 * @see https://www.w3.org/TR/html4/sgml/entities.html W3C HTML4/SGML
			 * @see https://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references#Character_entity_references_in_HTML Wikipedia (HTML)
			 * @see https://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references#Entities_representing_special_characters_in_XHTML Wikpedia (XHTML)
			 */exports.HTML_ENTITIES=freeze({lt:'<',gt:'>',amp:'&',quot:'"',apos:"'",Agrave:"À",Aacute:"Á",Acirc:"Â",Atilde:"Ã",Auml:"Ä",Aring:"Å",AElig:"Æ",Ccedil:"Ç",Egrave:"È",Eacute:"É",Ecirc:"Ê",Euml:"Ë",Igrave:"Ì",Iacute:"Í",Icirc:"Î",Iuml:"Ï",ETH:"Ð",Ntilde:"Ñ",Ograve:"Ò",Oacute:"Ó",Ocirc:"Ô",Otilde:"Õ",Ouml:"Ö",Oslash:"Ø",Ugrave:"Ù",Uacute:"Ú",Ucirc:"Û",Uuml:"Ü",Yacute:"Ý",THORN:"Þ",szlig:"ß",agrave:"à",aacute:"á",acirc:"â",atilde:"ã",auml:"ä",aring:"å",aelig:"æ",ccedil:"ç",egrave:"è",eacute:"é",ecirc:"ê",euml:"ë",igrave:"ì",iacute:"í",icirc:"î",iuml:"ï",eth:"ð",ntilde:"ñ",ograve:"ò",oacute:"ó",ocirc:"ô",otilde:"õ",ouml:"ö",oslash:"ø",ugrave:"ù",uacute:"ú",ucirc:"û",uuml:"ü",yacute:"ý",thorn:"þ",yuml:"ÿ",nbsp:"\xA0",iexcl:"¡",cent:"¢",pound:"£",curren:"¤",yen:"¥",brvbar:"¦",sect:"§",uml:"¨",copy:"©",ordf:"ª",laquo:"«",not:"¬",shy:"­­",reg:"®",macr:"¯",deg:"°",plusmn:"±",sup2:"²",sup3:"³",acute:"´",micro:"µ",para:"¶",middot:"·",cedil:"¸",sup1:"¹",ordm:"º",raquo:"»",frac14:"¼",frac12:"½",frac34:"¾",iquest:"¿",times:"×",divide:"÷",forall:"∀",part:"∂",exist:"∃",empty:"∅",nabla:"∇",isin:"∈",notin:"∉",ni:"∋",prod:"∏",sum:"∑",minus:"−",lowast:"∗",radic:"√",prop:"∝",infin:"∞",ang:"∠",and:"∧",or:"∨",cap:"∩",cup:"∪",'int':"∫",there4:"∴",sim:"∼",cong:"≅",asymp:"≈",ne:"≠",equiv:"≡",le:"≤",ge:"≥",sub:"⊂",sup:"⊃",nsub:"⊄",sube:"⊆",supe:"⊇",oplus:"⊕",otimes:"⊗",perp:"⊥",sdot:"⋅",Alpha:"Α",Beta:"Β",Gamma:"Γ",Delta:"Δ",Epsilon:"Ε",Zeta:"Ζ",Eta:"Η",Theta:"Θ",Iota:"Ι",Kappa:"Κ",Lambda:"Λ",Mu:"Μ",Nu:"Ν",Xi:"Ξ",Omicron:"Ο",Pi:"Π",Rho:"Ρ",Sigma:"Σ",Tau:"Τ",Upsilon:"Υ",Phi:"Φ",Chi:"Χ",Psi:"Ψ",Omega:"Ω",alpha:"α",beta:"β",gamma:"γ",delta:"δ",epsilon:"ε",zeta:"ζ",eta:"η",theta:"θ",iota:"ι",kappa:"κ",lambda:"λ",mu:"μ",nu:"ν",xi:"ξ",omicron:"ο",pi:"π",rho:"ρ",sigmaf:"ς",sigma:"σ",tau:"τ",upsilon:"υ",phi:"φ",chi:"χ",psi:"ψ",omega:"ω",thetasym:"ϑ",upsih:"ϒ",piv:"ϖ",OElig:"Œ",oelig:"œ",Scaron:"Š",scaron:"š",Yuml:"Ÿ",fnof:"ƒ",circ:"ˆ",tilde:"˜",ensp:" ",emsp:" ",thinsp:" ",zwnj:"‌",zwj:"‍",lrm:"‎",rlm:"‏",ndash:"–",mdash:"—",lsquo:"‘",rsquo:"’",sbquo:"‚",ldquo:"“",rdquo:"”",bdquo:"„",dagger:"†",Dagger:"‡",bull:"•",hellip:"…",permil:"‰",prime:"′",Prime:"″",lsaquo:"‹",rsaquo:"›",oline:"‾",euro:"€",trade:"™",larr:"←",uarr:"↑",rarr:"→",darr:"↓",harr:"↔",crarr:"↵",lceil:"⌈",rceil:"⌉",lfloor:"⌊",rfloor:"⌋",loz:"◊",spades:"♠",clubs:"♣",hearts:"♥",diams:"♦"});/**
			 * @deprecated use `HTML_ENTITIES` instead
			 * @see HTML_ENTITIES
			 */exports.entityMap=exports.HTML_ENTITIES;})(entities$1);var sax$1={};var NAMESPACE$1=conventions$2.NAMESPACE;//[4]   	NameStartChar	   ::=   	":" | [A-Z] | "_" | [a-z] | [#xC0-#xD6] | [#xD8-#xF6] | [#xF8-#x2FF] | [#x370-#x37D] | [#x37F-#x1FFF] | [#x200C-#x200D] | [#x2070-#x218F] | [#x2C00-#x2FEF] | [#x3001-#xD7FF] | [#xF900-#xFDCF] | [#xFDF0-#xFFFD] | [#x10000-#xEFFFF]
//[4a]   	NameChar	   ::=   	NameStartChar | "-" | "." | [0-9] | #xB7 | [#x0300-#x036F] | [#x203F-#x2040]
//[5]   	Name	   ::=   	NameStartChar (NameChar)*
var nameStartChar=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/;//\u10000-\uEFFFF
var nameChar=new RegExp("[\\-\\.0-9"+nameStartChar.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]");var tagNamePattern=new RegExp('^'+nameStartChar.source+nameChar.source+'*(?:\:'+nameStartChar.source+nameChar.source+'*)?$');//var tagNamePattern = /^[a-zA-Z_][\w\-\.]*(?:\:[a-zA-Z_][\w\-\.]*)?$/
//var handlers = 'resolveEntity,getExternalSubset,characters,endDocument,endElement,endPrefixMapping,ignorableWhitespace,processingInstruction,setDocumentLocator,skippedEntity,startDocument,startElement,startPrefixMapping,notationDecl,unparsedEntityDecl,error,fatalError,warning,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,comment,endCDATA,endDTD,endEntity,startCDATA,startDTD,startEntity'.split(',')
//S_TAG,	S_ATTR,	S_EQ,	S_ATTR_NOQUOT_VALUE
//S_ATTR_SPACE,	S_ATTR_END,	S_TAG_SPACE, S_TAG_CLOSE
var S_TAG=0;//tag name offerring
var S_ATTR=1;//attr name offerring 
var S_ATTR_SPACE=2;//attr name end and space offer
var S_EQ=3;//=space?
var S_ATTR_NOQUOT_VALUE=4;//attr value(no quot value only)
var S_ATTR_END=5;//attr value end and no space(quot end)
var S_TAG_SPACE=6;//(attr value end || tag end ) && (space offer)
var S_TAG_CLOSE=7;//closed el<el />
/**
			 * Creates an error that will not be caught by XMLReader aka the SAX parser.
			 *
			 * @param {string} message
			 * @param {any?} locator Optional, can provide details about the location in the source
			 * @constructor
			 */function ParseError$1(message,locator){this.message=message;this.locator=locator;if(Error.captureStackTrace)Error.captureStackTrace(this,ParseError$1);}ParseError$1.prototype=new Error();ParseError$1.prototype.name=ParseError$1.name;function XMLReader$1(){}XMLReader$1.prototype={parse:function parse(source,defaultNSMap,entityMap){var domBuilder=this.domBuilder;domBuilder.startDocument();_copy(defaultNSMap,defaultNSMap={});parse$1(source,defaultNSMap,entityMap,domBuilder,this.errorHandler);domBuilder.endDocument();}};function parse$1(source,defaultNSMapCopy,entityMap,domBuilder,errorHandler){function fixedFromCharCode(code){// String.prototype.fromCharCode does not supports
// > 2 bytes unicode chars directly
if(code>0xffff){code-=0x10000;var surrogate1=0xd800+(code>>10),surrogate2=0xdc00+(code&0x3ff);return String.fromCharCode(surrogate1,surrogate2);}else{return String.fromCharCode(code);}}function entityReplacer(a){var k=a.slice(1,-1);if(k in entityMap){return entityMap[k];}else if(k.charAt(0)==='#'){return fixedFromCharCode(parseInt(k.substr(1).replace('x','0x')));}else{errorHandler.error('entity not found:'+a);return a;}}function appendText(end){//has some bugs
if(end>start){var xt=source.substring(start,end).replace(/&#?\w+;/g,entityReplacer);locator&&position(start);domBuilder.characters(xt,0,end-start);start=end;}}function position(p,m){while(p>=lineEnd&&(m=linePattern.exec(source))){lineStart=m.index;lineEnd=lineStart+m[0].length;locator.lineNumber++;//console.log('line++:',locator,startPos,endPos)
}locator.columnNumber=p-lineStart+1;}var lineStart=0;var lineEnd=0;var linePattern=/.*(?:\r\n?|\n)|.*$/g;var locator=domBuilder.locator;var parseStack=[{currentNSMap:defaultNSMapCopy}];var closeMap={};var start=0;while(true){try{var tagStart=source.indexOf('<',start);if(tagStart<0){if(!source.substr(start).match(/^\s*$/)){var doc=domBuilder.doc;var text=doc.createTextNode(source.substr(start));doc.appendChild(text);domBuilder.currentElement=text;}return;}if(tagStart>start){appendText(tagStart);}switch(source.charAt(tagStart+1)){case'/':var end=source.indexOf('>',tagStart+3);var tagName=source.substring(tagStart+2,end).replace(/[ \t\n\r]+$/g,'');var config=parseStack.pop();if(end<0){tagName=source.substring(tagStart+2).replace(/[\s<].*/,'');errorHandler.error("end tag name: "+tagName+' is not complete:'+config.tagName);end=tagStart+1+tagName.length;}else if(tagName.match(/\s</)){tagName=tagName.replace(/[\s<].*/,'');errorHandler.error("end tag name: "+tagName+' maybe not complete');end=tagStart+1+tagName.length;}var localNSMap=config.localNSMap;var endMatch=config.tagName==tagName;var endIgnoreCaseMach=endMatch||config.tagName&&config.tagName.toLowerCase()==tagName.toLowerCase();if(endIgnoreCaseMach){domBuilder.endElement(config.uri,config.localName,tagName);if(localNSMap){for(var prefix in localNSMap){domBuilder.endPrefixMapping(prefix);}}if(!endMatch){errorHandler.fatalError("end tag name: "+tagName+' is not match the current start tagName:'+config.tagName);// No known test case
}}else{parseStack.push(config);}end++;break;// end elment
case'?':// <?...?>
locator&&position(tagStart);end=parseInstruction(source,tagStart,domBuilder);break;case'!':// <!doctype,<![CDATA,<!--
locator&&position(tagStart);end=parseDCC(source,tagStart,domBuilder,errorHandler);break;default:locator&&position(tagStart);var el=new ElementAttributes();var currentNSMap=parseStack[parseStack.length-1].currentNSMap;//elStartEnd
var end=parseElementStartPart(source,tagStart,el,currentNSMap,entityReplacer,errorHandler);var len=el.length;if(!el.closed&&fixSelfClosed(source,end,el.tagName,closeMap)){el.closed=true;if(!entityMap.nbsp){errorHandler.warning('unclosed xml attribute');}}if(locator&&len){var locator2=copyLocator(locator,{});//try{//attribute position fixed
for(var i=0;i<len;i++){var a=el[i];position(a.offset);a.locator=copyLocator(locator,{});}domBuilder.locator=locator2;if(appendElement$1(el,domBuilder,currentNSMap)){parseStack.push(el);}domBuilder.locator=locator;}else{if(appendElement$1(el,domBuilder,currentNSMap)){parseStack.push(el);}}if(NAMESPACE$1.isHTML(el.uri)&&!el.closed){end=parseHtmlSpecialContent(source,end,el.tagName,entityReplacer,domBuilder);}else{end++;}}}catch(e){if(e instanceof ParseError$1){throw e;}errorHandler.error('element parse error: '+e);end=-1;}if(end>start){start=end;}else{//TODO: 这里有可能sax回退，有位置错误风险
appendText(Math.max(tagStart,start)+1);}}}function copyLocator(f,t){t.lineNumber=f.lineNumber;t.columnNumber=f.columnNumber;return t;}/**
			 * @see #appendElement(source,elStartEnd,el,selfClosed,entityReplacer,domBuilder,parseStack);
			 * @return end of the elementStartPart(end of elementEndPart for selfClosed el)
			 */function parseElementStartPart(source,start,el,currentNSMap,entityReplacer,errorHandler){/**
				 * @param {string} qname
				 * @param {string} value
				 * @param {number} startIndex
				 */function addAttribute(qname,value,startIndex){if(el.attributeNames.hasOwnProperty(qname)){errorHandler.fatalError('Attribute '+qname+' redefined');}el.addValue(qname,value,startIndex);}var attrName;var value;var p=++start;var s=S_TAG;//status
while(true){var c=source.charAt(p);switch(c){case'=':if(s===S_ATTR){//attrName
attrName=source.slice(start,p);s=S_EQ;}else if(s===S_ATTR_SPACE){s=S_EQ;}else{//fatalError: equal must after attrName or space after attrName
throw new Error('attribute equal must after attrName');// No known test case
}break;case'\'':case'"':if(s===S_EQ||s===S_ATTR//|| s == S_ATTR_SPACE
){//equal
if(s===S_ATTR){errorHandler.warning('attribute value must after "="');attrName=source.slice(start,p);}start=p+1;p=source.indexOf(c,start);if(p>0){value=source.slice(start,p).replace(/&#?\w+;/g,entityReplacer);addAttribute(attrName,value,start-1);s=S_ATTR_END;}else{//fatalError: no end quot match
throw new Error('attribute value no end \''+c+'\' match');}}else if(s==S_ATTR_NOQUOT_VALUE){value=source.slice(start,p).replace(/&#?\w+;/g,entityReplacer);//console.log(attrName,value,start,p)
addAttribute(attrName,value,start);//console.dir(el)
errorHandler.warning('attribute "'+attrName+'" missed start quot('+c+')!!');start=p+1;s=S_ATTR_END;}else{//fatalError: no equal before
throw new Error('attribute value must after "="');// No known test case
}break;case'/':switch(s){case S_TAG:el.setTagName(source.slice(start,p));case S_ATTR_END:case S_TAG_SPACE:case S_TAG_CLOSE:s=S_TAG_CLOSE;el.closed=true;case S_ATTR_NOQUOT_VALUE:case S_ATTR:case S_ATTR_SPACE:break;//case S_EQ:
default:throw new Error("attribute invalid close char('/')");// No known test case
}break;case''://end document
errorHandler.error('unexpected end of input');if(s==S_TAG){el.setTagName(source.slice(start,p));}return p;case'>':switch(s){case S_TAG:el.setTagName(source.slice(start,p));case S_ATTR_END:case S_TAG_SPACE:case S_TAG_CLOSE:break;//normal
case S_ATTR_NOQUOT_VALUE://Compatible state
case S_ATTR:value=source.slice(start,p);if(value.slice(-1)==='/'){el.closed=true;value=value.slice(0,-1);}case S_ATTR_SPACE:if(s===S_ATTR_SPACE){value=attrName;}if(s==S_ATTR_NOQUOT_VALUE){errorHandler.warning('attribute "'+value+'" missed quot(")!');addAttribute(attrName,value.replace(/&#?\w+;/g,entityReplacer),start);}else{if(!NAMESPACE$1.isHTML(currentNSMap[''])||!value.match(/^(?:disabled|checked|selected)$/i)){errorHandler.warning('attribute "'+value+'" missed value!! "'+value+'" instead!!');}addAttribute(value,value,start);}break;case S_EQ:throw new Error('attribute value missed!!');}//			console.log(tagName,tagNamePattern,tagNamePattern.test(tagName))
return p;/*xml space '\x20' | #x9 | #xD | #xA; */case"\x80":c=' ';default:if(c<=' '){//space
switch(s){case S_TAG:el.setTagName(source.slice(start,p));//tagName
s=S_TAG_SPACE;break;case S_ATTR:attrName=source.slice(start,p);s=S_ATTR_SPACE;break;case S_ATTR_NOQUOT_VALUE:var value=source.slice(start,p).replace(/&#?\w+;/g,entityReplacer);errorHandler.warning('attribute "'+value+'" missed quot(")!!');addAttribute(attrName,value,start);case S_ATTR_END:s=S_TAG_SPACE;break;//case S_TAG_SPACE:
//case S_EQ:
//case S_ATTR_SPACE:
//	void();break;
//case S_TAG_CLOSE:
//ignore warning
}}else{//not space
//S_TAG,	S_ATTR,	S_EQ,	S_ATTR_NOQUOT_VALUE
//S_ATTR_SPACE,	S_ATTR_END,	S_TAG_SPACE, S_TAG_CLOSE
switch(s){//case S_TAG:void();break;
//case S_ATTR:void();break;
//case S_ATTR_NOQUOT_VALUE:void();break;
case S_ATTR_SPACE:el.tagName;if(!NAMESPACE$1.isHTML(currentNSMap[''])||!attrName.match(/^(?:disabled|checked|selected)$/i)){errorHandler.warning('attribute "'+attrName+'" missed value!! "'+attrName+'" instead2!!');}addAttribute(attrName,attrName,start);start=p;s=S_ATTR;break;case S_ATTR_END:errorHandler.warning('attribute space is required"'+attrName+'"!!');case S_TAG_SPACE:s=S_ATTR;start=p;break;case S_EQ:s=S_ATTR_NOQUOT_VALUE;start=p;break;case S_TAG_CLOSE:throw new Error("elements closed character '/' and '>' must be connected to");}}}//end outer switch
//console.log('p++',p)
p++;}}/**
			 * @return true if has new namespace define
			 */function appendElement$1(el,domBuilder,currentNSMap){var tagName=el.tagName;var localNSMap=null;//var currentNSMap = parseStack[parseStack.length-1].currentNSMap;
var i=el.length;while(i--){var a=el[i];var qName=a.qName;var value=a.value;var nsp=qName.indexOf(':');if(nsp>0){var prefix=a.prefix=qName.slice(0,nsp);var localName=qName.slice(nsp+1);var nsPrefix=prefix==='xmlns'&&localName;}else{localName=qName;prefix=null;nsPrefix=qName==='xmlns'&&'';}//can not set prefix,because prefix !== ''
a.localName=localName;//prefix == null for no ns prefix attribute 
if(nsPrefix!==false){//hack!!
if(localNSMap==null){localNSMap={};//console.log(currentNSMap,0)
_copy(currentNSMap,currentNSMap={});//console.log(currentNSMap,1)
}currentNSMap[nsPrefix]=localNSMap[nsPrefix]=value;a.uri=NAMESPACE$1.XMLNS;domBuilder.startPrefixMapping(nsPrefix,value);}}var i=el.length;while(i--){a=el[i];var prefix=a.prefix;if(prefix){//no prefix attribute has no namespace
if(prefix==='xml'){a.uri=NAMESPACE$1.XML;}if(prefix!=='xmlns'){a.uri=currentNSMap[prefix||''];//{console.log('###'+a.qName,domBuilder.locator.systemId+'',currentNSMap,a.uri)}
}}}var nsp=tagName.indexOf(':');if(nsp>0){prefix=el.prefix=tagName.slice(0,nsp);localName=el.localName=tagName.slice(nsp+1);}else{prefix=null;//important!!
localName=el.localName=tagName;}//no prefix element has default namespace
var ns=el.uri=currentNSMap[prefix||''];domBuilder.startElement(ns,localName,tagName,el);//endPrefixMapping and startPrefixMapping have not any help for dom builder
//localNSMap = null
if(el.closed){domBuilder.endElement(ns,localName,tagName);if(localNSMap){for(prefix in localNSMap){domBuilder.endPrefixMapping(prefix);}}}else{el.currentNSMap=currentNSMap;el.localNSMap=localNSMap;//parseStack.push(el);
return true;}}function parseHtmlSpecialContent(source,elStartEnd,tagName,entityReplacer,domBuilder){if(/^(?:script|textarea)$/i.test(tagName)){var elEndStart=source.indexOf('</'+tagName+'>',elStartEnd);var text=source.substring(elStartEnd+1,elEndStart);if(/[&<]/.test(text)){if(/^script$/i.test(tagName)){//if(!/\]\]>/.test(text)){
//lexHandler.startCDATA();
domBuilder.characters(text,0,text.length);//lexHandler.endCDATA();
return elEndStart;//}
}//}else{//text area
text=text.replace(/&#?\w+;/g,entityReplacer);domBuilder.characters(text,0,text.length);return elEndStart;//}
}}return elStartEnd+1;}function fixSelfClosed(source,elStartEnd,tagName,closeMap){//if(tagName in closeMap){
var pos=closeMap[tagName];if(pos==null){//console.log(tagName)
pos=source.lastIndexOf('</'+tagName+'>');if(pos<elStartEnd){//忘记闭合
pos=source.lastIndexOf('</'+tagName);}closeMap[tagName]=pos;}return pos<elStartEnd;//} 
}function _copy(source,target){for(var n in source){target[n]=source[n];}}function parseDCC(source,start,domBuilder,errorHandler){//sure start with '<!'
var next=source.charAt(start+2);switch(next){case'-':if(source.charAt(start+3)==='-'){var end=source.indexOf('-->',start+4);//append comment source.substring(4,end)//<!--
if(end>start){domBuilder.comment(source,start+4,end-start-4);return end+3;}else{errorHandler.error("Unclosed comment");return-1;}}else{//error
return-1;}default:if(source.substr(start+3,6)=='CDATA['){var end=source.indexOf(']]>',start+9);domBuilder.startCDATA();domBuilder.characters(source,start+9,end-start-9);domBuilder.endCDATA();return end+3;}//<!DOCTYPE
//startDTD(java.lang.String name, java.lang.String publicId, java.lang.String systemId) 
var matchs=split(source,start);var len=matchs.length;if(len>1&&/!doctype/i.test(matchs[0][0])){var name=matchs[1][0];var pubid=false;var sysid=false;if(len>3){if(/^public$/i.test(matchs[2][0])){pubid=matchs[3][0];sysid=len>4&&matchs[4][0];}else if(/^system$/i.test(matchs[2][0])){sysid=matchs[3][0];}}var lastMatch=matchs[len-1];domBuilder.startDTD(name,pubid,sysid);domBuilder.endDTD();return lastMatch.index+lastMatch[0].length;}}return-1;}function parseInstruction(source,start,domBuilder){var end=source.indexOf('?>',start);if(end){var match=source.substring(start,end).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(match){match[0].length;domBuilder.processingInstruction(match[1],match[2]);return end+2;}else{//error
return-1;}}return-1;}function ElementAttributes(){this.attributeNames={};}ElementAttributes.prototype={setTagName:function setTagName(tagName){if(!tagNamePattern.test(tagName)){throw new Error('invalid tagName:'+tagName);}this.tagName=tagName;},addValue:function addValue(qName,value,offset){if(!tagNamePattern.test(qName)){throw new Error('invalid attribute:'+qName);}this.attributeNames[qName]=this.length;this[this.length++]={qName:qName,value:value,offset:offset};},length:0,getLocalName:function getLocalName(i){return this[i].localName;},getLocator:function getLocator(i){return this[i].locator;},getQName:function getQName(i){return this[i].qName;},getURI:function getURI(i){return this[i].uri;},getValue:function getValue(i){return this[i].value;}//	,getIndex:function(uri, localName)){
//		if(localName){
//			
//		}else{
//			var qName = uri
//		}
//	},
//	getValue:function(){return this.getValue(this.getIndex.apply(this,arguments))},
//	getType:function(uri,localName){}
//	getType:function(i){},
};function split(source,start){var match;var buf=[];var reg=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;reg.lastIndex=start;reg.exec(source);//skip <
while(match=reg.exec(source)){buf.push(match);if(match[1])return buf;}}sax$1.XMLReader=XMLReader$1;sax$1.ParseError=ParseError$1;var conventions=conventions$2;var dom$1=dom$2;var entities=entities$1;var sax=sax$1;var DOMImplementation=dom$1.DOMImplementation;var NAMESPACE=conventions.NAMESPACE;var ParseError=sax.ParseError;var XMLReader=sax.XMLReader;function DOMParser$1(options){this.options=options||{locator:{}};}DOMParser$1.prototype.parseFromString=function(source,mimeType){var options=this.options;var sax=new XMLReader();var domBuilder=options.domBuilder||new DOMHandler();//contentHandler and LexicalHandler
var errorHandler=options.errorHandler;var locator=options.locator;var defaultNSMap=options.xmlns||{};var isHTML=/\/x?html?$/.test(mimeType);//mimeType.toLowerCase().indexOf('html') > -1;
var entityMap=isHTML?entities.HTML_ENTITIES:entities.XML_ENTITIES;if(locator){domBuilder.setDocumentLocator(locator);}sax.errorHandler=buildErrorHandler(errorHandler,domBuilder,locator);sax.domBuilder=options.domBuilder||domBuilder;if(isHTML){defaultNSMap['']=NAMESPACE.HTML;}defaultNSMap.xml=defaultNSMap.xml||NAMESPACE.XML;if(source&&typeof source==='string'){sax.parse(source,defaultNSMap,entityMap);}else{sax.errorHandler.error("invalid doc source");}return domBuilder.doc;};function buildErrorHandler(errorImpl,domBuilder,locator){if(!errorImpl){if(domBuilder instanceof DOMHandler){return domBuilder;}errorImpl=domBuilder;}var errorHandler={};var isCallback=errorImpl instanceof Function;locator=locator||{};function build(key){var fn=errorImpl[key];if(!fn&&isCallback){fn=errorImpl.length==2?function(msg){errorImpl(key,msg);}:errorImpl;}errorHandler[key]=fn&&function(msg){fn('[xmldom '+key+']\t'+msg+_locator(locator));}||function(){};}build('warning');build('error');build('fatalError');return errorHandler;}//console.log('#\n\n\n\n\n\n\n####')
/**
			 * +ContentHandler+ErrorHandler
			 * +LexicalHandler+EntityResolver2
			 * -DeclHandler-DTDHandler
			 *
			 * DefaultHandler:EntityResolver, DTDHandler, ContentHandler, ErrorHandler
			 * DefaultHandler2:DefaultHandler,LexicalHandler, DeclHandler, EntityResolver2
			 * @link http://www.saxproject.org/apidoc/org/xml/sax/helpers/DefaultHandler.html
			 */function DOMHandler(){this.cdata=false;}function position(locator,node){node.lineNumber=locator.lineNumber;node.columnNumber=locator.columnNumber;}/**
			 * @see org.xml.sax.ContentHandler#startDocument
			 * @link http://www.saxproject.org/apidoc/org/xml/sax/ContentHandler.html
			 */DOMHandler.prototype={startDocument:function startDocument(){this.doc=new DOMImplementation().createDocument(null,null,null);if(this.locator){this.doc.documentURI=this.locator.systemId;}},startElement:function startElement(namespaceURI,localName,qName,attrs){var doc=this.doc;var el=doc.createElementNS(namespaceURI,qName||localName);var len=attrs.length;appendElement(this,el);this.currentElement=el;this.locator&&position(this.locator,el);for(var i=0;i<len;i++){var namespaceURI=attrs.getURI(i);var value=attrs.getValue(i);var qName=attrs.getQName(i);var attr=doc.createAttributeNS(namespaceURI,qName);this.locator&&position(attrs.getLocator(i),attr);attr.value=attr.nodeValue=value;el.setAttributeNode(attr);}},endElement:function endElement(namespaceURI,localName,qName){var current=this.currentElement;current.tagName;this.currentElement=current.parentNode;},startPrefixMapping:function startPrefixMapping(prefix,uri){},endPrefixMapping:function endPrefixMapping(prefix){},processingInstruction:function processingInstruction(target,data){var ins=this.doc.createProcessingInstruction(target,data);this.locator&&position(this.locator,ins);appendElement(this,ins);},ignorableWhitespace:function ignorableWhitespace(ch,start,length){},characters:function characters(chars,start,length){chars=_toString.apply(this,arguments);//console.log(chars)
if(chars){if(this.cdata){var charNode=this.doc.createCDATASection(chars);}else{var charNode=this.doc.createTextNode(chars);}if(this.currentElement){this.currentElement.appendChild(charNode);}else if(/^\s*$/.test(chars)){this.doc.appendChild(charNode);//process xml
}this.locator&&position(this.locator,charNode);}},skippedEntity:function skippedEntity(name){},endDocument:function endDocument(){this.doc.normalize();},setDocumentLocator:function setDocumentLocator(locator){if(this.locator=locator){// && !('lineNumber' in locator)){
locator.lineNumber=0;}},//LexicalHandler
comment:function comment(chars,start,length){chars=_toString.apply(this,arguments);var comm=this.doc.createComment(chars);this.locator&&position(this.locator,comm);appendElement(this,comm);},startCDATA:function startCDATA(){//used in characters() methods
this.cdata=true;},endCDATA:function endCDATA(){this.cdata=false;},startDTD:function startDTD(name,publicId,systemId){var impl=this.doc.implementation;if(impl&&impl.createDocumentType){var dt=impl.createDocumentType(name,publicId,systemId);this.locator&&position(this.locator,dt);appendElement(this,dt);this.doc.doctype=dt;}},/**
				 * @see org.xml.sax.ErrorHandler
				 * @link http://www.saxproject.org/apidoc/org/xml/sax/ErrorHandler.html
				 */warning:function warning(error){console.warn('[xmldom warning]\t'+error,_locator(this.locator));},error:function error(_error){console.error('[xmldom error]\t'+_error,_locator(this.locator));},fatalError:function fatalError(error){throw new ParseError(error,this.locator);}};function _locator(l){if(l){return'\n@'+(l.systemId||'')+'#[line:'+l.lineNumber+',col:'+l.columnNumber+']';}}function _toString(chars,start,length){if(typeof chars=='string'){return chars.substr(start,length);}else{//java sax connect width xmldom on rhino(what about: "? && !(chars instanceof String)")
if(chars.length>=start+length||start){return new java.lang.String(chars,start,length)+'';}return chars;}}/*
			 * @link http://www.saxproject.org/apidoc/org/xml/sax/ext/LexicalHandler.html
			 * used method of org.xml.sax.ext.LexicalHandler:
			 *  #comment(chars, start, length)
			 *  #startCDATA()
			 *  #endCDATA()
			 *  #startDTD(name, publicId, systemId)
			 *
			 *
			 * IGNORED method of org.xml.sax.ext.LexicalHandler:
			 *  #endDTD()
			 *  #startEntity(name)
			 *  #endEntity(name)
			 *
			 *
			 * @link http://www.saxproject.org/apidoc/org/xml/sax/ext/DeclHandler.html
			 * IGNORED method of org.xml.sax.ext.DeclHandler
			 * 	#attributeDecl(eName, aName, type, mode, value)
			 *  #elementDecl(name, model)
			 *  #externalEntityDecl(name, publicId, systemId)
			 *  #internalEntityDecl(name, value)
			 * @link http://www.saxproject.org/apidoc/org/xml/sax/ext/EntityResolver2.html
			 * IGNORED method of org.xml.sax.EntityResolver2
			 *  #resolveEntity(String name,String publicId,String baseURI,String systemId)
			 *  #resolveEntity(publicId, systemId)
			 *  #getExternalSubset(name, baseURI)
			 * @link http://www.saxproject.org/apidoc/org/xml/sax/DTDHandler.html
			 * IGNORED method of org.xml.sax.DTDHandler
			 *  #notationDecl(name, publicId, systemId) {};
			 *  #unparsedEntityDecl(name, publicId, systemId, notationName) {};
			 */"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(key){DOMHandler.prototype[key]=function(){return null;};});/* Private static helpers treated below as private instance methods, so don't need to add these to the public API; we might use a Relator to also get rid of non-standard public properties */function appendElement(hander,node){if(!hander.currentElement){hander.doc.appendChild(node);}else{hander.currentElement.appendChild(node);}}//appendChild and setAttributeNS are preformance key
domParser.__DOMHandler=DOMHandler;domParser.DOMParser=DOMParser$1;/**
			 * @deprecated Import/require from main entry point instead
			 */domParser.DOMImplementation=dom$1.DOMImplementation;/**
			 * @deprecated Import/require from main entry point instead
			 */domParser.XMLSerializer=dom$1.XMLSerializer;var dom=dom$2;lib.DOMImplementation=dom.DOMImplementation;lib.XMLSerializer=dom.XMLSerializer;lib.DOMParser=domParser.DOMParser;Object.defineProperty(core,"__esModule",{value:true});core.RangeObject=void 0;core.blob2base64=blob2base64;core.borders=borders;core.bounds=bounds;core.createBase64Url=createBase64Url;core.createBlob=createBlob;core.createBlobUrl=createBlobUrl;core.defaults=defaults;core.defer=defer;core.documentHeight=documentHeight;core.extend=extend;core.filterChildren=filterChildren;core.findChildren=findChildren;core.getParentByTagName=getParentByTagName;core.indexOfElementNode=indexOfElementNode;core.indexOfNode=indexOfNode;core.indexOfSorted=indexOfSorted;core.indexOfTextNode=indexOfTextNode;core.insert=insert;core.isElement=isElement;core.isFloat=isFloat;core.isNumber=isNumber;core.isXml=isXml;core.locationOf=locationOf;core.nodeBounds=nodeBounds;core.parents=parents;core.parse=parse;core.prefixed=prefixed;core.qs=qs;core.qsa=qsa;core.qsp=qsp;core.querySelectorByType=querySelectorByType;core.requestAnimationFrame=void 0;core.revokeBlobUrl=revokeBlobUrl;core.sprint=sprint;core.treeWalker=treeWalker;core.type=type$7;core.uuid=uuid;core.walk=walk;core.windowBounds=windowBounds;var _xmldom$1=lib;/**
			 * Core Utilities and Helpers
			 * @module Core
			*/ /**
			 * Vendor prefixed requestAnimationFrame
			 * @returns {function} requestAnimationFrame
			 * @memberof Core
			 */var requestAnimationFrame$1=typeof window!="undefined"?window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame:false;core.requestAnimationFrame=requestAnimationFrame$1;var ELEMENT_NODE$2=1;var TEXT_NODE$1=3;var _URL=typeof URL!="undefined"?URL:typeof window!="undefined"?window.URL||window.webkitURL||window.mozURL:undefined;/**
			 * Generates a UUID
			 * based on: http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript
			 * @returns {string} uuid
			 * @memberof Core
			 */function uuid(){var d=new Date().getTime();var uuid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=(d+Math.random()*16)%16|0;d=Math.floor(d/16);return(c=="x"?r:r&0x7|0x8).toString(16);});return uuid;}/**
			 * Gets the height of a document
			 * @returns {number} height
			 * @memberof Core
			 */function documentHeight(){return Math.max(document.documentElement.clientHeight,document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight);}/**
			 * Checks if a node is an element
			 * @param {object} obj
			 * @returns {boolean}
			 * @memberof Core
			 */function isElement(obj){return!!(obj&&obj.nodeType==1);}/**
			 * @param {any} n
			 * @returns {boolean}
			 * @memberof Core
			 */function isNumber(n){return!isNaN(parseFloat(n))&&isFinite(n);}/**
			 * @param {any} n
			 * @returns {boolean}
			 * @memberof Core
			 */function isFloat(n){var f=parseFloat(n);if(isNumber(n)===false){return false;}if(typeof n==="string"&&n.indexOf(".")>-1){return true;}return Math.floor(f)!==f;}/**
			 * Get a prefixed css property
			 * @param {string} unprefixed
			 * @returns {string}
			 * @memberof Core
			 */function prefixed(unprefixed){var vendors=["Webkit","webkit","Moz","O","ms"];var prefixes=["-webkit-","-webkit-","-moz-","-o-","-ms-"];var lower=unprefixed.toLowerCase();var length=vendors.length;if(typeof document==="undefined"||typeof document.body.style[lower]!="undefined"){return unprefixed;}for(var i=0;i<length;i++){if(typeof document.body.style[prefixes[i]+lower]!="undefined"){return prefixes[i]+lower;}}return unprefixed;}/**
			 * Apply defaults to an object
			 * @param {object} obj
			 * @returns {object}
			 * @memberof Core
			 */function defaults(obj){for(var i=1,length=arguments.length;i<length;i++){var source=arguments[i];for(var prop in source){if(obj[prop]===void 0)obj[prop]=source[prop];}}return obj;}/**
			 * Extend properties of an object
			 * @param {object} target
			 * @returns {object}
			 * @memberof Core
			 */function extend(target){var sources=[].slice.call(arguments,1);sources.forEach(function(source){if(!source)return;Object.getOwnPropertyNames(source).forEach(function(propName){Object.defineProperty(target,propName,Object.getOwnPropertyDescriptor(source,propName));});});return target;}/**
			 * Fast quicksort insert for sorted array -- based on:
			 *  http://stackoverflow.com/questions/1344500/efficient-way-to-insert-a-number-into-a-sorted-array-of-numbers
			 * @param {any} item
			 * @param {array} array
			 * @param {function} [compareFunction]
			 * @returns {number} location (in array)
			 * @memberof Core
			 */function insert(item,array,compareFunction){var location=locationOf(item,array,compareFunction);array.splice(location,0,item);return location;}/**
			 * Finds where something would fit into a sorted array
			 * @param {any} item
			 * @param {array} array
			 * @param {function} [compareFunction]
			 * @param {function} [_start]
			 * @param {function} [_end]
			 * @returns {number} location (in array)
			 * @memberof Core
			 */function locationOf(item,array,compareFunction,_start,_end){var start=_start||0;var end=_end||array.length;var pivot=parseInt(start+(end-start)/2);var compared;if(!compareFunction){compareFunction=function compareFunction(a,b){if(a>b)return 1;if(a<b)return-1;if(a==b)return 0;};}if(end-start<=0){return pivot;}compared=compareFunction(array[pivot],item);if(end-start===1){return compared>=0?pivot:pivot+1;}if(compared===0){return pivot;}if(compared===-1){return locationOf(item,array,compareFunction,pivot,end);}else{return locationOf(item,array,compareFunction,start,pivot);}}/**
			 * Finds index of something in a sorted array
			 * Returns -1 if not found
			 * @param {any} item
			 * @param {array} array
			 * @param {function} [compareFunction]
			 * @param {function} [_start]
			 * @param {function} [_end]
			 * @returns {number} index (in array) or -1
			 * @memberof Core
			 */function indexOfSorted(item,array,compareFunction,_start,_end){var start=_start||0;var end=_end||array.length;var pivot=parseInt(start+(end-start)/2);var compared;if(!compareFunction){compareFunction=function compareFunction(a,b){if(a>b)return 1;if(a<b)return-1;if(a==b)return 0;};}if(end-start<=0){return-1;// Not found
}compared=compareFunction(array[pivot],item);if(end-start===1){return compared===0?pivot:-1;}if(compared===0){return pivot;// Found
}if(compared===-1){return indexOfSorted(item,array,compareFunction,pivot,end);}else{return indexOfSorted(item,array,compareFunction,start,pivot);}}/**
			 * Find the bounds of an element
			 * taking padding and margin into account
			 * @param {element} el
			 * @returns {{ width: Number, height: Number}}
			 * @memberof Core
			 */function bounds(el){var style=window.getComputedStyle(el);var widthProps=["width","paddingRight","paddingLeft","marginRight","marginLeft","borderRightWidth","borderLeftWidth"];var heightProps=["height","paddingTop","paddingBottom","marginTop","marginBottom","borderTopWidth","borderBottomWidth"];var width=0;var height=0;widthProps.forEach(function(prop){width+=parseFloat(style[prop])||0;});heightProps.forEach(function(prop){height+=parseFloat(style[prop])||0;});return{height:height,width:width};}/**
			 * Find the bounds of an element
			 * taking padding, margin and borders into account
			 * @param {element} el
			 * @returns {{ width: Number, height: Number}}
			 * @memberof Core
			 */function borders(el){var style=window.getComputedStyle(el);var widthProps=["paddingRight","paddingLeft","marginRight","marginLeft","borderRightWidth","borderLeftWidth"];var heightProps=["paddingTop","paddingBottom","marginTop","marginBottom","borderTopWidth","borderBottomWidth"];var width=0;var height=0;widthProps.forEach(function(prop){width+=parseFloat(style[prop])||0;});heightProps.forEach(function(prop){height+=parseFloat(style[prop])||0;});return{height:height,width:width};}/**
			 * Find the bounds of any node
			 * allows for getting bounds of text nodes by wrapping them in a range
			 * @param {node} node
			 * @returns {BoundingClientRect}
			 * @memberof Core
			 */function nodeBounds(node){var elPos;var doc=node.ownerDocument;if(node.nodeType==Node.TEXT_NODE){var elRange=doc.createRange();elRange.selectNodeContents(node);elPos=elRange.getBoundingClientRect();}else{elPos=node.getBoundingClientRect();}return elPos;}/**
			 * Find the equivalent of getBoundingClientRect of a browser window
			 * @returns {{ width: Number, height: Number, top: Number, left: Number, right: Number, bottom: Number }}
			 * @memberof Core
			 */function windowBounds(){var width=window.innerWidth;var height=window.innerHeight;return{top:0,left:0,right:width,bottom:height,width:width,height:height};}/**
			 * Gets the index of a node in its parent
			 * @param {Node} node
			 * @param {string} typeId
			 * @return {number} index
			 * @memberof Core
			 */function indexOfNode(node,typeId){var parent=node.parentNode;var children=parent.childNodes;var sib;var index=-1;for(var i=0;i<children.length;i++){sib=children[i];if(sib.nodeType===typeId){index++;}if(sib==node)break;}return index;}/**
			 * Gets the index of a text node in its parent
			 * @param {node} textNode
			 * @returns {number} index
			 * @memberof Core
			 */function indexOfTextNode(textNode){return indexOfNode(textNode,TEXT_NODE$1);}/**
			 * Gets the index of an element node in its parent
			 * @param {element} elementNode
			 * @returns {number} index
			 * @memberof Core
			 */function indexOfElementNode(elementNode){return indexOfNode(elementNode,ELEMENT_NODE$2);}/**
			 * Check if extension is xml
			 * @param {string} ext
			 * @returns {boolean}
			 * @memberof Core
			 */function isXml(ext){return["xml","opf","ncx"].indexOf(ext)>-1;}/**
			 * Create a new blob
			 * @param {any} content
			 * @param {string} mime
			 * @returns {Blob}
			 * @memberof Core
			 */function createBlob(content,mime){return new Blob([content],{type:mime});}/**
			 * Create a new blob url
			 * @param {any} content
			 * @param {string} mime
			 * @returns {string} url
			 * @memberof Core
			 */function createBlobUrl(content,mime){var tempUrl;var blob=createBlob(content,mime);tempUrl=_URL.createObjectURL(blob);return tempUrl;}/**
			 * Remove a blob url
			 * @param {string} url
			 * @memberof Core
			 */function revokeBlobUrl(url){return _URL.revokeObjectURL(url);}/**
			 * Create a new base64 encoded url
			 * @param {any} content
			 * @param {string} mime
			 * @returns {string} url
			 * @memberof Core
			 */function createBase64Url(content,mime){var data;var datauri;if(typeof content!=="string"){// Only handles strings
return;}data=btoa(content);datauri="data:"+mime+";base64,"+data;return datauri;}/**
			 * Get type of an object
			 * @param {object} obj
			 * @returns {string} type
			 * @memberof Core
			 */function type$7(obj){return Object.prototype.toString.call(obj).slice(8,-1);}/**
			 * Parse xml (or html) markup
			 * @param {string} markup
			 * @param {string} mime
			 * @param {boolean} forceXMLDom force using xmlDom to parse instead of native parser
			 * @returns {document} document
			 * @memberof Core
			 */function parse(markup,mime,forceXMLDom){var doc;var Parser;if(typeof DOMParser==="undefined"||forceXMLDom){Parser=_xmldom$1.DOMParser;}else{Parser=DOMParser;}// Remove byte order mark before parsing
// https://www.w3.org/International/questions/qa-byte-order-mark
if(markup.charCodeAt(0)===0xFEFF){markup=markup.slice(1);}doc=new Parser().parseFromString(markup,mime);return doc;}/**
			 * querySelector polyfill
			 * @param {element} el
			 * @param {string} sel selector string
			 * @returns {element} element
			 * @memberof Core
			 */function qs(el,sel){var elements;if(!el){throw new Error("No Element Provided");}if(typeof el.querySelector!="undefined"){return el.querySelector(sel);}else{elements=el.getElementsByTagName(sel);if(elements.length){return elements[0];}}}/**
			 * querySelectorAll polyfill
			 * @param {element} el
			 * @param {string} sel selector string
			 * @returns {element[]} elements
			 * @memberof Core
			 */function qsa(el,sel){if(typeof el.querySelector!="undefined"){return el.querySelectorAll(sel);}else{return el.getElementsByTagName(sel);}}/**
			 * querySelector by property
			 * @param {element} el
			 * @param {string} sel selector string
			 * @param {object[]} props
			 * @returns {element[]} elements
			 * @memberof Core
			 */function qsp(el,sel,props){var q,filtered;if(typeof el.querySelector!="undefined"){sel+="[";for(var prop in props){sel+=prop+"~='"+props[prop]+"'";}sel+="]";return el.querySelector(sel);}else{q=el.getElementsByTagName(sel);filtered=Array.prototype.slice.call(q,0).filter(function(el){for(var prop in props){if(el.getAttribute(prop)===props[prop]){return true;}}return false;});if(filtered){return filtered[0];}}}/**
			 * Sprint through all text nodes in a document
			 * @memberof Core
			 * @param  {element} root element to start with
			 * @param  {function} func function to run on each element
			 */function sprint(root,func){var doc=root.ownerDocument||root;if(typeof doc.createTreeWalker!=="undefined"){treeWalker(root,func,NodeFilter.SHOW_TEXT);}else{walk(root,function(node){if(node&&node.nodeType===3){// Node.TEXT_NODE
func(node);}});}}/**
			 * Create a treeWalker
			 * @memberof Core
			 * @param  {element} root element to start with
			 * @param  {function} func function to run on each element
			 * @param  {function | object} filter function or object to filter with
			 */function treeWalker(root,func,filter){var treeWalker=document.createTreeWalker(root,filter,null,false);var node;while(node=treeWalker.nextNode()){func(node);}}/**
			 * @memberof Core
			 * @param {node} node
			 * @param {callback} return false for continue,true for break inside callback
			 */function walk(node,callback){if(callback(node)){return true;}node=node.firstChild;if(node){do{var walked=walk(node,callback);if(walked){return true;}node=node.nextSibling;}while(node);}}/**
			 * Convert a blob to a base64 encoded string
			 * @param {Blog} blob
			 * @returns {string}
			 * @memberof Core
			 */function blob2base64(blob){return new Promise(function(resolve,reject){var reader=new FileReader();reader.readAsDataURL(blob);reader.onloadend=function(){resolve(reader.result);};});}/**
			 * Creates a new pending promise and provides methods to resolve or reject it.
			 * From: https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/Promise.jsm/Deferred#backwards_forwards_compatible
			 * @memberof Core
			 */function defer(){var _this10=this;/* A method to resolve the associated Promise with the value passed.
			   * If the promise is already settled it does nothing.
			   *
			   * @param {anything} value : This value is used to resolve the promise
			   * If the value is a Promise then the associated promise assumes the state
			   * of Promise passed as value.
			   */this.resolve=null;/* A method to reject the associated Promise with the value passed.
			   * If the promise is already settled it does nothing.
			   *
			   * @param {anything} reason: The reason for the rejection of the Promise.
			   * Generally its an Error object. If however a Promise is passed, then the Promise
			   * itself will be the reason for rejection no matter the state of the Promise.
			   */this.reject=null;this.id=uuid();/* A newly created Pomise object.
			   * Initially in pending state.
			   */this.promise=new Promise(function(resolve,reject){_this10.resolve=resolve;_this10.reject=reject;});Object.freeze(this);}/**
			 * querySelector with filter by epub type
			 * @param {element} html
			 * @param {string} element element type to find
			 * @param {string} type epub type to find
			 * @returns {element[]} elements
			 * @memberof Core
			 */function querySelectorByType(html,element,type){var query;if(typeof html.querySelector!="undefined"){query=html.querySelector("".concat(element,"[*|type=\"").concat(type,"\"]"));}// Handle IE not supporting namespaced epub:type in querySelector
if(!query||query.length===0){query=qsa(html,element);for(var i=0;i<query.length;i++){if(query[i].getAttributeNS("http://www.idpf.org/2007/ops","type")===type||query[i].getAttribute("epub:type")===type){return query[i];}}}else{return query;}}/**
			 * Find direct descendents of an element
			 * @param {element} el
			 * @returns {element[]} children
			 * @memberof Core
			 */function findChildren(el){var result=[];var childNodes=el.childNodes;for(var i=0;i<childNodes.length;i++){var node=childNodes[i];if(node.nodeType===1){result.push(node);}}return result;}/**
			 * Find all parents (ancestors) of an element
			 * @param {element} node
			 * @returns {element[]} parents
			 * @memberof Core
			 */function parents(node){var nodes=[node];for(;node;node=node.parentNode){nodes.unshift(node);}return nodes;}/**
			 * Find all direct descendents of a specific type
			 * @param {element} el
			 * @param {string} nodeName
			 * @param {boolean} [single]
			 * @returns {element[]} children
			 * @memberof Core
			 */function filterChildren(el,nodeName,single){var result=[];var childNodes=el.childNodes;for(var i=0;i<childNodes.length;i++){var node=childNodes[i];if(node.nodeType===1&&node.nodeName.toLowerCase()===nodeName){if(single){return node;}else{result.push(node);}}}if(!single){return result;}}/**
			 * Filter all parents (ancestors) with tag name
			 * @param {element} node
			 * @param {string} tagname
			 * @returns {element[]} parents
			 * @memberof Core
			 */function getParentByTagName(node,tagname){var parent;if(node===null||tagname==='')return;parent=node.parentNode;while(parent.nodeType===1){if(parent.tagName.toLowerCase()===tagname){return parent;}parent=parent.parentNode;}}/**
			 * Lightweight Polyfill for DOM Range
			 * @class
			 * @memberof Core
			 */var RangeObject=/*#__PURE__*/function(){function RangeObject(){_classCallCheck3(this,RangeObject);this.collapsed=false;this.commonAncestorContainer=undefined;this.endContainer=undefined;this.endOffset=undefined;this.startContainer=undefined;this.startOffset=undefined;}_createClass3(RangeObject,[{key:"setStart",value:function setStart(startNode,startOffset){this.startContainer=startNode;this.startOffset=startOffset;if(!this.endContainer){this.collapse(true);}else{this.commonAncestorContainer=this._commonAncestorContainer();}this._checkCollapsed();}},{key:"setEnd",value:function setEnd(endNode,endOffset){this.endContainer=endNode;this.endOffset=endOffset;if(!this.startContainer){this.collapse(false);}else{this.collapsed=false;this.commonAncestorContainer=this._commonAncestorContainer();}this._checkCollapsed();}},{key:"collapse",value:function collapse(toStart){this.collapsed=true;if(toStart){this.endContainer=this.startContainer;this.endOffset=this.startOffset;this.commonAncestorContainer=this.startContainer.parentNode;}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset;this.commonAncestorContainer=this.endOffset.parentNode;}}},{key:"selectNode",value:function selectNode(referenceNode){var parent=referenceNode.parentNode;var index=Array.prototype.indexOf.call(parent.childNodes,referenceNode);this.setStart(parent,index);this.setEnd(parent,index+1);}},{key:"selectNodeContents",value:function selectNodeContents(referenceNode){referenceNode.childNodes[referenceNode.childNodes-1];var endIndex=referenceNode.nodeType===3?referenceNode.textContent.length:parent.childNodes.length;this.setStart(referenceNode,0);this.setEnd(referenceNode,endIndex);}},{key:"_commonAncestorContainer",value:function _commonAncestorContainer(startContainer,endContainer){var startParents=parents(startContainer||this.startContainer);var endParents=parents(endContainer||this.endContainer);if(startParents[0]!=endParents[0])return undefined;for(var i=0;i<startParents.length;i++){if(startParents[i]!=endParents[i]){return startParents[i-1];}}}},{key:"_checkCollapsed",value:function _checkCollapsed(){if(this.startContainer===this.endContainer&&this.startOffset===this.endOffset){this.collapsed=true;}else{this.collapsed=false;}}},{key:"toString",value:function toString(){// TODO: implement walking between start and end to find text
}}]);return RangeObject;}();core.RangeObject=RangeObject;var url={};var path$1={};if(!process$1){var process$1={"cwd":function cwd(){return'/';}};}function assertPath(path){if(typeof path!=='string'){throw new TypeError('Path must be a string. Received '+path);}}// Resolves . and .. elements in a path with directory names
function normalizeStringPosix(path,allowAboveRoot){var res='';var lastSlash=-1;var dots=0;var code;for(var i=0;i<=path.length;++i){if(i<path.length)code=path.charCodeAt(i);else if(code===47/*/*/)break;else code=47/*/*/;if(code===47/*/*/){if(lastSlash===i-1||dots===1);else if(lastSlash!==i-1&&dots===2){if(res.length<2||res.charCodeAt(res.length-1)!==46/*.*/||res.charCodeAt(res.length-2)!==46/*.*/){if(res.length>2){var start=res.length-1;var j=start;for(;j>=0;--j){if(res.charCodeAt(j)===47/*/*/)break;}if(j!==start){if(j===-1)res='';else res=res.slice(0,j);lastSlash=i;dots=0;continue;}}else if(res.length===2||res.length===1){res='';lastSlash=i;dots=0;continue;}}if(allowAboveRoot){if(res.length>0)res+='/..';else res='..';}}else{if(res.length>0)res+='/'+path.slice(lastSlash+1,i);else res=path.slice(lastSlash+1,i);}lastSlash=i;dots=0;}else if(code===46/*.*/&&dots!==-1){++dots;}else{dots=-1;}}return res;}function _format(sep,pathObject){var dir=pathObject.dir||pathObject.root;var base=pathObject.base||(pathObject.name||'')+(pathObject.ext||'');if(!dir){return base;}if(dir===pathObject.root){return dir+base;}return dir+sep+base;}var posix={// path.resolve([from ...], to)
resolve:function resolve(){var resolvedPath='';var resolvedAbsolute=false;var cwd;for(var i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path;if(i>=0)path=arguments[i];else{if(cwd===undefined)cwd=process$1.cwd();path=cwd;}assertPath(path);// Skip empty entries
if(path.length===0){continue;}resolvedPath=path+'/'+resolvedPath;resolvedAbsolute=path.charCodeAt(0)===47/*/*/;}// At this point the path should be resolved to a full absolute path, but
// handle relative paths to be safe (might happen when process.cwd() fails)
// Normalize the path
resolvedPath=normalizeStringPosix(resolvedPath,!resolvedAbsolute);if(resolvedAbsolute){if(resolvedPath.length>0)return'/'+resolvedPath;else return'/';}else if(resolvedPath.length>0){return resolvedPath;}else{return'.';}},normalize:function normalize(path){assertPath(path);if(path.length===0)return'.';var isAbsolute=path.charCodeAt(0)===47/*/*/;var trailingSeparator=path.charCodeAt(path.length-1)===47/*/*/;// Normalize the path
path=normalizeStringPosix(path,!isAbsolute);if(path.length===0&&!isAbsolute)path='.';if(path.length>0&&trailingSeparator)path+='/';if(isAbsolute)return'/'+path;return path;},isAbsolute:function isAbsolute(path){assertPath(path);return path.length>0&&path.charCodeAt(0)===47/*/*/;},join:function join(){if(arguments.length===0)return'.';var joined;for(var i=0;i<arguments.length;++i){var arg=arguments[i];assertPath(arg);if(arg.length>0){if(joined===undefined)joined=arg;else joined+='/'+arg;}}if(joined===undefined)return'.';return posix.normalize(joined);},relative:function relative(from,to){assertPath(from);assertPath(to);if(from===to)return'';from=posix.resolve(from);to=posix.resolve(to);if(from===to)return'';// Trim any leading backslashes
var fromStart=1;for(;fromStart<from.length;++fromStart){if(from.charCodeAt(fromStart)!==47/*/*/)break;}var fromEnd=from.length;var fromLen=fromEnd-fromStart;// Trim any leading backslashes
var toStart=1;for(;toStart<to.length;++toStart){if(to.charCodeAt(toStart)!==47/*/*/)break;}var toEnd=to.length;var toLen=toEnd-toStart;// Compare paths to find the longest common path from root
var length=fromLen<toLen?fromLen:toLen;var lastCommonSep=-1;var i=0;for(;i<=length;++i){if(i===length){if(toLen>length){if(to.charCodeAt(toStart+i)===47/*/*/){// We get here if `from` is the exact base path for `to`.
// For example: from='/foo/bar'; to='/foo/bar/baz'
return to.slice(toStart+i+1);}else if(i===0){// We get here if `from` is the root
// For example: from='/'; to='/foo'
return to.slice(toStart+i);}}else if(fromLen>length){if(from.charCodeAt(fromStart+i)===47/*/*/){// We get here if `to` is the exact base path for `from`.
// For example: from='/foo/bar/baz'; to='/foo/bar'
lastCommonSep=i;}else if(i===0){// We get here if `to` is the root.
// For example: from='/foo'; to='/'
lastCommonSep=0;}}break;}var fromCode=from.charCodeAt(fromStart+i);var toCode=to.charCodeAt(toStart+i);if(fromCode!==toCode)break;else if(fromCode===47/*/*/)lastCommonSep=i;}var out='';// Generate the relative path based on the path difference between `to`
// and `from`
for(i=fromStart+lastCommonSep+1;i<=fromEnd;++i){if(i===fromEnd||from.charCodeAt(i)===47/*/*/){if(out.length===0)out+='..';else out+='/..';}}// Lastly, append the rest of the destination (`to`) path that comes after
// the common path parts
if(out.length>0)return out+to.slice(toStart+lastCommonSep);else{toStart+=lastCommonSep;if(to.charCodeAt(toStart)===47/*/*/)++toStart;return to.slice(toStart);}},_makeLong:function _makeLong(path){return path;},dirname:function dirname(path){assertPath(path);if(path.length===0)return'.';var code=path.charCodeAt(0);var hasRoot=code===47/*/*/;var end=-1;var matchedSlash=true;for(var i=path.length-1;i>=1;--i){code=path.charCodeAt(i);if(code===47/*/*/){if(!matchedSlash){end=i;break;}}else{// We saw the first non-path separator
matchedSlash=false;}}if(end===-1)return hasRoot?'/':'.';if(hasRoot&&end===1)return'//';return path.slice(0,end);},basename:function basename(path,ext){if(ext!==undefined&&typeof ext!=='string')throw new TypeError('"ext" argument must be a string');assertPath(path);var start=0;var end=-1;var matchedSlash=true;var i;if(ext!==undefined&&ext.length>0&&ext.length<=path.length){if(ext.length===path.length&&ext===path)return'';var extIdx=ext.length-1;var firstNonSlashEnd=-1;for(i=path.length-1;i>=0;--i){var code=path.charCodeAt(i);if(code===47/*/*/){// If we reached a path separator that was not part of a set of path
// separators at the end of the string, stop now
if(!matchedSlash){start=i+1;break;}}else{if(firstNonSlashEnd===-1){// We saw the first non-path separator, remember this index in case
// we need it if the extension ends up not matching
matchedSlash=false;firstNonSlashEnd=i+1;}if(extIdx>=0){// Try to match the explicit extension
if(code===ext.charCodeAt(extIdx)){if(--extIdx===-1){// We matched the extension, so mark this as the end of our path
// component
end=i;}}else{// Extension does not match, so our result is the entire path
// component
extIdx=-1;end=firstNonSlashEnd;}}}}if(start===end)end=firstNonSlashEnd;else if(end===-1)end=path.length;return path.slice(start,end);}else{for(i=path.length-1;i>=0;--i){if(path.charCodeAt(i)===47/*/*/){// If we reached a path separator that was not part of a set of path
// separators at the end of the string, stop now
if(!matchedSlash){start=i+1;break;}}else if(end===-1){// We saw the first non-path separator, mark this as the end of our
// path component
matchedSlash=false;end=i+1;}}if(end===-1)return'';return path.slice(start,end);}},extname:function extname(path){assertPath(path);var startDot=-1;var startPart=0;var end=-1;var matchedSlash=true;// Track the state of characters (if any) we see before our first dot and
// after any path separator we find
var preDotState=0;for(var i=path.length-1;i>=0;--i){var code=path.charCodeAt(i);if(code===47/*/*/){// If we reached a path separator that was not part of a set of path
// separators at the end of the string, stop now
if(!matchedSlash){startPart=i+1;break;}continue;}if(end===-1){// We saw the first non-path separator, mark this as the end of our
// extension
matchedSlash=false;end=i+1;}if(code===46/*.*/){// If this is our first dot, mark it as the start of our extension
if(startDot===-1)startDot=i;else if(preDotState!==1)preDotState=1;}else if(startDot!==-1){// We saw a non-dot and non-path separator before our dot, so we should
// have a good chance at having a non-empty extension
preDotState=-1;}}if(startDot===-1||end===-1||// We saw a non-dot character immediately before the dot
preDotState===0||// The (right-most) trimmed path component is exactly '..'
preDotState===1&&startDot===end-1&&startDot===startPart+1){return'';}return path.slice(startDot,end);},format:function format(pathObject){if(pathObject===null||_typeof3(pathObject)!=='object'){throw new TypeError('Parameter "pathObject" must be an object, not '+_typeof3(pathObject));}return _format('/',pathObject);},parse:function parse(path){assertPath(path);var ret={root:'',dir:'',base:'',ext:'',name:''};if(path.length===0)return ret;var code=path.charCodeAt(0);var isAbsolute=code===47/*/*/;var start;if(isAbsolute){ret.root='/';start=1;}else{start=0;}var startDot=-1;var startPart=0;var end=-1;var matchedSlash=true;var i=path.length-1;// Track the state of characters (if any) we see before our first dot and
// after any path separator we find
var preDotState=0;// Get non-dir info
for(;i>=start;--i){code=path.charCodeAt(i);if(code===47/*/*/){// If we reached a path separator that was not part of a set of path
// separators at the end of the string, stop now
if(!matchedSlash){startPart=i+1;break;}continue;}if(end===-1){// We saw the first non-path separator, mark this as the end of our
// extension
matchedSlash=false;end=i+1;}if(code===46/*.*/){// If this is our first dot, mark it as the start of our extension
if(startDot===-1)startDot=i;else if(preDotState!==1)preDotState=1;}else if(startDot!==-1){// We saw a non-dot and non-path separator before our dot, so we should
// have a good chance at having a non-empty extension
preDotState=-1;}}if(startDot===-1||end===-1||// We saw a non-dot character immediately before the dot
preDotState===0||// The (right-most) trimmed path component is exactly '..'
preDotState===1&&startDot===end-1&&startDot===startPart+1){if(end!==-1){if(startPart===0&&isAbsolute)ret.base=ret.name=path.slice(1,end);else ret.base=ret.name=path.slice(startPart,end);}}else{if(startPart===0&&isAbsolute){ret.name=path.slice(1,startDot);ret.base=path.slice(1,end);}else{ret.name=path.slice(startPart,startDot);ret.base=path.slice(startPart,end);}ret.ext=path.slice(startDot,end);}if(startPart>0)ret.dir=path.slice(0,startPart-1);else if(isAbsolute)ret.dir='/';return ret;},sep:'/',delimiter:':',posix:null};var path=posix;Object.defineProperty(path$1,"__esModule",{value:true});path$1.default=void 0;var _pathWebpack$3=_interopRequireDefault$r(path);function _interopRequireDefault$r(obj){return obj&&obj.__esModule?obj:{default:obj};}/**
			 * Creates a Path object for parsing and manipulation of a path strings
			 *
			 * Uses a polyfill for Nodejs path: https://nodejs.org/api/path.html
			 * @param	{string} pathString	a url string (relative or absolute)
			 * @class
			 */var Path=/*#__PURE__*/function(){function Path(pathString){_classCallCheck3(this,Path);var protocol;var parsed;protocol=pathString.indexOf("://");if(protocol>-1){pathString=new URL(pathString).pathname;}parsed=this.parse(pathString);this.path=pathString;if(this.isDirectory(pathString)){this.directory=pathString;}else{this.directory=parsed.dir+"/";}this.filename=parsed.base;this.extension=parsed.ext.slice(1);}/**
			   * Parse the path: https://nodejs.org/api/path.html#path_path_parse_path
			   * @param	{string} what
			   * @returns {object}
			   */_createClass3(Path,[{key:"parse",value:function parse(what){return _pathWebpack$3.default.parse(what);}/**
			   * @param	{string} what
			   * @returns {boolean}
			   */},{key:"isAbsolute",value:function isAbsolute(what){return _pathWebpack$3.default.isAbsolute(what||this.path);}/**
			   * Check if path ends with a directory
			   * @param	{string} what
			   * @returns {boolean}
			   */},{key:"isDirectory",value:function isDirectory(what){return what.charAt(what.length-1)==="/";}/**
			   * Resolve a path against the directory of the Path
			   *
			   * https://nodejs.org/api/path.html#path_path_resolve_paths
			   * @param	{string} what
			   * @returns {string} resolved
			   */},{key:"resolve",value:function resolve(what){return _pathWebpack$3.default.resolve(this.directory,what);}/**
			   * Resolve a path relative to the directory of the Path
			   *
			   * https://nodejs.org/api/path.html#path_path_relative_from_to
			   * @param	{string} what
			   * @returns {string} relative
			   */},{key:"relative",value:function relative(what){var isAbsolute=what&&what.indexOf("://")>-1;if(isAbsolute){return what;}return _pathWebpack$3.default.relative(this.directory,what);}},{key:"splitPath",value:function splitPath(filename){return this.splitPathRe.exec(filename).slice(1);}/**
			   * Return the path string
			   * @returns {string} path
			   */},{key:"toString",value:function toString(){return this.path;}}]);return Path;}();var _default$A=Path;path$1.default=_default$A;Object.defineProperty(url,"__esModule",{value:true});url.default=void 0;var _path$5=_interopRequireDefault$q(path$1);var _pathWebpack$2=_interopRequireDefault$q(path);function _interopRequireDefault$q(obj){return obj&&obj.__esModule?obj:{default:obj};}/**
			 * creates a Url object for parsing and manipulation of a url string
			 * @param	{string} urlString	a url string (relative or absolute)
			 * @param	{string} [baseString] optional base for the url,
			 * default to window.location.href
			 */var Url=/*#__PURE__*/function(){function Url(urlString,baseString){_classCallCheck3(this,Url);var absolute=urlString.indexOf("://")>-1;var pathname=urlString;var basePath;this.Url=undefined;this.href=urlString;this.protocol="";this.origin="";this.hash="";this.hash="";this.search="";this.base=baseString;if(!absolute&&baseString!==false&&typeof baseString!=="string"&&window&&window.location){this.base=window.location.href;}// URL Polyfill doesn't throw an error if base is empty
if(absolute||this.base){try{if(this.base){// Safari doesn't like an undefined base
this.Url=new URL(urlString,this.base);}else{this.Url=new URL(urlString);}this.href=this.Url.href;this.protocol=this.Url.protocol;this.origin=this.Url.origin;this.hash=this.Url.hash;this.search=this.Url.search;pathname=this.Url.pathname+(this.Url.search?this.Url.search:'');}catch(e){// Skip URL parsing
this.Url=undefined;// resolve the pathname from the base
if(this.base){basePath=new _path$5.default(this.base);pathname=basePath.resolve(pathname);}}}this.Path=new _path$5.default(pathname);this.directory=this.Path.directory;this.filename=this.Path.filename;this.extension=this.Path.extension;}/**
			   * @returns {Path}
			   */_createClass3(Url,[{key:"path",value:function path(){return this.Path;}/**
			   * Resolves a relative path to a absolute url
			   * @param {string} what
			   * @returns {string} url
			   */},{key:"resolve",value:function resolve(what){var isAbsolute=what.indexOf("://")>-1;var fullpath;if(isAbsolute){return what;}fullpath=_pathWebpack$2.default.resolve(this.directory,what);return this.origin+fullpath;}/**
			   * Resolve a path relative to the url
			   * @param {string} what
			   * @returns {string} path
			   */},{key:"relative",value:function relative(what){return _pathWebpack$2.default.relative(what,this.directory);}/**
			   * @returns {string}
			   */},{key:"toString",value:function toString(){return this.href;}}]);return Url;}();var _default$z=Url;url.default=_default$z;var spine={};var epubcfi={};Object.defineProperty(epubcfi,"__esModule",{value:true});epubcfi.default=void 0;var _core$n=core;var ELEMENT_NODE$1=1;var TEXT_NODE=3;var DOCUMENT_NODE=9;/**
				* Parsing and creation of EpubCFIs: http://www.idpf.org/epub/linking/cfi/epub-cfi.html

				* Implements:
				* - Character Offset: epubcfi(/6/4[chap01ref]!/4[body01]/10[para05]/2/1:3)
				* - Simple Ranges : epubcfi(/6/4[chap01ref]!/4[body01]/10[para05],/2/1:1,/3:4)

				* Does Not Implement:
				* - Temporal Offset (~)
				* - Spatial Offset (@)
				* - Temporal-Spatial Offset (~ + @)
				* - Text Location Assertion ([)
				* @class
				@param {string | Range | Node } [cfiFrom]
				@param {string | object} [base]
				@param {string} [ignoreClass] class to ignore when parsing DOM
			*/var EpubCFI=/*#__PURE__*/function(){function EpubCFI(cfiFrom,base,ignoreClass){_classCallCheck3(this,EpubCFI);var type;this.str="";this.base={};this.spinePos=0;// For compatibility
this.range=false;// true || false;
this.path={};this.start=null;this.end=null;// Allow instantiation without the "new" keyword
if(!(this instanceof EpubCFI)){return new EpubCFI(cfiFrom,base,ignoreClass);}if(typeof base==="string"){this.base=this.parseComponent(base);}else if(_typeof3(base)==="object"&&base.steps){this.base=base;}type=this.checkType(cfiFrom);if(type==="string"){this.str=cfiFrom;return(0,_core$n.extend)(this,this.parse(cfiFrom));}else if(type==="range"){return(0,_core$n.extend)(this,this.fromRange(cfiFrom,this.base,ignoreClass));}else if(type==="node"){return(0,_core$n.extend)(this,this.fromNode(cfiFrom,this.base,ignoreClass));}else if(type==="EpubCFI"&&cfiFrom.path){return cfiFrom;}else if(!cfiFrom){return this;}else{throw new TypeError("not a valid argument for EpubCFI");}}/**
			   * Check the type of constructor input
			   * @private
			   */_createClass3(EpubCFI,[{key:"checkType",value:function checkType(cfi){if(this.isCfiString(cfi)){return"string";// Is a range object
}else if(cfi&&_typeof3(cfi)==="object"&&((0,_core$n.type)(cfi)==="Range"||typeof cfi.startContainer!="undefined")){return"range";}else if(cfi&&_typeof3(cfi)==="object"&&typeof cfi.nodeType!="undefined"){// || typeof cfi === "function"
return"node";}else if(cfi&&_typeof3(cfi)==="object"&&cfi instanceof EpubCFI){return"EpubCFI";}else{return false;}}/**
			   * Parse a cfi string to a CFI object representation
			   * @param {string} cfiStr
			   * @returns {object} cfi
			   */},{key:"parse",value:function parse(cfiStr){var cfi={spinePos:-1,range:false,base:{},path:{},start:null,end:null};var baseComponent,pathComponent,range;if(typeof cfiStr!=="string"){return{spinePos:-1};}if(cfiStr.indexOf("epubcfi(")===0&&cfiStr[cfiStr.length-1]===")"){// Remove initial epubcfi( and ending )
cfiStr=cfiStr.slice(8,cfiStr.length-1);}baseComponent=this.getChapterComponent(cfiStr);// Make sure this is a valid cfi or return
if(!baseComponent){return{spinePos:-1};}cfi.base=this.parseComponent(baseComponent);pathComponent=this.getPathComponent(cfiStr);cfi.path=this.parseComponent(pathComponent);range=this.getRange(cfiStr);if(range){cfi.range=true;cfi.start=this.parseComponent(range[0]);cfi.end=this.parseComponent(range[1]);}// Get spine node position
// cfi.spineSegment = cfi.base.steps[1];
// Chapter segment is always the second step
cfi.spinePos=cfi.base.steps[1].index;return cfi;}},{key:"parseComponent",value:function parseComponent(componentStr){var component={steps:[],terminal:{offset:null,assertion:null}};var parts=componentStr.split(":");var steps=parts[0].split("/");var terminal;if(parts.length>1){terminal=parts[1];component.terminal=this.parseTerminal(terminal);}if(steps[0]===""){steps.shift();// Ignore the first slash
}component.steps=steps.map(function(step){return this.parseStep(step);}.bind(this));return component;}},{key:"parseStep",value:function parseStep(stepStr){var type,num,index,has_brackets,id;has_brackets=stepStr.match(/\[(.*)\]/);if(has_brackets&&has_brackets[1]){id=has_brackets[1];}//-- Check if step is a text node or element
num=parseInt(stepStr);if(isNaN(num)){return;}if(num%2===0){// Even = is an element
type="element";index=num/2-1;}else{type="text";index=(num-1)/2;}return{"type":type,"index":index,"id":id||null};}},{key:"parseTerminal",value:function parseTerminal(termialStr){var characterOffset,textLocationAssertion;var assertion=termialStr.match(/\[(.*)\]/);if(assertion&&assertion[1]){characterOffset=parseInt(termialStr.split("[")[0]);textLocationAssertion=assertion[1];}else{characterOffset=parseInt(termialStr);}if(!(0,_core$n.isNumber)(characterOffset)){characterOffset=null;}return{"offset":characterOffset,"assertion":textLocationAssertion};}},{key:"getChapterComponent",value:function getChapterComponent(cfiStr){var indirection=cfiStr.split("!");return indirection[0];}},{key:"getPathComponent",value:function getPathComponent(cfiStr){var indirection=cfiStr.split("!");if(indirection[1]){var ranges=indirection[1].split(",");return ranges[0];}}},{key:"getRange",value:function getRange(cfiStr){var ranges=cfiStr.split(",");if(ranges.length===3){return[ranges[1],ranges[2]];}return false;}},{key:"getCharecterOffsetComponent",value:function getCharecterOffsetComponent(cfiStr){var splitStr=cfiStr.split(":");return splitStr[1]||"";}},{key:"joinSteps",value:function joinSteps(steps){if(!steps){return"";}return steps.map(function(part){var segment="";if(part.type==="element"){segment+=(part.index+1)*2;}if(part.type==="text"){segment+=1+2*part.index;// TODO: double check that this is odd
}if(part.id){segment+="["+part.id+"]";}return segment;}).join("/");}},{key:"segmentString",value:function segmentString(segment){var segmentString="/";segmentString+=this.joinSteps(segment.steps);if(segment.terminal&&segment.terminal.offset!=null){segmentString+=":"+segment.terminal.offset;}if(segment.terminal&&segment.terminal.assertion!=null){segmentString+="["+segment.terminal.assertion+"]";}return segmentString;}/**
			   * Convert CFI to a epubcfi(...) string
			   * @returns {string} epubcfi
			   */},{key:"toString",value:function toString(){var cfiString="epubcfi(";cfiString+=this.segmentString(this.base);cfiString+="!";cfiString+=this.segmentString(this.path);// Add Range, if present
if(this.range&&this.start){cfiString+=",";cfiString+=this.segmentString(this.start);}if(this.range&&this.end){cfiString+=",";cfiString+=this.segmentString(this.end);}cfiString+=")";return cfiString;}/**
			   * Compare which of two CFIs is earlier in the text
			   * @returns {number} First is earlier = -1, Second is earlier = 1, They are equal = 0
			   */},{key:"compare",value:function compare(cfiOne,cfiTwo){var stepsA,stepsB;var terminalA,terminalB;if(typeof cfiOne==="string"){cfiOne=new EpubCFI(cfiOne);}if(typeof cfiTwo==="string"){cfiTwo=new EpubCFI(cfiTwo);}// Compare Spine Positions
if(cfiOne.spinePos>cfiTwo.spinePos){return 1;}if(cfiOne.spinePos<cfiTwo.spinePos){return-1;}if(cfiOne.range){stepsA=cfiOne.path.steps.concat(cfiOne.start.steps);terminalA=cfiOne.start.terminal;}else{stepsA=cfiOne.path.steps;terminalA=cfiOne.path.terminal;}if(cfiTwo.range){stepsB=cfiTwo.path.steps.concat(cfiTwo.start.steps);terminalB=cfiTwo.start.terminal;}else{stepsB=cfiTwo.path.steps;terminalB=cfiTwo.path.terminal;}// Compare Each Step in the First item
for(var i=0;i<stepsA.length;i++){if(!stepsA[i]){return-1;}if(!stepsB[i]){return 1;}if(stepsA[i].index>stepsB[i].index){return 1;}if(stepsA[i].index<stepsB[i].index){return-1;}// Otherwise continue checking
}// All steps in First equal to Second and First is Less Specific
if(stepsA.length<stepsB.length){return-1;}// Compare the character offset of the text node
if(terminalA.offset>terminalB.offset){return 1;}if(terminalA.offset<terminalB.offset){return-1;}// CFI's are equal
return 0;}},{key:"step",value:function step(node){var nodeType=node.nodeType===TEXT_NODE?"text":"element";return{"id":node.id,"tagName":node.tagName,"type":nodeType,"index":this.position(node)};}},{key:"filteredStep",value:function filteredStep(node,ignoreClass){var filteredNode=this.filter(node,ignoreClass);var nodeType;// Node filtered, so ignore
if(!filteredNode){return;}// Otherwise add the filter node in
nodeType=filteredNode.nodeType===TEXT_NODE?"text":"element";return{"id":filteredNode.id,"tagName":filteredNode.tagName,"type":nodeType,"index":this.filteredPosition(filteredNode,ignoreClass)};}},{key:"pathTo",value:function pathTo(node,offset,ignoreClass){var segment={steps:[],terminal:{offset:null,assertion:null}};var currentNode=node;var step;while(currentNode&&currentNode.parentNode&&currentNode.parentNode.nodeType!=DOCUMENT_NODE){if(ignoreClass){step=this.filteredStep(currentNode,ignoreClass);}else{step=this.step(currentNode);}if(step){segment.steps.unshift(step);}currentNode=currentNode.parentNode;}if(offset!=null&&offset>=0){segment.terminal.offset=offset;// Make sure we are getting to a textNode if there is an offset
if(segment.steps[segment.steps.length-1].type!="text"){segment.steps.push({"type":"text","index":0});}}return segment;}},{key:"equalStep",value:function equalStep(stepA,stepB){if(!stepA||!stepB){return false;}if(stepA.index===stepB.index&&stepA.id===stepB.id&&stepA.type===stepB.type){return true;}return false;}/**
			   * Create a CFI object from a Range
			   * @param {Range} range
			   * @param {string | object} base
			   * @param {string} [ignoreClass]
			   * @returns {object} cfi
			   */},{key:"fromRange",value:function fromRange(range,base,ignoreClass){var cfi={range:false,base:{},path:{},start:null,end:null};var start=range.startContainer;var end=range.endContainer;var startOffset=range.startOffset;var endOffset=range.endOffset;var needsIgnoring=false;if(ignoreClass){// Tell pathTo if / what to ignore
needsIgnoring=start.ownerDocument.querySelector("."+ignoreClass)!=null;}if(typeof base==="string"){cfi.base=this.parseComponent(base);cfi.spinePos=cfi.base.steps[1].index;}else if(_typeof3(base)==="object"){cfi.base=base;}if(range.collapsed){if(needsIgnoring){startOffset=this.patchOffset(start,startOffset,ignoreClass);}cfi.path=this.pathTo(start,startOffset,ignoreClass);}else{cfi.range=true;if(needsIgnoring){startOffset=this.patchOffset(start,startOffset,ignoreClass);}cfi.start=this.pathTo(start,startOffset,ignoreClass);if(needsIgnoring){endOffset=this.patchOffset(end,endOffset,ignoreClass);}cfi.end=this.pathTo(end,endOffset,ignoreClass);// Create a new empty path
cfi.path={steps:[],terminal:null};// Push steps that are shared between start and end to the common path
var len=cfi.start.steps.length;var i;for(i=0;i<len;i++){if(this.equalStep(cfi.start.steps[i],cfi.end.steps[i])){if(i===len-1){// Last step is equal, check terminals
if(cfi.start.terminal===cfi.end.terminal){// CFI's are equal
cfi.path.steps.push(cfi.start.steps[i]);// Not a range
cfi.range=false;}}else{cfi.path.steps.push(cfi.start.steps[i]);}}else{break;}}cfi.start.steps=cfi.start.steps.slice(cfi.path.steps.length);cfi.end.steps=cfi.end.steps.slice(cfi.path.steps.length);// TODO: Add Sanity check to make sure that the end if greater than the start
}return cfi;}/**
			   * Create a CFI object from a Node
			   * @param {Node} anchor
			   * @param {string | object} base
			   * @param {string} [ignoreClass]
			   * @returns {object} cfi
			   */},{key:"fromNode",value:function fromNode(anchor,base,ignoreClass){var cfi={range:false,base:{},path:{},start:null,end:null};if(typeof base==="string"){cfi.base=this.parseComponent(base);cfi.spinePos=cfi.base.steps[1].index;}else if(_typeof3(base)==="object"){cfi.base=base;}cfi.path=this.pathTo(anchor,null,ignoreClass);return cfi;}},{key:"filter",value:function filter(anchor,ignoreClass){var needsIgnoring;var sibling;// to join with
var parent,previousSibling,nextSibling;var isText=false;if(anchor.nodeType===TEXT_NODE){isText=true;parent=anchor.parentNode;needsIgnoring=anchor.parentNode.classList.contains(ignoreClass);}else{isText=false;needsIgnoring=anchor.classList.contains(ignoreClass);}if(needsIgnoring&&isText){previousSibling=parent.previousSibling;nextSibling=parent.nextSibling;// If the sibling is a text node, join the nodes
if(previousSibling&&previousSibling.nodeType===TEXT_NODE){sibling=previousSibling;}else if(nextSibling&&nextSibling.nodeType===TEXT_NODE){sibling=nextSibling;}if(sibling){return sibling;}else{// Parent will be ignored on next step
return anchor;}}else if(needsIgnoring&&!isText){// Otherwise just skip the element node
return false;}else{// No need to filter
return anchor;}}},{key:"patchOffset",value:function patchOffset(anchor,offset,ignoreClass){if(anchor.nodeType!=TEXT_NODE){throw new Error("Anchor must be a text node");}var curr=anchor;var totalOffset=offset;// If the parent is a ignored node, get offset from it's start
if(anchor.parentNode.classList.contains(ignoreClass)){curr=anchor.parentNode;}while(curr.previousSibling){if(curr.previousSibling.nodeType===ELEMENT_NODE$1){// Originally a text node, so join
if(curr.previousSibling.classList.contains(ignoreClass)){totalOffset+=curr.previousSibling.textContent.length;}else{break;// Normal node, dont join
}}else{// If the previous sibling is a text node, join the nodes
totalOffset+=curr.previousSibling.textContent.length;}curr=curr.previousSibling;}return totalOffset;}},{key:"normalizedMap",value:function normalizedMap(children,nodeType,ignoreClass){var output={};var prevIndex=-1;var i,len=children.length;var currNodeType;var prevNodeType;for(i=0;i<len;i++){currNodeType=children[i].nodeType;// Check if needs ignoring
if(currNodeType===ELEMENT_NODE$1&&children[i].classList.contains(ignoreClass)){currNodeType=TEXT_NODE;}if(i>0&&currNodeType===TEXT_NODE&&prevNodeType===TEXT_NODE){// join text nodes
output[i]=prevIndex;}else if(nodeType===currNodeType){prevIndex=prevIndex+1;output[i]=prevIndex;}prevNodeType=currNodeType;}return output;}},{key:"position",value:function position(anchor){var children,index;if(anchor.nodeType===ELEMENT_NODE$1){children=anchor.parentNode.children;if(!children){children=(0,_core$n.findChildren)(anchor.parentNode);}index=Array.prototype.indexOf.call(children,anchor);}else{children=this.textNodes(anchor.parentNode);index=children.indexOf(anchor);}return index;}},{key:"filteredPosition",value:function filteredPosition(anchor,ignoreClass){var children,index,map;if(anchor.nodeType===ELEMENT_NODE$1){children=anchor.parentNode.children;map=this.normalizedMap(children,ELEMENT_NODE$1,ignoreClass);}else{children=anchor.parentNode.childNodes;// Inside an ignored node
if(anchor.parentNode.classList.contains(ignoreClass)){anchor=anchor.parentNode;children=anchor.parentNode.childNodes;}map=this.normalizedMap(children,TEXT_NODE,ignoreClass);}index=Array.prototype.indexOf.call(children,anchor);return map[index];}},{key:"stepsToXpath",value:function stepsToXpath(steps){var xpath=[".","*"];steps.forEach(function(step){var position=step.index+1;if(step.id){xpath.push("*[position()="+position+" and @id='"+step.id+"']");}else if(step.type==="text"){xpath.push("text()["+position+"]");}else{xpath.push("*["+position+"]");}});return xpath.join("/");}/*
			  	To get the last step if needed:
			  	// Get the terminal step
			  lastStep = steps[steps.length-1];
			  // Get the query string
			  query = this.stepsToQuery(steps);
			  // Find the containing element
			  startContainerParent = doc.querySelector(query);
			  // Find the text node within that element
			  if(startContainerParent && lastStep.type == "text") {
			  	container = startContainerParent.childNodes[lastStep.index];
			  }
			  */},{key:"stepsToQuerySelector",value:function stepsToQuerySelector(steps){var query=["html"];steps.forEach(function(step){var position=step.index+1;if(step.id){query.push("#"+step.id);}else if(step.type==="text");else{query.push("*:nth-child("+position+")");}});return query.join(">");}},{key:"textNodes",value:function textNodes(container,ignoreClass){return Array.prototype.slice.call(container.childNodes).filter(function(node){if(node.nodeType===TEXT_NODE){return true;}else if(ignoreClass&&node.classList.contains(ignoreClass)){return true;}return false;});}},{key:"walkToNode",value:function walkToNode(steps,_doc,ignoreClass){var doc=_doc||document;var container=doc.documentElement;var children;var step;var len=steps.length;var i;for(i=0;i<len;i++){step=steps[i];if(step.type==="element"){//better to get a container using id as some times step.index may not be correct
//For ex.https://github.com/futurepress/epub.js/issues/561
if(step.id){container=doc.getElementById(step.id);}else{children=container.children||(0,_core$n.findChildren)(container);container=children[step.index];}}else if(step.type==="text"){container=this.textNodes(container,ignoreClass)[step.index];}if(!container){//Break the for loop as due to incorrect index we can get error if
//container is undefined so that other functionailties works fine
//like navigation
break;}}return container;}},{key:"findNode",value:function findNode(steps,_doc,ignoreClass){var doc=_doc||document;var container;var xpath;if(!ignoreClass&&typeof doc.evaluate!="undefined"){xpath=this.stepsToXpath(steps);container=doc.evaluate(xpath,doc,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;}else if(ignoreClass){container=this.walkToNode(steps,doc,ignoreClass);}else{container=this.walkToNode(steps,doc);}return container;}},{key:"fixMiss",value:function fixMiss(steps,offset,_doc,ignoreClass){var container=this.findNode(steps.slice(0,-1),_doc,ignoreClass);var children=container.childNodes;var map=this.normalizedMap(children,TEXT_NODE,ignoreClass);var child;var len;var lastStepIndex=steps[steps.length-1].index;for(var childIndex in map){if(!map.hasOwnProperty(childIndex))return;if(map[childIndex]===lastStepIndex){child=children[childIndex];len=child.textContent.length;if(offset>len){offset=offset-len;}else{if(child.nodeType===ELEMENT_NODE$1){container=child.childNodes[0];}else{container=child;}break;}}}return{container:container,offset:offset};}/**
			   * Creates a DOM range representing a CFI
			   * @param {document} _doc document referenced in the base
			   * @param {string} [ignoreClass]
			   * @return {Range}
			   */},{key:"toRange",value:function toRange(_doc,ignoreClass){var doc=_doc||document;var range;var start,end,startContainer,endContainer;var cfi=this;var startSteps,endSteps;var needsIgnoring=ignoreClass?doc.querySelector("."+ignoreClass)!=null:false;var missed;if(typeof doc.createRange!=="undefined"){range=doc.createRange();}else{range=new _core$n.RangeObject();}if(cfi.range){start=cfi.start;startSteps=cfi.path.steps.concat(start.steps);startContainer=this.findNode(startSteps,doc,needsIgnoring?ignoreClass:null);end=cfi.end;endSteps=cfi.path.steps.concat(end.steps);endContainer=this.findNode(endSteps,doc,needsIgnoring?ignoreClass:null);}else{start=cfi.path;startSteps=cfi.path.steps;startContainer=this.findNode(cfi.path.steps,doc,needsIgnoring?ignoreClass:null);}if(startContainer){try{if(start.terminal.offset!=null){range.setStart(startContainer,start.terminal.offset);}else{range.setStart(startContainer,0);}}catch(e){missed=this.fixMiss(startSteps,start.terminal.offset,doc,needsIgnoring?ignoreClass:null);range.setStart(missed.container,missed.offset);}}else{console.log("No startContainer found for",this.toString());// No start found
return null;}if(endContainer){try{if(end.terminal.offset!=null){range.setEnd(endContainer,end.terminal.offset);}else{range.setEnd(endContainer,0);}}catch(e){missed=this.fixMiss(endSteps,cfi.end.terminal.offset,doc,needsIgnoring?ignoreClass:null);range.setEnd(missed.container,missed.offset);}}// doc.defaultView.getSelection().addRange(range);
return range;}/**
			   * Check if a string is wrapped with "epubcfi()"
			   * @param {string} str
			   * @returns {boolean}
			   */},{key:"isCfiString",value:function isCfiString(str){if(typeof str==="string"&&str.indexOf("epubcfi(")===0&&str[str.length-1]===")"){return true;}return false;}},{key:"generateChapterComponent",value:function generateChapterComponent(_spineNodeIndex,_pos,id){var pos=parseInt(_pos),spineNodeIndex=(_spineNodeIndex+1)*2,cfi="/"+spineNodeIndex+"/";cfi+=(pos+1)*2;if(id){cfi+="["+id+"]";}return cfi;}/**
			   * Collapse a CFI Range to a single CFI Position
			   * @param {boolean} [toStart=false]
			   */},{key:"collapse",value:function collapse(toStart){if(!this.range){return;}this.range=false;if(toStart){this.path.steps=this.path.steps.concat(this.start.steps);this.path.terminal=this.start.terminal;}else{this.path.steps=this.path.steps.concat(this.end.steps);this.path.terminal=this.end.terminal;}}}]);return EpubCFI;}();var _default$y=EpubCFI;epubcfi.default=_default$y;var hook={};Object.defineProperty(hook,"__esModule",{value:true});hook.default=void 0;/**
			 * Hooks allow for injecting functions that must all complete in order before finishing
			 * They will execute in parallel but all must finish before continuing
			 * Functions may return a promise if they are async.
			 * @param {any} context scope of this
			 * @example this.content = new EPUBJS.Hook(this);
			 */var Hook=/*#__PURE__*/function(){function Hook(context){_classCallCheck3(this,Hook);this.context=context||this;this.hooks=[];}/**
			   * Adds a function to be run before a hook completes
			   * @example this.content.register(function(){...});
			   */_createClass3(Hook,[{key:"register",value:function register(){for(var i=0;i<arguments.length;++i){if(typeof arguments[i]==="function"){this.hooks.push(arguments[i]);}else{// unpack array
for(var j=0;j<arguments[i].length;++j){this.hooks.push(arguments[i][j]);}}}}/**
			   * Removes a function
			   * @example this.content.deregister(function(){...});
			   */},{key:"deregister",value:function deregister(func){var hook;for(var i=0;i<this.hooks.length;i++){hook=this.hooks[i];if(hook===func){this.hooks.splice(i,1);break;}}}/**
			   * Triggers a hook to run all functions
			   * @example this.content.trigger(args).then(function(){...});
			   */},{key:"trigger",value:function trigger(){var args=arguments;var context=this.context;var promises=[];this.hooks.forEach(function(task){try{var executing=task.apply(context,args);}catch(err){console.log(err);}if(executing&&typeof executing["then"]==="function"){// Task is a function that returns a promise
promises.push(executing);}// Otherwise Task resolves immediately, continue
});return Promise.all(promises);}// Adds a function to be run before a hook completes
},{key:"list",value:function list(){return this.hooks;}},{key:"clear",value:function clear(){return this.hooks=[];}}]);return Hook;}();var _default$x=Hook;hook.default=_default$x;var section={};var replacements={};Object.defineProperty(replacements,"__esModule",{value:true});replacements.replaceBase=replaceBase;replacements.replaceCanonical=replaceCanonical;replacements.replaceLinks=replaceLinks;replacements.replaceMeta=replaceMeta;replacements.substitute=substitute;var _core$m=core;var _url$3=_interopRequireDefault$p(url);_interopRequireDefault$p(path$1);function _interopRequireDefault$p(obj){return obj&&obj.__esModule?obj:{default:obj};}function replaceBase(doc,section){var base;var head;var url=section.url;var absolute=url.indexOf("://")>-1;if(!doc){return;}head=(0,_core$m.qs)(doc,"head");base=(0,_core$m.qs)(head,"base");if(!base){base=doc.createElement("base");head.insertBefore(base,head.firstChild);}// Fix for Safari crashing if the url doesn't have an origin
if(!absolute&&window&&window.location){url=window.location.origin+url;}base.setAttribute("href",url);}function replaceCanonical(doc,section){var head;var link;var url=section.canonical;if(!doc){return;}head=(0,_core$m.qs)(doc,"head");link=(0,_core$m.qs)(head,"link[rel='canonical']");if(link){link.setAttribute("href",url);}else{link=doc.createElement("link");link.setAttribute("rel","canonical");link.setAttribute("href",url);head.appendChild(link);}}function replaceMeta(doc,section){var head;var meta;var id=section.idref;if(!doc){return;}head=(0,_core$m.qs)(doc,"head");meta=(0,_core$m.qs)(head,"link[property='dc.identifier']");if(meta){meta.setAttribute("content",id);}else{meta=doc.createElement("meta");meta.setAttribute("name","dc.identifier");meta.setAttribute("content",id);head.appendChild(meta);}}// TODO: move me to Contents
function replaceLinks(contents,fn){var links=contents.querySelectorAll("a[href]");if(!links.length){return;}var base=(0,_core$m.qs)(contents.ownerDocument,"base");var location=base?base.getAttribute("href"):undefined;var replaceLink=function(link){var href=link.getAttribute("href");if(href.indexOf("mailto:")===0){return;}var absolute=href.indexOf("://")>-1;if(absolute){link.setAttribute("target","_blank");}else{var linkUrl;try{linkUrl=new _url$3.default(href,location);}catch(error){// NOOP
}link.onclick=function(){if(linkUrl&&linkUrl.hash){fn(linkUrl.Path.path+linkUrl.hash);}else if(linkUrl){fn(linkUrl.Path.path);}else{fn(href);}return false;};}}.bind(this);for(var i=0;i<links.length;i++){replaceLink(links[i]);}}function substitute(content,urls,replacements){urls.forEach(function(url,i){if(url&&replacements[i]){// Account for special characters in the file name.
// See https://stackoverflow.com/a/6318729.
url=url.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");content=content.replace(new RegExp(url,"g"),replacements[i]);}});return content;}var request$1={};Object.defineProperty(request$1,"__esModule",{value:true});request$1.default=void 0;var _core$l=core;var _path$4=_interopRequireDefault$o(path$1);function _interopRequireDefault$o(obj){return obj&&obj.__esModule?obj:{default:obj};}function request(url,type,withCredentials,headers){var supportsURL=typeof window!="undefined"?window.URL:false;// TODO: fallback for url if window isn't defined
var BLOB_RESPONSE=supportsURL?"blob":"arraybuffer";var deferred=new _core$l.defer();var xhr=new XMLHttpRequest();//-- Check from PDF.js:
//   https://github.com/mozilla/pdf.js/blob/master/web/compatibility.js
var xhrPrototype=XMLHttpRequest.prototype;var header;if(!("overrideMimeType"in xhrPrototype)){// IE10 might have response, but not overrideMimeType
Object.defineProperty(xhrPrototype,"overrideMimeType",{value:function xmlHttpRequestOverrideMimeType(){}});}if(withCredentials){xhr.withCredentials=true;}xhr.onreadystatechange=handler;xhr.onerror=err;xhr.open("GET",url,true);for(header in headers){xhr.setRequestHeader(header,headers[header]);}if(type=="json"){xhr.setRequestHeader("Accept","application/json");}// If type isn"t set, determine it from the file extension
if(!type){type=new _path$4.default(url).extension;}if(type=="blob"){xhr.responseType=BLOB_RESPONSE;}if((0,_core$l.isXml)(type)){// xhr.responseType = "document";
xhr.overrideMimeType("text/xml");// for OPF parsing
}if(type=="binary"){xhr.responseType="arraybuffer";}xhr.send();function err(e){deferred.reject(e);}function handler(){if(this.readyState===XMLHttpRequest.DONE){var responseXML=false;if(this.responseType===""||this.responseType==="document"){responseXML=this.responseXML;}if(this.status===200||this.status===0||responseXML){//-- Firefox is reporting 0 for blob urls
var r;if(!this.response&&!responseXML){deferred.reject({status:this.status,message:"Empty Response",stack:new Error().stack});return deferred.promise;}if(this.status===403){deferred.reject({status:this.status,response:this.response,message:"Forbidden",stack:new Error().stack});return deferred.promise;}if(responseXML){r=this.responseXML;}else if((0,_core$l.isXml)(type)){// xhr.overrideMimeType("text/xml"); // for OPF parsing
// If this.responseXML wasn't set, try to parse using a DOMParser from text
r=(0,_core$l.parse)(this.response,"text/xml");}else if(type=="xhtml"){r=(0,_core$l.parse)(this.response,"application/xhtml+xml");}else if(type=="html"||type=="htm"){r=(0,_core$l.parse)(this.response,"text/html");}else if(type=="json"){r=JSON.parse(this.response);}else if(type=="blob"){if(supportsURL){r=this.response;}else{//-- Safari doesn't support responseType blob, so create a blob from arraybuffer
r=new Blob([this.response]);}}else{r=this.response;}deferred.resolve(r);}else{deferred.reject({status:this.status,message:this.response,stack:new Error().stack});}}}return deferred.promise;}var _default$w=request;request$1.default=_default$w;Object.defineProperty(section,"__esModule",{value:true});section.default=void 0;var _core$k=core;var _epubcfi$a=_interopRequireDefault$n(epubcfi);var _hook$2=_interopRequireDefault$n(hook);var _replacements$3=replacements;var _request2$1=_interopRequireDefault$n(request$1);var _xmldom=lib;function _interopRequireDefault$n(obj){return obj&&obj.__esModule?obj:{default:obj};}/**
			 * Represents a Section of the Book
			 *
			 * In most books this is equivalent to a Chapter
			 * @param {object} item  The spine item representing the section
			 * @param {object} hooks hooks for serialize and content
			 */var Section=/*#__PURE__*/function(){function Section(item,hooks){_classCallCheck3(this,Section);this.idref=item.idref;this.linear=item.linear==="yes";this.properties=item.properties;this.index=item.index;this.href=item.href;this.url=item.url;this.canonical=item.canonical;this.next=item.next;this.prev=item.prev;this.cfiBase=item.cfiBase;if(hooks){this.hooks=hooks;}else{this.hooks={};this.hooks.serialize=new _hook$2.default(this);this.hooks.content=new _hook$2.default(this);}this.document=undefined;this.contents=undefined;this.output=undefined;}/**
			   * Load the section from its url
			   * @param  {method} [_request] a request method to use for loading
			   * @return {document} a promise with the xml document
			   */_createClass3(Section,[{key:"load",value:function load(_request){var request=_request||this.request||_request2$1.default;var loading=new _core$k.defer();var loaded=loading.promise;if(this.contents){loading.resolve(this.contents);}else{request(this.url).then(function(xml){// var directory = new Url(this.url).directory;
this.document=xml;this.contents=xml.documentElement;return this.hooks.content.trigger(this.document,this);}.bind(this)).then(function(){loading.resolve(this.contents);}.bind(this)).catch(function(error){loading.reject(error);});}return loaded;}/**
			   * Adds a base tag for resolving urls in the section
			   * @private
			   */},{key:"base",value:function base(){return(0,_replacements$3.replaceBase)(this.document,this);}/**
			   * Render the contents of a section
			   * @param  {method} [_request] a request method to use for loading
			   * @return {string} output a serialized XML Document
			   */},{key:"render",value:function render(_request){var rendering=new _core$k.defer();var rendered=rendering.promise;this.output;// TODO: better way to return this from hooks?
this.load(_request).then(function(contents){var userAgent=typeof navigator!=='undefined'&&navigator.userAgent||'';var isIE=userAgent.indexOf('Trident')>=0;var Serializer;if(typeof XMLSerializer==="undefined"||isIE){Serializer=_xmldom.DOMParser;}else{Serializer=XMLSerializer;}var serializer=new Serializer();this.output=serializer.serializeToString(contents);return this.output;}.bind(this)).then(function(){return this.hooks.serialize.trigger(this.output,this);}.bind(this)).then(function(){rendering.resolve(this.output);}.bind(this)).catch(function(error){rendering.reject(error);});return rendered;}/**
			   * Find a string in a section
			   * @param  {string} _query The query string to find
			   * @return {object[]} A list of matches, with form {cfi, excerpt}
			   */},{key:"find",value:function find(_query){var section=this;var matches=[];var query=_query.toLowerCase();var find=function find(node){var text=node.textContent.toLowerCase();var range=section.document.createRange();var cfi;var pos;var last=-1;var excerpt;var limit=150;while(pos!=-1){// Search for the query
pos=text.indexOf(query,last+1);if(pos!=-1){// We found it! Generate a CFI
range=section.document.createRange();range.setStart(node,pos);range.setEnd(node,pos+query.length);cfi=section.cfiFromRange(range);// Generate the excerpt
if(node.textContent.length<limit){excerpt=node.textContent;}else{excerpt=node.textContent.substring(pos-limit/2,pos+limit/2);excerpt="..."+excerpt+"...";}// Add the CFI to the matches list
matches.push({cfi:cfi,excerpt:excerpt});}last=pos;}};(0,_core$k.sprint)(section.document,function(node){find(node);});return matches;}/**
			   * Search a string in multiple sequential Element of the section. If the document.createTreeWalker api is missed(eg: IE8), use `find` as a fallback.
			   * @param  {string} _query The query string to search
			   * @param  {int} maxSeqEle The maximum number of Element that are combined for search, default value is 5.
			   * @return {object[]} A list of matches, with form {cfi, excerpt}
			   */},{key:"search",value:function search(_query){var maxSeqEle=arguments.length>1&&arguments[1]!==undefined?arguments[1]:5;if(typeof document.createTreeWalker=="undefined"){return this.find(_query);}var matches=[];var excerptLimit=150;var section=this;var query=_query.toLowerCase();var search=function search(nodeList){var textWithCase=nodeList.reduce(function(acc,current){return acc+current.textContent;},"");var text=textWithCase.toLowerCase();var pos=text.indexOf(query);if(pos!=-1){var startNodeIndex=0,endPos=pos+query.length;var endNodeIndex=0,l=0;if(pos<nodeList[startNodeIndex].length){var cfi;while(endNodeIndex<nodeList.length-1){l+=nodeList[endNodeIndex].length;if(endPos<=l){break;}endNodeIndex+=1;}var startNode=nodeList[startNodeIndex],endNode=nodeList[endNodeIndex];var range=section.document.createRange();range.setStart(startNode,pos);var beforeEndLengthCount=nodeList.slice(0,endNodeIndex).reduce(function(acc,current){return acc+current.textContent.length;},0);range.setEnd(endNode,beforeEndLengthCount>endPos?endPos:endPos-beforeEndLengthCount);cfi=section.cfiFromRange(range);var excerpt=nodeList.slice(0,endNodeIndex+1).reduce(function(acc,current){return acc+current.textContent;},"");if(excerpt.length>excerptLimit){excerpt=excerpt.substring(pos-excerptLimit/2,pos+excerptLimit/2);excerpt="..."+excerpt+"...";}matches.push({cfi:cfi,excerpt:excerpt});}}};var treeWalker=document.createTreeWalker(section.document,NodeFilter.SHOW_TEXT,null,false);var node,nodeList=[];while(node=treeWalker.nextNode()){nodeList.push(node);if(nodeList.length==maxSeqEle){search(nodeList.slice(0,maxSeqEle));nodeList=nodeList.slice(1,maxSeqEle);}}if(nodeList.length>0){search(nodeList);}return matches;}/**
			  * Reconciles the current chapters layout properties with
			  * the global layout properties.
			  * @param {object} globalLayout  The global layout settings object, chapter properties string
			  * @return {object} layoutProperties Object with layout properties
			  */},{key:"reconcileLayoutSettings",value:function reconcileLayoutSettings(globalLayout){//-- Get the global defaults
var settings={layout:globalLayout.layout,spread:globalLayout.spread,orientation:globalLayout.orientation};//-- Get the chapter's display type
this.properties.forEach(function(prop){var rendition=prop.replace("rendition:","");var split=rendition.indexOf("-");var property,value;if(split!=-1){property=rendition.slice(0,split);value=rendition.slice(split+1);settings[property]=value;}});return settings;}/**
			   * Get a CFI from a Range in the Section
			   * @param  {range} _range
			   * @return {string} cfi an EpubCFI string
			   */},{key:"cfiFromRange",value:function cfiFromRange(_range){return new _epubcfi$a.default(_range,this.cfiBase).toString();}/**
			   * Get a CFI from an Element in the Section
			   * @param  {element} el
			   * @return {string} cfi an EpubCFI string
			   */},{key:"cfiFromElement",value:function cfiFromElement(el){return new _epubcfi$a.default(el,this.cfiBase).toString();}/**
			   * Unload the section document
			   */},{key:"unload",value:function unload(){this.document=undefined;this.contents=undefined;this.output=undefined;}},{key:"destroy",value:function destroy(){this.unload();this.hooks.serialize.clear();this.hooks.content.clear();this.hooks=undefined;this.idref=undefined;this.linear=undefined;this.properties=undefined;this.index=undefined;this.href=undefined;this.url=undefined;this.next=undefined;this.prev=undefined;this.cfiBase=undefined;}}]);return Section;}();var _default$v=Section;section.default=_default$v;Object.defineProperty(spine,"__esModule",{value:true});spine.default=void 0;var _epubcfi$9=_interopRequireDefault$m(epubcfi);var _hook$1=_interopRequireDefault$m(hook);var _section=_interopRequireDefault$m(section);var _replacements$2=replacements;function _interopRequireDefault$m(obj){return obj&&obj.__esModule?obj:{default:obj};}/**
			 * A collection of Spine Items
			 */var Spine=/*#__PURE__*/function(){function Spine(){_classCallCheck3(this,Spine);this.spineItems=[];this.spineByHref={};this.spineById={};this.hooks={};this.hooks.serialize=new _hook$1.default();this.hooks.content=new _hook$1.default();// Register replacements
this.hooks.content.register(_replacements$2.replaceBase);this.hooks.content.register(_replacements$2.replaceCanonical);this.hooks.content.register(_replacements$2.replaceMeta);this.epubcfi=new _epubcfi$9.default();this.loaded=false;this.items=undefined;this.manifest=undefined;this.spineNodeIndex=undefined;this.baseUrl=undefined;this.length=undefined;}/**
			   * Unpack items from a opf into spine items
			   * @param  {Packaging} _package
			   * @param  {method} resolver URL resolver
			   * @param  {method} canonical Resolve canonical url
			   */_createClass3(Spine,[{key:"unpack",value:function unpack(_package,resolver,canonical){var _this11=this;this.items=_package.spine;this.manifest=_package.manifest;this.spineNodeIndex=_package.spineNodeIndex;this.baseUrl=_package.baseUrl||_package.basePath||"";this.length=this.items.length;this.items.forEach(function(item,index){var manifestItem=_this11.manifest[item.idref];var spineItem;item.index=index;item.cfiBase=_this11.epubcfi.generateChapterComponent(_this11.spineNodeIndex,item.index,item.id);if(item.href){item.url=resolver(item.href,true);item.canonical=canonical(item.href);}if(manifestItem){item.href=manifestItem.href;item.url=resolver(item.href,true);item.canonical=canonical(item.href);if(manifestItem.properties.length){item.properties.push.apply(item.properties,manifestItem.properties);}}if(item.linear==="yes"){item.prev=function(){var prevIndex=item.index;while(prevIndex>0){var prev=this.get(prevIndex-1);if(prev&&prev.linear){return prev;}prevIndex-=1;}return;}.bind(_this11);item.next=function(){var nextIndex=item.index;while(nextIndex<this.spineItems.length-1){var next=this.get(nextIndex+1);if(next&&next.linear){return next;}nextIndex+=1;}return;}.bind(_this11);}else{item.prev=function(){return;};item.next=function(){return;};}spineItem=new _section.default(item,_this11.hooks);_this11.append(spineItem);});this.loaded=true;}/**
			   * Get an item from the spine
			   * @param  {string|number} [target]
			   * @return {Section} section
			   * @example spine.get();
			   * @example spine.get(1);
			   * @example spine.get("chap1.html");
			   * @example spine.get("#id1234");
			   */},{key:"get",value:function get(target){var index=0;if(typeof target==="undefined"){while(index<this.spineItems.length){var next=this.spineItems[index];if(next&&next.linear){break;}index+=1;}}else if(this.epubcfi.isCfiString(target)){var cfi=new _epubcfi$9.default(target);index=cfi.spinePos;}else if(typeof target==="number"||isNaN(target)===false){index=target;}else if(typeof target==="string"&&target.indexOf("#")===0){index=this.spineById[target.substring(1)];}else if(typeof target==="string"){// Remove fragments
target=target.split("#")[0];index=this.spineByHref[target]||this.spineByHref[encodeURI(target)];}return this.spineItems[index]||null;}/**
			   * Append a Section to the Spine
			   * @private
			   * @param  {Section} section
			   */},{key:"append",value:function append(section){var index=this.spineItems.length;section.index=index;this.spineItems.push(section);// Encode and Decode href lookups
// see pr for details: https://github.com/futurepress/epub.js/pull/358
this.spineByHref[decodeURI(section.href)]=index;this.spineByHref[encodeURI(section.href)]=index;this.spineByHref[section.href]=index;this.spineById[section.idref]=index;return index;}/**
			   * Prepend a Section to the Spine
			   * @private
			   * @param  {Section} section
			   */},{key:"prepend",value:function prepend(section){// var index = this.spineItems.unshift(section);
this.spineByHref[section.href]=0;this.spineById[section.idref]=0;// Re-index
this.spineItems.forEach(function(item,index){item.index=index;});return 0;}// insert(section, index) {
//
// };
/**
			   * Remove a Section from the Spine
			   * @private
			   * @param  {Section} section
			   */},{key:"remove",value:function remove(section){var index=this.spineItems.indexOf(section);if(index>-1){delete this.spineByHref[section.href];delete this.spineById[section.idref];return this.spineItems.splice(index,1);}}/**
			   * Loop over the Sections in the Spine
			   * @return {method} forEach
			   */},{key:"each",value:function each(){return this.spineItems.forEach.apply(this.spineItems,arguments);}/**
			   * Find the first Section in the Spine
			   * @return {Section} first section
			   */},{key:"first",value:function first(){var index=0;do{var next=this.get(index);if(next&&next.linear){return next;}index+=1;}while(index<this.spineItems.length);}/**
			   * Find the last Section in the Spine
			   * @return {Section} last section
			   */},{key:"last",value:function last(){var index=this.spineItems.length-1;do{var prev=this.get(index);if(prev&&prev.linear){return prev;}index-=1;}while(index>=0);}},{key:"destroy",value:function destroy(){this.each(function(section){return section.destroy();});this.spineItems=undefined;this.spineByHref=undefined;this.spineById=undefined;this.hooks.serialize.clear();this.hooks.content.clear();this.hooks=undefined;this.epubcfi=undefined;this.loaded=false;this.items=undefined;this.manifest=undefined;this.spineNodeIndex=undefined;this.baseUrl=undefined;this.length=undefined;}}]);return Spine;}();var _default$u=Spine;spine.default=_default$u;var locations={};var queue={};Object.defineProperty(queue,"__esModule",{value:true});queue.default=queue.Task=void 0;var _core$j=core;/**
			 * Queue for handling tasks one at a time
			 * @class
			 * @param {scope} context what this will resolve to in the tasks
			 */var Queue=/*#__PURE__*/function(){function Queue(context){_classCallCheck3(this,Queue);this._q=[];this.context=context;this.tick=_core$j.requestAnimationFrame;this.running=false;this.paused=false;}/**
			   * Add an item to the queue
			   * @return {Promise}
			   */_createClass3(Queue,[{key:"enqueue",value:function enqueue(){var deferred,promise;var queued;var task=[].shift.call(arguments);var args=arguments;// Handle single args without context
// if(args && !Array.isArray(args)) {
//   args = [args];
// }
if(!task){throw new Error("No Task Provided");}if(typeof task==="function"){deferred=new _core$j.defer();promise=deferred.promise;queued={"task":task,"args":args,//"context"  : context,
"deferred":deferred,"promise":promise};}else{// Task is a promise
queued={"promise":task};}this._q.push(queued);// Wait to start queue flush
if(this.paused==false&&!this.running){// setTimeout(this.flush.bind(this), 0);
// this.tick.call(window, this.run.bind(this));
this.run();}return queued.promise;}/**
			   * Run one item
			   * @return {Promise}
			   */},{key:"dequeue",value:function dequeue(){var inwait,task,result;if(this._q.length&&!this.paused){inwait=this._q.shift();task=inwait.task;if(task){// console.log(task)
result=task.apply(this.context,inwait.args);if(result&&typeof result["then"]==="function"){// Task is a function that returns a promise
return result.then(function(){inwait.deferred.resolve.apply(this.context,arguments);}.bind(this),function(){inwait.deferred.reject.apply(this.context,arguments);}.bind(this));}else{// Task resolves immediately
inwait.deferred.resolve.apply(this.context,result);return inwait.promise;}}else if(inwait.promise){// Task is a promise
return inwait.promise;}}else{inwait=new _core$j.defer();inwait.deferred.resolve();return inwait.promise;}}// Run All Immediately
},{key:"dump",value:function dump(){while(this._q.length){this.dequeue();}}/**
			   * Run all tasks sequentially, at convince
			   * @return {Promise}
			   */},{key:"run",value:function run(){var _this12=this;if(!this.running){this.running=true;this.defered=new _core$j.defer();}this.tick.call(window,function(){if(_this12._q.length){_this12.dequeue().then(function(){this.run();}.bind(_this12));}else{_this12.defered.resolve();_this12.running=undefined;}});// Unpause
if(this.paused==true){this.paused=false;}return this.defered.promise;}/**
			   * Flush all, as quickly as possible
			   * @return {Promise}
			   */},{key:"flush",value:function flush(){if(this.running){return this.running;}if(this._q.length){this.running=this.dequeue().then(function(){this.running=undefined;return this.flush();}.bind(this));return this.running;}}/**
			   * Clear all items in wait
			   */},{key:"clear",value:function clear(){this._q=[];}/**
			   * Get the number of tasks in the queue
			   * @return {number} tasks
			   */},{key:"length",value:function length(){return this._q.length;}/**
			   * Pause a running queue
			   */},{key:"pause",value:function pause(){this.paused=true;}/**
			   * End the queue
			   */},{key:"stop",value:function stop(){this._q=[];this.running=false;this.paused=true;}}]);return Queue;}();/**
			 * Create a new task from a callback
			 * @class
			 * @private
			 * @param {function} task
			 * @param {array} args
			 * @param {scope} context
			 * @return {function} task
			 */var Task=/*#__PURE__*/_createClass3(function Task(task,args,context){_classCallCheck3(this,Task);return function(){var _this13=this;var toApply=arguments||[];return new Promise(function(resolve,reject){var callback=function callback(value,err){if(!value&&err){reject(err);}else{resolve(value);}};// Add the callback to the arguments list
toApply.push(callback);// Apply all arguments to the functions
task.apply(context||_this13,toApply);});};});queue.Task=Task;var _default$t=Queue;queue.default=_default$t;var constants={};Object.defineProperty(constants,"__esModule",{value:true});constants.EVENTS=constants.EPUBJS_VERSION=constants.DOM_EVENTS=void 0;var EPUBJS_VERSION="0.3";// Dom events to listen for
constants.EPUBJS_VERSION=EPUBJS_VERSION;var DOM_EVENTS=["keydown","keyup","keypressed","mouseup","mousedown","mousemove","click","touchend","touchstart","touchmove"];constants.DOM_EVENTS=DOM_EVENTS;var EVENTS={BOOK:{OPEN_FAILED:"openFailed"},CONTENTS:{EXPAND:"expand",RESIZE:"resize",SELECTED:"selected",SELECTED_RANGE:"selectedRange",LINK_CLICKED:"linkClicked"},LOCATIONS:{CHANGED:"changed"},MANAGERS:{RESIZE:"resize",RESIZED:"resized",ORIENTATION_CHANGE:"orientationchange",ADDED:"added",SCROLL:"scroll",SCROLLED:"scrolled",REMOVED:"removed"},VIEWS:{AXIS:"axis",WRITING_MODE:"writingMode",LOAD_ERROR:"loaderror",RENDERED:"rendered",RESIZED:"resized",DISPLAYED:"displayed",SHOWN:"shown",HIDDEN:"hidden",MARK_CLICKED:"markClicked"},RENDITION:{STARTED:"started",ATTACHED:"attached",DISPLAYED:"displayed",DISPLAY_ERROR:"displayerror",RENDERED:"rendered",REMOVED:"removed",RESIZED:"resized",ORIENTATION_CHANGE:"orientationchange",LOCATION_CHANGED:"locationChanged",RELOCATED:"relocated",MARK_CLICKED:"markClicked",SELECTED:"selected",LAYOUT:"layout"},LAYOUT:{UPDATED:"updated"},ANNOTATION:{ATTACH:"attach",DETACH:"detach"}};constants.EVENTS=EVENTS;Object.defineProperty(locations,"__esModule",{value:true});locations.default=void 0;var _core$i=core;var _queue$2=_interopRequireDefault$l(queue);var _epubcfi$8=_interopRequireDefault$l(epubcfi);var _constants$a=constants;var _eventEmitter$9=_interopRequireDefault$l(eventEmitter.exports);function _interopRequireDefault$l(obj){return obj&&obj.__esModule?obj:{default:obj};}/**
			 * Find Locations for a Book
			 * @param {Spine} spine
			 * @param {request} request
			 * @param {number} [pause=100]
			 */var Locations=/*#__PURE__*/function(){function Locations(spine,request,pause){_classCallCheck3(this,Locations);this.spine=spine;this.request=request;this.pause=pause||100;this.q=new _queue$2.default(this);this.epubcfi=new _epubcfi$8.default();this._locations=[];this._locationsWords=[];this.total=0;this.break=150;this._current=0;this._wordCounter=0;this.currentLocation='';this._currentCfi='';this.processingTimeout=undefined;}/**
			   * Load all of sections in the book to generate locations
			   * @param  {int} chars how many chars to split on
			   * @return {Promise<Array<string>>} locations
			   */_createClass3(Locations,[{key:"generate",value:function generate(chars){if(chars){this.break=chars;}this.q.pause();this.spine.each(function(section){if(section.linear){this.q.enqueue(this.process.bind(this),section);}}.bind(this));return this.q.run().then(function(){this.total=this._locations.length-1;if(this._currentCfi){this.currentLocation=this._currentCfi;}return this._locations;// console.log(this.percentage(this.book.rendition.location.start), this.percentage(this.book.rendition.location.end));
}.bind(this));}},{key:"createRange",value:function createRange(){return{startContainer:undefined,startOffset:undefined,endContainer:undefined,endOffset:undefined};}},{key:"process",value:function process(section){return section.load(this.request).then(function(contents){var completed=new _core$i.defer();var locations=this.parse(contents,section.cfiBase);this._locations=this._locations.concat(locations);section.unload();this.processingTimeout=setTimeout(function(){return completed.resolve(locations);},this.pause);return completed.promise;}.bind(this));}},{key:"parse",value:function parse(contents,cfiBase,chars){var locations=[];var range;var doc=contents.ownerDocument;var body=(0,_core$i.qs)(doc,"body");var counter=0;var prev;var _break=chars||this.break;var parser=function parser(node){var len=node.length;var dist;var pos=0;if(node.textContent.trim().length===0){return false;// continue
}// Start range
if(counter==0){range=this.createRange();range.startContainer=node;range.startOffset=0;}dist=_break-counter;// Node is smaller than a break,
// skip over it
if(dist>len){counter+=len;pos=len;}while(pos<len){dist=_break-counter;if(counter===0){// Start new range
pos+=1;range=this.createRange();range.startContainer=node;range.startOffset=pos;}// pos += dist;
// Gone over
if(pos+dist>=len){// Continue counter for next node
counter+=len-pos;// break
pos=len;// At End
}else{// Advance pos
pos+=dist;// End the previous range
range.endContainer=node;range.endOffset=pos;// cfi = section.cfiFromRange(range);
var cfi=new _epubcfi$8.default(range,cfiBase).toString();locations.push(cfi);counter=0;}}prev=node;};(0,_core$i.sprint)(body,parser.bind(this));// Close remaining
if(range&&range.startContainer&&prev){range.endContainer=prev;range.endOffset=prev.length;var cfi=new _epubcfi$8.default(range,cfiBase).toString();locations.push(cfi);counter=0;}return locations;}/**
			   * Load all of sections in the book to generate locations
			   * @param  {string} startCfi start position
			   * @param  {int} wordCount how many words to split on
			   * @param  {int} count result count
			   * @return {object} locations
			   */},{key:"generateFromWords",value:function generateFromWords(startCfi,wordCount,count){var start=startCfi?new _epubcfi$8.default(startCfi):undefined;this.q.pause();this._locationsWords=[];this._wordCounter=0;this.spine.each(function(section){if(section.linear){if(start){if(section.index>=start.spinePos){this.q.enqueue(this.processWords.bind(this),section,wordCount,start,count);}}else{this.q.enqueue(this.processWords.bind(this),section,wordCount,start,count);}}}.bind(this));return this.q.run().then(function(){if(this._currentCfi){this.currentLocation=this._currentCfi;}return this._locationsWords;}.bind(this));}},{key:"processWords",value:function processWords(section,wordCount,startCfi,count){if(count&&this._locationsWords.length>=count){return Promise.resolve();}return section.load(this.request).then(function(contents){var completed=new _core$i.defer();var locations=this.parseWords(contents,section,wordCount,startCfi);var remainingCount=count-this._locationsWords.length;this._locationsWords=this._locationsWords.concat(locations.length>=count?locations.slice(0,remainingCount):locations);section.unload();this.processingTimeout=setTimeout(function(){return completed.resolve(locations);},this.pause);return completed.promise;}.bind(this));}//http://stackoverflow.com/questions/18679576/counting-words-in-string
},{key:"countWords",value:function countWords(s){s=s.replace(/(^\s*)|(\s*$)/gi,"");//exclude  start and end white-space
s=s.replace(/[ ]{2,}/gi," ");//2 or more space to 1
s=s.replace(/\n /,"\n");// exclude newline with a start spacing
return s.split(" ").length;}},{key:"parseWords",value:function parseWords(contents,section,wordCount,startCfi){var cfiBase=section.cfiBase;var locations=[];var doc=contents.ownerDocument;var body=(0,_core$i.qs)(doc,"body");var _break=wordCount;var foundStartNode=startCfi?startCfi.spinePos!==section.index:true;var startNode;if(startCfi&&section.index===startCfi.spinePos){startNode=startCfi.findNode(startCfi.range?startCfi.path.steps.concat(startCfi.start.steps):startCfi.path.steps,contents.ownerDocument);}var parser=function parser(node){if(!foundStartNode){if(node===startNode){foundStartNode=true;}else{return false;}}if(node.textContent.length<10){if(node.textContent.trim().length===0){return false;}}var len=this.countWords(node.textContent);var dist;var pos=0;if(len===0){return false;// continue
}dist=_break-this._wordCounter;// Node is smaller than a break,
// skip over it
if(dist>len){this._wordCounter+=len;pos=len;}while(pos<len){dist=_break-this._wordCounter;// Gone over
if(pos+dist>=len){// Continue counter for next node
this._wordCounter+=len-pos;// break
pos=len;// At End
}else{// Advance pos
pos+=dist;var cfi=new _epubcfi$8.default(node,cfiBase);locations.push({cfi:cfi.toString(),wordCount:this._wordCounter});this._wordCounter=0;}}};(0,_core$i.sprint)(body,parser.bind(this));return locations;}/**
			   * Get a location from an EpubCFI
			   * @param {EpubCFI} cfi
			   * @return {number}
			   */},{key:"locationFromCfi",value:function locationFromCfi(cfi){var loc;if(_epubcfi$8.default.prototype.isCfiString(cfi)){cfi=new _epubcfi$8.default(cfi);}// Check if the location has not been set yet
if(this._locations.length===0){return-1;}loc=(0,_core$i.locationOf)(cfi,this._locations,this.epubcfi.compare);if(loc>this.total){return this.total;}return loc;}/**
			   * Get a percentage position in locations from an EpubCFI
			   * @param {EpubCFI} cfi
			   * @return {number}
			   */},{key:"percentageFromCfi",value:function percentageFromCfi(cfi){if(this._locations.length===0){return null;}// Find closest cfi
var loc=this.locationFromCfi(cfi);// Get percentage in total
return this.percentageFromLocation(loc);}/**
			   * Get a percentage position from a location index
			   * @param {number} location
			   * @return {number}
			   */},{key:"percentageFromLocation",value:function percentageFromLocation(loc){if(!loc||!this.total){return 0;}return loc/this.total;}/**
			   * Get an EpubCFI from location index
			   * @param {number} loc
			   * @return {EpubCFI} cfi
			   */},{key:"cfiFromLocation",value:function cfiFromLocation(loc){var cfi=-1;// check that pg is an int
if(typeof loc!="number"){loc=parseInt(loc);}if(loc>=0&&loc<this._locations.length){cfi=this._locations[loc];}return cfi;}/**
			   * Get an EpubCFI from location percentage
			   * @param {number} percentage
			   * @return {EpubCFI} cfi
			   */},{key:"cfiFromPercentage",value:function cfiFromPercentage(percentage){var loc;if(percentage>1){console.warn("Normalize cfiFromPercentage value to between 0 - 1");}// Make sure 1 goes to very end
if(percentage>=1){var cfi=new _epubcfi$8.default(this._locations[this.total]);cfi.collapse();return cfi.toString();}loc=Math.ceil(this.total*percentage);return this.cfiFromLocation(loc);}/**
			   * Load locations from JSON
			   * @param {json} locations
			   */},{key:"load",value:function load(locations){if(typeof locations==="string"){this._locations=JSON.parse(locations);}else{this._locations=locations;}this.total=this._locations.length-1;return this._locations;}/**
			   * Save locations to JSON
			   * @return {json}
			   */},{key:"save",value:function save(){return JSON.stringify(this._locations);}},{key:"getCurrent",value:function getCurrent(){return this._current;}},{key:"setCurrent",value:function setCurrent(curr){var loc;if(typeof curr=="string"){this._currentCfi=curr;}else if(typeof curr=="number"){this._current=curr;}else{return;}if(this._locations.length===0){return;}if(typeof curr=="string"){loc=this.locationFromCfi(curr);this._current=loc;}else{loc=curr;}this.emit(_constants$a.EVENTS.LOCATIONS.CHANGED,{percentage:this.percentageFromLocation(loc)});}/**
			   * Get the current location
			   */},{key:"currentLocation",get:function get(){return this._current;}/**
			   * Set the current location
			   */,set:function set(curr){this.setCurrent(curr);}/**
			   * Locations length
			   */},{key:"length",value:function length(){return this._locations.length;}},{key:"destroy",value:function destroy(){this.spine=undefined;this.request=undefined;this.pause=undefined;this.q.stop();this.q=undefined;this.epubcfi=undefined;this._locations=undefined;this.total=undefined;this.break=undefined;this._current=undefined;this.currentLocation=undefined;this._currentCfi=undefined;clearTimeout(this.processingTimeout);}}]);return Locations;}();(0,_eventEmitter$9.default)(Locations.prototype);var _default$s=Locations;locations.default=_default$s;var container={};Object.defineProperty(container,"__esModule",{value:true});container.default=void 0;var _pathWebpack$1=_interopRequireDefault$k(path);var _core$h=core;function _interopRequireDefault$k(obj){return obj&&obj.__esModule?obj:{default:obj};}/**
			 * Handles Parsing and Accessing an Epub Container
			 * @class
			 * @param {document} [containerDocument] xml document
			 */var Container=/*#__PURE__*/function(){function Container(containerDocument){_classCallCheck3(this,Container);this.packagePath='';this.directory='';this.encoding='';if(containerDocument){this.parse(containerDocument);}}/**
			   * Parse the Container XML
			   * @param  {document} containerDocument
			   */_createClass3(Container,[{key:"parse",value:function parse(containerDocument){//-- <rootfile full-path="OPS/package.opf" media-type="application/oebps-package+xml"/>
var rootfile;if(!containerDocument){throw new Error("Container File Not Found");}rootfile=(0,_core$h.qs)(containerDocument,"rootfile");if(!rootfile){throw new Error("No RootFile Found");}this.packagePath=rootfile.getAttribute("full-path");this.directory=_pathWebpack$1.default.dirname(this.packagePath);this.encoding=containerDocument.xmlEncoding;}},{key:"destroy",value:function destroy(){this.packagePath=undefined;this.directory=undefined;this.encoding=undefined;}}]);return Container;}();var _default$r=Container;container.default=_default$r;var packaging={};Object.defineProperty(packaging,"__esModule",{value:true});packaging.default=void 0;var _core$g=core;/**
			 * Open Packaging Format Parser
			 * @class
			 * @param {document} packageDocument OPF XML
			 */var Packaging=/*#__PURE__*/function(){function Packaging(packageDocument){_classCallCheck3(this,Packaging);this.manifest={};this.navPath='';this.ncxPath='';this.coverPath='';this.spineNodeIndex=0;this.spine=[];this.metadata={};if(packageDocument){this.parse(packageDocument);}}/**
			   * Parse OPF XML
			   * @param  {document} packageDocument OPF XML
			   * @return {object} parsed package parts
			   */_createClass3(Packaging,[{key:"parse",value:function parse(packageDocument){var metadataNode,manifestNode,spineNode;if(!packageDocument){throw new Error("Package File Not Found");}metadataNode=(0,_core$g.qs)(packageDocument,"metadata");if(!metadataNode){throw new Error("No Metadata Found");}manifestNode=(0,_core$g.qs)(packageDocument,"manifest");if(!manifestNode){throw new Error("No Manifest Found");}spineNode=(0,_core$g.qs)(packageDocument,"spine");if(!spineNode){throw new Error("No Spine Found");}this.manifest=this.parseManifest(manifestNode);this.navPath=this.findNavPath(manifestNode);this.ncxPath=this.findNcxPath(manifestNode,spineNode);this.coverPath=this.findCoverPath(packageDocument);this.spineNodeIndex=(0,_core$g.indexOfElementNode)(spineNode);this.spine=this.parseSpine(spineNode,this.manifest);this.uniqueIdentifier=this.findUniqueIdentifier(packageDocument);this.metadata=this.parseMetadata(metadataNode);this.metadata.direction=spineNode.getAttribute("page-progression-direction");return{"metadata":this.metadata,"spine":this.spine,"manifest":this.manifest,"navPath":this.navPath,"ncxPath":this.ncxPath,"coverPath":this.coverPath,"spineNodeIndex":this.spineNodeIndex};}/**
			   * Parse Metadata
			   * @private
			   * @param  {node} xml
			   * @return {object} metadata
			   */},{key:"parseMetadata",value:function parseMetadata(xml){var metadata={};metadata.title=this.getElementText(xml,"title");metadata.creator=this.getElementText(xml,"creator");metadata.description=this.getElementText(xml,"description");metadata.pubdate=this.getElementText(xml,"date");metadata.publisher=this.getElementText(xml,"publisher");metadata.identifier=this.getElementText(xml,"identifier");metadata.language=this.getElementText(xml,"language");metadata.rights=this.getElementText(xml,"rights");metadata.modified_date=this.getPropertyText(xml,"dcterms:modified");metadata.layout=this.getPropertyText(xml,"rendition:layout");metadata.orientation=this.getPropertyText(xml,"rendition:orientation");metadata.flow=this.getPropertyText(xml,"rendition:flow");metadata.viewport=this.getPropertyText(xml,"rendition:viewport");metadata.media_active_class=this.getPropertyText(xml,"media:active-class");metadata.spread=this.getPropertyText(xml,"rendition:spread");// metadata.page_prog_dir = packageXml.querySelector("spine").getAttribute("page-progression-direction");
return metadata;}/**
			   * Parse Manifest
			   * @private
			   * @param  {node} manifestXml
			   * @return {object} manifest
			   */},{key:"parseManifest",value:function parseManifest(manifestXml){var manifest={};//-- Turn items into an array
// var selected = manifestXml.querySelectorAll("item");
var selected=(0,_core$g.qsa)(manifestXml,"item");var items=Array.prototype.slice.call(selected);//-- Create an object with the id as key
items.forEach(function(item){var id=item.getAttribute("id"),href=item.getAttribute("href")||"",type=item.getAttribute("media-type")||"",overlay=item.getAttribute("media-overlay")||"",properties=item.getAttribute("properties")||"";manifest[id]={"href":href,// "url" : href,
"type":type,"overlay":overlay,"properties":properties.length?properties.split(" "):[]};});return manifest;}/**
			   * Parse Spine
			   * @private
			   * @param  {node} spineXml
			   * @param  {Packaging.manifest} manifest
			   * @return {object} spine
			   */},{key:"parseSpine",value:function parseSpine(spineXml,manifest){var spine=[];var selected=(0,_core$g.qsa)(spineXml,"itemref");var items=Array.prototype.slice.call(selected);// var epubcfi = new EpubCFI();
//-- Add to array to maintain ordering and cross reference with manifest
items.forEach(function(item,index){var idref=item.getAttribute("idref");// var cfiBase = epubcfi.generateChapterComponent(spineNodeIndex, index, Id);
var props=item.getAttribute("properties")||"";var propArray=props.length?props.split(" "):[];// var manifestProps = manifest[Id].properties;
// var manifestPropArray = manifestProps.length ? manifestProps.split(" ") : [];
var itemref={"id":item.getAttribute("id"),"idref":idref,"linear":item.getAttribute("linear")||"yes","properties":propArray,// "href" : manifest[Id].href,
// "url" :  manifest[Id].url,
"index":index// "cfiBase" : cfiBase
};spine.push(itemref);});return spine;}/**
			   * Find Unique Identifier
			   * @private
			   * @param  {node} packageXml
			   * @return {string} Unique Identifier text
			   */},{key:"findUniqueIdentifier",value:function findUniqueIdentifier(packageXml){var uniqueIdentifierId=packageXml.documentElement.getAttribute("unique-identifier");if(!uniqueIdentifierId){return"";}var identifier=packageXml.getElementById(uniqueIdentifierId);if(!identifier){return"";}if(identifier.localName==="identifier"&&identifier.namespaceURI==="http://purl.org/dc/elements/1.1/"){return identifier.childNodes.length>0?identifier.childNodes[0].nodeValue.trim():"";}return"";}/**
			   * Find TOC NAV
			   * @private
			   * @param {element} manifestNode
			   * @return {string}
			   */},{key:"findNavPath",value:function findNavPath(manifestNode){// Find item with property "nav"
// Should catch nav regardless of order
// var node = manifestNode.querySelector("item[properties$='nav'], item[properties^='nav '], item[properties*=' nav ']");
var node=(0,_core$g.qsp)(manifestNode,"item",{"properties":"nav"});return node?node.getAttribute("href"):false;}/**
			   * Find TOC NCX
			   * media-type="application/x-dtbncx+xml" href="toc.ncx"
			   * @private
			   * @param {element} manifestNode
			   * @param {element} spineNode
			   * @return {string}
			   */},{key:"findNcxPath",value:function findNcxPath(manifestNode,spineNode){// var node = manifestNode.querySelector("item[media-type='application/x-dtbncx+xml']");
var node=(0,_core$g.qsp)(manifestNode,"item",{"media-type":"application/x-dtbncx+xml"});var tocId;// If we can't find the toc by media-type then try to look for id of the item in the spine attributes as
// according to http://www.idpf.org/epub/20/spec/OPF_2.0.1_draft.htm#Section2.4.1.2,
// "The item that describes the NCX must be referenced by the spine toc attribute."
if(!node){tocId=spineNode.getAttribute("toc");if(tocId){// node = manifestNode.querySelector("item[id='" + tocId + "']");
node=manifestNode.querySelector("#".concat(tocId));}}return node?node.getAttribute("href"):false;}/**
			   * Find the Cover Path
			   * <item properties="cover-image" id="ci" href="cover.svg" media-type="image/svg+xml" />
			   * Fallback for Epub 2.0
			   * @private
			   * @param  {node} packageXml
			   * @return {string} href
			   */},{key:"findCoverPath",value:function findCoverPath(packageXml){var pkg=(0,_core$g.qs)(packageXml,"package");pkg.getAttribute("version");// Try parsing cover with epub 3.
// var node = packageXml.querySelector("item[properties='cover-image']");
var node=(0,_core$g.qsp)(packageXml,"item",{"properties":"cover-image"});if(node)return node.getAttribute("href");// Fallback to epub 2.
var metaCover=(0,_core$g.qsp)(packageXml,"meta",{"name":"cover"});if(metaCover){var coverId=metaCover.getAttribute("content");// var cover = packageXml.querySelector("item[id='" + coverId + "']");
var cover=packageXml.getElementById(coverId);return cover?cover.getAttribute("href"):"";}else{return false;}}/**
			   * Get text of a namespaced element
			   * @private
			   * @param  {node} xml
			   * @param  {string} tag
			   * @return {string} text
			   */},{key:"getElementText",value:function getElementText(xml,tag){var found=xml.getElementsByTagNameNS("http://purl.org/dc/elements/1.1/",tag);var el;if(!found||found.length===0)return"";el=found[0];if(el.childNodes.length){return el.childNodes[0].nodeValue;}return"";}/**
			   * Get text by property
			   * @private
			   * @param  {node} xml
			   * @param  {string} property
			   * @return {string} text
			   */},{key:"getPropertyText",value:function getPropertyText(xml,property){var el=(0,_core$g.qsp)(xml,"meta",{"property":property});if(el&&el.childNodes.length){return el.childNodes[0].nodeValue;}return"";}/**
			   * Load JSON Manifest
			   * @param  {document} packageDocument OPF XML
			   * @return {object} parsed package parts
			   */},{key:"load",value:function load(json){var _this14=this;this.metadata=json.metadata;var spine=json.readingOrder||json.spine;this.spine=spine.map(function(item,index){item.index=index;item.linear=item.linear||"yes";return item;});json.resources.forEach(function(item,index){_this14.manifest[index]=item;if(item.rel&&item.rel[0]==="cover"){_this14.coverPath=item.href;}});this.spineNodeIndex=0;this.toc=json.toc.map(function(item,index){item.label=item.title;return item;});return{"metadata":this.metadata,"spine":this.spine,"manifest":this.manifest,"navPath":this.navPath,"ncxPath":this.ncxPath,"coverPath":this.coverPath,"spineNodeIndex":this.spineNodeIndex,"toc":this.toc};}},{key:"destroy",value:function destroy(){this.manifest=undefined;this.navPath=undefined;this.ncxPath=undefined;this.coverPath=undefined;this.spineNodeIndex=undefined;this.spine=undefined;this.metadata=undefined;}}]);return Packaging;}();var _default$q=Packaging;packaging.default=_default$q;var navigation={};Object.defineProperty(navigation,"__esModule",{value:true});navigation.default=void 0;var _core$f=core;/**
			 * Navigation Parser
			 * @param {document} xml navigation html / xhtml / ncx
			 */var Navigation=/*#__PURE__*/function(){function Navigation(xml){_classCallCheck3(this,Navigation);this.toc=[];this.tocByHref={};this.tocById={};this.landmarks=[];this.landmarksByType={};this.length=0;if(xml){this.parse(xml);}}/**
			   * Parse out the navigation items
			   * @param {document} xml navigation html / xhtml / ncx
			   */_createClass3(Navigation,[{key:"parse",value:function parse(xml){var isXml=xml.nodeType;var html;var ncx;if(isXml){html=(0,_core$f.qs)(xml,"html");ncx=(0,_core$f.qs)(xml,"ncx");}if(!isXml){this.toc=this.load(xml);}else if(html){this.toc=this.parseNav(xml);this.landmarks=this.parseLandmarks(xml);}else if(ncx){this.toc=this.parseNcx(xml);}this.length=0;this.unpack(this.toc);}/**
			   * Unpack navigation items
			   * @private
			   * @param  {array} toc
			   */},{key:"unpack",value:function unpack(toc){var item;for(var i=0;i<toc.length;i++){item=toc[i];if(item.href){this.tocByHref[item.href]=i;}if(item.id){this.tocById[item.id]=i;}this.length++;if(item.subitems.length){this.unpack(item.subitems);}}}/**
			   * Get an item from the navigation
			   * @param  {string} target
			   * @return {object} navItem
			   */},{key:"get",value:function get(target){var index;if(!target){return this.toc;}if(target.indexOf("#")===0){index=this.tocById[target.substring(1)];}else if(target in this.tocByHref){index=this.tocByHref[target];}return this.getByIndex(target,index,this.toc);}/**
			   * Get an item from navigation subitems recursively by index
			   * @param  {string} target
			   * @param  {number} index
			   * @param  {array} navItems
			   * @return {object} navItem
			   */},{key:"getByIndex",value:function getByIndex(target,index,navItems){if(navItems.length===0){return;}var item=navItems[index];if(item&&(target===item.id||target===item.href)){return item;}else{var result;for(var i=0;i<navItems.length;++i){result=this.getByIndex(target,index,navItems[i].subitems);if(result){break;}}return result;}}/**
			   * Get a landmark by type
			   * List of types: https://idpf.github.io/epub-vocabs/structure/
			   * @param  {string} type
			   * @return {object} landmarkItem
			   */},{key:"landmark",value:function landmark(type){var index;if(!type){return this.landmarks;}index=this.landmarksByType[type];return this.landmarks[index];}/**
			   * Parse toc from a Epub > 3.0 Nav
			   * @private
			   * @param  {document} navHtml
			   * @return {array} navigation list
			   */},{key:"parseNav",value:function parseNav(navHtml){var navElement=(0,_core$f.querySelectorByType)(navHtml,"nav","toc");var list=[];if(!navElement)return list;var navList=(0,_core$f.filterChildren)(navElement,"ol",true);if(!navList)return list;list=this.parseNavList(navList);return list;}/**
			   * Parses lists in the toc
			   * @param  {document} navListHtml
			   * @param  {string} parent id
			   * @return {array} navigation list
			   */},{key:"parseNavList",value:function parseNavList(navListHtml,parent){var result=[];if(!navListHtml)return result;if(!navListHtml.children)return result;for(var i=0;i<navListHtml.children.length;i++){var item=this.navItem(navListHtml.children[i],parent);if(item){result.push(item);}}return result;}/**
			   * Create a navItem
			   * @private
			   * @param  {element} item
			   * @return {object} navItem
			   */},{key:"navItem",value:function navItem(item,parent){var id=item.getAttribute("id")||undefined;var content=(0,_core$f.filterChildren)(item,"a",true)||(0,_core$f.filterChildren)(item,"span",true);if(!content){return;}var src=content.getAttribute("href")||"";if(!id){id=src;}var text=content.textContent||"";var subitems=[];var nested=(0,_core$f.filterChildren)(item,"ol",true);if(nested){subitems=this.parseNavList(nested,id);}return{"id":id,"href":src,"label":text,"subitems":subitems,"parent":parent};}/**
			   * Parse landmarks from a Epub > 3.0 Nav
			   * @private
			   * @param  {document} navHtml
			   * @return {array} landmarks list
			   */},{key:"parseLandmarks",value:function parseLandmarks(navHtml){var navElement=(0,_core$f.querySelectorByType)(navHtml,"nav","landmarks");var navItems=navElement?(0,_core$f.qsa)(navElement,"li"):[];var length=navItems.length;var i;var list=[];var item;if(!navItems||length===0)return list;for(i=0;i<length;++i){item=this.landmarkItem(navItems[i]);if(item){list.push(item);this.landmarksByType[item.type]=i;}}return list;}/**
			   * Create a landmarkItem
			   * @private
			   * @param  {element} item
			   * @return {object} landmarkItem
			   */},{key:"landmarkItem",value:function landmarkItem(item){var content=(0,_core$f.filterChildren)(item,"a",true);if(!content){return;}var type=content.getAttributeNS("http://www.idpf.org/2007/ops","type")||undefined;var href=content.getAttribute("href")||"";var text=content.textContent||"";return{"href":href,"label":text,"type":type};}/**
			   * Parse from a Epub > 3.0 NC
			   * @private
			   * @param  {document} navHtml
			   * @return {array} navigation list
			   */},{key:"parseNcx",value:function parseNcx(tocXml){var navPoints=(0,_core$f.qsa)(tocXml,"navPoint");var length=navPoints.length;var i;var toc={};var list=[];var item,parent;if(!navPoints||length===0)return list;for(i=0;i<length;++i){item=this.ncxItem(navPoints[i]);toc[item.id]=item;if(!item.parent){list.push(item);}else{parent=toc[item.parent];parent.subitems.push(item);}}return list;}/**
			   * Create a ncxItem
			   * @private
			   * @param  {element} item
			   * @return {object} ncxItem
			   */},{key:"ncxItem",value:function ncxItem(item){var id=item.getAttribute("id")||false,content=(0,_core$f.qs)(item,"content"),src=content.getAttribute("src"),navLabel=(0,_core$f.qs)(item,"navLabel"),text=navLabel.textContent?navLabel.textContent:"",subitems=[],parentNode=item.parentNode,parent;if(parentNode&&(parentNode.nodeName==="navPoint"||parentNode.nodeName.split(':').slice(-1)[0]==="navPoint")){parent=parentNode.getAttribute("id");}return{"id":id,"href":src,"label":text,"subitems":subitems,"parent":parent};}/**
			   * Load Spine Items
			   * @param  {object} json the items to be loaded
			   * @return {Array} navItems
			   */},{key:"load",value:function load(json){var _this15=this;return json.map(function(item){item.label=item.title;item.subitems=item.children?_this15.load(item.children):[];return item;});}/**
			   * forEach pass through
			   * @param  {Function} fn function to run on each item
			   * @return {method} forEach loop
			   */},{key:"forEach",value:function forEach(fn){return this.toc.forEach(fn);}}]);return Navigation;}();var _default$p=Navigation;navigation.default=_default$p;var resources={};var mime={};Object.defineProperty(mime,"__esModule",{value:true});mime.default=void 0;/*
			 From Zip.js, by Gildas Lormeau
			edited down
			 */var table={"application":{"ecmascript":["es","ecma"],"javascript":"js","ogg":"ogx","pdf":"pdf","postscript":["ps","ai","eps","epsi","epsf","eps2","eps3"],"rdf+xml":"rdf","smil":["smi","smil"],"xhtml+xml":["xhtml","xht"],"xml":["xml","xsl","xsd","opf","ncx"],"zip":"zip","x-httpd-eruby":"rhtml","x-latex":"latex","x-maker":["frm","maker","frame","fm","fb","book","fbdoc"],"x-object":"o","x-shockwave-flash":["swf","swfl"],"x-silverlight":"scr","epub+zip":"epub","font-tdpfr":"pfr","inkml+xml":["ink","inkml"],"json":"json","jsonml+json":"jsonml","mathml+xml":"mathml","metalink+xml":"metalink","mp4":"mp4s",// "oebps-package+xml" : "opf",
"omdoc+xml":"omdoc","oxps":"oxps","vnd.amazon.ebook":"azw","widget":"wgt",// "x-dtbncx+xml" : "ncx",
"x-dtbook+xml":"dtb","x-dtbresource+xml":"res","x-font-bdf":"bdf","x-font-ghostscript":"gsf","x-font-linux-psf":"psf","x-font-otf":"otf","x-font-pcf":"pcf","x-font-snf":"snf","x-font-ttf":["ttf","ttc"],"x-font-type1":["pfa","pfb","pfm","afm"],"x-font-woff":"woff","x-mobipocket-ebook":["prc","mobi"],"x-mspublisher":"pub","x-nzb":"nzb","x-tgif":"obj","xaml+xml":"xaml","xml-dtd":"dtd","xproc+xml":"xpl","xslt+xml":"xslt","internet-property-stream":"acx","x-compress":"z","x-compressed":"tgz","x-gzip":"gz"},"audio":{"flac":"flac","midi":["mid","midi","kar","rmi"],"mpeg":["mpga","mpega","mp2","mp3","m4a","mp2a","m2a","m3a"],"mpegurl":"m3u","ogg":["oga","ogg","spx"],"x-aiff":["aif","aiff","aifc"],"x-ms-wma":"wma","x-wav":"wav","adpcm":"adp","mp4":"mp4a","webm":"weba","x-aac":"aac","x-caf":"caf","x-matroska":"mka","x-pn-realaudio-plugin":"rmp","xm":"xm","mid":["mid","rmi"]},"image":{"gif":"gif","ief":"ief","jpeg":["jpeg","jpg","jpe"],"pcx":"pcx","png":"png","svg+xml":["svg","svgz"],"tiff":["tiff","tif"],"x-icon":"ico","bmp":"bmp","webp":"webp","x-pict":["pic","pct"],"x-tga":"tga","cis-cod":"cod"},"text":{"cache-manifest":["manifest","appcache"],"css":"css","csv":"csv","html":["html","htm","shtml","stm"],"mathml":"mml","plain":["txt","text","brf","conf","def","list","log","in","bas"],"richtext":"rtx","tab-separated-values":"tsv","x-bibtex":"bib"},"video":{"mpeg":["mpeg","mpg","mpe","m1v","m2v","mp2","mpa","mpv2"],"mp4":["mp4","mp4v","mpg4"],"quicktime":["qt","mov"],"ogg":"ogv","vnd.mpegurl":["mxu","m4u"],"x-flv":"flv","x-la-asf":["lsf","lsx"],"x-mng":"mng","x-ms-asf":["asf","asx","asr"],"x-ms-wm":"wm","x-ms-wmv":"wmv","x-ms-wmx":"wmx","x-ms-wvx":"wvx","x-msvideo":"avi","x-sgi-movie":"movie","x-matroska":["mpv","mkv","mk3d","mks"],"3gpp2":"3g2","h261":"h261","h263":"h263","h264":"h264","jpeg":"jpgv","jpm":["jpm","jpgm"],"mj2":["mj2","mjp2"],"vnd.ms-playready.media.pyv":"pyv","vnd.uvvu.mp4":["uvu","uvvu"],"vnd.vivo":"viv","webm":"webm","x-f4v":"f4v","x-m4v":"m4v","x-ms-vob":"vob","x-smv":"smv"}};var mimeTypes=function(){var type,subtype,val,index,mimeTypes={};for(type in table){if(table.hasOwnProperty(type)){for(subtype in table[type]){if(table[type].hasOwnProperty(subtype)){val=table[type][subtype];if(typeof val=="string"){mimeTypes[val]=type+"/"+subtype;}else{for(index=0;index<val.length;index++){mimeTypes[val[index]]=type+"/"+subtype;}}}}}}return mimeTypes;}();var defaultValue="text/plain";//"application/octet-stream";
function lookup(filename){return filename&&mimeTypes[filename.split(".").pop().toLowerCase()]||defaultValue;}var _default$o={lookup:lookup};mime.default=_default$o;Object.defineProperty(resources,"__esModule",{value:true});resources.default=void 0;var _replacements$1=replacements;var _core$e=core;var _url$2=_interopRequireDefault$j(url);var _mime$2=_interopRequireDefault$j(mime);var _path$3=_interopRequireDefault$j(path$1);var _pathWebpack=_interopRequireDefault$j(path);function _interopRequireDefault$j(obj){return obj&&obj.__esModule?obj:{default:obj};}/**
			 * Handle Package Resources
			 * @class
			 * @param {Manifest} manifest
			 * @param {object} [options]
			 * @param {string} [options.replacements="base64"]
			 * @param {Archive} [options.archive]
			 * @param {method} [options.resolver]
			 */var Resources=/*#__PURE__*/function(){function Resources(manifest,options){_classCallCheck3(this,Resources);this.settings={replacements:options&&options.replacements||"base64",archive:options&&options.archive,resolver:options&&options.resolver,request:options&&options.request};this.process(manifest);}/**
			   * Process resources
			   * @param {Manifest} manifest
			   */_createClass3(Resources,[{key:"process",value:function process(manifest){this.manifest=manifest;this.resources=Object.keys(manifest).map(function(key){return manifest[key];});this.replacementUrls=[];this.html=[];this.assets=[];this.css=[];this.urls=[];this.cssUrls=[];this.split();this.splitUrls();}/**
			   * Split resources by type
			   * @private
			   */},{key:"split",value:function split(){// HTML
this.html=this.resources.filter(function(item){if(item.type==="application/xhtml+xml"||item.type==="text/html"){return true;}});// Exclude HTML
this.assets=this.resources.filter(function(item){if(item.type!=="application/xhtml+xml"&&item.type!=="text/html"){return true;}});// Only CSS
this.css=this.resources.filter(function(item){if(item.type==="text/css"){return true;}});}/**
			   * Convert split resources into Urls
			   * @private
			   */},{key:"splitUrls",value:function splitUrls(){// All Assets Urls
this.urls=this.assets.map(function(item){return item.href;}.bind(this));// Css Urls
this.cssUrls=this.css.map(function(item){return item.href;});}/**
			   * Create a url to a resource
			   * @param {string} url
			   * @return {Promise<string>} Promise resolves with url string
			   */},{key:"createUrl",value:function createUrl(url){var parsedUrl=new _url$2.default(url);var mimeType=_mime$2.default.lookup(parsedUrl.filename);if(this.settings.archive){return this.settings.archive.createUrl(url,{"base64":this.settings.replacements==="base64"});}else{if(this.settings.replacements==="base64"){return this.settings.request(url,'blob').then(function(blob){return(0,_core$e.blob2base64)(blob);}).then(function(blob){return(0,_core$e.createBase64Url)(blob,mimeType);});}else{return this.settings.request(url,'blob').then(function(blob){return(0,_core$e.createBlobUrl)(blob,mimeType);});}}}/**
			   * Create blob urls for all the assets
			   * @return {Promise}         returns replacement urls
			   */},{key:"replacements",value:function replacements(){var _this16=this;if(this.settings.replacements==="none"){return new Promise(function(resolve){resolve(this.urls);}.bind(this));}var replacements=this.urls.map(function(url){var absolute=_this16.settings.resolver(url);return _this16.createUrl(absolute).catch(function(err){console.error(err);return null;});});return Promise.all(replacements).then(function(replacementUrls){_this16.replacementUrls=replacementUrls.filter(function(url){return typeof url==="string";});return replacementUrls;});}/**
			   * Replace URLs in CSS resources
			   * @private
			   * @param  {Archive} [archive]
			   * @param  {method} [resolver]
			   * @return {Promise}
			   */},{key:"replaceCss",value:function replaceCss(archive,resolver){var replaced=[];archive=archive||this.settings.archive;resolver=resolver||this.settings.resolver;this.cssUrls.forEach(function(href){var replacement=this.createCssFile(href,archive,resolver).then(function(replacementUrl){// switch the url in the replacementUrls
var indexInUrls=this.urls.indexOf(href);if(indexInUrls>-1){this.replacementUrls[indexInUrls]=replacementUrl;}}.bind(this));replaced.push(replacement);}.bind(this));return Promise.all(replaced);}/**
			   * Create a new CSS file with the replaced URLs
			   * @private
			   * @param  {string} href the original css file
			   * @return {Promise}  returns a BlobUrl to the new CSS file or a data url
			   */},{key:"createCssFile",value:function createCssFile(href){var _this17=this;var newUrl;if(_pathWebpack.default.isAbsolute(href)){return new Promise(function(resolve){resolve();});}var absolute=this.settings.resolver(href);// Get the text of the css file from the archive
var textResponse;if(this.settings.archive){textResponse=this.settings.archive.getText(absolute);}else{textResponse=this.settings.request(absolute,"text");}// Get asset links relative to css file
var relUrls=this.urls.map(function(assetHref){var resolved=_this17.settings.resolver(assetHref);var relative=new _path$3.default(absolute).relative(resolved);return relative;});if(!textResponse){// file not found, don't replace
return new Promise(function(resolve){resolve();});}return textResponse.then(function(text){// Replacements in the css text
text=(0,_replacements$1.substitute)(text,relUrls,_this17.replacementUrls);// Get the new url
if(_this17.settings.replacements==="base64"){newUrl=(0,_core$e.createBase64Url)(text,"text/css");}else{newUrl=(0,_core$e.createBlobUrl)(text,"text/css");}return newUrl;},function(err){// handle response errors
return new Promise(function(resolve){resolve();});});}/**
			   * Resolve all resources URLs relative to an absolute URL
			   * @param  {string} absolute to be resolved to
			   * @param  {resolver} [resolver]
			   * @return {string[]} array with relative Urls
			   */},{key:"relativeTo",value:function relativeTo(absolute,resolver){resolver=resolver||this.settings.resolver;// Get Urls relative to current sections
return this.urls.map(function(href){var resolved=resolver(href);var relative=new _path$3.default(absolute).relative(resolved);return relative;}.bind(this));}/**
			   * Get a URL for a resource
			   * @param  {string} path
			   * @return {string} url
			   */},{key:"get",value:function get(path){var indexInUrls=this.urls.indexOf(path);if(indexInUrls===-1){return;}if(this.replacementUrls.length){return new Promise(function(resolve,reject){resolve(this.replacementUrls[indexInUrls]);}.bind(this));}else{return this.createUrl(path);}}/**
			   * Substitute urls in content, with replacements,
			   * relative to a url if provided
			   * @param  {string} content
			   * @param  {string} [url]   url to resolve to
			   * @return {string}         content with urls substituted
			   */},{key:"substitute",value:function substitute(content,url){var relUrls;if(url){relUrls=this.relativeTo(url);}else{relUrls=this.urls;}return(0,_replacements$1.substitute)(content,relUrls,this.replacementUrls);}},{key:"destroy",value:function destroy(){this.settings=undefined;this.manifest=undefined;this.resources=undefined;this.replacementUrls=undefined;this.html=undefined;this.assets=undefined;this.css=undefined;this.urls=undefined;this.cssUrls=undefined;}}]);return Resources;}();var _default$n=Resources;resources.default=_default$n;var pagelist={};Object.defineProperty(pagelist,"__esModule",{value:true});pagelist.default=void 0;var _epubcfi$7=_interopRequireDefault$i(epubcfi);var _core$d=core;function _interopRequireDefault$i(obj){return obj&&obj.__esModule?obj:{default:obj};}/**
			 * Page List Parser
			 * @param {document} [xml]
			 */var PageList=/*#__PURE__*/function(){function PageList(xml){_classCallCheck3(this,PageList);this.pages=[];this.locations=[];this.epubcfi=new _epubcfi$7.default();this.firstPage=0;this.lastPage=0;this.totalPages=0;this.toc=undefined;this.ncx=undefined;if(xml){this.pageList=this.parse(xml);}if(this.pageList&&this.pageList.length){this.process(this.pageList);}}/**
			   * Parse PageList Xml
			   * @param  {document} xml
			   */_createClass3(PageList,[{key:"parse",value:function parse(xml){var html=(0,_core$d.qs)(xml,"html");var ncx=(0,_core$d.qs)(xml,"ncx");if(html){return this.parseNav(xml);}else if(ncx){return this.parseNcx(xml);}}/**
			   * Parse a Nav PageList
			   * @private
			   * @param  {node} navHtml
			   * @return {PageList.item[]} list
			   */},{key:"parseNav",value:function parseNav(navHtml){var navElement=(0,_core$d.querySelectorByType)(navHtml,"nav","page-list");var navItems=navElement?(0,_core$d.qsa)(navElement,"li"):[];var length=navItems.length;var i;var list=[];var item;if(!navItems||length===0)return list;for(i=0;i<length;++i){item=this.item(navItems[i]);list.push(item);}return list;}},{key:"parseNcx",value:function parseNcx(navXml){var list=[];var i=0;var item;var pageList;var pageTargets;var length=0;pageList=(0,_core$d.qs)(navXml,"pageList");if(!pageList)return list;pageTargets=(0,_core$d.qsa)(pageList,"pageTarget");length=pageTargets.length;if(!pageTargets||pageTargets.length===0){return list;}for(i=0;i<length;++i){item=this.ncxItem(pageTargets[i]);list.push(item);}return list;}},{key:"ncxItem",value:function ncxItem(item){var navLabel=(0,_core$d.qs)(item,"navLabel");var navLabelText=(0,_core$d.qs)(navLabel,"text");var pageText=navLabelText.textContent;var content=(0,_core$d.qs)(item,"content");var href=content.getAttribute("src");var page=parseInt(pageText,10);return{"href":href,"page":page};}/**
			   * Page List Item
			   * @private
			   * @param  {node} item
			   * @return {object} pageListItem
			   */},{key:"item",value:function item(_item){var content=(0,_core$d.qs)(_item,"a"),href=content.getAttribute("href")||"",text=content.textContent||"",page=parseInt(text),isCfi=href.indexOf("epubcfi"),split,packageUrl,cfi;if(isCfi!=-1){split=href.split("#");packageUrl=split[0];cfi=split.length>1?split[1]:false;return{"cfi":cfi,"href":href,"packageUrl":packageUrl,"page":page};}else{return{"href":href,"page":page};}}/**
			   * Process pageList items
			   * @private
			   * @param  {array} pageList
			   */},{key:"process",value:function process(pageList){pageList.forEach(function(item){this.pages.push(item.page);if(item.cfi){this.locations.push(item.cfi);}},this);this.firstPage=parseInt(this.pages[0]);this.lastPage=parseInt(this.pages[this.pages.length-1]);this.totalPages=this.lastPage-this.firstPage;}/**
			   * Get a PageList result from a EpubCFI
			   * @param  {string} cfi EpubCFI String
			   * @return {number} page
			   */},{key:"pageFromCfi",value:function pageFromCfi(cfi){var pg=-1;// Check if the pageList has not been set yet
if(this.locations.length===0){return-1;}// TODO: check if CFI is valid?
// check if the cfi is in the location list
// var index = this.locations.indexOf(cfi);
var index=(0,_core$d.indexOfSorted)(cfi,this.locations,this.epubcfi.compare);if(index!=-1){pg=this.pages[index];}else{// Otherwise add it to the list of locations
// Insert it in the correct position in the locations page
//index = EPUBJS.core.insert(cfi, this.locations, this.epubcfi.compare);
index=(0,_core$d.locationOf)(cfi,this.locations,this.epubcfi.compare);// Get the page at the location just before the new one, or return the first
pg=index-1>=0?this.pages[index-1]:this.pages[0];if(pg!==undefined);else{pg=-1;}}return pg;}/**
			   * Get an EpubCFI from a Page List Item
			   * @param  {string | number} pg
			   * @return {string} cfi
			   */},{key:"cfiFromPage",value:function cfiFromPage(pg){var cfi=-1;// check that pg is an int
if(typeof pg!="number"){pg=parseInt(pg);}// check if the cfi is in the page list
// Pages could be unsorted.
var index=this.pages.indexOf(pg);if(index!=-1){cfi=this.locations[index];}// TODO: handle pages not in the list
return cfi;}/**
			   * Get a Page from Book percentage
			   * @param  {number} percent
			   * @return {number} page
			   */},{key:"pageFromPercentage",value:function pageFromPercentage(percent){var pg=Math.round(this.totalPages*percent);return pg;}/**
			   * Returns a value between 0 - 1 corresponding to the location of a page
			   * @param  {number} pg the page
			   * @return {number} percentage
			   */},{key:"percentageFromPage",value:function percentageFromPage(pg){var percentage=(pg-this.firstPage)/this.totalPages;return Math.round(percentage*1000)/1000;}/**
			   * Returns a value between 0 - 1 corresponding to the location of a cfi
			   * @param  {string} cfi EpubCFI String
			   * @return {number} percentage
			   */},{key:"percentageFromCfi",value:function percentageFromCfi(cfi){var pg=this.pageFromCfi(cfi);var percentage=this.percentageFromPage(pg);return percentage;}/**
			   * Destroy
			   */},{key:"destroy",value:function destroy(){this.pages=undefined;this.locations=undefined;this.epubcfi=undefined;this.pageList=undefined;this.toc=undefined;this.ncx=undefined;}}]);return PageList;}();var _default$m=PageList;pagelist.default=_default$m;var rendition={};var layout={};Object.defineProperty(layout,"__esModule",{value:true});layout.default=void 0;var _core$c=core;var _constants$9=constants;var _eventEmitter$8=_interopRequireDefault$h(eventEmitter.exports);function _interopRequireDefault$h(obj){return obj&&obj.__esModule?obj:{default:obj};}/**
			 * Figures out the CSS values to apply for a layout
			 * @class
			 * @param {object} settings
			 * @param {string} [settings.layout='reflowable']
			 * @param {string} [settings.spread]
			 * @param {number} [settings.minSpreadWidth=800]
			 * @param {boolean} [settings.evenSpreads=false]
			 */var Layout=/*#__PURE__*/function(){function Layout(settings){_classCallCheck3(this,Layout);this.settings=settings;this.name=settings.layout||"reflowable";this._spread=settings.spread==="none"?false:true;this._minSpreadWidth=settings.minSpreadWidth||800;this._evenSpreads=settings.evenSpreads||false;if(settings.flow==="scrolled"||settings.flow==="scrolled-continuous"||settings.flow==="scrolled-doc"){this._flow="scrolled";}else{this._flow="paginated";}this.width=0;this.height=0;this.spreadWidth=0;this.delta=0;this.columnWidth=0;this.gap=0;this.divisor=1;this.props={name:this.name,spread:this._spread,flow:this._flow,width:0,height:0,spreadWidth:0,delta:0,columnWidth:0,gap:0,divisor:1};}/**
			   * Switch the flow between paginated and scrolled
			   * @param  {string} flow paginated | scrolled
			   * @return {string} simplified flow
			   */_createClass3(Layout,[{key:"flow",value:function flow(_flow2){if(typeof _flow2!="undefined"){if(_flow2==="scrolled"||_flow2==="scrolled-continuous"||_flow2==="scrolled-doc"){this._flow="scrolled";}else{this._flow="paginated";}// this.props.flow = this._flow;
this.update({flow:this._flow});}return this._flow;}/**
			   * Switch between using spreads or not, and set the
			   * width at which they switch to single.
			   * @param  {string} spread "none" | "always" | "auto"
			   * @param  {number} min integer in pixels
			   * @return {boolean} spread true | false
			   */},{key:"spread",value:function spread(_spread,min){if(_spread){this._spread=_spread==="none"?false:true;// this.props.spread = this._spread;
this.update({spread:this._spread});}if(min>=0){this._minSpreadWidth=min;}return this._spread;}/**
			   * Calculate the dimensions of the pagination
			   * @param  {number} _width  width of the rendering
			   * @param  {number} _height height of the rendering
			   * @param  {number} _gap    width of the gap between columns
			   */},{key:"calculate",value:function calculate(_width,_height,_gap){var divisor=1;var gap=_gap||0;//-- Check the width and create even width columns
// var fullWidth = Math.floor(_width);
var width=_width;var height=_height;var section=Math.floor(width/12);var columnWidth;var spreadWidth;var pageWidth;var delta;if(this._spread&&width>=this._minSpreadWidth){divisor=2;}else{divisor=1;}if(this.name==="reflowable"&&this._flow==="paginated"&&!(_gap>=0)){gap=section%2===0?section:section-1;}if(this.name==="pre-paginated"){gap=0;}//-- Double Page
if(divisor>1){// width = width - gap;
// columnWidth = (width - gap) / divisor;
// gap = gap / divisor;
columnWidth=width/divisor-gap;pageWidth=columnWidth+gap;}else{columnWidth=width;pageWidth=width;}if(this.name==="pre-paginated"&&divisor>1){width=columnWidth;}spreadWidth=columnWidth*divisor+gap;delta=width;this.width=width;this.height=height;this.spreadWidth=spreadWidth;this.pageWidth=pageWidth;this.delta=delta;this.columnWidth=columnWidth;this.gap=gap;this.divisor=divisor;// this.props.width = width;
// this.props.height = _height;
// this.props.spreadWidth = spreadWidth;
// this.props.pageWidth = pageWidth;
// this.props.delta = delta;
//
// this.props.columnWidth = colWidth;
// this.props.gap = gap;
// this.props.divisor = divisor;
this.update({width:width,height:height,spreadWidth:spreadWidth,pageWidth:pageWidth,delta:delta,columnWidth:columnWidth,gap:gap,divisor:divisor});}/**
			   * Apply Css to a Document
			   * @param  {Contents} contents
			   * @return {Promise}
			   */},{key:"format",value:function format(contents,section,axis){var formating;if(this.name==="pre-paginated"){formating=contents.fit(this.columnWidth,this.height,section);}else if(this._flow==="paginated"){formating=contents.columns(this.width,this.height,this.columnWidth,this.gap,this.settings.direction);}else if(axis&&axis==="horizontal"){formating=contents.size(null,this.height);}else{formating=contents.size(this.width,null);}return formating;// might be a promise in some View Managers
}/**
			   * Count number of pages
			   * @param  {number} totalLength
			   * @param  {number} pageLength
			   * @return {{spreads: Number, pages: Number}}
			   */},{key:"count",value:function count(totalLength,pageLength){var spreads,pages;if(this.name==="pre-paginated"){spreads=1;pages=1;}else if(this._flow==="paginated"){pageLength=pageLength||this.delta;spreads=Math.ceil(totalLength/pageLength);pages=spreads*this.divisor;}else{// scrolled
pageLength=pageLength||this.height;spreads=Math.ceil(totalLength/pageLength);pages=spreads;}return{spreads:spreads,pages:pages};}/**
			   * Update props that have changed
			   * @private
			   * @param  {object} props
			   */},{key:"update",value:function update(props){var _this18=this;// Remove props that haven't changed
Object.keys(props).forEach(function(propName){if(_this18.props[propName]===props[propName]){delete props[propName];}});if(Object.keys(props).length>0){var newProps=(0,_core$c.extend)(this.props,props);this.emit(_constants$9.EVENTS.LAYOUT.UPDATED,newProps,props);}}}]);return Layout;}();(0,_eventEmitter$8.default)(Layout.prototype);var _default$l=Layout;layout.default=_default$l;var themes={};Object.defineProperty(themes,"__esModule",{value:true});themes.default=void 0;var _url$1=_interopRequireDefault$g(url);function _interopRequireDefault$g(obj){return obj&&obj.__esModule?obj:{default:obj};}/**
			 * Themes to apply to displayed content
			 * @class
			 * @param {Rendition} rendition
			 */var Themes=/*#__PURE__*/function(){function Themes(rendition){_classCallCheck3(this,Themes);this.rendition=rendition;this._themes={"default":{"rules":{},"url":"","serialized":""}};this._overrides={};this._current="default";this._injected=[];this.rendition.hooks.content.register(this.inject.bind(this));this.rendition.hooks.content.register(this.overrides.bind(this));}/**
			   * Add themes to be used by a rendition
			   * @param {object | Array<object> | string}
			   * @example themes.register("light", "http://example.com/light.css")
			   * @example themes.register("light", { "body": { "color": "purple"}})
			   * @example themes.register({ "light" : {...}, "dark" : {...}})
			   */_createClass3(Themes,[{key:"register",value:function register(){if(arguments.length===0){return;}if(arguments.length===1&&_typeof3(arguments[0])==="object"){return this.registerThemes(arguments[0]);}if(arguments.length===1&&typeof arguments[0]==="string"){return this.default(arguments[0]);}if(arguments.length===2&&typeof arguments[1]==="string"){return this.registerUrl(arguments[0],arguments[1]);}if(arguments.length===2&&_typeof3(arguments[1])==="object"){return this.registerRules(arguments[0],arguments[1]);}}/**
			   * Add a default theme to be used by a rendition
			   * @param {object | string} theme
			   * @example themes.register("http://example.com/default.css")
			   * @example themes.register({ "body": { "color": "purple"}})
			   */},{key:"default",value:function _default(theme){if(!theme){return;}if(typeof theme==="string"){return this.registerUrl("default",theme);}if(_typeof3(theme)==="object"){return this.registerRules("default",theme);}}/**
			   * Register themes object
			   * @param {object} themes
			   */},{key:"registerThemes",value:function registerThemes(themes){for(var theme in themes){if(themes.hasOwnProperty(theme)){if(typeof themes[theme]==="string"){this.registerUrl(theme,themes[theme]);}else{this.registerRules(theme,themes[theme]);}}}}/**
			   * Register a theme by passing its css as string
			   * @param {string} name 
			   * @param {string} css 
			   */},{key:"registerCss",value:function registerCss(name,css){this._themes[name]={"serialized":css};if(this._injected[name]||name=='default'){this.update(name);}}/**
			   * Register a url
			   * @param {string} name
			   * @param {string} input
			   */},{key:"registerUrl",value:function registerUrl(name,input){var url=new _url$1.default(input);this._themes[name]={"url":url.toString()};if(this._injected[name]||name=='default'){this.update(name);}}/**
			   * Register rule
			   * @param {string} name
			   * @param {object} rules
			   */},{key:"registerRules",value:function registerRules(name,rules){this._themes[name]={"rules":rules};// TODO: serialize css rules
if(this._injected[name]||name=='default'){this.update(name);}}/**
			   * Select a theme
			   * @param {string} name
			   */},{key:"select",value:function select(name){var prev=this._current;var contents;this._current=name;this.update(name);contents=this.rendition.getContents();contents.forEach(function(content){content.removeClass(prev);content.addClass(name);});}/**
			   * Update a theme
			   * @param {string} name
			   */},{key:"update",value:function update(name){var _this19=this;var contents=this.rendition.getContents();contents.forEach(function(content){_this19.add(name,content);});}/**
			   * Inject all themes into contents
			   * @param {Contents} contents
			   */},{key:"inject",value:function inject(contents){var links=[];var themes=this._themes;var theme;for(var name in themes){if(themes.hasOwnProperty(name)&&(name===this._current||name==="default")){theme=themes[name];if(theme.rules&&Object.keys(theme.rules).length>0||theme.url&&links.indexOf(theme.url)===-1){this.add(name,contents);}this._injected.push(name);}}if(this._current!="default"){contents.addClass(this._current);}}/**
			   * Add Theme to contents
			   * @param {string} name
			   * @param {Contents} contents
			   */},{key:"add",value:function add(name,contents){var theme=this._themes[name];if(!theme||!contents){return;}if(theme.url){contents.addStylesheet(theme.url);}else if(theme.serialized){contents.addStylesheetCss(theme.serialized,name);theme.injected=true;}else if(theme.rules){contents.addStylesheetRules(theme.rules,name);theme.injected=true;}}/**
			   * Add override
			   * @param {string} name
			   * @param {string} value
			   * @param {boolean} priority
			   */},{key:"override",value:function override(name,value,priority){var _this20=this;var contents=this.rendition.getContents();this._overrides[name]={value:value,priority:priority===true};contents.forEach(function(content){content.css(name,_this20._overrides[name].value,_this20._overrides[name].priority);});}},{key:"removeOverride",value:function removeOverride(name){var contents=this.rendition.getContents();delete this._overrides[name];contents.forEach(function(content){content.css(name);});}/**
			   * Add all overrides
			   * @param {Content} content
			   */},{key:"overrides",value:function overrides(contents){var overrides=this._overrides;for(var rule in overrides){if(overrides.hasOwnProperty(rule)){contents.css(rule,overrides[rule].value,overrides[rule].priority);}}}/**
			   * Adjust the font size of a rendition
			   * @param {number} size
			   */},{key:"fontSize",value:function fontSize(size){this.override("font-size",size);}/**
			   * Adjust the font-family of a rendition
			   * @param {string} f
			   */},{key:"font",value:function font(f){this.override("font-family",f,true);}},{key:"destroy",value:function destroy(){this.rendition=undefined;this._themes=undefined;this._overrides=undefined;this._current=undefined;this._injected=undefined;}}]);return Themes;}();var _default$k=Themes;themes.default=_default$k;var contents={};var mapping={};Object.defineProperty(mapping,"__esModule",{value:true});mapping.default=void 0;var _epubcfi$6=_interopRequireDefault$f(epubcfi);var _core$b=core;function _interopRequireDefault$f(obj){return obj&&obj.__esModule?obj:{default:obj};}/**
			 * Map text locations to CFI ranges
			 * @class
			 * @param {Layout} layout Layout to apply
			 * @param {string} [direction="ltr"] Text direction
			 * @param {string} [axis="horizontal"] vertical or horizontal axis
			 * @param {boolean} [dev] toggle developer highlighting
			 */var Mapping=/*#__PURE__*/function(){function Mapping(layout,direction,axis){var dev=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;_classCallCheck3(this,Mapping);this.layout=layout;this.horizontal=axis==="horizontal"?true:false;this.direction=direction||"ltr";this._dev=dev;}/**
			   * Find CFI pairs for entire section at once
			   */_createClass3(Mapping,[{key:"section",value:function section(view){var ranges=this.findRanges(view);var map=this.rangeListToCfiList(view.section.cfiBase,ranges);return map;}/**
			   * Find CFI pairs for a page
			   * @param {Contents} contents Contents from view
			   * @param {string} cfiBase string of the base for a cfi
			   * @param {number} start position to start at
			   * @param {number} end position to end at
			   */},{key:"page",value:function page(contents,cfiBase,start,end){var root=contents&&contents.document?contents.document.body:false;var result;if(!root){return;}result=this.rangePairToCfiPair(cfiBase,{start:this.findStart(root,start,end),end:this.findEnd(root,start,end)});if(this._dev===true){var doc=contents.document;var startRange=new _epubcfi$6.default(result.start).toRange(doc);var endRange=new _epubcfi$6.default(result.end).toRange(doc);var selection=doc.defaultView.getSelection();var r=doc.createRange();selection.removeAllRanges();r.setStart(startRange.startContainer,startRange.startOffset);r.setEnd(endRange.endContainer,endRange.endOffset);selection.addRange(r);}return result;}/**
			   * Walk a node, preforming a function on each node it finds
			   * @private
			   * @param {Node} root Node to walkToNode
			   * @param {function} func walk function
			   * @return {*} returns the result of the walk function
			   */},{key:"walk",value:function walk(root,func){// IE11 has strange issue, if root is text node IE throws exception on
// calling treeWalker.nextNode(), saying
// Unexpected call to method or property access instead of returning null value
if(root&&root.nodeType===Node.TEXT_NODE){return;}// safeFilter is required so that it can work in IE as filter is a function for IE
// and for other browser filter is an object.
var filter={acceptNode:function acceptNode(node){if(node.data.trim().length>0){return NodeFilter.FILTER_ACCEPT;}else{return NodeFilter.FILTER_REJECT;}}};var safeFilter=filter.acceptNode;safeFilter.acceptNode=filter.acceptNode;var treeWalker=document.createTreeWalker(root,NodeFilter.SHOW_TEXT,safeFilter,false);var node;var result;while(node=treeWalker.nextNode()){result=func(node);if(result)break;}return result;}},{key:"findRanges",value:function findRanges(view){var columns=[];var scrollWidth=view.contents.scrollWidth();var spreads=Math.ceil(scrollWidth/this.layout.spreadWidth);var count=spreads*this.layout.divisor;var columnWidth=this.layout.columnWidth;var gap=this.layout.gap;var start,end;for(var i=0;i<count.pages;i++){start=(columnWidth+gap)*i;end=columnWidth*(i+1)+gap*i;columns.push({start:this.findStart(view.document.body,start,end),end:this.findEnd(view.document.body,start,end)});}return columns;}/**
			   * Find Start Range
			   * @private
			   * @param {Node} root root node
			   * @param {number} start position to start at
			   * @param {number} end position to end at
			   * @return {Range}
			   */},{key:"findStart",value:function findStart(root,start,end){var _this21=this;var stack=[root];var $el;var found;var $prev=root;while(stack.length){$el=stack.shift();found=this.walk($el,function(node){var left,right,top,bottom;var elPos;elPos=(0,_core$b.nodeBounds)(node);if(_this21.horizontal&&_this21.direction==="ltr"){left=_this21.horizontal?elPos.left:elPos.top;right=_this21.horizontal?elPos.right:elPos.bottom;if(left>=start&&left<=end){return node;}else if(right>start){return node;}else{$prev=node;stack.push(node);}}else if(_this21.horizontal&&_this21.direction==="rtl"){left=elPos.left;right=elPos.right;if(right<=end&&right>=start){return node;}else if(left<end){return node;}else{$prev=node;stack.push(node);}}else{top=elPos.top;bottom=elPos.bottom;if(top>=start&&top<=end){return node;}else if(bottom>start){return node;}else{$prev=node;stack.push(node);}}});if(found){return this.findTextStartRange(found,start,end);}}// Return last element
return this.findTextStartRange($prev,start,end);}/**
			   * Find End Range
			   * @private
			   * @param {Node} root root node
			   * @param {number} start position to start at
			   * @param {number} end position to end at
			   * @return {Range}
			   */},{key:"findEnd",value:function findEnd(root,start,end){var _this22=this;var stack=[root];var $el;var $prev=root;var found;while(stack.length){$el=stack.shift();found=this.walk($el,function(node){var left,right,top,bottom;var elPos;elPos=(0,_core$b.nodeBounds)(node);if(_this22.horizontal&&_this22.direction==="ltr"){left=Math.round(elPos.left);right=Math.round(elPos.right);if(left>end&&$prev){return $prev;}else if(right>end){return node;}else{$prev=node;stack.push(node);}}else if(_this22.horizontal&&_this22.direction==="rtl"){left=Math.round(_this22.horizontal?elPos.left:elPos.top);right=Math.round(_this22.horizontal?elPos.right:elPos.bottom);if(right<start&&$prev){return $prev;}else if(left<start){return node;}else{$prev=node;stack.push(node);}}else{top=Math.round(elPos.top);bottom=Math.round(elPos.bottom);if(top>end&&$prev){return $prev;}else if(bottom>end){return node;}else{$prev=node;stack.push(node);}}});if(found){return this.findTextEndRange(found,start,end);}}// end of chapter
return this.findTextEndRange($prev,start,end);}/**
			   * Find Text Start Range
			   * @private
			   * @param {Node} root root node
			   * @param {number} start position to start at
			   * @param {number} end position to end at
			   * @return {Range}
			   */},{key:"findTextStartRange",value:function findTextStartRange(node,start,end){var ranges=this.splitTextNodeIntoRanges(node);var range;var pos;var left,top,right;for(var i=0;i<ranges.length;i++){range=ranges[i];pos=range.getBoundingClientRect();if(this.horizontal&&this.direction==="ltr"){left=pos.left;if(left>=start){return range;}}else if(this.horizontal&&this.direction==="rtl"){right=pos.right;if(right<=end){return range;}}else{top=pos.top;if(top>=start){return range;}}// prev = range;
}return ranges[0];}/**
			   * Find Text End Range
			   * @private
			   * @param {Node} root root node
			   * @param {number} start position to start at
			   * @param {number} end position to end at
			   * @return {Range}
			   */},{key:"findTextEndRange",value:function findTextEndRange(node,start,end){var ranges=this.splitTextNodeIntoRanges(node);var prev;var range;var pos;var left,right,top,bottom;for(var i=0;i<ranges.length;i++){range=ranges[i];pos=range.getBoundingClientRect();if(this.horizontal&&this.direction==="ltr"){left=pos.left;right=pos.right;if(left>end&&prev){return prev;}else if(right>end){return range;}}else if(this.horizontal&&this.direction==="rtl"){left=pos.left;right=pos.right;if(right<start&&prev){return prev;}else if(left<start){return range;}}else{top=pos.top;bottom=pos.bottom;if(top>end&&prev){return prev;}else if(bottom>end){return range;}}prev=range;}// Ends before limit
return ranges[ranges.length-1];}/**
			   * Split up a text node into ranges for each word
			   * @private
			   * @param {Node} root root node
			   * @param {string} [_splitter] what to split on
			   * @return {Range[]}
			   */},{key:"splitTextNodeIntoRanges",value:function splitTextNodeIntoRanges(node,_splitter){var ranges=[];var textContent=node.textContent||"";var text=textContent.trim();var range;var doc=node.ownerDocument;var splitter=_splitter||" ";var pos=text.indexOf(splitter);if(pos===-1||node.nodeType!=Node.TEXT_NODE){range=doc.createRange();range.selectNodeContents(node);return[range];}range=doc.createRange();range.setStart(node,0);range.setEnd(node,pos);ranges.push(range);range=false;while(pos!=-1){pos=text.indexOf(splitter,pos+1);if(pos>0){if(range){range.setEnd(node,pos);ranges.push(range);}range=doc.createRange();range.setStart(node,pos+1);}}if(range){range.setEnd(node,text.length);ranges.push(range);}return ranges;}/**
			   * Turn a pair of ranges into a pair of CFIs
			   * @private
			   * @param {string} cfiBase base string for an EpubCFI
			   * @param {object} rangePair { start: Range, end: Range }
			   * @return {object} { start: "epubcfi(...)", end: "epubcfi(...)" }
			   */},{key:"rangePairToCfiPair",value:function rangePairToCfiPair(cfiBase,rangePair){var startRange=rangePair.start;var endRange=rangePair.end;startRange.collapse(true);endRange.collapse(false);var startCfi=new _epubcfi$6.default(startRange,cfiBase).toString();var endCfi=new _epubcfi$6.default(endRange,cfiBase).toString();return{start:startCfi,end:endCfi};}},{key:"rangeListToCfiList",value:function rangeListToCfiList(cfiBase,columns){var map=[];var cifPair;for(var i=0;i<columns.length;i++){cifPair=this.rangePairToCfiPair(cfiBase,columns[i]);map.push(cifPair);}return map;}/**
			   * Set the axis for mapping
			   * @param {string} axis horizontal | vertical
			   * @return {boolean} is it horizontal?
			   */},{key:"axis",value:function axis(_axis){if(_axis){this.horizontal=_axis==="horizontal"?true:false;}return this.horizontal;}}]);return Mapping;}();var _default$j=Mapping;mapping.default=_default$j;Object.defineProperty(contents,"__esModule",{value:true});contents.default=void 0;var _eventEmitter$7=_interopRequireDefault$e(eventEmitter.exports);var _core$a=core;var _epubcfi$5=_interopRequireDefault$e(epubcfi);var _mapping$1=_interopRequireDefault$e(mapping);var _replacements=replacements;var _constants$8=constants;function _interopRequireDefault$e(obj){return obj&&obj.__esModule?obj:{default:obj};}var hasNavigator=typeof navigator!=="undefined";var isChrome=hasNavigator&&/Chrome/.test(navigator.userAgent);var isWebkit=hasNavigator&&!isChrome&&/AppleWebKit/.test(navigator.userAgent);var ELEMENT_NODE=1;/**
				* Handles DOM manipulation, queries and events for View contents
				* @class
				* @param {document} doc Document
				* @param {element} content Parent Element (typically Body)
				* @param {string} cfiBase Section component of CFIs
				* @param {number} sectionIndex Index in Spine of Conntent's Section
				*/var Contents=/*#__PURE__*/function(){function Contents(doc,content,cfiBase,sectionIndex){_classCallCheck3(this,Contents);// Blank Cfi for Parsing
this.epubcfi=new _epubcfi$5.default();this.document=doc;this.documentElement=this.document.documentElement;this.content=content||this.document.body;this.window=this.document.defaultView;this._size={width:0,height:0};this.sectionIndex=sectionIndex||0;this.cfiBase=cfiBase||"";this.epubReadingSystem("epub.js",_constants$8.EPUBJS_VERSION);this.called=0;this.active=true;this.listeners();}/**
			  	* Get DOM events that are listened for and passed along
			  	*/_createClass3(Contents,[{key:"width",value:/**
			  	* Get or Set width
			  	* @param {number} [w]
			  	* @returns {number} width
			  	*/function width(w){// var frame = this.documentElement;
var frame=this.content;if(w&&(0,_core$a.isNumber)(w)){w=w+"px";}if(w){frame.style.width=w;// this.content.style.width = w;
}return parseInt(this.window.getComputedStyle(frame)["width"]);}/**
			  	* Get or Set height
			  	* @param {number} [h]
			  	* @returns {number} height
			  	*/},{key:"height",value:function height(h){// var frame = this.documentElement;
var frame=this.content;if(h&&(0,_core$a.isNumber)(h)){h=h+"px";}if(h){frame.style.height=h;// this.content.style.height = h;
}return parseInt(this.window.getComputedStyle(frame)["height"]);}/**
			  	* Get or Set width of the contents
			  	* @param {number} [w]
			  	* @returns {number} width
			  	*/},{key:"contentWidth",value:function contentWidth(w){var content=this.content||this.document.body;if(w&&(0,_core$a.isNumber)(w)){w=w+"px";}if(w){content.style.width=w;}return parseInt(this.window.getComputedStyle(content)["width"]);}/**
			  	* Get or Set height of the contents
			  	* @param {number} [h]
			  	* @returns {number} height
			  	*/},{key:"contentHeight",value:function contentHeight(h){var content=this.content||this.document.body;if(h&&(0,_core$a.isNumber)(h)){h=h+"px";}if(h){content.style.height=h;}return parseInt(this.window.getComputedStyle(content)["height"]);}/**
			  	* Get the width of the text using Range
			  	* @returns {number} width
			  	*/},{key:"textWidth",value:function textWidth(){var rect;var width;var range=this.document.createRange();var content=this.content||this.document.body;var border=(0,_core$a.borders)(content);// Select the contents of frame
range.selectNodeContents(content);// get the width of the text content
rect=range.getBoundingClientRect();width=rect.width;if(border&&border.width){width+=border.width;}return Math.round(width);}/**
			  	* Get the height of the text using Range
			  	* @returns {number} height
			  	*/},{key:"textHeight",value:function textHeight(){var rect;var height;var range=this.document.createRange();var content=this.content||this.document.body;range.selectNodeContents(content);rect=range.getBoundingClientRect();height=rect.bottom;return Math.round(height);}/**
			  	* Get documentElement scrollWidth
			  	* @returns {number} width
			  	*/},{key:"scrollWidth",value:function scrollWidth(){var width=this.documentElement.scrollWidth;return width;}/**
			  	* Get documentElement scrollHeight
			  	* @returns {number} height
			  	*/},{key:"scrollHeight",value:function scrollHeight(){var height=this.documentElement.scrollHeight;return height;}/**
			  	* Set overflow css style of the contents
			  	* @param {string} [overflow]
			  	*/},{key:"overflow",value:function overflow(_overflow){if(_overflow){this.documentElement.style.overflow=_overflow;}return this.window.getComputedStyle(this.documentElement)["overflow"];}/**
			  	* Set overflowX css style of the documentElement
			  	* @param {string} [overflow]
			  	*/},{key:"overflowX",value:function overflowX(overflow){if(overflow){this.documentElement.style.overflowX=overflow;}return this.window.getComputedStyle(this.documentElement)["overflowX"];}/**
			  	* Set overflowY css style of the documentElement
			  	* @param {string} [overflow]
			  	*/},{key:"overflowY",value:function overflowY(overflow){if(overflow){this.documentElement.style.overflowY=overflow;}return this.window.getComputedStyle(this.documentElement)["overflowY"];}/**
			  	* Set Css styles on the contents element (typically Body)
			  	* @param {string} property
			  	* @param {string} value
			  	* @param {boolean} [priority] set as "important"
			  	*/},{key:"css",value:function css(property,value,priority){var content=this.content||this.document.body;if(value){content.style.setProperty(property,value,priority?"important":"");}else{content.style.removeProperty(property);}return this.window.getComputedStyle(content)[property];}/**
			  	* Get or Set the viewport element
			  	* @param {object} [options]
			  	* @param {string} [options.width]
			  	* @param {string} [options.height]
			  	* @param {string} [options.scale]
			  	* @param {string} [options.minimum]
			  	* @param {string} [options.maximum]
			  	* @param {string} [options.scalable]
			  	*/},{key:"viewport",value:function viewport(options){var $viewport=this.document.querySelector("meta[name='viewport']");var parsed={"width":undefined,"height":undefined,"scale":undefined,"minimum":undefined,"maximum":undefined,"scalable":undefined};var newContent=[];var settings={};/*
			    * check for the viewport size
			    * <meta name="viewport" content="width=1024,height=697" />
			    */if($viewport&&$viewport.hasAttribute("content")){var content=$viewport.getAttribute("content");var _width=content.match(/width\s*=\s*([^,]*)/);var _height=content.match(/height\s*=\s*([^,]*)/);var _scale=content.match(/initial-scale\s*=\s*([^,]*)/);var _minimum=content.match(/minimum-scale\s*=\s*([^,]*)/);var _maximum=content.match(/maximum-scale\s*=\s*([^,]*)/);var _scalable=content.match(/user-scalable\s*=\s*([^,]*)/);if(_width&&_width.length&&typeof _width[1]!=="undefined"){parsed.width=_width[1];}if(_height&&_height.length&&typeof _height[1]!=="undefined"){parsed.height=_height[1];}if(_scale&&_scale.length&&typeof _scale[1]!=="undefined"){parsed.scale=_scale[1];}if(_minimum&&_minimum.length&&typeof _minimum[1]!=="undefined"){parsed.minimum=_minimum[1];}if(_maximum&&_maximum.length&&typeof _maximum[1]!=="undefined"){parsed.maximum=_maximum[1];}if(_scalable&&_scalable.length&&typeof _scalable[1]!=="undefined"){parsed.scalable=_scalable[1];}}settings=(0,_core$a.defaults)(options||{},parsed);if(options){if(settings.width){newContent.push("width="+settings.width);}if(settings.height){newContent.push("height="+settings.height);}if(settings.scale){newContent.push("initial-scale="+settings.scale);}if(settings.scalable==="no"){newContent.push("minimum-scale="+settings.scale);newContent.push("maximum-scale="+settings.scale);newContent.push("user-scalable="+settings.scalable);}else{if(settings.scalable){newContent.push("user-scalable="+settings.scalable);}if(settings.minimum){newContent.push("minimum-scale="+settings.minimum);}if(settings.maximum){newContent.push("minimum-scale="+settings.maximum);}}if(!$viewport){$viewport=this.document.createElement("meta");$viewport.setAttribute("name","viewport");this.document.querySelector("head").appendChild($viewport);}$viewport.setAttribute("content",newContent.join(", "));this.window.scrollTo(0,0);}return settings;}/**
			   * Event emitter for when the contents has expanded
			   * @private
			   */},{key:"expand",value:function expand(){this.emit(_constants$8.EVENTS.CONTENTS.EXPAND);}/**
			   * Add DOM listeners
			   * @private
			   */},{key:"listeners",value:function listeners(){this.imageLoadListeners();this.mediaQueryListeners();// this.fontLoadListeners();
this.addEventListeners();this.addSelectionListeners();// this.transitionListeners();
if(typeof ResizeObserver==="undefined"){this.resizeListeners();this.visibilityListeners();}else{this.resizeObservers();}// this.mutationObservers();
this.linksHandler();}/**
			   * Remove DOM listeners
			   * @private
			   */},{key:"removeListeners",value:function removeListeners(){this.removeEventListeners();this.removeSelectionListeners();if(this.observer){this.observer.disconnect();}clearTimeout(this.expanding);}/**
			   * Check if size of contents has changed and
			   * emit 'resize' event if it has.
			   * @private
			   */},{key:"resizeCheck",value:function resizeCheck(){var width=this.textWidth();var height=this.textHeight();if(width!=this._size.width||height!=this._size.height){this._size={width:width,height:height};this.onResize&&this.onResize(this._size);this.emit(_constants$8.EVENTS.CONTENTS.RESIZE,this._size);}}/**
			   * Poll for resize detection
			   * @private
			   */},{key:"resizeListeners",value:function resizeListeners(){clearTimeout(this.expanding);requestAnimationFrame(this.resizeCheck.bind(this));this.expanding=setTimeout(this.resizeListeners.bind(this),350);}/**
			   * Listen for visibility of tab to change
			   * @private
			   */},{key:"visibilityListeners",value:function visibilityListeners(){var _this23=this;document.addEventListener("visibilitychange",function(){if(document.visibilityState==="visible"&&_this23.active===false){_this23.active=true;_this23.resizeListeners();}else{_this23.active=false;clearTimeout(_this23.expanding);}});}/**
			   * Use css transitions to detect resize
			   * @private
			   */},{key:"transitionListeners",value:function transitionListeners(){var body=this.content;body.style['transitionProperty']="font, font-size, font-size-adjust, font-stretch, font-variation-settings, font-weight, width, height";body.style['transitionDuration']="0.001ms";body.style['transitionTimingFunction']="linear";body.style['transitionDelay']="0";this._resizeCheck=this.resizeCheck.bind(this);this.document.addEventListener('transitionend',this._resizeCheck);}/**
			   * Listen for media query changes and emit 'expand' event
			   * Adapted from: https://github.com/tylergaw/media-query-events/blob/master/js/mq-events.js
			   * @private
			   */},{key:"mediaQueryListeners",value:function mediaQueryListeners(){var sheets=this.document.styleSheets;var mediaChangeHandler=function(m){if(m.matches&&!this._expanding){setTimeout(this.expand.bind(this),1);}}.bind(this);for(var i=0;i<sheets.length;i+=1){var rules;// Firefox errors if we access cssRules cross-domain
try{rules=sheets[i].cssRules;}catch(e){return;}if(!rules)return;// Stylesheets changed
for(var j=0;j<rules.length;j+=1){//if (rules[j].constructor === CSSMediaRule) {
if(rules[j].media){var mql=this.window.matchMedia(rules[j].media.mediaText);mql.addListener(mediaChangeHandler);//mql.onchange = mediaChangeHandler;
}}}}/**
			   * Use ResizeObserver to listen for changes in the DOM and check for resize
			   * @private
			   */},{key:"resizeObservers",value:function resizeObservers(){var _this24=this;// create an observer instance
this.observer=new ResizeObserver(function(e){requestAnimationFrame(_this24.resizeCheck.bind(_this24));});// pass in the target node
this.observer.observe(this.document.documentElement);}/**
			   * Use MutationObserver to listen for changes in the DOM and check for resize
			   * @private
			   */},{key:"mutationObservers",value:function mutationObservers(){var _this25=this;// create an observer instance
this.observer=new MutationObserver(function(mutations){_this25.resizeCheck();});// configuration of the observer:
var config={attributes:true,childList:true,characterData:true,subtree:true};// pass in the target node, as well as the observer options
this.observer.observe(this.document,config);}/**
			   * Test if images are loaded or add listener for when they load
			   * @private
			   */},{key:"imageLoadListeners",value:function imageLoadListeners(){var images=this.document.querySelectorAll("img");var img;for(var i=0;i<images.length;i++){img=images[i];if(typeof img.naturalWidth!=="undefined"&&img.naturalWidth===0){img.onload=this.expand.bind(this);}}}/**
			   * Listen for font load and check for resize when loaded
			   * @private
			   */},{key:"fontLoadListeners",value:function fontLoadListeners(){if(!this.document||!this.document.fonts){return;}this.document.fonts.ready.then(function(){this.resizeCheck();}.bind(this));}/**
			   * Get the documentElement
			   * @returns {element} documentElement
			   */},{key:"root",value:function root(){if(!this.document)return null;return this.document.documentElement;}/**
			   * Get the location offset of a EpubCFI or an #id
			   * @param {string | EpubCFI} target
			   * @param {string} [ignoreClass] for the cfi
			   * @returns { {left: Number, top: Number }
			   */},{key:"locationOf",value:function locationOf(target,ignoreClass){var position;var targetPos={"left":0,"top":0};if(!this.document)return targetPos;if(this.epubcfi.isCfiString(target)){var range=new _epubcfi$5.default(target).toRange(this.document,ignoreClass);if(range){try{if(!range.endContainer||range.startContainer==range.endContainer&&range.startOffset==range.endOffset){// If the end for the range is not set, it results in collapsed becoming
// true. This in turn leads to inconsistent behaviour when calling
// getBoundingRect. Wrong bounds lead to the wrong page being displayed.
// https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/15684911/
var pos=range.startContainer.textContent.indexOf(" ",range.startOffset);if(pos==-1){pos=range.startContainer.textContent.length;}range.setEnd(range.startContainer,pos);}}catch(e){console.error("setting end offset to start container length failed",e);}if(range.startContainer.nodeType===Node.ELEMENT_NODE){position=range.startContainer.getBoundingClientRect();targetPos.left=position.left;targetPos.top=position.top;}else{// Webkit does not handle collapsed range bounds correctly
// https://bugs.webkit.org/show_bug.cgi?id=138949
// Construct a new non-collapsed range
if(isWebkit){var _container2=range.startContainer;var newRange=new Range();try{if(_container2.nodeType===ELEMENT_NODE){position=_container2.getBoundingClientRect();}else if(range.startOffset+2<_container2.length){newRange.setStart(_container2,range.startOffset);newRange.setEnd(_container2,range.startOffset+2);position=newRange.getBoundingClientRect();}else if(range.startOffset-2>0){newRange.setStart(_container2,range.startOffset-2);newRange.setEnd(_container2,range.startOffset);position=newRange.getBoundingClientRect();}else{// empty, return the parent element
position=_container2.parentNode.getBoundingClientRect();}}catch(e){console.error(e,e.stack);}}else{position=range.getBoundingClientRect();}}}}else if(typeof target==="string"&&target.indexOf("#")>-1){var id=target.substring(target.indexOf("#")+1);var el=this.document.getElementById(id);if(el){if(isWebkit){// Webkit reports incorrect bounding rects in Columns
var _newRange=new Range();_newRange.selectNode(el);position=_newRange.getBoundingClientRect();}else{position=el.getBoundingClientRect();}}}if(position){targetPos.left=position.left;targetPos.top=position.top;}return targetPos;}/**
			   * Append a stylesheet link to the document head
			   * @param {string} src url
			   */},{key:"addStylesheet",value:function addStylesheet(src){return new Promise(function(resolve,reject){var $stylesheet;var ready=false;if(!this.document){resolve(false);return;}// Check if link already exists
$stylesheet=this.document.querySelector("link[href='"+src+"']");if($stylesheet){resolve(true);return;// already present
}$stylesheet=this.document.createElement("link");$stylesheet.type="text/css";$stylesheet.rel="stylesheet";$stylesheet.href=src;$stylesheet.onload=$stylesheet.onreadystatechange=function(){if(!ready&&(!this.readyState||this.readyState=="complete")){ready=true;// Let apply
setTimeout(function(){resolve(true);},1);}};this.document.head.appendChild($stylesheet);}.bind(this));}},{key:"_getStylesheetNode",value:function _getStylesheetNode(key){var styleEl;key="epubjs-inserted-css-"+(key||'');if(!this.document)return false;// Check if link already exists
styleEl=this.document.getElementById(key);if(!styleEl){styleEl=this.document.createElement("style");styleEl.id=key;// Append style element to head
this.document.head.appendChild(styleEl);}return styleEl;}/**
			   * Append stylesheet css
			   * @param {string} serializedCss
			   * @param {string} key If the key is the same, the CSS will be replaced instead of inserted
			   */},{key:"addStylesheetCss",value:function addStylesheetCss(serializedCss,key){if(!this.document||!serializedCss)return false;var styleEl;styleEl=this._getStylesheetNode(key);styleEl.innerHTML=serializedCss;return true;}/**
			   * Append stylesheet rules to a generate stylesheet
			   * Array: https://developer.mozilla.org/en-US/docs/Web/API/CSSStyleSheet/insertRule
			   * Object: https://github.com/desirable-objects/json-to-css
			   * @param {array | object} rules
			   * @param {string} key If the key is the same, the CSS will be replaced instead of inserted
			   */},{key:"addStylesheetRules",value:function addStylesheetRules(rules,key){var styleSheet;if(!this.document||!rules||rules.length===0)return;// Grab style sheet
styleSheet=this._getStylesheetNode(key).sheet;if(Object.prototype.toString.call(rules)==="[object Array]"){for(var i=0,rl=rules.length;i<rl;i++){var j=1,rule=rules[i],selector=rules[i][0],propStr="";// If the second argument of a rule is an array of arrays, correct our variables.
if(Object.prototype.toString.call(rule[1][0])==="[object Array]"){rule=rule[1];j=0;}for(var pl=rule.length;j<pl;j++){var prop=rule[j];propStr+=prop[0]+":"+prop[1]+(prop[2]?" !important":"")+";\n";}// Insert CSS Rule
styleSheet.insertRule(selector+"{"+propStr+"}",styleSheet.cssRules.length);}}else{var selectors=Object.keys(rules);selectors.forEach(function(selector){var definition=rules[selector];if(Array.isArray(definition)){definition.forEach(function(item){var _rules=Object.keys(item);var result=_rules.map(function(rule){return"".concat(rule,":").concat(item[rule]);}).join(';');styleSheet.insertRule("".concat(selector,"{").concat(result,"}"),styleSheet.cssRules.length);});}else{var _rules=Object.keys(definition);var result=_rules.map(function(rule){return"".concat(rule,":").concat(definition[rule]);}).join(';');styleSheet.insertRule("".concat(selector,"{").concat(result,"}"),styleSheet.cssRules.length);}});}}/**
			   * Append a script tag to the document head
			   * @param {string} src url
			   * @returns {Promise} loaded
			   */},{key:"addScript",value:function addScript(src){return new Promise(function(resolve,reject){var $script;var ready=false;if(!this.document){resolve(false);return;}$script=this.document.createElement("script");$script.type="text/javascript";$script.async=true;$script.src=src;$script.onload=$script.onreadystatechange=function(){if(!ready&&(!this.readyState||this.readyState=="complete")){ready=true;setTimeout(function(){resolve(true);},1);}};this.document.head.appendChild($script);}.bind(this));}/**
			   * Add a class to the contents container
			   * @param {string} className
			   */},{key:"addClass",value:function addClass(className){var content;if(!this.document)return;content=this.content||this.document.body;if(content){content.classList.add(className);}}/**
			   * Remove a class from the contents container
			   * @param {string} removeClass
			   */},{key:"removeClass",value:function removeClass(className){var content;if(!this.document)return;content=this.content||this.document.body;if(content){content.classList.remove(className);}}/**
			   * Add DOM event listeners
			   * @private
			   */},{key:"addEventListeners",value:function addEventListeners(){if(!this.document){return;}this._triggerEvent=this.triggerEvent.bind(this);_constants$8.DOM_EVENTS.forEach(function(eventName){this.document.addEventListener(eventName,this._triggerEvent,{passive:true});},this);}/**
			   * Remove DOM event listeners
			   * @private
			   */},{key:"removeEventListeners",value:function removeEventListeners(){if(!this.document){return;}_constants$8.DOM_EVENTS.forEach(function(eventName){this.document.removeEventListener(eventName,this._triggerEvent,{passive:true});},this);this._triggerEvent=undefined;}/**
			   * Emit passed browser events
			   * @private
			   */},{key:"triggerEvent",value:function triggerEvent(e){this.emit(e.type,e);}/**
			   * Add listener for text selection
			   * @private
			   */},{key:"addSelectionListeners",value:function addSelectionListeners(){if(!this.document){return;}this._onSelectionChange=this.onSelectionChange.bind(this);this.document.addEventListener("selectionchange",this._onSelectionChange,{passive:true});}/**
			   * Remove listener for text selection
			   * @private
			   */},{key:"removeSelectionListeners",value:function removeSelectionListeners(){if(!this.document){return;}this.document.removeEventListener("selectionchange",this._onSelectionChange,{passive:true});this._onSelectionChange=undefined;}/**
			   * Handle getting text on selection
			   * @private
			   */},{key:"onSelectionChange",value:function onSelectionChange(e){if(this.selectionEndTimeout){clearTimeout(this.selectionEndTimeout);}this.selectionEndTimeout=setTimeout(function(){var selection=this.window.getSelection();this.triggerSelectedEvent(selection);}.bind(this),250);}/**
			   * Emit event on text selection
			   * @private
			   */},{key:"triggerSelectedEvent",value:function triggerSelectedEvent(selection){var range,cfirange;if(selection&&selection.rangeCount>0){range=selection.getRangeAt(0);if(!range.collapsed){// cfirange = this.section.cfiFromRange(range);
cfirange=new _epubcfi$5.default(range,this.cfiBase).toString();this.emit(_constants$8.EVENTS.CONTENTS.SELECTED,cfirange);this.emit(_constants$8.EVENTS.CONTENTS.SELECTED_RANGE,range);}}}/**
			   * Get a Dom Range from EpubCFI
			   * @param {EpubCFI} _cfi
			   * @param {string} [ignoreClass]
			   * @returns {Range} range
			   */},{key:"range",value:function range(_cfi,ignoreClass){var cfi=new _epubcfi$5.default(_cfi);return cfi.toRange(this.document,ignoreClass);}/**
			   * Get an EpubCFI from a Dom Range
			   * @param {Range} range
			   * @param {string} [ignoreClass]
			   * @returns {EpubCFI} cfi
			   */},{key:"cfiFromRange",value:function cfiFromRange(range,ignoreClass){return new _epubcfi$5.default(range,this.cfiBase,ignoreClass).toString();}/**
			   * Get an EpubCFI from a Dom node
			   * @param {node} node
			   * @param {string} [ignoreClass]
			   * @returns {EpubCFI} cfi
			   */},{key:"cfiFromNode",value:function cfiFromNode(node,ignoreClass){return new _epubcfi$5.default(node,this.cfiBase,ignoreClass).toString();}// TODO: find where this is used - remove?
},{key:"map",value:function map(layout){var map=new _mapping$1.default(layout);return map.section();}/**
			   * Size the contents to a given width and height
			   * @param {number} [width]
			   * @param {number} [height]
			   */},{key:"size",value:function size(width,height){var viewport={scale:1.0,scalable:"no"};this.layoutStyle("scrolling");if(width>=0){this.width(width);viewport.width=width;this.css("padding","0 "+width/12+"px");}if(height>=0){this.height(height);viewport.height=height;}this.css("margin","0");this.css("box-sizing","border-box");this.viewport(viewport);}/**
			   * Apply columns to the contents for pagination
			   * @param {number} width
			   * @param {number} height
			   * @param {number} columnWidth
			   * @param {number} gap
			   */},{key:"columns",value:function columns(width,height,columnWidth,gap,dir){var COLUMN_AXIS=(0,_core$a.prefixed)("column-axis");var COLUMN_GAP=(0,_core$a.prefixed)("column-gap");var COLUMN_WIDTH=(0,_core$a.prefixed)("column-width");var COLUMN_FILL=(0,_core$a.prefixed)("column-fill");var writingMode=this.writingMode();var axis=writingMode.indexOf("vertical")===0?"vertical":"horizontal";this.layoutStyle("paginated");if(dir==="rtl"&&axis==="horizontal"){this.direction(dir);}this.width(width);this.height(height);// Deal with Mobile trying to scale to viewport
this.viewport({width:width,height:height,scale:1.0,scalable:"no"});// TODO: inline-block needs more testing
// Fixes Safari column cut offs, but causes RTL issues
// this.css("display", "inline-block");
this.css("overflow-y","hidden");this.css("margin","0",true);if(axis==="vertical"){this.css("padding-top",gap/2+"px",true);this.css("padding-bottom",gap/2+"px",true);this.css("padding-left","20px");this.css("padding-right","20px");this.css(COLUMN_AXIS,"vertical");}else{this.css("padding-top","20px");this.css("padding-bottom","20px");this.css("padding-left",gap/2+"px",true);this.css("padding-right",gap/2+"px",true);this.css(COLUMN_AXIS,"horizontal");}this.css("box-sizing","border-box");this.css("max-width","inherit");this.css(COLUMN_FILL,"auto");this.css(COLUMN_GAP,gap+"px");this.css(COLUMN_WIDTH,columnWidth+"px");// Fix glyph clipping in WebKit
// https://github.com/futurepress/epub.js/issues/983
this.css("-webkit-line-box-contain","block glyphs replaced");}/**
			   * Scale contents from center
			   * @param {number} scale
			   * @param {number} offsetX
			   * @param {number} offsetY
			   */},{key:"scaler",value:function scaler(scale,offsetX,offsetY){var scaleStr="scale("+scale+")";var translateStr="";// this.css("position", "absolute"));
this.css("transform-origin","top left");if(offsetX>=0||offsetY>=0){translateStr=" translate("+(offsetX||0)+"px, "+(offsetY||0)+"px )";}this.css("transform",scaleStr+translateStr);}/**
			   * Fit contents into a fixed width and height
			   * @param {number} width
			   * @param {number} height
			   */},{key:"fit",value:function fit(width,height,section){var viewport=this.viewport();var viewportWidth=parseInt(viewport.width);var viewportHeight=parseInt(viewport.height);var widthScale=width/viewportWidth;var heightScale=height/viewportHeight;var scale=widthScale<heightScale?widthScale:heightScale;// the translate does not work as intended, elements can end up unaligned
// var offsetY = (height - (viewportHeight * scale)) / 2;
// var offsetX = 0;
// if (this.sectionIndex % 2 === 1) {
// 	offsetX = width - (viewportWidth * scale);
// }
this.layoutStyle("paginated");// scale needs width and height to be set
this.width(viewportWidth);this.height(viewportHeight);this.overflow("hidden");// Scale to the correct size
this.scaler(scale,0,0);// this.scaler(scale, offsetX > 0 ? offsetX : 0, offsetY);
// background images are not scaled by transform
this.css("background-size",viewportWidth*scale+"px "+viewportHeight*scale+"px");this.css("background-color","transparent");if(section&&section.properties.includes("page-spread-left")){// set margin since scale is weird
var marginLeft=width-viewportWidth*scale;this.css("margin-left",marginLeft+"px");}}/**
			   * Set the direction of the text
			   * @param {string} [dir="ltr"] "rtl" | "ltr"
			   */},{key:"direction",value:function direction(dir){if(this.documentElement){this.documentElement.style["direction"]=dir;}}},{key:"mapPage",value:function mapPage(cfiBase,layout,start,end,dev){var mapping=new _mapping$1.default(layout,dev);return mapping.page(this,cfiBase,start,end);}/**
			   * Emit event when link in content is clicked
			   * @private
			   */},{key:"linksHandler",value:function linksHandler(){var _this26=this;(0,_replacements.replaceLinks)(this.content,function(href){_this26.emit(_constants$8.EVENTS.CONTENTS.LINK_CLICKED,href);});}/**
			   * Set the writingMode of the text
			   * @param {string} [mode="horizontal-tb"] "horizontal-tb" | "vertical-rl" | "vertical-lr"
			   */},{key:"writingMode",value:function writingMode(mode){var WRITING_MODE=(0,_core$a.prefixed)("writing-mode");if(mode&&this.documentElement){this.documentElement.style[WRITING_MODE]=mode;}return this.window.getComputedStyle(this.documentElement)[WRITING_MODE]||'';}/**
			   * Set the layoutStyle of the content
			   * @param {string} [style="paginated"] "scrolling" | "paginated"
			   * @private
			   */},{key:"layoutStyle",value:function layoutStyle(style){if(style){this._layoutStyle=style;navigator.epubReadingSystem.layoutStyle=this._layoutStyle;}return this._layoutStyle||"paginated";}/**
			   * Add the epubReadingSystem object to the navigator
			   * @param {string} name
			   * @param {string} version
			   * @private
			   */},{key:"epubReadingSystem",value:function epubReadingSystem(name,version){navigator.epubReadingSystem={name:name,version:version,layoutStyle:this.layoutStyle(),hasFeature:function hasFeature(feature){switch(feature){case"dom-manipulation":return true;case"layout-changes":return true;case"touch-events":return true;case"mouse-events":return true;case"keyboard-events":return true;case"spine-scripting":return false;default:return false;}}};return navigator.epubReadingSystem;}},{key:"destroy",value:function destroy(){// this.document.removeEventListener('transitionend', this._resizeCheck);
this.removeListeners();}}],[{key:"listenedEvents",get:function get(){return _constants$8.DOM_EVENTS;}}]);return Contents;}();(0,_eventEmitter$7.default)(Contents.prototype);var _default$i=Contents;contents.default=_default$i;var annotations={};Object.defineProperty(annotations,"__esModule",{value:true});annotations.default=void 0;var _eventEmitter$6=_interopRequireDefault$d(eventEmitter.exports);var _epubcfi$4=_interopRequireDefault$d(epubcfi);var _constants$7=constants;function _interopRequireDefault$d(obj){return obj&&obj.__esModule?obj:{default:obj};}/**
				* Handles managing adding & removing Annotations
				* @param {Rendition} rendition
				* @class
				*/var Annotations=/*#__PURE__*/function(){function Annotations(rendition){_classCallCheck3(this,Annotations);this.rendition=rendition;this.highlights=[];this.underlines=[];this.marks=[];this._annotations={};this._annotationsBySectionIndex={};this.rendition.hooks.render.register(this.inject.bind(this));this.rendition.hooks.unloaded.register(this.clear.bind(this));}/**
			   * Add an annotation to store
			   * @param {string} type Type of annotation to add: "highlight", "underline", "mark"
			   * @param {EpubCFI} cfiRange EpubCFI range to attach annotation to
			   * @param {object} data Data to assign to annotation
			   * @param {function} [cb] Callback after annotation is added
			   * @param {string} className CSS class to assign to annotation
			   * @param {object} styles CSS styles to assign to annotation
			   * @returns {Annotation} annotation
			   */_createClass3(Annotations,[{key:"add",value:function add(type,cfiRange,data,cb,className,styles){var hash=encodeURI(cfiRange+type);var cfi=new _epubcfi$4.default(cfiRange);var sectionIndex=cfi.spinePos;var annotation=new Annotation({type:type,cfiRange:cfiRange,data:data,sectionIndex:sectionIndex,cb:cb,className:className,styles:styles});this._annotations[hash]=annotation;if(sectionIndex in this._annotationsBySectionIndex){this._annotationsBySectionIndex[sectionIndex].push(hash);}else{this._annotationsBySectionIndex[sectionIndex]=[hash];}var views=this.rendition.views();views.forEach(function(view){if(annotation.sectionIndex===view.index){annotation.attach(view);}});return annotation;}/**
			   * Remove an annotation from store
			   * @param {EpubCFI} cfiRange EpubCFI range the annotation is attached to
			   * @param {string} type Type of annotation to add: "highlight", "underline", "mark"
			   */},{key:"remove",value:function remove(cfiRange,type){var _this27=this;var hash=encodeURI(cfiRange+type);if(hash in this._annotations){var annotation=this._annotations[hash];if(type&&annotation.type!==type){return;}var _views2=this.rendition.views();_views2.forEach(function(view){_this27._removeFromAnnotationBySectionIndex(annotation.sectionIndex,hash);if(annotation.sectionIndex===view.index){annotation.detach(view);}});delete this._annotations[hash];}}/**
			   * Remove an annotations by Section Index
			   * @private
			   */},{key:"_removeFromAnnotationBySectionIndex",value:function _removeFromAnnotationBySectionIndex(sectionIndex,hash){this._annotationsBySectionIndex[sectionIndex]=this._annotationsAt(sectionIndex).filter(function(h){return h!==hash;});}/**
			   * Get annotations by Section Index
			   * @private
			   */},{key:"_annotationsAt",value:function _annotationsAt(index){return this._annotationsBySectionIndex[index];}/**
			   * Add a highlight to the store
			   * @param {EpubCFI} cfiRange EpubCFI range to attach annotation to
			   * @param {object} data Data to assign to annotation
			   * @param {function} cb Callback after annotation is clicked
			   * @param {string} className CSS class to assign to annotation
			   * @param {object} styles CSS styles to assign to annotation
			   */},{key:"highlight",value:function highlight(cfiRange,data,cb,className,styles){return this.add("highlight",cfiRange,data,cb,className,styles);}/**
			   * Add a underline to the store
			   * @param {EpubCFI} cfiRange EpubCFI range to attach annotation to
			   * @param {object} data Data to assign to annotation
			   * @param {function} cb Callback after annotation is clicked
			   * @param {string} className CSS class to assign to annotation
			   * @param {object} styles CSS styles to assign to annotation
			   */},{key:"underline",value:function underline(cfiRange,data,cb,className,styles){return this.add("underline",cfiRange,data,cb,className,styles);}/**
			   * Add a mark to the store
			   * @param {EpubCFI} cfiRange EpubCFI range to attach annotation to
			   * @param {object} data Data to assign to annotation
			   * @param {function} cb Callback after annotation is clicked
			   */},{key:"mark",value:function mark(cfiRange,data,cb){return this.add("mark",cfiRange,data,cb);}/**
			   * iterate over annotations in the store
			   */},{key:"each",value:function each(){return this._annotations.forEach.apply(this._annotations,arguments);}/**
			   * Hook for injecting annotation into a view
			   * @param {View} view
			   * @private
			   */},{key:"inject",value:function inject(view){var _this28=this;var sectionIndex=view.index;if(sectionIndex in this._annotationsBySectionIndex){var _annotations2=this._annotationsBySectionIndex[sectionIndex];_annotations2.forEach(function(hash){var annotation=_this28._annotations[hash];annotation.attach(view);});}}/**
			   * Hook for removing annotation from a view
			   * @param {View} view
			   * @private
			   */},{key:"clear",value:function clear(view){var _this29=this;var sectionIndex=view.index;if(sectionIndex in this._annotationsBySectionIndex){var _annotations3=this._annotationsBySectionIndex[sectionIndex];_annotations3.forEach(function(hash){var annotation=_this29._annotations[hash];annotation.detach(view);});}}/**
			   * [Not Implemented] Show annotations
			   * @TODO: needs implementation in View
			   */},{key:"show",value:function show(){}/**
			   * [Not Implemented] Hide annotations
			   * @TODO: needs implementation in View
			   */},{key:"hide",value:function hide(){}}]);return Annotations;}();/**
			 * Annotation object
			 * @class
			 * @param {object} options
			 * @param {string} options.type Type of annotation to add: "highlight", "underline", "mark"
			 * @param {EpubCFI} options.cfiRange EpubCFI range to attach annotation to
			 * @param {object} options.data Data to assign to annotation
			 * @param {int} options.sectionIndex Index in the Spine of the Section annotation belongs to
			 * @param {function} [options.cb] Callback after annotation is clicked
			 * @param {string} className CSS class to assign to annotation
			 * @param {object} styles CSS styles to assign to annotation
			 * @returns {Annotation} annotation
			 */var Annotation=/*#__PURE__*/function(){function Annotation(_ref18){var type=_ref18.type,cfiRange=_ref18.cfiRange,data=_ref18.data,sectionIndex=_ref18.sectionIndex,cb=_ref18.cb,className=_ref18.className,styles=_ref18.styles;_classCallCheck3(this,Annotation);this.type=type;this.cfiRange=cfiRange;this.data=data;this.sectionIndex=sectionIndex;this.mark=undefined;this.cb=cb;this.className=className;this.styles=styles;}/**
			   * Update stored data
			   * @param {object} data
			   */_createClass3(Annotation,[{key:"update",value:function update(data){this.data=data;}/**
			   * Add to a view
			   * @param {View} view
			   */},{key:"attach",value:function attach(view){var cfiRange=this.cfiRange,data=this.data,type=this.type,mark=this.mark,cb=this.cb,className=this.className,styles=this.styles;var result;if(type==="highlight"){result=view.highlight(cfiRange,data,cb,className,styles);}else if(type==="underline"){result=view.underline(cfiRange,data,cb,className,styles);}else if(type==="mark"){result=view.mark(cfiRange,data,cb);}this.mark=result;this.emit(_constants$7.EVENTS.ANNOTATION.ATTACH,result);return result;}/**
			   * Remove from a view
			   * @param {View} view
			   */},{key:"detach",value:function detach(view){var cfiRange=this.cfiRange,type=this.type;var result;if(view){if(type==="highlight"){result=view.unhighlight(cfiRange);}else if(type==="underline"){result=view.ununderline(cfiRange);}else if(type==="mark"){result=view.unmark(cfiRange);}}this.mark=undefined;this.emit(_constants$7.EVENTS.ANNOTATION.DETACH,result);return result;}/**
			   * [Not Implemented] Get text of an annotation
			   * @TODO: needs implementation in contents
			   */},{key:"text",value:function text(){}}]);return Annotation;}();(0,_eventEmitter$6.default)(Annotation.prototype);var _default$h=Annotations;annotations.default=_default$h;var iframe={};var marks={};var svg={};Object.defineProperty(svg,"__esModule",{value:true});svg.createElement=createElement;function createElement(name){return document.createElementNS('http://www.w3.org/2000/svg',name);}svg.default={createElement:createElement};var events={};Object.defineProperty(events,"__esModule",{value:true});events.proxyMouse=proxyMouse;events.clone=clone;// import 'babelify/polyfill'; // needed for Object.assign
events.default={proxyMouse:proxyMouse};/**
			 * Start proxying all mouse events that occur on the target node to each node in
			 * a set of tracked nodes.
			 *
			 * The items in tracked do not strictly have to be DOM Nodes, but they do have
			 * to have dispatchEvent, getBoundingClientRect, and getClientRects methods.
			 *
			 * @param target {Node} The node on which to listen for mouse events.
			 * @param tracked {Node[]} A (possibly mutable) array of nodes to which to proxy
			 *                         events.
			 */function proxyMouse(target,tracked){function dispatch(e){// We walk through the set of tracked elements in reverse order so that
// events are sent to those most recently added first.
//
// This is the least surprising behaviour as it simulates the way the
// browser would work if items added later were drawn "on top of"
// earlier ones.
for(var i=tracked.length-1;i>=0;i--){var t=tracked[i];var x=e.clientX;var y=e.clientY;if(e.touches&&e.touches.length){x=e.touches[0].clientX;y=e.touches[0].clientY;}if(!contains$1(t,target,x,y)){continue;}// The event targets this mark, so dispatch a cloned event:
t.dispatchEvent(clone(e));// We only dispatch the cloned event to the first matching mark.
break;}}if(target.nodeName==="iframe"||target.nodeName==="IFRAME"){try{// Try to get the contents if same domain
this.target=target.contentDocument;}catch(err){this.target=target;}}else{this.target=target;}var _arr=['mouseup','mousedown','click','touchstart'];for(var _i=0;_i<_arr.length;_i++){var ev=_arr[_i];this.target.addEventListener(ev,function(e){return dispatch(e);},false);}}/**
			 * Clone a mouse event object.
			 *
			 * @param e {MouseEvent} A mouse event object to clone.
			 * @returns {MouseEvent}
			 */function clone(e){var opts=Object.assign({},e,{bubbles:false});try{return new MouseEvent(e.type,opts);}catch(err){// compat: webkit
var copy=document.createEvent('MouseEvents');copy.initMouseEvent(e.type,false,opts.cancelable,opts.view,opts.detail,opts.screenX,opts.screenY,opts.clientX,opts.clientY,opts.ctrlKey,opts.altKey,opts.shiftKey,opts.metaKey,opts.button,opts.relatedTarget);return copy;}}/**
			 * Check if the item contains the point denoted by the passed coordinates
			 * @param item {Object} An object with getBoundingClientRect and getClientRects
			 *                      methods.
			 * @param x {Number}
			 * @param y {Number}
			 * @returns {Boolean}
			 */function contains$1(item,target,x,y){// offset
var offset=target.getBoundingClientRect();function rectContains(r,x,y){var top=r.top-offset.top;var left=r.left-offset.left;var bottom=top+r.height;var right=left+r.width;return top<=y&&left<=x&&bottom>y&&right>x;}// Check overall bounding box first
var rect=item.getBoundingClientRect();if(!rectContains(rect,x,y)){return false;}// Then continue to check each child rect
var rects=item.getClientRects();for(var i=0,len=rects.length;i<len;i++){if(rectContains(rects[i],x,y)){return true;}}return false;}Object.defineProperty(marks,"__esModule",{value:true});marks.Underline=marks.Highlight=marks.Mark=marks.Pane=undefined;var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};var _createClass$2=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _svg=svg;var _svg2=_interopRequireDefault$c(_svg);var _events=events;var _events2=_interopRequireDefault$c(_events);function _interopRequireDefault$c(obj){return obj&&obj.__esModule?obj:{default:obj};}function _possibleConstructorReturn$2(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(_typeof3(call)==="object"||typeof call==="function")?call:self;}function _inherits$2(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+_typeof3(superClass));}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}function _classCallCheck$2(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}marks.Pane=function(){function Pane(target){var container=arguments.length>1&&arguments[1]!==undefined?arguments[1]:document.body;_classCallCheck$2(this,Pane);this.target=target;this.element=_svg2.default.createElement('svg');this.marks=[];// Match the coordinates of the target element
this.element.style.position='absolute';// Disable pointer events
this.element.setAttribute('pointer-events','none');// Set up mouse event proxying between the target element and the marks
_events2.default.proxyMouse(this.target,this.marks);this.container=container;this.container.appendChild(this.element);this.render();}_createClass$2(Pane,[{key:'addMark',value:function addMark(mark){var g=_svg2.default.createElement('g');this.element.appendChild(g);mark.bind(g,this.container);this.marks.push(mark);mark.render();return mark;}},{key:'removeMark',value:function removeMark(mark){var idx=this.marks.indexOf(mark);if(idx===-1){return;}var el=mark.unbind();this.element.removeChild(el);this.marks.splice(idx,1);}},{key:'render',value:function render(){setCoords(this.element,coords(this.target,this.container));var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.marks[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var m=_step.value;m.render();}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}}}]);return Pane;}();var Mark=marks.Mark=function(){function Mark(){_classCallCheck$2(this,Mark);this.element=null;}_createClass$2(Mark,[{key:'bind',value:function bind(element,container){this.element=element;this.container=container;}},{key:'unbind',value:function unbind(){var el=this.element;this.element=null;return el;}},{key:'render',value:function render(){}},{key:'dispatchEvent',value:function dispatchEvent(e){if(!this.element)return;this.element.dispatchEvent(e);}},{key:'getBoundingClientRect',value:function getBoundingClientRect(){return this.element.getBoundingClientRect();}},{key:'getClientRects',value:function getClientRects(){var rects=[];var el=this.element.firstChild;while(el){rects.push(el.getBoundingClientRect());el=el.nextSibling;}return rects;}},{key:'filteredRanges',value:function filteredRanges(){var rects=Array.from(this.range.getClientRects());// De-duplicate the boxes
return rects.filter(function(box){for(var i=0;i<rects.length;i++){if(rects[i]===box){return true;}var contained=contains(rects[i],box);if(contained){return false;}}return true;});}}]);return Mark;}();var Highlight=marks.Highlight=function(_Mark){_inherits$2(Highlight,_Mark);function Highlight(range,className,data,attributes){_classCallCheck$2(this,Highlight);var _this=_possibleConstructorReturn$2(this,(Highlight.__proto__||Object.getPrototypeOf(Highlight)).call(this));_this.range=range;_this.className=className;_this.data=data||{};_this.attributes=attributes||{};return _this;}_createClass$2(Highlight,[{key:'bind',value:function bind(element,container){_get(Highlight.prototype.__proto__||Object.getPrototypeOf(Highlight.prototype),'bind',this).call(this,element,container);for(var attr in this.data){if(this.data.hasOwnProperty(attr)){this.element.dataset[attr]=this.data[attr];}}for(var attr in this.attributes){if(this.attributes.hasOwnProperty(attr)){this.element.setAttribute(attr,this.attributes[attr]);}}if(this.className){this.element.classList.add(this.className);}}},{key:'render',value:function render(){// Empty element
while(this.element.firstChild){this.element.removeChild(this.element.firstChild);}var docFrag=this.element.ownerDocument.createDocumentFragment();var filtered=this.filteredRanges();var offset=this.element.getBoundingClientRect();var container=this.container.getBoundingClientRect();for(var i=0,len=filtered.length;i<len;i++){var r=filtered[i];var el=_svg2.default.createElement('rect');el.setAttribute('x',r.left-offset.left+container.left);el.setAttribute('y',r.top-offset.top+container.top);el.setAttribute('height',r.height);el.setAttribute('width',r.width);docFrag.appendChild(el);}this.element.appendChild(docFrag);}}]);return Highlight;}(Mark);marks.Underline=function(_Highlight){_inherits$2(Underline,_Highlight);function Underline(range,className,data,attributes){_classCallCheck$2(this,Underline);return _possibleConstructorReturn$2(this,(Underline.__proto__||Object.getPrototypeOf(Underline)).call(this,range,className,data,attributes));}_createClass$2(Underline,[{key:'render',value:function render(){// Empty element
while(this.element.firstChild){this.element.removeChild(this.element.firstChild);}var docFrag=this.element.ownerDocument.createDocumentFragment();var filtered=this.filteredRanges();var offset=this.element.getBoundingClientRect();var container=this.container.getBoundingClientRect();for(var i=0,len=filtered.length;i<len;i++){var r=filtered[i];var rect=_svg2.default.createElement('rect');rect.setAttribute('x',r.left-offset.left+container.left);rect.setAttribute('y',r.top-offset.top+container.top);rect.setAttribute('height',r.height);rect.setAttribute('width',r.width);rect.setAttribute('fill','none');var line=_svg2.default.createElement('line');line.setAttribute('x1',r.left-offset.left+container.left);line.setAttribute('x2',r.left-offset.left+container.left+r.width);line.setAttribute('y1',r.top-offset.top+container.top+r.height-1);line.setAttribute('y2',r.top-offset.top+container.top+r.height-1);line.setAttribute('stroke-width',1);line.setAttribute('stroke','black');//TODO: match text color?
line.setAttribute('stroke-linecap','square');docFrag.appendChild(rect);docFrag.appendChild(line);}this.element.appendChild(docFrag);}}]);return Underline;}(Highlight);function coords(el,container){var offset=container.getBoundingClientRect();var rect=el.getBoundingClientRect();return{top:rect.top-offset.top,left:rect.left-offset.left,height:el.scrollHeight,width:el.scrollWidth};}function setCoords(el,coords){el.style.setProperty('top',coords.top+'px','important');el.style.setProperty('left',coords.left+'px','important');el.style.setProperty('height',coords.height+'px','important');el.style.setProperty('width',coords.width+'px','important');}function contains(rect1,rect2){return rect2.right<=rect1.right&&rect2.left>=rect1.left&&rect2.top>=rect1.top&&rect2.bottom<=rect1.bottom;}Object.defineProperty(iframe,"__esModule",{value:true});iframe.default=void 0;var _eventEmitter$5=_interopRequireDefault$b(eventEmitter.exports);var _core$9=core;var _epubcfi$3=_interopRequireDefault$b(epubcfi);var _contents$1=_interopRequireDefault$b(contents);var _constants$6=constants;var _marksPane=marks;function _interopRequireDefault$b(obj){return obj&&obj.__esModule?obj:{default:obj};}var IframeView=/*#__PURE__*/function(){function IframeView(section,options){_classCallCheck3(this,IframeView);this.settings=(0,_core$9.extend)({ignoreClass:"",axis:undefined,//options.layout && options.layout.props.flow === "scrolled" ? "vertical" : "horizontal",
direction:undefined,width:0,height:0,layout:undefined,globalLayoutProperties:{},method:undefined,forceRight:false,allowScriptedContent:false,allowPopups:false},options||{});this.id="epubjs-view-"+(0,_core$9.uuid)();this.section=section;this.index=section.index;this.element=this.container(this.settings.axis);this.added=false;this.displayed=false;this.rendered=false;// this.width  = this.settings.width;
// this.height = this.settings.height;
this.fixedWidth=0;this.fixedHeight=0;// Blank Cfi for Parsing
this.epubcfi=new _epubcfi$3.default();this.layout=this.settings.layout;// Dom events to listen for
// this.listenedEvents = ["keydown", "keyup", "keypressed", "mouseup", "mousedown", "click", "touchend", "touchstart"];
this.pane=undefined;this.highlights={};this.underlines={};this.marks={};}_createClass3(IframeView,[{key:"container",value:function container(axis){var element=document.createElement("div");element.classList.add("epub-view");// this.element.style.minHeight = "100px";
element.style.height="0px";element.style.width="0px";element.style.overflow="hidden";element.style.position="relative";element.style.display="block";if(axis&&axis=="horizontal"){element.style.flex="none";}else{element.style.flex="initial";}return element;}},{key:"create",value:function create(){if(this.iframe){return this.iframe;}if(!this.element){this.element=this.createContainer();}this.iframe=document.createElement("iframe");this.iframe.id=this.id;this.iframe.scrolling="no";// Might need to be removed: breaks ios width calculations
this.iframe.style.overflow="hidden";this.iframe.seamless="seamless";// Back up if seamless isn't supported
this.iframe.style.border="none";// sandbox
this.iframe.sandbox="allow-same-origin";if(this.settings.allowScriptedContent){this.iframe.sandbox+=" allow-scripts";}if(this.settings.allowPopups){this.iframe.sandbox+=" allow-popups";}this.iframe.setAttribute("enable-annotation","true");this.resizing=true;// this.iframe.style.display = "none";
this.element.style.visibility="hidden";this.iframe.style.visibility="hidden";this.iframe.style.width="0";this.iframe.style.height="0";this._width=0;this._height=0;this.element.setAttribute("ref",this.index);this.added=true;this.elementBounds=(0,_core$9.bounds)(this.element);// if(width || height){
//   this.resize(width, height);
// } else if(this.width && this.height){
//   this.resize(this.width, this.height);
// } else {
//   this.iframeBounds = bounds(this.iframe);
// }
if("srcdoc"in this.iframe){this.supportsSrcdoc=true;}else{this.supportsSrcdoc=false;}if(!this.settings.method){this.settings.method=this.supportsSrcdoc?"srcdoc":"write";}return this.iframe;}},{key:"render",value:function render(request,show){// view.onLayout = this.layout.format.bind(this.layout);
this.create();// Fit to size of the container, apply padding
this.size();if(!this.sectionRender){this.sectionRender=this.section.render(request);}// Render Chain
return this.sectionRender.then(function(contents){return this.load(contents);}.bind(this)).then(function(){var _this30=this;// find and report the writingMode axis
var writingMode=this.contents.writingMode();// Set the axis based on the flow and writing mode
var axis;if(this.settings.flow==="scrolled"){axis=writingMode.indexOf("vertical")===0?"horizontal":"vertical";}else{axis=writingMode.indexOf("vertical")===0?"vertical":"horizontal";}if(writingMode.indexOf("vertical")===0&&this.settings.flow==="paginated"){this.layout.delta=this.layout.height;}this.setAxis(axis);this.emit(_constants$6.EVENTS.VIEWS.AXIS,axis);this.setWritingMode(writingMode);this.emit(_constants$6.EVENTS.VIEWS.WRITING_MODE,writingMode);// apply the layout function to the contents
this.layout.format(this.contents,this.section,this.axis);// Listen for events that require an expansion of the iframe
this.addListeners();return new Promise(function(resolve,reject){// Expand the iframe to the full size of the content
_this30.expand();if(_this30.settings.forceRight){_this30.element.style.marginLeft=_this30.width()+"px";}resolve();});}.bind(this),function(e){this.emit(_constants$6.EVENTS.VIEWS.LOAD_ERROR,e);return new Promise(function(resolve,reject){reject(e);});}.bind(this)).then(function(){this.emit(_constants$6.EVENTS.VIEWS.RENDERED,this.section);}.bind(this));}},{key:"reset",value:function reset(){if(this.iframe){this.iframe.style.width="0";this.iframe.style.height="0";this._width=0;this._height=0;this._textWidth=undefined;this._contentWidth=undefined;this._textHeight=undefined;this._contentHeight=undefined;}this._needsReframe=true;}// Determine locks base on settings
},{key:"size",value:function size(_width,_height){var width=_width||this.settings.width;var height=_height||this.settings.height;if(this.layout.name==="pre-paginated"){this.lock("both",width,height);}else if(this.settings.axis==="horizontal"){this.lock("height",width,height);}else{this.lock("width",width,height);}this.settings.width=width;this.settings.height=height;}// Lock an axis to element dimensions, taking borders into account
},{key:"lock",value:function lock(what,width,height){var elBorders=(0,_core$9.borders)(this.element);var iframeBorders;if(this.iframe){iframeBorders=(0,_core$9.borders)(this.iframe);}else{iframeBorders={width:0,height:0};}if(what=="width"&&(0,_core$9.isNumber)(width)){this.lockedWidth=width-elBorders.width-iframeBorders.width;// this.resize(this.lockedWidth, width); //  width keeps ratio correct
}if(what=="height"&&(0,_core$9.isNumber)(height)){this.lockedHeight=height-elBorders.height-iframeBorders.height;// this.resize(width, this.lockedHeight);
}if(what==="both"&&(0,_core$9.isNumber)(width)&&(0,_core$9.isNumber)(height)){this.lockedWidth=width-elBorders.width-iframeBorders.width;this.lockedHeight=height-elBorders.height-iframeBorders.height;// this.resize(this.lockedWidth, this.lockedHeight);
}if(this.displayed&&this.iframe){// this.contents.layout();
this.expand();}}// Resize a single axis based on content dimensions
},{key:"expand",value:function expand(force){var width=this.lockedWidth;var height=this.lockedHeight;var columns;if(!this.iframe||this._expanding)return;this._expanding=true;if(this.layout.name==="pre-paginated"){width=this.layout.columnWidth;height=this.layout.height;}// Expand Horizontally
else if(this.settings.axis==="horizontal"){// Get the width of the text
width=this.contents.textWidth();if(width%this.layout.pageWidth>0){width=Math.ceil(width/this.layout.pageWidth)*this.layout.pageWidth;}if(this.settings.forceEvenPages){columns=width/this.layout.pageWidth;if(this.layout.divisor>1&&this.layout.name==="reflowable"&&columns%2>0){// add a blank page
width+=this.layout.pageWidth;}}}// Expand Vertically
else if(this.settings.axis==="vertical"){height=this.contents.textHeight();if(this.settings.flow==="paginated"&&height%this.layout.height>0){height=Math.ceil(height/this.layout.height)*this.layout.height;}}// Only Resize if dimensions have changed or
// if Frame is still hidden, so needs reframing
if(this._needsReframe||width!=this._width||height!=this._height){this.reframe(width,height);}this._expanding=false;}},{key:"reframe",value:function reframe(width,height){var _this31=this;var size;if((0,_core$9.isNumber)(width)){this.element.style.width=width+"px";this.iframe.style.width=width+"px";this._width=width;}if((0,_core$9.isNumber)(height)){this.element.style.height=height+"px";this.iframe.style.height=height+"px";this._height=height;}var widthDelta=this.prevBounds?width-this.prevBounds.width:width;var heightDelta=this.prevBounds?height-this.prevBounds.height:height;size={width:width,height:height,widthDelta:widthDelta,heightDelta:heightDelta};this.pane&&this.pane.render();requestAnimationFrame(function(){var mark;for(var m in _this31.marks){if(_this31.marks.hasOwnProperty(m)){mark=_this31.marks[m];_this31.placeMark(mark.element,mark.range);}}});this.onResize(this,size);this.emit(_constants$6.EVENTS.VIEWS.RESIZED,size);this.prevBounds=size;this.elementBounds=(0,_core$9.bounds)(this.element);}},{key:"load",value:function load(contents){var loading=new _core$9.defer();var loaded=loading.promise;if(!this.iframe){loading.reject(new Error("No Iframe Available"));return loaded;}this.iframe.onload=function(event){this.onLoad(event,loading);}.bind(this);if(this.settings.method==="blobUrl"){this.blobUrl=(0,_core$9.createBlobUrl)(contents,"application/xhtml+xml");this.iframe.src=this.blobUrl;this.element.appendChild(this.iframe);}else if(this.settings.method==="srcdoc"){this.iframe.srcdoc=contents;this.element.appendChild(this.iframe);}else{this.element.appendChild(this.iframe);this.document=this.iframe.contentDocument;if(!this.document){loading.reject(new Error("No Document Available"));return loaded;}this.iframe.contentDocument.open();// For Cordova windows platform
if(window.MSApp&&MSApp.execUnsafeLocalFunction){var outerThis=this;MSApp.execUnsafeLocalFunction(function(){outerThis.iframe.contentDocument.write(contents);});}else{this.iframe.contentDocument.write(contents);}this.iframe.contentDocument.close();}return loaded;}},{key:"onLoad",value:function onLoad(event,promise){var _this32=this;this.window=this.iframe.contentWindow;this.document=this.iframe.contentDocument;this.contents=new _contents$1.default(this.document,this.document.body,this.section.cfiBase,this.section.index);this.rendering=false;var link=this.document.querySelector("link[rel='canonical']");if(link){link.setAttribute("href",this.section.canonical);}else{link=this.document.createElement("link");link.setAttribute("rel","canonical");link.setAttribute("href",this.section.canonical);this.document.querySelector("head").appendChild(link);}this.contents.on(_constants$6.EVENTS.CONTENTS.EXPAND,function(){if(_this32.displayed&&_this32.iframe){_this32.expand();if(_this32.contents){_this32.layout.format(_this32.contents);}}});this.contents.on(_constants$6.EVENTS.CONTENTS.RESIZE,function(e){if(_this32.displayed&&_this32.iframe){_this32.expand();if(_this32.contents){_this32.layout.format(_this32.contents);}}});promise.resolve(this.contents);}},{key:"setLayout",value:function setLayout(layout){this.layout=layout;if(this.contents){this.layout.format(this.contents);this.expand();}}},{key:"setAxis",value:function setAxis(axis){this.settings.axis=axis;if(axis=="horizontal"){this.element.style.flex="none";}else{this.element.style.flex="initial";}this.size();}},{key:"setWritingMode",value:function setWritingMode(mode){// this.element.style.writingMode = writingMode;
this.writingMode=mode;}},{key:"addListeners",value:function addListeners(){//TODO: Add content listeners for expanding
}},{key:"removeListeners",value:function removeListeners(layoutFunc){//TODO: remove content listeners for expanding
}},{key:"display",value:function display(request){var displayed=new _core$9.defer();if(!this.displayed){this.render(request).then(function(){this.emit(_constants$6.EVENTS.VIEWS.DISPLAYED,this);this.onDisplayed(this);this.displayed=true;displayed.resolve(this);}.bind(this),function(err){displayed.reject(err,this);});}else{displayed.resolve(this);}return displayed.promise;}},{key:"show",value:function show(){this.element.style.visibility="visible";if(this.iframe){this.iframe.style.visibility="visible";// Remind Safari to redraw the iframe
this.iframe.style.transform="translateZ(0)";this.iframe.offsetWidth;this.iframe.style.transform=null;}this.emit(_constants$6.EVENTS.VIEWS.SHOWN,this);}},{key:"hide",value:function hide(){// this.iframe.style.display = "none";
this.element.style.visibility="hidden";this.iframe.style.visibility="hidden";this.stopExpanding=true;this.emit(_constants$6.EVENTS.VIEWS.HIDDEN,this);}},{key:"offset",value:function offset(){return{top:this.element.offsetTop,left:this.element.offsetLeft};}},{key:"width",value:function width(){return this._width;}},{key:"height",value:function height(){return this._height;}},{key:"position",value:function position(){return this.element.getBoundingClientRect();}},{key:"locationOf",value:function locationOf(target){this.iframe.getBoundingClientRect();var targetPos=this.contents.locationOf(target,this.settings.ignoreClass);return{"left":targetPos.left,"top":targetPos.top};}},{key:"onDisplayed",value:function onDisplayed(view){// Stub, override with a custom functions
}},{key:"onResize",value:function onResize(view,e){// Stub, override with a custom functions
}},{key:"bounds",value:function bounds(force){if(force||!this.elementBounds){this.elementBounds=(0,_core$9.bounds)(this.element);}return this.elementBounds;}},{key:"highlight",value:function highlight(cfiRange){var _this33=this;var data=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var cb=arguments.length>2?arguments[2]:undefined;var className=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"epubjs-hl";var styles=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};if(!this.contents){return;}var attributes=Object.assign({"fill":"yellow","fill-opacity":"0.3","mix-blend-mode":"multiply"},styles);var range=this.contents.range(cfiRange);var emitter=function emitter(){_this33.emit(_constants$6.EVENTS.VIEWS.MARK_CLICKED,cfiRange,data);};data["epubcfi"]=cfiRange;if(!this.pane){this.pane=new _marksPane.Pane(this.iframe,this.element);}var m=new _marksPane.Highlight(range,className,data,attributes);var h=this.pane.addMark(m);this.highlights[cfiRange]={"mark":h,"element":h.element,"listeners":[emitter,cb]};h.element.setAttribute("ref",className);h.element.addEventListener("click",emitter);h.element.addEventListener("touchstart",emitter);if(cb){h.element.addEventListener("click",cb);h.element.addEventListener("touchstart",cb);}return h;}},{key:"underline",value:function underline(cfiRange){var _this34=this;var data=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var cb=arguments.length>2?arguments[2]:undefined;var className=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"epubjs-ul";var styles=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};if(!this.contents){return;}var attributes=Object.assign({"stroke":"black","stroke-opacity":"0.3","mix-blend-mode":"multiply"},styles);var range=this.contents.range(cfiRange);var emitter=function emitter(){_this34.emit(_constants$6.EVENTS.VIEWS.MARK_CLICKED,cfiRange,data);};data["epubcfi"]=cfiRange;if(!this.pane){this.pane=new _marksPane.Pane(this.iframe,this.element);}var m=new _marksPane.Underline(range,className,data,attributes);var h=this.pane.addMark(m);this.underlines[cfiRange]={"mark":h,"element":h.element,"listeners":[emitter,cb]};h.element.setAttribute("ref",className);h.element.addEventListener("click",emitter);h.element.addEventListener("touchstart",emitter);if(cb){h.element.addEventListener("click",cb);h.element.addEventListener("touchstart",cb);}return h;}},{key:"mark",value:function mark(cfiRange){var _this35=this;var data=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var cb=arguments.length>2?arguments[2]:undefined;if(!this.contents){return;}if(cfiRange in this.marks){var item=this.marks[cfiRange];return item;}var range=this.contents.range(cfiRange);if(!range){return;}var container=range.commonAncestorContainer;var parent=container.nodeType===1?container:container.parentNode;var emitter=function emitter(e){_this35.emit(_constants$6.EVENTS.VIEWS.MARK_CLICKED,cfiRange,data);};if(range.collapsed&&container.nodeType===1){range=new Range();range.selectNodeContents(container);}else if(range.collapsed){// Webkit doesn't like collapsed ranges
range=new Range();range.selectNodeContents(parent);}var mark=this.document.createElement("a");mark.setAttribute("ref","epubjs-mk");mark.style.position="absolute";mark.dataset["epubcfi"]=cfiRange;if(data){Object.keys(data).forEach(function(key){mark.dataset[key]=data[key];});}if(cb){mark.addEventListener("click",cb);mark.addEventListener("touchstart",cb);}mark.addEventListener("click",emitter);mark.addEventListener("touchstart",emitter);this.placeMark(mark,range);this.element.appendChild(mark);this.marks[cfiRange]={"element":mark,"range":range,"listeners":[emitter,cb]};return parent;}},{key:"placeMark",value:function placeMark(element,range){var top,right,left;if(this.layout.name==="pre-paginated"||this.settings.axis!=="horizontal"){var pos=range.getBoundingClientRect();top=pos.top;right=pos.right;}else{// Element might break columns, so find the left most element
var rects=range.getClientRects();var rect;for(var i=0;i!=rects.length;i++){rect=rects[i];if(!left||rect.left<left){left=rect.left;// right = rect.right;
right=Math.ceil(left/this.layout.props.pageWidth)*this.layout.props.pageWidth-this.layout.gap/2;top=rect.top;}}}element.style.top="".concat(top,"px");element.style.left="".concat(right,"px");}},{key:"unhighlight",value:function unhighlight(cfiRange){var item;if(cfiRange in this.highlights){item=this.highlights[cfiRange];this.pane.removeMark(item.mark);item.listeners.forEach(function(l){if(l){item.element.removeEventListener("click",l);item.element.removeEventListener("touchstart",l);}});delete this.highlights[cfiRange];}}},{key:"ununderline",value:function ununderline(cfiRange){var item;if(cfiRange in this.underlines){item=this.underlines[cfiRange];this.pane.removeMark(item.mark);item.listeners.forEach(function(l){if(l){item.element.removeEventListener("click",l);item.element.removeEventListener("touchstart",l);}});delete this.underlines[cfiRange];}}},{key:"unmark",value:function unmark(cfiRange){var item;if(cfiRange in this.marks){item=this.marks[cfiRange];this.element.removeChild(item.element);item.listeners.forEach(function(l){if(l){item.element.removeEventListener("click",l);item.element.removeEventListener("touchstart",l);}});delete this.marks[cfiRange];}}},{key:"destroy",value:function destroy(){for(var cfiRange in this.highlights){this.unhighlight(cfiRange);}for(var _cfiRange in this.underlines){this.ununderline(_cfiRange);}for(var _cfiRange2 in this.marks){this.unmark(_cfiRange2);}if(this.blobUrl){(0,_core$9.revokeBlobUrl)(this.blobUrl);}if(this.displayed){this.displayed=false;this.removeListeners();this.contents.destroy();this.stopExpanding=true;this.element.removeChild(this.iframe);if(this.pane){this.pane.element.remove();this.pane=undefined;}this.iframe=undefined;this.contents=undefined;this._textWidth=null;this._textHeight=null;this._width=null;this._height=null;}// this.element.style.height = "0px";
// this.element.style.width = "0px";
}}]);return IframeView;}();(0,_eventEmitter$5.default)(IframeView.prototype);var _default$g=IframeView;iframe.default=_default$g;var _default$f={};var scrolltype={};Object.defineProperty(scrolltype,"__esModule",{value:true});scrolltype.createDefiner=createDefiner;scrolltype.default=scrollType;// Detect RTL scroll type
// Based on https://github.com/othree/jquery.rtl-scroll-type/blob/master/src/jquery.rtl-scroll.js
function scrollType(){var type="reverse";var definer=createDefiner();document.body.appendChild(definer);if(definer.scrollLeft>0){type="default";}else{if(typeof Element!=='undefined'&&Element.prototype.scrollIntoView){definer.children[0].children[1].scrollIntoView();if(definer.scrollLeft<0){type="negative";}}else{definer.scrollLeft=1;if(definer.scrollLeft===0){type="negative";}}}document.body.removeChild(definer);return type;}function createDefiner(){var definer=document.createElement('div');definer.dir="rtl";definer.style.position="fixed";definer.style.width="1px";definer.style.height="1px";definer.style.top="0px";definer.style.left="0px";definer.style.overflow="hidden";var innerDiv=document.createElement('div');innerDiv.style.width="2px";var spanA=document.createElement('span');spanA.style.width="1px";spanA.style.display="inline-block";var spanB=document.createElement('span');spanB.style.width="1px";spanB.style.display="inline-block";innerDiv.appendChild(spanA);innerDiv.appendChild(spanB);definer.appendChild(innerDiv);return definer;}var stage={};/**
			 * Checks if `value` is the
			 * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)
			 * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)
			 *
			 * @static
			 * @memberOf _
			 * @since 0.1.0
			 * @category Lang
			 * @param {*} value The value to check.
			 * @returns {boolean} Returns `true` if `value` is an object, else `false`.
			 * @example
			 *
			 * _.isObject({});
			 * // => true
			 *
			 * _.isObject([1, 2, 3]);
			 * // => true
			 *
			 * _.isObject(_.noop);
			 * // => true
			 *
			 * _.isObject(null);
			 * // => false
			 */function isObject$3(value){var type=_typeof3(value);return value!=null&&(type=='object'||type=='function');}var isObject_1=isObject$3;/** Detect free variable `global` from Node.js. */var freeGlobal$1=_typeof3(commonjsGlobal)=='object'&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal;var _freeGlobal=freeGlobal$1;var freeGlobal=_freeGlobal;/** Detect free variable `self`. */var freeSelf=(typeof self==="undefined"?"undefined":_typeof3(self))=='object'&&self&&self.Object===Object&&self;/** Used as a reference to the global object. */var root$2=freeGlobal||freeSelf||Function('return this')();var _root=root$2;var root$1=_root;/**
			 * Gets the timestamp of the number of milliseconds that have elapsed since
			 * the Unix epoch (1 January 1970 00:00:00 UTC).
			 *
			 * @static
			 * @memberOf _
			 * @since 2.4.0
			 * @category Date
			 * @returns {number} Returns the timestamp.
			 * @example
			 *
			 * _.defer(function(stamp) {
			 *   console.log(_.now() - stamp);
			 * }, _.now());
			 * // => Logs the number of milliseconds it took for the deferred invocation.
			 */var now$1=function now$1(){return root$1.Date.now();};var now_1=now$1;/** Used to match a single whitespace character. */var reWhitespace=/\s/;/**
			 * Used by `_.trim` and `_.trimEnd` to get the index of the last non-whitespace
			 * character of `string`.
			 *
			 * @private
			 * @param {string} string The string to inspect.
			 * @returns {number} Returns the index of the last non-whitespace character.
			 */function trimmedEndIndex$1(string){var index=string.length;while(index--&&reWhitespace.test(string.charAt(index))){}return index;}var _trimmedEndIndex=trimmedEndIndex$1;var trimmedEndIndex=_trimmedEndIndex;/** Used to match leading whitespace. */var reTrimStart=/^\s+/;/**
			 * The base implementation of `_.trim`.
			 *
			 * @private
			 * @param {string} string The string to trim.
			 * @returns {string} Returns the trimmed string.
			 */function baseTrim$1(string){return string?string.slice(0,trimmedEndIndex(string)+1).replace(reTrimStart,''):string;}var _baseTrim=baseTrim$1;var root=_root;/** Built-in value references. */var Symbol$3=root.Symbol;var _Symbol=Symbol$3;var Symbol$2=_Symbol;/** Used for built-in method references. */var objectProto$1=Object.prototype;/** Used to check objects for own properties. */var hasOwnProperty$1=objectProto$1.hasOwnProperty;/**
			 * Used to resolve the
			 * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)
			 * of values.
			 */var nativeObjectToString$1=objectProto$1.toString;/** Built-in value references. */var symToStringTag$1=Symbol$2?Symbol$2.toStringTag:undefined;/**
			 * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.
			 *
			 * @private
			 * @param {*} value The value to query.
			 * @returns {string} Returns the raw `toStringTag`.
			 */function getRawTag$1(value){var isOwn=hasOwnProperty$1.call(value,symToStringTag$1),tag=value[symToStringTag$1];try{value[symToStringTag$1]=undefined;var unmasked=true;}catch(e){}var result=nativeObjectToString$1.call(value);if(unmasked){if(isOwn){value[symToStringTag$1]=tag;}else{delete value[symToStringTag$1];}}return result;}var _getRawTag=getRawTag$1;/** Used for built-in method references. */var objectProto=Object.prototype;/**
			 * Used to resolve the
			 * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)
			 * of values.
			 */var nativeObjectToString=objectProto.toString;/**
			 * Converts `value` to a string using `Object.prototype.toString`.
			 *
			 * @private
			 * @param {*} value The value to convert.
			 * @returns {string} Returns the converted string.
			 */function objectToString$1(value){return nativeObjectToString.call(value);}var _objectToString=objectToString$1;var Symbol$1=_Symbol,getRawTag=_getRawTag,objectToString=_objectToString;/** `Object#toString` result references. */var nullTag='[object Null]',undefinedTag='[object Undefined]';/** Built-in value references. */var symToStringTag=Symbol$1?Symbol$1.toStringTag:undefined;/**
			 * The base implementation of `getTag` without fallbacks for buggy environments.
			 *
			 * @private
			 * @param {*} value The value to query.
			 * @returns {string} Returns the `toStringTag`.
			 */function baseGetTag$1(value){if(value==null){return value===undefined?undefinedTag:nullTag;}return symToStringTag&&symToStringTag in Object(value)?getRawTag(value):objectToString(value);}var _baseGetTag=baseGetTag$1;/**
			 * Checks if `value` is object-like. A value is object-like if it's not `null`
			 * and has a `typeof` result of "object".
			 *
			 * @static
			 * @memberOf _
			 * @since 4.0.0
			 * @category Lang
			 * @param {*} value The value to check.
			 * @returns {boolean} Returns `true` if `value` is object-like, else `false`.
			 * @example
			 *
			 * _.isObjectLike({});
			 * // => true
			 *
			 * _.isObjectLike([1, 2, 3]);
			 * // => true
			 *
			 * _.isObjectLike(_.noop);
			 * // => false
			 *
			 * _.isObjectLike(null);
			 * // => false
			 */function isObjectLike$1(value){return value!=null&&_typeof3(value)=='object';}var isObjectLike_1=isObjectLike$1;var baseGetTag=_baseGetTag,isObjectLike=isObjectLike_1;/** `Object#toString` result references. */var symbolTag='[object Symbol]';/**
			 * Checks if `value` is classified as a `Symbol` primitive or object.
			 *
			 * @static
			 * @memberOf _
			 * @since 4.0.0
			 * @category Lang
			 * @param {*} value The value to check.
			 * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.
			 * @example
			 *
			 * _.isSymbol(Symbol.iterator);
			 * // => true
			 *
			 * _.isSymbol('abc');
			 * // => false
			 */function isSymbol$1(value){return _typeof3(value)=='symbol'||isObjectLike(value)&&baseGetTag(value)==symbolTag;}var isSymbol_1=isSymbol$1;var baseTrim=_baseTrim,isObject$2=isObject_1,isSymbol=isSymbol_1;/** Used as references for various `Number` constants. */var NAN=0/0;/** Used to detect bad signed hexadecimal string values. */var reIsBadHex=/^[-+]0x[0-9a-f]+$/i;/** Used to detect binary string values. */var reIsBinary=/^0b[01]+$/i;/** Used to detect octal string values. */var reIsOctal=/^0o[0-7]+$/i;/** Built-in method references without a dependency on `root`. */var freeParseInt=parseInt;/**
			 * Converts `value` to a number.
			 *
			 * @static
			 * @memberOf _
			 * @since 4.0.0
			 * @category Lang
			 * @param {*} value The value to process.
			 * @returns {number} Returns the number.
			 * @example
			 *
			 * _.toNumber(3.2);
			 * // => 3.2
			 *
			 * _.toNumber(Number.MIN_VALUE);
			 * // => 5e-324
			 *
			 * _.toNumber(Infinity);
			 * // => Infinity
			 *
			 * _.toNumber('3.2');
			 * // => 3.2
			 */function toNumber$1(value){if(typeof value=='number'){return value;}if(isSymbol(value)){return NAN;}if(isObject$2(value)){var other=typeof value.valueOf=='function'?value.valueOf():value;value=isObject$2(other)?other+'':other;}if(typeof value!='string'){return value===0?value:+value;}value=baseTrim(value);var isBinary=reIsBinary.test(value);return isBinary||reIsOctal.test(value)?freeParseInt(value.slice(2),isBinary?2:8):reIsBadHex.test(value)?NAN:+value;}var toNumber_1=toNumber$1;var isObject$1=isObject_1,now=now_1,toNumber=toNumber_1;/** Error message constants. */var FUNC_ERROR_TEXT$1='Expected a function';/* Built-in method references for those with the same name as other `lodash` methods. */var nativeMax=Math.max,nativeMin=Math.min;/**
			 * Creates a debounced function that delays invoking `func` until after `wait`
			 * milliseconds have elapsed since the last time the debounced function was
			 * invoked. The debounced function comes with a `cancel` method to cancel
			 * delayed `func` invocations and a `flush` method to immediately invoke them.
			 * Provide `options` to indicate whether `func` should be invoked on the
			 * leading and/or trailing edge of the `wait` timeout. The `func` is invoked
			 * with the last arguments provided to the debounced function. Subsequent
			 * calls to the debounced function return the result of the last `func`
			 * invocation.
			 *
			 * **Note:** If `leading` and `trailing` options are `true`, `func` is
			 * invoked on the trailing edge of the timeout only if the debounced function
			 * is invoked more than once during the `wait` timeout.
			 *
			 * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred
			 * until to the next tick, similar to `setTimeout` with a timeout of `0`.
			 *
			 * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)
			 * for details over the differences between `_.debounce` and `_.throttle`.
			 *
			 * @static
			 * @memberOf _
			 * @since 0.1.0
			 * @category Function
			 * @param {Function} func The function to debounce.
			 * @param {number} [wait=0] The number of milliseconds to delay.
			 * @param {Object} [options={}] The options object.
			 * @param {boolean} [options.leading=false]
			 *  Specify invoking on the leading edge of the timeout.
			 * @param {number} [options.maxWait]
			 *  The maximum time `func` is allowed to be delayed before it's invoked.
			 * @param {boolean} [options.trailing=true]
			 *  Specify invoking on the trailing edge of the timeout.
			 * @returns {Function} Returns the new debounced function.
			 * @example
			 *
			 * // Avoid costly calculations while the window size is in flux.
			 * jQuery(window).on('resize', _.debounce(calculateLayout, 150));
			 *
			 * // Invoke `sendMail` when clicked, debouncing subsequent calls.
			 * jQuery(element).on('click', _.debounce(sendMail, 300, {
			 *   'leading': true,
			 *   'trailing': false
			 * }));
			 *
			 * // Ensure `batchLog` is invoked once after 1 second of debounced calls.
			 * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });
			 * var source = new EventSource('/stream');
			 * jQuery(source).on('message', debounced);
			 *
			 * // Cancel the trailing debounced invocation.
			 * jQuery(window).on('popstate', debounced.cancel);
			 */function debounce$1(func,wait,options){var lastArgs,lastThis,maxWait,result,timerId,lastCallTime,lastInvokeTime=0,leading=false,maxing=false,trailing=true;if(typeof func!='function'){throw new TypeError(FUNC_ERROR_TEXT$1);}wait=toNumber(wait)||0;if(isObject$1(options)){leading=!!options.leading;maxing='maxWait'in options;maxWait=maxing?nativeMax(toNumber(options.maxWait)||0,wait):maxWait;trailing='trailing'in options?!!options.trailing:trailing;}function invokeFunc(time){var args=lastArgs,thisArg=lastThis;lastArgs=lastThis=undefined;lastInvokeTime=time;result=func.apply(thisArg,args);return result;}function leadingEdge(time){// Reset any `maxWait` timer.
lastInvokeTime=time;// Start the timer for the trailing edge.
timerId=setTimeout(timerExpired,wait);// Invoke the leading edge.
return leading?invokeFunc(time):result;}function remainingWait(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime,timeWaiting=wait-timeSinceLastCall;return maxing?nativeMin(timeWaiting,maxWait-timeSinceLastInvoke):timeWaiting;}function shouldInvoke(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime;// Either this is the first call, activity has stopped and we're at the
// trailing edge, the system time has gone backwards and we're treating
// it as the trailing edge, or we've hit the `maxWait` limit.
return lastCallTime===undefined||timeSinceLastCall>=wait||timeSinceLastCall<0||maxing&&timeSinceLastInvoke>=maxWait;}function timerExpired(){var time=now();if(shouldInvoke(time)){return trailingEdge(time);}// Restart the timer.
timerId=setTimeout(timerExpired,remainingWait(time));}function trailingEdge(time){timerId=undefined;// Only invoke if we have `lastArgs` which means `func` has been
// debounced at least once.
if(trailing&&lastArgs){return invokeFunc(time);}lastArgs=lastThis=undefined;return result;}function cancel(){if(timerId!==undefined){clearTimeout(timerId);}lastInvokeTime=0;lastArgs=lastCallTime=lastThis=timerId=undefined;}function flush(){return timerId===undefined?result:trailingEdge(now());}function debounced(){var time=now(),isInvoking=shouldInvoke(time);lastArgs=arguments;lastThis=this;lastCallTime=time;if(isInvoking){if(timerId===undefined){return leadingEdge(lastCallTime);}if(maxing){// Handle invocations in a tight loop.
clearTimeout(timerId);timerId=setTimeout(timerExpired,wait);return invokeFunc(lastCallTime);}}if(timerId===undefined){timerId=setTimeout(timerExpired,wait);}return result;}debounced.cancel=cancel;debounced.flush=flush;return debounced;}var debounce_1=debounce$1;var debounce=debounce_1,isObject=isObject_1;/** Error message constants. */var FUNC_ERROR_TEXT='Expected a function';/**
			 * Creates a throttled function that only invokes `func` at most once per
			 * every `wait` milliseconds. The throttled function comes with a `cancel`
			 * method to cancel delayed `func` invocations and a `flush` method to
			 * immediately invoke them. Provide `options` to indicate whether `func`
			 * should be invoked on the leading and/or trailing edge of the `wait`
			 * timeout. The `func` is invoked with the last arguments provided to the
			 * throttled function. Subsequent calls to the throttled function return the
			 * result of the last `func` invocation.
			 *
			 * **Note:** If `leading` and `trailing` options are `true`, `func` is
			 * invoked on the trailing edge of the timeout only if the throttled function
			 * is invoked more than once during the `wait` timeout.
			 *
			 * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred
			 * until to the next tick, similar to `setTimeout` with a timeout of `0`.
			 *
			 * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)
			 * for details over the differences between `_.throttle` and `_.debounce`.
			 *
			 * @static
			 * @memberOf _
			 * @since 0.1.0
			 * @category Function
			 * @param {Function} func The function to throttle.
			 * @param {number} [wait=0] The number of milliseconds to throttle invocations to.
			 * @param {Object} [options={}] The options object.
			 * @param {boolean} [options.leading=true]
			 *  Specify invoking on the leading edge of the timeout.
			 * @param {boolean} [options.trailing=true]
			 *  Specify invoking on the trailing edge of the timeout.
			 * @returns {Function} Returns the new throttled function.
			 * @example
			 *
			 * // Avoid excessively updating the position while scrolling.
			 * jQuery(window).on('scroll', _.throttle(updatePosition, 100));
			 *
			 * // Invoke `renewToken` when the click event is fired, but not more than once every 5 minutes.
			 * var throttled = _.throttle(renewToken, 300000, { 'trailing': false });
			 * jQuery(element).on('click', throttled);
			 *
			 * // Cancel the trailing throttled invocation.
			 * jQuery(window).on('popstate', throttled.cancel);
			 */function throttle(func,wait,options){var leading=true,trailing=true;if(typeof func!='function'){throw new TypeError(FUNC_ERROR_TEXT);}if(isObject(options)){leading='leading'in options?!!options.leading:leading;trailing='trailing'in options?!!options.trailing:trailing;}return debounce(func,wait,{'leading':leading,'maxWait':wait,'trailing':trailing});}var throttle_1=throttle;Object.defineProperty(stage,"__esModule",{value:true});stage.default=void 0;var _core$8=core;var _throttle=_interopRequireDefault$a(throttle_1);function _interopRequireDefault$a(obj){return obj&&obj.__esModule?obj:{default:obj};}var Stage=/*#__PURE__*/function(){function Stage(_options){_classCallCheck3(this,Stage);this.settings=_options||{};this.id="epubjs-container-"+(0,_core$8.uuid)();this.container=this.create(this.settings);if(this.settings.hidden){this.wrapper=this.wrap(this.container);}}/*
			  * Creates an element to render to.
			  * Resizes to passed width and height or to the elements size
			  */_createClass3(Stage,[{key:"create",value:function create(options){var height=options.height;// !== false ? options.height : "100%";
var width=options.width;// !== false ? options.width : "100%";
var overflow=options.overflow||false;var axis=options.axis||"vertical";var direction=options.direction;(0,_core$8.extend)(this.settings,options);if(options.height&&(0,_core$8.isNumber)(options.height)){height=options.height+"px";}if(options.width&&(0,_core$8.isNumber)(options.width)){width=options.width+"px";}// Create new container element
var container=document.createElement("div");container.id=this.id;container.classList.add("epub-container");// Style Element
// container.style.fontSize = "0";
container.style.wordSpacing="0";container.style.lineHeight="0";container.style.verticalAlign="top";container.style.position="relative";if(axis==="horizontal"){// container.style.whiteSpace = "nowrap";
container.style.display="flex";container.style.flexDirection="row";container.style.flexWrap="nowrap";}if(width){container.style.width=width;}if(height){container.style.height=height;}if(overflow){if(overflow==="scroll"&&axis==="vertical"){container.style["overflow-y"]=overflow;container.style["overflow-x"]="hidden";}else if(overflow==="scroll"&&axis==="horizontal"){container.style["overflow-y"]="hidden";container.style["overflow-x"]=overflow;}else{container.style["overflow"]=overflow;}}if(direction){container.dir=direction;container.style["direction"]=direction;}if(direction&&this.settings.fullsize){document.body.style["direction"]=direction;}return container;}},{key:"wrap",value:function wrap(container){var wrapper=document.createElement("div");wrapper.style.visibility="hidden";wrapper.style.overflow="hidden";wrapper.style.width="0";wrapper.style.height="0";wrapper.appendChild(container);return wrapper;}},{key:"getElement",value:function getElement(_element){var element;if((0,_core$8.isElement)(_element)){element=_element;}else if(typeof _element==="string"){element=document.getElementById(_element);}if(!element){throw new Error("Not an Element");}return element;}},{key:"attachTo",value:function attachTo(what){var element=this.getElement(what);var base;if(!element){return;}if(this.settings.hidden){base=this.wrapper;}else{base=this.container;}element.appendChild(base);this.element=element;return element;}},{key:"getContainer",value:function getContainer(){return this.container;}},{key:"onResize",value:function onResize(func){// Only listen to window for resize event if width and height are not fixed.
// This applies if it is set to a percent or auto.
if(!(0,_core$8.isNumber)(this.settings.width)||!(0,_core$8.isNumber)(this.settings.height)){this.resizeFunc=(0,_throttle.default)(func,50);window.addEventListener("resize",this.resizeFunc,false);}}},{key:"onOrientationChange",value:function onOrientationChange(func){this.orientationChangeFunc=func;window.addEventListener("orientationchange",this.orientationChangeFunc,false);}},{key:"size",value:function size(width,height){var bounds;var _width=width||this.settings.width;var _height=height||this.settings.height;// If width or height are set to false, inherit them from containing element
if(width===null){bounds=this.element.getBoundingClientRect();if(bounds.width){width=Math.floor(bounds.width);this.container.style.width=width+"px";}}else{if((0,_core$8.isNumber)(width)){this.container.style.width=width+"px";}else{this.container.style.width=width;}}if(height===null){bounds=bounds||this.element.getBoundingClientRect();if(bounds.height){height=bounds.height;this.container.style.height=height+"px";}}else{if((0,_core$8.isNumber)(height)){this.container.style.height=height+"px";}else{this.container.style.height=height;}}if(!(0,_core$8.isNumber)(width)){width=this.container.clientWidth;}if(!(0,_core$8.isNumber)(height)){height=this.container.clientHeight;}this.containerStyles=window.getComputedStyle(this.container);this.containerPadding={left:parseFloat(this.containerStyles["padding-left"])||0,right:parseFloat(this.containerStyles["padding-right"])||0,top:parseFloat(this.containerStyles["padding-top"])||0,bottom:parseFloat(this.containerStyles["padding-bottom"])||0};// Bounds not set, get them from window
var _windowBounds=(0,_core$8.windowBounds)();var bodyStyles=window.getComputedStyle(document.body);var bodyPadding={left:parseFloat(bodyStyles["padding-left"])||0,right:parseFloat(bodyStyles["padding-right"])||0,top:parseFloat(bodyStyles["padding-top"])||0,bottom:parseFloat(bodyStyles["padding-bottom"])||0};if(!_width){width=_windowBounds.width-bodyPadding.left-bodyPadding.right;}if(this.settings.fullsize&&!_height||!_height){height=_windowBounds.height-bodyPadding.top-bodyPadding.bottom;}return{width:width-this.containerPadding.left-this.containerPadding.right,height:height-this.containerPadding.top-this.containerPadding.bottom};}},{key:"bounds",value:function bounds(){var box;if(this.container.style.overflow!=="visible"){box=this.container&&this.container.getBoundingClientRect();}if(!box||!box.width||!box.height){return(0,_core$8.windowBounds)();}else{return box;}}},{key:"getSheet",value:function getSheet(){var style=document.createElement("style");// WebKit hack --> https://davidwalsh.name/add-rules-stylesheets
style.appendChild(document.createTextNode(""));document.head.appendChild(style);return style.sheet;}},{key:"addStyleRules",value:function addStyleRules(selector,rulesArray){var scope="#"+this.id+" ";var rules="";if(!this.sheet){this.sheet=this.getSheet();}rulesArray.forEach(function(set){for(var prop in set){if(set.hasOwnProperty(prop)){rules+=prop+":"+set[prop]+";";}}});this.sheet.insertRule(scope+selector+" {"+rules+"}",0);}},{key:"axis",value:function axis(_axis2){if(_axis2==="horizontal"){this.container.style.display="flex";this.container.style.flexDirection="row";this.container.style.flexWrap="nowrap";}else{this.container.style.display="block";}this.settings.axis=_axis2;}// orientation(orientation) {
// 	if (orientation === "landscape") {
//
// 	} else {
//
// 	}
//
// 	this.orientation = orientation;
// }
},{key:"direction",value:function direction(dir){if(this.container){this.container.dir=dir;this.container.style["direction"]=dir;}if(this.settings.fullsize){document.body.style["direction"]=dir;}this.settings.dir=dir;}},{key:"overflow",value:function overflow(_overflow2){if(this.container){if(_overflow2==="scroll"&&this.settings.axis==="vertical"){this.container.style["overflow-y"]=_overflow2;this.container.style["overflow-x"]="hidden";}else if(_overflow2==="scroll"&&this.settings.axis==="horizontal"){this.container.style["overflow-y"]="hidden";this.container.style["overflow-x"]=_overflow2;}else{this.container.style["overflow"]=_overflow2;}}this.settings.overflow=_overflow2;}},{key:"destroy",value:function destroy(){if(this.element){if(this.settings.hidden);if(this.element.contains(this.container)){this.element.removeChild(this.container);}window.removeEventListener("resize",this.resizeFunc);window.removeEventListener("orientationChange",this.orientationChangeFunc);}}}]);return Stage;}();var _default$e=Stage;stage.default=_default$e;var views={};Object.defineProperty(views,"__esModule",{value:true});views.default=void 0;var Views=/*#__PURE__*/function(){function Views(container){_classCallCheck3(this,Views);this.container=container;this._views=[];this.length=0;this.hidden=false;}_createClass3(Views,[{key:"all",value:function all(){return this._views;}},{key:"first",value:function first(){return this._views[0];}},{key:"last",value:function last(){return this._views[this._views.length-1];}},{key:"indexOf",value:function indexOf(view){return this._views.indexOf(view);}},{key:"slice",value:function slice(){return this._views.slice.apply(this._views,arguments);}},{key:"get",value:function get(i){return this._views[i];}},{key:"append",value:function append(view){this._views.push(view);if(this.container){this.container.appendChild(view.element);}this.length++;return view;}},{key:"prepend",value:function prepend(view){this._views.unshift(view);if(this.container){this.container.insertBefore(view.element,this.container.firstChild);}this.length++;return view;}},{key:"insert",value:function insert(view,index){this._views.splice(index,0,view);if(this.container){if(index<this.container.children.length){this.container.insertBefore(view.element,this.container.children[index]);}else{this.container.appendChild(view.element);}}this.length++;return view;}},{key:"remove",value:function remove(view){var index=this._views.indexOf(view);if(index>-1){this._views.splice(index,1);}this.destroy(view);this.length--;}},{key:"destroy",value:function destroy(view){if(view.displayed){view.destroy();}if(this.container){this.container.removeChild(view.element);}view=null;}// Iterators
},{key:"forEach",value:function forEach(){return this._views.forEach.apply(this._views,arguments);}},{key:"clear",value:function clear(){// Remove all views
var view;var len=this.length;if(!this.length)return;for(var i=0;i<len;i++){view=this._views[i];this.destroy(view);}this._views=[];this.length=0;}},{key:"find",value:function find(section){var view;var len=this.length;for(var i=0;i<len;i++){view=this._views[i];if(view.displayed&&view.section.index==section.index){return view;}}}},{key:"displayed",value:function displayed(){var displayed=[];var view;var len=this.length;for(var i=0;i<len;i++){view=this._views[i];if(view.displayed){displayed.push(view);}}return displayed;}},{key:"show",value:function show(){var view;var len=this.length;for(var i=0;i<len;i++){view=this._views[i];if(view.displayed){view.show();}}this.hidden=false;}},{key:"hide",value:function hide(){var view;var len=this.length;for(var i=0;i<len;i++){view=this._views[i];if(view.displayed){view.hide();}}this.hidden=true;}}]);return Views;}();var _default$d=Views;views.default=_default$d;Object.defineProperty(_default$f,"__esModule",{value:true});_default$f.default=void 0;var _eventEmitter$4=_interopRequireDefault$9(eventEmitter.exports);var _core$7=core;var _scrolltype=_interopRequireDefault$9(scrolltype);var _mapping=_interopRequireDefault$9(mapping);var _queue$1=_interopRequireDefault$9(queue);var _stage=_interopRequireDefault$9(stage);var _views=_interopRequireDefault$9(views);var _constants$5=constants;function _interopRequireDefault$9(obj){return obj&&obj.__esModule?obj:{default:obj};}var DefaultViewManager=/*#__PURE__*/function(){function DefaultViewManager(options){_classCallCheck3(this,DefaultViewManager);this.name="default";this.optsSettings=options.settings;this.View=options.view;this.request=options.request;this.renditionQueue=options.queue;this.q=new _queue$1.default(this);this.settings=(0,_core$7.extend)(this.settings||{},{infinite:true,hidden:false,width:undefined,height:undefined,axis:undefined,writingMode:undefined,flow:"scrolled",ignoreClass:"",fullsize:undefined,allowScriptedContent:false,allowPopups:false});(0,_core$7.extend)(this.settings,options.settings||{});this.viewSettings={ignoreClass:this.settings.ignoreClass,axis:this.settings.axis,flow:this.settings.flow,layout:this.layout,method:this.settings.method,// srcdoc, blobUrl, write
width:0,height:0,forceEvenPages:true,allowScriptedContent:this.settings.allowScriptedContent,allowPopups:this.settings.allowPopups};this.rendered=false;}_createClass3(DefaultViewManager,[{key:"render",value:function render(element,size){var tag=element.tagName;if(typeof this.settings.fullsize==="undefined"&&tag&&(tag.toLowerCase()=="body"||tag.toLowerCase()=="html")){this.settings.fullsize=true;}if(this.settings.fullsize){this.settings.overflow="visible";this.overflow=this.settings.overflow;}this.settings.size=size;this.settings.rtlScrollType=(0,_scrolltype.default)();// Save the stage
this.stage=new _stage.default({width:size.width,height:size.height,overflow:this.overflow,hidden:this.settings.hidden,axis:this.settings.axis,fullsize:this.settings.fullsize,direction:this.settings.direction});this.stage.attachTo(element);// Get this stage container div
this.container=this.stage.getContainer();// Views array methods
this.views=new _views.default(this.container);// Calculate Stage Size
this._bounds=this.bounds();this._stageSize=this.stage.size();// Set the dimensions for views
this.viewSettings.width=this._stageSize.width;this.viewSettings.height=this._stageSize.height;// Function to handle a resize event.
// Will only attach if width and height are both fixed.
this.stage.onResize(this.onResized.bind(this));this.stage.onOrientationChange(this.onOrientationChange.bind(this));// Add Event Listeners
this.addEventListeners();// Add Layout method
// this.applyLayoutMethod();
if(this.layout){this.updateLayout();}this.rendered=true;}},{key:"addEventListeners",value:function addEventListeners(){var scroller;window.addEventListener("unload",function(e){this.destroy();}.bind(this));if(!this.settings.fullsize){scroller=this.container;}else{scroller=window;}this._onScroll=this.onScroll.bind(this);scroller.addEventListener("scroll",this._onScroll);}},{key:"removeEventListeners",value:function removeEventListeners(){var scroller;if(!this.settings.fullsize){scroller=this.container;}else{scroller=window;}scroller.removeEventListener("scroll",this._onScroll);this._onScroll=undefined;}},{key:"destroy",value:function destroy(){clearTimeout(this.orientationTimeout);clearTimeout(this.resizeTimeout);clearTimeout(this.afterScrolled);this.clear();this.removeEventListeners();this.stage.destroy();this.rendered=false;/*
			    		clearTimeout(this.trimTimeout);
			    	if(this.settings.hidden) {
			    		this.element.removeChild(this.wrapper);
			    	} else {
			    		this.element.removeChild(this.container);
			    	}
			    */}},{key:"onOrientationChange",value:function onOrientationChange(e){var _window=window,orientation=_window.orientation;if(this.optsSettings.resizeOnOrientationChange){this.resize();}// Per ampproject:
// In IOS 10.3, the measured size of an element is incorrect if the
// element size depends on window size directly and the measurement
// happens in window.resize event. Adding a timeout for correct
// measurement. See https://github.com/ampproject/amphtml/issues/8479
clearTimeout(this.orientationTimeout);this.orientationTimeout=setTimeout(function(){this.orientationTimeout=undefined;if(this.optsSettings.resizeOnOrientationChange){this.resize();}this.emit(_constants$5.EVENTS.MANAGERS.ORIENTATION_CHANGE,orientation);}.bind(this),500);}},{key:"onResized",value:function onResized(e){this.resize();}},{key:"resize",value:function resize(width,height,epubcfi){var stageSize=this.stage.size(width,height);// For Safari, wait for orientation to catch up
// if the window is a square
this.winBounds=(0,_core$7.windowBounds)();if(this.orientationTimeout&&this.winBounds.width===this.winBounds.height){// reset the stage size for next resize
this._stageSize=undefined;return;}if(this._stageSize&&this._stageSize.width===stageSize.width&&this._stageSize.height===stageSize.height){// Size is the same, no need to resize
return;}this._stageSize=stageSize;this._bounds=this.bounds();// Clear current views
this.clear();// Update for new views
this.viewSettings.width=this._stageSize.width;this.viewSettings.height=this._stageSize.height;this.updateLayout();this.emit(_constants$5.EVENTS.MANAGERS.RESIZED,{width:this._stageSize.width,height:this._stageSize.height},epubcfi);}},{key:"createView",value:function createView(section,forceRight){return new this.View(section,(0,_core$7.extend)(this.viewSettings,{forceRight:forceRight}));}},{key:"handleNextPrePaginated",value:function handleNextPrePaginated(forceRight,section,action){var next;if(this.layout.name==="pre-paginated"&&this.layout.divisor>1){if(forceRight||section.index===0){// First page (cover) should stand alone for pre-paginated books
return;}next=section.next();if(next&&!next.properties.includes("page-spread-left")){return action.call(this,next);}}}},{key:"display",value:function display(section,target){var displaying=new _core$7.defer();var displayed=displaying.promise;// Check if moving to target is needed
if(target===section.href||(0,_core$7.isNumber)(target)){target=undefined;}// Check to make sure the section we want isn't already shown
var visible=this.views.find(section);// View is already shown, just move to correct location in view
if(visible&&section&&this.layout.name!=="pre-paginated"){var offset=visible.offset();if(this.settings.direction==="ltr"){this.scrollTo(offset.left,offset.top,true);}else{var width=visible.width();this.scrollTo(offset.left+width,offset.top,true);}if(target){var _offset2=visible.locationOf(target);var _width2=visible.width();this.moveTo(_offset2,_width2);}displaying.resolve();return displayed;}// Hide all current views
this.clear();var forceRight=false;if(this.layout.name==="pre-paginated"&&this.layout.divisor===2&&section.properties.includes("page-spread-right")){forceRight=true;}this.add(section,forceRight).then(function(view){// Move to correct place within the section, if needed
if(target){var _offset3=view.locationOf(target);var _width3=view.width();this.moveTo(_offset3,_width3);}}.bind(this),function(err){displaying.reject(err);}).then(function(){return this.handleNextPrePaginated(forceRight,section,this.add);}.bind(this)).then(function(){this.views.show();displaying.resolve();}.bind(this));// .then(function(){
// 	return this.hooks.display.trigger(view);
// }.bind(this))
// .then(function(){
// 	this.views.show();
// }.bind(this));
return displayed;}},{key:"afterDisplayed",value:function afterDisplayed(view){this.emit(_constants$5.EVENTS.MANAGERS.ADDED,view);}},{key:"afterResized",value:function afterResized(view){this.emit(_constants$5.EVENTS.MANAGERS.RESIZE,view.section);}},{key:"moveTo",value:function moveTo(offset,width){var distX=0,distY=0;if(!this.isPaginated){distY=offset.top;}else{distX=Math.floor(offset.left/this.layout.delta)*this.layout.delta;if(distX+this.layout.delta>this.container.scrollWidth){distX=this.container.scrollWidth-this.layout.delta;}distY=Math.floor(offset.top/this.layout.delta)*this.layout.delta;if(distY+this.layout.delta>this.container.scrollHeight){distY=this.container.scrollHeight-this.layout.delta;}}if(this.settings.direction==='rtl'){/***
			      	the `floor` function above (L343) is on positive values, so we should add one `layout.delta`
			      	to distX or use `Math.ceil` function, or multiply offset.left by -1
			      	before `Math.floor`
			      */distX=distX+this.layout.delta;distX=distX-width;}this.scrollTo(distX,distY,true);}},{key:"add",value:function add(section,forceRight){var _this36=this;var view=this.createView(section,forceRight);this.views.append(view);// view.on(EVENTS.VIEWS.SHOWN, this.afterDisplayed.bind(this));
view.onDisplayed=this.afterDisplayed.bind(this);view.onResize=this.afterResized.bind(this);view.on(_constants$5.EVENTS.VIEWS.AXIS,function(axis){_this36.updateAxis(axis);});view.on(_constants$5.EVENTS.VIEWS.WRITING_MODE,function(mode){_this36.updateWritingMode(mode);});return view.display(this.request);}},{key:"append",value:function append(section,forceRight){var _this37=this;var view=this.createView(section,forceRight);this.views.append(view);view.onDisplayed=this.afterDisplayed.bind(this);view.onResize=this.afterResized.bind(this);view.on(_constants$5.EVENTS.VIEWS.AXIS,function(axis){_this37.updateAxis(axis);});view.on(_constants$5.EVENTS.VIEWS.WRITING_MODE,function(mode){_this37.updateWritingMode(mode);});return view.display(this.request);}},{key:"prepend",value:function prepend(section,forceRight){var _this38=this;var view=this.createView(section,forceRight);view.on(_constants$5.EVENTS.VIEWS.RESIZED,function(bounds){_this38.counter(bounds);});this.views.prepend(view);view.onDisplayed=this.afterDisplayed.bind(this);view.onResize=this.afterResized.bind(this);view.on(_constants$5.EVENTS.VIEWS.AXIS,function(axis){_this38.updateAxis(axis);});view.on(_constants$5.EVENTS.VIEWS.WRITING_MODE,function(mode){_this38.updateWritingMode(mode);});return view.display(this.request);}},{key:"counter",value:function counter(bounds){if(this.settings.axis==="vertical"){this.scrollBy(0,bounds.heightDelta,true);}else{this.scrollBy(bounds.widthDelta,0,true);}}// resizeView(view) {
//
// 	if(this.settings.globalLayoutProperties.layout === "pre-paginated") {
// 		view.lock("both", this.bounds.width, this.bounds.height);
// 	} else {
// 		view.lock("width", this.bounds.width, this.bounds.height);
// 	}
//
// };
},{key:"next",value:function next(){var next;var left;var dir=this.settings.direction;if(!this.views.length)return;if(this.isPaginated&&this.settings.axis==="horizontal"&&(!dir||dir==="ltr")){this.scrollLeft=this.container.scrollLeft;left=this.container.scrollLeft+this.container.offsetWidth+this.layout.delta;if(left<=this.container.scrollWidth){this.scrollBy(this.layout.delta,0,true);}else{next=this.views.last().section.next();}}else if(this.isPaginated&&this.settings.axis==="horizontal"&&dir==="rtl"){this.scrollLeft=this.container.scrollLeft;if(this.settings.rtlScrollType==="default"){left=this.container.scrollLeft;if(left>0){this.scrollBy(this.layout.delta,0,true);}else{next=this.views.last().section.next();}}else{left=this.container.scrollLeft+this.layout.delta*-1;if(left>this.container.scrollWidth*-1){this.scrollBy(this.layout.delta,0,true);}else{next=this.views.last().section.next();}}}else if(this.isPaginated&&this.settings.axis==="vertical"){this.scrollTop=this.container.scrollTop;var top=this.container.scrollTop+this.container.offsetHeight;if(top<this.container.scrollHeight){this.scrollBy(0,this.layout.height,true);}else{next=this.views.last().section.next();}}else{next=this.views.last().section.next();}if(next){this.clear();// The new section may have a different writing-mode from the old section. Thus, we need to update layout.
this.updateLayout();var forceRight=false;if(this.layout.name==="pre-paginated"&&this.layout.divisor===2&&next.properties.includes("page-spread-right")){forceRight=true;}return this.append(next,forceRight).then(function(){return this.handleNextPrePaginated(forceRight,next,this.append);}.bind(this),function(err){return err;}).then(function(){// Reset position to start for scrolled-doc vertical-rl in default mode
if(!this.isPaginated&&this.settings.axis==="horizontal"&&this.settings.direction==="rtl"&&this.settings.rtlScrollType==="default"){this.scrollTo(this.container.scrollWidth,0,true);}this.views.show();}.bind(this));}}},{key:"prev",value:function prev(){var prev;var left;var dir=this.settings.direction;if(!this.views.length)return;if(this.isPaginated&&this.settings.axis==="horizontal"&&(!dir||dir==="ltr")){this.scrollLeft=this.container.scrollLeft;left=this.container.scrollLeft;if(left>0){this.scrollBy(-this.layout.delta,0,true);}else{prev=this.views.first().section.prev();}}else if(this.isPaginated&&this.settings.axis==="horizontal"&&dir==="rtl"){this.scrollLeft=this.container.scrollLeft;if(this.settings.rtlScrollType==="default"){left=this.container.scrollLeft+this.container.offsetWidth;if(left<this.container.scrollWidth){this.scrollBy(-this.layout.delta,0,true);}else{prev=this.views.first().section.prev();}}else{left=this.container.scrollLeft;if(left<0){this.scrollBy(-this.layout.delta,0,true);}else{prev=this.views.first().section.prev();}}}else if(this.isPaginated&&this.settings.axis==="vertical"){this.scrollTop=this.container.scrollTop;var top=this.container.scrollTop;if(top>0){this.scrollBy(0,-this.layout.height,true);}else{prev=this.views.first().section.prev();}}else{prev=this.views.first().section.prev();}if(prev){this.clear();// The new section may have a different writing-mode from the old section. Thus, we need to update layout.
this.updateLayout();var forceRight=false;if(this.layout.name==="pre-paginated"&&this.layout.divisor===2&&_typeof3(prev.prev())!=="object"){forceRight=true;}return this.prepend(prev,forceRight).then(function(){var left;if(this.layout.name==="pre-paginated"&&this.layout.divisor>1){left=prev.prev();if(left){return this.prepend(left);}}}.bind(this),function(err){return err;}).then(function(){if(this.isPaginated&&this.settings.axis==="horizontal"){if(this.settings.direction==="rtl"){if(this.settings.rtlScrollType==="default"){this.scrollTo(0,0,true);}else{this.scrollTo(this.container.scrollWidth*-1+this.layout.delta,0,true);}}else{this.scrollTo(this.container.scrollWidth-this.layout.delta,0,true);}}this.views.show();}.bind(this));}}},{key:"current",value:function current(){var visible=this.visible();if(visible.length){// Current is the last visible view
return visible[visible.length-1];}return null;}},{key:"clear",value:function clear(){// this.q.clear();
if(this.views){this.views.hide();this.scrollTo(0,0,true);this.views.clear();}}},{key:"currentLocation",value:function currentLocation(){this.updateLayout();if(this.isPaginated&&this.settings.axis==="horizontal"){this.location=this.paginatedLocation();}else{this.location=this.scrolledLocation();}return this.location;}},{key:"scrolledLocation",value:function scrolledLocation(){var _this39=this;var visible=this.visible();var container=this.container.getBoundingClientRect();var pageHeight=container.height<window.innerHeight?container.height:window.innerHeight;var pageWidth=container.width<window.innerWidth?container.width:window.innerWidth;var vertical=this.settings.axis==="vertical";this.settings.direction==="rtl";var offset=0;var used=0;if(this.settings.fullsize){offset=vertical?window.scrollY:window.scrollX;}var sections=visible.map(function(view){var _view$section=view.section,index=_view$section.index,href=_view$section.href;var position=view.position();var width=view.width();var height=view.height();var startPos;var endPos;var stopPos;var totalPages;if(vertical){startPos=offset+container.top-position.top+used;endPos=startPos+pageHeight-used;totalPages=_this39.layout.count(height,pageHeight).pages;stopPos=pageHeight;}else{startPos=offset+container.left-position.left+used;endPos=startPos+pageWidth-used;totalPages=_this39.layout.count(width,pageWidth).pages;stopPos=pageWidth;}var currPage=Math.ceil(startPos/stopPos);var pages=[];var endPage=Math.ceil(endPos/stopPos);// Reverse page counts for horizontal rtl
if(_this39.settings.direction==="rtl"&&!vertical){var tempStartPage=currPage;currPage=totalPages-endPage;endPage=totalPages-tempStartPage;}pages=[];for(var i=currPage;i<=endPage;i++){var pg=i+1;pages.push(pg);}var mapping=_this39.mapping.page(view.contents,view.section.cfiBase,startPos,endPos);return{index:index,href:href,pages:pages,totalPages:totalPages,mapping:mapping};});return sections;}},{key:"paginatedLocation",value:function paginatedLocation(){var _this40=this;var visible=this.visible();var container=this.container.getBoundingClientRect();var left=0;var used=0;if(this.settings.fullsize){left=window.scrollX;}var sections=visible.map(function(view){var _view$section2=view.section,index=_view$section2.index,href=_view$section2.href;var offset;var position=view.position();var width=view.width();// Find mapping
var start;var end;var pageWidth;if(_this40.settings.direction==="rtl"){offset=container.right-left;pageWidth=Math.min(Math.abs(offset-position.left),_this40.layout.width)-used;end=position.width-(position.right-offset)-used;start=end-pageWidth;}else{offset=container.left+left;pageWidth=Math.min(position.right-offset,_this40.layout.width)-used;start=offset-position.left+used;end=start+pageWidth;}used+=pageWidth;var mapping=_this40.mapping.page(view.contents,view.section.cfiBase,start,end);var totalPages=_this40.layout.count(width).pages;var startPage=Math.floor(start/_this40.layout.pageWidth);var pages=[];var endPage=Math.floor(end/_this40.layout.pageWidth);// start page should not be negative
if(startPage<0){startPage=0;endPage=endPage+1;}// Reverse page counts for rtl
if(_this40.settings.direction==="rtl"){var tempStartPage=startPage;startPage=totalPages-endPage;endPage=totalPages-tempStartPage;}for(var i=startPage+1;i<=endPage;i++){var pg=i;pages.push(pg);}return{index:index,href:href,pages:pages,totalPages:totalPages,mapping:mapping};});return sections;}},{key:"isVisible",value:function isVisible(view,offsetPrev,offsetNext,_container){var position=view.position();var container=_container||this.bounds();if(this.settings.axis==="horizontal"&&position.right>container.left-offsetPrev&&position.left<container.right+offsetNext){return true;}else if(this.settings.axis==="vertical"&&position.bottom>container.top-offsetPrev&&position.top<container.bottom+offsetNext){return true;}return false;}},{key:"visible",value:function visible(){var container=this.bounds();var views=this.views.displayed();var viewsLength=views.length;var visible=[];var isVisible;var view;for(var i=0;i<viewsLength;i++){view=views[i];isVisible=this.isVisible(view,0,0,container);if(isVisible===true){visible.push(view);}}return visible;}},{key:"scrollBy",value:function scrollBy(x,y,silent){var dir=this.settings.direction==="rtl"?-1:1;if(silent){this.ignore=true;}if(!this.settings.fullsize){if(x)this.container.scrollLeft+=x*dir;if(y)this.container.scrollTop+=y;}else{window.scrollBy(x*dir,y*dir);}this.scrolled=true;}},{key:"scrollTo",value:function scrollTo(x,y,silent){if(silent){this.ignore=true;}if(!this.settings.fullsize){this.container.scrollLeft=x;this.container.scrollTop=y;}else{window.scrollTo(x,y);}this.scrolled=true;}},{key:"onScroll",value:function onScroll(){var scrollTop;var scrollLeft;if(!this.settings.fullsize){scrollTop=this.container.scrollTop;scrollLeft=this.container.scrollLeft;}else{scrollTop=window.scrollY;scrollLeft=window.scrollX;}this.scrollTop=scrollTop;this.scrollLeft=scrollLeft;if(!this.ignore){this.emit(_constants$5.EVENTS.MANAGERS.SCROLL,{top:scrollTop,left:scrollLeft});clearTimeout(this.afterScrolled);this.afterScrolled=setTimeout(function(){this.emit(_constants$5.EVENTS.MANAGERS.SCROLLED,{top:this.scrollTop,left:this.scrollLeft});}.bind(this),20);}else{this.ignore=false;}}},{key:"bounds",value:function bounds(){var bounds;bounds=this.stage.bounds();return bounds;}},{key:"applyLayout",value:function applyLayout(layout){this.layout=layout;this.updateLayout();if(this.views&&this.views.length>0&&this.layout.name==="pre-paginated"){this.display(this.views.first().section);}// this.manager.layout(this.layout.format);
}},{key:"updateLayout",value:function updateLayout(){if(!this.stage){return;}this._stageSize=this.stage.size();if(!this.isPaginated){this.layout.calculate(this._stageSize.width,this._stageSize.height);}else{this.layout.calculate(this._stageSize.width,this._stageSize.height,this.settings.gap);// Set the look ahead offset for what is visible
this.settings.offset=this.layout.delta/this.layout.divisor;// this.stage.addStyleRules("iframe", [{"margin-right" : this.layout.gap + "px"}]);
}// Set the dimensions for views
this.viewSettings.width=this.layout.width;this.viewSettings.height=this.layout.height;this.setLayout(this.layout);}},{key:"setLayout",value:function setLayout(layout){this.viewSettings.layout=layout;this.mapping=new _mapping.default(layout.props,this.settings.direction,this.settings.axis);if(this.views){this.views.forEach(function(view){if(view){view.setLayout(layout);}});}}},{key:"updateWritingMode",value:function updateWritingMode(mode){this.writingMode=mode;}},{key:"updateAxis",value:function updateAxis(axis,forceUpdate){if(!forceUpdate&&axis===this.settings.axis){return;}this.settings.axis=axis;this.stage&&this.stage.axis(axis);this.viewSettings.axis=axis;if(this.mapping){this.mapping=new _mapping.default(this.layout.props,this.settings.direction,this.settings.axis);}if(this.layout){if(axis==="vertical"){this.layout.spread("none");}else{this.layout.spread(this.layout.settings.spread);}}}},{key:"updateFlow",value:function updateFlow(flow){var defaultScrolledOverflow=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"auto";var isPaginated=flow==="paginated"||flow==="auto";this.isPaginated=isPaginated;if(flow==="scrolled-doc"||flow==="scrolled-continuous"||flow==="scrolled"){this.updateAxis("vertical");}else{this.updateAxis("horizontal");}this.viewSettings.flow=flow;if(!this.settings.overflow){this.overflow=isPaginated?"hidden":defaultScrolledOverflow;}else{this.overflow=this.settings.overflow;}this.stage&&this.stage.overflow(this.overflow);this.updateLayout();}},{key:"getContents",value:function getContents(){var contents=[];if(!this.views){return contents;}this.views.forEach(function(view){var viewContents=view&&view.contents;if(viewContents){contents.push(viewContents);}});return contents;}},{key:"direction",value:function direction(){var dir=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"ltr";this.settings.direction=dir;this.stage&&this.stage.direction(dir);this.viewSettings.direction=dir;this.updateLayout();}},{key:"isRendered",value:function isRendered(){return this.rendered;}}]);return DefaultViewManager;}();//-- Enable binding events to Manager
(0,_eventEmitter$4.default)(DefaultViewManager.prototype);var _default$c=DefaultViewManager;_default$f.default=_default$c;var continuous={};var snap={};Object.defineProperty(snap,"__esModule",{value:true});snap.default=void 0;var _core$6=core;var _constants$4=constants;var _eventEmitter$3=_interopRequireDefault$8(eventEmitter.exports);function _interopRequireDefault$8(obj){return obj&&obj.__esModule?obj:{default:obj};}// easing equations from https://github.com/danro/easing-js/blob/master/easing.js
var PI_D2=Math.PI/2;var EASING_EQUATIONS={easeOutSine:function easeOutSine(pos){return Math.sin(pos*PI_D2);},easeInOutSine:function easeInOutSine(pos){return-0.5*(Math.cos(Math.PI*pos)-1);},easeInOutQuint:function easeInOutQuint(pos){if((pos/=0.5)<1){return 0.5*Math.pow(pos,5);}return 0.5*(Math.pow(pos-2,5)+2);},easeInCubic:function easeInCubic(pos){return Math.pow(pos,3);}};var Snap=/*#__PURE__*/function(){function Snap(manager,options){_classCallCheck3(this,Snap);this.settings=(0,_core$6.extend)({duration:80,minVelocity:0.2,minDistance:10,easing:EASING_EQUATIONS['easeInCubic']},options||{});this.supportsTouch=this.supportsTouch();if(this.supportsTouch){this.setup(manager);}}_createClass3(Snap,[{key:"setup",value:function setup(manager){this.manager=manager;this.layout=this.manager.layout;this.fullsize=this.manager.settings.fullsize;if(this.fullsize){this.element=this.manager.stage.element;this.scroller=window;this.disableScroll();}else{this.element=this.manager.stage.container;this.scroller=this.element;this.element.style["WebkitOverflowScrolling"]="touch";}// this.overflow = this.manager.overflow;
// set lookahead offset to page width
this.manager.settings.offset=this.layout.width;this.manager.settings.afterScrolledTimeout=this.settings.duration*2;this.isVertical=this.manager.settings.axis==="vertical";// disable snapping if not paginated or axis in not horizontal
if(!this.manager.isPaginated||this.isVertical){return;}this.touchCanceler=false;this.resizeCanceler=false;this.snapping=false;this.scrollLeft;this.scrollTop;this.startTouchX=undefined;this.startTouchY=undefined;this.startTime=undefined;this.endTouchX=undefined;this.endTouchY=undefined;this.endTime=undefined;this.addListeners();}},{key:"supportsTouch",value:function supportsTouch(){if('ontouchstart'in window||window.DocumentTouch&&document instanceof DocumentTouch){return true;}return false;}},{key:"disableScroll",value:function disableScroll(){this.element.style.overflow="hidden";}},{key:"enableScroll",value:function enableScroll(){this.element.style.overflow="";}},{key:"addListeners",value:function addListeners(){this._onResize=this.onResize.bind(this);window.addEventListener('resize',this._onResize);this._onScroll=this.onScroll.bind(this);this.scroller.addEventListener('scroll',this._onScroll);this._onTouchStart=this.onTouchStart.bind(this);this.scroller.addEventListener('touchstart',this._onTouchStart,{passive:true});this.on('touchstart',this._onTouchStart);this._onTouchMove=this.onTouchMove.bind(this);this.scroller.addEventListener('touchmove',this._onTouchMove,{passive:true});this.on('touchmove',this._onTouchMove);this._onTouchEnd=this.onTouchEnd.bind(this);this.scroller.addEventListener('touchend',this._onTouchEnd,{passive:true});this.on('touchend',this._onTouchEnd);this._afterDisplayed=this.afterDisplayed.bind(this);this.manager.on(_constants$4.EVENTS.MANAGERS.ADDED,this._afterDisplayed);}},{key:"removeListeners",value:function removeListeners(){window.removeEventListener('resize',this._onResize);this._onResize=undefined;this.scroller.removeEventListener('scroll',this._onScroll);this._onScroll=undefined;this.scroller.removeEventListener('touchstart',this._onTouchStart,{passive:true});this.off('touchstart',this._onTouchStart);this._onTouchStart=undefined;this.scroller.removeEventListener('touchmove',this._onTouchMove,{passive:true});this.off('touchmove',this._onTouchMove);this._onTouchMove=undefined;this.scroller.removeEventListener('touchend',this._onTouchEnd,{passive:true});this.off('touchend',this._onTouchEnd);this._onTouchEnd=undefined;this.manager.off(_constants$4.EVENTS.MANAGERS.ADDED,this._afterDisplayed);this._afterDisplayed=undefined;}},{key:"afterDisplayed",value:function afterDisplayed(view){var _this41=this;var contents=view.contents;["touchstart","touchmove","touchend"].forEach(function(e){contents.on(e,function(ev){return _this41.triggerViewEvent(ev,contents);});});}},{key:"triggerViewEvent",value:function triggerViewEvent(e,contents){this.emit(e.type,e,contents);}},{key:"onScroll",value:function onScroll(e){this.scrollLeft=this.fullsize?window.scrollX:this.scroller.scrollLeft;this.scrollTop=this.fullsize?window.scrollY:this.scroller.scrollTop;}},{key:"onResize",value:function onResize(e){this.resizeCanceler=true;}},{key:"onTouchStart",value:function onTouchStart(e){var _e$touches$=e.touches[0],screenX=_e$touches$.screenX,screenY=_e$touches$.screenY;if(this.fullsize){this.enableScroll();}this.touchCanceler=true;if(!this.startTouchX){this.startTouchX=screenX;this.startTouchY=screenY;this.startTime=this.now();}this.endTouchX=screenX;this.endTouchY=screenY;this.endTime=this.now();}},{key:"onTouchMove",value:function onTouchMove(e){var _e$touches$2=e.touches[0],screenX=_e$touches$2.screenX,screenY=_e$touches$2.screenY;var deltaY=Math.abs(screenY-this.endTouchY);this.touchCanceler=true;if(!this.fullsize&&deltaY<10){this.element.scrollLeft-=screenX-this.endTouchX;}this.endTouchX=screenX;this.endTouchY=screenY;this.endTime=this.now();}},{key:"onTouchEnd",value:function onTouchEnd(e){if(this.fullsize){this.disableScroll();}this.touchCanceler=false;var swipped=this.wasSwiped();if(swipped!==0){this.snap(swipped);}else{this.snap();}this.startTouchX=undefined;this.startTouchY=undefined;this.startTime=undefined;this.endTouchX=undefined;this.endTouchY=undefined;this.endTime=undefined;}},{key:"wasSwiped",value:function wasSwiped(){var snapWidth=this.layout.pageWidth*this.layout.divisor;var distance=this.endTouchX-this.startTouchX;var absolute=Math.abs(distance);var time=this.endTime-this.startTime;var velocity=distance/time;var minVelocity=this.settings.minVelocity;if(absolute<=this.settings.minDistance||absolute>=snapWidth){return 0;}if(velocity>minVelocity){// previous
return-1;}else if(velocity<-minVelocity){// next
return 1;}}},{key:"needsSnap",value:function needsSnap(){var left=this.scrollLeft;var snapWidth=this.layout.pageWidth*this.layout.divisor;return left%snapWidth!==0;}},{key:"snap",value:function snap(){var howMany=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var left=this.scrollLeft;var snapWidth=this.layout.pageWidth*this.layout.divisor;var snapTo=Math.round(left/snapWidth)*snapWidth;if(howMany){snapTo+=howMany*snapWidth;}return this.smoothScrollTo(snapTo);}},{key:"smoothScrollTo",value:function smoothScrollTo(destination){var deferred=new _core$6.defer();var start=this.scrollLeft;var startTime=this.now();var duration=this.settings.duration;var easing=this.settings.easing;this.snapping=true;// add animation loop
function tick(){var now=this.now();var time=Math.min(1,(now-startTime)/duration);easing(time);if(this.touchCanceler||this.resizeCanceler){this.resizeCanceler=false;this.snapping=false;deferred.resolve();return;}if(time<1){window.requestAnimationFrame(tick.bind(this));this.scrollTo(start+(destination-start)*time,0);}else{this.scrollTo(destination,0);this.snapping=false;deferred.resolve();}}tick.call(this);return deferred.promise;}},{key:"scrollTo",value:function scrollTo(){var left=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var top=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;if(this.fullsize){window.scroll(left,top);}else{this.scroller.scrollLeft=left;this.scroller.scrollTop=top;}}},{key:"now",value:function now(){return'now'in window.performance?performance.now():new Date().getTime();}},{key:"destroy",value:function destroy(){if(!this.scroller){return;}if(this.fullsize){this.enableScroll();}this.removeListeners();this.scroller=undefined;}}]);return Snap;}();(0,_eventEmitter$3.default)(Snap.prototype);var _default$b=Snap;snap.default=_default$b;Object.defineProperty(continuous,"__esModule",{value:true});continuous.default=void 0;var _core$5=core;var _default2=_interopRequireDefault$7(_default$f);var _snap=_interopRequireDefault$7(snap);var _constants$3=constants;var _debounce=_interopRequireDefault$7(debounce_1);function _interopRequireDefault$7(obj){return obj&&obj.__esModule?obj:{default:obj};}var ContinuousViewManager=/*#__PURE__*/function(_default2$default){_inherits3(ContinuousViewManager,_default2$default);var _super3=_createSuper3(ContinuousViewManager);function ContinuousViewManager(options){var _this42;_classCallCheck3(this,ContinuousViewManager);_this42=_super3.call(this,options);_this42.name="continuous";_this42.settings=(0,_core$5.extend)(_this42.settings||{},{infinite:true,overflow:undefined,axis:undefined,writingMode:undefined,flow:"scrolled",offset:500,offsetDelta:250,width:undefined,height:undefined,snap:false,afterScrolledTimeout:10,allowScriptedContent:false,allowPopups:false});(0,_core$5.extend)(_this42.settings,options.settings||{});// Gap can be 0, but defaults doesn't handle that
if(options.settings.gap!="undefined"&&options.settings.gap===0){_this42.settings.gap=options.settings.gap;}_this42.viewSettings={ignoreClass:_this42.settings.ignoreClass,axis:_this42.settings.axis,flow:_this42.settings.flow,layout:_this42.layout,width:0,height:0,forceEvenPages:false,allowScriptedContent:_this42.settings.allowScriptedContent,allowPopups:_this42.settings.allowPopups};_this42.scrollTop=0;_this42.scrollLeft=0;return _this42;}_createClass3(ContinuousViewManager,[{key:"display",value:function display(section,target){return _default2.default.prototype.display.call(this,section,target).then(function(){return this.fill();}.bind(this));}},{key:"fill",value:function fill(_full){var _this43=this;var full=_full||new _core$5.defer();this.q.enqueue(function(){return _this43.check();}).then(function(result){if(result){_this43.fill(full);}else{full.resolve();}});return full.promise;}},{key:"moveTo",value:function moveTo(offset){// var bounds = this.stage.bounds();
// var dist = Math.floor(offset.top / bounds.height) * bounds.height;
var distX=0,distY=0;if(!this.isPaginated){distY=offset.top;offset.top+this.settings.offsetDelta;}else{distX=Math.floor(offset.left/this.layout.delta)*this.layout.delta;distX+this.settings.offsetDelta;}if(distX>0||distY>0){this.scrollBy(distX,distY,true);}}},{key:"afterResized",value:function afterResized(view){this.emit(_constants$3.EVENTS.MANAGERS.RESIZE,view.section);}// Remove Previous Listeners if present
},{key:"removeShownListeners",value:function removeShownListeners(view){// view.off("shown", this.afterDisplayed);
// view.off("shown", this.afterDisplayedAbove);
view.onDisplayed=function(){};}},{key:"add",value:function add(section){var _this44=this;var view=this.createView(section);this.views.append(view);view.on(_constants$3.EVENTS.VIEWS.RESIZED,function(bounds){view.expanded=true;});view.on(_constants$3.EVENTS.VIEWS.AXIS,function(axis){_this44.updateAxis(axis);});view.on(_constants$3.EVENTS.VIEWS.WRITING_MODE,function(mode){_this44.updateWritingMode(mode);});// view.on(EVENTS.VIEWS.SHOWN, this.afterDisplayed.bind(this));
view.onDisplayed=this.afterDisplayed.bind(this);view.onResize=this.afterResized.bind(this);return view.display(this.request);}},{key:"append",value:function append(section){var _this45=this;var view=this.createView(section);view.on(_constants$3.EVENTS.VIEWS.RESIZED,function(bounds){view.expanded=true;});view.on(_constants$3.EVENTS.VIEWS.AXIS,function(axis){_this45.updateAxis(axis);});view.on(_constants$3.EVENTS.VIEWS.WRITING_MODE,function(mode){_this45.updateWritingMode(mode);});this.views.append(view);view.onDisplayed=this.afterDisplayed.bind(this);return view;}},{key:"prepend",value:function prepend(section){var _this46=this;var view=this.createView(section);view.on(_constants$3.EVENTS.VIEWS.RESIZED,function(bounds){_this46.counter(bounds);view.expanded=true;});view.on(_constants$3.EVENTS.VIEWS.AXIS,function(axis){_this46.updateAxis(axis);});view.on(_constants$3.EVENTS.VIEWS.WRITING_MODE,function(mode){_this46.updateWritingMode(mode);});this.views.prepend(view);view.onDisplayed=this.afterDisplayed.bind(this);return view;}},{key:"counter",value:function counter(bounds){if(this.settings.axis==="vertical"){this.scrollBy(0,bounds.heightDelta,true);}else{this.scrollBy(bounds.widthDelta,0,true);}}},{key:"update",value:function update(_offset){var container=this.bounds();var views=this.views.all();var viewsLength=views.length;var offset=typeof _offset!="undefined"?_offset:this.settings.offset||0;var isVisible;var view;var updating=new _core$5.defer();var promises=[];for(var i=0;i<viewsLength;i++){view=views[i];isVisible=this.isVisible(view,offset,offset,container);if(isVisible===true){// console.log("visible " + view.index, view.displayed);
if(!view.displayed){var displayed=view.display(this.request).then(function(view){view.show();},function(err){view.hide();});promises.push(displayed);}else{view.show();}}else{this.q.enqueue(view.destroy.bind(view));// console.log("hidden " + view.index, view.displayed);
clearTimeout(this.trimTimeout);this.trimTimeout=setTimeout(function(){this.q.enqueue(this.trim.bind(this));}.bind(this),250);}}if(promises.length){return Promise.all(promises).catch(function(err){updating.reject(err);});}else{updating.resolve();return updating.promise;}}},{key:"check",value:function check(_offsetLeft,_offsetTop){var _this47=this;var checking=new _core$5.defer();var newViews=[];var horizontal=this.settings.axis==="horizontal";var delta=this.settings.offset||0;if(_offsetLeft&&horizontal){delta=_offsetLeft;}if(_offsetTop&&!horizontal){delta=_offsetTop;}var bounds=this._bounds;// bounds saved this until resize
var offset=horizontal?this.scrollLeft:this.scrollTop;var visibleLength=horizontal?Math.floor(bounds.width):bounds.height;var contentLength=horizontal?this.container.scrollWidth:this.container.scrollHeight;var writingMode=this.writingMode&&this.writingMode.indexOf("vertical")===0?"vertical":"horizontal";var rtlScrollType=this.settings.rtlScrollType;var rtl=this.settings.direction==="rtl";if(!this.settings.fullsize){// Scroll offset starts at width of element
if(rtl&&rtlScrollType==="default"&&writingMode==="horizontal"){offset=contentLength-visibleLength-offset;}// Scroll offset starts at 0 and goes negative
if(rtl&&rtlScrollType==="negative"&&writingMode==="horizontal"){offset=offset*-1;}}else{// Scroll offset starts at 0 and goes negative
if(horizontal&&rtl&&rtlScrollType==="negative"||!horizontal&&rtl&&rtlScrollType==="default"){offset=offset*-1;}}var prepend=function prepend(){var first=_this47.views.first();var prev=first&&first.section.prev();if(prev){newViews.push(_this47.prepend(prev));}};var append=function append(){var last=_this47.views.last();var next=last&&last.section.next();if(next){newViews.push(_this47.append(next));}};var end=offset+visibleLength+delta;var start=offset-delta;if(end>=contentLength){append();}if(start<0){prepend();}var promises=newViews.map(function(view){return view.display(_this47.request);});if(newViews.length){return Promise.all(promises).then(function(){return _this47.check();}).then(function(){// Check to see if anything new is on screen after rendering
return _this47.update(delta);},function(err){return err;});}else{this.q.enqueue(function(){this.update();}.bind(this));checking.resolve(false);return checking.promise;}}},{key:"trim",value:function trim(){var task=new _core$5.defer();var displayed=this.views.displayed();var first=displayed[0];var last=displayed[displayed.length-1];var firstIndex=this.views.indexOf(first);var lastIndex=this.views.indexOf(last);var above=this.views.slice(0,firstIndex);var below=this.views.slice(lastIndex+1);// Erase all but last above
for(var i=0;i<above.length-1;i++){this.erase(above[i],above);}// Erase all except first below
for(var j=1;j<below.length;j++){this.erase(below[j]);}task.resolve();return task.promise;}},{key:"erase",value:function erase(view,above){//Trim
var prevTop;var prevLeft;if(!this.settings.fullsize){prevTop=this.container.scrollTop;prevLeft=this.container.scrollLeft;}else{prevTop=window.scrollY;prevLeft=window.scrollX;}var bounds=view.bounds();this.views.remove(view);if(above){if(this.settings.axis==="vertical"){this.scrollTo(0,prevTop-bounds.height,true);}else{if(this.settings.direction==='rtl'){if(!this.settings.fullsize){this.scrollTo(prevLeft,0,true);}else{this.scrollTo(prevLeft+Math.floor(bounds.width),0,true);}}else{this.scrollTo(prevLeft-Math.floor(bounds.width),0,true);}}}}},{key:"addEventListeners",value:function addEventListeners(stage){window.addEventListener("unload",function(e){this.ignore=true;// this.scrollTo(0,0);
this.destroy();}.bind(this));this.addScrollListeners();if(this.isPaginated&&this.settings.snap){this.snapper=new _snap.default(this,this.settings.snap&&_typeof3(this.settings.snap)==="object"&&this.settings.snap);}}},{key:"addScrollListeners",value:function addScrollListeners(){var scroller;this.tick=_core$5.requestAnimationFrame;var dir=this.settings.direction==="rtl"&&this.settings.rtlScrollType==="default"?-1:1;this.scrollDeltaVert=0;this.scrollDeltaHorz=0;if(!this.settings.fullsize){scroller=this.container;this.scrollTop=this.container.scrollTop;this.scrollLeft=this.container.scrollLeft;}else{scroller=window;this.scrollTop=window.scrollY*dir;this.scrollLeft=window.scrollX*dir;}this._onScroll=this.onScroll.bind(this);scroller.addEventListener("scroll",this._onScroll);this._scrolled=(0,_debounce.default)(this.scrolled.bind(this),30);// this.tick.call(window, this.onScroll.bind(this));
this.didScroll=false;}},{key:"removeEventListeners",value:function removeEventListeners(){var scroller;if(!this.settings.fullsize){scroller=this.container;}else{scroller=window;}scroller.removeEventListener("scroll",this._onScroll);this._onScroll=undefined;}},{key:"onScroll",value:function onScroll(){var scrollTop;var scrollLeft;var dir=this.settings.direction==="rtl"&&this.settings.rtlScrollType==="default"?-1:1;if(!this.settings.fullsize){scrollTop=this.container.scrollTop;scrollLeft=this.container.scrollLeft;}else{scrollTop=window.scrollY*dir;scrollLeft=window.scrollX*dir;}this.scrollTop=scrollTop;this.scrollLeft=scrollLeft;if(!this.ignore){this._scrolled();}else{this.ignore=false;}this.scrollDeltaVert+=Math.abs(scrollTop-this.prevScrollTop);this.scrollDeltaHorz+=Math.abs(scrollLeft-this.prevScrollLeft);this.prevScrollTop=scrollTop;this.prevScrollLeft=scrollLeft;clearTimeout(this.scrollTimeout);this.scrollTimeout=setTimeout(function(){this.scrollDeltaVert=0;this.scrollDeltaHorz=0;}.bind(this),150);clearTimeout(this.afterScrolled);this.didScroll=false;}},{key:"scrolled",value:function scrolled(){this.q.enqueue(function(){return this.check();}.bind(this));this.emit(_constants$3.EVENTS.MANAGERS.SCROLL,{top:this.scrollTop,left:this.scrollLeft});clearTimeout(this.afterScrolled);this.afterScrolled=setTimeout(function(){// Don't report scroll if we are about the snap
if(this.snapper&&this.snapper.supportsTouch&&this.snapper.needsSnap()){return;}this.emit(_constants$3.EVENTS.MANAGERS.SCROLLED,{top:this.scrollTop,left:this.scrollLeft});}.bind(this),this.settings.afterScrolledTimeout);}},{key:"next",value:function next(){var delta=this.layout.props.name==="pre-paginated"&&this.layout.props.spread?this.layout.props.delta*2:this.layout.props.delta;if(!this.views.length)return;if(this.isPaginated&&this.settings.axis==="horizontal"){this.scrollBy(delta,0,true);}else{this.scrollBy(0,this.layout.height,true);}this.q.enqueue(function(){return this.check();}.bind(this));}},{key:"prev",value:function prev(){var delta=this.layout.props.name==="pre-paginated"&&this.layout.props.spread?this.layout.props.delta*2:this.layout.props.delta;if(!this.views.length)return;if(this.isPaginated&&this.settings.axis==="horizontal"){this.scrollBy(-delta,0,true);}else{this.scrollBy(0,-this.layout.height,true);}this.q.enqueue(function(){return this.check();}.bind(this));}},{key:"updateFlow",value:function updateFlow(flow){if(this.rendered&&this.snapper){this.snapper.destroy();this.snapper=undefined;}_get3(_getPrototypeOf3(ContinuousViewManager.prototype),"updateFlow",this).call(this,flow,"scroll");if(this.rendered&&this.isPaginated&&this.settings.snap){this.snapper=new _snap.default(this,this.settings.snap&&_typeof3(this.settings.snap)==="object"&&this.settings.snap);}}},{key:"destroy",value:function destroy(){_get3(_getPrototypeOf3(ContinuousViewManager.prototype),"destroy",this).call(this);if(this.snapper){this.snapper.destroy();}}}]);return ContinuousViewManager;}(_default2.default);var _default$a=ContinuousViewManager;continuous.default=_default$a;Object.defineProperty(rendition,"__esModule",{value:true});rendition.default=void 0;var _eventEmitter$2=_interopRequireDefault$6(eventEmitter.exports);var _core$4=core;var _hook=_interopRequireDefault$6(hook);var _epubcfi$2=_interopRequireDefault$6(epubcfi);var _queue=_interopRequireDefault$6(queue);var _layout=_interopRequireDefault$6(layout);var _themes=_interopRequireDefault$6(themes);_interopRequireDefault$6(contents);var _annotations=_interopRequireDefault$6(annotations);var _constants$2=constants;var _iframe=_interopRequireDefault$6(iframe);var _index$1=_interopRequireDefault$6(_default$f);var _index2=_interopRequireDefault$6(continuous);function _interopRequireDefault$6(obj){return obj&&obj.__esModule?obj:{default:obj};}// import Mapping from "./mapping";
// Default Views
// Default View Managers
/**
			 * Displays an Epub as a series of Views for each Section.
			 * Requires Manager and View class to handle specifics of rendering
			 * the section content.
			 * @class
			 * @param {Book} book
			 * @param {object} [options]
			 * @param {number} [options.width]
			 * @param {number} [options.height]
			 * @param {string} [options.ignoreClass] class for the cfi parser to ignore
			 * @param {string | function | object} [options.manager='default']
			 * @param {string | function} [options.view='iframe']
			 * @param {string} [options.layout] layout to force
			 * @param {string} [options.spread] force spread value
			 * @param {number} [options.minSpreadWidth] overridden by spread: none (never) / both (always)
			 * @param {string} [options.stylesheet] url of stylesheet to be injected
			 * @param {boolean} [options.resizeOnOrientationChange] false to disable orientation events
			 * @param {string} [options.script] url of script to be injected
			 * @param {boolean | object} [options.snap=false] use snap scrolling
			 * @param {string} [options.defaultDirection='ltr'] default text direction
			 * @param {boolean} [options.allowScriptedContent=false] enable running scripts in content
			 * @param {boolean} [options.allowPopups=false] enable opening popup in content
			 */var Rendition=/*#__PURE__*/function(){function Rendition(book,options){_classCallCheck3(this,Rendition);this.settings=(0,_core$4.extend)(this.settings||{},{width:null,height:null,ignoreClass:"",manager:"default",view:"iframe",flow:null,layout:null,spread:null,minSpreadWidth:800,stylesheet:null,resizeOnOrientationChange:true,script:null,snap:false,defaultDirection:"ltr",allowScriptedContent:false,allowPopups:false});(0,_core$4.extend)(this.settings,options);if(_typeof3(this.settings.manager)==="object"){this.manager=this.settings.manager;}this.book=book;/**
			     * Adds Hook methods to the Rendition prototype
			     * @member {object} hooks
			     * @property {Hook} hooks.content
			     * @memberof Rendition
			     */this.hooks={};this.hooks.display=new _hook.default(this);this.hooks.serialize=new _hook.default(this);this.hooks.content=new _hook.default(this);this.hooks.unloaded=new _hook.default(this);this.hooks.layout=new _hook.default(this);this.hooks.render=new _hook.default(this);this.hooks.show=new _hook.default(this);this.hooks.content.register(this.handleLinks.bind(this));this.hooks.content.register(this.passEvents.bind(this));this.hooks.content.register(this.adjustImages.bind(this));this.book.spine.hooks.content.register(this.injectIdentifier.bind(this));if(this.settings.stylesheet){this.book.spine.hooks.content.register(this.injectStylesheet.bind(this));}if(this.settings.script){this.book.spine.hooks.content.register(this.injectScript.bind(this));}/**
			     * @member {Themes} themes
			     * @memberof Rendition
			     */this.themes=new _themes.default(this);/**
			     * @member {Annotations} annotations
			     * @memberof Rendition
			     */this.annotations=new _annotations.default(this);this.epubcfi=new _epubcfi$2.default();this.q=new _queue.default(this);/**
			     * A Rendered Location Range
			     * @typedef location
			     * @type {Object}
			     * @property {object} start
			     * @property {string} start.index
			     * @property {string} start.href
			     * @property {object} start.displayed
			     * @property {EpubCFI} start.cfi
			     * @property {number} start.location
			     * @property {number} start.percentage
			     * @property {number} start.displayed.page
			     * @property {number} start.displayed.total
			     * @property {object} end
			     * @property {string} end.index
			     * @property {string} end.href
			     * @property {object} end.displayed
			     * @property {EpubCFI} end.cfi
			     * @property {number} end.location
			     * @property {number} end.percentage
			     * @property {number} end.displayed.page
			     * @property {number} end.displayed.total
			     * @property {boolean} atStart
			     * @property {boolean} atEnd
			     * @memberof Rendition
			     */this.location=undefined;// Hold queue until book is opened
this.q.enqueue(this.book.opened);this.starting=new _core$4.defer();/**
			     * @member {promise} started returns after the rendition has started
			     * @memberof Rendition
			     */this.started=this.starting.promise;// Block the queue until rendering is started
this.q.enqueue(this.start);}/**
			   * Set the manager function
			   * @param {function} manager
			   */_createClass3(Rendition,[{key:"setManager",value:function setManager(manager){this.manager=manager;}/**
			   * Require the manager from passed string, or as a class function
			   * @param  {string|object} manager [description]
			   * @return {method}
			   */},{key:"requireManager",value:function requireManager(manager){var viewManager;// If manager is a string, try to load from imported managers
if(typeof manager==="string"&&manager==="default"){viewManager=_index$1.default;}else if(typeof manager==="string"&&manager==="continuous"){viewManager=_index2.default;}else{// otherwise, assume we were passed a class function
viewManager=manager;}return viewManager;}/**
			   * Require the view from passed string, or as a class function
			   * @param  {string|object} view
			   * @return {view}
			   */},{key:"requireView",value:function requireView(view){var View;// If view is a string, try to load from imported views,
if(typeof view=="string"&&view==="iframe"){View=_iframe.default;}else{// otherwise, assume we were passed a class function
View=view;}return View;}/**
			   * Start the rendering
			   * @return {Promise} rendering has started
			   */},{key:"start",value:function start(){if(!this.settings.layout&&(this.book.package.metadata.layout==="pre-paginated"||this.book.displayOptions.fixedLayout==="true")){this.settings.layout="pre-paginated";}switch(this.book.package.metadata.spread){case'none':this.settings.spread='none';break;case'both':this.settings.spread=true;break;}if(!this.manager){this.ViewManager=this.requireManager(this.settings.manager);this.View=this.requireView(this.settings.view);this.manager=new this.ViewManager({view:this.View,queue:this.q,request:this.book.load.bind(this.book),settings:this.settings});}this.direction(this.book.package.metadata.direction||this.settings.defaultDirection);// Parse metadata to get layout props
this.settings.globalLayoutProperties=this.determineLayoutProperties(this.book.package.metadata);this.flow(this.settings.globalLayoutProperties.flow);this.layout(this.settings.globalLayoutProperties);// Listen for displayed views
this.manager.on(_constants$2.EVENTS.MANAGERS.ADDED,this.afterDisplayed.bind(this));this.manager.on(_constants$2.EVENTS.MANAGERS.REMOVED,this.afterRemoved.bind(this));// Listen for resizing
this.manager.on(_constants$2.EVENTS.MANAGERS.RESIZED,this.onResized.bind(this));// Listen for rotation
this.manager.on(_constants$2.EVENTS.MANAGERS.ORIENTATION_CHANGE,this.onOrientationChange.bind(this));// Listen for scroll changes
this.manager.on(_constants$2.EVENTS.MANAGERS.SCROLLED,this.reportLocation.bind(this));/**
			     * Emit that rendering has started
			     * @event started
			     * @memberof Rendition
			     */this.emit(_constants$2.EVENTS.RENDITION.STARTED);// Start processing queue
this.starting.resolve();}/**
			   * Call to attach the container to an element in the dom
			   * Container must be attached before rendering can begin
			   * @param  {element} element to attach to
			   * @return {Promise}
			   */},{key:"attachTo",value:function attachTo(element){return this.q.enqueue(function(){// Start rendering
this.manager.render(element,{"width":this.settings.width,"height":this.settings.height});/**
			       * Emit that rendering has attached to an element
			       * @event attached
			       * @memberof Rendition
			       */this.emit(_constants$2.EVENTS.RENDITION.ATTACHED);}.bind(this));}/**
			   * Display a point in the book
			   * The request will be added to the rendering Queue,
			   * so it will wait until book is opened, rendering started
			   * and all other rendering tasks have finished to be called.
			   * @param  {string} target Url or EpubCFI
			   * @return {Promise}
			   */},{key:"display",value:function display(target){if(this.displaying){this.displaying.resolve();}return this.q.enqueue(this._display,target);}/**
			   * Tells the manager what to display immediately
			   * @private
			   * @param  {string} target Url or EpubCFI
			   * @return {Promise}
			   */},{key:"_display",value:function _display(target){var _this48=this;if(!this.book){return;}this.epubcfi.isCfiString(target);var displaying=new _core$4.defer();var displayed=displaying.promise;var section;this.displaying=displaying;// Check if this is a book percentage
if(this.book.locations.length()&&(0,_core$4.isFloat)(target)){target=this.book.locations.cfiFromPercentage(parseFloat(target));}section=this.book.spine.get(target);if(!section){displaying.reject(new Error("No Section Found"));return displayed;}this.manager.display(section,target).then(function(){displaying.resolve(section);_this48.displaying=undefined;/**
			       * Emit that a section has been displayed
			       * @event displayed
			       * @param {Section} section
			       * @memberof Rendition
			       */_this48.emit(_constants$2.EVENTS.RENDITION.DISPLAYED,section);_this48.reportLocation();},function(err){/**
			       * Emit that has been an error displaying
			       * @event displayError
			       * @param {Section} section
			       * @memberof Rendition
			       */_this48.emit(_constants$2.EVENTS.RENDITION.DISPLAY_ERROR,err);});return displayed;}/*
			  render(view, show) {
			  		// view.onLayout = this.layout.format.bind(this.layout);
			  	view.create();
			  		// Fit to size of the container, apply padding
			  	this.manager.resizeView(view);
			  		// Render Chain
			  	return view.section.render(this.book.request)
			  		.then(function(contents){
			  			return view.load(contents);
			  		}.bind(this))
			  		.then(function(doc){
			  			return this.hooks.content.trigger(view, this);
			  		}.bind(this))
			  		.then(function(){
			  			this.layout.format(view.contents);
			  			return this.hooks.layout.trigger(view, this);
			  		}.bind(this))
			  		.then(function(){
			  			return view.display();
			  		}.bind(this))
			  		.then(function(){
			  			return this.hooks.render.trigger(view, this);
			  		}.bind(this))
			  		.then(function(){
			  			if(show !== false) {
			  				this.q.enqueue(function(view){
			  					view.show();
			  				}, view);
			  			}
			  			// this.map = new Map(view, this.layout);
			  			this.hooks.show.trigger(view, this);
			  			this.trigger("rendered", view.section);
			  			}.bind(this))
			  		.catch(function(e){
			  			this.trigger("loaderror", e);
			  		}.bind(this));
			  	}
			  */ /**
			   * Report what section has been displayed
			   * @private
			   * @param  {*} view
			   */},{key:"afterDisplayed",value:function afterDisplayed(view){var _this49=this;view.on(_constants$2.EVENTS.VIEWS.MARK_CLICKED,function(cfiRange,data){return _this49.triggerMarkEvent(cfiRange,data,view.contents);});this.hooks.render.trigger(view,this).then(function(){if(view.contents){_this49.hooks.content.trigger(view.contents,_this49).then(function(){/**
			           * Emit that a section has been rendered
			           * @event rendered
			           * @param {Section} section
			           * @param {View} view
			           * @memberof Rendition
			           */_this49.emit(_constants$2.EVENTS.RENDITION.RENDERED,view.section,view);});}else{_this49.emit(_constants$2.EVENTS.RENDITION.RENDERED,view.section,view);}});}/**
			   * Report what has been removed
			   * @private
			   * @param  {*} view
			   */},{key:"afterRemoved",value:function afterRemoved(view){var _this50=this;this.hooks.unloaded.trigger(view,this).then(function(){/**
			       * Emit that a section has been removed
			       * @event removed
			       * @param {Section} section
			       * @param {View} view
			       * @memberof Rendition
			       */_this50.emit(_constants$2.EVENTS.RENDITION.REMOVED,view.section,view);});}/**
			   * Report resize events and display the last seen location
			   * @private
			   */},{key:"onResized",value:function onResized(size,epubcfi){/**
			     * Emit that the rendition has been resized
			     * @event resized
			     * @param {number} width
			     * @param {height} height
			     * @param {string} epubcfi (optional)
			     * @memberof Rendition
			     */this.emit(_constants$2.EVENTS.RENDITION.RESIZED,{width:size.width,height:size.height},epubcfi);if(this.location&&this.location.start){this.display(epubcfi||this.location.start.cfi);}}/**
			   * Report orientation events and display the last seen location
			   * @private
			   */},{key:"onOrientationChange",value:function onOrientationChange(orientation){/**
			     * Emit that the rendition has been rotated
			     * @event orientationchange
			     * @param {string} orientation
			     * @memberof Rendition
			     */this.emit(_constants$2.EVENTS.RENDITION.ORIENTATION_CHANGE,orientation);}/**
			   * Move the Rendition to a specific offset
			   * Usually you would be better off calling display()
			   * @param {object} offset
			   */},{key:"moveTo",value:function moveTo(offset){this.manager.moveTo(offset);}/**
			   * Trigger a resize of the views
			   * @param {number} [width]
			   * @param {number} [height]
			   * @param {string} [epubcfi] (optional)
			   */},{key:"resize",value:function resize(width,height,epubcfi){if(width){this.settings.width=width;}if(height){this.settings.height=height;}this.manager.resize(width,height,epubcfi);}/**
			   * Clear all rendered views
			   */},{key:"clear",value:function clear(){this.manager.clear();}/**
			   * Go to the next "page" in the rendition
			   * @return {Promise}
			   */},{key:"next",value:function next(){return this.q.enqueue(this.manager.next.bind(this.manager)).then(this.reportLocation.bind(this));}/**
			   * Go to the previous "page" in the rendition
			   * @return {Promise}
			   */},{key:"prev",value:function prev(){return this.q.enqueue(this.manager.prev.bind(this.manager)).then(this.reportLocation.bind(this));}//-- http://www.idpf.org/epub/301/spec/epub-publications.html#meta-properties-rendering
/**
			   * Determine the Layout properties from metadata and settings
			   * @private
			   * @param  {object} metadata
			   * @return {object} properties
			   */},{key:"determineLayoutProperties",value:function determineLayoutProperties(metadata){var properties;var layout=this.settings.layout||metadata.layout||"reflowable";var spread=this.settings.spread||metadata.spread||"auto";var orientation=this.settings.orientation||metadata.orientation||"auto";var flow=this.settings.flow||metadata.flow||"auto";var viewport=metadata.viewport||"";var minSpreadWidth=this.settings.minSpreadWidth||metadata.minSpreadWidth||800;var direction=this.settings.direction||metadata.direction||"ltr";if((this.settings.width===0||this.settings.width>0)&&(this.settings.height===0||this.settings.height>0));properties={layout:layout,spread:spread,orientation:orientation,flow:flow,viewport:viewport,minSpreadWidth:minSpreadWidth,direction:direction};return properties;}/**
			   * Adjust the flow of the rendition to paginated or scrolled
			   * (scrolled-continuous vs scrolled-doc are handled by different view managers)
			   * @param  {string} flow
			   */},{key:"flow",value:function flow(_flow3){var _flow=_flow3;if(_flow3==="scrolled"||_flow3==="scrolled-doc"||_flow3==="scrolled-continuous"){_flow="scrolled";}if(_flow3==="auto"||_flow3==="paginated"){_flow="paginated";}this.settings.flow=_flow3;if(this._layout){this._layout.flow(_flow);}if(this.manager&&this._layout){this.manager.applyLayout(this._layout);}if(this.manager){this.manager.updateFlow(_flow);}if(this.manager&&this.manager.isRendered()&&this.location){this.manager.clear();this.display(this.location.start.cfi);}}/**
			   * Adjust the layout of the rendition to reflowable or pre-paginated
			   * @param  {object} settings
			   */},{key:"layout",value:function layout(settings){var _this51=this;if(settings){this._layout=new _layout.default(settings);this._layout.spread(settings.spread,this.settings.minSpreadWidth);// this.mapping = new Mapping(this._layout.props);
this._layout.on(_constants$2.EVENTS.LAYOUT.UPDATED,function(props,changed){_this51.emit(_constants$2.EVENTS.RENDITION.LAYOUT,props,changed);});}if(this.manager&&this._layout){this.manager.applyLayout(this._layout);}return this._layout;}/**
			   * Adjust if the rendition uses spreads
			   * @param  {string} spread none | auto (TODO: implement landscape, portrait, both)
			   * @param  {int} [min] min width to use spreads at
			   */},{key:"spread",value:function spread(_spread2,min){this.settings.spread=_spread2;if(min){this.settings.minSpreadWidth=min;}if(this._layout){this._layout.spread(_spread2,min);}if(this.manager&&this.manager.isRendered()){this.manager.updateLayout();}}/**
			   * Adjust the direction of the rendition
			   * @param  {string} dir
			   */},{key:"direction",value:function direction(dir){this.settings.direction=dir||"ltr";if(this.manager){this.manager.direction(this.settings.direction);}if(this.manager&&this.manager.isRendered()&&this.location){this.manager.clear();this.display(this.location.start.cfi);}}/**
			   * Report the current location
			   * @fires relocated
			   * @fires locationChanged
			   */},{key:"reportLocation",value:function reportLocation(){return this.q.enqueue(function reportedLocation(){requestAnimationFrame(function reportedLocationAfterRAF(){var location=this.manager.currentLocation();if(location&&location.then&&typeof location.then==="function"){location.then(function(result){var located=this.located(result);if(!located||!located.start||!located.end){return;}this.location=located;this.emit(_constants$2.EVENTS.RENDITION.LOCATION_CHANGED,{index:this.location.start.index,href:this.location.start.href,start:this.location.start.cfi,end:this.location.end.cfi,percentage:this.location.start.percentage});this.emit(_constants$2.EVENTS.RENDITION.RELOCATED,this.location);}.bind(this));}else if(location){var located=this.located(location);if(!located||!located.start||!located.end){return;}this.location=located;/**
			           * @event locationChanged
			           * @deprecated
			           * @type {object}
			           * @property {number} index
			           * @property {string} href
			           * @property {EpubCFI} start
			           * @property {EpubCFI} end
			           * @property {number} percentage
			           * @memberof Rendition
			           */this.emit(_constants$2.EVENTS.RENDITION.LOCATION_CHANGED,{index:this.location.start.index,href:this.location.start.href,start:this.location.start.cfi,end:this.location.end.cfi,percentage:this.location.start.percentage});/**
			           * @event relocated
			           * @type {displayedLocation}
			           * @memberof Rendition
			           */this.emit(_constants$2.EVENTS.RENDITION.RELOCATED,this.location);}}.bind(this));}.bind(this));}/**
			   * Get the Current Location object
			   * @return {displayedLocation | promise} location (may be a promise)
			   */},{key:"currentLocation",value:function currentLocation(){var location=this.manager.currentLocation();if(location&&location.then&&typeof location.then==="function"){location.then(function(result){var located=this.located(result);return located;}.bind(this));}else if(location){var located=this.located(location);return located;}}/**
			   * Creates a Rendition#locationRange from location
			   * passed by the Manager
			   * @returns {displayedLocation}
			   * @private
			   */},{key:"located",value:function located(location){if(!location.length){return{};}var start=location[0];var end=location[location.length-1];var located={start:{index:start.index,href:start.href,cfi:start.mapping.start,displayed:{page:start.pages[0]||1,total:start.totalPages}},end:{index:end.index,href:end.href,cfi:end.mapping.end,displayed:{page:end.pages[end.pages.length-1]||1,total:end.totalPages}}};var locationStart=this.book.locations.locationFromCfi(start.mapping.start);var locationEnd=this.book.locations.locationFromCfi(end.mapping.end);if(locationStart!=null){located.start.location=locationStart;located.start.percentage=this.book.locations.percentageFromLocation(locationStart);}if(locationEnd!=null){located.end.location=locationEnd;located.end.percentage=this.book.locations.percentageFromLocation(locationEnd);}var pageStart=this.book.pageList.pageFromCfi(start.mapping.start);var pageEnd=this.book.pageList.pageFromCfi(end.mapping.end);if(pageStart!=-1){located.start.page=pageStart;}if(pageEnd!=-1){located.end.page=pageEnd;}if(end.index===this.book.spine.last().index&&located.end.displayed.page>=located.end.displayed.total){located.atEnd=true;}if(start.index===this.book.spine.first().index&&located.start.displayed.page===1){located.atStart=true;}return located;}/**
			   * Remove and Clean Up the Rendition
			   */},{key:"destroy",value:function destroy(){// Clear the queue
// this.q.clear();
// this.q = undefined;
this.manager&&this.manager.destroy();this.book=undefined;// this.views = null;
// this.hooks.display.clear();
// this.hooks.serialize.clear();
// this.hooks.content.clear();
// this.hooks.layout.clear();
// this.hooks.render.clear();
// this.hooks.show.clear();
// this.hooks = {};
// this.themes.destroy();
// this.themes = undefined;
// this.epubcfi = undefined;
// this.starting = undefined;
// this.started = undefined;
}/**
			   * Pass the events from a view's Contents
			   * @private
			   * @param  {Contents} view contents
			   */},{key:"passEvents",value:function passEvents(contents){var _this52=this;_constants$2.DOM_EVENTS.forEach(function(e){contents.on(e,function(ev){return _this52.triggerViewEvent(ev,contents);});});contents.on(_constants$2.EVENTS.CONTENTS.SELECTED,function(e){return _this52.triggerSelectedEvent(e,contents);});}/**
			   * Emit events passed by a view
			   * @private
			   * @param  {event} e
			   */},{key:"triggerViewEvent",value:function triggerViewEvent(e,contents){this.emit(e.type,e,contents);}/**
			   * Emit a selection event's CFI Range passed from a a view
			   * @private
			   * @param  {string} cfirange
			   */},{key:"triggerSelectedEvent",value:function triggerSelectedEvent(cfirange,contents){/**
			     * Emit that a text selection has occurred
			     * @event selected
			     * @param {string} cfirange
			     * @param {Contents} contents
			     * @memberof Rendition
			     */this.emit(_constants$2.EVENTS.RENDITION.SELECTED,cfirange,contents);}/**
			   * Emit a markClicked event with the cfiRange and data from a mark
			   * @private
			   * @param  {EpubCFI} cfirange
			   */},{key:"triggerMarkEvent",value:function triggerMarkEvent(cfiRange,data,contents){/**
			     * Emit that a mark was clicked
			     * @event markClicked
			     * @param {EpubCFI} cfirange
			     * @param {object} data
			     * @param {Contents} contents
			     * @memberof Rendition
			     */this.emit(_constants$2.EVENTS.RENDITION.MARK_CLICKED,cfiRange,data,contents);}/**
			   * Get a Range from a Visible CFI
			   * @param  {string} cfi EpubCfi String
			   * @param  {string} ignoreClass
			   * @return {range}
			   */},{key:"getRange",value:function getRange(cfi,ignoreClass){var _cfi=new _epubcfi$2.default(cfi);var found=this.manager.visible().filter(function(view){if(_cfi.spinePos===view.index)return true;});// Should only every return 1 item
if(found.length){return found[0].contents.range(_cfi,ignoreClass);}}/**
			   * Hook to adjust images to fit in columns
			   * @param  {Contents} contents
			   * @private
			   */},{key:"adjustImages",value:function adjustImages(contents){if(this._layout.name==="pre-paginated"){return new Promise(function(resolve){resolve();});}var computed=contents.window.getComputedStyle(contents.content,null);var height=(contents.content.offsetHeight-(parseFloat(computed.paddingTop)+parseFloat(computed.paddingBottom)))*.95;var horizontalPadding=parseFloat(computed.paddingLeft)+parseFloat(computed.paddingRight);contents.addStylesheetRules({"img":{"max-width":(this._layout.columnWidth?this._layout.columnWidth-horizontalPadding+"px":"100%")+"!important","max-height":height+"px"+"!important","object-fit":"contain","page-break-inside":"avoid","break-inside":"avoid","box-sizing":"border-box"},"svg":{"max-width":(this._layout.columnWidth?this._layout.columnWidth-horizontalPadding+"px":"100%")+"!important","max-height":height+"px"+"!important","page-break-inside":"avoid","break-inside":"avoid"}});return new Promise(function(resolve,reject){// Wait to apply
setTimeout(function(){resolve();},1);});}/**
			   * Get the Contents object of each rendered view
			   * @returns {Contents[]}
			   */},{key:"getContents",value:function getContents(){return this.manager?this.manager.getContents():[];}/**
			   * Get the views member from the manager
			   * @returns {Views}
			   */},{key:"views",value:function views(){var views=this.manager?this.manager.views:undefined;return views||[];}/**
			   * Hook to handle link clicks in rendered content
			   * @param  {Contents} contents
			   * @private
			   */},{key:"handleLinks",value:function handleLinks(contents){var _this53=this;if(contents){contents.on(_constants$2.EVENTS.CONTENTS.LINK_CLICKED,function(href){var relative=_this53.book.path.relative(href);_this53.display(relative);});}}/**
			   * Hook to handle injecting stylesheet before
			   * a Section is serialized
			   * @param  {document} doc
			   * @param  {Section} section
			   * @private
			   */},{key:"injectStylesheet",value:function injectStylesheet(doc,section){var style=doc.createElement("link");style.setAttribute("type","text/css");style.setAttribute("rel","stylesheet");style.setAttribute("href",this.settings.stylesheet);doc.getElementsByTagName("head")[0].appendChild(style);}/**
			   * Hook to handle injecting scripts before
			   * a Section is serialized
			   * @param  {document} doc
			   * @param  {Section} section
			   * @private
			   */},{key:"injectScript",value:function injectScript(doc,section){var script=doc.createElement("script");script.setAttribute("type","text/javascript");script.setAttribute("src",this.settings.script);script.textContent=" ";// Needed to prevent self closing tag
doc.getElementsByTagName("head")[0].appendChild(script);}/**
			   * Hook to handle the document identifier before
			   * a Section is serialized
			   * @param  {document} doc
			   * @param  {Section} section
			   * @private
			   */},{key:"injectIdentifier",value:function injectIdentifier(doc,section){var ident=this.book.packaging.metadata.identifier;var meta=doc.createElement("meta");meta.setAttribute("name","dc.relation.ispartof");if(ident){meta.setAttribute("content",ident);}doc.getElementsByTagName("head")[0].appendChild(meta);}}]);return Rendition;}();//-- Enable binding events to Renderer
(0,_eventEmitter$2.default)(Rendition.prototype);var _default$9=Rendition;rendition.default=_default$9;var archive={};var jszip={exports:{}};/*!

			JSZip v3.7.1 - A JavaScript class for generating and reading zip files
			<http://stuartk.com/jszip>

			(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
			Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/master/LICENSE.markdown.

			JSZip uses the library pako released under the MIT license :
			https://github.com/nodeca/pako/blob/master/LICENSE
			*/(function(module,exports){(function(f){{module.exports=f();}})(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof commonjsRequire=="function"&&commonjsRequire;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f;}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e);},l,l.exports,e,t,n,r);}return n[o].exports;}var i=typeof commonjsRequire=="function"&&commonjsRequire;for(var o=0;o<r.length;o++){s(r[o]);}return s;}({1:[function(require,module,exports){var utils=require('./utils');var support=require('./support');// private property
var _keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";// public method for encoding
exports.encode=function(input){var output=[];var chr1,chr2,chr3,enc1,enc2,enc3,enc4;var i=0,len=input.length,remainingBytes=len;var isArray=utils.getTypeOf(input)!=="string";while(i<input.length){remainingBytes=len-i;if(!isArray){chr1=input.charCodeAt(i++);chr2=i<len?input.charCodeAt(i++):0;chr3=i<len?input.charCodeAt(i++):0;}else{chr1=input[i++];chr2=i<len?input[i++]:0;chr3=i<len?input[i++]:0;}enc1=chr1>>2;enc2=(chr1&3)<<4|chr2>>4;enc3=remainingBytes>1?(chr2&15)<<2|chr3>>6:64;enc4=remainingBytes>2?chr3&63:64;output.push(_keyStr.charAt(enc1)+_keyStr.charAt(enc2)+_keyStr.charAt(enc3)+_keyStr.charAt(enc4));}return output.join("");};// public method for decoding
exports.decode=function(input){var chr1,chr2,chr3;var enc1,enc2,enc3,enc4;var i=0,resultIndex=0;var dataUrlPrefix="data:";if(input.substr(0,dataUrlPrefix.length)===dataUrlPrefix){// This is a common error: people give a data url
// (data:image/png;base64,iVBOR...) with a {base64: true} and
// wonders why things don't work.
// We can detect that the string input looks like a data url but we
// *can't* be sure it is one: removing everything up to the comma would
// be too dangerous.
throw new Error("Invalid base64 input, it looks like a data url.");}input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");var totalLength=input.length*3/4;if(input.charAt(input.length-1)===_keyStr.charAt(64)){totalLength--;}if(input.charAt(input.length-2)===_keyStr.charAt(64)){totalLength--;}if(totalLength%1!==0){// totalLength is not an integer, the length does not match a valid
// base64 content. That can happen if:
// - the input is not a base64 content
// - the input is *almost* a base64 content, with a extra chars at the
//   beginning or at the end
// - the input uses a base64 variant (base64url for example)
throw new Error("Invalid base64 input, bad content length.");}var output;if(support.uint8array){output=new Uint8Array(totalLength|0);}else{output=new Array(totalLength|0);}while(i<input.length){enc1=_keyStr.indexOf(input.charAt(i++));enc2=_keyStr.indexOf(input.charAt(i++));enc3=_keyStr.indexOf(input.charAt(i++));enc4=_keyStr.indexOf(input.charAt(i++));chr1=enc1<<2|enc2>>4;chr2=(enc2&15)<<4|enc3>>2;chr3=(enc3&3)<<6|enc4;output[resultIndex++]=chr1;if(enc3!==64){output[resultIndex++]=chr2;}if(enc4!==64){output[resultIndex++]=chr3;}}return output;};},{"./support":30,"./utils":32}],2:[function(require,module,exports){var external=require("./external");var DataWorker=require('./stream/DataWorker');var Crc32Probe=require('./stream/Crc32Probe');var DataLengthProbe=require('./stream/DataLengthProbe');/**
			 * Represent a compressed object, with everything needed to decompress it.
			 * @constructor
			 * @param {number} compressedSize the size of the data compressed.
			 * @param {number} uncompressedSize the size of the data after decompression.
			 * @param {number} crc32 the crc32 of the decompressed file.
			 * @param {object} compression the type of compression, see lib/compressions.js.
			 * @param {String|ArrayBuffer|Uint8Array|Buffer} data the compressed data.
			 */function CompressedObject(compressedSize,uncompressedSize,crc32,compression,data){this.compressedSize=compressedSize;this.uncompressedSize=uncompressedSize;this.crc32=crc32;this.compression=compression;this.compressedContent=data;}CompressedObject.prototype={/**
			     * Create a worker to get the uncompressed content.
			     * @return {GenericWorker} the worker.
			     */getContentWorker:function getContentWorker(){var worker=new DataWorker(external.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new DataLengthProbe("data_length"));var that=this;worker.on("end",function(){if(this.streamInfo['data_length']!==that.uncompressedSize){throw new Error("Bug : uncompressed data size mismatch");}});return worker;},/**
			     * Create a worker to get the compressed content.
			     * @return {GenericWorker} the worker.
			     */getCompressedWorker:function getCompressedWorker(){return new DataWorker(external.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression);}};/**
			 * Chain the given worker with other workers to compress the content with the
			 * given compression.
			 * @param {GenericWorker} uncompressedWorker the worker to pipe.
			 * @param {Object} compression the compression object.
			 * @param {Object} compressionOptions the options to use when compressing.
			 * @return {GenericWorker} the new worker compressing the content.
			 */CompressedObject.createWorkerFrom=function(uncompressedWorker,compression,compressionOptions){return uncompressedWorker.pipe(new Crc32Probe()).pipe(new DataLengthProbe("uncompressedSize")).pipe(compression.compressWorker(compressionOptions)).pipe(new DataLengthProbe("compressedSize")).withStreamInfo("compression",compression);};module.exports=CompressedObject;},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(require,module,exports){var GenericWorker=require("./stream/GenericWorker");exports.STORE={magic:"\x00\x00",compressWorker:function compressWorker(compressionOptions){return new GenericWorker("STORE compression");},uncompressWorker:function uncompressWorker(){return new GenericWorker("STORE decompression");}};exports.DEFLATE=require('./flate');},{"./flate":7,"./stream/GenericWorker":28}],4:[function(require,module,exports){var utils=require('./utils');/**
			 * The following functions come from pako, from pako/lib/zlib/crc32.js
			 * released under the MIT license, see pako https://github.com/nodeca/pako/
			 */ // Use ordinary array, since untyped makes no boost here
function makeTable(){var c,table=[];for(var n=0;n<256;n++){c=n;for(var k=0;k<8;k++){c=c&1?0xEDB88320^c>>>1:c>>>1;}table[n]=c;}return table;}// Create table on load. Just 255 signed longs. Not a problem.
var crcTable=makeTable();function crc32(crc,buf,len,pos){var t=crcTable,end=pos+len;crc=crc^-1;for(var i=pos;i<end;i++){crc=crc>>>8^t[(crc^buf[i])&0xFF];}return crc^-1;// >>> 0;
}// That's all for the pako functions.
/**
			 * Compute the crc32 of a string.
			 * This is almost the same as the function crc32, but for strings. Using the
			 * same function for the two use cases leads to horrible performances.
			 * @param {Number} crc the starting value of the crc.
			 * @param {String} str the string to use.
			 * @param {Number} len the length of the string.
			 * @param {Number} pos the starting position for the crc32 computation.
			 * @return {Number} the computed crc32.
			 */function crc32str(crc,str,len,pos){var t=crcTable,end=pos+len;crc=crc^-1;for(var i=pos;i<end;i++){crc=crc>>>8^t[(crc^str.charCodeAt(i))&0xFF];}return crc^-1;// >>> 0;
}module.exports=function crc32wrapper(input,crc){if(typeof input==="undefined"||!input.length){return 0;}var isArray=utils.getTypeOf(input)!=="string";if(isArray){return crc32(crc|0,input,input.length,0);}else{return crc32str(crc|0,input,input.length,0);}};},{"./utils":32}],5:[function(require,module,exports){exports.base64=false;exports.binary=false;exports.dir=false;exports.createFolders=true;exports.date=null;exports.compression=null;exports.compressionOptions=null;exports.comment=null;exports.unixPermissions=null;exports.dosPermissions=null;},{}],6:[function(require,module,exports){// load the global object first:
// - it should be better integrated in the system (unhandledRejection in node)
// - the environment may have a custom Promise implementation (see zone.js)
var ES6Promise=null;if(typeof Promise!=="undefined"){ES6Promise=Promise;}else{ES6Promise=require("lie");}/**
			 * Let the user use/change some implementations.
			 */module.exports={Promise:ES6Promise};},{"lie":37}],7:[function(require,module,exports){var USE_TYPEDARRAY=typeof Uint8Array!=='undefined'&&typeof Uint16Array!=='undefined'&&typeof Uint32Array!=='undefined';var pako=require("pako");var utils=require("./utils");var GenericWorker=require("./stream/GenericWorker");var ARRAY_TYPE=USE_TYPEDARRAY?"uint8array":"array";exports.magic="\x08\x00";/**
			 * Create a worker that uses pako to inflate/deflate.
			 * @constructor
			 * @param {String} action the name of the pako function to call : either "Deflate" or "Inflate".
			 * @param {Object} options the options to use when (de)compressing.
			 */function FlateWorker(action,options){GenericWorker.call(this,"FlateWorker/"+action);this._pako=null;this._pakoAction=action;this._pakoOptions=options;// the `meta` object from the last chunk received
// this allow this worker to pass around metadata
this.meta={};}utils.inherits(FlateWorker,GenericWorker);/**
			 * @see GenericWorker.processChunk
			 */FlateWorker.prototype.processChunk=function(chunk){this.meta=chunk.meta;if(this._pako===null){this._createPako();}this._pako.push(utils.transformTo(ARRAY_TYPE,chunk.data),false);};/**
			 * @see GenericWorker.flush
			 */FlateWorker.prototype.flush=function(){GenericWorker.prototype.flush.call(this);if(this._pako===null){this._createPako();}this._pako.push([],true);};/**
			 * @see GenericWorker.cleanUp
			 */FlateWorker.prototype.cleanUp=function(){GenericWorker.prototype.cleanUp.call(this);this._pako=null;};/**
			 * Create the _pako object.
			 * TODO: lazy-loading this object isn't the best solution but it's the
			 * quickest. The best solution is to lazy-load the worker list. See also the
			 * issue #446.
			 */FlateWorker.prototype._createPako=function(){this._pako=new pako[this._pakoAction]({raw:true,level:this._pakoOptions.level||-1// default compression
});var self=this;this._pako.onData=function(data){self.push({data:data,meta:self.meta});};};exports.compressWorker=function(compressionOptions){return new FlateWorker("Deflate",compressionOptions);};exports.uncompressWorker=function(){return new FlateWorker("Inflate",{});};},{"./stream/GenericWorker":28,"./utils":32,"pako":38}],8:[function(require,module,exports){var utils=require('../utils');var GenericWorker=require('../stream/GenericWorker');var utf8=require('../utf8');var crc32=require('../crc32');var signature=require('../signature');/**
			 * Transform an integer into a string in hexadecimal.
			 * @private
			 * @param {number} dec the number to convert.
			 * @param {number} bytes the number of bytes to generate.
			 * @returns {string} the result.
			 */var decToHex=function decToHex(dec,bytes){var hex="",i;for(i=0;i<bytes;i++){hex+=String.fromCharCode(dec&0xff);dec=dec>>>8;}return hex;};/**
			 * Generate the UNIX part of the external file attributes.
			 * @param {Object} unixPermissions the unix permissions or null.
			 * @param {Boolean} isDir true if the entry is a directory, false otherwise.
			 * @return {Number} a 32 bit integer.
			 *
			 * adapted from http://unix.stackexchange.com/questions/14705/the-zip-formats-external-file-attribute :
			 *
			 * TTTTsstrwxrwxrwx0000000000ADVSHR
			 * ^^^^____________________________ file type, see zipinfo.c (UNX_*)
			 *     ^^^_________________________ setuid, setgid, sticky
			 *        ^^^^^^^^^________________ permissions
			 *                 ^^^^^^^^^^______ not used ?
			 *                           ^^^^^^ DOS attribute bits : Archive, Directory, Volume label, System file, Hidden, Read only
			 */var generateUnixExternalFileAttr=function generateUnixExternalFileAttr(unixPermissions,isDir){var result=unixPermissions;if(!unixPermissions){// I can't use octal values in strict mode, hence the hexa.
//  040775 => 0x41fd
// 0100664 => 0x81b4
result=isDir?0x41fd:0x81b4;}return(result&0xFFFF)<<16;};/**
			 * Generate the DOS part of the external file attributes.
			 * @param {Object} dosPermissions the dos permissions or null.
			 * @param {Boolean} isDir true if the entry is a directory, false otherwise.
			 * @return {Number} a 32 bit integer.
			 *
			 * Bit 0     Read-Only
			 * Bit 1     Hidden
			 * Bit 2     System
			 * Bit 3     Volume Label
			 * Bit 4     Directory
			 * Bit 5     Archive
			 */var generateDosExternalFileAttr=function generateDosExternalFileAttr(dosPermissions,isDir){// the dir flag is already set for compatibility
return(dosPermissions||0)&0x3F;};/**
			 * Generate the various parts used in the construction of the final zip file.
			 * @param {Object} streamInfo the hash with information about the compressed file.
			 * @param {Boolean} streamedContent is the content streamed ?
			 * @param {Boolean} streamingEnded is the stream finished ?
			 * @param {number} offset the current offset from the start of the zip file.
			 * @param {String} platform let's pretend we are this platform (change platform dependents fields)
			 * @param {Function} encodeFileName the function to encode the file name / comment.
			 * @return {Object} the zip parts.
			 */var generateZipParts=function generateZipParts(streamInfo,streamedContent,streamingEnded,offset,platform,encodeFileName){var file=streamInfo['file'],compression=streamInfo['compression'],useCustomEncoding=encodeFileName!==utf8.utf8encode,encodedFileName=utils.transformTo("string",encodeFileName(file.name)),utfEncodedFileName=utils.transformTo("string",utf8.utf8encode(file.name)),comment=file.comment,encodedComment=utils.transformTo("string",encodeFileName(comment)),utfEncodedComment=utils.transformTo("string",utf8.utf8encode(comment)),useUTF8ForFileName=utfEncodedFileName.length!==file.name.length,useUTF8ForComment=utfEncodedComment.length!==comment.length,dosTime,dosDate,extraFields="",unicodePathExtraField="",unicodeCommentExtraField="",dir=file.dir,date=file.date;var dataInfo={crc32:0,compressedSize:0,uncompressedSize:0};// if the content is streamed, the sizes/crc32 are only available AFTER
// the end of the stream.
if(!streamedContent||streamingEnded){dataInfo.crc32=streamInfo['crc32'];dataInfo.compressedSize=streamInfo['compressedSize'];dataInfo.uncompressedSize=streamInfo['uncompressedSize'];}var bitflag=0;if(streamedContent){// Bit 3: the sizes/crc32 are set to zero in the local header.
// The correct values are put in the data descriptor immediately
// following the compressed data.
bitflag|=0x0008;}if(!useCustomEncoding&&(useUTF8ForFileName||useUTF8ForComment)){// Bit 11: Language encoding flag (EFS).
bitflag|=0x0800;}var extFileAttr=0;var versionMadeBy=0;if(dir){// dos or unix, we set the dos dir flag
extFileAttr|=0x00010;}if(platform==="UNIX"){versionMadeBy=0x031E;// UNIX, version 3.0
extFileAttr|=generateUnixExternalFileAttr(file.unixPermissions,dir);}else{// DOS or other, fallback to DOS
versionMadeBy=0x0014;// DOS, version 2.0
extFileAttr|=generateDosExternalFileAttr(file.dosPermissions);}// date
// @see http://www.delorie.com/djgpp/doc/rbinter/it/52/13.html
// @see http://www.delorie.com/djgpp/doc/rbinter/it/65/16.html
// @see http://www.delorie.com/djgpp/doc/rbinter/it/66/16.html
dosTime=date.getUTCHours();dosTime=dosTime<<6;dosTime=dosTime|date.getUTCMinutes();dosTime=dosTime<<5;dosTime=dosTime|date.getUTCSeconds()/2;dosDate=date.getUTCFullYear()-1980;dosDate=dosDate<<4;dosDate=dosDate|date.getUTCMonth()+1;dosDate=dosDate<<5;dosDate=dosDate|date.getUTCDate();if(useUTF8ForFileName){// set the unicode path extra field. unzip needs at least one extra
// field to correctly handle unicode path, so using the path is as good
// as any other information. This could improve the situation with
// other archive managers too.
// This field is usually used without the utf8 flag, with a non
// unicode path in the header (winrar, winzip). This helps (a bit)
// with the messy Windows' default compressed folders feature but
// breaks on p7zip which doesn't seek the unicode path extra field.
// So for now, UTF-8 everywhere !
unicodePathExtraField=// Version
decToHex(1,1)+// NameCRC32
decToHex(crc32(encodedFileName),4)+// UnicodeName
utfEncodedFileName;extraFields+=// Info-ZIP Unicode Path Extra Field
"\x75\x70"+// size
decToHex(unicodePathExtraField.length,2)+// content
unicodePathExtraField;}if(useUTF8ForComment){unicodeCommentExtraField=// Version
decToHex(1,1)+// CommentCRC32
decToHex(crc32(encodedComment),4)+// UnicodeName
utfEncodedComment;extraFields+=// Info-ZIP Unicode Path Extra Field
"\x75\x63"+// size
decToHex(unicodeCommentExtraField.length,2)+// content
unicodeCommentExtraField;}var header="";// version needed to extract
header+="\x0A\x00";// general purpose bit flag
header+=decToHex(bitflag,2);// compression method
header+=compression.magic;// last mod file time
header+=decToHex(dosTime,2);// last mod file date
header+=decToHex(dosDate,2);// crc-32
header+=decToHex(dataInfo.crc32,4);// compressed size
header+=decToHex(dataInfo.compressedSize,4);// uncompressed size
header+=decToHex(dataInfo.uncompressedSize,4);// file name length
header+=decToHex(encodedFileName.length,2);// extra field length
header+=decToHex(extraFields.length,2);var fileRecord=signature.LOCAL_FILE_HEADER+header+encodedFileName+extraFields;var dirRecord=signature.CENTRAL_FILE_HEADER+// version made by (00: DOS)
decToHex(versionMadeBy,2)+// file header (common to file and central directory)
header+// file comment length
decToHex(encodedComment.length,2)+// disk number start
"\x00\x00"+// internal file attributes TODO
"\x00\x00"+// external file attributes
decToHex(extFileAttr,4)+// relative offset of local header
decToHex(offset,4)+// file name
encodedFileName+// extra field
extraFields+// file comment
encodedComment;return{fileRecord:fileRecord,dirRecord:dirRecord};};/**
			 * Generate the EOCD record.
			 * @param {Number} entriesCount the number of entries in the zip file.
			 * @param {Number} centralDirLength the length (in bytes) of the central dir.
			 * @param {Number} localDirLength the length (in bytes) of the local dir.
			 * @param {String} comment the zip file comment as a binary string.
			 * @param {Function} encodeFileName the function to encode the comment.
			 * @return {String} the EOCD record.
			 */var generateCentralDirectoryEnd=function generateCentralDirectoryEnd(entriesCount,centralDirLength,localDirLength,comment,encodeFileName){var dirEnd="";var encodedComment=utils.transformTo("string",encodeFileName(comment));// end of central dir signature
dirEnd=signature.CENTRAL_DIRECTORY_END+// number of this disk
"\x00\x00"+// number of the disk with the start of the central directory
"\x00\x00"+// total number of entries in the central directory on this disk
decToHex(entriesCount,2)+// total number of entries in the central directory
decToHex(entriesCount,2)+// size of the central directory   4 bytes
decToHex(centralDirLength,4)+// offset of start of central directory with respect to the starting disk number
decToHex(localDirLength,4)+// .ZIP file comment length
decToHex(encodedComment.length,2)+// .ZIP file comment
encodedComment;return dirEnd;};/**
			 * Generate data descriptors for a file entry.
			 * @param {Object} streamInfo the hash generated by a worker, containing information
			 * on the file entry.
			 * @return {String} the data descriptors.
			 */var generateDataDescriptors=function generateDataDescriptors(streamInfo){var descriptor="";descriptor=signature.DATA_DESCRIPTOR+// crc-32                          4 bytes
decToHex(streamInfo['crc32'],4)+// compressed size                 4 bytes
decToHex(streamInfo['compressedSize'],4)+// uncompressed size               4 bytes
decToHex(streamInfo['uncompressedSize'],4);return descriptor;};/**
			 * A worker to concatenate other workers to create a zip file.
			 * @param {Boolean} streamFiles `true` to stream the content of the files,
			 * `false` to accumulate it.
			 * @param {String} comment the comment to use.
			 * @param {String} platform the platform to use, "UNIX" or "DOS".
			 * @param {Function} encodeFileName the function to encode file names and comments.
			 */function ZipFileWorker(streamFiles,comment,platform,encodeFileName){GenericWorker.call(this,"ZipFileWorker");// The number of bytes written so far. This doesn't count accumulated chunks.
this.bytesWritten=0;// The comment of the zip file
this.zipComment=comment;// The platform "generating" the zip file.
this.zipPlatform=platform;// the function to encode file names and comments.
this.encodeFileName=encodeFileName;// Should we stream the content of the files ?
this.streamFiles=streamFiles;// If `streamFiles` is false, we will need to accumulate the content of the
// files to calculate sizes / crc32 (and write them *before* the content).
// This boolean indicates if we are accumulating chunks (it will change a lot
// during the lifetime of this worker).
this.accumulate=false;// The buffer receiving chunks when accumulating content.
this.contentBuffer=[];// The list of generated directory records.
this.dirRecords=[];// The offset (in bytes) from the beginning of the zip file for the current source.
this.currentSourceOffset=0;// The total number of entries in this zip file.
this.entriesCount=0;// the name of the file currently being added, null when handling the end of the zip file.
// Used for the emitted metadata.
this.currentFile=null;this._sources=[];}utils.inherits(ZipFileWorker,GenericWorker);/**
			 * @see GenericWorker.push
			 */ZipFileWorker.prototype.push=function(chunk){var currentFilePercent=chunk.meta.percent||0;var entriesCount=this.entriesCount;var remainingFiles=this._sources.length;if(this.accumulate){this.contentBuffer.push(chunk);}else{this.bytesWritten+=chunk.data.length;GenericWorker.prototype.push.call(this,{data:chunk.data,meta:{currentFile:this.currentFile,percent:entriesCount?(currentFilePercent+100*(entriesCount-remainingFiles-1))/entriesCount:100}});}};/**
			 * The worker started a new source (an other worker).
			 * @param {Object} streamInfo the streamInfo object from the new source.
			 */ZipFileWorker.prototype.openedSource=function(streamInfo){this.currentSourceOffset=this.bytesWritten;this.currentFile=streamInfo['file'].name;var streamedContent=this.streamFiles&&!streamInfo['file'].dir;// don't stream folders (because they don't have any content)
if(streamedContent){var record=generateZipParts(streamInfo,streamedContent,false,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:record.fileRecord,meta:{percent:0}});}else{// we need to wait for the whole file before pushing anything
this.accumulate=true;}};/**
			 * The worker finished a source (an other worker).
			 * @param {Object} streamInfo the streamInfo object from the finished source.
			 */ZipFileWorker.prototype.closedSource=function(streamInfo){this.accumulate=false;var streamedContent=this.streamFiles&&!streamInfo['file'].dir;var record=generateZipParts(streamInfo,streamedContent,true,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.dirRecords.push(record.dirRecord);if(streamedContent){// after the streamed file, we put data descriptors
this.push({data:generateDataDescriptors(streamInfo),meta:{percent:100}});}else{// the content wasn't streamed, we need to push everything now
// first the file record, then the content
this.push({data:record.fileRecord,meta:{percent:0}});while(this.contentBuffer.length){this.push(this.contentBuffer.shift());}}this.currentFile=null;};/**
			 * @see GenericWorker.flush
			 */ZipFileWorker.prototype.flush=function(){var localDirLength=this.bytesWritten;for(var i=0;i<this.dirRecords.length;i++){this.push({data:this.dirRecords[i],meta:{percent:100}});}var centralDirLength=this.bytesWritten-localDirLength;var dirEnd=generateCentralDirectoryEnd(this.dirRecords.length,centralDirLength,localDirLength,this.zipComment,this.encodeFileName);this.push({data:dirEnd,meta:{percent:100}});};/**
			 * Prepare the next source to be read.
			 */ZipFileWorker.prototype.prepareNextSource=function(){this.previous=this._sources.shift();this.openedSource(this.previous.streamInfo);if(this.isPaused){this.previous.pause();}else{this.previous.resume();}};/**
			 * @see GenericWorker.registerPrevious
			 */ZipFileWorker.prototype.registerPrevious=function(previous){this._sources.push(previous);var self=this;previous.on('data',function(chunk){self.processChunk(chunk);});previous.on('end',function(){self.closedSource(self.previous.streamInfo);if(self._sources.length){self.prepareNextSource();}else{self.end();}});previous.on('error',function(e){self.error(e);});return this;};/**
			 * @see GenericWorker.resume
			 */ZipFileWorker.prototype.resume=function(){if(!GenericWorker.prototype.resume.call(this)){return false;}if(!this.previous&&this._sources.length){this.prepareNextSource();return true;}if(!this.previous&&!this._sources.length&&!this.generatedError){this.end();return true;}};/**
			 * @see GenericWorker.error
			 */ZipFileWorker.prototype.error=function(e){var sources=this._sources;if(!GenericWorker.prototype.error.call(this,e)){return false;}for(var i=0;i<sources.length;i++){try{sources[i].error(e);}catch(e){// the `error` exploded, nothing to do
}}return true;};/**
			 * @see GenericWorker.lock
			 */ZipFileWorker.prototype.lock=function(){GenericWorker.prototype.lock.call(this);var sources=this._sources;for(var i=0;i<sources.length;i++){sources[i].lock();}};module.exports=ZipFileWorker;},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(require,module,exports){var compressions=require('../compressions');var ZipFileWorker=require('./ZipFileWorker');/**
			 * Find the compression to use.
			 * @param {String} fileCompression the compression defined at the file level, if any.
			 * @param {String} zipCompression the compression defined at the load() level.
			 * @return {Object} the compression object to use.
			 */var getCompression=function getCompression(fileCompression,zipCompression){var compressionName=fileCompression||zipCompression;var compression=compressions[compressionName];if(!compression){throw new Error(compressionName+" is not a valid compression method !");}return compression;};/**
			 * Create a worker to generate a zip file.
			 * @param {JSZip} zip the JSZip instance at the right root level.
			 * @param {Object} options to generate the zip file.
			 * @param {String} comment the comment to use.
			 */exports.generateWorker=function(zip,options,comment){var zipFileWorker=new ZipFileWorker(options.streamFiles,comment,options.platform,options.encodeFileName);var entriesCount=0;try{zip.forEach(function(relativePath,file){entriesCount++;var compression=getCompression(file.options.compression,options.compression);var compressionOptions=file.options.compressionOptions||options.compressionOptions||{};var dir=file.dir,date=file.date;file._compressWorker(compression,compressionOptions).withStreamInfo("file",{name:relativePath,dir:dir,date:date,comment:file.comment||"",unixPermissions:file.unixPermissions,dosPermissions:file.dosPermissions}).pipe(zipFileWorker);});zipFileWorker.entriesCount=entriesCount;}catch(e){zipFileWorker.error(e);}return zipFileWorker;};},{"../compressions":3,"./ZipFileWorker":8}],10:[function(require,module,exports){/**
			 * Representation a of zip file in js
			 * @constructor
			 */function JSZip(){// if this constructor is used without `new`, it adds `new` before itself:
if(!(this instanceof JSZip)){return new JSZip();}if(arguments.length){throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");}// object containing the files :
// {
//   "folder/" : {...},
//   "folder/data.txt" : {...}
// }
// NOTE: we use a null prototype because we do not
// want filenames like "toString" coming from a zip file
// to overwrite methods and attributes in a normal Object.
this.files=Object.create(null);this.comment=null;// Where we are in the hierarchy
this.root="";this.clone=function(){var newObj=new JSZip();for(var i in this){if(typeof this[i]!=="function"){newObj[i]=this[i];}}return newObj;};}JSZip.prototype=require('./object');JSZip.prototype.loadAsync=require('./load');JSZip.support=require('./support');JSZip.defaults=require('./defaults');// TODO find a better way to handle this version,
// a require('package.json').version doesn't work with webpack, see #327
JSZip.version="3.7.1";JSZip.loadAsync=function(content,options){return new JSZip().loadAsync(content,options);};JSZip.external=require("./external");module.exports=JSZip;},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(require,module,exports){var utils=require('./utils');var external=require("./external");var utf8=require('./utf8');var ZipEntries=require('./zipEntries');var Crc32Probe=require('./stream/Crc32Probe');var nodejsUtils=require("./nodejsUtils");/**
			 * Check the CRC32 of an entry.
			 * @param {ZipEntry} zipEntry the zip entry to check.
			 * @return {Promise} the result.
			 */function checkEntryCRC32(zipEntry){return new external.Promise(function(resolve,reject){var worker=zipEntry.decompressed.getContentWorker().pipe(new Crc32Probe());worker.on("error",function(e){reject(e);}).on("end",function(){if(worker.streamInfo.crc32!==zipEntry.decompressed.crc32){reject(new Error("Corrupted zip : CRC32 mismatch"));}else{resolve();}}).resume();});}module.exports=function(data,options){var zip=this;options=utils.extend(options||{},{base64:false,checkCRC32:false,optimizedBinaryString:false,createFolders:false,decodeFileName:utf8.utf8decode});if(nodejsUtils.isNode&&nodejsUtils.isStream(data)){return external.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file."));}return utils.prepareContent("the loaded zip file",data,true,options.optimizedBinaryString,options.base64).then(function(data){var zipEntries=new ZipEntries(options);zipEntries.load(data);return zipEntries;}).then(function checkCRC32(zipEntries){var promises=[external.Promise.resolve(zipEntries)];var files=zipEntries.files;if(options.checkCRC32){for(var i=0;i<files.length;i++){promises.push(checkEntryCRC32(files[i]));}}return external.Promise.all(promises);}).then(function addFiles(results){var zipEntries=results.shift();var files=zipEntries.files;for(var i=0;i<files.length;i++){var input=files[i];zip.file(input.fileNameStr,input.decompressed,{binary:true,optimizedBinaryString:true,date:input.date,dir:input.dir,comment:input.fileCommentStr.length?input.fileCommentStr:null,unixPermissions:input.unixPermissions,dosPermissions:input.dosPermissions,createFolders:options.createFolders});}if(zipEntries.zipComment.length){zip.comment=zipEntries.zipComment;}return zip;});};},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(require,module,exports){var utils=require('../utils');var GenericWorker=require('../stream/GenericWorker');/**
			 * A worker that use a nodejs stream as source.
			 * @constructor
			 * @param {String} filename the name of the file entry for this stream.
			 * @param {Readable} stream the nodejs stream.
			 */function NodejsStreamInputAdapter(filename,stream){GenericWorker.call(this,"Nodejs stream input adapter for "+filename);this._upstreamEnded=false;this._bindStream(stream);}utils.inherits(NodejsStreamInputAdapter,GenericWorker);/**
			 * Prepare the stream and bind the callbacks on it.
			 * Do this ASAP on node 0.10 ! A lazy binding doesn't always work.
			 * @param {Stream} stream the nodejs stream to use.
			 */NodejsStreamInputAdapter.prototype._bindStream=function(stream){var self=this;this._stream=stream;stream.pause();stream.on("data",function(chunk){self.push({data:chunk,meta:{percent:0}});}).on("error",function(e){if(self.isPaused){this.generatedError=e;}else{self.error(e);}}).on("end",function(){if(self.isPaused){self._upstreamEnded=true;}else{self.end();}});};NodejsStreamInputAdapter.prototype.pause=function(){if(!GenericWorker.prototype.pause.call(this)){return false;}this._stream.pause();return true;};NodejsStreamInputAdapter.prototype.resume=function(){if(!GenericWorker.prototype.resume.call(this)){return false;}if(this._upstreamEnded){this.end();}else{this._stream.resume();}return true;};module.exports=NodejsStreamInputAdapter;},{"../stream/GenericWorker":28,"../utils":32}],13:[function(require,module,exports){var Readable=require('readable-stream').Readable;var utils=require('../utils');utils.inherits(NodejsStreamOutputAdapter,Readable);/**
			* A nodejs stream using a worker as source.
			* @see the SourceWrapper in http://nodejs.org/api/stream.html
			* @constructor
			* @param {StreamHelper} helper the helper wrapping the worker
			* @param {Object} options the nodejs stream options
			* @param {Function} updateCb the update callback.
			*/function NodejsStreamOutputAdapter(helper,options,updateCb){Readable.call(this,options);this._helper=helper;var self=this;helper.on("data",function(data,meta){if(!self.push(data)){self._helper.pause();}if(updateCb){updateCb(meta);}}).on("error",function(e){self.emit('error',e);}).on("end",function(){self.push(null);});}NodejsStreamOutputAdapter.prototype._read=function(){this._helper.resume();};module.exports=NodejsStreamOutputAdapter;},{"../utils":32,"readable-stream":16}],14:[function(require,module,exports){module.exports={/**
			     * True if this is running in Nodejs, will be undefined in a browser.
			     * In a browser, browserify won't include this file and the whole module
			     * will be resolved an empty object.
			     */isNode:typeof Buffer!=="undefined",/**
			     * Create a new nodejs Buffer from an existing content.
			     * @param {Object} data the data to pass to the constructor.
			     * @param {String} encoding the encoding to use.
			     * @return {Buffer} a new Buffer.
			     */newBufferFrom:function newBufferFrom(data,encoding){if(Buffer.from&&Buffer.from!==Uint8Array.from){return Buffer.from(data,encoding);}else{if(typeof data==="number"){// Safeguard for old Node.js versions. On newer versions,
// Buffer.from(number) / Buffer(number, encoding) already throw.
throw new Error("The \"data\" argument must not be a number");}return new Buffer(data,encoding);}},/**
			     * Create a new nodejs Buffer with the specified size.
			     * @param {Integer} size the size of the buffer.
			     * @return {Buffer} a new Buffer.
			     */allocBuffer:function allocBuffer(size){if(Buffer.alloc){return Buffer.alloc(size);}else{var buf=new Buffer(size);buf.fill(0);return buf;}},/**
			     * Find out if an object is a Buffer.
			     * @param {Object} b the object to test.
			     * @return {Boolean} true if the object is a Buffer, false otherwise.
			     */isBuffer:function isBuffer(b){return Buffer.isBuffer(b);},isStream:function isStream(obj){return obj&&typeof obj.on==="function"&&typeof obj.pause==="function"&&typeof obj.resume==="function";}};},{}],15:[function(require,module,exports){var utf8=require('./utf8');var utils=require('./utils');var GenericWorker=require('./stream/GenericWorker');var StreamHelper=require('./stream/StreamHelper');var defaults=require('./defaults');var CompressedObject=require('./compressedObject');var ZipObject=require('./zipObject');var generate=require("./generate");var nodejsUtils=require("./nodejsUtils");var NodejsStreamInputAdapter=require("./nodejs/NodejsStreamInputAdapter");/**
			 * Add a file in the current folder.
			 * @private
			 * @param {string} name the name of the file
			 * @param {String|ArrayBuffer|Uint8Array|Buffer} data the data of the file
			 * @param {Object} originalOptions the options of the file
			 * @return {Object} the new file.
			 */var fileAdd=function fileAdd(name,data,originalOptions){// be sure sub folders exist
var dataType=utils.getTypeOf(data),parent;/*
			     * Correct options.
			     */var o=utils.extend(originalOptions||{},defaults);o.date=o.date||new Date();if(o.compression!==null){o.compression=o.compression.toUpperCase();}if(typeof o.unixPermissions==="string"){o.unixPermissions=parseInt(o.unixPermissions,8);}// UNX_IFDIR  0040000 see zipinfo.c
if(o.unixPermissions&&o.unixPermissions&0x4000){o.dir=true;}// Bit 4    Directory
if(o.dosPermissions&&o.dosPermissions&0x0010){o.dir=true;}if(o.dir){name=forceTrailingSlash(name);}if(o.createFolders&&(parent=parentFolder(name))){folderAdd.call(this,parent,true);}var isUnicodeString=dataType==="string"&&o.binary===false&&o.base64===false;if(!originalOptions||typeof originalOptions.binary==="undefined"){o.binary=!isUnicodeString;}var isCompressedEmpty=data instanceof CompressedObject&&data.uncompressedSize===0;if(isCompressedEmpty||o.dir||!data||data.length===0){o.base64=false;o.binary=true;data="";o.compression="STORE";dataType="string";}/*
			     * Convert content to fit.
			     */var zipObjectContent=null;if(data instanceof CompressedObject||data instanceof GenericWorker){zipObjectContent=data;}else if(nodejsUtils.isNode&&nodejsUtils.isStream(data)){zipObjectContent=new NodejsStreamInputAdapter(name,data);}else{zipObjectContent=utils.prepareContent(name,data,o.binary,o.optimizedBinaryString,o.base64);}var object=new ZipObject(name,zipObjectContent,o);this.files[name]=object;/*
			    TODO: we can't throw an exception because we have async promises
			    (we can have a promise of a Date() for example) but returning a
			    promise is useless because file(name, data) returns the JSZip
			    object for chaining. Should we break that to allow the user
			    to catch the error ?

			    return external.Promise.resolve(zipObjectContent)
			    .then(function () {
			        return object;
			    });
			    */};/**
			 * Find the parent folder of the path.
			 * @private
			 * @param {string} path the path to use
			 * @return {string} the parent folder, or ""
			 */var parentFolder=function parentFolder(path){if(path.slice(-1)==='/'){path=path.substring(0,path.length-1);}var lastSlash=path.lastIndexOf('/');return lastSlash>0?path.substring(0,lastSlash):"";};/**
			 * Returns the path with a slash at the end.
			 * @private
			 * @param {String} path the path to check.
			 * @return {String} the path with a trailing slash.
			 */var forceTrailingSlash=function forceTrailingSlash(path){// Check the name ends with a /
if(path.slice(-1)!=="/"){path+="/";// IE doesn't like substr(-1)
}return path;};/**
			 * Add a (sub) folder in the current folder.
			 * @private
			 * @param {string} name the folder's name
			 * @param {boolean=} [createFolders] If true, automatically create sub
			 *  folders. Defaults to false.
			 * @return {Object} the new folder.
			 */var folderAdd=function folderAdd(name,createFolders){createFolders=typeof createFolders!=='undefined'?createFolders:defaults.createFolders;name=forceTrailingSlash(name);// Does this folder already exist?
if(!this.files[name]){fileAdd.call(this,name,null,{dir:true,createFolders:createFolders});}return this.files[name];};/**
			* Cross-window, cross-Node-context regular expression detection
			* @param  {Object}  object Anything
			* @return {Boolean}        true if the object is a regular expression,
			* false otherwise
			*/function isRegExp(object){return Object.prototype.toString.call(object)==="[object RegExp]";}// return the actual prototype of JSZip
var out={/**
			     * @see loadAsync
			     */load:function load(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.");},/**
			     * Call a callback function for each entry at this folder level.
			     * @param {Function} cb the callback function:
			     * function (relativePath, file) {...}
			     * It takes 2 arguments : the relative path and the file.
			     */forEach:function forEach(cb){var filename,relativePath,file;/* jshint ignore:start */ // ignore warning about unwanted properties because this.files is a null prototype object
for(filename in this.files){file=this.files[filename];relativePath=filename.slice(this.root.length,filename.length);if(relativePath&&filename.slice(0,this.root.length)===this.root){// the file is in the current root
cb(relativePath,file);// TODO reverse the parameters ? need to be clean AND consistent with the filter search fn...
}}/* jshint ignore:end */},/**
			     * Filter nested files/folders with the specified function.
			     * @param {Function} search the predicate to use :
			     * function (relativePath, file) {...}
			     * It takes 2 arguments : the relative path and the file.
			     * @return {Array} An array of matching elements.
			     */filter:function filter(search){var result=[];this.forEach(function(relativePath,entry){if(search(relativePath,entry)){// the file matches the function
result.push(entry);}});return result;},/**
			     * Add a file to the zip file, or search a file.
			     * @param   {string|RegExp} name The name of the file to add (if data is defined),
			     * the name of the file to find (if no data) or a regex to match files.
			     * @param   {String|ArrayBuffer|Uint8Array|Buffer} data  The file data, either raw or base64 encoded
			     * @param   {Object} o     File options
			     * @return  {JSZip|Object|Array} this JSZip object (when adding a file),
			     * a file (when searching by string) or an array of files (when searching by regex).
			     */file:function file(name,data,o){if(arguments.length===1){if(isRegExp(name)){var regexp=name;return this.filter(function(relativePath,file){return!file.dir&&regexp.test(relativePath);});}else{// text
var obj=this.files[this.root+name];if(obj&&!obj.dir){return obj;}else{return null;}}}else{// more than one argument : we have data !
name=this.root+name;fileAdd.call(this,name,data,o);}return this;},/**
			     * Add a directory to the zip file, or search.
			     * @param   {String|RegExp} arg The name of the directory to add, or a regex to search folders.
			     * @return  {JSZip} an object with the new directory as the root, or an array containing matching folders.
			     */folder:function folder(arg){if(!arg){return this;}if(isRegExp(arg)){return this.filter(function(relativePath,file){return file.dir&&arg.test(relativePath);});}// else, name is a new folder
var name=this.root+arg;var newFolder=folderAdd.call(this,name);// Allow chaining by returning a new object with this folder as the root
var ret=this.clone();ret.root=newFolder.name;return ret;},/**
			     * Delete a file, or a directory and all sub-files, from the zip
			     * @param {string} name the name of the file to delete
			     * @return {JSZip} this JSZip object
			     */remove:function remove(name){name=this.root+name;var file=this.files[name];if(!file){// Look for any folders
if(name.slice(-1)!=="/"){name+="/";}file=this.files[name];}if(file&&!file.dir){// file
delete this.files[name];}else{// maybe a folder, delete recursively
var kids=this.filter(function(relativePath,file){return file.name.slice(0,name.length)===name;});for(var i=0;i<kids.length;i++){delete this.files[kids[i].name];}}return this;},/**
			     * Generate the complete zip file
			     * @param {Object} options the options to generate the zip file :
			     * - compression, "STORE" by default.
			     * - type, "base64" by default. Values are : string, base64, uint8array, arraybuffer, blob.
			     * @return {String|Uint8Array|ArrayBuffer|Buffer|Blob} the zip file
			     */generate:function generate(options){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.");},/**
			     * Generate the complete zip file as an internal stream.
			     * @param {Object} options the options to generate the zip file :
			     * - compression, "STORE" by default.
			     * - type, "base64" by default. Values are : string, base64, uint8array, arraybuffer, blob.
			     * @return {StreamHelper} the streamed zip file.
			     */generateInternalStream:function generateInternalStream(options){var worker,opts={};try{opts=utils.extend(options||{},{streamFiles:false,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:'application/zip',encodeFileName:utf8.utf8encode});opts.type=opts.type.toLowerCase();opts.compression=opts.compression.toUpperCase();// "binarystring" is preferred but the internals use "string".
if(opts.type==="binarystring"){opts.type="string";}if(!opts.type){throw new Error("No output type specified.");}utils.checkSupport(opts.type);// accept nodejs `process.platform`
if(opts.platform==='darwin'||opts.platform==='freebsd'||opts.platform==='linux'||opts.platform==='sunos'){opts.platform="UNIX";}if(opts.platform==='win32'){opts.platform="DOS";}var comment=opts.comment||this.comment||"";worker=generate.generateWorker(this,opts,comment);}catch(e){worker=new GenericWorker("error");worker.error(e);}return new StreamHelper(worker,opts.type||"string",opts.mimeType);},/**
			     * Generate the complete zip file asynchronously.
			     * @see generateInternalStream
			     */generateAsync:function generateAsync(options,onUpdate){return this.generateInternalStream(options).accumulate(onUpdate);},/**
			     * Generate the complete zip file asynchronously.
			     * @see generateInternalStream
			     */generateNodeStream:function generateNodeStream(options,onUpdate){options=options||{};if(!options.type){options.type="nodebuffer";}return this.generateInternalStream(options).toNodejsStream(onUpdate);}};module.exports=out;},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(require,module,exports){/*
			 * This file is used by module bundlers (browserify/webpack/etc) when
			 * including a stream implementation. We use "readable-stream" to get a
			 * consistent behavior between nodejs versions but bundlers often have a shim
			 * for "stream". Using this shim greatly improve the compatibility and greatly
			 * reduce the final size of the bundle (only one stream implementation, not
			 * two).
			 */module.exports=require("stream");},{"stream":undefined}],17:[function(require,module,exports){var DataReader=require('./DataReader');var utils=require('../utils');function ArrayReader(data){DataReader.call(this,data);for(var i=0;i<this.data.length;i++){data[i]=data[i]&0xFF;}}utils.inherits(ArrayReader,DataReader);/**
			 * @see DataReader.byteAt
			 */ArrayReader.prototype.byteAt=function(i){return this.data[this.zero+i];};/**
			 * @see DataReader.lastIndexOfSignature
			 */ArrayReader.prototype.lastIndexOfSignature=function(sig){var sig0=sig.charCodeAt(0),sig1=sig.charCodeAt(1),sig2=sig.charCodeAt(2),sig3=sig.charCodeAt(3);for(var i=this.length-4;i>=0;--i){if(this.data[i]===sig0&&this.data[i+1]===sig1&&this.data[i+2]===sig2&&this.data[i+3]===sig3){return i-this.zero;}}return-1;};/**
			 * @see DataReader.readAndCheckSignature
			 */ArrayReader.prototype.readAndCheckSignature=function(sig){var sig0=sig.charCodeAt(0),sig1=sig.charCodeAt(1),sig2=sig.charCodeAt(2),sig3=sig.charCodeAt(3),data=this.readData(4);return sig0===data[0]&&sig1===data[1]&&sig2===data[2]&&sig3===data[3];};/**
			 * @see DataReader.readData
			 */ArrayReader.prototype.readData=function(size){this.checkOffset(size);if(size===0){return[];}var result=this.data.slice(this.zero+this.index,this.zero+this.index+size);this.index+=size;return result;};module.exports=ArrayReader;},{"../utils":32,"./DataReader":18}],18:[function(require,module,exports){var utils=require('../utils');function DataReader(data){this.data=data;// type : see implementation
this.length=data.length;this.index=0;this.zero=0;}DataReader.prototype={/**
			     * Check that the offset will not go too far.
			     * @param {string} offset the additional offset to check.
			     * @throws {Error} an Error if the offset is out of bounds.
			     */checkOffset:function checkOffset(offset){this.checkIndex(this.index+offset);},/**
			     * Check that the specified index will not be too far.
			     * @param {string} newIndex the index to check.
			     * @throws {Error} an Error if the index is out of bounds.
			     */checkIndex:function checkIndex(newIndex){if(this.length<this.zero+newIndex||newIndex<0){throw new Error("End of data reached (data length = "+this.length+", asked index = "+newIndex+"). Corrupted zip ?");}},/**
			     * Change the index.
			     * @param {number} newIndex The new index.
			     * @throws {Error} if the new index is out of the data.
			     */setIndex:function setIndex(newIndex){this.checkIndex(newIndex);this.index=newIndex;},/**
			     * Skip the next n bytes.
			     * @param {number} n the number of bytes to skip.
			     * @throws {Error} if the new index is out of the data.
			     */skip:function skip(n){this.setIndex(this.index+n);},/**
			     * Get the byte at the specified index.
			     * @param {number} i the index to use.
			     * @return {number} a byte.
			     */byteAt:function byteAt(i){// see implementations
},/**
			     * Get the next number with a given byte size.
			     * @param {number} size the number of bytes to read.
			     * @return {number} the corresponding number.
			     */readInt:function readInt(size){var result=0,i;this.checkOffset(size);for(i=this.index+size-1;i>=this.index;i--){result=(result<<8)+this.byteAt(i);}this.index+=size;return result;},/**
			     * Get the next string with a given byte size.
			     * @param {number} size the number of bytes to read.
			     * @return {string} the corresponding string.
			     */readString:function readString(size){return utils.transformTo("string",this.readData(size));},/**
			     * Get raw data without conversion, <size> bytes.
			     * @param {number} size the number of bytes to read.
			     * @return {Object} the raw data, implementation specific.
			     */readData:function readData(size){// see implementations
},/**
			     * Find the last occurrence of a zip signature (4 bytes).
			     * @param {string} sig the signature to find.
			     * @return {number} the index of the last occurrence, -1 if not found.
			     */lastIndexOfSignature:function lastIndexOfSignature(sig){// see implementations
},/**
			     * Read the signature (4 bytes) at the current position and compare it with sig.
			     * @param {string} sig the expected signature
			     * @return {boolean} true if the signature matches, false otherwise.
			     */readAndCheckSignature:function readAndCheckSignature(sig){// see implementations
},/**
			     * Get the next date.
			     * @return {Date} the date.
			     */readDate:function readDate(){var dostime=this.readInt(4);return new Date(Date.UTC((dostime>>25&0x7f)+1980,// year
(dostime>>21&0x0f)-1,// month
dostime>>16&0x1f,// day
dostime>>11&0x1f,// hour
dostime>>5&0x3f,// minute
(dostime&0x1f)<<1));// second
}};module.exports=DataReader;},{"../utils":32}],19:[function(require,module,exports){var Uint8ArrayReader=require('./Uint8ArrayReader');var utils=require('../utils');function NodeBufferReader(data){Uint8ArrayReader.call(this,data);}utils.inherits(NodeBufferReader,Uint8ArrayReader);/**
			 * @see DataReader.readData
			 */NodeBufferReader.prototype.readData=function(size){this.checkOffset(size);var result=this.data.slice(this.zero+this.index,this.zero+this.index+size);this.index+=size;return result;};module.exports=NodeBufferReader;},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(require,module,exports){var DataReader=require('./DataReader');var utils=require('../utils');function StringReader(data){DataReader.call(this,data);}utils.inherits(StringReader,DataReader);/**
			 * @see DataReader.byteAt
			 */StringReader.prototype.byteAt=function(i){return this.data.charCodeAt(this.zero+i);};/**
			 * @see DataReader.lastIndexOfSignature
			 */StringReader.prototype.lastIndexOfSignature=function(sig){return this.data.lastIndexOf(sig)-this.zero;};/**
			 * @see DataReader.readAndCheckSignature
			 */StringReader.prototype.readAndCheckSignature=function(sig){var data=this.readData(4);return sig===data;};/**
			 * @see DataReader.readData
			 */StringReader.prototype.readData=function(size){this.checkOffset(size);// this will work because the constructor applied the "& 0xff" mask.
var result=this.data.slice(this.zero+this.index,this.zero+this.index+size);this.index+=size;return result;};module.exports=StringReader;},{"../utils":32,"./DataReader":18}],21:[function(require,module,exports){var ArrayReader=require('./ArrayReader');var utils=require('../utils');function Uint8ArrayReader(data){ArrayReader.call(this,data);}utils.inherits(Uint8ArrayReader,ArrayReader);/**
			 * @see DataReader.readData
			 */Uint8ArrayReader.prototype.readData=function(size){this.checkOffset(size);if(size===0){// in IE10, when using subarray(idx, idx), we get the array [0x00] instead of [].
return new Uint8Array(0);}var result=this.data.subarray(this.zero+this.index,this.zero+this.index+size);this.index+=size;return result;};module.exports=Uint8ArrayReader;},{"../utils":32,"./ArrayReader":17}],22:[function(require,module,exports){var utils=require('../utils');var support=require('../support');var ArrayReader=require('./ArrayReader');var StringReader=require('./StringReader');var NodeBufferReader=require('./NodeBufferReader');var Uint8ArrayReader=require('./Uint8ArrayReader');/**
			 * Create a reader adapted to the data.
			 * @param {String|ArrayBuffer|Uint8Array|Buffer} data the data to read.
			 * @return {DataReader} the data reader.
			 */module.exports=function(data){var type=utils.getTypeOf(data);utils.checkSupport(type);if(type==="string"&&!support.uint8array){return new StringReader(data);}if(type==="nodebuffer"){return new NodeBufferReader(data);}if(support.uint8array){return new Uint8ArrayReader(utils.transformTo("uint8array",data));}return new ArrayReader(utils.transformTo("array",data));};},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(require,module,exports){exports.LOCAL_FILE_HEADER="PK\x03\x04";exports.CENTRAL_FILE_HEADER="PK\x01\x02";exports.CENTRAL_DIRECTORY_END="PK\x05\x06";exports.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x06\x07";exports.ZIP64_CENTRAL_DIRECTORY_END="PK\x06\x06";exports.DATA_DESCRIPTOR="PK\x07\x08";},{}],24:[function(require,module,exports){var GenericWorker=require('./GenericWorker');var utils=require('../utils');/**
			 * A worker which convert chunks to a specified type.
			 * @constructor
			 * @param {String} destType the destination type.
			 */function ConvertWorker(destType){GenericWorker.call(this,"ConvertWorker to "+destType);this.destType=destType;}utils.inherits(ConvertWorker,GenericWorker);/**
			 * @see GenericWorker.processChunk
			 */ConvertWorker.prototype.processChunk=function(chunk){this.push({data:utils.transformTo(this.destType,chunk.data),meta:chunk.meta});};module.exports=ConvertWorker;},{"../utils":32,"./GenericWorker":28}],25:[function(require,module,exports){var GenericWorker=require('./GenericWorker');var crc32=require('../crc32');var utils=require('../utils');/**
			 * A worker which calculate the crc32 of the data flowing through.
			 * @constructor
			 */function Crc32Probe(){GenericWorker.call(this,"Crc32Probe");this.withStreamInfo("crc32",0);}utils.inherits(Crc32Probe,GenericWorker);/**
			 * @see GenericWorker.processChunk
			 */Crc32Probe.prototype.processChunk=function(chunk){this.streamInfo.crc32=crc32(chunk.data,this.streamInfo.crc32||0);this.push(chunk);};module.exports=Crc32Probe;},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(require,module,exports){var utils=require('../utils');var GenericWorker=require('./GenericWorker');/**
			 * A worker which calculate the total length of the data flowing through.
			 * @constructor
			 * @param {String} propName the name used to expose the length
			 */function DataLengthProbe(propName){GenericWorker.call(this,"DataLengthProbe for "+propName);this.propName=propName;this.withStreamInfo(propName,0);}utils.inherits(DataLengthProbe,GenericWorker);/**
			 * @see GenericWorker.processChunk
			 */DataLengthProbe.prototype.processChunk=function(chunk){if(chunk){var length=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=length+chunk.data.length;}GenericWorker.prototype.processChunk.call(this,chunk);};module.exports=DataLengthProbe;},{"../utils":32,"./GenericWorker":28}],27:[function(require,module,exports){var utils=require('../utils');var GenericWorker=require('./GenericWorker');// the size of the generated chunks
// TODO expose this as a public variable
var DEFAULT_BLOCK_SIZE=16*1024;/**
			 * A worker that reads a content and emits chunks.
			 * @constructor
			 * @param {Promise} dataP the promise of the data to split
			 */function DataWorker(dataP){GenericWorker.call(this,"DataWorker");var self=this;this.dataIsReady=false;this.index=0;this.max=0;this.data=null;this.type="";this._tickScheduled=false;dataP.then(function(data){self.dataIsReady=true;self.data=data;self.max=data&&data.length||0;self.type=utils.getTypeOf(data);if(!self.isPaused){self._tickAndRepeat();}},function(e){self.error(e);});}utils.inherits(DataWorker,GenericWorker);/**
			 * @see GenericWorker.cleanUp
			 */DataWorker.prototype.cleanUp=function(){GenericWorker.prototype.cleanUp.call(this);this.data=null;};/**
			 * @see GenericWorker.resume
			 */DataWorker.prototype.resume=function(){if(!GenericWorker.prototype.resume.call(this)){return false;}if(!this._tickScheduled&&this.dataIsReady){this._tickScheduled=true;utils.delay(this._tickAndRepeat,[],this);}return true;};/**
			 * Trigger a tick a schedule an other call to this function.
			 */DataWorker.prototype._tickAndRepeat=function(){this._tickScheduled=false;if(this.isPaused||this.isFinished){return;}this._tick();if(!this.isFinished){utils.delay(this._tickAndRepeat,[],this);this._tickScheduled=true;}};/**
			 * Read and push a chunk.
			 */DataWorker.prototype._tick=function(){if(this.isPaused||this.isFinished){return false;}var size=DEFAULT_BLOCK_SIZE;var data=null,nextIndex=Math.min(this.max,this.index+size);if(this.index>=this.max){// EOF
return this.end();}else{switch(this.type){case"string":data=this.data.substring(this.index,nextIndex);break;case"uint8array":data=this.data.subarray(this.index,nextIndex);break;case"array":case"nodebuffer":data=this.data.slice(this.index,nextIndex);break;}this.index=nextIndex;return this.push({data:data,meta:{percent:this.max?this.index/this.max*100:0}});}};module.exports=DataWorker;},{"../utils":32,"./GenericWorker":28}],28:[function(require,module,exports){/**
			 * A worker that does nothing but passing chunks to the next one. This is like
			 * a nodejs stream but with some differences. On the good side :
			 * - it works on IE 6-9 without any issue / polyfill
			 * - it weights less than the full dependencies bundled with browserify
			 * - it forwards errors (no need to declare an error handler EVERYWHERE)
			 *
			 * A chunk is an object with 2 attributes : `meta` and `data`. The former is an
			 * object containing anything (`percent` for example), see each worker for more
			 * details. The latter is the real data (String, Uint8Array, etc).
			 *
			 * @constructor
			 * @param {String} name the name of the stream (mainly used for debugging purposes)
			 */function GenericWorker(name){// the name of the worker
this.name=name||"default";// an object containing metadata about the workers chain
this.streamInfo={};// an error which happened when the worker was paused
this.generatedError=null;// an object containing metadata to be merged by this worker into the general metadata
this.extraStreamInfo={};// true if the stream is paused (and should not do anything), false otherwise
this.isPaused=true;// true if the stream is finished (and should not do anything), false otherwise
this.isFinished=false;// true if the stream is locked to prevent further structure updates (pipe), false otherwise
this.isLocked=false;// the event listeners
this._listeners={'data':[],'end':[],'error':[]};// the previous worker, if any
this.previous=null;}GenericWorker.prototype={/**
			     * Push a chunk to the next workers.
			     * @param {Object} chunk the chunk to push
			     */push:function push(chunk){this.emit("data",chunk);},/**
			     * End the stream.
			     * @return {Boolean} true if this call ended the worker, false otherwise.
			     */end:function end(){if(this.isFinished){return false;}this.flush();try{this.emit("end");this.cleanUp();this.isFinished=true;}catch(e){this.emit("error",e);}return true;},/**
			     * End the stream with an error.
			     * @param {Error} e the error which caused the premature end.
			     * @return {Boolean} true if this call ended the worker with an error, false otherwise.
			     */error:function error(e){if(this.isFinished){return false;}if(this.isPaused){this.generatedError=e;}else{this.isFinished=true;this.emit("error",e);// in the workers chain exploded in the middle of the chain,
// the error event will go downward but we also need to notify
// workers upward that there has been an error.
if(this.previous){this.previous.error(e);}this.cleanUp();}return true;},/**
			     * Add a callback on an event.
			     * @param {String} name the name of the event (data, end, error)
			     * @param {Function} listener the function to call when the event is triggered
			     * @return {GenericWorker} the current object for chainability
			     */on:function on(name,listener){this._listeners[name].push(listener);return this;},/**
			     * Clean any references when a worker is ending.
			     */cleanUp:function cleanUp(){this.streamInfo=this.generatedError=this.extraStreamInfo=null;this._listeners=[];},/**
			     * Trigger an event. This will call registered callback with the provided arg.
			     * @param {String} name the name of the event (data, end, error)
			     * @param {Object} arg the argument to call the callback with.
			     */emit:function emit(name,arg){if(this._listeners[name]){for(var i=0;i<this._listeners[name].length;i++){this._listeners[name][i].call(this,arg);}}},/**
			     * Chain a worker with an other.
			     * @param {Worker} next the worker receiving events from the current one.
			     * @return {worker} the next worker for chainability
			     */pipe:function pipe(next){return next.registerPrevious(this);},/**
			     * Same as `pipe` in the other direction.
			     * Using an API with `pipe(next)` is very easy.
			     * Implementing the API with the point of view of the next one registering
			     * a source is easier, see the ZipFileWorker.
			     * @param {Worker} previous the previous worker, sending events to this one
			     * @return {Worker} the current worker for chainability
			     */registerPrevious:function registerPrevious(previous){if(this.isLocked){throw new Error("The stream '"+this+"' has already been used.");}// sharing the streamInfo...
this.streamInfo=previous.streamInfo;// ... and adding our own bits
this.mergeStreamInfo();this.previous=previous;var self=this;previous.on('data',function(chunk){self.processChunk(chunk);});previous.on('end',function(){self.end();});previous.on('error',function(e){self.error(e);});return this;},/**
			     * Pause the stream so it doesn't send events anymore.
			     * @return {Boolean} true if this call paused the worker, false otherwise.
			     */pause:function pause(){if(this.isPaused||this.isFinished){return false;}this.isPaused=true;if(this.previous){this.previous.pause();}return true;},/**
			     * Resume a paused stream.
			     * @return {Boolean} true if this call resumed the worker, false otherwise.
			     */resume:function resume(){if(!this.isPaused||this.isFinished){return false;}this.isPaused=false;// if true, the worker tried to resume but failed
var withError=false;if(this.generatedError){this.error(this.generatedError);withError=true;}if(this.previous){this.previous.resume();}return!withError;},/**
			     * Flush any remaining bytes as the stream is ending.
			     */flush:function flush(){},/**
			     * Process a chunk. This is usually the method overridden.
			     * @param {Object} chunk the chunk to process.
			     */processChunk:function processChunk(chunk){this.push(chunk);},/**
			     * Add a key/value to be added in the workers chain streamInfo once activated.
			     * @param {String} key the key to use
			     * @param {Object} value the associated value
			     * @return {Worker} the current worker for chainability
			     */withStreamInfo:function withStreamInfo(key,value){this.extraStreamInfo[key]=value;this.mergeStreamInfo();return this;},/**
			     * Merge this worker's streamInfo into the chain's streamInfo.
			     */mergeStreamInfo:function mergeStreamInfo(){for(var key in this.extraStreamInfo){if(!this.extraStreamInfo.hasOwnProperty(key)){continue;}this.streamInfo[key]=this.extraStreamInfo[key];}},/**
			     * Lock the stream to prevent further updates on the workers chain.
			     * After calling this method, all calls to pipe will fail.
			     */lock:function lock(){if(this.isLocked){throw new Error("The stream '"+this+"' has already been used.");}this.isLocked=true;if(this.previous){this.previous.lock();}},/**
			     *
			     * Pretty print the workers chain.
			     */toString:function toString(){var me="Worker "+this.name;if(this.previous){return this.previous+" -> "+me;}else{return me;}}};module.exports=GenericWorker;},{}],29:[function(require,module,exports){var utils=require('../utils');var ConvertWorker=require('./ConvertWorker');var GenericWorker=require('./GenericWorker');var base64=require('../base64');var support=require("../support");var external=require("../external");var NodejsStreamOutputAdapter=null;if(support.nodestream){try{NodejsStreamOutputAdapter=require('../nodejs/NodejsStreamOutputAdapter');}catch(e){}}/**
			 * Apply the final transformation of the data. If the user wants a Blob for
			 * example, it's easier to work with an U8intArray and finally do the
			 * ArrayBuffer/Blob conversion.
			 * @param {String} type the name of the final type
			 * @param {String|Uint8Array|Buffer} content the content to transform
			 * @param {String} mimeType the mime type of the content, if applicable.
			 * @return {String|Uint8Array|ArrayBuffer|Buffer|Blob} the content in the right format.
			 */function transformZipOutput(type,content,mimeType){switch(type){case"blob":return utils.newBlob(utils.transformTo("arraybuffer",content),mimeType);case"base64":return base64.encode(content);default:return utils.transformTo(type,content);}}/**
			 * Concatenate an array of data of the given type.
			 * @param {String} type the type of the data in the given array.
			 * @param {Array} dataArray the array containing the data chunks to concatenate
			 * @return {String|Uint8Array|Buffer} the concatenated data
			 * @throws Error if the asked type is unsupported
			 */function concat(type,dataArray){var i,index=0,res=null,totalLength=0;for(i=0;i<dataArray.length;i++){totalLength+=dataArray[i].length;}switch(type){case"string":return dataArray.join("");case"array":return Array.prototype.concat.apply([],dataArray);case"uint8array":res=new Uint8Array(totalLength);for(i=0;i<dataArray.length;i++){res.set(dataArray[i],index);index+=dataArray[i].length;}return res;case"nodebuffer":return Buffer.concat(dataArray);default:throw new Error("concat : unsupported type '"+type+"'");}}/**
			 * Listen a StreamHelper, accumulate its content and concatenate it into a
			 * complete block.
			 * @param {StreamHelper} helper the helper to use.
			 * @param {Function} updateCallback a callback called on each update. Called
			 * with one arg :
			 * - the metadata linked to the update received.
			 * @return Promise the promise for the accumulation.
			 */function _accumulate(helper,updateCallback){return new external.Promise(function(resolve,reject){var dataArray=[];var chunkType=helper._internalType,resultType=helper._outputType,mimeType=helper._mimeType;helper.on('data',function(data,meta){dataArray.push(data);if(updateCallback){updateCallback(meta);}}).on('error',function(err){dataArray=[];reject(err);}).on('end',function(){try{var result=transformZipOutput(resultType,concat(chunkType,dataArray),mimeType);resolve(result);}catch(e){reject(e);}dataArray=[];}).resume();});}/**
			 * An helper to easily use workers outside of JSZip.
			 * @constructor
			 * @param {Worker} worker the worker to wrap
			 * @param {String} outputType the type of data expected by the use
			 * @param {String} mimeType the mime type of the content, if applicable.
			 */function StreamHelper(worker,outputType,mimeType){var internalType=outputType;switch(outputType){case"blob":case"arraybuffer":internalType="uint8array";break;case"base64":internalType="string";break;}try{// the type used internally
this._internalType=internalType;// the type used to output results
this._outputType=outputType;// the mime type
this._mimeType=mimeType;utils.checkSupport(internalType);this._worker=worker.pipe(new ConvertWorker(internalType));// the last workers can be rewired without issues but we need to
// prevent any updates on previous workers.
worker.lock();}catch(e){this._worker=new GenericWorker("error");this._worker.error(e);}}StreamHelper.prototype={/**
			     * Listen a StreamHelper, accumulate its content and concatenate it into a
			     * complete block.
			     * @param {Function} updateCb the update callback.
			     * @return Promise the promise for the accumulation.
			     */accumulate:function accumulate(updateCb){return _accumulate(this,updateCb);},/**
			     * Add a listener on an event triggered on a stream.
			     * @param {String} evt the name of the event
			     * @param {Function} fn the listener
			     * @return {StreamHelper} the current helper.
			     */on:function on(evt,fn){var self=this;if(evt==="data"){this._worker.on(evt,function(chunk){fn.call(self,chunk.data,chunk.meta);});}else{this._worker.on(evt,function(){utils.delay(fn,arguments,self);});}return this;},/**
			     * Resume the flow of chunks.
			     * @return {StreamHelper} the current helper.
			     */resume:function resume(){utils.delay(this._worker.resume,[],this._worker);return this;},/**
			     * Pause the flow of chunks.
			     * @return {StreamHelper} the current helper.
			     */pause:function pause(){this._worker.pause();return this;},/**
			     * Return a nodejs stream for this helper.
			     * @param {Function} updateCb the update callback.
			     * @return {NodejsStreamOutputAdapter} the nodejs stream.
			     */toNodejsStream:function toNodejsStream(updateCb){utils.checkSupport("nodestream");if(this._outputType!=="nodebuffer"){// an object stream containing blob/arraybuffer/uint8array/string
// is strange and I don't know if it would be useful.
// I you find this comment and have a good usecase, please open a
// bug report !
throw new Error(this._outputType+" is not supported by this method");}return new NodejsStreamOutputAdapter(this,{objectMode:this._outputType!=="nodebuffer"},updateCb);}};module.exports=StreamHelper;},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(require,module,exports){exports.base64=true;exports.array=true;exports.string=true;exports.arraybuffer=typeof ArrayBuffer!=="undefined"&&typeof Uint8Array!=="undefined";exports.nodebuffer=typeof Buffer!=="undefined";// contains true if JSZip can read/generate Uint8Array, false otherwise.
exports.uint8array=typeof Uint8Array!=="undefined";if(typeof ArrayBuffer==="undefined"){exports.blob=false;}else{var buffer=new ArrayBuffer(0);try{exports.blob=new Blob([buffer],{type:"application/zip"}).size===0;}catch(e){try{var Builder=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder;var builder=new Builder();builder.append(buffer);exports.blob=builder.getBlob('application/zip').size===0;}catch(e){exports.blob=false;}}}try{exports.nodestream=!!require('readable-stream').Readable;}catch(e){exports.nodestream=false;}},{"readable-stream":16}],31:[function(require,module,exports){var utils=require('./utils');var support=require('./support');var nodejsUtils=require('./nodejsUtils');var GenericWorker=require('./stream/GenericWorker');/**
			 * The following functions come from pako, from pako/lib/utils/strings
			 * released under the MIT license, see pako https://github.com/nodeca/pako/
			 */ // Table with utf8 lengths (calculated by first byte of sequence)
// Note, that 5 & 6-byte values and some 4-byte values can not be represented in JS,
// because max possible codepoint is 0x10ffff
var _utf8len=new Array(256);for(var i=0;i<256;i++){_utf8len[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;}_utf8len[254]=_utf8len[254]=1;// Invalid sequence start
// convert string to array (typed, when possible)
var string2buf=function string2buf(str){var buf,c,c2,m_pos,i,str_len=str.length,buf_len=0;// count binary size
for(m_pos=0;m_pos<str_len;m_pos++){c=str.charCodeAt(m_pos);if((c&0xfc00)===0xd800&&m_pos+1<str_len){c2=str.charCodeAt(m_pos+1);if((c2&0xfc00)===0xdc00){c=0x10000+(c-0xd800<<10)+(c2-0xdc00);m_pos++;}}buf_len+=c<0x80?1:c<0x800?2:c<0x10000?3:4;}// allocate buffer
if(support.uint8array){buf=new Uint8Array(buf_len);}else{buf=new Array(buf_len);}// convert
for(i=0,m_pos=0;i<buf_len;m_pos++){c=str.charCodeAt(m_pos);if((c&0xfc00)===0xd800&&m_pos+1<str_len){c2=str.charCodeAt(m_pos+1);if((c2&0xfc00)===0xdc00){c=0x10000+(c-0xd800<<10)+(c2-0xdc00);m_pos++;}}if(c<0x80){/* one byte */buf[i++]=c;}else if(c<0x800){/* two bytes */buf[i++]=0xC0|c>>>6;buf[i++]=0x80|c&0x3f;}else if(c<0x10000){/* three bytes */buf[i++]=0xE0|c>>>12;buf[i++]=0x80|c>>>6&0x3f;buf[i++]=0x80|c&0x3f;}else{/* four bytes */buf[i++]=0xf0|c>>>18;buf[i++]=0x80|c>>>12&0x3f;buf[i++]=0x80|c>>>6&0x3f;buf[i++]=0x80|c&0x3f;}}return buf;};// Calculate max possible position in utf8 buffer,
// that will not break sequence. If that's not possible
// - (very small limits) return max size as is.
//
// buf[] - utf8 bytes array
// max   - length limit (mandatory);
var utf8border=function utf8border(buf,max){var pos;max=max||buf.length;if(max>buf.length){max=buf.length;}// go back from last position, until start of sequence found
pos=max-1;while(pos>=0&&(buf[pos]&0xC0)===0x80){pos--;}// Fuckup - very small and broken sequence,
// return max, because we should return something anyway.
if(pos<0){return max;}// If we came to start of buffer - that means vuffer is too small,
// return max too.
if(pos===0){return max;}return pos+_utf8len[buf[pos]]>max?pos:max;};// convert array to string
var buf2string=function buf2string(buf){var i,out,c,c_len;var len=buf.length;// Reserve max possible length (2 words per char)
// NB: by unknown reasons, Array is significantly faster for
//     String.fromCharCode.apply than Uint16Array.
var utf16buf=new Array(len*2);for(out=0,i=0;i<len;){c=buf[i++];// quick process ascii
if(c<0x80){utf16buf[out++]=c;continue;}c_len=_utf8len[c];// skip 5 & 6 byte codes
if(c_len>4){utf16buf[out++]=0xfffd;i+=c_len-1;continue;}// apply mask on first byte
c&=c_len===2?0x1f:c_len===3?0x0f:0x07;// join the rest
while(c_len>1&&i<len){c=c<<6|buf[i++]&0x3f;c_len--;}// terminated by end of string?
if(c_len>1){utf16buf[out++]=0xfffd;continue;}if(c<0x10000){utf16buf[out++]=c;}else{c-=0x10000;utf16buf[out++]=0xd800|c>>10&0x3ff;utf16buf[out++]=0xdc00|c&0x3ff;}}// shrinkBuf(utf16buf, out)
if(utf16buf.length!==out){if(utf16buf.subarray){utf16buf=utf16buf.subarray(0,out);}else{utf16buf.length=out;}}// return String.fromCharCode.apply(null, utf16buf);
return utils.applyFromCharCode(utf16buf);};// That's all for the pako functions.
/**
			 * Transform a javascript string into an array (typed if possible) of bytes,
			 * UTF-8 encoded.
			 * @param {String} str the string to encode
			 * @return {Array|Uint8Array|Buffer} the UTF-8 encoded string.
			 */exports.utf8encode=function utf8encode(str){if(support.nodebuffer){return nodejsUtils.newBufferFrom(str,"utf-8");}return string2buf(str);};/**
			 * Transform a bytes array (or a representation) representing an UTF-8 encoded
			 * string into a javascript string.
			 * @param {Array|Uint8Array|Buffer} buf the data de decode
			 * @return {String} the decoded string.
			 */exports.utf8decode=function utf8decode(buf){if(support.nodebuffer){return utils.transformTo("nodebuffer",buf).toString("utf-8");}buf=utils.transformTo(support.uint8array?"uint8array":"array",buf);return buf2string(buf);};/**
			 * A worker to decode utf8 encoded binary chunks into string chunks.
			 * @constructor
			 */function Utf8DecodeWorker(){GenericWorker.call(this,"utf-8 decode");// the last bytes if a chunk didn't end with a complete codepoint.
this.leftOver=null;}utils.inherits(Utf8DecodeWorker,GenericWorker);/**
			 * @see GenericWorker.processChunk
			 */Utf8DecodeWorker.prototype.processChunk=function(chunk){var data=utils.transformTo(support.uint8array?"uint8array":"array",chunk.data);// 1st step, re-use what's left of the previous chunk
if(this.leftOver&&this.leftOver.length){if(support.uint8array){var previousData=data;data=new Uint8Array(previousData.length+this.leftOver.length);data.set(this.leftOver,0);data.set(previousData,this.leftOver.length);}else{data=this.leftOver.concat(data);}this.leftOver=null;}var nextBoundary=utf8border(data);var usableData=data;if(nextBoundary!==data.length){if(support.uint8array){usableData=data.subarray(0,nextBoundary);this.leftOver=data.subarray(nextBoundary,data.length);}else{usableData=data.slice(0,nextBoundary);this.leftOver=data.slice(nextBoundary,data.length);}}this.push({data:exports.utf8decode(usableData),meta:chunk.meta});};/**
			 * @see GenericWorker.flush
			 */Utf8DecodeWorker.prototype.flush=function(){if(this.leftOver&&this.leftOver.length){this.push({data:exports.utf8decode(this.leftOver),meta:{}});this.leftOver=null;}};exports.Utf8DecodeWorker=Utf8DecodeWorker;/**
			 * A worker to endcode string chunks into utf8 encoded binary chunks.
			 * @constructor
			 */function Utf8EncodeWorker(){GenericWorker.call(this,"utf-8 encode");}utils.inherits(Utf8EncodeWorker,GenericWorker);/**
			 * @see GenericWorker.processChunk
			 */Utf8EncodeWorker.prototype.processChunk=function(chunk){this.push({data:exports.utf8encode(chunk.data),meta:chunk.meta});};exports.Utf8EncodeWorker=Utf8EncodeWorker;},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(require,module,exports){var support=require('./support');var base64=require('./base64');var nodejsUtils=require('./nodejsUtils');var setImmediate=require('set-immediate-shim');var external=require("./external");/**
			 * Convert a string that pass as a "binary string": it should represent a byte
			 * array but may have > 255 char codes. Be sure to take only the first byte
			 * and returns the byte array.
			 * @param {String} str the string to transform.
			 * @return {Array|Uint8Array} the string in a binary format.
			 */function string2binary(str){var result=null;if(support.uint8array){result=new Uint8Array(str.length);}else{result=new Array(str.length);}return stringToArrayLike(str,result);}/**
			 * Create a new blob with the given content and the given type.
			 * @param {String|ArrayBuffer} part the content to put in the blob. DO NOT use
			 * an Uint8Array because the stock browser of android 4 won't accept it (it
			 * will be silently converted to a string, "[object Uint8Array]").
			 *
			 * Use only ONE part to build the blob to avoid a memory leak in IE11 / Edge:
			 * when a large amount of Array is used to create the Blob, the amount of
			 * memory consumed is nearly 100 times the original data amount.
			 *
			 * @param {String} type the mime type of the blob.
			 * @return {Blob} the created blob.
			 */exports.newBlob=function(part,type){exports.checkSupport("blob");try{// Blob constructor
return new Blob([part],{type:type});}catch(e){try{// deprecated, browser only, old way
var Builder=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder;var builder=new Builder();builder.append(part);return builder.getBlob(type);}catch(e){// well, fuck ?!
throw new Error("Bug : can't construct the Blob.");}}};/**
			 * The identity function.
			 * @param {Object} input the input.
			 * @return {Object} the same input.
			 */function identity(input){return input;}/**
			 * Fill in an array with a string.
			 * @param {String} str the string to use.
			 * @param {Array|ArrayBuffer|Uint8Array|Buffer} array the array to fill in (will be mutated).
			 * @return {Array|ArrayBuffer|Uint8Array|Buffer} the updated array.
			 */function stringToArrayLike(str,array){for(var i=0;i<str.length;++i){array[i]=str.charCodeAt(i)&0xFF;}return array;}/**
			 * An helper for the function arrayLikeToString.
			 * This contains static information and functions that
			 * can be optimized by the browser JIT compiler.
			 */var arrayToStringHelper={/**
			     * Transform an array of int into a string, chunk by chunk.
			     * See the performances notes on arrayLikeToString.
			     * @param {Array|ArrayBuffer|Uint8Array|Buffer} array the array to transform.
			     * @param {String} type the type of the array.
			     * @param {Integer} chunk the chunk size.
			     * @return {String} the resulting string.
			     * @throws Error if the chunk is too big for the stack.
			     */stringifyByChunk:function stringifyByChunk(array,type,chunk){var result=[],k=0,len=array.length;// shortcut
if(len<=chunk){return String.fromCharCode.apply(null,array);}while(k<len){if(type==="array"||type==="nodebuffer"){result.push(String.fromCharCode.apply(null,array.slice(k,Math.min(k+chunk,len))));}else{result.push(String.fromCharCode.apply(null,array.subarray(k,Math.min(k+chunk,len))));}k+=chunk;}return result.join("");},/**
			     * Call String.fromCharCode on every item in the array.
			     * This is the naive implementation, which generate A LOT of intermediate string.
			     * This should be used when everything else fail.
			     * @param {Array|ArrayBuffer|Uint8Array|Buffer} array the array to transform.
			     * @return {String} the result.
			     */stringifyByChar:function stringifyByChar(array){var resultStr="";for(var i=0;i<array.length;i++){resultStr+=String.fromCharCode(array[i]);}return resultStr;},applyCanBeUsed:{/**
			         * true if the browser accepts to use String.fromCharCode on Uint8Array
			         */uint8array:function(){try{return support.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1;}catch(e){return false;}}(),/**
			         * true if the browser accepts to use String.fromCharCode on nodejs Buffer.
			         */nodebuffer:function(){try{return support.nodebuffer&&String.fromCharCode.apply(null,nodejsUtils.allocBuffer(1)).length===1;}catch(e){return false;}}()}};/**
			 * Transform an array-like object to a string.
			 * @param {Array|ArrayBuffer|Uint8Array|Buffer} array the array to transform.
			 * @return {String} the result.
			 */function arrayLikeToString(array){// Performances notes :
// --------------------
// String.fromCharCode.apply(null, array) is the fastest, see
// see http://jsperf.com/converting-a-uint8array-to-a-string/2
// but the stack is limited (and we can get huge arrays !).
//
// result += String.fromCharCode(array[i]); generate too many strings !
//
// This code is inspired by http://jsperf.com/arraybuffer-to-string-apply-performance/2
// TODO : we now have workers that split the work. Do we still need that ?
var chunk=65536,type=exports.getTypeOf(array),canUseApply=true;if(type==="uint8array"){canUseApply=arrayToStringHelper.applyCanBeUsed.uint8array;}else if(type==="nodebuffer"){canUseApply=arrayToStringHelper.applyCanBeUsed.nodebuffer;}if(canUseApply){while(chunk>1){try{return arrayToStringHelper.stringifyByChunk(array,type,chunk);}catch(e){chunk=Math.floor(chunk/2);}}}// no apply or chunk error : slow and painful algorithm
// default browser on android 4.*
return arrayToStringHelper.stringifyByChar(array);}exports.applyFromCharCode=arrayLikeToString;/**
			 * Copy the data from an array-like to an other array-like.
			 * @param {Array|ArrayBuffer|Uint8Array|Buffer} arrayFrom the origin array.
			 * @param {Array|ArrayBuffer|Uint8Array|Buffer} arrayTo the destination array which will be mutated.
			 * @return {Array|ArrayBuffer|Uint8Array|Buffer} the updated destination array.
			 */function arrayLikeToArrayLike(arrayFrom,arrayTo){for(var i=0;i<arrayFrom.length;i++){arrayTo[i]=arrayFrom[i];}return arrayTo;}// a matrix containing functions to transform everything into everything.
var transform={};// string to ?
transform["string"]={"string":identity,"array":function array(input){return stringToArrayLike(input,new Array(input.length));},"arraybuffer":function arraybuffer(input){return transform["string"]["uint8array"](input).buffer;},"uint8array":function uint8array(input){return stringToArrayLike(input,new Uint8Array(input.length));},"nodebuffer":function nodebuffer(input){return stringToArrayLike(input,nodejsUtils.allocBuffer(input.length));}};// array to ?
transform["array"]={"string":arrayLikeToString,"array":identity,"arraybuffer":function arraybuffer(input){return new Uint8Array(input).buffer;},"uint8array":function uint8array(input){return new Uint8Array(input);},"nodebuffer":function nodebuffer(input){return nodejsUtils.newBufferFrom(input);}};// arraybuffer to ?
transform["arraybuffer"]={"string":function string(input){return arrayLikeToString(new Uint8Array(input));},"array":function array(input){return arrayLikeToArrayLike(new Uint8Array(input),new Array(input.byteLength));},"arraybuffer":identity,"uint8array":function uint8array(input){return new Uint8Array(input);},"nodebuffer":function nodebuffer(input){return nodejsUtils.newBufferFrom(new Uint8Array(input));}};// uint8array to ?
transform["uint8array"]={"string":arrayLikeToString,"array":function array(input){return arrayLikeToArrayLike(input,new Array(input.length));},"arraybuffer":function arraybuffer(input){return input.buffer;},"uint8array":identity,"nodebuffer":function nodebuffer(input){return nodejsUtils.newBufferFrom(input);}};// nodebuffer to ?
transform["nodebuffer"]={"string":arrayLikeToString,"array":function array(input){return arrayLikeToArrayLike(input,new Array(input.length));},"arraybuffer":function arraybuffer(input){return transform["nodebuffer"]["uint8array"](input).buffer;},"uint8array":function uint8array(input){return arrayLikeToArrayLike(input,new Uint8Array(input.length));},"nodebuffer":identity};/**
			 * Transform an input into any type.
			 * The supported output type are : string, array, uint8array, arraybuffer, nodebuffer.
			 * If no output type is specified, the unmodified input will be returned.
			 * @param {String} outputType the output type.
			 * @param {String|Array|ArrayBuffer|Uint8Array|Buffer} input the input to convert.
			 * @throws {Error} an Error if the browser doesn't support the requested output type.
			 */exports.transformTo=function(outputType,input){if(!input){// undefined, null, etc
// an empty string won't harm.
input="";}if(!outputType){return input;}exports.checkSupport(outputType);var inputType=exports.getTypeOf(input);var result=transform[inputType][outputType](input);return result;};/**
			 * Return the type of the input.
			 * The type will be in a format valid for JSZip.utils.transformTo : string, array, uint8array, arraybuffer.
			 * @param {Object} input the input to identify.
			 * @return {String} the (lowercase) type of the input.
			 */exports.getTypeOf=function(input){if(typeof input==="string"){return"string";}if(Object.prototype.toString.call(input)==="[object Array]"){return"array";}if(support.nodebuffer&&nodejsUtils.isBuffer(input)){return"nodebuffer";}if(support.uint8array&&input instanceof Uint8Array){return"uint8array";}if(support.arraybuffer&&input instanceof ArrayBuffer){return"arraybuffer";}};/**
			 * Throw an exception if the type is not supported.
			 * @param {String} type the type to check.
			 * @throws {Error} an Error if the browser doesn't support the requested type.
			 */exports.checkSupport=function(type){var supported=support[type.toLowerCase()];if(!supported){throw new Error(type+" is not supported by this platform");}};exports.MAX_VALUE_16BITS=65535;exports.MAX_VALUE_32BITS=-1;// well, "\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF" is parsed as -1
/**
			 * Prettify a string read as binary.
			 * @param {string} str the string to prettify.
			 * @return {string} a pretty string.
			 */exports.pretty=function(str){var res='',code,i;for(i=0;i<(str||"").length;i++){code=str.charCodeAt(i);res+='\\x'+(code<16?"0":"")+code.toString(16).toUpperCase();}return res;};/**
			 * Defer the call of a function.
			 * @param {Function} callback the function to call asynchronously.
			 * @param {Array} args the arguments to give to the callback.
			 */exports.delay=function(callback,args,self){setImmediate(function(){callback.apply(self||null,args||[]);});};/**
			 * Extends a prototype with an other, without calling a constructor with
			 * side effects. Inspired by nodejs' `utils.inherits`
			 * @param {Function} ctor the constructor to augment
			 * @param {Function} superCtor the parent constructor to use
			 */exports.inherits=function(ctor,superCtor){var Obj=function Obj(){};Obj.prototype=superCtor.prototype;ctor.prototype=new Obj();};/**
			 * Merge the objects passed as parameters into a new one.
			 * @private
			 * @param {...Object} var_args All objects to merge.
			 * @return {Object} a new object with the data of the others.
			 */exports.extend=function(){var result={},i,attr;for(i=0;i<arguments.length;i++){// arguments is not enumerable in some browsers
for(attr in arguments[i]){if(arguments[i].hasOwnProperty(attr)&&typeof result[attr]==="undefined"){result[attr]=arguments[i][attr];}}}return result;};/**
			 * Transform arbitrary content into a Promise.
			 * @param {String} name a name for the content being processed.
			 * @param {Object} inputData the content to process.
			 * @param {Boolean} isBinary true if the content is not an unicode string
			 * @param {Boolean} isOptimizedBinaryString true if the string content only has one byte per character.
			 * @param {Boolean} isBase64 true if the string content is encoded with base64.
			 * @return {Promise} a promise in a format usable by JSZip.
			 */exports.prepareContent=function(name,inputData,isBinary,isOptimizedBinaryString,isBase64){// if inputData is already a promise, this flatten it.
var promise=external.Promise.resolve(inputData).then(function(data){var isBlob=support.blob&&(data instanceof Blob||['[object File]','[object Blob]'].indexOf(Object.prototype.toString.call(data))!==-1);if(isBlob&&typeof FileReader!=="undefined"){return new external.Promise(function(resolve,reject){var reader=new FileReader();reader.onload=function(e){resolve(e.target.result);};reader.onerror=function(e){reject(e.target.error);};reader.readAsArrayBuffer(data);});}else{return data;}});return promise.then(function(data){var dataType=exports.getTypeOf(data);if(!dataType){return external.Promise.reject(new Error("Can't read the data of '"+name+"'. Is it "+"in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"));}// special case : it's way easier to work with Uint8Array than with ArrayBuffer
if(dataType==="arraybuffer"){data=exports.transformTo("uint8array",data);}else if(dataType==="string"){if(isBase64){data=base64.decode(data);}else if(isBinary){// optimizedBinaryString === true means that the file has already been filtered with a 0xFF mask
if(isOptimizedBinaryString!==true){// this is a string, not in a base64 format.
// Be sure that this is a correct "binary string"
data=string2binary(data);}}}return data;});};},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"set-immediate-shim":54}],33:[function(require,module,exports){var readerFor=require('./reader/readerFor');var utils=require('./utils');var sig=require('./signature');var ZipEntry=require('./zipEntry');require('./utf8');var support=require('./support');//  class ZipEntries {{{
/**
			 * All the entries in the zip file.
			 * @constructor
			 * @param {Object} loadOptions Options for loading the stream.
			 */function ZipEntries(loadOptions){this.files=[];this.loadOptions=loadOptions;}ZipEntries.prototype={/**
			     * Check that the reader is on the specified signature.
			     * @param {string} expectedSignature the expected signature.
			     * @throws {Error} if it is an other signature.
			     */checkSignature:function checkSignature(expectedSignature){if(!this.reader.readAndCheckSignature(expectedSignature)){this.reader.index-=4;var signature=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature "+"("+utils.pretty(signature)+", expected "+utils.pretty(expectedSignature)+")");}},/**
			     * Check if the given signature is at the given index.
			     * @param {number} askedIndex the index to check.
			     * @param {string} expectedSignature the signature to expect.
			     * @return {boolean} true if the signature is here, false otherwise.
			     */isSignature:function isSignature(askedIndex,expectedSignature){var currentIndex=this.reader.index;this.reader.setIndex(askedIndex);var signature=this.reader.readString(4);var result=signature===expectedSignature;this.reader.setIndex(currentIndex);return result;},/**
			     * Read the end of the central directory.
			     */readBlockEndOfCentral:function readBlockEndOfCentral(){this.diskNumber=this.reader.readInt(2);this.diskWithCentralDirStart=this.reader.readInt(2);this.centralDirRecordsOnThisDisk=this.reader.readInt(2);this.centralDirRecords=this.reader.readInt(2);this.centralDirSize=this.reader.readInt(4);this.centralDirOffset=this.reader.readInt(4);this.zipCommentLength=this.reader.readInt(2);// warning : the encoding depends of the system locale
// On a linux machine with LANG=en_US.utf8, this field is utf8 encoded.
// On a windows machine, this field is encoded with the localized windows code page.
var zipComment=this.reader.readData(this.zipCommentLength);var decodeParamType=support.uint8array?"uint8array":"array";// To get consistent behavior with the generation part, we will assume that
// this is utf8 encoded unless specified otherwise.
var decodeContent=utils.transformTo(decodeParamType,zipComment);this.zipComment=this.loadOptions.decodeFileName(decodeContent);},/**
			     * Read the end of the Zip 64 central directory.
			     * Not merged with the method readEndOfCentral :
			     * The end of central can coexist with its Zip64 brother,
			     * I don't want to read the wrong number of bytes !
			     */readBlockZip64EndOfCentral:function readBlockZip64EndOfCentral(){this.zip64EndOfCentralSize=this.reader.readInt(8);this.reader.skip(4);// this.versionMadeBy = this.reader.readString(2);
// this.versionNeeded = this.reader.readInt(2);
this.diskNumber=this.reader.readInt(4);this.diskWithCentralDirStart=this.reader.readInt(4);this.centralDirRecordsOnThisDisk=this.reader.readInt(8);this.centralDirRecords=this.reader.readInt(8);this.centralDirSize=this.reader.readInt(8);this.centralDirOffset=this.reader.readInt(8);this.zip64ExtensibleData={};var extraDataSize=this.zip64EndOfCentralSize-44,index=0,extraFieldId,extraFieldLength,extraFieldValue;while(index<extraDataSize){extraFieldId=this.reader.readInt(2);extraFieldLength=this.reader.readInt(4);extraFieldValue=this.reader.readData(extraFieldLength);this.zip64ExtensibleData[extraFieldId]={id:extraFieldId,length:extraFieldLength,value:extraFieldValue};}},/**
			     * Read the end of the Zip 64 central directory locator.
			     */readBlockZip64EndOfCentralLocator:function readBlockZip64EndOfCentralLocator(){this.diskWithZip64CentralDirStart=this.reader.readInt(4);this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8);this.disksCount=this.reader.readInt(4);if(this.disksCount>1){throw new Error("Multi-volumes zip are not supported");}},/**
			     * Read the local files, based on the offset read in the central part.
			     */readLocalFiles:function readLocalFiles(){var i,file;for(i=0;i<this.files.length;i++){file=this.files[i];this.reader.setIndex(file.localHeaderOffset);this.checkSignature(sig.LOCAL_FILE_HEADER);file.readLocalPart(this.reader);file.handleUTF8();file.processAttributes();}},/**
			     * Read the central directory.
			     */readCentralDir:function readCentralDir(){var file;this.reader.setIndex(this.centralDirOffset);while(this.reader.readAndCheckSignature(sig.CENTRAL_FILE_HEADER)){file=new ZipEntry({zip64:this.zip64},this.loadOptions);file.readCentralPart(this.reader);this.files.push(file);}if(this.centralDirRecords!==this.files.length){if(this.centralDirRecords!==0&&this.files.length===0){// We expected some records but couldn't find ANY.
// This is really suspicious, as if something went wrong.
throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length);}}},/**
			     * Read the end of central directory.
			     */readEndOfCentral:function readEndOfCentral(){var offset=this.reader.lastIndexOfSignature(sig.CENTRAL_DIRECTORY_END);if(offset<0){// Check if the content is a truncated zip or complete garbage.
// A "LOCAL_FILE_HEADER" is not required at the beginning (auto
// extractible zip for example) but it can give a good hint.
// If an ajax request was used without responseType, we will also
// get unreadable data.
var isGarbage=!this.isSignature(0,sig.LOCAL_FILE_HEADER);if(isGarbage){throw new Error("Can't find end of central directory : is this a zip file ? "+"If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");}else{throw new Error("Corrupted zip: can't find end of central directory");}}this.reader.setIndex(offset);var endOfCentralDirOffset=offset;this.checkSignature(sig.CENTRAL_DIRECTORY_END);this.readBlockEndOfCentral();/* extract from the zip spec :
			            4)  If one of the fields in the end of central directory
			                record is too small to hold required data, the field
			                should be set to -1 (0xFFFF or 0xFFFFFFFF) and the
			                ZIP64 format record should be created.
			            5)  The end of central directory record and the
			                Zip64 end of central directory locator record must
			                reside on the same disk when splitting or spanning
			                an archive.
			         */if(this.diskNumber===utils.MAX_VALUE_16BITS||this.diskWithCentralDirStart===utils.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===utils.MAX_VALUE_16BITS||this.centralDirRecords===utils.MAX_VALUE_16BITS||this.centralDirSize===utils.MAX_VALUE_32BITS||this.centralDirOffset===utils.MAX_VALUE_32BITS){this.zip64=true;/*
			            Warning : the zip64 extension is supported, but ONLY if the 64bits integer read from
			            the zip file can fit into a 32bits integer. This cannot be solved : JavaScript represents
			            all numbers as 64-bit double precision IEEE 754 floating point numbers.
			            So, we have 53bits for integers and bitwise operations treat everything as 32bits.
			            see https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Operators/Bitwise_Operators
			            and http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-262.pdf section 8.5
			            */ // should look for a zip64 EOCD locator
offset=this.reader.lastIndexOfSignature(sig.ZIP64_CENTRAL_DIRECTORY_LOCATOR);if(offset<0){throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");}this.reader.setIndex(offset);this.checkSignature(sig.ZIP64_CENTRAL_DIRECTORY_LOCATOR);this.readBlockZip64EndOfCentralLocator();// now the zip64 EOCD record
if(!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,sig.ZIP64_CENTRAL_DIRECTORY_END)){// console.warn("ZIP64 end of central directory not where expected.");
this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(sig.ZIP64_CENTRAL_DIRECTORY_END);if(this.relativeOffsetEndOfZip64CentralDir<0){throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");}}this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir);this.checkSignature(sig.ZIP64_CENTRAL_DIRECTORY_END);this.readBlockZip64EndOfCentral();}var expectedEndOfCentralDirOffset=this.centralDirOffset+this.centralDirSize;if(this.zip64){expectedEndOfCentralDirOffset+=20;// end of central dir 64 locator
expectedEndOfCentralDirOffset+=12/* should not include the leading 12 bytes */+this.zip64EndOfCentralSize;}var extraBytes=endOfCentralDirOffset-expectedEndOfCentralDirOffset;if(extraBytes>0){// console.warn(extraBytes, "extra bytes at beginning or within zipfile");
if(this.isSignature(endOfCentralDirOffset,sig.CENTRAL_FILE_HEADER));else{// the offset is wrong, update the "zero" of the reader
// this happens if data has been prepended (crx files for example)
this.reader.zero=extraBytes;}}else if(extraBytes<0){throw new Error("Corrupted zip: missing "+Math.abs(extraBytes)+" bytes.");}},prepareReader:function prepareReader(data){this.reader=readerFor(data);},/**
			     * Read a zip file and create ZipEntries.
			     * @param {String|ArrayBuffer|Uint8Array|Buffer} data the binary string representing a zip file.
			     */load:function load(data){this.prepareReader(data);this.readEndOfCentral();this.readCentralDir();this.readLocalFiles();}};// }}} end of ZipEntries
module.exports=ZipEntries;},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(require,module,exports){var readerFor=require('./reader/readerFor');var utils=require('./utils');var CompressedObject=require('./compressedObject');var crc32fn=require('./crc32');var utf8=require('./utf8');var compressions=require('./compressions');var support=require('./support');var MADE_BY_DOS=0x00;var MADE_BY_UNIX=0x03;/**
			 * Find a compression registered in JSZip.
			 * @param {string} compressionMethod the method magic to find.
			 * @return {Object|null} the JSZip compression object, null if none found.
			 */var findCompression=function findCompression(compressionMethod){for(var method in compressions){if(!compressions.hasOwnProperty(method)){continue;}if(compressions[method].magic===compressionMethod){return compressions[method];}}return null;};// class ZipEntry {{{
/**
			 * An entry in the zip file.
			 * @constructor
			 * @param {Object} options Options of the current file.
			 * @param {Object} loadOptions Options for loading the stream.
			 */function ZipEntry(options,loadOptions){this.options=options;this.loadOptions=loadOptions;}ZipEntry.prototype={/**
			     * say if the file is encrypted.
			     * @return {boolean} true if the file is encrypted, false otherwise.
			     */isEncrypted:function isEncrypted(){// bit 1 is set
return(this.bitFlag&0x0001)===0x0001;},/**
			     * say if the file has utf-8 filename/comment.
			     * @return {boolean} true if the filename/comment is in utf-8, false otherwise.
			     */useUTF8:function useUTF8(){// bit 11 is set
return(this.bitFlag&0x0800)===0x0800;},/**
			     * Read the local part of a zip file and add the info in this object.
			     * @param {DataReader} reader the reader to use.
			     */readLocalPart:function readLocalPart(reader){var compression,localExtraFieldsLength;// we already know everything from the central dir !
// If the central dir data are false, we are doomed.
// On the bright side, the local part is scary  : zip64, data descriptors, both, etc.
// The less data we get here, the more reliable this should be.
// Let's skip the whole header and dash to the data !
reader.skip(22);// in some zip created on windows, the filename stored in the central dir contains \ instead of /.
// Strangely, the filename here is OK.
// I would love to treat these zip files as corrupted (see http://www.info-zip.org/FAQ.html#backslashes
// or APPNOTE#4.4.17.1, "All slashes MUST be forward slashes '/'") but there are a lot of bad zip generators...
// Search "unzip mismatching "local" filename continuing with "central" filename version" on
// the internet.
//
// I think I see the logic here : the central directory is used to display
// content and the local directory is used to extract the files. Mixing / and \
// may be used to display \ to windows users and use / when extracting the files.
// Unfortunately, this lead also to some issues : http://seclists.org/fulldisclosure/2009/Sep/394
this.fileNameLength=reader.readInt(2);localExtraFieldsLength=reader.readInt(2);// can't be sure this will be the same as the central dir
// the fileName is stored as binary data, the handleUTF8 method will take care of the encoding.
this.fileName=reader.readData(this.fileNameLength);reader.skip(localExtraFieldsLength);if(this.compressedSize===-1||this.uncompressedSize===-1){throw new Error("Bug or corrupted zip : didn't get enough information from the central directory "+"(compressedSize === -1 || uncompressedSize === -1)");}compression=findCompression(this.compressionMethod);if(compression===null){// no compression found
throw new Error("Corrupted zip : compression "+utils.pretty(this.compressionMethod)+" unknown (inner file : "+utils.transformTo("string",this.fileName)+")");}this.decompressed=new CompressedObject(this.compressedSize,this.uncompressedSize,this.crc32,compression,reader.readData(this.compressedSize));},/**
			     * Read the central part of a zip file and add the info in this object.
			     * @param {DataReader} reader the reader to use.
			     */readCentralPart:function readCentralPart(reader){this.versionMadeBy=reader.readInt(2);reader.skip(2);// this.versionNeeded = reader.readInt(2);
this.bitFlag=reader.readInt(2);this.compressionMethod=reader.readString(2);this.date=reader.readDate();this.crc32=reader.readInt(4);this.compressedSize=reader.readInt(4);this.uncompressedSize=reader.readInt(4);var fileNameLength=reader.readInt(2);this.extraFieldsLength=reader.readInt(2);this.fileCommentLength=reader.readInt(2);this.diskNumberStart=reader.readInt(2);this.internalFileAttributes=reader.readInt(2);this.externalFileAttributes=reader.readInt(4);this.localHeaderOffset=reader.readInt(4);if(this.isEncrypted()){throw new Error("Encrypted zip are not supported");}// will be read in the local part, see the comments there
reader.skip(fileNameLength);this.readExtraFields(reader);this.parseZIP64ExtraField(reader);this.fileComment=reader.readData(this.fileCommentLength);},/**
			     * Parse the external file attributes and get the unix/dos permissions.
			     */processAttributes:function processAttributes(){this.unixPermissions=null;this.dosPermissions=null;var madeBy=this.versionMadeBy>>8;// Check if we have the DOS directory flag set.
// We look for it in the DOS and UNIX permissions
// but some unknown platform could set it as a compatibility flag.
this.dir=this.externalFileAttributes&0x0010?true:false;if(madeBy===MADE_BY_DOS){// first 6 bits (0 to 5)
this.dosPermissions=this.externalFileAttributes&0x3F;}if(madeBy===MADE_BY_UNIX){this.unixPermissions=this.externalFileAttributes>>16&0xFFFF;// the octal permissions are in (this.unixPermissions & 0x01FF).toString(8);
}// fail safe : if the name ends with a / it probably means a folder
if(!this.dir&&this.fileNameStr.slice(-1)==='/'){this.dir=true;}},/**
			     * Parse the ZIP64 extra field and merge the info in the current ZipEntry.
			     * @param {DataReader} reader the reader to use.
			     */parseZIP64ExtraField:function parseZIP64ExtraField(reader){if(!this.extraFields[0x0001]){return;}// should be something, preparing the extra reader
var extraReader=readerFor(this.extraFields[0x0001].value);// I really hope that these 64bits integer can fit in 32 bits integer, because js
// won't let us have more.
if(this.uncompressedSize===utils.MAX_VALUE_32BITS){this.uncompressedSize=extraReader.readInt(8);}if(this.compressedSize===utils.MAX_VALUE_32BITS){this.compressedSize=extraReader.readInt(8);}if(this.localHeaderOffset===utils.MAX_VALUE_32BITS){this.localHeaderOffset=extraReader.readInt(8);}if(this.diskNumberStart===utils.MAX_VALUE_32BITS){this.diskNumberStart=extraReader.readInt(4);}},/**
			     * Read the central part of a zip file and add the info in this object.
			     * @param {DataReader} reader the reader to use.
			     */readExtraFields:function readExtraFields(reader){var end=reader.index+this.extraFieldsLength,extraFieldId,extraFieldLength,extraFieldValue;if(!this.extraFields){this.extraFields={};}while(reader.index+4<end){extraFieldId=reader.readInt(2);extraFieldLength=reader.readInt(2);extraFieldValue=reader.readData(extraFieldLength);this.extraFields[extraFieldId]={id:extraFieldId,length:extraFieldLength,value:extraFieldValue};}reader.setIndex(end);},/**
			     * Apply an UTF8 transformation if needed.
			     */handleUTF8:function handleUTF8(){var decodeParamType=support.uint8array?"uint8array":"array";if(this.useUTF8()){this.fileNameStr=utf8.utf8decode(this.fileName);this.fileCommentStr=utf8.utf8decode(this.fileComment);}else{var upath=this.findExtraFieldUnicodePath();if(upath!==null){this.fileNameStr=upath;}else{// ASCII text or unsupported code page
var fileNameByteArray=utils.transformTo(decodeParamType,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(fileNameByteArray);}var ucomment=this.findExtraFieldUnicodeComment();if(ucomment!==null){this.fileCommentStr=ucomment;}else{// ASCII text or unsupported code page
var commentByteArray=utils.transformTo(decodeParamType,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(commentByteArray);}}},/**
			     * Find the unicode path declared in the extra field, if any.
			     * @return {String} the unicode path, null otherwise.
			     */findExtraFieldUnicodePath:function findExtraFieldUnicodePath(){var upathField=this.extraFields[0x7075];if(upathField){var extraReader=readerFor(upathField.value);// wrong version
if(extraReader.readInt(1)!==1){return null;}// the crc of the filename changed, this field is out of date.
if(crc32fn(this.fileName)!==extraReader.readInt(4)){return null;}return utf8.utf8decode(extraReader.readData(upathField.length-5));}return null;},/**
			     * Find the unicode comment declared in the extra field, if any.
			     * @return {String} the unicode comment, null otherwise.
			     */findExtraFieldUnicodeComment:function findExtraFieldUnicodeComment(){var ucommentField=this.extraFields[0x6375];if(ucommentField){var extraReader=readerFor(ucommentField.value);// wrong version
if(extraReader.readInt(1)!==1){return null;}// the crc of the comment changed, this field is out of date.
if(crc32fn(this.fileComment)!==extraReader.readInt(4)){return null;}return utf8.utf8decode(extraReader.readData(ucommentField.length-5));}return null;}};module.exports=ZipEntry;},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(require,module,exports){var StreamHelper=require('./stream/StreamHelper');var DataWorker=require('./stream/DataWorker');var utf8=require('./utf8');var CompressedObject=require('./compressedObject');var GenericWorker=require('./stream/GenericWorker');/**
			 * A simple object representing a file in the zip file.
			 * @constructor
			 * @param {string} name the name of the file
			 * @param {String|ArrayBuffer|Uint8Array|Buffer} data the data
			 * @param {Object} options the options of the file
			 */var ZipObject=function ZipObject(name,data,options){this.name=name;this.dir=options.dir;this.date=options.date;this.comment=options.comment;this.unixPermissions=options.unixPermissions;this.dosPermissions=options.dosPermissions;this._data=data;this._dataBinary=options.binary;// keep only the compression
this.options={compression:options.compression,compressionOptions:options.compressionOptions};};ZipObject.prototype={/**
			     * Create an internal stream for the content of this object.
			     * @param {String} type the type of each chunk.
			     * @return StreamHelper the stream.
			     */internalStream:function internalStream(type){var result=null,outputType="string";try{if(!type){throw new Error("No output type specified.");}outputType=type.toLowerCase();var askUnicodeString=outputType==="string"||outputType==="text";if(outputType==="binarystring"||outputType==="text"){outputType="string";}result=this._decompressWorker();var isUnicodeString=!this._dataBinary;if(isUnicodeString&&!askUnicodeString){result=result.pipe(new utf8.Utf8EncodeWorker());}if(!isUnicodeString&&askUnicodeString){result=result.pipe(new utf8.Utf8DecodeWorker());}}catch(e){result=new GenericWorker("error");result.error(e);}return new StreamHelper(result,outputType,"");},/**
			     * Prepare the content in the asked type.
			     * @param {String} type the type of the result.
			     * @param {Function} onUpdate a function to call on each internal update.
			     * @return Promise the promise of the result.
			     */async:function async(type,onUpdate){return this.internalStream(type).accumulate(onUpdate);},/**
			     * Prepare the content as a nodejs stream.
			     * @param {String} type the type of each chunk.
			     * @param {Function} onUpdate a function to call on each internal update.
			     * @return Stream the stream.
			     */nodeStream:function nodeStream(type,onUpdate){return this.internalStream(type||"nodebuffer").toNodejsStream(onUpdate);},/**
			     * Return a worker for the compressed content.
			     * @private
			     * @param {Object} compression the compression object to use.
			     * @param {Object} compressionOptions the options to use when compressing.
			     * @return Worker the worker.
			     */_compressWorker:function _compressWorker(compression,compressionOptions){if(this._data instanceof CompressedObject&&this._data.compression.magic===compression.magic){return this._data.getCompressedWorker();}else{var result=this._decompressWorker();if(!this._dataBinary){result=result.pipe(new utf8.Utf8EncodeWorker());}return CompressedObject.createWorkerFrom(result,compression,compressionOptions);}},/**
			     * Return a worker for the decompressed content.
			     * @private
			     * @return Worker the worker.
			     */_decompressWorker:function _decompressWorker(){if(this._data instanceof CompressedObject){return this._data.getContentWorker();}else if(this._data instanceof GenericWorker){return this._data;}else{return new DataWorker(this._data);}}};var removedMethods=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"];var removedFn=function removedFn(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.");};for(var i=0;i<removedMethods.length;i++){ZipObject.prototype[removedMethods[i]]=removedFn;}module.exports=ZipObject;},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(require,module,exports){(function(global){var Mutation=global.MutationObserver||global.WebKitMutationObserver;var scheduleDrain;{if(Mutation){var called=0;var observer=new Mutation(nextTick);var element=global.document.createTextNode('');observer.observe(element,{characterData:true});scheduleDrain=function scheduleDrain(){element.data=called=++called%2;};}else if(!global.setImmediate&&typeof global.MessageChannel!=='undefined'){var channel=new global.MessageChannel();channel.port1.onmessage=nextTick;scheduleDrain=function scheduleDrain(){channel.port2.postMessage(0);};}else if('document'in global&&'onreadystatechange'in global.document.createElement('script')){scheduleDrain=function scheduleDrain(){// Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted
// into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.
var scriptEl=global.document.createElement('script');scriptEl.onreadystatechange=function(){nextTick();scriptEl.onreadystatechange=null;scriptEl.parentNode.removeChild(scriptEl);scriptEl=null;};global.document.documentElement.appendChild(scriptEl);};}else{scheduleDrain=function scheduleDrain(){setTimeout(nextTick,0);};}}var draining;var queue=[];//named nextTick for less confusing stack traces
function nextTick(){draining=true;var i,oldQueue;var len=queue.length;while(len){oldQueue=queue;queue=[];i=-1;while(++i<len){oldQueue[i]();}len=queue.length;}draining=false;}module.exports=immediate;function immediate(task){if(queue.push(task)===1&&!draining){scheduleDrain();}}}).call(this,typeof commonjsGlobal!=="undefined"?commonjsGlobal:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{});},{}],37:[function(require,module,exports){var immediate=require('immediate');/* istanbul ignore next */function INTERNAL(){}var handlers={};var REJECTED=['REJECTED'];var FULFILLED=['FULFILLED'];var PENDING=['PENDING'];module.exports=Promise;function Promise(resolver){if(typeof resolver!=='function'){throw new TypeError('resolver must be a function');}this.state=PENDING;this.queue=[];this.outcome=void 0;if(resolver!==INTERNAL){safelyResolveThenable(this,resolver);}}Promise.prototype["finally"]=function(callback){if(typeof callback!=='function'){return this;}var p=this.constructor;return this.then(resolve,reject);function resolve(value){function yes(){return value;}return p.resolve(callback()).then(yes);}function reject(reason){function no(){throw reason;}return p.resolve(callback()).then(no);}};Promise.prototype["catch"]=function(onRejected){return this.then(null,onRejected);};Promise.prototype.then=function(onFulfilled,onRejected){if(typeof onFulfilled!=='function'&&this.state===FULFILLED||typeof onRejected!=='function'&&this.state===REJECTED){return this;}var promise=new this.constructor(INTERNAL);if(this.state!==PENDING){var resolver=this.state===FULFILLED?onFulfilled:onRejected;unwrap(promise,resolver,this.outcome);}else{this.queue.push(new QueueItem(promise,onFulfilled,onRejected));}return promise;};function QueueItem(promise,onFulfilled,onRejected){this.promise=promise;if(typeof onFulfilled==='function'){this.onFulfilled=onFulfilled;this.callFulfilled=this.otherCallFulfilled;}if(typeof onRejected==='function'){this.onRejected=onRejected;this.callRejected=this.otherCallRejected;}}QueueItem.prototype.callFulfilled=function(value){handlers.resolve(this.promise,value);};QueueItem.prototype.otherCallFulfilled=function(value){unwrap(this.promise,this.onFulfilled,value);};QueueItem.prototype.callRejected=function(value){handlers.reject(this.promise,value);};QueueItem.prototype.otherCallRejected=function(value){unwrap(this.promise,this.onRejected,value);};function unwrap(promise,func,value){immediate(function(){var returnValue;try{returnValue=func(value);}catch(e){return handlers.reject(promise,e);}if(returnValue===promise){handlers.reject(promise,new TypeError('Cannot resolve promise with itself'));}else{handlers.resolve(promise,returnValue);}});}handlers.resolve=function(self,value){var result=tryCatch(getThen,value);if(result.status==='error'){return handlers.reject(self,result.value);}var thenable=result.value;if(thenable){safelyResolveThenable(self,thenable);}else{self.state=FULFILLED;self.outcome=value;var i=-1;var len=self.queue.length;while(++i<len){self.queue[i].callFulfilled(value);}}return self;};handlers.reject=function(self,error){self.state=REJECTED;self.outcome=error;var i=-1;var len=self.queue.length;while(++i<len){self.queue[i].callRejected(error);}return self;};function getThen(obj){// Make sure we only access the accessor once as required by the spec
var then=obj&&obj.then;if(obj&&(_typeof3(obj)==='object'||typeof obj==='function')&&typeof then==='function'){return function appyThen(){then.apply(obj,arguments);};}}function safelyResolveThenable(self,thenable){// Either fulfill, reject or reject with error
var called=false;function onError(value){if(called){return;}called=true;handlers.reject(self,value);}function onSuccess(value){if(called){return;}called=true;handlers.resolve(self,value);}function tryToUnwrap(){thenable(onSuccess,onError);}var result=tryCatch(tryToUnwrap);if(result.status==='error'){onError(result.value);}}function tryCatch(func,value){var out={};try{out.value=func(value);out.status='success';}catch(e){out.status='error';out.value=e;}return out;}Promise.resolve=resolve;function resolve(value){if(value instanceof this){return value;}return handlers.resolve(new this(INTERNAL),value);}Promise.reject=reject;function reject(reason){var promise=new this(INTERNAL);return handlers.reject(promise,reason);}Promise.all=all;function all(iterable){var self=this;if(Object.prototype.toString.call(iterable)!=='[object Array]'){return this.reject(new TypeError('must be an array'));}var len=iterable.length;var called=false;if(!len){return this.resolve([]);}var values=new Array(len);var resolved=0;var i=-1;var promise=new this(INTERNAL);while(++i<len){allResolver(iterable[i],i);}return promise;function allResolver(value,i){self.resolve(value).then(resolveFromAll,function(error){if(!called){called=true;handlers.reject(promise,error);}});function resolveFromAll(outValue){values[i]=outValue;if(++resolved===len&&!called){called=true;handlers.resolve(promise,values);}}}}Promise.race=race;function race(iterable){var self=this;if(Object.prototype.toString.call(iterable)!=='[object Array]'){return this.reject(new TypeError('must be an array'));}var len=iterable.length;var called=false;if(!len){return this.resolve([]);}var i=-1;var promise=new this(INTERNAL);while(++i<len){resolver(iterable[i]);}return promise;function resolver(value){self.resolve(value).then(function(response){if(!called){called=true;handlers.resolve(promise,response);}},function(error){if(!called){called=true;handlers.reject(promise,error);}});}}},{"immediate":36}],38:[function(require,module,exports){var assign=require('./lib/utils/common').assign;var deflate=require('./lib/deflate');var inflate=require('./lib/inflate');var constants=require('./lib/zlib/constants');var pako={};assign(pako,deflate,inflate,constants);module.exports=pako;},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(require,module,exports){var zlib_deflate=require('./zlib/deflate');var utils=require('./utils/common');var strings=require('./utils/strings');var msg=require('./zlib/messages');var ZStream=require('./zlib/zstream');var toString=Object.prototype.toString;/* Public constants ==========================================================*/ /* ===========================================================================*/var Z_NO_FLUSH=0;var Z_FINISH=4;var Z_OK=0;var Z_STREAM_END=1;var Z_SYNC_FLUSH=2;var Z_DEFAULT_COMPRESSION=-1;var Z_DEFAULT_STRATEGY=0;var Z_DEFLATED=8;/* ===========================================================================*/ /**
			 * class Deflate
			 *
			 * Generic JS-style wrapper for zlib calls. If you don't need
			 * streaming behaviour - use more simple functions: [[deflate]],
			 * [[deflateRaw]] and [[gzip]].
			 **/ /* internal
			 * Deflate.chunks -> Array
			 *
			 * Chunks of output data, if [[Deflate#onData]] not overriden.
			 **/ /**
			 * Deflate.result -> Uint8Array|Array
			 *
			 * Compressed result, generated by default [[Deflate#onData]]
			 * and [[Deflate#onEnd]] handlers. Filled after you push last chunk
			 * (call [[Deflate#push]] with `Z_FINISH` / `true` param)  or if you
			 * push a chunk with explicit flush (call [[Deflate#push]] with
			 * `Z_SYNC_FLUSH` param).
			 **/ /**
			 * Deflate.err -> Number
			 *
			 * Error code after deflate finished. 0 (Z_OK) on success.
			 * You will not need it in real life, because deflate errors
			 * are possible only on wrong options or bad `onData` / `onEnd`
			 * custom handlers.
			 **/ /**
			 * Deflate.msg -> String
			 *
			 * Error message, if [[Deflate.err]] != 0
			 **/ /**
			 * new Deflate(options)
			 * - options (Object): zlib deflate options.
			 *
			 * Creates new deflator instance with specified params. Throws exception
			 * on bad params. Supported options:
			 *
			 * - `level`
			 * - `windowBits`
			 * - `memLevel`
			 * - `strategy`
			 * - `dictionary`
			 *
			 * [http://zlib.net/manual.html#Advanced](http://zlib.net/manual.html#Advanced)
			 * for more information on these.
			 *
			 * Additional options, for internal needs:
			 *
			 * - `chunkSize` - size of generated data chunks (16K by default)
			 * - `raw` (Boolean) - do raw deflate
			 * - `gzip` (Boolean) - create gzip wrapper
			 * - `to` (String) - if equal to 'string', then result will be "binary string"
			 *    (each char code [0..255])
			 * - `header` (Object) - custom header for gzip
			 *   - `text` (Boolean) - true if compressed data believed to be text
			 *   - `time` (Number) - modification time, unix timestamp
			 *   - `os` (Number) - operation system code
			 *   - `extra` (Array) - array of bytes with extra data (max 65536)
			 *   - `name` (String) - file name (binary string)
			 *   - `comment` (String) - comment (binary string)
			 *   - `hcrc` (Boolean) - true if header crc should be added
			 *
			 * ##### Example:
			 *
			 * ```javascript
			 * var pako = require('pako')
			 *   , chunk1 = Uint8Array([1,2,3,4,5,6,7,8,9])
			 *   , chunk2 = Uint8Array([10,11,12,13,14,15,16,17,18,19]);
			 *
			 * var deflate = new pako.Deflate({ level: 3});
			 *
			 * deflate.push(chunk1, false);
			 * deflate.push(chunk2, true);  // true -> last chunk
			 *
			 * if (deflate.err) { throw new Error(deflate.err); }
			 *
			 * console.log(deflate.result);
			 * ```
			 **/function Deflate(options){if(!(this instanceof Deflate))return new Deflate(options);this.options=utils.assign({level:Z_DEFAULT_COMPRESSION,method:Z_DEFLATED,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY,to:''},options||{});var opt=this.options;if(opt.raw&&opt.windowBits>0){opt.windowBits=-opt.windowBits;}else if(opt.gzip&&opt.windowBits>0&&opt.windowBits<16){opt.windowBits+=16;}this.err=0;// error code, if happens (0 = Z_OK)
this.msg='';// error message
this.ended=false;// used to avoid multiple onEnd() calls
this.chunks=[];// chunks of compressed data
this.strm=new ZStream();this.strm.avail_out=0;var status=zlib_deflate.deflateInit2(this.strm,opt.level,opt.method,opt.windowBits,opt.memLevel,opt.strategy);if(status!==Z_OK){throw new Error(msg[status]);}if(opt.header){zlib_deflate.deflateSetHeader(this.strm,opt.header);}if(opt.dictionary){var dict;// Convert data if needed
if(typeof opt.dictionary==='string'){// If we need to compress text, change encoding to utf8.
dict=strings.string2buf(opt.dictionary);}else if(toString.call(opt.dictionary)==='[object ArrayBuffer]'){dict=new Uint8Array(opt.dictionary);}else{dict=opt.dictionary;}status=zlib_deflate.deflateSetDictionary(this.strm,dict);if(status!==Z_OK){throw new Error(msg[status]);}this._dict_set=true;}}/**
			 * Deflate#push(data[, mode]) -> Boolean
			 * - data (Uint8Array|Array|ArrayBuffer|String): input data. Strings will be
			 *   converted to utf8 byte sequence.
			 * - mode (Number|Boolean): 0..6 for corresponding Z_NO_FLUSH..Z_TREE modes.
			 *   See constants. Skipped or `false` means Z_NO_FLUSH, `true` meansh Z_FINISH.
			 *
			 * Sends input data to deflate pipe, generating [[Deflate#onData]] calls with
			 * new compressed chunks. Returns `true` on success. The last data block must have
			 * mode Z_FINISH (or `true`). That will flush internal pending buffers and call
			 * [[Deflate#onEnd]]. For interim explicit flushes (without ending the stream) you
			 * can use mode Z_SYNC_FLUSH, keeping the compression context.
			 *
			 * On fail call [[Deflate#onEnd]] with error code and return false.
			 *
			 * We strongly recommend to use `Uint8Array` on input for best speed (output
			 * array format is detected automatically). Also, don't skip last param and always
			 * use the same type in your code (boolean or number). That will improve JS speed.
			 *
			 * For regular `Array`-s make sure all elements are [0..255].
			 *
			 * ##### Example
			 *
			 * ```javascript
			 * push(chunk, false); // push one of data chunks
			 * ...
			 * push(chunk, true);  // push last chunk
			 * ```
			 **/Deflate.prototype.push=function(data,mode){var strm=this.strm;var chunkSize=this.options.chunkSize;var status,_mode;if(this.ended){return false;}_mode=mode===~~mode?mode:mode===true?Z_FINISH:Z_NO_FLUSH;// Convert data if needed
if(typeof data==='string'){// If we need to compress text, change encoding to utf8.
strm.input=strings.string2buf(data);}else if(toString.call(data)==='[object ArrayBuffer]'){strm.input=new Uint8Array(data);}else{strm.input=data;}strm.next_in=0;strm.avail_in=strm.input.length;do{if(strm.avail_out===0){strm.output=new utils.Buf8(chunkSize);strm.next_out=0;strm.avail_out=chunkSize;}status=zlib_deflate.deflate(strm,_mode);/* no bad return value */if(status!==Z_STREAM_END&&status!==Z_OK){this.onEnd(status);this.ended=true;return false;}if(strm.avail_out===0||strm.avail_in===0&&(_mode===Z_FINISH||_mode===Z_SYNC_FLUSH)){if(this.options.to==='string'){this.onData(strings.buf2binstring(utils.shrinkBuf(strm.output,strm.next_out)));}else{this.onData(utils.shrinkBuf(strm.output,strm.next_out));}}}while((strm.avail_in>0||strm.avail_out===0)&&status!==Z_STREAM_END);// Finalize on the last chunk.
if(_mode===Z_FINISH){status=zlib_deflate.deflateEnd(this.strm);this.onEnd(status);this.ended=true;return status===Z_OK;}// callback interim results if Z_SYNC_FLUSH.
if(_mode===Z_SYNC_FLUSH){this.onEnd(Z_OK);strm.avail_out=0;return true;}return true;};/**
			 * Deflate#onData(chunk) -> Void
			 * - chunk (Uint8Array|Array|String): ouput data. Type of array depends
			 *   on js engine support. When string output requested, each chunk
			 *   will be string.
			 *
			 * By default, stores data blocks in `chunks[]` property and glue
			 * those in `onEnd`. Override this handler, if you need another behaviour.
			 **/Deflate.prototype.onData=function(chunk){this.chunks.push(chunk);};/**
			 * Deflate#onEnd(status) -> Void
			 * - status (Number): deflate status. 0 (Z_OK) on success,
			 *   other if not.
			 *
			 * Called once after you tell deflate that the input stream is
			 * complete (Z_FINISH) or should be flushed (Z_SYNC_FLUSH)
			 * or if an error happened. By default - join collected chunks,
			 * free memory and fill `results` / `err` properties.
			 **/Deflate.prototype.onEnd=function(status){// On success - join
if(status===Z_OK){if(this.options.to==='string'){this.result=this.chunks.join('');}else{this.result=utils.flattenChunks(this.chunks);}}this.chunks=[];this.err=status;this.msg=this.strm.msg;};/**
			 * deflate(data[, options]) -> Uint8Array|Array|String
			 * - data (Uint8Array|Array|String): input data to compress.
			 * - options (Object): zlib deflate options.
			 *
			 * Compress `data` with deflate algorithm and `options`.
			 *
			 * Supported options are:
			 *
			 * - level
			 * - windowBits
			 * - memLevel
			 * - strategy
			 * - dictionary
			 *
			 * [http://zlib.net/manual.html#Advanced](http://zlib.net/manual.html#Advanced)
			 * for more information on these.
			 *
			 * Sugar (options):
			 *
			 * - `raw` (Boolean) - say that we work with raw stream, if you don't wish to specify
			 *   negative windowBits implicitly.
			 * - `to` (String) - if equal to 'string', then result will be "binary string"
			 *    (each char code [0..255])
			 *
			 * ##### Example:
			 *
			 * ```javascript
			 * var pako = require('pako')
			 *   , data = Uint8Array([1,2,3,4,5,6,7,8,9]);
			 *
			 * console.log(pako.deflate(data));
			 * ```
			 **/function deflate(input,options){var deflator=new Deflate(options);deflator.push(input,true);// That will never happens, if you don't cheat with options :)
if(deflator.err){throw deflator.msg||msg[deflator.err];}return deflator.result;}/**
			 * deflateRaw(data[, options]) -> Uint8Array|Array|String
			 * - data (Uint8Array|Array|String): input data to compress.
			 * - options (Object): zlib deflate options.
			 *
			 * The same as [[deflate]], but creates raw data, without wrapper
			 * (header and adler32 crc).
			 **/function deflateRaw(input,options){options=options||{};options.raw=true;return deflate(input,options);}/**
			 * gzip(data[, options]) -> Uint8Array|Array|String
			 * - data (Uint8Array|Array|String): input data to compress.
			 * - options (Object): zlib deflate options.
			 *
			 * The same as [[deflate]], but create gzip wrapper instead of
			 * deflate one.
			 **/function gzip(input,options){options=options||{};options.gzip=true;return deflate(input,options);}exports.Deflate=Deflate;exports.deflate=deflate;exports.deflateRaw=deflateRaw;exports.gzip=gzip;},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(require,module,exports){var zlib_inflate=require('./zlib/inflate');var utils=require('./utils/common');var strings=require('./utils/strings');var c=require('./zlib/constants');var msg=require('./zlib/messages');var ZStream=require('./zlib/zstream');var GZheader=require('./zlib/gzheader');var toString=Object.prototype.toString;/**
			 * class Inflate
			 *
			 * Generic JS-style wrapper for zlib calls. If you don't need
			 * streaming behaviour - use more simple functions: [[inflate]]
			 * and [[inflateRaw]].
			 **/ /* internal
			 * inflate.chunks -> Array
			 *
			 * Chunks of output data, if [[Inflate#onData]] not overriden.
			 **/ /**
			 * Inflate.result -> Uint8Array|Array|String
			 *
			 * Uncompressed result, generated by default [[Inflate#onData]]
			 * and [[Inflate#onEnd]] handlers. Filled after you push last chunk
			 * (call [[Inflate#push]] with `Z_FINISH` / `true` param) or if you
			 * push a chunk with explicit flush (call [[Inflate#push]] with
			 * `Z_SYNC_FLUSH` param).
			 **/ /**
			 * Inflate.err -> Number
			 *
			 * Error code after inflate finished. 0 (Z_OK) on success.
			 * Should be checked if broken data possible.
			 **/ /**
			 * Inflate.msg -> String
			 *
			 * Error message, if [[Inflate.err]] != 0
			 **/ /**
			 * new Inflate(options)
			 * - options (Object): zlib inflate options.
			 *
			 * Creates new inflator instance with specified params. Throws exception
			 * on bad params. Supported options:
			 *
			 * - `windowBits`
			 * - `dictionary`
			 *
			 * [http://zlib.net/manual.html#Advanced](http://zlib.net/manual.html#Advanced)
			 * for more information on these.
			 *
			 * Additional options, for internal needs:
			 *
			 * - `chunkSize` - size of generated data chunks (16K by default)
			 * - `raw` (Boolean) - do raw inflate
			 * - `to` (String) - if equal to 'string', then result will be converted
			 *   from utf8 to utf16 (javascript) string. When string output requested,
			 *   chunk length can differ from `chunkSize`, depending on content.
			 *
			 * By default, when no options set, autodetect deflate/gzip data format via
			 * wrapper header.
			 *
			 * ##### Example:
			 *
			 * ```javascript
			 * var pako = require('pako')
			 *   , chunk1 = Uint8Array([1,2,3,4,5,6,7,8,9])
			 *   , chunk2 = Uint8Array([10,11,12,13,14,15,16,17,18,19]);
			 *
			 * var inflate = new pako.Inflate({ level: 3});
			 *
			 * inflate.push(chunk1, false);
			 * inflate.push(chunk2, true);  // true -> last chunk
			 *
			 * if (inflate.err) { throw new Error(inflate.err); }
			 *
			 * console.log(inflate.result);
			 * ```
			 **/function Inflate(options){if(!(this instanceof Inflate))return new Inflate(options);this.options=utils.assign({chunkSize:16384,windowBits:0,to:''},options||{});var opt=this.options;// Force window size for `raw` data, if not set directly,
// because we have no header for autodetect.
if(opt.raw&&opt.windowBits>=0&&opt.windowBits<16){opt.windowBits=-opt.windowBits;if(opt.windowBits===0){opt.windowBits=-15;}}// If `windowBits` not defined (and mode not raw) - set autodetect flag for gzip/deflate
if(opt.windowBits>=0&&opt.windowBits<16&&!(options&&options.windowBits)){opt.windowBits+=32;}// Gzip header has no info about windows size, we can do autodetect only
// for deflate. So, if window size not set, force it to max when gzip possible
if(opt.windowBits>15&&opt.windowBits<48){// bit 3 (16) -> gzipped data
// bit 4 (32) -> autodetect gzip/deflate
if((opt.windowBits&15)===0){opt.windowBits|=15;}}this.err=0;// error code, if happens (0 = Z_OK)
this.msg='';// error message
this.ended=false;// used to avoid multiple onEnd() calls
this.chunks=[];// chunks of compressed data
this.strm=new ZStream();this.strm.avail_out=0;var status=zlib_inflate.inflateInit2(this.strm,opt.windowBits);if(status!==c.Z_OK){throw new Error(msg[status]);}this.header=new GZheader();zlib_inflate.inflateGetHeader(this.strm,this.header);}/**
			 * Inflate#push(data[, mode]) -> Boolean
			 * - data (Uint8Array|Array|ArrayBuffer|String): input data
			 * - mode (Number|Boolean): 0..6 for corresponding Z_NO_FLUSH..Z_TREE modes.
			 *   See constants. Skipped or `false` means Z_NO_FLUSH, `true` meansh Z_FINISH.
			 *
			 * Sends input data to inflate pipe, generating [[Inflate#onData]] calls with
			 * new output chunks. Returns `true` on success. The last data block must have
			 * mode Z_FINISH (or `true`). That will flush internal pending buffers and call
			 * [[Inflate#onEnd]]. For interim explicit flushes (without ending the stream) you
			 * can use mode Z_SYNC_FLUSH, keeping the decompression context.
			 *
			 * On fail call [[Inflate#onEnd]] with error code and return false.
			 *
			 * We strongly recommend to use `Uint8Array` on input for best speed (output
			 * format is detected automatically). Also, don't skip last param and always
			 * use the same type in your code (boolean or number). That will improve JS speed.
			 *
			 * For regular `Array`-s make sure all elements are [0..255].
			 *
			 * ##### Example
			 *
			 * ```javascript
			 * push(chunk, false); // push one of data chunks
			 * ...
			 * push(chunk, true);  // push last chunk
			 * ```
			 **/Inflate.prototype.push=function(data,mode){var strm=this.strm;var chunkSize=this.options.chunkSize;var dictionary=this.options.dictionary;var status,_mode;var next_out_utf8,tail,utf8str;var dict;// Flag to properly process Z_BUF_ERROR on testing inflate call
// when we check that all output data was flushed.
var allowBufError=false;if(this.ended){return false;}_mode=mode===~~mode?mode:mode===true?c.Z_FINISH:c.Z_NO_FLUSH;// Convert data if needed
if(typeof data==='string'){// Only binary strings can be decompressed on practice
strm.input=strings.binstring2buf(data);}else if(toString.call(data)==='[object ArrayBuffer]'){strm.input=new Uint8Array(data);}else{strm.input=data;}strm.next_in=0;strm.avail_in=strm.input.length;do{if(strm.avail_out===0){strm.output=new utils.Buf8(chunkSize);strm.next_out=0;strm.avail_out=chunkSize;}status=zlib_inflate.inflate(strm,c.Z_NO_FLUSH);/* no bad return value */if(status===c.Z_NEED_DICT&&dictionary){// Convert data if needed
if(typeof dictionary==='string'){dict=strings.string2buf(dictionary);}else if(toString.call(dictionary)==='[object ArrayBuffer]'){dict=new Uint8Array(dictionary);}else{dict=dictionary;}status=zlib_inflate.inflateSetDictionary(this.strm,dict);}if(status===c.Z_BUF_ERROR&&allowBufError===true){status=c.Z_OK;allowBufError=false;}if(status!==c.Z_STREAM_END&&status!==c.Z_OK){this.onEnd(status);this.ended=true;return false;}if(strm.next_out){if(strm.avail_out===0||status===c.Z_STREAM_END||strm.avail_in===0&&(_mode===c.Z_FINISH||_mode===c.Z_SYNC_FLUSH)){if(this.options.to==='string'){next_out_utf8=strings.utf8border(strm.output,strm.next_out);tail=strm.next_out-next_out_utf8;utf8str=strings.buf2string(strm.output,next_out_utf8);// move tail
strm.next_out=tail;strm.avail_out=chunkSize-tail;if(tail){utils.arraySet(strm.output,strm.output,next_out_utf8,tail,0);}this.onData(utf8str);}else{this.onData(utils.shrinkBuf(strm.output,strm.next_out));}}}// When no more input data, we should check that internal inflate buffers
// are flushed. The only way to do it when avail_out = 0 - run one more
// inflate pass. But if output data not exists, inflate return Z_BUF_ERROR.
// Here we set flag to process this error properly.
//
// NOTE. Deflate does not return error in this case and does not needs such
// logic.
if(strm.avail_in===0&&strm.avail_out===0){allowBufError=true;}}while((strm.avail_in>0||strm.avail_out===0)&&status!==c.Z_STREAM_END);if(status===c.Z_STREAM_END){_mode=c.Z_FINISH;}// Finalize on the last chunk.
if(_mode===c.Z_FINISH){status=zlib_inflate.inflateEnd(this.strm);this.onEnd(status);this.ended=true;return status===c.Z_OK;}// callback interim results if Z_SYNC_FLUSH.
if(_mode===c.Z_SYNC_FLUSH){this.onEnd(c.Z_OK);strm.avail_out=0;return true;}return true;};/**
			 * Inflate#onData(chunk) -> Void
			 * - chunk (Uint8Array|Array|String): ouput data. Type of array depends
			 *   on js engine support. When string output requested, each chunk
			 *   will be string.
			 *
			 * By default, stores data blocks in `chunks[]` property and glue
			 * those in `onEnd`. Override this handler, if you need another behaviour.
			 **/Inflate.prototype.onData=function(chunk){this.chunks.push(chunk);};/**
			 * Inflate#onEnd(status) -> Void
			 * - status (Number): inflate status. 0 (Z_OK) on success,
			 *   other if not.
			 *
			 * Called either after you tell inflate that the input stream is
			 * complete (Z_FINISH) or should be flushed (Z_SYNC_FLUSH)
			 * or if an error happened. By default - join collected chunks,
			 * free memory and fill `results` / `err` properties.
			 **/Inflate.prototype.onEnd=function(status){// On success - join
if(status===c.Z_OK){if(this.options.to==='string'){// Glue & convert here, until we teach pako to send
// utf8 alligned strings to onData
this.result=this.chunks.join('');}else{this.result=utils.flattenChunks(this.chunks);}}this.chunks=[];this.err=status;this.msg=this.strm.msg;};/**
			 * inflate(data[, options]) -> Uint8Array|Array|String
			 * - data (Uint8Array|Array|String): input data to decompress.
			 * - options (Object): zlib inflate options.
			 *
			 * Decompress `data` with inflate/ungzip and `options`. Autodetect
			 * format via wrapper header by default. That's why we don't provide
			 * separate `ungzip` method.
			 *
			 * Supported options are:
			 *
			 * - windowBits
			 *
			 * [http://zlib.net/manual.html#Advanced](http://zlib.net/manual.html#Advanced)
			 * for more information.
			 *
			 * Sugar (options):
			 *
			 * - `raw` (Boolean) - say that we work with raw stream, if you don't wish to specify
			 *   negative windowBits implicitly.
			 * - `to` (String) - if equal to 'string', then result will be converted
			 *   from utf8 to utf16 (javascript) string. When string output requested,
			 *   chunk length can differ from `chunkSize`, depending on content.
			 *
			 *
			 * ##### Example:
			 *
			 * ```javascript
			 * var pako = require('pako')
			 *   , input = pako.deflate([1,2,3,4,5,6,7,8,9])
			 *   , output;
			 *
			 * try {
			 *   output = pako.inflate(input);
			 * } catch (err)
			 *   console.log(err);
			 * }
			 * ```
			 **/function inflate(input,options){var inflator=new Inflate(options);inflator.push(input,true);// That will never happens, if you don't cheat with options :)
if(inflator.err){throw inflator.msg||msg[inflator.err];}return inflator.result;}/**
			 * inflateRaw(data[, options]) -> Uint8Array|Array|String
			 * - data (Uint8Array|Array|String): input data to decompress.
			 * - options (Object): zlib inflate options.
			 *
			 * The same as [[inflate]], but creates raw data, without wrapper
			 * (header and adler32 crc).
			 **/function inflateRaw(input,options){options=options||{};options.raw=true;return inflate(input,options);}/**
			 * ungzip(data[, options]) -> Uint8Array|Array|String
			 * - data (Uint8Array|Array|String): input data to decompress.
			 * - options (Object): zlib inflate options.
			 *
			 * Just shortcut to [[inflate]], because it autodetects format
			 * by header.content. Done for convenience.
			 **/exports.Inflate=Inflate;exports.inflate=inflate;exports.inflateRaw=inflateRaw;exports.ungzip=inflate;},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(require,module,exports){var TYPED_OK=typeof Uint8Array!=='undefined'&&typeof Uint16Array!=='undefined'&&typeof Int32Array!=='undefined';exports.assign=function(obj/*from1, from2, from3, ...*/){var sources=Array.prototype.slice.call(arguments,1);while(sources.length){var source=sources.shift();if(!source){continue;}if(_typeof3(source)!=='object'){throw new TypeError(source+'must be non-object');}for(var p in source){if(source.hasOwnProperty(p)){obj[p]=source[p];}}}return obj;};// reduce buffer size, avoiding mem copy
exports.shrinkBuf=function(buf,size){if(buf.length===size){return buf;}if(buf.subarray){return buf.subarray(0,size);}buf.length=size;return buf;};var fnTyped={arraySet:function arraySet(dest,src,src_offs,len,dest_offs){if(src.subarray&&dest.subarray){dest.set(src.subarray(src_offs,src_offs+len),dest_offs);return;}// Fallback to ordinary array
for(var i=0;i<len;i++){dest[dest_offs+i]=src[src_offs+i];}},// Join array of chunks to single array.
flattenChunks:function flattenChunks(chunks){var i,l,len,pos,chunk,result;// calculate data length
len=0;for(i=0,l=chunks.length;i<l;i++){len+=chunks[i].length;}// join chunks
result=new Uint8Array(len);pos=0;for(i=0,l=chunks.length;i<l;i++){chunk=chunks[i];result.set(chunk,pos);pos+=chunk.length;}return result;}};var fnUntyped={arraySet:function arraySet(dest,src,src_offs,len,dest_offs){for(var i=0;i<len;i++){dest[dest_offs+i]=src[src_offs+i];}},// Join array of chunks to single array.
flattenChunks:function flattenChunks(chunks){return[].concat.apply([],chunks);}};// Enable/Disable typed arrays use, for testing
//
exports.setTyped=function(on){if(on){exports.Buf8=Uint8Array;exports.Buf16=Uint16Array;exports.Buf32=Int32Array;exports.assign(exports,fnTyped);}else{exports.Buf8=Array;exports.Buf16=Array;exports.Buf32=Array;exports.assign(exports,fnUntyped);}};exports.setTyped(TYPED_OK);},{}],42:[function(require,module,exports){var utils=require('./common');// Quick check if we can use fast array to bin string conversion
//
// - apply(Array) can fail on Android 2.2
// - apply(Uint8Array) can fail on iOS 5.1 Safary
//
var STR_APPLY_OK=true;var STR_APPLY_UIA_OK=true;try{String.fromCharCode.apply(null,[0]);}catch(__){STR_APPLY_OK=false;}try{String.fromCharCode.apply(null,new Uint8Array(1));}catch(__){STR_APPLY_UIA_OK=false;}// Table with utf8 lengths (calculated by first byte of sequence)
// Note, that 5 & 6-byte values and some 4-byte values can not be represented in JS,
// because max possible codepoint is 0x10ffff
var _utf8len=new utils.Buf8(256);for(var q=0;q<256;q++){_utf8len[q]=q>=252?6:q>=248?5:q>=240?4:q>=224?3:q>=192?2:1;}_utf8len[254]=_utf8len[254]=1;// Invalid sequence start
// convert string to array (typed, when possible)
exports.string2buf=function(str){var buf,c,c2,m_pos,i,str_len=str.length,buf_len=0;// count binary size
for(m_pos=0;m_pos<str_len;m_pos++){c=str.charCodeAt(m_pos);if((c&0xfc00)===0xd800&&m_pos+1<str_len){c2=str.charCodeAt(m_pos+1);if((c2&0xfc00)===0xdc00){c=0x10000+(c-0xd800<<10)+(c2-0xdc00);m_pos++;}}buf_len+=c<0x80?1:c<0x800?2:c<0x10000?3:4;}// allocate buffer
buf=new utils.Buf8(buf_len);// convert
for(i=0,m_pos=0;i<buf_len;m_pos++){c=str.charCodeAt(m_pos);if((c&0xfc00)===0xd800&&m_pos+1<str_len){c2=str.charCodeAt(m_pos+1);if((c2&0xfc00)===0xdc00){c=0x10000+(c-0xd800<<10)+(c2-0xdc00);m_pos++;}}if(c<0x80){/* one byte */buf[i++]=c;}else if(c<0x800){/* two bytes */buf[i++]=0xC0|c>>>6;buf[i++]=0x80|c&0x3f;}else if(c<0x10000){/* three bytes */buf[i++]=0xE0|c>>>12;buf[i++]=0x80|c>>>6&0x3f;buf[i++]=0x80|c&0x3f;}else{/* four bytes */buf[i++]=0xf0|c>>>18;buf[i++]=0x80|c>>>12&0x3f;buf[i++]=0x80|c>>>6&0x3f;buf[i++]=0x80|c&0x3f;}}return buf;};// Helper (used in 2 places)
function buf2binstring(buf,len){// use fallback for big arrays to avoid stack overflow
if(len<65537){if(buf.subarray&&STR_APPLY_UIA_OK||!buf.subarray&&STR_APPLY_OK){return String.fromCharCode.apply(null,utils.shrinkBuf(buf,len));}}var result='';for(var i=0;i<len;i++){result+=String.fromCharCode(buf[i]);}return result;}// Convert byte array to binary string
exports.buf2binstring=function(buf){return buf2binstring(buf,buf.length);};// Convert binary string (typed, when possible)
exports.binstring2buf=function(str){var buf=new utils.Buf8(str.length);for(var i=0,len=buf.length;i<len;i++){buf[i]=str.charCodeAt(i);}return buf;};// convert array to string
exports.buf2string=function(buf,max){var i,out,c,c_len;var len=max||buf.length;// Reserve max possible length (2 words per char)
// NB: by unknown reasons, Array is significantly faster for
//     String.fromCharCode.apply than Uint16Array.
var utf16buf=new Array(len*2);for(out=0,i=0;i<len;){c=buf[i++];// quick process ascii
if(c<0x80){utf16buf[out++]=c;continue;}c_len=_utf8len[c];// skip 5 & 6 byte codes
if(c_len>4){utf16buf[out++]=0xfffd;i+=c_len-1;continue;}// apply mask on first byte
c&=c_len===2?0x1f:c_len===3?0x0f:0x07;// join the rest
while(c_len>1&&i<len){c=c<<6|buf[i++]&0x3f;c_len--;}// terminated by end of string?
if(c_len>1){utf16buf[out++]=0xfffd;continue;}if(c<0x10000){utf16buf[out++]=c;}else{c-=0x10000;utf16buf[out++]=0xd800|c>>10&0x3ff;utf16buf[out++]=0xdc00|c&0x3ff;}}return buf2binstring(utf16buf,out);};// Calculate max possible position in utf8 buffer,
// that will not break sequence. If that's not possible
// - (very small limits) return max size as is.
//
// buf[] - utf8 bytes array
// max   - length limit (mandatory);
exports.utf8border=function(buf,max){var pos;max=max||buf.length;if(max>buf.length){max=buf.length;}// go back from last position, until start of sequence found
pos=max-1;while(pos>=0&&(buf[pos]&0xC0)===0x80){pos--;}// Fuckup - very small and broken sequence,
// return max, because we should return something anyway.
if(pos<0){return max;}// If we came to start of buffer - that means vuffer is too small,
// return max too.
if(pos===0){return max;}return pos+_utf8len[buf[pos]]>max?pos:max;};},{"./common":41}],43:[function(require,module,exports){// Note: adler32 takes 12% for level 0 and 2% for level 6.
// It doesn't worth to make additional optimizationa as in original.
// Small size is preferable.
// (C) 1995-2013 Jean-loup Gailly and Mark Adler
// (C) 2014-2017 Vitaly Puzrin and Andrey Tupitsin
//
// This software is provided 'as-is', without any express or implied
// warranty. In no event will the authors be held liable for any damages
// arising from the use of this software.
//
// Permission is granted to anyone to use this software for any purpose,
// including commercial applications, and to alter it and redistribute it
// freely, subject to the following restrictions:
//
// 1. The origin of this software must not be misrepresented; you must not
//   claim that you wrote the original software. If you use this software
//   in a product, an acknowledgment in the product documentation would be
//   appreciated but is not required.
// 2. Altered source versions must be plainly marked as such, and must not be
//   misrepresented as being the original software.
// 3. This notice may not be removed or altered from any source distribution.
function adler32(adler,buf,len,pos){var s1=adler&0xffff|0,s2=adler>>>16&0xffff|0,n=0;while(len!==0){// Set limit ~ twice less than 5552, to keep
// s2 in 31-bits, because we force signed ints.
// in other case %= will fail.
n=len>2000?2000:len;len-=n;do{s1=s1+buf[pos++]|0;s2=s2+s1|0;}while(--n);s1%=65521;s2%=65521;}return s1|s2<<16|0;}module.exports=adler32;},{}],44:[function(require,module,exports){// (C) 1995-2013 Jean-loup Gailly and Mark Adler
// (C) 2014-2017 Vitaly Puzrin and Andrey Tupitsin
//
// This software is provided 'as-is', without any express or implied
// warranty. In no event will the authors be held liable for any damages
// arising from the use of this software.
//
// Permission is granted to anyone to use this software for any purpose,
// including commercial applications, and to alter it and redistribute it
// freely, subject to the following restrictions:
//
// 1. The origin of this software must not be misrepresented; you must not
//   claim that you wrote the original software. If you use this software
//   in a product, an acknowledgment in the product documentation would be
//   appreciated but is not required.
// 2. Altered source versions must be plainly marked as such, and must not be
//   misrepresented as being the original software.
// 3. This notice may not be removed or altered from any source distribution.
module.exports={/* Allowed flush values; see deflate() and inflate() below for details */Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,/* Return codes for the compression/decompression functions. Negative values
			  * are errors, positive values are used for special but normal events.
			  */Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,//Z_MEM_ERROR:     -4,
Z_BUF_ERROR:-5,//Z_VERSION_ERROR: -6,
/* compression levels */Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,/* Possible values of the data_type field (though see inflate()) */Z_BINARY:0,Z_TEXT:1,//Z_ASCII:                1, // = Z_TEXT (deprecated)
Z_UNKNOWN:2,/* The deflate compression method */Z_DEFLATED:8//Z_NULL:                 null // Use -1 or null inline, depending on var type
};},{}],45:[function(require,module,exports){// Note: we can't get significant speed boost here.
// So write code to minimize size - no pregenerated tables
// and array tools dependencies.
// (C) 1995-2013 Jean-loup Gailly and Mark Adler
// (C) 2014-2017 Vitaly Puzrin and Andrey Tupitsin
//
// This software is provided 'as-is', without any express or implied
// warranty. In no event will the authors be held liable for any damages
// arising from the use of this software.
//
// Permission is granted to anyone to use this software for any purpose,
// including commercial applications, and to alter it and redistribute it
// freely, subject to the following restrictions:
//
// 1. The origin of this software must not be misrepresented; you must not
//   claim that you wrote the original software. If you use this software
//   in a product, an acknowledgment in the product documentation would be
//   appreciated but is not required.
// 2. Altered source versions must be plainly marked as such, and must not be
//   misrepresented as being the original software.
// 3. This notice may not be removed or altered from any source distribution.
// Use ordinary array, since untyped makes no boost here
function makeTable(){var c,table=[];for(var n=0;n<256;n++){c=n;for(var k=0;k<8;k++){c=c&1?0xEDB88320^c>>>1:c>>>1;}table[n]=c;}return table;}// Create table on load. Just 255 signed longs. Not a problem.
var crcTable=makeTable();function crc32(crc,buf,len,pos){var t=crcTable,end=pos+len;crc^=-1;for(var i=pos;i<end;i++){crc=crc>>>8^t[(crc^buf[i])&0xFF];}return crc^-1;// >>> 0;
}module.exports=crc32;},{}],46:[function(require,module,exports){// (C) 1995-2013 Jean-loup Gailly and Mark Adler
// (C) 2014-2017 Vitaly Puzrin and Andrey Tupitsin
//
// This software is provided 'as-is', without any express or implied
// warranty. In no event will the authors be held liable for any damages
// arising from the use of this software.
//
// Permission is granted to anyone to use this software for any purpose,
// including commercial applications, and to alter it and redistribute it
// freely, subject to the following restrictions:
//
// 1. The origin of this software must not be misrepresented; you must not
//   claim that you wrote the original software. If you use this software
//   in a product, an acknowledgment in the product documentation would be
//   appreciated but is not required.
// 2. Altered source versions must be plainly marked as such, and must not be
//   misrepresented as being the original software.
// 3. This notice may not be removed or altered from any source distribution.
var utils=require('../utils/common');var trees=require('./trees');var adler32=require('./adler32');var crc32=require('./crc32');var msg=require('./messages');/* Public constants ==========================================================*/ /* ===========================================================================*/ /* Allowed flush values; see deflate() and inflate() below for details */var Z_NO_FLUSH=0;var Z_PARTIAL_FLUSH=1;//var Z_SYNC_FLUSH    = 2;
var Z_FULL_FLUSH=3;var Z_FINISH=4;var Z_BLOCK=5;//var Z_TREES         = 6;
/* Return codes for the compression/decompression functions. Negative values
			 * are errors, positive values are used for special but normal events.
			 */var Z_OK=0;var Z_STREAM_END=1;//var Z_NEED_DICT     = 2;
//var Z_ERRNO         = -1;
var Z_STREAM_ERROR=-2;var Z_DATA_ERROR=-3;//var Z_MEM_ERROR     = -4;
var Z_BUF_ERROR=-5;//var Z_VERSION_ERROR = -6;
/* compression levels */ //var Z_NO_COMPRESSION      = 0;
//var Z_BEST_SPEED          = 1;
//var Z_BEST_COMPRESSION    = 9;
var Z_DEFAULT_COMPRESSION=-1;var Z_FILTERED=1;var Z_HUFFMAN_ONLY=2;var Z_RLE=3;var Z_FIXED=4;var Z_DEFAULT_STRATEGY=0;/* Possible values of the data_type field (though see inflate()) */ //var Z_BINARY              = 0;
//var Z_TEXT                = 1;
//var Z_ASCII               = 1; // = Z_TEXT
var Z_UNKNOWN=2;/* The deflate compression method */var Z_DEFLATED=8;/*============================================================================*/var MAX_MEM_LEVEL=9;/* Maximum value for memLevel in deflateInit2 */var MAX_WBITS=15;/* 32K LZ77 window */var DEF_MEM_LEVEL=8;var LENGTH_CODES=29;/* number of length codes, not counting the special END_BLOCK code */var LITERALS=256;/* number of literal bytes 0..255 */var L_CODES=LITERALS+1+LENGTH_CODES;/* number of Literal or Length codes, including the END_BLOCK code */var D_CODES=30;/* number of distance codes */var BL_CODES=19;/* number of codes used to transfer the bit lengths */var HEAP_SIZE=2*L_CODES+1;/* maximum heap size */var MAX_BITS=15;/* All codes must not exceed MAX_BITS bits */var MIN_MATCH=3;var MAX_MATCH=258;var MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1;var PRESET_DICT=0x20;var INIT_STATE=42;var EXTRA_STATE=69;var NAME_STATE=73;var COMMENT_STATE=91;var HCRC_STATE=103;var BUSY_STATE=113;var FINISH_STATE=666;var BS_NEED_MORE=1;/* block not completed, need more input or more output */var BS_BLOCK_DONE=2;/* block flush performed */var BS_FINISH_STARTED=3;/* finish started, need only more output at next deflate */var BS_FINISH_DONE=4;/* finish done, accept no more input or output */var OS_CODE=0x03;// Unix :) . Don't detect, use this default.
function err(strm,errorCode){strm.msg=msg[errorCode];return errorCode;}function rank(f){return(f<<1)-(f>4?9:0);}function zero(buf){var len=buf.length;while(--len>=0){buf[len]=0;}}/* =========================================================================
			 * Flush as much pending output as possible. All deflate() output goes
			 * through this function so some applications may wish to modify it
			 * to avoid allocating a large strm->output buffer and copying into it.
			 * (See also read_buf()).
			 */function flush_pending(strm){var s=strm.state;//_tr_flush_bits(s);
var len=s.pending;if(len>strm.avail_out){len=strm.avail_out;}if(len===0){return;}utils.arraySet(strm.output,s.pending_buf,s.pending_out,len,strm.next_out);strm.next_out+=len;s.pending_out+=len;strm.total_out+=len;strm.avail_out-=len;s.pending-=len;if(s.pending===0){s.pending_out=0;}}function flush_block_only(s,last){trees._tr_flush_block(s,s.block_start>=0?s.block_start:-1,s.strstart-s.block_start,last);s.block_start=s.strstart;flush_pending(s.strm);}function put_byte(s,b){s.pending_buf[s.pending++]=b;}/* =========================================================================
			 * Put a short in the pending buffer. The 16-bit value is put in MSB order.
			 * IN assertion: the stream state is correct and there is enough room in
			 * pending_buf.
			 */function putShortMSB(s,b){//  put_byte(s, (Byte)(b >> 8));
//  put_byte(s, (Byte)(b & 0xff));
s.pending_buf[s.pending++]=b>>>8&0xff;s.pending_buf[s.pending++]=b&0xff;}/* ===========================================================================
			 * Read a new buffer from the current input stream, update the adler32
			 * and total number of bytes read.  All deflate() input goes through
			 * this function so some applications may wish to modify it to avoid
			 * allocating a large strm->input buffer and copying from it.
			 * (See also flush_pending()).
			 */function read_buf(strm,buf,start,size){var len=strm.avail_in;if(len>size){len=size;}if(len===0){return 0;}strm.avail_in-=len;// zmemcpy(buf, strm->next_in, len);
utils.arraySet(buf,strm.input,strm.next_in,len,start);if(strm.state.wrap===1){strm.adler=adler32(strm.adler,buf,len,start);}else if(strm.state.wrap===2){strm.adler=crc32(strm.adler,buf,len,start);}strm.next_in+=len;strm.total_in+=len;return len;}/* ===========================================================================
			 * Set match_start to the longest match starting at the given string and
			 * return its length. Matches shorter or equal to prev_length are discarded,
			 * in which case the result is equal to prev_length and match_start is
			 * garbage.
			 * IN assertions: cur_match is the head of the hash chain for the current
			 *   string (strstart) and its distance is <= MAX_DIST, and prev_length >= 1
			 * OUT assertion: the match length is not greater than s->lookahead.
			 */function longest_match(s,cur_match){var chain_length=s.max_chain_length;/* max hash chain length */var scan=s.strstart;/* current string */var match;/* matched string */var len;/* length of current match */var best_len=s.prev_length;/* best match length so far */var nice_match=s.nice_match;/* stop if match long enough */var limit=s.strstart>s.w_size-MIN_LOOKAHEAD?s.strstart-(s.w_size-MIN_LOOKAHEAD):0/*NIL*/;var _win=s.window;// shortcut
var wmask=s.w_mask;var prev=s.prev;/* Stop when cur_match becomes <= limit. To simplify the code,
			   * we prevent matches with the string of window index 0.
			   */var strend=s.strstart+MAX_MATCH;var scan_end1=_win[scan+best_len-1];var scan_end=_win[scan+best_len];/* The code is optimized for HASH_BITS >= 8 and MAX_MATCH-2 multiple of 16.
			   * It is easy to get rid of this optimization if necessary.
			   */ // Assert(s->hash_bits >= 8 && MAX_MATCH == 258, "Code too clever");
/* Do not waste too much time if we already have a good match: */if(s.prev_length>=s.good_match){chain_length>>=2;}/* Do not look for matches beyond the end of the input. This is necessary
			   * to make deflate deterministic.
			   */if(nice_match>s.lookahead){nice_match=s.lookahead;}// Assert((ulg)s->strstart <= s->window_size-MIN_LOOKAHEAD, "need lookahead");
do{// Assert(cur_match < s->strstart, "no future");
match=cur_match;/* Skip to next match if the match length cannot increase
			     * or if the match length is less than 2.  Note that the checks below
			     * for insufficient lookahead only occur occasionally for performance
			     * reasons.  Therefore uninitialized memory will be accessed, and
			     * conditional jumps will be made that depend on those values.
			     * However the length of the match is limited to the lookahead, so
			     * the output of deflate is not affected by the uninitialized values.
			     */if(_win[match+best_len]!==scan_end||_win[match+best_len-1]!==scan_end1||_win[match]!==_win[scan]||_win[++match]!==_win[scan+1]){continue;}/* The check at best_len-1 can be removed because it will be made
			     * again later. (This heuristic is not always a win.)
			     * It is not necessary to compare scan[2] and match[2] since they
			     * are always equal when the other bytes match, given that
			     * the hash keys are equal and that HASH_BITS >= 8.
			     */scan+=2;match++;// Assert(*scan == *match, "match[2]?");
/* We check for insufficient lookahead only every 8th comparison;
			     * the 256th check will be made at strstart+258.
			     */do{/*jshint noempty:false*/}while(_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&scan<strend);// Assert(scan <= s->window+(unsigned)(s->window_size-1), "wild scan");
len=MAX_MATCH-(strend-scan);scan=strend-MAX_MATCH;if(len>best_len){s.match_start=cur_match;best_len=len;if(len>=nice_match){break;}scan_end1=_win[scan+best_len-1];scan_end=_win[scan+best_len];}}while((cur_match=prev[cur_match&wmask])>limit&&--chain_length!==0);if(best_len<=s.lookahead){return best_len;}return s.lookahead;}/* ===========================================================================
			 * Fill the window when the lookahead becomes insufficient.
			 * Updates strstart and lookahead.
			 *
			 * IN assertion: lookahead < MIN_LOOKAHEAD
			 * OUT assertions: strstart <= window_size-MIN_LOOKAHEAD
			 *    At least one byte has been read, or avail_in == 0; reads are
			 *    performed for at least two bytes (required for the zip translate_eol
			 *    option -- not supported here).
			 */function fill_window(s){var _w_size=s.w_size;var p,n,m,more,str;//Assert(s->lookahead < MIN_LOOKAHEAD, "already enough lookahead");
do{more=s.window_size-s.lookahead-s.strstart;// JS ints have 32 bit, block below not needed
/* Deal with !@#$% 64K limit: */ //if (sizeof(int) <= 2) {
//    if (more == 0 && s->strstart == 0 && s->lookahead == 0) {
//        more = wsize;
//
//  } else if (more == (unsigned)(-1)) {
//        /* Very unlikely, but possible on 16 bit machine if
//         * strstart == 0 && lookahead == 1 (input done a byte at time)
//         */
//        more--;
//    }
//}
/* If the window is almost full and there is insufficient lookahead,
			     * move the upper half to the lower one to make room in the upper half.
			     */if(s.strstart>=_w_size+(_w_size-MIN_LOOKAHEAD)){utils.arraySet(s.window,s.window,_w_size,_w_size,0);s.match_start-=_w_size;s.strstart-=_w_size;/* we now have strstart >= MAX_DIST */s.block_start-=_w_size;/* Slide the hash table (could be avoided with 32 bit values
			       at the expense of memory usage). We slide even when level == 0
			       to keep the hash table consistent if we switch back to level > 0
			       later. (Using level 0 permanently is not an optimal usage of
			       zlib, so we don't care about this pathological case.)
			       */n=s.hash_size;p=n;do{m=s.head[--p];s.head[p]=m>=_w_size?m-_w_size:0;}while(--n);n=_w_size;p=n;do{m=s.prev[--p];s.prev[p]=m>=_w_size?m-_w_size:0;/* If n is not on any hash chain, prev[n] is garbage but
			         * its value will never be used.
			         */}while(--n);more+=_w_size;}if(s.strm.avail_in===0){break;}/* If there was no sliding:
			     *    strstart <= WSIZE+MAX_DIST-1 && lookahead <= MIN_LOOKAHEAD - 1 &&
			     *    more == window_size - lookahead - strstart
			     * => more >= window_size - (MIN_LOOKAHEAD-1 + WSIZE + MAX_DIST-1)
			     * => more >= window_size - 2*WSIZE + 2
			     * In the BIG_MEM or MMAP case (not yet supported),
			     *   window_size == input_size + MIN_LOOKAHEAD  &&
			     *   strstart + s->lookahead <= input_size => more >= MIN_LOOKAHEAD.
			     * Otherwise, window_size == 2*WSIZE so more >= 2.
			     * If there was sliding, more >= WSIZE. So in all cases, more >= 2.
			     */ //Assert(more >= 2, "more < 2");
n=read_buf(s.strm,s.window,s.strstart+s.lookahead,more);s.lookahead+=n;/* Initialize the hash value now that we have some input: */if(s.lookahead+s.insert>=MIN_MATCH){str=s.strstart-s.insert;s.ins_h=s.window[str];/* UPDATE_HASH(s, s->ins_h, s->window[str + 1]); */s.ins_h=(s.ins_h<<s.hash_shift^s.window[str+1])&s.hash_mask;//#if MIN_MATCH != 3
//        Call update_hash() MIN_MATCH-3 more times
//#endif
while(s.insert){/* UPDATE_HASH(s, s->ins_h, s->window[str + MIN_MATCH-1]); */s.ins_h=(s.ins_h<<s.hash_shift^s.window[str+MIN_MATCH-1])&s.hash_mask;s.prev[str&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=str;str++;s.insert--;if(s.lookahead+s.insert<MIN_MATCH){break;}}}/* If the whole input has less than MIN_MATCH bytes, ins_h is garbage,
			     * but this is not important since only literal bytes will be emitted.
			     */}while(s.lookahead<MIN_LOOKAHEAD&&s.strm.avail_in!==0);/* If the WIN_INIT bytes after the end of the current data have never been
			   * written, then zero those bytes in order to avoid memory check reports of
			   * the use of uninitialized (or uninitialised as Julian writes) bytes by
			   * the longest match routines.  Update the high water mark for the next
			   * time through here.  WIN_INIT is set to MAX_MATCH since the longest match
			   * routines allow scanning to strstart + MAX_MATCH, ignoring lookahead.
			   */ //  if (s.high_water < s.window_size) {
//    var curr = s.strstart + s.lookahead;
//    var init = 0;
//
//    if (s.high_water < curr) {
//      /* Previous high water mark below current data -- zero WIN_INIT
//       * bytes or up to end of window, whichever is less.
//       */
//      init = s.window_size - curr;
//      if (init > WIN_INIT)
//        init = WIN_INIT;
//      zmemzero(s->window + curr, (unsigned)init);
//      s->high_water = curr + init;
//    }
//    else if (s->high_water < (ulg)curr + WIN_INIT) {
//      /* High water mark at or above current data, but below current data
//       * plus WIN_INIT -- zero out to current data plus WIN_INIT, or up
//       * to end of window, whichever is less.
//       */
//      init = (ulg)curr + WIN_INIT - s->high_water;
//      if (init > s->window_size - s->high_water)
//        init = s->window_size - s->high_water;
//      zmemzero(s->window + s->high_water, (unsigned)init);
//      s->high_water += init;
//    }
//  }
//
//  Assert((ulg)s->strstart <= s->window_size - MIN_LOOKAHEAD,
//    "not enough room for search");
}/* ===========================================================================
			 * Copy without compression as much as possible from the input stream, return
			 * the current block state.
			 * This function does not insert new strings in the dictionary since
			 * uncompressible data is probably not useful. This function is used
			 * only for the level=0 compression option.
			 * NOTE: this function should be optimized to avoid extra copying from
			 * window to pending_buf.
			 */function deflate_stored(s,flush){/* Stored blocks are limited to 0xffff bytes, pending_buf is limited
			   * to pending_buf_size, and each stored block has a 5 byte header:
			   */var max_block_size=0xffff;if(max_block_size>s.pending_buf_size-5){max_block_size=s.pending_buf_size-5;}/* Copy as much as possible from input to output: */for(;;){/* Fill the window as much as possible: */if(s.lookahead<=1){//Assert(s->strstart < s->w_size+MAX_DIST(s) ||
//  s->block_start >= (long)s->w_size, "slide too late");
//      if (!(s.strstart < s.w_size + (s.w_size - MIN_LOOKAHEAD) ||
//        s.block_start >= s.w_size)) {
//        throw  new Error("slide too late");
//      }
fill_window(s);if(s.lookahead===0&&flush===Z_NO_FLUSH){return BS_NEED_MORE;}if(s.lookahead===0){break;}/* flush the current block */}//Assert(s->block_start >= 0L, "block gone");
//    if (s.block_start < 0) throw new Error("block gone");
s.strstart+=s.lookahead;s.lookahead=0;/* Emit a stored block if pending_buf will be full: */var max_start=s.block_start+max_block_size;if(s.strstart===0||s.strstart>=max_start){/* strstart == 0 is possible when wraparound on 16-bit machine */s.lookahead=s.strstart-max_start;s.strstart=max_start;/*** FLUSH_BLOCK(s, 0); ***/flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE;}/***/}/* Flush if we may have to slide, otherwise block_start may become
			     * negative and the data will be gone:
			     */if(s.strstart-s.block_start>=s.w_size-MIN_LOOKAHEAD){/*** FLUSH_BLOCK(s, 0); ***/flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE;}/***/}}s.insert=0;if(flush===Z_FINISH){/*** FLUSH_BLOCK(s, 1); ***/flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED;}/***/return BS_FINISH_DONE;}if(s.strstart>s.block_start){/*** FLUSH_BLOCK(s, 0); ***/flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE;}/***/}return BS_NEED_MORE;}/* ===========================================================================
			 * Compress as much as possible from the input stream, return the current
			 * block state.
			 * This function does not perform lazy evaluation of matches and inserts
			 * new strings in the dictionary only for unmatched strings or for short
			 * matches. It is used only for the fast compression options.
			 */function deflate_fast(s,flush){var hash_head;/* head of the hash chain */var bflush;/* set if current block must be flushed */for(;;){/* Make sure that we always have enough lookahead, except
			     * at the end of the input file. We need MAX_MATCH bytes
			     * for the next match, plus MIN_MATCH bytes to insert the
			     * string following the next match.
			     */if(s.lookahead<MIN_LOOKAHEAD){fill_window(s);if(s.lookahead<MIN_LOOKAHEAD&&flush===Z_NO_FLUSH){return BS_NEED_MORE;}if(s.lookahead===0){break;/* flush the current block */}}/* Insert the string window[strstart .. strstart+2] in the
			     * dictionary, and set hash_head to the head of the hash chain:
			     */hash_head=0/*NIL*/;if(s.lookahead>=MIN_MATCH){/*** INSERT_STRING(s, s.strstart, hash_head); ***/s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart;/***/}/* Find the longest match, discarding those <= prev_length.
			     * At this point we have always match_length < MIN_MATCH
			     */if(hash_head!==0/*NIL*/&&s.strstart-hash_head<=s.w_size-MIN_LOOKAHEAD){/* To simplify the code, we prevent matches with the string
			       * of window index 0 (in particular we have to avoid a match
			       * of the string with itself at the start of the input file).
			       */s.match_length=longest_match(s,hash_head);/* longest_match() sets match_start */}if(s.match_length>=MIN_MATCH){// check_match(s, s.strstart, s.match_start, s.match_length); // for debug only
/*** _tr_tally_dist(s, s.strstart - s.match_start,
			                     s.match_length - MIN_MATCH, bflush); ***/bflush=trees._tr_tally(s,s.strstart-s.match_start,s.match_length-MIN_MATCH);s.lookahead-=s.match_length;/* Insert new strings in the hash table only if the match length
			       * is not too large. This saves time but degrades compression.
			       */if(s.match_length<=s.max_lazy_match/*max_insert_length*/&&s.lookahead>=MIN_MATCH){s.match_length--;/* string at strstart already in table */do{s.strstart++;/*** INSERT_STRING(s, s.strstart, hash_head); ***/s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart;/***/ /* strstart never exceeds WSIZE-MAX_MATCH, so there are
			           * always MIN_MATCH bytes ahead.
			           */}while(--s.match_length!==0);s.strstart++;}else{s.strstart+=s.match_length;s.match_length=0;s.ins_h=s.window[s.strstart];/* UPDATE_HASH(s, s.ins_h, s.window[s.strstart+1]); */s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+1])&s.hash_mask;//#if MIN_MATCH != 3
//                Call UPDATE_HASH() MIN_MATCH-3 more times
//#endif
/* If lookahead < MIN_MATCH, ins_h is garbage, but it does not
			         * matter since it will be recomputed at next deflate call.
			         */}}else{/* No match, output a literal byte */ //Tracevv((stderr,"%c", s.window[s.strstart]));
/*** _tr_tally_lit(s, s.window[s.strstart], bflush); ***/bflush=trees._tr_tally(s,0,s.window[s.strstart]);s.lookahead--;s.strstart++;}if(bflush){/*** FLUSH_BLOCK(s, 0); ***/flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE;}/***/}}s.insert=s.strstart<MIN_MATCH-1?s.strstart:MIN_MATCH-1;if(flush===Z_FINISH){/*** FLUSH_BLOCK(s, 1); ***/flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED;}/***/return BS_FINISH_DONE;}if(s.last_lit){/*** FLUSH_BLOCK(s, 0); ***/flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE;}/***/}return BS_BLOCK_DONE;}/* ===========================================================================
			 * Same as above, but achieves better compression. We use a lazy
			 * evaluation for matches: a match is finally adopted only if there is
			 * no better match at the next window position.
			 */function deflate_slow(s,flush){var hash_head;/* head of hash chain */var bflush;/* set if current block must be flushed */var max_insert;/* Process the input block. */for(;;){/* Make sure that we always have enough lookahead, except
			     * at the end of the input file. We need MAX_MATCH bytes
			     * for the next match, plus MIN_MATCH bytes to insert the
			     * string following the next match.
			     */if(s.lookahead<MIN_LOOKAHEAD){fill_window(s);if(s.lookahead<MIN_LOOKAHEAD&&flush===Z_NO_FLUSH){return BS_NEED_MORE;}if(s.lookahead===0){break;}/* flush the current block */}/* Insert the string window[strstart .. strstart+2] in the
			     * dictionary, and set hash_head to the head of the hash chain:
			     */hash_head=0/*NIL*/;if(s.lookahead>=MIN_MATCH){/*** INSERT_STRING(s, s.strstart, hash_head); ***/s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart;/***/}/* Find the longest match, discarding those <= prev_length.
			     */s.prev_length=s.match_length;s.prev_match=s.match_start;s.match_length=MIN_MATCH-1;if(hash_head!==0/*NIL*/&&s.prev_length<s.max_lazy_match&&s.strstart-hash_head<=s.w_size-MIN_LOOKAHEAD/*MAX_DIST(s)*/){/* To simplify the code, we prevent matches with the string
			       * of window index 0 (in particular we have to avoid a match
			       * of the string with itself at the start of the input file).
			       */s.match_length=longest_match(s,hash_head);/* longest_match() sets match_start */if(s.match_length<=5&&(s.strategy===Z_FILTERED||s.match_length===MIN_MATCH&&s.strstart-s.match_start>4096/*TOO_FAR*/)){/* If prev_match is also MIN_MATCH, match_start is garbage
			         * but we will ignore the current match anyway.
			         */s.match_length=MIN_MATCH-1;}}/* If there was a match at the previous step and the current
			     * match is not better, output the previous match:
			     */if(s.prev_length>=MIN_MATCH&&s.match_length<=s.prev_length){max_insert=s.strstart+s.lookahead-MIN_MATCH;/* Do not insert strings in hash table beyond this. */ //check_match(s, s.strstart-1, s.prev_match, s.prev_length);
/***_tr_tally_dist(s, s.strstart - 1 - s.prev_match,
			                     s.prev_length - MIN_MATCH, bflush);***/bflush=trees._tr_tally(s,s.strstart-1-s.prev_match,s.prev_length-MIN_MATCH);/* Insert in hash table all strings up to the end of the match.
			       * strstart-1 and strstart are already inserted. If there is not
			       * enough lookahead, the last two strings are not inserted in
			       * the hash table.
			       */s.lookahead-=s.prev_length-1;s.prev_length-=2;do{if(++s.strstart<=max_insert){/*** INSERT_STRING(s, s.strstart, hash_head); ***/s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart;/***/}}while(--s.prev_length!==0);s.match_available=0;s.match_length=MIN_MATCH-1;s.strstart++;if(bflush){/*** FLUSH_BLOCK(s, 0); ***/flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE;}/***/}}else if(s.match_available){/* If there was no match at the previous position, output a
			       * single literal. If there was a match but the current match
			       * is longer, truncate the previous match to a single literal.
			       */ //Tracevv((stderr,"%c", s->window[s->strstart-1]));
/*** _tr_tally_lit(s, s.window[s.strstart-1], bflush); ***/bflush=trees._tr_tally(s,0,s.window[s.strstart-1]);if(bflush){/*** FLUSH_BLOCK_ONLY(s, 0) ***/flush_block_only(s,false);/***/}s.strstart++;s.lookahead--;if(s.strm.avail_out===0){return BS_NEED_MORE;}}else{/* There is no previous match to compare with, wait for
			       * the next step to decide.
			       */s.match_available=1;s.strstart++;s.lookahead--;}}//Assert (flush != Z_NO_FLUSH, "no flush?");
if(s.match_available){//Tracevv((stderr,"%c", s->window[s->strstart-1]));
/*** _tr_tally_lit(s, s.window[s.strstart-1], bflush); ***/bflush=trees._tr_tally(s,0,s.window[s.strstart-1]);s.match_available=0;}s.insert=s.strstart<MIN_MATCH-1?s.strstart:MIN_MATCH-1;if(flush===Z_FINISH){/*** FLUSH_BLOCK(s, 1); ***/flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED;}/***/return BS_FINISH_DONE;}if(s.last_lit){/*** FLUSH_BLOCK(s, 0); ***/flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE;}/***/}return BS_BLOCK_DONE;}/* ===========================================================================
			 * For Z_RLE, simply look for runs of bytes, generate matches only of distance
			 * one.  Do not maintain a hash table.  (It will be regenerated if this run of
			 * deflate switches away from Z_RLE.)
			 */function deflate_rle(s,flush){var bflush;/* set if current block must be flushed */var prev;/* byte at distance one to match */var scan,strend;/* scan goes up to strend for length of run */var _win=s.window;for(;;){/* Make sure that we always have enough lookahead, except
			     * at the end of the input file. We need MAX_MATCH bytes
			     * for the longest run, plus one for the unrolled loop.
			     */if(s.lookahead<=MAX_MATCH){fill_window(s);if(s.lookahead<=MAX_MATCH&&flush===Z_NO_FLUSH){return BS_NEED_MORE;}if(s.lookahead===0){break;}/* flush the current block */}/* See how many times the previous byte repeats */s.match_length=0;if(s.lookahead>=MIN_MATCH&&s.strstart>0){scan=s.strstart-1;prev=_win[scan];if(prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]){strend=s.strstart+MAX_MATCH;do{/*jshint noempty:false*/}while(prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&scan<strend);s.match_length=MAX_MATCH-(strend-scan);if(s.match_length>s.lookahead){s.match_length=s.lookahead;}}//Assert(scan <= s->window+(uInt)(s->window_size-1), "wild scan");
}/* Emit match if have run of MIN_MATCH or longer, else emit literal */if(s.match_length>=MIN_MATCH){//check_match(s, s.strstart, s.strstart - 1, s.match_length);
/*** _tr_tally_dist(s, 1, s.match_length - MIN_MATCH, bflush); ***/bflush=trees._tr_tally(s,1,s.match_length-MIN_MATCH);s.lookahead-=s.match_length;s.strstart+=s.match_length;s.match_length=0;}else{/* No match, output a literal byte */ //Tracevv((stderr,"%c", s->window[s->strstart]));
/*** _tr_tally_lit(s, s.window[s.strstart], bflush); ***/bflush=trees._tr_tally(s,0,s.window[s.strstart]);s.lookahead--;s.strstart++;}if(bflush){/*** FLUSH_BLOCK(s, 0); ***/flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE;}/***/}}s.insert=0;if(flush===Z_FINISH){/*** FLUSH_BLOCK(s, 1); ***/flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED;}/***/return BS_FINISH_DONE;}if(s.last_lit){/*** FLUSH_BLOCK(s, 0); ***/flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE;}/***/}return BS_BLOCK_DONE;}/* ===========================================================================
			 * For Z_HUFFMAN_ONLY, do not look for matches.  Do not maintain a hash table.
			 * (It will be regenerated if this run of deflate switches away from Huffman.)
			 */function deflate_huff(s,flush){var bflush;/* set if current block must be flushed */for(;;){/* Make sure that we have a literal to write. */if(s.lookahead===0){fill_window(s);if(s.lookahead===0){if(flush===Z_NO_FLUSH){return BS_NEED_MORE;}break;/* flush the current block */}}/* Output a literal byte */s.match_length=0;//Tracevv((stderr,"%c", s->window[s->strstart]));
/*** _tr_tally_lit(s, s.window[s.strstart], bflush); ***/bflush=trees._tr_tally(s,0,s.window[s.strstart]);s.lookahead--;s.strstart++;if(bflush){/*** FLUSH_BLOCK(s, 0); ***/flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE;}/***/}}s.insert=0;if(flush===Z_FINISH){/*** FLUSH_BLOCK(s, 1); ***/flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED;}/***/return BS_FINISH_DONE;}if(s.last_lit){/*** FLUSH_BLOCK(s, 0); ***/flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE;}/***/}return BS_BLOCK_DONE;}/* Values for max_lazy_match, good_match and max_chain_length, depending on
			 * the desired pack level (0..9). The values given below have been tuned to
			 * exclude worst case performance for pathological files. Better values may be
			 * found for specific files.
			 */function Config(good_length,max_lazy,nice_length,max_chain,func){this.good_length=good_length;this.max_lazy=max_lazy;this.nice_length=nice_length;this.max_chain=max_chain;this.func=func;}var configuration_table;configuration_table=[/*      good lazy nice chain */new Config(0,0,0,0,deflate_stored),/* 0 store only */new Config(4,4,8,4,deflate_fast),/* 1 max speed, no lazy matches */new Config(4,5,16,8,deflate_fast),/* 2 */new Config(4,6,32,32,deflate_fast),/* 3 */new Config(4,4,16,16,deflate_slow),/* 4 lazy matches */new Config(8,16,32,32,deflate_slow),/* 5 */new Config(8,16,128,128,deflate_slow),/* 6 */new Config(8,32,128,256,deflate_slow),/* 7 */new Config(32,128,258,1024,deflate_slow),/* 8 */new Config(32,258,258,4096,deflate_slow)/* 9 max compression */];/* ===========================================================================
			 * Initialize the "longest match" routines for a new zlib stream
			 */function lm_init(s){s.window_size=2*s.w_size;/*** CLEAR_HASH(s); ***/zero(s.head);// Fill with NIL (= 0);
/* Set the default configuration parameters:
			   */s.max_lazy_match=configuration_table[s.level].max_lazy;s.good_match=configuration_table[s.level].good_length;s.nice_match=configuration_table[s.level].nice_length;s.max_chain_length=configuration_table[s.level].max_chain;s.strstart=0;s.block_start=0;s.lookahead=0;s.insert=0;s.match_length=s.prev_length=MIN_MATCH-1;s.match_available=0;s.ins_h=0;}function DeflateState(){this.strm=null;/* pointer back to this zlib stream */this.status=0;/* as the name implies */this.pending_buf=null;/* output still pending */this.pending_buf_size=0;/* size of pending_buf */this.pending_out=0;/* next pending byte to output to the stream */this.pending=0;/* nb of bytes in the pending buffer */this.wrap=0;/* bit 0 true for zlib, bit 1 true for gzip */this.gzhead=null;/* gzip header information to write */this.gzindex=0;/* where in extra, name, or comment */this.method=Z_DEFLATED;/* can only be DEFLATED */this.last_flush=-1;/* value of flush param for previous deflate call */this.w_size=0;/* LZ77 window size (32K by default) */this.w_bits=0;/* log2(w_size)  (8..16) */this.w_mask=0;/* w_size - 1 */this.window=null;/* Sliding window. Input bytes are read into the second half of the window,
			   * and move to the first half later to keep a dictionary of at least wSize
			   * bytes. With this organization, matches are limited to a distance of
			   * wSize-MAX_MATCH bytes, but this ensures that IO is always
			   * performed with a length multiple of the block size.
			   */this.window_size=0;/* Actual size of window: 2*wSize, except when the user input buffer
			   * is directly used as sliding window.
			   */this.prev=null;/* Link to older string with same hash index. To limit the size of this
			   * array to 64K, this link is maintained only for the last 32K strings.
			   * An index in this array is thus a window index modulo 32K.
			   */this.head=null;/* Heads of the hash chains or NIL. */this.ins_h=0;/* hash index of string to be inserted */this.hash_size=0;/* number of elements in hash table */this.hash_bits=0;/* log2(hash_size) */this.hash_mask=0;/* hash_size-1 */this.hash_shift=0;/* Number of bits by which ins_h must be shifted at each input
			   * step. It must be such that after MIN_MATCH steps, the oldest
			   * byte no longer takes part in the hash key, that is:
			   *   hash_shift * MIN_MATCH >= hash_bits
			   */this.block_start=0;/* Window position at the beginning of the current output block. Gets
			   * negative when the window is moved backwards.
			   */this.match_length=0;/* length of best match */this.prev_match=0;/* previous match */this.match_available=0;/* set if previous match exists */this.strstart=0;/* start of string to insert */this.match_start=0;/* start of matching string */this.lookahead=0;/* number of valid bytes ahead in window */this.prev_length=0;/* Length of the best match at previous step. Matches not greater than this
			   * are discarded. This is used in the lazy match evaluation.
			   */this.max_chain_length=0;/* To speed up deflation, hash chains are never searched beyond this
			   * length.  A higher limit improves compression ratio but degrades the
			   * speed.
			   */this.max_lazy_match=0;/* Attempt to find a better match only when the current match is strictly
			   * smaller than this value. This mechanism is used only for compression
			   * levels >= 4.
			   */ // That's alias to max_lazy_match, don't use directly
//this.max_insert_length = 0;
/* Insert new strings in the hash table only if the match length is not
			   * greater than this length. This saves time but degrades compression.
			   * max_insert_length is used only for compression levels <= 3.
			   */this.level=0;/* compression level (1..9) */this.strategy=0;/* favor or force Huffman coding*/this.good_match=0;/* Use a faster search when the previous match is longer than this */this.nice_match=0;/* Stop searching when current match exceeds this */ /* used by trees.c: */ /* Didn't use ct_data typedef below to suppress compiler warning */ // struct ct_data_s dyn_ltree[HEAP_SIZE];   /* literal and length tree */
// struct ct_data_s dyn_dtree[2*D_CODES+1]; /* distance tree */
// struct ct_data_s bl_tree[2*BL_CODES+1];  /* Huffman tree for bit lengths */
// Use flat array of DOUBLE size, with interleaved fata,
// because JS does not support effective
this.dyn_ltree=new utils.Buf16(HEAP_SIZE*2);this.dyn_dtree=new utils.Buf16((2*D_CODES+1)*2);this.bl_tree=new utils.Buf16((2*BL_CODES+1)*2);zero(this.dyn_ltree);zero(this.dyn_dtree);zero(this.bl_tree);this.l_desc=null;/* desc. for literal tree */this.d_desc=null;/* desc. for distance tree */this.bl_desc=null;/* desc. for bit length tree */ //ush bl_count[MAX_BITS+1];
this.bl_count=new utils.Buf16(MAX_BITS+1);/* number of codes at each bit length for an optimal tree */ //int heap[2*L_CODES+1];      /* heap used to build the Huffman trees */
this.heap=new utils.Buf16(2*L_CODES+1);/* heap used to build the Huffman trees */zero(this.heap);this.heap_len=0;/* number of elements in the heap */this.heap_max=0;/* element of largest frequency */ /* The sons of heap[n] are heap[2*n] and heap[2*n+1]. heap[0] is not used.
			   * The same heap array is used to build all trees.
			   */this.depth=new utils.Buf16(2*L_CODES+1);//uch depth[2*L_CODES+1];
zero(this.depth);/* Depth of each subtree used as tie breaker for trees of equal frequency
			   */this.l_buf=0;/* buffer index for literals or lengths */this.lit_bufsize=0;/* Size of match buffer for literals/lengths.  There are 4 reasons for
			   * limiting lit_bufsize to 64K:
			   *   - frequencies can be kept in 16 bit counters
			   *   - if compression is not successful for the first block, all input
			   *     data is still in the window so we can still emit a stored block even
			   *     when input comes from standard input.  (This can also be done for
			   *     all blocks if lit_bufsize is not greater than 32K.)
			   *   - if compression is not successful for a file smaller than 64K, we can
			   *     even emit a stored file instead of a stored block (saving 5 bytes).
			   *     This is applicable only for zip (not gzip or zlib).
			   *   - creating new Huffman trees less frequently may not provide fast
			   *     adaptation to changes in the input data statistics. (Take for
			   *     example a binary file with poorly compressible code followed by
			   *     a highly compressible string table.) Smaller buffer sizes give
			   *     fast adaptation but have of course the overhead of transmitting
			   *     trees more frequently.
			   *   - I can't count above 4
			   */this.last_lit=0;/* running index in l_buf */this.d_buf=0;/* Buffer index for distances. To simplify the code, d_buf and l_buf have
			   * the same number of elements. To use different lengths, an extra flag
			   * array would be necessary.
			   */this.opt_len=0;/* bit length of current block with optimal trees */this.static_len=0;/* bit length of current block with static trees */this.matches=0;/* number of string matches in current block */this.insert=0;/* bytes at end of window left to insert */this.bi_buf=0;/* Output buffer. bits are inserted starting at the bottom (least
			   * significant bits).
			   */this.bi_valid=0;/* Number of valid bits in bi_buf.  All bits above the last valid bit
			   * are always zero.
			   */ // Used for window memory init. We safely ignore it for JS. That makes
// sense only for pointers and memory check tools.
//this.high_water = 0;
/* High water mark offset in window for initialized bytes -- bytes above
			   * this are set to zero in order to avoid memory check warnings when
			   * longest match routines access bytes past the input.  This is then
			   * updated to the new high water mark.
			   */}function deflateResetKeep(strm){var s;if(!strm||!strm.state){return err(strm,Z_STREAM_ERROR);}strm.total_in=strm.total_out=0;strm.data_type=Z_UNKNOWN;s=strm.state;s.pending=0;s.pending_out=0;if(s.wrap<0){s.wrap=-s.wrap;/* was made negative by deflate(..., Z_FINISH); */}s.status=s.wrap?INIT_STATE:BUSY_STATE;strm.adler=s.wrap===2?0// crc32(0, Z_NULL, 0)
:1;// adler32(0, Z_NULL, 0)
s.last_flush=Z_NO_FLUSH;trees._tr_init(s);return Z_OK;}function deflateReset(strm){var ret=deflateResetKeep(strm);if(ret===Z_OK){lm_init(strm.state);}return ret;}function deflateSetHeader(strm,head){if(!strm||!strm.state){return Z_STREAM_ERROR;}if(strm.state.wrap!==2){return Z_STREAM_ERROR;}strm.state.gzhead=head;return Z_OK;}function deflateInit2(strm,level,method,windowBits,memLevel,strategy){if(!strm){// === Z_NULL
return Z_STREAM_ERROR;}var wrap=1;if(level===Z_DEFAULT_COMPRESSION){level=6;}if(windowBits<0){/* suppress zlib wrapper */wrap=0;windowBits=-windowBits;}else if(windowBits>15){wrap=2;/* write gzip wrapper instead */windowBits-=16;}if(memLevel<1||memLevel>MAX_MEM_LEVEL||method!==Z_DEFLATED||windowBits<8||windowBits>15||level<0||level>9||strategy<0||strategy>Z_FIXED){return err(strm,Z_STREAM_ERROR);}if(windowBits===8){windowBits=9;}/* until 256-byte window bug fixed */var s=new DeflateState();strm.state=s;s.strm=strm;s.wrap=wrap;s.gzhead=null;s.w_bits=windowBits;s.w_size=1<<s.w_bits;s.w_mask=s.w_size-1;s.hash_bits=memLevel+7;s.hash_size=1<<s.hash_bits;s.hash_mask=s.hash_size-1;s.hash_shift=~~((s.hash_bits+MIN_MATCH-1)/MIN_MATCH);s.window=new utils.Buf8(s.w_size*2);s.head=new utils.Buf16(s.hash_size);s.prev=new utils.Buf16(s.w_size);// Don't need mem init magic for JS.
//s.high_water = 0;  /* nothing written to s->window yet */
s.lit_bufsize=1<<memLevel+6;/* 16K elements by default */s.pending_buf_size=s.lit_bufsize*4;//overlay = (ushf *) ZALLOC(strm, s->lit_bufsize, sizeof(ush)+2);
//s->pending_buf = (uchf *) overlay;
s.pending_buf=new utils.Buf8(s.pending_buf_size);// It is offset from `s.pending_buf` (size is `s.lit_bufsize * 2`)
//s->d_buf = overlay + s->lit_bufsize/sizeof(ush);
s.d_buf=1*s.lit_bufsize;//s->l_buf = s->pending_buf + (1+sizeof(ush))*s->lit_bufsize;
s.l_buf=(1+2)*s.lit_bufsize;s.level=level;s.strategy=strategy;s.method=method;return deflateReset(strm);}function deflateInit(strm,level){return deflateInit2(strm,level,Z_DEFLATED,MAX_WBITS,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY);}function deflate(strm,flush){var old_flush,s;var beg,val;// for gzip header write only
if(!strm||!strm.state||flush>Z_BLOCK||flush<0){return strm?err(strm,Z_STREAM_ERROR):Z_STREAM_ERROR;}s=strm.state;if(!strm.output||!strm.input&&strm.avail_in!==0||s.status===FINISH_STATE&&flush!==Z_FINISH){return err(strm,strm.avail_out===0?Z_BUF_ERROR:Z_STREAM_ERROR);}s.strm=strm;/* just in case */old_flush=s.last_flush;s.last_flush=flush;/* Write the header */if(s.status===INIT_STATE){if(s.wrap===2){// GZIP header
strm.adler=0;//crc32(0L, Z_NULL, 0);
put_byte(s,31);put_byte(s,139);put_byte(s,8);if(!s.gzhead){// s->gzhead == Z_NULL
put_byte(s,0);put_byte(s,0);put_byte(s,0);put_byte(s,0);put_byte(s,0);put_byte(s,s.level===9?2:s.strategy>=Z_HUFFMAN_ONLY||s.level<2?4:0);put_byte(s,OS_CODE);s.status=BUSY_STATE;}else{put_byte(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(!s.gzhead.extra?0:4)+(!s.gzhead.name?0:8)+(!s.gzhead.comment?0:16));put_byte(s,s.gzhead.time&0xff);put_byte(s,s.gzhead.time>>8&0xff);put_byte(s,s.gzhead.time>>16&0xff);put_byte(s,s.gzhead.time>>24&0xff);put_byte(s,s.level===9?2:s.strategy>=Z_HUFFMAN_ONLY||s.level<2?4:0);put_byte(s,s.gzhead.os&0xff);if(s.gzhead.extra&&s.gzhead.extra.length){put_byte(s,s.gzhead.extra.length&0xff);put_byte(s,s.gzhead.extra.length>>8&0xff);}if(s.gzhead.hcrc){strm.adler=crc32(strm.adler,s.pending_buf,s.pending,0);}s.gzindex=0;s.status=EXTRA_STATE;}}else// DEFLATE header
{var header=Z_DEFLATED+(s.w_bits-8<<4)<<8;var level_flags=-1;if(s.strategy>=Z_HUFFMAN_ONLY||s.level<2){level_flags=0;}else if(s.level<6){level_flags=1;}else if(s.level===6){level_flags=2;}else{level_flags=3;}header|=level_flags<<6;if(s.strstart!==0){header|=PRESET_DICT;}header+=31-header%31;s.status=BUSY_STATE;putShortMSB(s,header);/* Save the adler32 of the preset dictionary: */if(s.strstart!==0){putShortMSB(s,strm.adler>>>16);putShortMSB(s,strm.adler&0xffff);}strm.adler=1;// adler32(0L, Z_NULL, 0);
}}//#ifdef GZIP
if(s.status===EXTRA_STATE){if(s.gzhead.extra/* != Z_NULL*/){beg=s.pending;/* start of bytes to update crc */while(s.gzindex<(s.gzhead.extra.length&0xffff)){if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg);}flush_pending(strm);beg=s.pending;if(s.pending===s.pending_buf_size){break;}}put_byte(s,s.gzhead.extra[s.gzindex]&0xff);s.gzindex++;}if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg);}if(s.gzindex===s.gzhead.extra.length){s.gzindex=0;s.status=NAME_STATE;}}else{s.status=NAME_STATE;}}if(s.status===NAME_STATE){if(s.gzhead.name/* != Z_NULL*/){beg=s.pending;/* start of bytes to update crc */ //int val;
do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg);}flush_pending(strm);beg=s.pending;if(s.pending===s.pending_buf_size){val=1;break;}}// JS specific: little magic to add zero terminator to end of string
if(s.gzindex<s.gzhead.name.length){val=s.gzhead.name.charCodeAt(s.gzindex++)&0xff;}else{val=0;}put_byte(s,val);}while(val!==0);if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg);}if(val===0){s.gzindex=0;s.status=COMMENT_STATE;}}else{s.status=COMMENT_STATE;}}if(s.status===COMMENT_STATE){if(s.gzhead.comment/* != Z_NULL*/){beg=s.pending;/* start of bytes to update crc */ //int val;
do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg);}flush_pending(strm);beg=s.pending;if(s.pending===s.pending_buf_size){val=1;break;}}// JS specific: little magic to add zero terminator to end of string
if(s.gzindex<s.gzhead.comment.length){val=s.gzhead.comment.charCodeAt(s.gzindex++)&0xff;}else{val=0;}put_byte(s,val);}while(val!==0);if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg);}if(val===0){s.status=HCRC_STATE;}}else{s.status=HCRC_STATE;}}if(s.status===HCRC_STATE){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size){flush_pending(strm);}if(s.pending+2<=s.pending_buf_size){put_byte(s,strm.adler&0xff);put_byte(s,strm.adler>>8&0xff);strm.adler=0;//crc32(0L, Z_NULL, 0);
s.status=BUSY_STATE;}}else{s.status=BUSY_STATE;}}//#endif
/* Flush as much pending output as possible */if(s.pending!==0){flush_pending(strm);if(strm.avail_out===0){/* Since avail_out is 0, deflate will be called again with
			       * more output space, but possibly with both pending and
			       * avail_in equal to zero. There won't be anything to do,
			       * but this is not an error situation so make sure we
			       * return OK instead of BUF_ERROR at next call of deflate:
			       */s.last_flush=-1;return Z_OK;}/* Make sure there is something to do and avoid duplicate consecutive
			     * flushes. For repeated and useless calls with Z_FINISH, we keep
			     * returning Z_STREAM_END instead of Z_BUF_ERROR.
			     */}else if(strm.avail_in===0&&rank(flush)<=rank(old_flush)&&flush!==Z_FINISH){return err(strm,Z_BUF_ERROR);}/* User must not provide more input after the first FINISH: */if(s.status===FINISH_STATE&&strm.avail_in!==0){return err(strm,Z_BUF_ERROR);}/* Start a new block or continue the current one.
			   */if(strm.avail_in!==0||s.lookahead!==0||flush!==Z_NO_FLUSH&&s.status!==FINISH_STATE){var bstate=s.strategy===Z_HUFFMAN_ONLY?deflate_huff(s,flush):s.strategy===Z_RLE?deflate_rle(s,flush):configuration_table[s.level].func(s,flush);if(bstate===BS_FINISH_STARTED||bstate===BS_FINISH_DONE){s.status=FINISH_STATE;}if(bstate===BS_NEED_MORE||bstate===BS_FINISH_STARTED){if(strm.avail_out===0){s.last_flush=-1;/* avoid BUF_ERROR next call, see above */}return Z_OK;/* If flush != Z_NO_FLUSH && avail_out == 0, the next call
			       * of deflate should use the same flush parameter to make sure
			       * that the flush is complete. So we don't have to output an
			       * empty block here, this will be done at next call. This also
			       * ensures that for a very small output buffer, we emit at most
			       * one empty block.
			       */}if(bstate===BS_BLOCK_DONE){if(flush===Z_PARTIAL_FLUSH){trees._tr_align(s);}else if(flush!==Z_BLOCK){/* FULL_FLUSH or SYNC_FLUSH */trees._tr_stored_block(s,0,0,false);/* For a full flush, this empty block will be recognized
			         * as a special marker by inflate_sync().
			         */if(flush===Z_FULL_FLUSH){/*** CLEAR_HASH(s); ***/ /* forget history */zero(s.head);// Fill with NIL (= 0);
if(s.lookahead===0){s.strstart=0;s.block_start=0;s.insert=0;}}}flush_pending(strm);if(strm.avail_out===0){s.last_flush=-1;/* avoid BUF_ERROR at next call, see above */return Z_OK;}}}//Assert(strm->avail_out > 0, "bug2");
//if (strm.avail_out <= 0) { throw new Error("bug2");}
if(flush!==Z_FINISH){return Z_OK;}if(s.wrap<=0){return Z_STREAM_END;}/* Write the trailer */if(s.wrap===2){put_byte(s,strm.adler&0xff);put_byte(s,strm.adler>>8&0xff);put_byte(s,strm.adler>>16&0xff);put_byte(s,strm.adler>>24&0xff);put_byte(s,strm.total_in&0xff);put_byte(s,strm.total_in>>8&0xff);put_byte(s,strm.total_in>>16&0xff);put_byte(s,strm.total_in>>24&0xff);}else{putShortMSB(s,strm.adler>>>16);putShortMSB(s,strm.adler&0xffff);}flush_pending(strm);/* If avail_out is zero, the application will call deflate again
			   * to flush the rest.
			   */if(s.wrap>0){s.wrap=-s.wrap;}/* write the trailer only once! */return s.pending!==0?Z_OK:Z_STREAM_END;}function deflateEnd(strm){var status;if(!strm/*== Z_NULL*/||!strm.state/*== Z_NULL*/){return Z_STREAM_ERROR;}status=strm.state.status;if(status!==INIT_STATE&&status!==EXTRA_STATE&&status!==NAME_STATE&&status!==COMMENT_STATE&&status!==HCRC_STATE&&status!==BUSY_STATE&&status!==FINISH_STATE){return err(strm,Z_STREAM_ERROR);}strm.state=null;return status===BUSY_STATE?err(strm,Z_DATA_ERROR):Z_OK;}/* =========================================================================
			 * Initializes the compression dictionary from the given byte
			 * sequence without producing any compressed output.
			 */function deflateSetDictionary(strm,dictionary){var dictLength=dictionary.length;var s;var str,n;var wrap;var avail;var next;var input;var tmpDict;if(!strm/*== Z_NULL*/||!strm.state/*== Z_NULL*/){return Z_STREAM_ERROR;}s=strm.state;wrap=s.wrap;if(wrap===2||wrap===1&&s.status!==INIT_STATE||s.lookahead){return Z_STREAM_ERROR;}/* when using zlib wrappers, compute Adler-32 for provided dictionary */if(wrap===1){/* adler32(strm->adler, dictionary, dictLength); */strm.adler=adler32(strm.adler,dictionary,dictLength,0);}s.wrap=0;/* avoid computing Adler-32 in read_buf */ /* if dictionary would fill window, just replace the history */if(dictLength>=s.w_size){if(wrap===0){/* already empty otherwise */ /*** CLEAR_HASH(s); ***/zero(s.head);// Fill with NIL (= 0);
s.strstart=0;s.block_start=0;s.insert=0;}/* use the tail */ // dictionary = dictionary.slice(dictLength - s.w_size);
tmpDict=new utils.Buf8(s.w_size);utils.arraySet(tmpDict,dictionary,dictLength-s.w_size,s.w_size,0);dictionary=tmpDict;dictLength=s.w_size;}/* insert dictionary into window and hash */avail=strm.avail_in;next=strm.next_in;input=strm.input;strm.avail_in=dictLength;strm.next_in=0;strm.input=dictionary;fill_window(s);while(s.lookahead>=MIN_MATCH){str=s.strstart;n=s.lookahead-(MIN_MATCH-1);do{/* UPDATE_HASH(s, s->ins_h, s->window[str + MIN_MATCH-1]); */s.ins_h=(s.ins_h<<s.hash_shift^s.window[str+MIN_MATCH-1])&s.hash_mask;s.prev[str&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=str;str++;}while(--n);s.strstart=str;s.lookahead=MIN_MATCH-1;fill_window(s);}s.strstart+=s.lookahead;s.block_start=s.strstart;s.insert=s.lookahead;s.lookahead=0;s.match_length=s.prev_length=MIN_MATCH-1;s.match_available=0;strm.next_in=next;strm.input=input;strm.avail_in=avail;s.wrap=wrap;return Z_OK;}exports.deflateInit=deflateInit;exports.deflateInit2=deflateInit2;exports.deflateReset=deflateReset;exports.deflateResetKeep=deflateResetKeep;exports.deflateSetHeader=deflateSetHeader;exports.deflate=deflate;exports.deflateEnd=deflateEnd;exports.deflateSetDictionary=deflateSetDictionary;exports.deflateInfo='pako deflate (from Nodeca project)';/* Not implemented
			exports.deflateBound = deflateBound;
			exports.deflateCopy = deflateCopy;
			exports.deflateParams = deflateParams;
			exports.deflatePending = deflatePending;
			exports.deflatePrime = deflatePrime;
			exports.deflateTune = deflateTune;
			*/},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(require,module,exports){// (C) 1995-2013 Jean-loup Gailly and Mark Adler
// (C) 2014-2017 Vitaly Puzrin and Andrey Tupitsin
//
// This software is provided 'as-is', without any express or implied
// warranty. In no event will the authors be held liable for any damages
// arising from the use of this software.
//
// Permission is granted to anyone to use this software for any purpose,
// including commercial applications, and to alter it and redistribute it
// freely, subject to the following restrictions:
//
// 1. The origin of this software must not be misrepresented; you must not
//   claim that you wrote the original software. If you use this software
//   in a product, an acknowledgment in the product documentation would be
//   appreciated but is not required.
// 2. Altered source versions must be plainly marked as such, and must not be
//   misrepresented as being the original software.
// 3. This notice may not be removed or altered from any source distribution.
function GZheader(){/* true if compressed data believed to be text */this.text=0;/* modification time */this.time=0;/* extra flags (not used when writing a gzip file) */this.xflags=0;/* operating system */this.os=0;/* pointer to extra field or Z_NULL if none */this.extra=null;/* extra field length (valid if extra != Z_NULL) */this.extra_len=0;// Actually, we don't need it in JS,
// but leave for few code modifications
//
// Setup limits is not necessary because in js we should not preallocate memory
// for inflate use constant limit in 65536 bytes
//
/* space at extra (only when reading header) */ // this.extra_max  = 0;
/* pointer to zero-terminated file name or Z_NULL */this.name='';/* space at name (only when reading header) */ // this.name_max   = 0;
/* pointer to zero-terminated comment or Z_NULL */this.comment='';/* space at comment (only when reading header) */ // this.comm_max   = 0;
/* true if there was or will be a header crc */this.hcrc=0;/* true when done reading gzip header (not used when writing a gzip file) */this.done=false;}module.exports=GZheader;},{}],48:[function(require,module,exports){// (C) 1995-2013 Jean-loup Gailly and Mark Adler
// (C) 2014-2017 Vitaly Puzrin and Andrey Tupitsin
//
// This software is provided 'as-is', without any express or implied
// warranty. In no event will the authors be held liable for any damages
// arising from the use of this software.
//
// Permission is granted to anyone to use this software for any purpose,
// including commercial applications, and to alter it and redistribute it
// freely, subject to the following restrictions:
//
// 1. The origin of this software must not be misrepresented; you must not
//   claim that you wrote the original software. If you use this software
//   in a product, an acknowledgment in the product documentation would be
//   appreciated but is not required.
// 2. Altered source versions must be plainly marked as such, and must not be
//   misrepresented as being the original software.
// 3. This notice may not be removed or altered from any source distribution.
// See state defs from inflate.js
var BAD=30;/* got a data error -- remain here until reset */var TYPE=12;/* i: waiting for type bits, including last-flag bit */ /*
			   Decode literal, length, and distance codes and write out the resulting
			   literal and match bytes until either not enough input or output is
			   available, an end-of-block is encountered, or a data error is encountered.
			   When large enough input and output buffers are supplied to inflate(), for
			   example, a 16K input buffer and a 64K output buffer, more than 95% of the
			   inflate execution time is spent in this routine.

			   Entry assumptions:

			        state.mode === LEN
			        strm.avail_in >= 6
			        strm.avail_out >= 258
			        start >= strm.avail_out
			        state.bits < 8

			   On return, state.mode is one of:

			        LEN -- ran out of enough output space or enough available input
			        TYPE -- reached end of block code, inflate() to interpret next block
			        BAD -- error in block data

			   Notes:

			    - The maximum input bits used by a length/distance pair is 15 bits for the
			      length code, 5 bits for the length extra, 15 bits for the distance code,
			      and 13 bits for the distance extra.  This totals 48 bits, or six bytes.
			      Therefore if strm.avail_in >= 6, then there is enough input to avoid
			      checking for available input while decoding.

			    - The maximum bytes that a single length/distance pair can output is 258
			      bytes, which is the maximum length that can be coded.  inflate_fast()
			      requires strm.avail_out >= 258 for each loop to avoid checking for
			      output space.
			 */module.exports=function inflate_fast(strm,start){var state;var _in;/* local strm.input */var last;/* have enough input while in < last */var _out;/* local strm.output */var beg;/* inflate()'s initial strm.output */var end;/* while out < end, enough space available */ //#ifdef INFLATE_STRICT
var dmax;/* maximum distance from zlib header */ //#endif
var wsize;/* window size or zero if not using window */var whave;/* valid bytes in the window */var wnext;/* window write index */ // Use `s_window` instead `window`, avoid conflict with instrumentation tools
var s_window;/* allocated sliding window, if wsize != 0 */var hold;/* local strm.hold */var bits;/* local strm.bits */var lcode;/* local strm.lencode */var dcode;/* local strm.distcode */var lmask;/* mask for first level of length codes */var dmask;/* mask for first level of distance codes */var here;/* retrieved table entry */var op;/* code bits, operation, extra bits, or */ /*  window position, window bytes to copy */var len;/* match length, unused bytes */var dist;/* match distance */var from;/* where to copy match from */var from_source;var input,output;// JS specific, because we have no pointers
/* copy state to local variables */state=strm.state;//here = state.here;
_in=strm.next_in;input=strm.input;last=_in+(strm.avail_in-5);_out=strm.next_out;output=strm.output;beg=_out-(start-strm.avail_out);end=_out+(strm.avail_out-257);//#ifdef INFLATE_STRICT
dmax=state.dmax;//#endif
wsize=state.wsize;whave=state.whave;wnext=state.wnext;s_window=state.window;hold=state.hold;bits=state.bits;lcode=state.lencode;dcode=state.distcode;lmask=(1<<state.lenbits)-1;dmask=(1<<state.distbits)-1;/* decode literals and length/distances until end-of-block or not enough
			     input data or output space */top:do{if(bits<15){hold+=input[_in++]<<bits;bits+=8;hold+=input[_in++]<<bits;bits+=8;}here=lcode[hold&lmask];dolen:for(;;){// Goto emulation
op=here>>>24/*here.bits*/;hold>>>=op;bits-=op;op=here>>>16&0xff/*here.op*/;if(op===0){/* literal */ //Tracevv((stderr, here.val >= 0x20 && here.val < 0x7f ?
//        "inflate:         literal '%c'\n" :
//        "inflate:         literal 0x%02x\n", here.val));
output[_out++]=here&0xffff/*here.val*/;}else if(op&16){/* length base */len=here&0xffff/*here.val*/;op&=15;/* number of extra bits */if(op){if(bits<op){hold+=input[_in++]<<bits;bits+=8;}len+=hold&(1<<op)-1;hold>>>=op;bits-=op;}//Tracevv((stderr, "inflate:         length %u\n", len));
if(bits<15){hold+=input[_in++]<<bits;bits+=8;hold+=input[_in++]<<bits;bits+=8;}here=dcode[hold&dmask];dodist:for(;;){// goto emulation
op=here>>>24/*here.bits*/;hold>>>=op;bits-=op;op=here>>>16&0xff/*here.op*/;if(op&16){/* distance base */dist=here&0xffff/*here.val*/;op&=15;/* number of extra bits */if(bits<op){hold+=input[_in++]<<bits;bits+=8;if(bits<op){hold+=input[_in++]<<bits;bits+=8;}}dist+=hold&(1<<op)-1;//#ifdef INFLATE_STRICT
if(dist>dmax){strm.msg='invalid distance too far back';state.mode=BAD;break top;}//#endif
hold>>>=op;bits-=op;//Tracevv((stderr, "inflate:         distance %u\n", dist));
op=_out-beg;/* max distance in output */if(dist>op){/* see if copy from window */op=dist-op;/* distance back in window */if(op>whave){if(state.sane){strm.msg='invalid distance too far back';state.mode=BAD;break top;}// (!) This block is disabled in zlib defailts,
// don't enable it for binary compatibility
//#ifdef INFLATE_ALLOW_INVALID_DISTANCE_TOOFAR_ARRR
//                if (len <= op - whave) {
//                  do {
//                    output[_out++] = 0;
//                  } while (--len);
//                  continue top;
//                }
//                len -= op - whave;
//                do {
//                  output[_out++] = 0;
//                } while (--op > whave);
//                if (op === 0) {
//                  from = _out - dist;
//                  do {
//                    output[_out++] = output[from++];
//                  } while (--len);
//                  continue top;
//                }
//#endif
}from=0;// window index
from_source=s_window;if(wnext===0){/* very common case */from+=wsize-op;if(op<len){/* some from window */len-=op;do{output[_out++]=s_window[from++];}while(--op);from=_out-dist;/* rest from output */from_source=output;}}else if(wnext<op){/* wrap around window */from+=wsize+wnext-op;op-=wnext;if(op<len){/* some from end of window */len-=op;do{output[_out++]=s_window[from++];}while(--op);from=0;if(wnext<len){/* some from start of window */op=wnext;len-=op;do{output[_out++]=s_window[from++];}while(--op);from=_out-dist;/* rest from output */from_source=output;}}}else{/* contiguous in window */from+=wnext-op;if(op<len){/* some from window */len-=op;do{output[_out++]=s_window[from++];}while(--op);from=_out-dist;/* rest from output */from_source=output;}}while(len>2){output[_out++]=from_source[from++];output[_out++]=from_source[from++];output[_out++]=from_source[from++];len-=3;}if(len){output[_out++]=from_source[from++];if(len>1){output[_out++]=from_source[from++];}}}else{from=_out-dist;/* copy direct from output */do{/* minimum length is three */output[_out++]=output[from++];output[_out++]=output[from++];output[_out++]=output[from++];len-=3;}while(len>2);if(len){output[_out++]=output[from++];if(len>1){output[_out++]=output[from++];}}}}else if((op&64)===0){/* 2nd level distance code */here=dcode[(here&0xffff/*here.val*/)+(hold&(1<<op)-1)];continue dodist;}else{strm.msg='invalid distance code';state.mode=BAD;break top;}break;// need to emulate goto via "continue"
}}else if((op&64)===0){/* 2nd level length code */here=lcode[(here&0xffff/*here.val*/)+(hold&(1<<op)-1)];continue dolen;}else if(op&32){/* end-of-block */ //Tracevv((stderr, "inflate:         end of block\n"));
state.mode=TYPE;break top;}else{strm.msg='invalid literal/length code';state.mode=BAD;break top;}break;// need to emulate goto via "continue"
}}while(_in<last&&_out<end);/* return unused bytes (on entry, bits < 8, so in won't go too far back) */len=bits>>3;_in-=len;bits-=len<<3;hold&=(1<<bits)-1;/* update state and return */strm.next_in=_in;strm.next_out=_out;strm.avail_in=_in<last?5+(last-_in):5-(_in-last);strm.avail_out=_out<end?257+(end-_out):257-(_out-end);state.hold=hold;state.bits=bits;return;};},{}],49:[function(require,module,exports){// (C) 1995-2013 Jean-loup Gailly and Mark Adler
// (C) 2014-2017 Vitaly Puzrin and Andrey Tupitsin
//
// This software is provided 'as-is', without any express or implied
// warranty. In no event will the authors be held liable for any damages
// arising from the use of this software.
//
// Permission is granted to anyone to use this software for any purpose,
// including commercial applications, and to alter it and redistribute it
// freely, subject to the following restrictions:
//
// 1. The origin of this software must not be misrepresented; you must not
//   claim that you wrote the original software. If you use this software
//   in a product, an acknowledgment in the product documentation would be
//   appreciated but is not required.
// 2. Altered source versions must be plainly marked as such, and must not be
//   misrepresented as being the original software.
// 3. This notice may not be removed or altered from any source distribution.
var utils=require('../utils/common');var adler32=require('./adler32');var crc32=require('./crc32');var inflate_fast=require('./inffast');var inflate_table=require('./inftrees');var CODES=0;var LENS=1;var DISTS=2;/* Public constants ==========================================================*/ /* ===========================================================================*/ /* Allowed flush values; see deflate() and inflate() below for details */ //var Z_NO_FLUSH      = 0;
//var Z_PARTIAL_FLUSH = 1;
//var Z_SYNC_FLUSH    = 2;
//var Z_FULL_FLUSH    = 3;
var Z_FINISH=4;var Z_BLOCK=5;var Z_TREES=6;/* Return codes for the compression/decompression functions. Negative values
			 * are errors, positive values are used for special but normal events.
			 */var Z_OK=0;var Z_STREAM_END=1;var Z_NEED_DICT=2;//var Z_ERRNO         = -1;
var Z_STREAM_ERROR=-2;var Z_DATA_ERROR=-3;var Z_MEM_ERROR=-4;var Z_BUF_ERROR=-5;//var Z_VERSION_ERROR = -6;
/* The deflate compression method */var Z_DEFLATED=8;/* STATES ====================================================================*/ /* ===========================================================================*/var HEAD=1;/* i: waiting for magic header */var FLAGS=2;/* i: waiting for method and flags (gzip) */var TIME=3;/* i: waiting for modification time (gzip) */var OS=4;/* i: waiting for extra flags and operating system (gzip) */var EXLEN=5;/* i: waiting for extra length (gzip) */var EXTRA=6;/* i: waiting for extra bytes (gzip) */var NAME=7;/* i: waiting for end of file name (gzip) */var COMMENT=8;/* i: waiting for end of comment (gzip) */var HCRC=9;/* i: waiting for header crc (gzip) */var DICTID=10;/* i: waiting for dictionary check value */var DICT=11;/* waiting for inflateSetDictionary() call */var TYPE=12;/* i: waiting for type bits, including last-flag bit */var TYPEDO=13;/* i: same, but skip check to exit inflate on new block */var STORED=14;/* i: waiting for stored size (length and complement) */var COPY_=15;/* i/o: same as COPY below, but only first time in */var COPY=16;/* i/o: waiting for input or output to copy stored block */var TABLE=17;/* i: waiting for dynamic block table lengths */var LENLENS=18;/* i: waiting for code length code lengths */var CODELENS=19;/* i: waiting for length/lit and distance code lengths */var LEN_=20;/* i: same as LEN below, but only first time in */var LEN=21;/* i: waiting for length/lit/eob code */var LENEXT=22;/* i: waiting for length extra bits */var DIST=23;/* i: waiting for distance code */var DISTEXT=24;/* i: waiting for distance extra bits */var MATCH=25;/* o: waiting for output space to copy string */var LIT=26;/* o: waiting for output space to write literal */var CHECK=27;/* i: waiting for 32-bit check value */var LENGTH=28;/* i: waiting for 32-bit length (gzip) */var DONE=29;/* finished check, done -- remain here until reset */var BAD=30;/* got a data error -- remain here until reset */var MEM=31;/* got an inflate() memory error -- remain here until reset */var SYNC=32;/* looking for synchronization bytes to restart inflate() */ /* ===========================================================================*/var ENOUGH_LENS=852;var ENOUGH_DISTS=592;//var ENOUGH =  (ENOUGH_LENS+ENOUGH_DISTS);
var MAX_WBITS=15;/* 32K LZ77 window */var DEF_WBITS=MAX_WBITS;function zswap32(q){return(q>>>24&0xff)+(q>>>8&0xff00)+((q&0xff00)<<8)+((q&0xff)<<24);}function InflateState(){this.mode=0;/* current inflate mode */this.last=false;/* true if processing last block */this.wrap=0;/* bit 0 true for zlib, bit 1 true for gzip */this.havedict=false;/* true if dictionary provided */this.flags=0;/* gzip header method and flags (0 if zlib) */this.dmax=0;/* zlib header max distance (INFLATE_STRICT) */this.check=0;/* protected copy of check value */this.total=0;/* protected copy of output count */ // TODO: may be {}
this.head=null;/* where to save gzip header information */ /* sliding window */this.wbits=0;/* log base 2 of requested window size */this.wsize=0;/* window size or zero if not using window */this.whave=0;/* valid bytes in the window */this.wnext=0;/* window write index */this.window=null;/* allocated sliding window, if needed */ /* bit accumulator */this.hold=0;/* input bit accumulator */this.bits=0;/* number of bits in "in" */ /* for string and stored block copying */this.length=0;/* literal or length of data to copy */this.offset=0;/* distance back to copy string from */ /* for table and code decoding */this.extra=0;/* extra bits needed */ /* fixed and dynamic code tables */this.lencode=null;/* starting table for length/literal codes */this.distcode=null;/* starting table for distance codes */this.lenbits=0;/* index bits for lencode */this.distbits=0;/* index bits for distcode */ /* dynamic table building */this.ncode=0;/* number of code length code lengths */this.nlen=0;/* number of length code lengths */this.ndist=0;/* number of distance code lengths */this.have=0;/* number of code lengths in lens[] */this.next=null;/* next available space in codes[] */this.lens=new utils.Buf16(320);/* temporary storage for code lengths */this.work=new utils.Buf16(288);/* work area for code table building */ /*
			   because we don't have pointers in js, we use lencode and distcode directly
			   as buffers so we don't need codes
			  */ //this.codes = new utils.Buf32(ENOUGH);       /* space for code tables */
this.lendyn=null;/* dynamic table for length/literal codes (JS specific) */this.distdyn=null;/* dynamic table for distance codes (JS specific) */this.sane=0;/* if false, allow invalid distance too far */this.back=0;/* bits back of last unprocessed length/lit */this.was=0;/* initial length of match */}function inflateResetKeep(strm){var state;if(!strm||!strm.state){return Z_STREAM_ERROR;}state=strm.state;strm.total_in=strm.total_out=state.total=0;strm.msg='';/*Z_NULL*/if(state.wrap){/* to support ill-conceived Java test suite */strm.adler=state.wrap&1;}state.mode=HEAD;state.last=0;state.havedict=0;state.dmax=32768;state.head=null/*Z_NULL*/;state.hold=0;state.bits=0;//state.lencode = state.distcode = state.next = state.codes;
state.lencode=state.lendyn=new utils.Buf32(ENOUGH_LENS);state.distcode=state.distdyn=new utils.Buf32(ENOUGH_DISTS);state.sane=1;state.back=-1;//Tracev((stderr, "inflate: reset\n"));
return Z_OK;}function inflateReset(strm){var state;if(!strm||!strm.state){return Z_STREAM_ERROR;}state=strm.state;state.wsize=0;state.whave=0;state.wnext=0;return inflateResetKeep(strm);}function inflateReset2(strm,windowBits){var wrap;var state;/* get the state */if(!strm||!strm.state){return Z_STREAM_ERROR;}state=strm.state;/* extract wrap request from windowBits parameter */if(windowBits<0){wrap=0;windowBits=-windowBits;}else{wrap=(windowBits>>4)+1;if(windowBits<48){windowBits&=15;}}/* set number of window bits, free window if different */if(windowBits&&(windowBits<8||windowBits>15)){return Z_STREAM_ERROR;}if(state.window!==null&&state.wbits!==windowBits){state.window=null;}/* update state and reset the rest of it */state.wrap=wrap;state.wbits=windowBits;return inflateReset(strm);}function inflateInit2(strm,windowBits){var ret;var state;if(!strm){return Z_STREAM_ERROR;}//strm.msg = Z_NULL;                 /* in case we return an error */
state=new InflateState();//if (state === Z_NULL) return Z_MEM_ERROR;
//Tracev((stderr, "inflate: allocated\n"));
strm.state=state;state.window=null/*Z_NULL*/;ret=inflateReset2(strm,windowBits);if(ret!==Z_OK){strm.state=null/*Z_NULL*/;}return ret;}function inflateInit(strm){return inflateInit2(strm,DEF_WBITS);}/*
			 Return state with length and distance decoding tables and index sizes set to
			 fixed code decoding.  Normally this returns fixed tables from inffixed.h.
			 If BUILDFIXED is defined, then instead this routine builds the tables the
			 first time it's called, and returns those tables the first time and
			 thereafter.  This reduces the size of the code by about 2K bytes, in
			 exchange for a little execution time.  However, BUILDFIXED should not be
			 used for threaded applications, since the rewriting of the tables and virgin
			 may not be thread-safe.
			 */var virgin=true;var lenfix,distfix;// We have no pointers in JS, so keep tables separate
function fixedtables(state){/* build fixed huffman tables if first call (may not be thread safe) */if(virgin){var sym;lenfix=new utils.Buf32(512);distfix=new utils.Buf32(32);/* literal/length table */sym=0;while(sym<144){state.lens[sym++]=8;}while(sym<256){state.lens[sym++]=9;}while(sym<280){state.lens[sym++]=7;}while(sym<288){state.lens[sym++]=8;}inflate_table(LENS,state.lens,0,288,lenfix,0,state.work,{bits:9});/* distance table */sym=0;while(sym<32){state.lens[sym++]=5;}inflate_table(DISTS,state.lens,0,32,distfix,0,state.work,{bits:5});/* do this just once */virgin=false;}state.lencode=lenfix;state.lenbits=9;state.distcode=distfix;state.distbits=5;}/*
			 Update the window with the last wsize (normally 32K) bytes written before
			 returning.  If window does not exist yet, create it.  This is only called
			 when a window is already in use, or when output has been written during this
			 inflate call, but the end of the deflate stream has not been reached yet.
			 It is also called to create a window for dictionary data when a dictionary
			 is loaded.

			 Providing output buffers larger than 32K to inflate() should provide a speed
			 advantage, since only the last 32K of output is copied to the sliding window
			 upon return from inflate(), and since all distances after the first 32K of
			 output will fall in the output data, making match copies simpler and faster.
			 The advantage may be dependent on the size of the processor's data caches.
			 */function updatewindow(strm,src,end,copy){var dist;var state=strm.state;/* if it hasn't been done already, allocate space for the window */if(state.window===null){state.wsize=1<<state.wbits;state.wnext=0;state.whave=0;state.window=new utils.Buf8(state.wsize);}/* copy state->wsize or less output bytes into the circular window */if(copy>=state.wsize){utils.arraySet(state.window,src,end-state.wsize,state.wsize,0);state.wnext=0;state.whave=state.wsize;}else{dist=state.wsize-state.wnext;if(dist>copy){dist=copy;}//zmemcpy(state->window + state->wnext, end - copy, dist);
utils.arraySet(state.window,src,end-copy,dist,state.wnext);copy-=dist;if(copy){//zmemcpy(state->window, end - copy, copy);
utils.arraySet(state.window,src,end-copy,copy,0);state.wnext=copy;state.whave=state.wsize;}else{state.wnext+=dist;if(state.wnext===state.wsize){state.wnext=0;}if(state.whave<state.wsize){state.whave+=dist;}}}return 0;}function inflate(strm,flush){var state;var input,output;// input/output buffers
var next;/* next input INDEX */var put;/* next output INDEX */var have,left;/* available input and output */var hold;/* bit buffer */var bits;/* bits in bit buffer */var _in,_out;/* save starting available input and output */var copy;/* number of stored or match bytes to copy */var from;/* where to copy match bytes from */var from_source;var here=0;/* current decoding table entry */var here_bits,here_op,here_val;// paked "here" denormalized (JS specific)
//var last;                   /* parent table entry */
var last_bits,last_op,last_val;// paked "last" denormalized (JS specific)
var len;/* length to copy for repeats, bits to drop */var ret;/* return code */var hbuf=new utils.Buf8(4);/* buffer for gzip header crc calculation */var opts;var n;// temporary var for NEED_BITS
var order=/* permutation of code lengths */[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!strm||!strm.state||!strm.output||!strm.input&&strm.avail_in!==0){return Z_STREAM_ERROR;}state=strm.state;if(state.mode===TYPE){state.mode=TYPEDO;}/* skip check */ //--- LOAD() ---
put=strm.next_out;output=strm.output;left=strm.avail_out;next=strm.next_in;input=strm.input;have=strm.avail_in;hold=state.hold;bits=state.bits;//---
_in=have;_out=left;ret=Z_OK;inf_leave:// goto emulation
for(;;){switch(state.mode){case HEAD:if(state.wrap===0){state.mode=TYPEDO;break;}//=== NEEDBITS(16);
while(bits<16){if(have===0){break inf_leave;}have--;hold+=input[next++]<<bits;bits+=8;}//===//
if(state.wrap&2&&hold===0x8b1f){/* gzip header */state.check=0/*crc32(0L, Z_NULL, 0)*/;//=== CRC2(state.check, hold);
hbuf[0]=hold&0xff;hbuf[1]=hold>>>8&0xff;state.check=crc32(state.check,hbuf,2,0);//===//
//=== INITBITS();
hold=0;bits=0;//===//
state.mode=FLAGS;break;}state.flags=0;/* expect zlib header */if(state.head){state.head.done=false;}if(!(state.wrap&1)||/* check if zlib header allowed */(((hold&0xff/*BITS(8)*/)<<8)+(hold>>8))%31){strm.msg='incorrect header check';state.mode=BAD;break;}if((hold&0x0f/*BITS(4)*/)!==Z_DEFLATED){strm.msg='unknown compression method';state.mode=BAD;break;}//--- DROPBITS(4) ---//
hold>>>=4;bits-=4;//---//
len=(hold&0x0f/*BITS(4)*/)+8;if(state.wbits===0){state.wbits=len;}else if(len>state.wbits){strm.msg='invalid window size';state.mode=BAD;break;}state.dmax=1<<len;//Tracev((stderr, "inflate:   zlib header ok\n"));
strm.adler=state.check=1/*adler32(0L, Z_NULL, 0)*/;state.mode=hold&0x200?DICTID:TYPE;//=== INITBITS();
hold=0;bits=0;//===//
break;case FLAGS://=== NEEDBITS(16); */
while(bits<16){if(have===0){break inf_leave;}have--;hold+=input[next++]<<bits;bits+=8;}//===//
state.flags=hold;if((state.flags&0xff)!==Z_DEFLATED){strm.msg='unknown compression method';state.mode=BAD;break;}if(state.flags&0xe000){strm.msg='unknown header flags set';state.mode=BAD;break;}if(state.head){state.head.text=hold>>8&1;}if(state.flags&0x0200){//=== CRC2(state.check, hold);
hbuf[0]=hold&0xff;hbuf[1]=hold>>>8&0xff;state.check=crc32(state.check,hbuf,2,0);//===//
}//=== INITBITS();
hold=0;bits=0;//===//
state.mode=TIME;/* falls through */case TIME://=== NEEDBITS(32); */
while(bits<32){if(have===0){break inf_leave;}have--;hold+=input[next++]<<bits;bits+=8;}//===//
if(state.head){state.head.time=hold;}if(state.flags&0x0200){//=== CRC4(state.check, hold)
hbuf[0]=hold&0xff;hbuf[1]=hold>>>8&0xff;hbuf[2]=hold>>>16&0xff;hbuf[3]=hold>>>24&0xff;state.check=crc32(state.check,hbuf,4,0);//===
}//=== INITBITS();
hold=0;bits=0;//===//
state.mode=OS;/* falls through */case OS://=== NEEDBITS(16); */
while(bits<16){if(have===0){break inf_leave;}have--;hold+=input[next++]<<bits;bits+=8;}//===//
if(state.head){state.head.xflags=hold&0xff;state.head.os=hold>>8;}if(state.flags&0x0200){//=== CRC2(state.check, hold);
hbuf[0]=hold&0xff;hbuf[1]=hold>>>8&0xff;state.check=crc32(state.check,hbuf,2,0);//===//
}//=== INITBITS();
hold=0;bits=0;//===//
state.mode=EXLEN;/* falls through */case EXLEN:if(state.flags&0x0400){//=== NEEDBITS(16); */
while(bits<16){if(have===0){break inf_leave;}have--;hold+=input[next++]<<bits;bits+=8;}//===//
state.length=hold;if(state.head){state.head.extra_len=hold;}if(state.flags&0x0200){//=== CRC2(state.check, hold);
hbuf[0]=hold&0xff;hbuf[1]=hold>>>8&0xff;state.check=crc32(state.check,hbuf,2,0);//===//
}//=== INITBITS();
hold=0;bits=0;//===//
}else if(state.head){state.head.extra=null/*Z_NULL*/;}state.mode=EXTRA;/* falls through */case EXTRA:if(state.flags&0x0400){copy=state.length;if(copy>have){copy=have;}if(copy){if(state.head){len=state.head.extra_len-state.length;if(!state.head.extra){// Use untyped array for more conveniend processing later
state.head.extra=new Array(state.head.extra_len);}utils.arraySet(state.head.extra,input,next,// extra field is limited to 65536 bytes
// - no need for additional size check
copy,/*len + copy > state.head.extra_max - len ? state.head.extra_max : copy,*/len);//zmemcpy(state.head.extra + len, next,
//        len + copy > state.head.extra_max ?
//        state.head.extra_max - len : copy);
}if(state.flags&0x0200){state.check=crc32(state.check,input,copy,next);}have-=copy;next+=copy;state.length-=copy;}if(state.length){break inf_leave;}}state.length=0;state.mode=NAME;/* falls through */case NAME:if(state.flags&0x0800){if(have===0){break inf_leave;}copy=0;do{// TODO: 2 or 1 bytes?
len=input[next+copy++];/* use constant limit because in js we should not preallocate memory */if(state.head&&len&&state.length<65536/*state.head.name_max*/){state.head.name+=String.fromCharCode(len);}}while(len&&copy<have);if(state.flags&0x0200){state.check=crc32(state.check,input,copy,next);}have-=copy;next+=copy;if(len){break inf_leave;}}else if(state.head){state.head.name=null;}state.length=0;state.mode=COMMENT;/* falls through */case COMMENT:if(state.flags&0x1000){if(have===0){break inf_leave;}copy=0;do{len=input[next+copy++];/* use constant limit because in js we should not preallocate memory */if(state.head&&len&&state.length<65536/*state.head.comm_max*/){state.head.comment+=String.fromCharCode(len);}}while(len&&copy<have);if(state.flags&0x0200){state.check=crc32(state.check,input,copy,next);}have-=copy;next+=copy;if(len){break inf_leave;}}else if(state.head){state.head.comment=null;}state.mode=HCRC;/* falls through */case HCRC:if(state.flags&0x0200){//=== NEEDBITS(16); */
while(bits<16){if(have===0){break inf_leave;}have--;hold+=input[next++]<<bits;bits+=8;}//===//
if(hold!==(state.check&0xffff)){strm.msg='header crc mismatch';state.mode=BAD;break;}//=== INITBITS();
hold=0;bits=0;//===//
}if(state.head){state.head.hcrc=state.flags>>9&1;state.head.done=true;}strm.adler=state.check=0;state.mode=TYPE;break;case DICTID://=== NEEDBITS(32); */
while(bits<32){if(have===0){break inf_leave;}have--;hold+=input[next++]<<bits;bits+=8;}//===//
strm.adler=state.check=zswap32(hold);//=== INITBITS();
hold=0;bits=0;//===//
state.mode=DICT;/* falls through */case DICT:if(state.havedict===0){//--- RESTORE() ---
strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;//---
return Z_NEED_DICT;}strm.adler=state.check=1/*adler32(0L, Z_NULL, 0)*/;state.mode=TYPE;/* falls through */case TYPE:if(flush===Z_BLOCK||flush===Z_TREES){break inf_leave;}/* falls through */case TYPEDO:if(state.last){//--- BYTEBITS() ---//
hold>>>=bits&7;bits-=bits&7;//---//
state.mode=CHECK;break;}//=== NEEDBITS(3); */
while(bits<3){if(have===0){break inf_leave;}have--;hold+=input[next++]<<bits;bits+=8;}//===//
state.last=hold&0x01/*BITS(1)*/;//--- DROPBITS(1) ---//
hold>>>=1;bits-=1;//---//
switch(hold&0x03/*BITS(2)*/){case 0:/* stored block */ //Tracev((stderr, "inflate:     stored block%s\n",
//        state.last ? " (last)" : ""));
state.mode=STORED;break;case 1:/* fixed block */fixedtables(state);//Tracev((stderr, "inflate:     fixed codes block%s\n",
//        state.last ? " (last)" : ""));
state.mode=LEN_;/* decode codes */if(flush===Z_TREES){//--- DROPBITS(2) ---//
hold>>>=2;bits-=2;//---//
break inf_leave;}break;case 2:/* dynamic block */ //Tracev((stderr, "inflate:     dynamic codes block%s\n",
//        state.last ? " (last)" : ""));
state.mode=TABLE;break;case 3:strm.msg='invalid block type';state.mode=BAD;}//--- DROPBITS(2) ---//
hold>>>=2;bits-=2;//---//
break;case STORED://--- BYTEBITS() ---// /* go to byte boundary */
hold>>>=bits&7;bits-=bits&7;//---//
//=== NEEDBITS(32); */
while(bits<32){if(have===0){break inf_leave;}have--;hold+=input[next++]<<bits;bits+=8;}//===//
if((hold&0xffff)!==(hold>>>16^0xffff)){strm.msg='invalid stored block lengths';state.mode=BAD;break;}state.length=hold&0xffff;//Tracev((stderr, "inflate:       stored length %u\n",
//        state.length));
//=== INITBITS();
hold=0;bits=0;//===//
state.mode=COPY_;if(flush===Z_TREES){break inf_leave;}/* falls through */case COPY_:state.mode=COPY;/* falls through */case COPY:copy=state.length;if(copy){if(copy>have){copy=have;}if(copy>left){copy=left;}if(copy===0){break inf_leave;}//--- zmemcpy(put, next, copy); ---
utils.arraySet(output,input,next,copy,put);//---//
have-=copy;next+=copy;left-=copy;put+=copy;state.length-=copy;break;}//Tracev((stderr, "inflate:       stored end\n"));
state.mode=TYPE;break;case TABLE://=== NEEDBITS(14); */
while(bits<14){if(have===0){break inf_leave;}have--;hold+=input[next++]<<bits;bits+=8;}//===//
state.nlen=(hold&0x1f/*BITS(5)*/)+257;//--- DROPBITS(5) ---//
hold>>>=5;bits-=5;//---//
state.ndist=(hold&0x1f/*BITS(5)*/)+1;//--- DROPBITS(5) ---//
hold>>>=5;bits-=5;//---//
state.ncode=(hold&0x0f/*BITS(4)*/)+4;//--- DROPBITS(4) ---//
hold>>>=4;bits-=4;//---//
//#ifndef PKZIP_BUG_WORKAROUND
if(state.nlen>286||state.ndist>30){strm.msg='too many length or distance symbols';state.mode=BAD;break;}//#endif
//Tracev((stderr, "inflate:       table sizes ok\n"));
state.have=0;state.mode=LENLENS;/* falls through */case LENLENS:while(state.have<state.ncode){//=== NEEDBITS(3);
while(bits<3){if(have===0){break inf_leave;}have--;hold+=input[next++]<<bits;bits+=8;}//===//
state.lens[order[state.have++]]=hold&0x07;//BITS(3);
//--- DROPBITS(3) ---//
hold>>>=3;bits-=3;//---//
}while(state.have<19){state.lens[order[state.have++]]=0;}// We have separate tables & no pointers. 2 commented lines below not needed.
//state.next = state.codes;
//state.lencode = state.next;
// Switch to use dynamic table
state.lencode=state.lendyn;state.lenbits=7;opts={bits:state.lenbits};ret=inflate_table(CODES,state.lens,0,19,state.lencode,0,state.work,opts);state.lenbits=opts.bits;if(ret){strm.msg='invalid code lengths set';state.mode=BAD;break;}//Tracev((stderr, "inflate:       code lengths ok\n"));
state.have=0;state.mode=CODELENS;/* falls through */case CODELENS:while(state.have<state.nlen+state.ndist){for(;;){here=state.lencode[hold&(1<<state.lenbits)-1];/*BITS(state.lenbits)*/here_bits=here>>>24;here_op=here>>>16&0xff;here_val=here&0xffff;if(here_bits<=bits){break;}//--- PULLBYTE() ---//
if(have===0){break inf_leave;}have--;hold+=input[next++]<<bits;bits+=8;//---//
}if(here_val<16){//--- DROPBITS(here.bits) ---//
hold>>>=here_bits;bits-=here_bits;//---//
state.lens[state.have++]=here_val;}else{if(here_val===16){//=== NEEDBITS(here.bits + 2);
n=here_bits+2;while(bits<n){if(have===0){break inf_leave;}have--;hold+=input[next++]<<bits;bits+=8;}//===//
//--- DROPBITS(here.bits) ---//
hold>>>=here_bits;bits-=here_bits;//---//
if(state.have===0){strm.msg='invalid bit length repeat';state.mode=BAD;break;}len=state.lens[state.have-1];copy=3+(hold&0x03);//BITS(2);
//--- DROPBITS(2) ---//
hold>>>=2;bits-=2;//---//
}else if(here_val===17){//=== NEEDBITS(here.bits + 3);
n=here_bits+3;while(bits<n){if(have===0){break inf_leave;}have--;hold+=input[next++]<<bits;bits+=8;}//===//
//--- DROPBITS(here.bits) ---//
hold>>>=here_bits;bits-=here_bits;//---//
len=0;copy=3+(hold&0x07);//BITS(3);
//--- DROPBITS(3) ---//
hold>>>=3;bits-=3;//---//
}else{//=== NEEDBITS(here.bits + 7);
n=here_bits+7;while(bits<n){if(have===0){break inf_leave;}have--;hold+=input[next++]<<bits;bits+=8;}//===//
//--- DROPBITS(here.bits) ---//
hold>>>=here_bits;bits-=here_bits;//---//
len=0;copy=11+(hold&0x7f);//BITS(7);
//--- DROPBITS(7) ---//
hold>>>=7;bits-=7;//---//
}if(state.have+copy>state.nlen+state.ndist){strm.msg='invalid bit length repeat';state.mode=BAD;break;}while(copy--){state.lens[state.have++]=len;}}}/* handle error breaks in while */if(state.mode===BAD){break;}/* check for end-of-block code (better have one) */if(state.lens[256]===0){strm.msg='invalid code -- missing end-of-block';state.mode=BAD;break;}/* build code tables -- note: do not change the lenbits or distbits
			         values here (9 and 6) without reading the comments in inftrees.h
			         concerning the ENOUGH constants, which depend on those values */state.lenbits=9;opts={bits:state.lenbits};ret=inflate_table(LENS,state.lens,0,state.nlen,state.lencode,0,state.work,opts);// We have separate tables & no pointers. 2 commented lines below not needed.
// state.next_index = opts.table_index;
state.lenbits=opts.bits;// state.lencode = state.next;
if(ret){strm.msg='invalid literal/lengths set';state.mode=BAD;break;}state.distbits=6;//state.distcode.copy(state.codes);
// Switch to use dynamic table
state.distcode=state.distdyn;opts={bits:state.distbits};ret=inflate_table(DISTS,state.lens,state.nlen,state.ndist,state.distcode,0,state.work,opts);// We have separate tables & no pointers. 2 commented lines below not needed.
// state.next_index = opts.table_index;
state.distbits=opts.bits;// state.distcode = state.next;
if(ret){strm.msg='invalid distances set';state.mode=BAD;break;}//Tracev((stderr, 'inflate:       codes ok\n'));
state.mode=LEN_;if(flush===Z_TREES){break inf_leave;}/* falls through */case LEN_:state.mode=LEN;/* falls through */case LEN:if(have>=6&&left>=258){//--- RESTORE() ---
strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;//---
inflate_fast(strm,_out);//--- LOAD() ---
put=strm.next_out;output=strm.output;left=strm.avail_out;next=strm.next_in;input=strm.input;have=strm.avail_in;hold=state.hold;bits=state.bits;//---
if(state.mode===TYPE){state.back=-1;}break;}state.back=0;for(;;){here=state.lencode[hold&(1<<state.lenbits)-1];/*BITS(state.lenbits)*/here_bits=here>>>24;here_op=here>>>16&0xff;here_val=here&0xffff;if(here_bits<=bits){break;}//--- PULLBYTE() ---//
if(have===0){break inf_leave;}have--;hold+=input[next++]<<bits;bits+=8;//---//
}if(here_op&&(here_op&0xf0)===0){last_bits=here_bits;last_op=here_op;last_val=here_val;for(;;){here=state.lencode[last_val+((hold&(1<<last_bits+last_op)-1/*BITS(last.bits + last.op)*/)>>last_bits)];here_bits=here>>>24;here_op=here>>>16&0xff;here_val=here&0xffff;if(last_bits+here_bits<=bits){break;}//--- PULLBYTE() ---//
if(have===0){break inf_leave;}have--;hold+=input[next++]<<bits;bits+=8;//---//
}//--- DROPBITS(last.bits) ---//
hold>>>=last_bits;bits-=last_bits;//---//
state.back+=last_bits;}//--- DROPBITS(here.bits) ---//
hold>>>=here_bits;bits-=here_bits;//---//
state.back+=here_bits;state.length=here_val;if(here_op===0){//Tracevv((stderr, here.val >= 0x20 && here.val < 0x7f ?
//        "inflate:         literal '%c'\n" :
//        "inflate:         literal 0x%02x\n", here.val));
state.mode=LIT;break;}if(here_op&32){//Tracevv((stderr, "inflate:         end of block\n"));
state.back=-1;state.mode=TYPE;break;}if(here_op&64){strm.msg='invalid literal/length code';state.mode=BAD;break;}state.extra=here_op&15;state.mode=LENEXT;/* falls through */case LENEXT:if(state.extra){//=== NEEDBITS(state.extra);
n=state.extra;while(bits<n){if(have===0){break inf_leave;}have--;hold+=input[next++]<<bits;bits+=8;}//===//
state.length+=hold&(1<<state.extra)-1/*BITS(state.extra)*/;//--- DROPBITS(state.extra) ---//
hold>>>=state.extra;bits-=state.extra;//---//
state.back+=state.extra;}//Tracevv((stderr, "inflate:         length %u\n", state.length));
state.was=state.length;state.mode=DIST;/* falls through */case DIST:for(;;){here=state.distcode[hold&(1<<state.distbits)-1];/*BITS(state.distbits)*/here_bits=here>>>24;here_op=here>>>16&0xff;here_val=here&0xffff;if(here_bits<=bits){break;}//--- PULLBYTE() ---//
if(have===0){break inf_leave;}have--;hold+=input[next++]<<bits;bits+=8;//---//
}if((here_op&0xf0)===0){last_bits=here_bits;last_op=here_op;last_val=here_val;for(;;){here=state.distcode[last_val+((hold&(1<<last_bits+last_op)-1/*BITS(last.bits + last.op)*/)>>last_bits)];here_bits=here>>>24;here_op=here>>>16&0xff;here_val=here&0xffff;if(last_bits+here_bits<=bits){break;}//--- PULLBYTE() ---//
if(have===0){break inf_leave;}have--;hold+=input[next++]<<bits;bits+=8;//---//
}//--- DROPBITS(last.bits) ---//
hold>>>=last_bits;bits-=last_bits;//---//
state.back+=last_bits;}//--- DROPBITS(here.bits) ---//
hold>>>=here_bits;bits-=here_bits;//---//
state.back+=here_bits;if(here_op&64){strm.msg='invalid distance code';state.mode=BAD;break;}state.offset=here_val;state.extra=here_op&15;state.mode=DISTEXT;/* falls through */case DISTEXT:if(state.extra){//=== NEEDBITS(state.extra);
n=state.extra;while(bits<n){if(have===0){break inf_leave;}have--;hold+=input[next++]<<bits;bits+=8;}//===//
state.offset+=hold&(1<<state.extra)-1/*BITS(state.extra)*/;//--- DROPBITS(state.extra) ---//
hold>>>=state.extra;bits-=state.extra;//---//
state.back+=state.extra;}//#ifdef INFLATE_STRICT
if(state.offset>state.dmax){strm.msg='invalid distance too far back';state.mode=BAD;break;}//#endif
//Tracevv((stderr, "inflate:         distance %u\n", state.offset));
state.mode=MATCH;/* falls through */case MATCH:if(left===0){break inf_leave;}copy=_out-left;if(state.offset>copy){/* copy from window */copy=state.offset-copy;if(copy>state.whave){if(state.sane){strm.msg='invalid distance too far back';state.mode=BAD;break;}// (!) This block is disabled in zlib defailts,
// don't enable it for binary compatibility
//#ifdef INFLATE_ALLOW_INVALID_DISTANCE_TOOFAR_ARRR
//          Trace((stderr, "inflate.c too far\n"));
//          copy -= state.whave;
//          if (copy > state.length) { copy = state.length; }
//          if (copy > left) { copy = left; }
//          left -= copy;
//          state.length -= copy;
//          do {
//            output[put++] = 0;
//          } while (--copy);
//          if (state.length === 0) { state.mode = LEN; }
//          break;
//#endif
}if(copy>state.wnext){copy-=state.wnext;from=state.wsize-copy;}else{from=state.wnext-copy;}if(copy>state.length){copy=state.length;}from_source=state.window;}else{/* copy from output */from_source=output;from=put-state.offset;copy=state.length;}if(copy>left){copy=left;}left-=copy;state.length-=copy;do{output[put++]=from_source[from++];}while(--copy);if(state.length===0){state.mode=LEN;}break;case LIT:if(left===0){break inf_leave;}output[put++]=state.length;left--;state.mode=LEN;break;case CHECK:if(state.wrap){//=== NEEDBITS(32);
while(bits<32){if(have===0){break inf_leave;}have--;// Use '|' insdead of '+' to make sure that result is signed
hold|=input[next++]<<bits;bits+=8;}//===//
_out-=left;strm.total_out+=_out;state.total+=_out;if(_out){strm.adler=state.check=/*UPDATE(state.check, put - _out, _out);*/state.flags?crc32(state.check,output,_out,put-_out):adler32(state.check,output,_out,put-_out);}_out=left;// NB: crc32 stored as signed 32-bit int, zswap32 returns signed too
if((state.flags?hold:zswap32(hold))!==state.check){strm.msg='incorrect data check';state.mode=BAD;break;}//=== INITBITS();
hold=0;bits=0;//===//
//Tracev((stderr, "inflate:   check matches trailer\n"));
}state.mode=LENGTH;/* falls through */case LENGTH:if(state.wrap&&state.flags){//=== NEEDBITS(32);
while(bits<32){if(have===0){break inf_leave;}have--;hold+=input[next++]<<bits;bits+=8;}//===//
if(hold!==(state.total&0xffffffff)){strm.msg='incorrect length check';state.mode=BAD;break;}//=== INITBITS();
hold=0;bits=0;//===//
//Tracev((stderr, "inflate:   length matches trailer\n"));
}state.mode=DONE;/* falls through */case DONE:ret=Z_STREAM_END;break inf_leave;case BAD:ret=Z_DATA_ERROR;break inf_leave;case MEM:return Z_MEM_ERROR;case SYNC:/* falls through */default:return Z_STREAM_ERROR;}}// inf_leave <- here is real place for "goto inf_leave", emulated via "break inf_leave"
/*
			     Return from inflate(), updating the total counts and the check value.
			     If there was no progress during the inflate() call, return a buffer
			     error.  Call updatewindow() to create and/or update the window state.
			     Note: a memory error from inflate() is non-recoverable.
			   */ //--- RESTORE() ---
strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;//---
if(state.wsize||_out!==strm.avail_out&&state.mode<BAD&&(state.mode<CHECK||flush!==Z_FINISH)){if(updatewindow(strm,strm.output,strm.next_out,_out-strm.avail_out));}_in-=strm.avail_in;_out-=strm.avail_out;strm.total_in+=_in;strm.total_out+=_out;state.total+=_out;if(state.wrap&&_out){strm.adler=state.check=/*UPDATE(state.check, strm.next_out - _out, _out);*/state.flags?crc32(state.check,output,_out,strm.next_out-_out):adler32(state.check,output,_out,strm.next_out-_out);}strm.data_type=state.bits+(state.last?64:0)+(state.mode===TYPE?128:0)+(state.mode===LEN_||state.mode===COPY_?256:0);if((_in===0&&_out===0||flush===Z_FINISH)&&ret===Z_OK){ret=Z_BUF_ERROR;}return ret;}function inflateEnd(strm){if(!strm||!strm.state/*|| strm->zfree == (free_func)0*/){return Z_STREAM_ERROR;}var state=strm.state;if(state.window){state.window=null;}strm.state=null;return Z_OK;}function inflateGetHeader(strm,head){var state;/* check state */if(!strm||!strm.state){return Z_STREAM_ERROR;}state=strm.state;if((state.wrap&2)===0){return Z_STREAM_ERROR;}/* save header structure */state.head=head;head.done=false;return Z_OK;}function inflateSetDictionary(strm,dictionary){var dictLength=dictionary.length;var state;var dictid;var ret;/* check state */if(!strm/* == Z_NULL */||!strm.state/* == Z_NULL */){return Z_STREAM_ERROR;}state=strm.state;if(state.wrap!==0&&state.mode!==DICT){return Z_STREAM_ERROR;}/* check for correct dictionary identifier */if(state.mode===DICT){dictid=1;/* adler32(0, null, 0)*/ /* dictid = adler32(dictid, dictionary, dictLength); */dictid=adler32(dictid,dictionary,dictLength,0);if(dictid!==state.check){return Z_DATA_ERROR;}}/* copy dictionary to window using updatewindow(), which will amend the
			   existing dictionary if appropriate */ret=updatewindow(strm,dictionary,dictLength,dictLength);if(ret){state.mode=MEM;return Z_MEM_ERROR;}state.havedict=1;// Tracev((stderr, "inflate:   dictionary set\n"));
return Z_OK;}exports.inflateReset=inflateReset;exports.inflateReset2=inflateReset2;exports.inflateResetKeep=inflateResetKeep;exports.inflateInit=inflateInit;exports.inflateInit2=inflateInit2;exports.inflate=inflate;exports.inflateEnd=inflateEnd;exports.inflateGetHeader=inflateGetHeader;exports.inflateSetDictionary=inflateSetDictionary;exports.inflateInfo='pako inflate (from Nodeca project)';/* Not implemented
			exports.inflateCopy = inflateCopy;
			exports.inflateGetDictionary = inflateGetDictionary;
			exports.inflateMark = inflateMark;
			exports.inflatePrime = inflatePrime;
			exports.inflateSync = inflateSync;
			exports.inflateSyncPoint = inflateSyncPoint;
			exports.inflateUndermine = inflateUndermine;
			*/},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(require,module,exports){// (C) 1995-2013 Jean-loup Gailly and Mark Adler
// (C) 2014-2017 Vitaly Puzrin and Andrey Tupitsin
//
// This software is provided 'as-is', without any express or implied
// warranty. In no event will the authors be held liable for any damages
// arising from the use of this software.
//
// Permission is granted to anyone to use this software for any purpose,
// including commercial applications, and to alter it and redistribute it
// freely, subject to the following restrictions:
//
// 1. The origin of this software must not be misrepresented; you must not
//   claim that you wrote the original software. If you use this software
//   in a product, an acknowledgment in the product documentation would be
//   appreciated but is not required.
// 2. Altered source versions must be plainly marked as such, and must not be
//   misrepresented as being the original software.
// 3. This notice may not be removed or altered from any source distribution.
var utils=require('../utils/common');var MAXBITS=15;var ENOUGH_LENS=852;var ENOUGH_DISTS=592;//var ENOUGH = (ENOUGH_LENS+ENOUGH_DISTS);
var CODES=0;var LENS=1;var DISTS=2;var lbase=[/* Length codes 257..285 base */3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0];var lext=[/* Length codes 257..285 extra */16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78];var dbase=[/* Distance codes 0..29 base */1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0];var dext=[/* Distance codes 0..29 extra */16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];module.exports=function inflate_table(type,lens,lens_index,codes,table,table_index,work,opts){var bits=opts.bits;//here = opts.here; /* table entry for duplication */
var len=0;/* a code's length in bits */var sym=0;/* index of code symbols */var min=0,max=0;/* minimum and maximum code lengths */var root=0;/* number of index bits for root table */var curr=0;/* number of index bits for current table */var drop=0;/* code bits to drop for sub-table */var left=0;/* number of prefix codes available */var used=0;/* code entries in table used */var huff=0;/* Huffman code */var incr;/* for incrementing code, index */var fill;/* index for replicating entries */var low;/* low bits for current root entry */var mask;/* mask for low root bits */var next;/* next available space in table */var base=null;/* base value table to use */var base_index=0;//  var shoextra;    /* extra bits table to use */
var end;/* use base and extra for symbol > end */var count=new utils.Buf16(MAXBITS+1);//[MAXBITS+1];    /* number of codes of each length */
var offs=new utils.Buf16(MAXBITS+1);//[MAXBITS+1];     /* offsets in table for each length */
var extra=null;var extra_index=0;var here_bits,here_op,here_val;/*
			   Process a set of code lengths to create a canonical Huffman code.  The
			   code lengths are lens[0..codes-1].  Each length corresponds to the
			   symbols 0..codes-1.  The Huffman code is generated by first sorting the
			   symbols by length from short to long, and retaining the symbol order
			   for codes with equal lengths.  Then the code starts with all zero bits
			   for the first code of the shortest length, and the codes are integer
			   increments for the same length, and zeros are appended as the length
			   increases.  For the deflate format, these bits are stored backwards
			   from their more natural integer increment ordering, and so when the
			   decoding tables are built in the large loop below, the integer codes
			   are incremented backwards.

			   This routine assumes, but does not check, that all of the entries in
			   lens[] are in the range 0..MAXBITS.  The caller must assure this.
			   1..MAXBITS is interpreted as that code length.  zero means that that
			   symbol does not occur in this code.

			   The codes are sorted by computing a count of codes for each length,
			   creating from that a table of starting indices for each length in the
			   sorted table, and then entering the symbols in order in the sorted
			   table.  The sorted table is work[], with that space being provided by
			   the caller.

			   The length counts are used for other purposes as well, i.e. finding
			   the minimum and maximum length codes, determining if there are any
			   codes at all, checking for a valid set of lengths, and looking ahead
			   at length counts to determine sub-table sizes when building the
			   decoding tables.
			   */ /* accumulate lengths for codes (assumes lens[] all in 0..MAXBITS) */for(len=0;len<=MAXBITS;len++){count[len]=0;}for(sym=0;sym<codes;sym++){count[lens[lens_index+sym]]++;}/* bound code lengths, force root to be within code lengths */root=bits;for(max=MAXBITS;max>=1;max--){if(count[max]!==0){break;}}if(root>max){root=max;}if(max===0){/* no symbols to code at all */ //table.op[opts.table_index] = 64;  //here.op = (var char)64;    /* invalid code marker */
//table.bits[opts.table_index] = 1;   //here.bits = (var char)1;
//table.val[opts.table_index++] = 0;   //here.val = (var short)0;
table[table_index++]=1<<24|64<<16|0;//table.op[opts.table_index] = 64;
//table.bits[opts.table_index] = 1;
//table.val[opts.table_index++] = 0;
table[table_index++]=1<<24|64<<16|0;opts.bits=1;return 0;/* no symbols, but wait for decoding to report error */}for(min=1;min<max;min++){if(count[min]!==0){break;}}if(root<min){root=min;}/* check for an over-subscribed or incomplete set of lengths */left=1;for(len=1;len<=MAXBITS;len++){left<<=1;left-=count[len];if(left<0){return-1;}/* over-subscribed */}if(left>0&&(type===CODES||max!==1)){return-1;/* incomplete set */}/* generate offsets into symbol table for each length for sorting */offs[1]=0;for(len=1;len<MAXBITS;len++){offs[len+1]=offs[len]+count[len];}/* sort symbols by length, by symbol order within each length */for(sym=0;sym<codes;sym++){if(lens[lens_index+sym]!==0){work[offs[lens[lens_index+sym]]++]=sym;}}/*
			   Create and fill in decoding tables.  In this loop, the table being
			   filled is at next and has curr index bits.  The code being used is huff
			   with length len.  That code is converted to an index by dropping drop
			   bits off of the bottom.  For codes where len is less than drop + curr,
			   those top drop + curr - len bits are incremented through all values to
			   fill the table with replicated entries.

			   root is the number of index bits for the root table.  When len exceeds
			   root, sub-tables are created pointed to by the root entry with an index
			   of the low root bits of huff.  This is saved in low to check for when a
			   new sub-table should be started.  drop is zero when the root table is
			   being filled, and drop is root when sub-tables are being filled.

			   When a new sub-table is needed, it is necessary to look ahead in the
			   code lengths to determine what size sub-table is needed.  The length
			   counts are used for this, and so count[] is decremented as codes are
			   entered in the tables.

			   used keeps track of how many table entries have been allocated from the
			   provided *table space.  It is checked for LENS and DIST tables against
			   the constants ENOUGH_LENS and ENOUGH_DISTS to guard against changes in
			   the initial root table size constants.  See the comments in inftrees.h
			   for more information.

			   sym increments through all symbols, and the loop terminates when
			   all codes of length max, i.e. all codes, have been processed.  This
			   routine permits incomplete codes, so another loop after this one fills
			   in the rest of the decoding tables with invalid code markers.
			   */ /* set up for code type */ // poor man optimization - use if-else instead of switch,
// to avoid deopts in old v8
if(type===CODES){base=extra=work;/* dummy value--not used */end=19;}else if(type===LENS){base=lbase;base_index-=257;extra=lext;extra_index-=257;end=256;}else{/* DISTS */base=dbase;extra=dext;end=-1;}/* initialize opts for loop */huff=0;/* starting code */sym=0;/* starting code symbol */len=min;/* starting code length */next=table_index;/* current table to fill in */curr=root;/* current table index bits */drop=0;/* current bits to drop from code for index */low=-1;/* trigger new sub-table when len > root */used=1<<root;/* use root table entries */mask=used-1;/* mask for comparing low */ /* check available table space */if(type===LENS&&used>ENOUGH_LENS||type===DISTS&&used>ENOUGH_DISTS){return 1;}/* process all codes and make table entries */for(;;){/* create table entry */here_bits=len-drop;if(work[sym]<end){here_op=0;here_val=work[sym];}else if(work[sym]>end){here_op=extra[extra_index+work[sym]];here_val=base[base_index+work[sym]];}else{here_op=32+64;/* end of block */here_val=0;}/* replicate for those indices with low len bits equal to huff */incr=1<<len-drop;fill=1<<curr;min=fill;/* save offset to next table */do{fill-=incr;table[next+(huff>>drop)+fill]=here_bits<<24|here_op<<16|here_val|0;}while(fill!==0);/* backwards increment the len-bit code huff */incr=1<<len-1;while(huff&incr){incr>>=1;}if(incr!==0){huff&=incr-1;huff+=incr;}else{huff=0;}/* go to next symbol, update count, len */sym++;if(--count[len]===0){if(len===max){break;}len=lens[lens_index+work[sym]];}/* create new sub-table if needed */if(len>root&&(huff&mask)!==low){/* if first time, transition to sub-tables */if(drop===0){drop=root;}/* increment past last table */next+=min;/* here min is 1 << curr */ /* determine length of next table */curr=len-drop;left=1<<curr;while(curr+drop<max){left-=count[curr+drop];if(left<=0){break;}curr++;left<<=1;}/* check for enough space */used+=1<<curr;if(type===LENS&&used>ENOUGH_LENS||type===DISTS&&used>ENOUGH_DISTS){return 1;}/* point entry in root table to sub-table */low=huff&mask;/*table.op[low] = curr;
			      table.bits[low] = root;
			      table.val[low] = next - opts.table_index;*/table[low]=root<<24|curr<<16|next-table_index|0;}}/* fill in remaining table entry if code is incomplete (guaranteed to have
			   at most one remaining entry, since if the code is incomplete, the
			   maximum code length that was allowed to get this far is one bit) */if(huff!==0){//table.op[next + huff] = 64;            /* invalid code marker */
//table.bits[next + huff] = len - drop;
//table.val[next + huff] = 0;
table[next+huff]=len-drop<<24|64<<16|0;}/* set return parameters */ //opts.table_index += used;
opts.bits=root;return 0;};},{"../utils/common":41}],51:[function(require,module,exports){// (C) 1995-2013 Jean-loup Gailly and Mark Adler
// (C) 2014-2017 Vitaly Puzrin and Andrey Tupitsin
//
// This software is provided 'as-is', without any express or implied
// warranty. In no event will the authors be held liable for any damages
// arising from the use of this software.
//
// Permission is granted to anyone to use this software for any purpose,
// including commercial applications, and to alter it and redistribute it
// freely, subject to the following restrictions:
//
// 1. The origin of this software must not be misrepresented; you must not
//   claim that you wrote the original software. If you use this software
//   in a product, an acknowledgment in the product documentation would be
//   appreciated but is not required.
// 2. Altered source versions must be plainly marked as such, and must not be
//   misrepresented as being the original software.
// 3. This notice may not be removed or altered from any source distribution.
module.exports={2:'need dictionary',/* Z_NEED_DICT       2  */1:'stream end',/* Z_STREAM_END      1  */0:'',/* Z_OK              0  */'-1':'file error',/* Z_ERRNO         (-1) */'-2':'stream error',/* Z_STREAM_ERROR  (-2) */'-3':'data error',/* Z_DATA_ERROR    (-3) */'-4':'insufficient memory',/* Z_MEM_ERROR     (-4) */'-5':'buffer error',/* Z_BUF_ERROR     (-5) */'-6':'incompatible version'/* Z_VERSION_ERROR (-6) */};},{}],52:[function(require,module,exports){// (C) 1995-2013 Jean-loup Gailly and Mark Adler
// (C) 2014-2017 Vitaly Puzrin and Andrey Tupitsin
//
// This software is provided 'as-is', without any express or implied
// warranty. In no event will the authors be held liable for any damages
// arising from the use of this software.
//
// Permission is granted to anyone to use this software for any purpose,
// including commercial applications, and to alter it and redistribute it
// freely, subject to the following restrictions:
//
// 1. The origin of this software must not be misrepresented; you must not
//   claim that you wrote the original software. If you use this software
//   in a product, an acknowledgment in the product documentation would be
//   appreciated but is not required.
// 2. Altered source versions must be plainly marked as such, and must not be
//   misrepresented as being the original software.
// 3. This notice may not be removed or altered from any source distribution.
var utils=require('../utils/common');/* Public constants ==========================================================*/ /* ===========================================================================*/ //var Z_FILTERED          = 1;
//var Z_HUFFMAN_ONLY      = 2;
//var Z_RLE               = 3;
var Z_FIXED=4;//var Z_DEFAULT_STRATEGY  = 0;
/* Possible values of the data_type field (though see inflate()) */var Z_BINARY=0;var Z_TEXT=1;//var Z_ASCII             = 1; // = Z_TEXT
var Z_UNKNOWN=2;/*============================================================================*/function zero(buf){var len=buf.length;while(--len>=0){buf[len]=0;}}// From zutil.h
var STORED_BLOCK=0;var STATIC_TREES=1;var DYN_TREES=2;/* The three kinds of block type */var MIN_MATCH=3;var MAX_MATCH=258;/* The minimum and maximum match lengths */ // From deflate.h
/* ===========================================================================
			 * Internal compression state.
			 */var LENGTH_CODES=29;/* number of length codes, not counting the special END_BLOCK code */var LITERALS=256;/* number of literal bytes 0..255 */var L_CODES=LITERALS+1+LENGTH_CODES;/* number of Literal or Length codes, including the END_BLOCK code */var D_CODES=30;/* number of distance codes */var BL_CODES=19;/* number of codes used to transfer the bit lengths */var HEAP_SIZE=2*L_CODES+1;/* maximum heap size */var MAX_BITS=15;/* All codes must not exceed MAX_BITS bits */var Buf_size=16;/* size of bit buffer in bi_buf */ /* ===========================================================================
			 * Constants
			 */var MAX_BL_BITS=7;/* Bit length codes must not exceed MAX_BL_BITS bits */var END_BLOCK=256;/* end of block literal code */var REP_3_6=16;/* repeat previous bit length 3-6 times (2 bits of repeat count) */var REPZ_3_10=17;/* repeat a zero length 3-10 times  (3 bits of repeat count) */var REPZ_11_138=18;/* repeat a zero length 11-138 times  (7 bits of repeat count) */ /* eslint-disable comma-spacing,array-bracket-spacing */var extra_lbits=/* extra bits for each length code */[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0];var extra_dbits=/* extra bits for each distance code */[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];var extra_blbits=/* extra bits for each bit length code */[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7];var bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];/* eslint-enable comma-spacing,array-bracket-spacing */ /* The lengths of the bit length codes are sent in order of decreasing
			 * probability, to avoid transmitting the lengths for unused bit length codes.
			 */ /* ===========================================================================
			 * Local data. These are initialized only once.
			 */ // We pre-fill arrays with 0 to avoid uninitialized gaps
var DIST_CODE_LEN=512;/* see definition of array dist_code below */ // !!!! Use flat array insdead of structure, Freq = i*2, Len = i*2+1
var static_ltree=new Array((L_CODES+2)*2);zero(static_ltree);/* The static literal tree. Since the bit lengths are imposed, there is no
			 * need for the L_CODES extra codes used during heap construction. However
			 * The codes 286 and 287 are needed to build a canonical tree (see _tr_init
			 * below).
			 */var static_dtree=new Array(D_CODES*2);zero(static_dtree);/* The static distance tree. (Actually a trivial tree since all codes use
			 * 5 bits.)
			 */var _dist_code=new Array(DIST_CODE_LEN);zero(_dist_code);/* Distance codes. The first 256 values correspond to the distances
			 * 3 .. 258, the last 256 values correspond to the top 8 bits of
			 * the 15 bit distances.
			 */var _length_code=new Array(MAX_MATCH-MIN_MATCH+1);zero(_length_code);/* length code for each normalized match length (0 == MIN_MATCH) */var base_length=new Array(LENGTH_CODES);zero(base_length);/* First normalized length for each code (0 = MIN_MATCH) */var base_dist=new Array(D_CODES);zero(base_dist);/* First normalized distance for each code (0 = distance of 1) */function StaticTreeDesc(static_tree,extra_bits,extra_base,elems,max_length){this.static_tree=static_tree;/* static tree or NULL */this.extra_bits=extra_bits;/* extra bits for each code or NULL */this.extra_base=extra_base;/* base index for extra_bits */this.elems=elems;/* max number of elements in the tree */this.max_length=max_length;/* max bit length for the codes */ // show if `static_tree` has data or dummy - needed for monomorphic objects
this.has_stree=static_tree&&static_tree.length;}var static_l_desc;var static_d_desc;var static_bl_desc;function TreeDesc(dyn_tree,stat_desc){this.dyn_tree=dyn_tree;/* the dynamic tree */this.max_code=0;/* largest code with non zero frequency */this.stat_desc=stat_desc;/* the corresponding static tree */}function d_code(dist){return dist<256?_dist_code[dist]:_dist_code[256+(dist>>>7)];}/* ===========================================================================
			 * Output a short LSB first on the stream.
			 * IN assertion: there is enough room in pendingBuf.
			 */function put_short(s,w){//    put_byte(s, (uch)((w) & 0xff));
//    put_byte(s, (uch)((ush)(w) >> 8));
s.pending_buf[s.pending++]=w&0xff;s.pending_buf[s.pending++]=w>>>8&0xff;}/* ===========================================================================
			 * Send a value on a given number of bits.
			 * IN assertion: length <= 16 and value fits in length bits.
			 */function send_bits(s,value,length){if(s.bi_valid>Buf_size-length){s.bi_buf|=value<<s.bi_valid&0xffff;put_short(s,s.bi_buf);s.bi_buf=value>>Buf_size-s.bi_valid;s.bi_valid+=length-Buf_size;}else{s.bi_buf|=value<<s.bi_valid&0xffff;s.bi_valid+=length;}}function send_code(s,c,tree){send_bits(s,tree[c*2]/*.Code*/,tree[c*2+1]/*.Len*/);}/* ===========================================================================
			 * Reverse the first len bits of a code, using straightforward code (a faster
			 * method would use a table)
			 * IN assertion: 1 <= len <= 15
			 */function bi_reverse(code,len){var res=0;do{res|=code&1;code>>>=1;res<<=1;}while(--len>0);return res>>>1;}/* ===========================================================================
			 * Flush the bit buffer, keeping at most 7 bits in it.
			 */function bi_flush(s){if(s.bi_valid===16){put_short(s,s.bi_buf);s.bi_buf=0;s.bi_valid=0;}else if(s.bi_valid>=8){s.pending_buf[s.pending++]=s.bi_buf&0xff;s.bi_buf>>=8;s.bi_valid-=8;}}/* ===========================================================================
			 * Compute the optimal bit lengths for a tree and update the total bit length
			 * for the current block.
			 * IN assertion: the fields freq and dad are set, heap[heap_max] and
			 *    above are the tree nodes sorted by increasing frequency.
			 * OUT assertions: the field len is set to the optimal bit length, the
			 *     array bl_count contains the frequencies for each bit length.
			 *     The length opt_len is updated; static_len is also updated if stree is
			 *     not null.
			 */function gen_bitlen(s,desc)//    deflate_state *s;
//    tree_desc *desc;    /* the tree descriptor */
{var tree=desc.dyn_tree;var max_code=desc.max_code;var stree=desc.stat_desc.static_tree;var has_stree=desc.stat_desc.has_stree;var extra=desc.stat_desc.extra_bits;var base=desc.stat_desc.extra_base;var max_length=desc.stat_desc.max_length;var h;/* heap index */var n,m;/* iterate over the tree elements */var bits;/* bit length */var xbits;/* extra bits */var f;/* frequency */var overflow=0;/* number of elements with bit length too large */for(bits=0;bits<=MAX_BITS;bits++){s.bl_count[bits]=0;}/* In a first pass, compute the optimal bit lengths (which may
			   * overflow in the case of the bit length tree).
			   */tree[s.heap[s.heap_max]*2+1]/*.Len*/=0;/* root of the heap */for(h=s.heap_max+1;h<HEAP_SIZE;h++){n=s.heap[h];bits=tree[tree[n*2+1]/*.Dad*/*2+1]/*.Len*/+1;if(bits>max_length){bits=max_length;overflow++;}tree[n*2+1]/*.Len*/=bits;/* We overwrite tree[n].Dad which is no longer needed */if(n>max_code){continue;}/* not a leaf node */s.bl_count[bits]++;xbits=0;if(n>=base){xbits=extra[n-base];}f=tree[n*2]/*.Freq*/;s.opt_len+=f*(bits+xbits);if(has_stree){s.static_len+=f*(stree[n*2+1]/*.Len*/+xbits);}}if(overflow===0){return;}// Trace((stderr,"\nbit length overflow\n"));
/* This happens for example on obj2 and pic of the Calgary corpus */ /* Find the first bit length which could increase: */do{bits=max_length-1;while(s.bl_count[bits]===0){bits--;}s.bl_count[bits]--;/* move one leaf down the tree */s.bl_count[bits+1]+=2;/* move one overflow item as its brother */s.bl_count[max_length]--;/* The brother of the overflow item also moves one step up,
			     * but this does not affect bl_count[max_length]
			     */overflow-=2;}while(overflow>0);/* Now recompute all bit lengths, scanning in increasing frequency.
			   * h is still equal to HEAP_SIZE. (It is simpler to reconstruct all
			   * lengths instead of fixing only the wrong ones. This idea is taken
			   * from 'ar' written by Haruhiko Okumura.)
			   */for(bits=max_length;bits!==0;bits--){n=s.bl_count[bits];while(n!==0){m=s.heap[--h];if(m>max_code){continue;}if(tree[m*2+1]/*.Len*/!==bits){// Trace((stderr,"code %d bits %d->%d\n", m, tree[m].Len, bits));
s.opt_len+=(bits-tree[m*2+1]/*.Len*/)*tree[m*2]/*.Freq*/;tree[m*2+1]/*.Len*/=bits;}n--;}}}/* ===========================================================================
			 * Generate the codes for a given tree and bit counts (which need not be
			 * optimal).
			 * IN assertion: the array bl_count contains the bit length statistics for
			 * the given tree and the field len is set for all tree elements.
			 * OUT assertion: the field code is set for all tree elements of non
			 *     zero code length.
			 */function gen_codes(tree,max_code,bl_count)//    ct_data *tree;             /* the tree to decorate */
//    int max_code;              /* largest code with non zero frequency */
//    ushf *bl_count;            /* number of codes at each bit length */
{var next_code=new Array(MAX_BITS+1);/* next code value for each bit length */var code=0;/* running code value */var bits;/* bit index */var n;/* code index */ /* The distribution counts are first used to generate the code values
			   * without bit reversal.
			   */for(bits=1;bits<=MAX_BITS;bits++){next_code[bits]=code=code+bl_count[bits-1]<<1;}/* Check that the bit counts in bl_count are consistent. The last code
			   * must be all ones.
			   */ //Assert (code + bl_count[MAX_BITS]-1 == (1<<MAX_BITS)-1,
//        "inconsistent bit counts");
//Tracev((stderr,"\ngen_codes: max_code %d ", max_code));
for(n=0;n<=max_code;n++){var len=tree[n*2+1]/*.Len*/;if(len===0){continue;}/* Now reverse the bits */tree[n*2]/*.Code*/=bi_reverse(next_code[len]++,len);//Tracecv(tree != static_ltree, (stderr,"\nn %3d %c l %2d c %4x (%x) ",
//     n, (isgraph(n) ? n : ' '), len, tree[n].Code, next_code[len]-1));
}}/* ===========================================================================
			 * Initialize the various 'constant' tables.
			 */function tr_static_init(){var n;/* iterates over tree elements */var bits;/* bit counter */var length;/* length value */var code;/* code value */var dist;/* distance index */var bl_count=new Array(MAX_BITS+1);/* number of codes at each bit length for an optimal tree */ // do check in _tr_init()
//if (static_init_done) return;
/* For some embedded targets, global variables are not initialized: */ /*#ifdef NO_INIT_GLOBAL_POINTERS
			  static_l_desc.static_tree = static_ltree;
			  static_l_desc.extra_bits = extra_lbits;
			  static_d_desc.static_tree = static_dtree;
			  static_d_desc.extra_bits = extra_dbits;
			  static_bl_desc.extra_bits = extra_blbits;
			#endif*/ /* Initialize the mapping length (0..255) -> length code (0..28) */length=0;for(code=0;code<LENGTH_CODES-1;code++){base_length[code]=length;for(n=0;n<1<<extra_lbits[code];n++){_length_code[length++]=code;}}//Assert (length == 256, "tr_static_init: length != 256");
/* Note that the length 255 (match length 258) can be represented
			   * in two different ways: code 284 + 5 bits or code 285, so we
			   * overwrite length_code[255] to use the best encoding:
			   */_length_code[length-1]=code;/* Initialize the mapping dist (0..32K) -> dist code (0..29) */dist=0;for(code=0;code<16;code++){base_dist[code]=dist;for(n=0;n<1<<extra_dbits[code];n++){_dist_code[dist++]=code;}}//Assert (dist == 256, "tr_static_init: dist != 256");
dist>>=7;/* from now on, all distances are divided by 128 */for(;code<D_CODES;code++){base_dist[code]=dist<<7;for(n=0;n<1<<extra_dbits[code]-7;n++){_dist_code[256+dist++]=code;}}//Assert (dist == 256, "tr_static_init: 256+dist != 512");
/* Construct the codes of the static literal tree */for(bits=0;bits<=MAX_BITS;bits++){bl_count[bits]=0;}n=0;while(n<=143){static_ltree[n*2+1]/*.Len*/=8;n++;bl_count[8]++;}while(n<=255){static_ltree[n*2+1]/*.Len*/=9;n++;bl_count[9]++;}while(n<=279){static_ltree[n*2+1]/*.Len*/=7;n++;bl_count[7]++;}while(n<=287){static_ltree[n*2+1]/*.Len*/=8;n++;bl_count[8]++;}/* Codes 286 and 287 do not exist, but we must include them in the
			   * tree construction to get a canonical Huffman tree (longest code
			   * all ones)
			   */gen_codes(static_ltree,L_CODES+1,bl_count);/* The static distance tree is trivial: */for(n=0;n<D_CODES;n++){static_dtree[n*2+1]/*.Len*/=5;static_dtree[n*2]/*.Code*/=bi_reverse(n,5);}// Now data ready and we can init static trees
static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS+1,L_CODES,MAX_BITS);static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES,MAX_BITS);static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES,MAX_BL_BITS);//static_init_done = true;
}/* ===========================================================================
			 * Initialize a new block.
			 */function init_block(s){var n;/* iterates over tree elements */ /* Initialize the trees. */for(n=0;n<L_CODES;n++){s.dyn_ltree[n*2]/*.Freq*/=0;}for(n=0;n<D_CODES;n++){s.dyn_dtree[n*2]/*.Freq*/=0;}for(n=0;n<BL_CODES;n++){s.bl_tree[n*2]/*.Freq*/=0;}s.dyn_ltree[END_BLOCK*2]/*.Freq*/=1;s.opt_len=s.static_len=0;s.last_lit=s.matches=0;}/* ===========================================================================
			 * Flush the bit buffer and align the output on a byte boundary
			 */function bi_windup(s){if(s.bi_valid>8){put_short(s,s.bi_buf);}else if(s.bi_valid>0){//put_byte(s, (Byte)s->bi_buf);
s.pending_buf[s.pending++]=s.bi_buf;}s.bi_buf=0;s.bi_valid=0;}/* ===========================================================================
			 * Copy a stored block, storing first the length and its
			 * one's complement if requested.
			 */function copy_block(s,buf,len,header)//DeflateState *s;
//charf    *buf;    /* the input data */
//unsigned len;     /* its length */
//int      header;  /* true if block header must be written */
{bi_windup(s);/* align on byte boundary */if(header){put_short(s,len);put_short(s,~len);}//  while (len--) {
//    put_byte(s, *buf++);
//  }
utils.arraySet(s.pending_buf,s.window,buf,len,s.pending);s.pending+=len;}/* ===========================================================================
			 * Compares to subtrees, using the tree depth as tie breaker when
			 * the subtrees have equal frequency. This minimizes the worst case length.
			 */function smaller(tree,n,m,depth){var _n2=n*2;var _m2=m*2;return tree[_n2]/*.Freq*/<tree[_m2]/*.Freq*/||tree[_n2]/*.Freq*/===tree[_m2]/*.Freq*/&&depth[n]<=depth[m];}/* ===========================================================================
			 * Restore the heap property by moving down the tree starting at node k,
			 * exchanging a node with the smallest of its two sons if necessary, stopping
			 * when the heap property is re-established (each father smaller than its
			 * two sons).
			 */function pqdownheap(s,tree,k)//    deflate_state *s;
//    ct_data *tree;  /* the tree to restore */
//    int k;               /* node to move down */
{var v=s.heap[k];var j=k<<1;/* left son of k */while(j<=s.heap_len){/* Set j to the smallest of the two sons: */if(j<s.heap_len&&smaller(tree,s.heap[j+1],s.heap[j],s.depth)){j++;}/* Exit if v is smaller than both sons */if(smaller(tree,v,s.heap[j],s.depth)){break;}/* Exchange v with the smallest son */s.heap[k]=s.heap[j];k=j;/* And continue down the tree, setting j to the left son of k */j<<=1;}s.heap[k]=v;}// inlined manually
// var SMALLEST = 1;
/* ===========================================================================
			 * Send the block data compressed using the given Huffman trees
			 */function compress_block(s,ltree,dtree)//    deflate_state *s;
//    const ct_data *ltree; /* literal tree */
//    const ct_data *dtree; /* distance tree */
{var dist;/* distance of matched string */var lc;/* match length or unmatched char (if dist == 0) */var lx=0;/* running index in l_buf */var code;/* the code to send */var extra;/* number of extra bits to send */if(s.last_lit!==0){do{dist=s.pending_buf[s.d_buf+lx*2]<<8|s.pending_buf[s.d_buf+lx*2+1];lc=s.pending_buf[s.l_buf+lx];lx++;if(dist===0){send_code(s,lc,ltree);/* send a literal byte */ //Tracecv(isgraph(lc), (stderr," '%c' ", lc));
}else{/* Here, lc is the match length - MIN_MATCH */code=_length_code[lc];send_code(s,code+LITERALS+1,ltree);/* send the length code */extra=extra_lbits[code];if(extra!==0){lc-=base_length[code];send_bits(s,lc,extra);/* send the extra length bits */}dist--;/* dist is now the match distance - 1 */code=d_code(dist);//Assert (code < D_CODES, "bad d_code");
send_code(s,code,dtree);/* send the distance code */extra=extra_dbits[code];if(extra!==0){dist-=base_dist[code];send_bits(s,dist,extra);/* send the extra distance bits */}}/* literal or match pair ? */ /* Check that the overlay between pending_buf and d_buf+l_buf is ok: */ //Assert((uInt)(s->pending) < s->lit_bufsize + 2*lx,
//       "pendingBuf overflow");
}while(lx<s.last_lit);}send_code(s,END_BLOCK,ltree);}/* ===========================================================================
			 * Construct one Huffman tree and assigns the code bit strings and lengths.
			 * Update the total bit length for the current block.
			 * IN assertion: the field freq is set for all tree elements.
			 * OUT assertions: the fields len and code are set to the optimal bit length
			 *     and corresponding code. The length opt_len is updated; static_len is
			 *     also updated if stree is not null. The field max_code is set.
			 */function build_tree(s,desc)//    deflate_state *s;
//    tree_desc *desc; /* the tree descriptor */
{var tree=desc.dyn_tree;var stree=desc.stat_desc.static_tree;var has_stree=desc.stat_desc.has_stree;var elems=desc.stat_desc.elems;var n,m;/* iterate over heap elements */var max_code=-1;/* largest code with non zero frequency */var node;/* new node being created */ /* Construct the initial heap, with least frequent element in
			   * heap[SMALLEST]. The sons of heap[n] are heap[2*n] and heap[2*n+1].
			   * heap[0] is not used.
			   */s.heap_len=0;s.heap_max=HEAP_SIZE;for(n=0;n<elems;n++){if(tree[n*2]/*.Freq*/!==0){s.heap[++s.heap_len]=max_code=n;s.depth[n]=0;}else{tree[n*2+1]/*.Len*/=0;}}/* The pkzip format requires that at least one distance code exists,
			   * and that at least one bit should be sent even if there is only one
			   * possible code. So to avoid special checks later on we force at least
			   * two codes of non zero frequency.
			   */while(s.heap_len<2){node=s.heap[++s.heap_len]=max_code<2?++max_code:0;tree[node*2]/*.Freq*/=1;s.depth[node]=0;s.opt_len--;if(has_stree){s.static_len-=stree[node*2+1]/*.Len*/;}/* node is 0 or 1 so it does not have extra bits */}desc.max_code=max_code;/* The elements heap[heap_len/2+1 .. heap_len] are leaves of the tree,
			   * establish sub-heaps of increasing lengths:
			   */for(n=s.heap_len>>1/*int /2*/;n>=1;n--){pqdownheap(s,tree,n);}/* Construct the Huffman tree by repeatedly combining the least two
			   * frequent nodes.
			   */node=elems;/* next internal node of the tree */do{//pqremove(s, tree, n);  /* n = node of least frequency */
/*** pqremove ***/n=s.heap[1/*SMALLEST*/];s.heap[1/*SMALLEST*/]=s.heap[s.heap_len--];pqdownheap(s,tree,1/*SMALLEST*/);/***/m=s.heap[1/*SMALLEST*/];/* m = node of next least frequency */s.heap[--s.heap_max]=n;/* keep the nodes sorted by frequency */s.heap[--s.heap_max]=m;/* Create a new node father of n and m */tree[node*2]/*.Freq*/=tree[n*2]/*.Freq*/+tree[m*2]/*.Freq*/;s.depth[node]=(s.depth[n]>=s.depth[m]?s.depth[n]:s.depth[m])+1;tree[n*2+1]/*.Dad*/=tree[m*2+1]/*.Dad*/=node;/* and insert the new node in the heap */s.heap[1/*SMALLEST*/]=node++;pqdownheap(s,tree,1/*SMALLEST*/);}while(s.heap_len>=2);s.heap[--s.heap_max]=s.heap[1/*SMALLEST*/];/* At this point, the fields freq and dad are set. We can now
			   * generate the bit lengths.
			   */gen_bitlen(s,desc);/* The field len is now set, we can generate the bit codes */gen_codes(tree,max_code,s.bl_count);}/* ===========================================================================
			 * Scan a literal or distance tree to determine the frequencies of the codes
			 * in the bit length tree.
			 */function scan_tree(s,tree,max_code)//    deflate_state *s;
//    ct_data *tree;   /* the tree to be scanned */
//    int max_code;    /* and its largest code of non zero frequency */
{var n;/* iterates over all tree elements */var prevlen=-1;/* last emitted length */var curlen;/* length of current code */var nextlen=tree[0*2+1]/*.Len*/;/* length of next code */var count=0;/* repeat count of the current code */var max_count=7;/* max repeat count */var min_count=4;/* min repeat count */if(nextlen===0){max_count=138;min_count=3;}tree[(max_code+1)*2+1]/*.Len*/=0xffff;/* guard */for(n=0;n<=max_code;n++){curlen=nextlen;nextlen=tree[(n+1)*2+1]/*.Len*/;if(++count<max_count&&curlen===nextlen){continue;}else if(count<min_count){s.bl_tree[curlen*2]/*.Freq*/+=count;}else if(curlen!==0){if(curlen!==prevlen){s.bl_tree[curlen*2]/*.Freq*/++;}s.bl_tree[REP_3_6*2]/*.Freq*/++;}else if(count<=10){s.bl_tree[REPZ_3_10*2]/*.Freq*/++;}else{s.bl_tree[REPZ_11_138*2]/*.Freq*/++;}count=0;prevlen=curlen;if(nextlen===0){max_count=138;min_count=3;}else if(curlen===nextlen){max_count=6;min_count=3;}else{max_count=7;min_count=4;}}}/* ===========================================================================
			 * Send a literal or distance tree in compressed form, using the codes in
			 * bl_tree.
			 */function send_tree(s,tree,max_code)//    deflate_state *s;
//    ct_data *tree; /* the tree to be scanned */
//    int max_code;       /* and its largest code of non zero frequency */
{var n;/* iterates over all tree elements */var prevlen=-1;/* last emitted length */var curlen;/* length of current code */var nextlen=tree[0*2+1]/*.Len*/;/* length of next code */var count=0;/* repeat count of the current code */var max_count=7;/* max repeat count */var min_count=4;/* min repeat count */ /* tree[max_code+1].Len = -1; */ /* guard already set */if(nextlen===0){max_count=138;min_count=3;}for(n=0;n<=max_code;n++){curlen=nextlen;nextlen=tree[(n+1)*2+1]/*.Len*/;if(++count<max_count&&curlen===nextlen){continue;}else if(count<min_count){do{send_code(s,curlen,s.bl_tree);}while(--count!==0);}else if(curlen!==0){if(curlen!==prevlen){send_code(s,curlen,s.bl_tree);count--;}//Assert(count >= 3 && count <= 6, " 3_6?");
send_code(s,REP_3_6,s.bl_tree);send_bits(s,count-3,2);}else if(count<=10){send_code(s,REPZ_3_10,s.bl_tree);send_bits(s,count-3,3);}else{send_code(s,REPZ_11_138,s.bl_tree);send_bits(s,count-11,7);}count=0;prevlen=curlen;if(nextlen===0){max_count=138;min_count=3;}else if(curlen===nextlen){max_count=6;min_count=3;}else{max_count=7;min_count=4;}}}/* ===========================================================================
			 * Construct the Huffman tree for the bit lengths and return the index in
			 * bl_order of the last bit length code to send.
			 */function build_bl_tree(s){var max_blindex;/* index of last bit length code of non zero freq */ /* Determine the bit length frequencies for literal and distance trees */scan_tree(s,s.dyn_ltree,s.l_desc.max_code);scan_tree(s,s.dyn_dtree,s.d_desc.max_code);/* Build the bit length tree: */build_tree(s,s.bl_desc);/* opt_len now includes the length of the tree representations, except
			   * the lengths of the bit lengths codes and the 5+5+4 bits for the counts.
			   */ /* Determine the number of bit length codes to send. The pkzip format
			   * requires that at least 4 bit length codes be sent. (appnote.txt says
			   * 3 but the actual value used is 4.)
			   */for(max_blindex=BL_CODES-1;max_blindex>=3;max_blindex--){if(s.bl_tree[bl_order[max_blindex]*2+1]/*.Len*/!==0){break;}}/* Update opt_len to include the bit length tree and counts */s.opt_len+=3*(max_blindex+1)+5+5+4;//Tracev((stderr, "\ndyn trees: dyn %ld, stat %ld",
//        s->opt_len, s->static_len));
return max_blindex;}/* ===========================================================================
			 * Send the header for a block using dynamic Huffman trees: the counts, the
			 * lengths of the bit length codes, the literal tree and the distance tree.
			 * IN assertion: lcodes >= 257, dcodes >= 1, blcodes >= 4.
			 */function send_all_trees(s,lcodes,dcodes,blcodes)//    deflate_state *s;
//    int lcodes, dcodes, blcodes; /* number of codes for each tree */
{var rank;/* index in bl_order */ //Assert (lcodes >= 257 && dcodes >= 1 && blcodes >= 4, "not enough codes");
//Assert (lcodes <= L_CODES && dcodes <= D_CODES && blcodes <= BL_CODES,
//        "too many codes");
//Tracev((stderr, "\nbl counts: "));
send_bits(s,lcodes-257,5);/* not +255 as stated in appnote.txt */send_bits(s,dcodes-1,5);send_bits(s,blcodes-4,4);/* not -3 as stated in appnote.txt */for(rank=0;rank<blcodes;rank++){//Tracev((stderr, "\nbl code %2d ", bl_order[rank]));
send_bits(s,s.bl_tree[bl_order[rank]*2+1]/*.Len*/,3);}//Tracev((stderr, "\nbl tree: sent %ld", s->bits_sent));
send_tree(s,s.dyn_ltree,lcodes-1);/* literal tree */ //Tracev((stderr, "\nlit tree: sent %ld", s->bits_sent));
send_tree(s,s.dyn_dtree,dcodes-1);/* distance tree */ //Tracev((stderr, "\ndist tree: sent %ld", s->bits_sent));
}/* ===========================================================================
			 * Check if the data type is TEXT or BINARY, using the following algorithm:
			 * - TEXT if the two conditions below are satisfied:
			 *    a) There are no non-portable control characters belonging to the
			 *       "black list" (0..6, 14..25, 28..31).
			 *    b) There is at least one printable character belonging to the
			 *       "white list" (9 {TAB}, 10 {LF}, 13 {CR}, 32..255).
			 * - BINARY otherwise.
			 * - The following partially-portable control characters form a
			 *   "gray list" that is ignored in this detection algorithm:
			 *   (7 {BEL}, 8 {BS}, 11 {VT}, 12 {FF}, 26 {SUB}, 27 {ESC}).
			 * IN assertion: the fields Freq of dyn_ltree are set.
			 */function detect_data_type(s){/* black_mask is the bit mask of black-listed bytes
			   * set bits 0..6, 14..25, and 28..31
			   * 0xf3ffc07f = binary 11110011111111111100000001111111
			   */var black_mask=0xf3ffc07f;var n;/* Check for non-textual ("black-listed") bytes. */for(n=0;n<=31;n++,black_mask>>>=1){if(black_mask&1&&s.dyn_ltree[n*2]/*.Freq*/!==0){return Z_BINARY;}}/* Check for textual ("white-listed") bytes. */if(s.dyn_ltree[9*2]/*.Freq*/!==0||s.dyn_ltree[10*2]/*.Freq*/!==0||s.dyn_ltree[13*2]/*.Freq*/!==0){return Z_TEXT;}for(n=32;n<LITERALS;n++){if(s.dyn_ltree[n*2]/*.Freq*/!==0){return Z_TEXT;}}/* There are no "black-listed" or "white-listed" bytes:
			   * this stream either is empty or has tolerated ("gray-listed") bytes only.
			   */return Z_BINARY;}var static_init_done=false;/* ===========================================================================
			 * Initialize the tree data structures for a new zlib stream.
			 */function _tr_init(s){if(!static_init_done){tr_static_init();static_init_done=true;}s.l_desc=new TreeDesc(s.dyn_ltree,static_l_desc);s.d_desc=new TreeDesc(s.dyn_dtree,static_d_desc);s.bl_desc=new TreeDesc(s.bl_tree,static_bl_desc);s.bi_buf=0;s.bi_valid=0;/* Initialize the first block of the first file: */init_block(s);}/* ===========================================================================
			 * Send a stored block
			 */function _tr_stored_block(s,buf,stored_len,last)//DeflateState *s;
//charf *buf;       /* input block */
//ulg stored_len;   /* length of input block */
//int last;         /* one if this is the last block for a file */
{send_bits(s,(STORED_BLOCK<<1)+(last?1:0),3);/* send block type */copy_block(s,buf,stored_len,true);/* with header */}/* ===========================================================================
			 * Send one empty static block to give enough lookahead for inflate.
			 * This takes 10 bits, of which 7 may remain in the bit buffer.
			 */function _tr_align(s){send_bits(s,STATIC_TREES<<1,3);send_code(s,END_BLOCK,static_ltree);bi_flush(s);}/* ===========================================================================
			 * Determine the best encoding for the current block: dynamic trees, static
			 * trees or store, and output the encoded block to the zip file.
			 */function _tr_flush_block(s,buf,stored_len,last)//DeflateState *s;
//charf *buf;       /* input block, or NULL if too old */
//ulg stored_len;   /* length of input block */
//int last;         /* one if this is the last block for a file */
{var opt_lenb,static_lenb;/* opt_len and static_len in bytes */var max_blindex=0;/* index of last bit length code of non zero freq */ /* Build the Huffman trees unless a stored block is forced */if(s.level>0){/* Check if the file is binary or text */if(s.strm.data_type===Z_UNKNOWN){s.strm.data_type=detect_data_type(s);}/* Construct the literal and distance trees */build_tree(s,s.l_desc);// Tracev((stderr, "\nlit data: dyn %ld, stat %ld", s->opt_len,
//        s->static_len));
build_tree(s,s.d_desc);// Tracev((stderr, "\ndist data: dyn %ld, stat %ld", s->opt_len,
//        s->static_len));
/* At this point, opt_len and static_len are the total bit lengths of
			     * the compressed block data, excluding the tree representations.
			     */ /* Build the bit length tree for the above two trees, and get the index
			     * in bl_order of the last bit length code to send.
			     */max_blindex=build_bl_tree(s);/* Determine the best encoding. Compute the block lengths in bytes. */opt_lenb=s.opt_len+3+7>>>3;static_lenb=s.static_len+3+7>>>3;// Tracev((stderr, "\nopt %lu(%lu) stat %lu(%lu) stored %lu lit %u ",
//        opt_lenb, s->opt_len, static_lenb, s->static_len, stored_len,
//        s->last_lit));
if(static_lenb<=opt_lenb){opt_lenb=static_lenb;}}else{// Assert(buf != (char*)0, "lost buf");
opt_lenb=static_lenb=stored_len+5;/* force a stored block */}if(stored_len+4<=opt_lenb&&buf!==-1){/* 4: two words for the lengths */ /* The test buf != NULL is only necessary if LIT_BUFSIZE > WSIZE.
			     * Otherwise we can't have processed more than WSIZE input bytes since
			     * the last block flush, because compression would have been
			     * successful. If LIT_BUFSIZE <= WSIZE, it is never too late to
			     * transform a block into a stored block.
			     */_tr_stored_block(s,buf,stored_len,last);}else if(s.strategy===Z_FIXED||static_lenb===opt_lenb){send_bits(s,(STATIC_TREES<<1)+(last?1:0),3);compress_block(s,static_ltree,static_dtree);}else{send_bits(s,(DYN_TREES<<1)+(last?1:0),3);send_all_trees(s,s.l_desc.max_code+1,s.d_desc.max_code+1,max_blindex+1);compress_block(s,s.dyn_ltree,s.dyn_dtree);}// Assert (s->compressed_len == s->bits_sent, "bad compressed size");
/* The above check is made mod 2^32, for files larger than 512 MB
			   * and uLong implemented on 32 bits.
			   */init_block(s);if(last){bi_windup(s);}// Tracev((stderr,"\ncomprlen %lu(%lu) ", s->compressed_len>>3,
//       s->compressed_len-7*last));
}/* ===========================================================================
			 * Save the match info and tally the frequency counts. Return true if
			 * the current block must be flushed.
			 */function _tr_tally(s,dist,lc)//    deflate_state *s;
//    unsigned dist;  /* distance of matched string */
//    unsigned lc;    /* match length-MIN_MATCH or unmatched char (if dist==0) */
{//var out_length, in_length, dcode;
s.pending_buf[s.d_buf+s.last_lit*2]=dist>>>8&0xff;s.pending_buf[s.d_buf+s.last_lit*2+1]=dist&0xff;s.pending_buf[s.l_buf+s.last_lit]=lc&0xff;s.last_lit++;if(dist===0){/* lc is the unmatched char */s.dyn_ltree[lc*2]/*.Freq*/++;}else{s.matches++;/* Here, lc is the match length - MIN_MATCH */dist--;/* dist = match distance - 1 */ //Assert((ush)dist < (ush)MAX_DIST(s) &&
//       (ush)lc <= (ush)(MAX_MATCH-MIN_MATCH) &&
//       (ush)d_code(dist) < (ush)D_CODES,  "_tr_tally: bad match");
s.dyn_ltree[(_length_code[lc]+LITERALS+1)*2]/*.Freq*/++;s.dyn_dtree[d_code(dist)*2]/*.Freq*/++;}// (!) This block is disabled in zlib defailts,
// don't enable it for binary compatibility
//#ifdef TRUNCATE_BLOCK
//  /* Try to guess if it is profitable to stop the current block here */
//  if ((s.last_lit & 0x1fff) === 0 && s.level > 2) {
//    /* Compute an upper bound for the compressed length */
//    out_length = s.last_lit*8;
//    in_length = s.strstart - s.block_start;
//
//    for (dcode = 0; dcode < D_CODES; dcode++) {
//      out_length += s.dyn_dtree[dcode*2]/*.Freq*/ * (5 + extra_dbits[dcode]);
//    }
//    out_length >>>= 3;
//    //Tracev((stderr,"\nlast_lit %u, in %ld, out ~%ld(%ld%%) ",
//    //       s->last_lit, in_length, out_length,
//    //       100L - out_length*100L/in_length));
//    if (s.matches < (s.last_lit>>1)/*int /2*/ && out_length < (in_length>>1)/*int /2*/) {
//      return true;
//    }
//  }
//#endif
return s.last_lit===s.lit_bufsize-1;/* We avoid equality with lit_bufsize because of wraparound at 64K
			   * on 16 bit machines and because stored blocks are restricted to
			   * 64K-1 bytes.
			   */}exports._tr_init=_tr_init;exports._tr_stored_block=_tr_stored_block;exports._tr_flush_block=_tr_flush_block;exports._tr_tally=_tr_tally;exports._tr_align=_tr_align;},{"../utils/common":41}],53:[function(require,module,exports){// (C) 1995-2013 Jean-loup Gailly and Mark Adler
// (C) 2014-2017 Vitaly Puzrin and Andrey Tupitsin
//
// This software is provided 'as-is', without any express or implied
// warranty. In no event will the authors be held liable for any damages
// arising from the use of this software.
//
// Permission is granted to anyone to use this software for any purpose,
// including commercial applications, and to alter it and redistribute it
// freely, subject to the following restrictions:
//
// 1. The origin of this software must not be misrepresented; you must not
//   claim that you wrote the original software. If you use this software
//   in a product, an acknowledgment in the product documentation would be
//   appreciated but is not required.
// 2. Altered source versions must be plainly marked as such, and must not be
//   misrepresented as being the original software.
// 3. This notice may not be removed or altered from any source distribution.
function ZStream(){/* next input byte */this.input=null;// JS specific, because we have no pointers
this.next_in=0;/* number of bytes available at input */this.avail_in=0;/* total number of input bytes read so far */this.total_in=0;/* next output byte should be put there */this.output=null;// JS specific, because we have no pointers
this.next_out=0;/* remaining free space at output */this.avail_out=0;/* total number of bytes output so far */this.total_out=0;/* last error message, NULL if no error */this.msg=''/*Z_NULL*/;/* not visible by applications */this.state=null;/* best guess about the data type: binary or text */this.data_type=2/*Z_UNKNOWN*/;/* adler32 value of the uncompressed data */this.adler=0;}module.exports=ZStream;},{}],54:[function(require,module,exports){module.exports=typeof setImmediate==='function'?setImmediate:function setImmediate(){var args=[].slice.apply(arguments);args.splice(1,0,0);setTimeout.apply(null,args);};},{}]},{},[10])(10);});})(jszip);Object.defineProperty(archive,"__esModule",{value:true});archive.default=void 0;var _core$3=core;var _request$1=_interopRequireDefault$5(request$1);var _mime$1=_interopRequireDefault$5(mime);var _path$2=_interopRequireDefault$5(path$1);var _jszip=_interopRequireDefault$5(jszip.exports);function _interopRequireDefault$5(obj){return obj&&obj.__esModule?obj:{default:obj};}/**
			 * Handles Unzipping a requesting files from an Epub Archive
			 * @class
			 */var Archive=/*#__PURE__*/function(){function Archive(){_classCallCheck3(this,Archive);this.zip=undefined;this.urlCache={};this.checkRequirements();}/**
			   * Checks to see if JSZip exists in global namspace,
			   * Requires JSZip if it isn't there
			   * @private
			   */_createClass3(Archive,[{key:"checkRequirements",value:function checkRequirements(){try{this.zip=new _jszip.default();}catch(e){throw new Error("JSZip lib not loaded");}}/**
			   * Open an archive
			   * @param  {binary} input
			   * @param  {boolean} [isBase64] tells JSZip if the input data is base64 encoded
			   * @return {Promise} zipfile
			   */},{key:"open",value:function open(input,isBase64){return this.zip.loadAsync(input,{"base64":isBase64});}/**
			   * Load and Open an archive
			   * @param  {string} zipUrl
			   * @param  {boolean} [isBase64] tells JSZip if the input data is base64 encoded
			   * @return {Promise} zipfile
			   */},{key:"openUrl",value:function openUrl(zipUrl,isBase64){return(0,_request$1.default)(zipUrl,"binary").then(function(data){return this.zip.loadAsync(data,{"base64":isBase64});}.bind(this));}/**
			   * Request a url from the archive
			   * @param  {string} url  a url to request from the archive
			   * @param  {string} [type] specify the type of the returned result
			   * @return {Promise<Blob | string | JSON | Document | XMLDocument>}
			   */},{key:"request",value:function request(url,type){var deferred=new _core$3.defer();var response;var path=new _path$2.default(url);// If type isn't set, determine it from the file extension
if(!type){type=path.extension;}if(type=="blob"){response=this.getBlob(url);}else{response=this.getText(url);}if(response){response.then(function(r){var result=this.handleResponse(r,type);deferred.resolve(result);}.bind(this));}else{deferred.reject({message:"File not found in the epub: "+url,stack:new Error().stack});}return deferred.promise;}/**
			   * Handle the response from request
			   * @private
			   * @param  {any} response
			   * @param  {string} [type]
			   * @return {any} the parsed result
			   */},{key:"handleResponse",value:function handleResponse(response,type){var r;if(type=="json"){r=JSON.parse(response);}else if((0,_core$3.isXml)(type)){r=(0,_core$3.parse)(response,"text/xml");}else if(type=="xhtml"){r=(0,_core$3.parse)(response,"application/xhtml+xml");}else if(type=="html"||type=="htm"){r=(0,_core$3.parse)(response,"text/html");}else{r=response;}return r;}/**
			   * Get a Blob from Archive by Url
			   * @param  {string} url
			   * @param  {string} [mimeType]
			   * @return {Blob}
			   */},{key:"getBlob",value:function getBlob(url,mimeType){var decodededUrl=window.decodeURIComponent(url.substr(1));// Remove first slash
var entry=this.zip.file(decodededUrl);if(entry){mimeType=mimeType||_mime$1.default.lookup(entry.name);return entry.async("uint8array").then(function(uint8array){return new Blob([uint8array],{type:mimeType});});}}/**
			   * Get Text from Archive by Url
			   * @param  {string} url
			   * @param  {string} [encoding]
			   * @return {string}
			   */},{key:"getText",value:function getText(url,encoding){var decodededUrl=window.decodeURIComponent(url.substr(1));// Remove first slash
var entry=this.zip.file(decodededUrl);if(entry){return entry.async("string").then(function(text){return text;});}}/**
			   * Get a base64 encoded result from Archive by Url
			   * @param  {string} url
			   * @param  {string} [mimeType]
			   * @return {string} base64 encoded
			   */},{key:"getBase64",value:function getBase64(url,mimeType){var decodededUrl=window.decodeURIComponent(url.substr(1));// Remove first slash
var entry=this.zip.file(decodededUrl);if(entry){mimeType=mimeType||_mime$1.default.lookup(entry.name);return entry.async("base64").then(function(data){return"data:"+mimeType+";base64,"+data;});}}/**
			   * Create a Url from an unarchived item
			   * @param  {string} url
			   * @param  {object} [options.base64] use base64 encoding or blob url
			   * @return {Promise} url promise with Url string
			   */},{key:"createUrl",value:function createUrl(url,options){var deferred=new _core$3.defer();var _URL=window.URL||window.webkitURL||window.mozURL;var tempUrl;var response;var useBase64=options&&options.base64;if(url in this.urlCache){deferred.resolve(this.urlCache[url]);return deferred.promise;}if(useBase64){response=this.getBase64(url);if(response){response.then(function(tempUrl){this.urlCache[url]=tempUrl;deferred.resolve(tempUrl);}.bind(this));}}else{response=this.getBlob(url);if(response){response.then(function(blob){tempUrl=_URL.createObjectURL(blob);this.urlCache[url]=tempUrl;deferred.resolve(tempUrl);}.bind(this));}}if(!response){deferred.reject({message:"File not found in the epub: "+url,stack:new Error().stack});}return deferred.promise;}/**
			   * Revoke Temp Url for a archive item
			   * @param  {string} url url of the item in the archive
			   */},{key:"revokeUrl",value:function revokeUrl(url){var _URL=window.URL||window.webkitURL||window.mozURL;var fromCache=this.urlCache[url];if(fromCache)_URL.revokeObjectURL(fromCache);}},{key:"destroy",value:function destroy(){var _URL=window.URL||window.webkitURL||window.mozURL;for(var fromCache in this.urlCache){_URL.revokeObjectURL(fromCache);}this.zip=undefined;this.urlCache={};}}]);return Archive;}();var _default$8=Archive;archive.default=_default$8;var store={};var localforage={exports:{}};/*!
			    localForage -- Offline Storage, Improved
			    Version 1.10.0
			    https://localforage.github.io/localForage
			    (c) 2013-2017 Mozilla, Apache License 2.0
			*/(function(module,exports){(function(f){{module.exports=f();}})(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof commonjsRequire=="function"&&commonjsRequire;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f;}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e);},l,l.exports,e,t,n,r);}return n[o].exports;}var i=typeof commonjsRequire=="function"&&commonjsRequire;for(var o=0;o<r.length;o++){s(r[o]);}return s;}({1:[function(_dereq_,module,exports){(function(global){var Mutation=global.MutationObserver||global.WebKitMutationObserver;var scheduleDrain;{if(Mutation){var called=0;var observer=new Mutation(nextTick);var element=global.document.createTextNode('');observer.observe(element,{characterData:true});scheduleDrain=function scheduleDrain(){element.data=called=++called%2;};}else if(!global.setImmediate&&typeof global.MessageChannel!=='undefined'){var channel=new global.MessageChannel();channel.port1.onmessage=nextTick;scheduleDrain=function scheduleDrain(){channel.port2.postMessage(0);};}else if('document'in global&&'onreadystatechange'in global.document.createElement('script')){scheduleDrain=function scheduleDrain(){// Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted
// into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.
var scriptEl=global.document.createElement('script');scriptEl.onreadystatechange=function(){nextTick();scriptEl.onreadystatechange=null;scriptEl.parentNode.removeChild(scriptEl);scriptEl=null;};global.document.documentElement.appendChild(scriptEl);};}else{scheduleDrain=function scheduleDrain(){setTimeout(nextTick,0);};}}var draining;var queue=[];//named nextTick for less confusing stack traces
function nextTick(){draining=true;var i,oldQueue;var len=queue.length;while(len){oldQueue=queue;queue=[];i=-1;while(++i<len){oldQueue[i]();}len=queue.length;}draining=false;}module.exports=immediate;function immediate(task){if(queue.push(task)===1&&!draining){scheduleDrain();}}}).call(this,typeof commonjsGlobal!=="undefined"?commonjsGlobal:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{});},{}],2:[function(_dereq_,module,exports){var immediate=_dereq_(1);/* istanbul ignore next */function INTERNAL(){}var handlers={};var REJECTED=['REJECTED'];var FULFILLED=['FULFILLED'];var PENDING=['PENDING'];module.exports=Promise;function Promise(resolver){if(typeof resolver!=='function'){throw new TypeError('resolver must be a function');}this.state=PENDING;this.queue=[];this.outcome=void 0;if(resolver!==INTERNAL){safelyResolveThenable(this,resolver);}}Promise.prototype["catch"]=function(onRejected){return this.then(null,onRejected);};Promise.prototype.then=function(onFulfilled,onRejected){if(typeof onFulfilled!=='function'&&this.state===FULFILLED||typeof onRejected!=='function'&&this.state===REJECTED){return this;}var promise=new this.constructor(INTERNAL);if(this.state!==PENDING){var resolver=this.state===FULFILLED?onFulfilled:onRejected;unwrap(promise,resolver,this.outcome);}else{this.queue.push(new QueueItem(promise,onFulfilled,onRejected));}return promise;};function QueueItem(promise,onFulfilled,onRejected){this.promise=promise;if(typeof onFulfilled==='function'){this.onFulfilled=onFulfilled;this.callFulfilled=this.otherCallFulfilled;}if(typeof onRejected==='function'){this.onRejected=onRejected;this.callRejected=this.otherCallRejected;}}QueueItem.prototype.callFulfilled=function(value){handlers.resolve(this.promise,value);};QueueItem.prototype.otherCallFulfilled=function(value){unwrap(this.promise,this.onFulfilled,value);};QueueItem.prototype.callRejected=function(value){handlers.reject(this.promise,value);};QueueItem.prototype.otherCallRejected=function(value){unwrap(this.promise,this.onRejected,value);};function unwrap(promise,func,value){immediate(function(){var returnValue;try{returnValue=func(value);}catch(e){return handlers.reject(promise,e);}if(returnValue===promise){handlers.reject(promise,new TypeError('Cannot resolve promise with itself'));}else{handlers.resolve(promise,returnValue);}});}handlers.resolve=function(self,value){var result=tryCatch(getThen,value);if(result.status==='error'){return handlers.reject(self,result.value);}var thenable=result.value;if(thenable){safelyResolveThenable(self,thenable);}else{self.state=FULFILLED;self.outcome=value;var i=-1;var len=self.queue.length;while(++i<len){self.queue[i].callFulfilled(value);}}return self;};handlers.reject=function(self,error){self.state=REJECTED;self.outcome=error;var i=-1;var len=self.queue.length;while(++i<len){self.queue[i].callRejected(error);}return self;};function getThen(obj){// Make sure we only access the accessor once as required by the spec
var then=obj&&obj.then;if(obj&&(_typeof3(obj)==='object'||typeof obj==='function')&&typeof then==='function'){return function appyThen(){then.apply(obj,arguments);};}}function safelyResolveThenable(self,thenable){// Either fulfill, reject or reject with error
var called=false;function onError(value){if(called){return;}called=true;handlers.reject(self,value);}function onSuccess(value){if(called){return;}called=true;handlers.resolve(self,value);}function tryToUnwrap(){thenable(onSuccess,onError);}var result=tryCatch(tryToUnwrap);if(result.status==='error'){onError(result.value);}}function tryCatch(func,value){var out={};try{out.value=func(value);out.status='success';}catch(e){out.status='error';out.value=e;}return out;}Promise.resolve=resolve;function resolve(value){if(value instanceof this){return value;}return handlers.resolve(new this(INTERNAL),value);}Promise.reject=reject;function reject(reason){var promise=new this(INTERNAL);return handlers.reject(promise,reason);}Promise.all=all;function all(iterable){var self=this;if(Object.prototype.toString.call(iterable)!=='[object Array]'){return this.reject(new TypeError('must be an array'));}var len=iterable.length;var called=false;if(!len){return this.resolve([]);}var values=new Array(len);var resolved=0;var i=-1;var promise=new this(INTERNAL);while(++i<len){allResolver(iterable[i],i);}return promise;function allResolver(value,i){self.resolve(value).then(resolveFromAll,function(error){if(!called){called=true;handlers.reject(promise,error);}});function resolveFromAll(outValue){values[i]=outValue;if(++resolved===len&&!called){called=true;handlers.resolve(promise,values);}}}}Promise.race=race;function race(iterable){var self=this;if(Object.prototype.toString.call(iterable)!=='[object Array]'){return this.reject(new TypeError('must be an array'));}var len=iterable.length;var called=false;if(!len){return this.resolve([]);}var i=-1;var promise=new this(INTERNAL);while(++i<len){resolver(iterable[i]);}return promise;function resolver(value){self.resolve(value).then(function(response){if(!called){called=true;handlers.resolve(promise,response);}},function(error){if(!called){called=true;handlers.reject(promise,error);}});}}},{"1":1}],3:[function(_dereq_,module,exports){(function(global){if(typeof global.Promise!=='function'){global.Promise=_dereq_(2);}}).call(this,typeof commonjsGlobal!=="undefined"?commonjsGlobal:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{});},{"2":2}],4:[function(_dereq_,module,exports){var _typeof=typeof Symbol==="function"&&_typeof3(Symbol.iterator)==="symbol"?function(obj){return _typeof3(obj);}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof3(obj);};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function getIDB(){/* global indexedDB,webkitIndexedDB,mozIndexedDB,OIndexedDB,msIndexedDB */try{if(typeof indexedDB!=='undefined'){return indexedDB;}if(typeof webkitIndexedDB!=='undefined'){return webkitIndexedDB;}if(typeof mozIndexedDB!=='undefined'){return mozIndexedDB;}if(typeof OIndexedDB!=='undefined'){return OIndexedDB;}if(typeof msIndexedDB!=='undefined'){return msIndexedDB;}}catch(e){return;}}var idb=getIDB();function isIndexedDBValid(){try{// Initialize IndexedDB; fall back to vendor-prefixed versions
// if needed.
if(!idb||!idb.open){return false;}// We mimic PouchDB here;
//
// We test for openDatabase because IE Mobile identifies itself
// as Safari. Oh the lulz...
var isSafari=typeof openDatabase!=='undefined'&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform);var hasFetch=typeof fetch==='function'&&fetch.toString().indexOf('[native code')!==-1;// Safari <10.1 does not meet our requirements for IDB support
// (see: https://github.com/pouchdb/pouchdb/issues/5572).
// Safari 10.1 shipped with fetch, we can use that to detect it.
// Note: this creates issues with `window.fetch` polyfills and
// overrides; see:
// https://github.com/localForage/localForage/issues/856
return(!isSafari||hasFetch)&&typeof indexedDB!=='undefined'&&// some outdated implementations of IDB that appear on Samsung
// and HTC Android devices <4.4 are missing IDBKeyRange
// See: https://github.com/mozilla/localForage/issues/128
// See: https://github.com/mozilla/localForage/issues/272
typeof IDBKeyRange!=='undefined';}catch(e){return false;}}// Abstracts constructing a Blob object, so it also works in older
// browsers that don't support the native Blob constructor. (i.e.
// old QtWebKit versions, at least).
// Abstracts constructing a Blob object, so it also works in older
// browsers that don't support the native Blob constructor. (i.e.
// old QtWebKit versions, at least).
function createBlob(parts,properties){/* global BlobBuilder,MSBlobBuilder,MozBlobBuilder,WebKitBlobBuilder */parts=parts||[];properties=properties||{};try{return new Blob(parts,properties);}catch(e){if(e.name!=='TypeError'){throw e;}var Builder=typeof BlobBuilder!=='undefined'?BlobBuilder:typeof MSBlobBuilder!=='undefined'?MSBlobBuilder:typeof MozBlobBuilder!=='undefined'?MozBlobBuilder:WebKitBlobBuilder;var builder=new Builder();for(var i=0;i<parts.length;i+=1){builder.append(parts[i]);}return builder.getBlob(properties.type);}}// This is CommonJS because lie is an external dependency, so Rollup
// can just ignore it.
if(typeof Promise==='undefined'){// In the "nopromises" build this will just throw if you don't have
// a global promise object, but it would throw anyway later.
_dereq_(3);}var Promise$1=Promise;function executeCallback(promise,callback){if(callback){promise.then(function(result){callback(null,result);},function(error){callback(error);});}}function executeTwoCallbacks(promise,callback,errorCallback){if(typeof callback==='function'){promise.then(callback);}if(typeof errorCallback==='function'){promise["catch"](errorCallback);}}function normalizeKey(key){// Cast the key to a string, as that's all we can set as a key.
if(typeof key!=='string'){console.warn(key+' used as a key, but it is not a string.');key=String(key);}return key;}function getCallback(){if(arguments.length&&typeof arguments[arguments.length-1]==='function'){return arguments[arguments.length-1];}}// Some code originally from async_storage.js in
// [Gaia](https://github.com/mozilla-b2g/gaia).
var DETECT_BLOB_SUPPORT_STORE='local-forage-detect-blob-support';var supportsBlobs=void 0;var dbContexts={};var toString=Object.prototype.toString;// Transaction Modes
var READ_ONLY='readonly';var READ_WRITE='readwrite';// Transform a binary string to an array buffer, because otherwise
// weird stuff happens when you try to work with the binary string directly.
// It is known.
// From http://stackoverflow.com/questions/14967647/ (continues on next line)
// encode-decode-image-with-base64-breaks-image (2013-04-21)
function _binStringToArrayBuffer(bin){var length=bin.length;var buf=new ArrayBuffer(length);var arr=new Uint8Array(buf);for(var i=0;i<length;i++){arr[i]=bin.charCodeAt(i);}return buf;}//
// Blobs are not supported in all versions of IndexedDB, notably
// Chrome <37 and Android <5. In those versions, storing a blob will throw.
//
// Various other blob bugs exist in Chrome v37-42 (inclusive).
// Detecting them is expensive and confusing to users, and Chrome 37-42
// is at very low usage worldwide, so we do a hacky userAgent check instead.
//
// content-type bug: https://code.google.com/p/chromium/issues/detail?id=408120
// 404 bug: https://code.google.com/p/chromium/issues/detail?id=447916
// FileReader bug: https://code.google.com/p/chromium/issues/detail?id=447836
//
// Code borrowed from PouchDB. See:
// https://github.com/pouchdb/pouchdb/blob/master/packages/node_modules/pouchdb-adapter-idb/src/blobSupport.js
//
function _checkBlobSupportWithoutCaching(idb){return new Promise$1(function(resolve){var txn=idb.transaction(DETECT_BLOB_SUPPORT_STORE,READ_WRITE);var blob=createBlob(['']);txn.objectStore(DETECT_BLOB_SUPPORT_STORE).put(blob,'key');txn.onabort=function(e){// If the transaction aborts now its due to not being able to
// write to the database, likely due to the disk being full
e.preventDefault();e.stopPropagation();resolve(false);};txn.oncomplete=function(){var matchedChrome=navigator.userAgent.match(/Chrome\/(\d+)/);var matchedEdge=navigator.userAgent.match(/Edge\//);// MS Edge pretends to be Chrome 42:
// https://msdn.microsoft.com/en-us/library/hh869301%28v=vs.85%29.aspx
resolve(matchedEdge||!matchedChrome||parseInt(matchedChrome[1],10)>=43);};})["catch"](function(){return false;// error, so assume unsupported
});}function _checkBlobSupport(idb){if(typeof supportsBlobs==='boolean'){return Promise$1.resolve(supportsBlobs);}return _checkBlobSupportWithoutCaching(idb).then(function(value){supportsBlobs=value;return supportsBlobs;});}function _deferReadiness(dbInfo){var dbContext=dbContexts[dbInfo.name];// Create a deferred object representing the current database operation.
var deferredOperation={};deferredOperation.promise=new Promise$1(function(resolve,reject){deferredOperation.resolve=resolve;deferredOperation.reject=reject;});// Enqueue the deferred operation.
dbContext.deferredOperations.push(deferredOperation);// Chain its promise to the database readiness.
if(!dbContext.dbReady){dbContext.dbReady=deferredOperation.promise;}else{dbContext.dbReady=dbContext.dbReady.then(function(){return deferredOperation.promise;});}}function _advanceReadiness(dbInfo){var dbContext=dbContexts[dbInfo.name];// Dequeue a deferred operation.
var deferredOperation=dbContext.deferredOperations.pop();// Resolve its promise (which is part of the database readiness
// chain of promises).
if(deferredOperation){deferredOperation.resolve();return deferredOperation.promise;}}function _rejectReadiness(dbInfo,err){var dbContext=dbContexts[dbInfo.name];// Dequeue a deferred operation.
var deferredOperation=dbContext.deferredOperations.pop();// Reject its promise (which is part of the database readiness
// chain of promises).
if(deferredOperation){deferredOperation.reject(err);return deferredOperation.promise;}}function _getConnection(dbInfo,upgradeNeeded){return new Promise$1(function(resolve,reject){dbContexts[dbInfo.name]=dbContexts[dbInfo.name]||createDbContext();if(dbInfo.db){if(upgradeNeeded){_deferReadiness(dbInfo);dbInfo.db.close();}else{return resolve(dbInfo.db);}}var dbArgs=[dbInfo.name];if(upgradeNeeded){dbArgs.push(dbInfo.version);}var openreq=idb.open.apply(idb,dbArgs);if(upgradeNeeded){openreq.onupgradeneeded=function(e){var db=openreq.result;try{db.createObjectStore(dbInfo.storeName);if(e.oldVersion<=1){// Added when support for blob shims was added
db.createObjectStore(DETECT_BLOB_SUPPORT_STORE);}}catch(ex){if(ex.name==='ConstraintError'){console.warn('The database "'+dbInfo.name+'"'+' has been upgraded from version '+e.oldVersion+' to version '+e.newVersion+', but the storage "'+dbInfo.storeName+'" already exists.');}else{throw ex;}}};}openreq.onerror=function(e){e.preventDefault();reject(openreq.error);};openreq.onsuccess=function(){var db=openreq.result;db.onversionchange=function(e){// Triggered when the database is modified (e.g. adding an objectStore) or
// deleted (even when initiated by other sessions in different tabs).
// Closing the connection here prevents those operations from being blocked.
// If the database is accessed again later by this instance, the connection
// will be reopened or the database recreated as needed.
e.target.close();};resolve(db);_advanceReadiness(dbInfo);};});}function _getOriginalConnection(dbInfo){return _getConnection(dbInfo,false);}function _getUpgradedConnection(dbInfo){return _getConnection(dbInfo,true);}function _isUpgradeNeeded(dbInfo,defaultVersion){if(!dbInfo.db){return true;}var isNewStore=!dbInfo.db.objectStoreNames.contains(dbInfo.storeName);var isDowngrade=dbInfo.version<dbInfo.db.version;var isUpgrade=dbInfo.version>dbInfo.db.version;if(isDowngrade){// If the version is not the default one
// then warn for impossible downgrade.
if(dbInfo.version!==defaultVersion){console.warn('The database "'+dbInfo.name+'"'+" can't be downgraded from version "+dbInfo.db.version+' to version '+dbInfo.version+'.');}// Align the versions to prevent errors.
dbInfo.version=dbInfo.db.version;}if(isUpgrade||isNewStore){// If the store is new then increment the version (if needed).
// This will trigger an "upgradeneeded" event which is required
// for creating a store.
if(isNewStore){var incVersion=dbInfo.db.version+1;if(incVersion>dbInfo.version){dbInfo.version=incVersion;}}return true;}return false;}// encode a blob for indexeddb engines that don't support blobs
function _encodeBlob(blob){return new Promise$1(function(resolve,reject){var reader=new FileReader();reader.onerror=reject;reader.onloadend=function(e){var base64=btoa(e.target.result||'');resolve({__local_forage_encoded_blob:true,data:base64,type:blob.type});};reader.readAsBinaryString(blob);});}// decode an encoded blob
function _decodeBlob(encodedBlob){var arrayBuff=_binStringToArrayBuffer(atob(encodedBlob.data));return createBlob([arrayBuff],{type:encodedBlob.type});}// is this one of our fancy encoded blobs?
function _isEncodedBlob(value){return value&&value.__local_forage_encoded_blob;}// Specialize the default `ready()` function by making it dependent
// on the current database operations. Thus, the driver will be actually
// ready when it's been initialized (default) *and* there are no pending
// operations on the database (initiated by some other instances).
function _fullyReady(callback){var self=this;var promise=self._initReady().then(function(){var dbContext=dbContexts[self._dbInfo.name];if(dbContext&&dbContext.dbReady){return dbContext.dbReady;}});executeTwoCallbacks(promise,callback,callback);return promise;}// Try to establish a new db connection to replace the
// current one which is broken (i.e. experiencing
// InvalidStateError while creating a transaction).
function _tryReconnect(dbInfo){_deferReadiness(dbInfo);var dbContext=dbContexts[dbInfo.name];var forages=dbContext.forages;for(var i=0;i<forages.length;i++){var forage=forages[i];if(forage._dbInfo.db){forage._dbInfo.db.close();forage._dbInfo.db=null;}}dbInfo.db=null;return _getOriginalConnection(dbInfo).then(function(db){dbInfo.db=db;if(_isUpgradeNeeded(dbInfo)){// Reopen the database for upgrading.
return _getUpgradedConnection(dbInfo);}return db;}).then(function(db){// store the latest db reference
// in case the db was upgraded
dbInfo.db=dbContext.db=db;for(var i=0;i<forages.length;i++){forages[i]._dbInfo.db=db;}})["catch"](function(err){_rejectReadiness(dbInfo,err);throw err;});}// FF doesn't like Promises (micro-tasks) and IDDB store operations,
// so we have to do it with callbacks
function createTransaction(dbInfo,mode,callback,retries){if(retries===undefined){retries=1;}try{var tx=dbInfo.db.transaction(dbInfo.storeName,mode);callback(null,tx);}catch(err){if(retries>0&&(!dbInfo.db||err.name==='InvalidStateError'||err.name==='NotFoundError')){return Promise$1.resolve().then(function(){if(!dbInfo.db||err.name==='NotFoundError'&&!dbInfo.db.objectStoreNames.contains(dbInfo.storeName)&&dbInfo.version<=dbInfo.db.version){// increase the db version, to create the new ObjectStore
if(dbInfo.db){dbInfo.version=dbInfo.db.version+1;}// Reopen the database for upgrading.
return _getUpgradedConnection(dbInfo);}}).then(function(){return _tryReconnect(dbInfo).then(function(){createTransaction(dbInfo,mode,callback,retries-1);});})["catch"](callback);}callback(err);}}function createDbContext(){return{// Running localForages sharing a database.
forages:[],// Shared database.
db:null,// Database readiness (promise).
dbReady:null,// Deferred operations on the database.
deferredOperations:[]};}// Open the IndexedDB database (automatically creates one if one didn't
// previously exist), using any options set in the config.
function _initStorage(options){var self=this;var dbInfo={db:null};if(options){for(var i in options){dbInfo[i]=options[i];}}// Get the current context of the database;
var dbContext=dbContexts[dbInfo.name];// ...or create a new context.
if(!dbContext){dbContext=createDbContext();// Register the new context in the global container.
dbContexts[dbInfo.name]=dbContext;}// Register itself as a running localForage in the current context.
dbContext.forages.push(self);// Replace the default `ready()` function with the specialized one.
if(!self._initReady){self._initReady=self.ready;self.ready=_fullyReady;}// Create an array of initialization states of the related localForages.
var initPromises=[];function ignoreErrors(){// Don't handle errors here,
// just makes sure related localForages aren't pending.
return Promise$1.resolve();}for(var j=0;j<dbContext.forages.length;j++){var forage=dbContext.forages[j];if(forage!==self){// Don't wait for itself...
initPromises.push(forage._initReady()["catch"](ignoreErrors));}}// Take a snapshot of the related localForages.
var forages=dbContext.forages.slice(0);// Initialize the connection process only when
// all the related localForages aren't pending.
return Promise$1.all(initPromises).then(function(){dbInfo.db=dbContext.db;// Get the connection or open a new one without upgrade.
return _getOriginalConnection(dbInfo);}).then(function(db){dbInfo.db=db;if(_isUpgradeNeeded(dbInfo,self._defaultConfig.version)){// Reopen the database for upgrading.
return _getUpgradedConnection(dbInfo);}return db;}).then(function(db){dbInfo.db=dbContext.db=db;self._dbInfo=dbInfo;// Share the final connection amongst related localForages.
for(var k=0;k<forages.length;k++){var forage=forages[k];if(forage!==self){// Self is already up-to-date.
forage._dbInfo.db=dbInfo.db;forage._dbInfo.version=dbInfo.version;}}});}function getItem(key,callback){var self=this;key=normalizeKey(key);var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){createTransaction(self._dbInfo,READ_ONLY,function(err,transaction){if(err){return reject(err);}try{var store=transaction.objectStore(self._dbInfo.storeName);var req=store.get(key);req.onsuccess=function(){var value=req.result;if(value===undefined){value=null;}if(_isEncodedBlob(value)){value=_decodeBlob(value);}resolve(value);};req.onerror=function(){reject(req.error);};}catch(e){reject(e);}});})["catch"](reject);});executeCallback(promise,callback);return promise;}// Iterate over all items stored in database.
function iterate(iterator,callback){var self=this;var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){createTransaction(self._dbInfo,READ_ONLY,function(err,transaction){if(err){return reject(err);}try{var store=transaction.objectStore(self._dbInfo.storeName);var req=store.openCursor();var iterationNumber=1;req.onsuccess=function(){var cursor=req.result;if(cursor){var value=cursor.value;if(_isEncodedBlob(value)){value=_decodeBlob(value);}var result=iterator(value,cursor.key,iterationNumber++);// when the iterator callback returns any
// (non-`undefined`) value, then we stop
// the iteration immediately
if(result!==void 0){resolve(result);}else{cursor["continue"]();}}else{resolve();}};req.onerror=function(){reject(req.error);};}catch(e){reject(e);}});})["catch"](reject);});executeCallback(promise,callback);return promise;}function setItem(key,value,callback){var self=this;key=normalizeKey(key);var promise=new Promise$1(function(resolve,reject){var dbInfo;self.ready().then(function(){dbInfo=self._dbInfo;if(toString.call(value)==='[object Blob]'){return _checkBlobSupport(dbInfo.db).then(function(blobSupport){if(blobSupport){return value;}return _encodeBlob(value);});}return value;}).then(function(value){createTransaction(self._dbInfo,READ_WRITE,function(err,transaction){if(err){return reject(err);}try{var store=transaction.objectStore(self._dbInfo.storeName);// The reason we don't _save_ null is because IE 10 does
// not support saving the `null` type in IndexedDB. How
// ironic, given the bug below!
// See: https://github.com/mozilla/localForage/issues/161
if(value===null){value=undefined;}var req=store.put(value,key);transaction.oncomplete=function(){// Cast to undefined so the value passed to
// callback/promise is the same as what one would get out
// of `getItem()` later. This leads to some weirdness
// (setItem('foo', undefined) will return `null`), but
// it's not my fault localStorage is our baseline and that
// it's weird.
if(value===undefined){value=null;}resolve(value);};transaction.onabort=transaction.onerror=function(){var err=req.error?req.error:req.transaction.error;reject(err);};}catch(e){reject(e);}});})["catch"](reject);});executeCallback(promise,callback);return promise;}function removeItem(key,callback){var self=this;key=normalizeKey(key);var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){createTransaction(self._dbInfo,READ_WRITE,function(err,transaction){if(err){return reject(err);}try{var store=transaction.objectStore(self._dbInfo.storeName);// We use a Grunt task to make this safe for IE and some
// versions of Android (including those used by Cordova).
// Normally IE won't like `.delete()` and will insist on
// using `['delete']()`, but we have a build step that
// fixes this for us now.
var req=store["delete"](key);transaction.oncomplete=function(){resolve();};transaction.onerror=function(){reject(req.error);};// The request will be also be aborted if we've exceeded our storage
// space.
transaction.onabort=function(){var err=req.error?req.error:req.transaction.error;reject(err);};}catch(e){reject(e);}});})["catch"](reject);});executeCallback(promise,callback);return promise;}function clear(callback){var self=this;var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){createTransaction(self._dbInfo,READ_WRITE,function(err,transaction){if(err){return reject(err);}try{var store=transaction.objectStore(self._dbInfo.storeName);var req=store.clear();transaction.oncomplete=function(){resolve();};transaction.onabort=transaction.onerror=function(){var err=req.error?req.error:req.transaction.error;reject(err);};}catch(e){reject(e);}});})["catch"](reject);});executeCallback(promise,callback);return promise;}function length(callback){var self=this;var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){createTransaction(self._dbInfo,READ_ONLY,function(err,transaction){if(err){return reject(err);}try{var store=transaction.objectStore(self._dbInfo.storeName);var req=store.count();req.onsuccess=function(){resolve(req.result);};req.onerror=function(){reject(req.error);};}catch(e){reject(e);}});})["catch"](reject);});executeCallback(promise,callback);return promise;}function key(n,callback){var self=this;var promise=new Promise$1(function(resolve,reject){if(n<0){resolve(null);return;}self.ready().then(function(){createTransaction(self._dbInfo,READ_ONLY,function(err,transaction){if(err){return reject(err);}try{var store=transaction.objectStore(self._dbInfo.storeName);var advanced=false;var req=store.openKeyCursor();req.onsuccess=function(){var cursor=req.result;if(!cursor){// this means there weren't enough keys
resolve(null);return;}if(n===0){// We have the first key, return it if that's what they
// wanted.
resolve(cursor.key);}else{if(!advanced){// Otherwise, ask the cursor to skip ahead n
// records.
advanced=true;cursor.advance(n);}else{// When we get here, we've got the nth key.
resolve(cursor.key);}}};req.onerror=function(){reject(req.error);};}catch(e){reject(e);}});})["catch"](reject);});executeCallback(promise,callback);return promise;}function keys(callback){var self=this;var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){createTransaction(self._dbInfo,READ_ONLY,function(err,transaction){if(err){return reject(err);}try{var store=transaction.objectStore(self._dbInfo.storeName);var req=store.openKeyCursor();var keys=[];req.onsuccess=function(){var cursor=req.result;if(!cursor){resolve(keys);return;}keys.push(cursor.key);cursor["continue"]();};req.onerror=function(){reject(req.error);};}catch(e){reject(e);}});})["catch"](reject);});executeCallback(promise,callback);return promise;}function dropInstance(options,callback){callback=getCallback.apply(this,arguments);var currentConfig=this.config();options=typeof options!=='function'&&options||{};if(!options.name){options.name=options.name||currentConfig.name;options.storeName=options.storeName||currentConfig.storeName;}var self=this;var promise;if(!options.name){promise=Promise$1.reject('Invalid arguments');}else{var isCurrentDb=options.name===currentConfig.name&&self._dbInfo.db;var dbPromise=isCurrentDb?Promise$1.resolve(self._dbInfo.db):_getOriginalConnection(options).then(function(db){var dbContext=dbContexts[options.name];var forages=dbContext.forages;dbContext.db=db;for(var i=0;i<forages.length;i++){forages[i]._dbInfo.db=db;}return db;});if(!options.storeName){promise=dbPromise.then(function(db){_deferReadiness(options);var dbContext=dbContexts[options.name];var forages=dbContext.forages;db.close();for(var i=0;i<forages.length;i++){var forage=forages[i];forage._dbInfo.db=null;}var dropDBPromise=new Promise$1(function(resolve,reject){var req=idb.deleteDatabase(options.name);req.onerror=function(){var db=req.result;if(db){db.close();}reject(req.error);};req.onblocked=function(){// Closing all open connections in onversionchange handler should prevent this situation, but if
// we do get here, it just means the request remains pending - eventually it will succeed or error
console.warn('dropInstance blocked for database "'+options.name+'" until all open connections are closed');};req.onsuccess=function(){var db=req.result;if(db){db.close();}resolve(db);};});return dropDBPromise.then(function(db){dbContext.db=db;for(var i=0;i<forages.length;i++){var _forage=forages[i];_advanceReadiness(_forage._dbInfo);}})["catch"](function(err){(_rejectReadiness(options,err)||Promise$1.resolve())["catch"](function(){});throw err;});});}else{promise=dbPromise.then(function(db){if(!db.objectStoreNames.contains(options.storeName)){return;}var newVersion=db.version+1;_deferReadiness(options);var dbContext=dbContexts[options.name];var forages=dbContext.forages;db.close();for(var i=0;i<forages.length;i++){var forage=forages[i];forage._dbInfo.db=null;forage._dbInfo.version=newVersion;}var dropObjectPromise=new Promise$1(function(resolve,reject){var req=idb.open(options.name,newVersion);req.onerror=function(err){var db=req.result;db.close();reject(err);};req.onupgradeneeded=function(){var db=req.result;db.deleteObjectStore(options.storeName);};req.onsuccess=function(){var db=req.result;db.close();resolve(db);};});return dropObjectPromise.then(function(db){dbContext.db=db;for(var j=0;j<forages.length;j++){var _forage2=forages[j];_forage2._dbInfo.db=db;_advanceReadiness(_forage2._dbInfo);}})["catch"](function(err){(_rejectReadiness(options,err)||Promise$1.resolve())["catch"](function(){});throw err;});});}}executeCallback(promise,callback);return promise;}var asyncStorage={_driver:'asyncStorage',_initStorage:_initStorage,_support:isIndexedDBValid(),iterate:iterate,getItem:getItem,setItem:setItem,removeItem:removeItem,clear:clear,length:length,key:key,keys:keys,dropInstance:dropInstance};function isWebSQLValid(){return typeof openDatabase==='function';}// Sadly, the best way to save binary data in WebSQL/localStorage is serializing
// it to Base64, so this is how we store it to prevent very strange errors with less
// verbose ways of binary <-> string data storage.
var BASE_CHARS='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';var BLOB_TYPE_PREFIX='~~local_forage_type~';var BLOB_TYPE_PREFIX_REGEX=/^~~local_forage_type~([^~]+)~/;var SERIALIZED_MARKER='__lfsc__:';var SERIALIZED_MARKER_LENGTH=SERIALIZED_MARKER.length;// OMG the serializations!
var TYPE_ARRAYBUFFER='arbf';var TYPE_BLOB='blob';var TYPE_INT8ARRAY='si08';var TYPE_UINT8ARRAY='ui08';var TYPE_UINT8CLAMPEDARRAY='uic8';var TYPE_INT16ARRAY='si16';var TYPE_INT32ARRAY='si32';var TYPE_UINT16ARRAY='ur16';var TYPE_UINT32ARRAY='ui32';var TYPE_FLOAT32ARRAY='fl32';var TYPE_FLOAT64ARRAY='fl64';var TYPE_SERIALIZED_MARKER_LENGTH=SERIALIZED_MARKER_LENGTH+TYPE_ARRAYBUFFER.length;var toString$1=Object.prototype.toString;function stringToBuffer(serializedString){// Fill the string into a ArrayBuffer.
var bufferLength=serializedString.length*0.75;var len=serializedString.length;var i;var p=0;var encoded1,encoded2,encoded3,encoded4;if(serializedString[serializedString.length-1]==='='){bufferLength--;if(serializedString[serializedString.length-2]==='='){bufferLength--;}}var buffer=new ArrayBuffer(bufferLength);var bytes=new Uint8Array(buffer);for(i=0;i<len;i+=4){encoded1=BASE_CHARS.indexOf(serializedString[i]);encoded2=BASE_CHARS.indexOf(serializedString[i+1]);encoded3=BASE_CHARS.indexOf(serializedString[i+2]);encoded4=BASE_CHARS.indexOf(serializedString[i+3]);/*jslint bitwise: true */bytes[p++]=encoded1<<2|encoded2>>4;bytes[p++]=(encoded2&15)<<4|encoded3>>2;bytes[p++]=(encoded3&3)<<6|encoded4&63;}return buffer;}// Converts a buffer to a string to store, serialized, in the backend
// storage library.
function bufferToString(buffer){// base64-arraybuffer
var bytes=new Uint8Array(buffer);var base64String='';var i;for(i=0;i<bytes.length;i+=3){/*jslint bitwise: true */base64String+=BASE_CHARS[bytes[i]>>2];base64String+=BASE_CHARS[(bytes[i]&3)<<4|bytes[i+1]>>4];base64String+=BASE_CHARS[(bytes[i+1]&15)<<2|bytes[i+2]>>6];base64String+=BASE_CHARS[bytes[i+2]&63];}if(bytes.length%3===2){base64String=base64String.substring(0,base64String.length-1)+'=';}else if(bytes.length%3===1){base64String=base64String.substring(0,base64String.length-2)+'==';}return base64String;}// Serialize a value, afterwards executing a callback (which usually
// instructs the `setItem()` callback/promise to be executed). This is how
// we store binary data with localStorage.
function serialize(value,callback){var valueType='';if(value){valueType=toString$1.call(value);}// Cannot use `value instanceof ArrayBuffer` or such here, as these
// checks fail when running the tests using casper.js...
//
// TODO: See why those tests fail and use a better solution.
if(value&&(valueType==='[object ArrayBuffer]'||value.buffer&&toString$1.call(value.buffer)==='[object ArrayBuffer]')){// Convert binary arrays to a string and prefix the string with
// a special marker.
var buffer;var marker=SERIALIZED_MARKER;if(value instanceof ArrayBuffer){buffer=value;marker+=TYPE_ARRAYBUFFER;}else{buffer=value.buffer;if(valueType==='[object Int8Array]'){marker+=TYPE_INT8ARRAY;}else if(valueType==='[object Uint8Array]'){marker+=TYPE_UINT8ARRAY;}else if(valueType==='[object Uint8ClampedArray]'){marker+=TYPE_UINT8CLAMPEDARRAY;}else if(valueType==='[object Int16Array]'){marker+=TYPE_INT16ARRAY;}else if(valueType==='[object Uint16Array]'){marker+=TYPE_UINT16ARRAY;}else if(valueType==='[object Int32Array]'){marker+=TYPE_INT32ARRAY;}else if(valueType==='[object Uint32Array]'){marker+=TYPE_UINT32ARRAY;}else if(valueType==='[object Float32Array]'){marker+=TYPE_FLOAT32ARRAY;}else if(valueType==='[object Float64Array]'){marker+=TYPE_FLOAT64ARRAY;}else{callback(new Error('Failed to get type for BinaryArray'));}}callback(marker+bufferToString(buffer));}else if(valueType==='[object Blob]'){// Conver the blob to a binaryArray and then to a string.
var fileReader=new FileReader();fileReader.onload=function(){// Backwards-compatible prefix for the blob type.
var str=BLOB_TYPE_PREFIX+value.type+'~'+bufferToString(this.result);callback(SERIALIZED_MARKER+TYPE_BLOB+str);};fileReader.readAsArrayBuffer(value);}else{try{callback(JSON.stringify(value));}catch(e){console.error("Couldn't convert value into a JSON string: ",value);callback(null,e);}}}// Deserialize data we've inserted into a value column/field. We place
// special markers into our strings to mark them as encoded; this isn't
// as nice as a meta field, but it's the only sane thing we can do whilst
// keeping localStorage support intact.
//
// Oftentimes this will just deserialize JSON content, but if we have a
// special marker (SERIALIZED_MARKER, defined above), we will extract
// some kind of arraybuffer/binary data/typed array out of the string.
function deserialize(value){// If we haven't marked this string as being specially serialized (i.e.
// something other than serialized JSON), we can just return it and be
// done with it.
if(value.substring(0,SERIALIZED_MARKER_LENGTH)!==SERIALIZED_MARKER){return JSON.parse(value);}// The following code deals with deserializing some kind of Blob or
// TypedArray. First we separate out the type of data we're dealing
// with from the data itself.
var serializedString=value.substring(TYPE_SERIALIZED_MARKER_LENGTH);var type=value.substring(SERIALIZED_MARKER_LENGTH,TYPE_SERIALIZED_MARKER_LENGTH);var blobType;// Backwards-compatible blob type serialization strategy.
// DBs created with older versions of localForage will simply not have the blob type.
if(type===TYPE_BLOB&&BLOB_TYPE_PREFIX_REGEX.test(serializedString)){var matcher=serializedString.match(BLOB_TYPE_PREFIX_REGEX);blobType=matcher[1];serializedString=serializedString.substring(matcher[0].length);}var buffer=stringToBuffer(serializedString);// Return the right type based on the code/type set during
// serialization.
switch(type){case TYPE_ARRAYBUFFER:return buffer;case TYPE_BLOB:return createBlob([buffer],{type:blobType});case TYPE_INT8ARRAY:return new Int8Array(buffer);case TYPE_UINT8ARRAY:return new Uint8Array(buffer);case TYPE_UINT8CLAMPEDARRAY:return new Uint8ClampedArray(buffer);case TYPE_INT16ARRAY:return new Int16Array(buffer);case TYPE_UINT16ARRAY:return new Uint16Array(buffer);case TYPE_INT32ARRAY:return new Int32Array(buffer);case TYPE_UINT32ARRAY:return new Uint32Array(buffer);case TYPE_FLOAT32ARRAY:return new Float32Array(buffer);case TYPE_FLOAT64ARRAY:return new Float64Array(buffer);default:throw new Error('Unkown type: '+type);}}var localforageSerializer={serialize:serialize,deserialize:deserialize,stringToBuffer:stringToBuffer,bufferToString:bufferToString};/*
			 * Includes code from:
			 *
			 * base64-arraybuffer
			 * https://github.com/niklasvh/base64-arraybuffer
			 *
			 * Copyright (c) 2012 Niklas von Hertzen
			 * Licensed under the MIT license.
			 */function createDbTable(t,dbInfo,callback,errorCallback){t.executeSql('CREATE TABLE IF NOT EXISTS '+dbInfo.storeName+' '+'(id INTEGER PRIMARY KEY, key unique, value)',[],callback,errorCallback);}// Open the WebSQL database (automatically creates one if one didn't
// previously exist), using any options set in the config.
function _initStorage$1(options){var self=this;var dbInfo={db:null};if(options){for(var i in options){dbInfo[i]=typeof options[i]!=='string'?options[i].toString():options[i];}}var dbInfoPromise=new Promise$1(function(resolve,reject){// Open the database; the openDatabase API will automatically
// create it for us if it doesn't exist.
try{dbInfo.db=openDatabase(dbInfo.name,String(dbInfo.version),dbInfo.description,dbInfo.size);}catch(e){return reject(e);}// Create our key/value table if it doesn't exist.
dbInfo.db.transaction(function(t){createDbTable(t,dbInfo,function(){self._dbInfo=dbInfo;resolve();},function(t,error){reject(error);});},reject);});dbInfo.serializer=localforageSerializer;return dbInfoPromise;}function tryExecuteSql(t,dbInfo,sqlStatement,args,callback,errorCallback){t.executeSql(sqlStatement,args,callback,function(t,error){if(error.code===error.SYNTAX_ERR){t.executeSql('SELECT name FROM sqlite_master '+"WHERE type='table' AND name = ?",[dbInfo.storeName],function(t,results){if(!results.rows.length){// if the table is missing (was deleted)
// re-create it table and retry
createDbTable(t,dbInfo,function(){t.executeSql(sqlStatement,args,callback,errorCallback);},errorCallback);}else{errorCallback(t,error);}},errorCallback);}else{errorCallback(t,error);}},errorCallback);}function getItem$1(key,callback){var self=this;key=normalizeKey(key);var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){tryExecuteSql(t,dbInfo,'SELECT * FROM '+dbInfo.storeName+' WHERE key = ? LIMIT 1',[key],function(t,results){var result=results.rows.length?results.rows.item(0).value:null;// Check to see if this is serialized content we need to
// unpack.
if(result){result=dbInfo.serializer.deserialize(result);}resolve(result);},function(t,error){reject(error);});});})["catch"](reject);});executeCallback(promise,callback);return promise;}function iterate$1(iterator,callback){var self=this;var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){tryExecuteSql(t,dbInfo,'SELECT * FROM '+dbInfo.storeName,[],function(t,results){var rows=results.rows;var length=rows.length;for(var i=0;i<length;i++){var item=rows.item(i);var result=item.value;// Check to see if this is serialized content
// we need to unpack.
if(result){result=dbInfo.serializer.deserialize(result);}result=iterator(result,item.key,i+1);// void(0) prevents problems with redefinition
// of `undefined`.
if(result!==void 0){resolve(result);return;}}resolve();},function(t,error){reject(error);});});})["catch"](reject);});executeCallback(promise,callback);return promise;}function _setItem(key,value,callback,retriesLeft){var self=this;key=normalizeKey(key);var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){// The localStorage API doesn't return undefined values in an
// "expected" way, so undefined is always cast to null in all
// drivers. See: https://github.com/mozilla/localForage/pull/42
if(value===undefined){value=null;}// Save the original value to pass to the callback.
var originalValue=value;var dbInfo=self._dbInfo;dbInfo.serializer.serialize(value,function(value,error){if(error){reject(error);}else{dbInfo.db.transaction(function(t){tryExecuteSql(t,dbInfo,'INSERT OR REPLACE INTO '+dbInfo.storeName+' '+'(key, value) VALUES (?, ?)',[key,value],function(){resolve(originalValue);},function(t,error){reject(error);});},function(sqlError){// The transaction failed; check
// to see if it's a quota error.
if(sqlError.code===sqlError.QUOTA_ERR){// We reject the callback outright for now, but
// it's worth trying to re-run the transaction.
// Even if the user accepts the prompt to use
// more storage on Safari, this error will
// be called.
//
// Try to re-run the transaction.
if(retriesLeft>0){resolve(_setItem.apply(self,[key,originalValue,callback,retriesLeft-1]));return;}reject(sqlError);}});}});})["catch"](reject);});executeCallback(promise,callback);return promise;}function setItem$1(key,value,callback){return _setItem.apply(this,[key,value,callback,1]);}function removeItem$1(key,callback){var self=this;key=normalizeKey(key);var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){tryExecuteSql(t,dbInfo,'DELETE FROM '+dbInfo.storeName+' WHERE key = ?',[key],function(){resolve();},function(t,error){reject(error);});});})["catch"](reject);});executeCallback(promise,callback);return promise;}// Deletes every item in the table.
// TODO: Find out if this resets the AUTO_INCREMENT number.
function clear$1(callback){var self=this;var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){tryExecuteSql(t,dbInfo,'DELETE FROM '+dbInfo.storeName,[],function(){resolve();},function(t,error){reject(error);});});})["catch"](reject);});executeCallback(promise,callback);return promise;}// Does a simple `COUNT(key)` to get the number of items stored in
// localForage.
function length$1(callback){var self=this;var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){// Ahhh, SQL makes this one soooooo easy.
tryExecuteSql(t,dbInfo,'SELECT COUNT(key) as c FROM '+dbInfo.storeName,[],function(t,results){var result=results.rows.item(0).c;resolve(result);},function(t,error){reject(error);});});})["catch"](reject);});executeCallback(promise,callback);return promise;}// Return the key located at key index X; essentially gets the key from a
// `WHERE id = ?`. This is the most efficient way I can think to implement
// this rarely-used (in my experience) part of the API, but it can seem
// inconsistent, because we do `INSERT OR REPLACE INTO` on `setItem()`, so
// the ID of each key will change every time it's updated. Perhaps a stored
// procedure for the `setItem()` SQL would solve this problem?
// TODO: Don't change ID on `setItem()`.
function key$1(n,callback){var self=this;var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){tryExecuteSql(t,dbInfo,'SELECT key FROM '+dbInfo.storeName+' WHERE id = ? LIMIT 1',[n+1],function(t,results){var result=results.rows.length?results.rows.item(0).key:null;resolve(result);},function(t,error){reject(error);});});})["catch"](reject);});executeCallback(promise,callback);return promise;}function keys$1(callback){var self=this;var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){tryExecuteSql(t,dbInfo,'SELECT key FROM '+dbInfo.storeName,[],function(t,results){var keys=[];for(var i=0;i<results.rows.length;i++){keys.push(results.rows.item(i).key);}resolve(keys);},function(t,error){reject(error);});});})["catch"](reject);});executeCallback(promise,callback);return promise;}// https://www.w3.org/TR/webdatabase/#databases
// > There is no way to enumerate or delete the databases available for an origin from this API.
function getAllStoreNames(db){return new Promise$1(function(resolve,reject){db.transaction(function(t){t.executeSql('SELECT name FROM sqlite_master '+"WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(t,results){var storeNames=[];for(var i=0;i<results.rows.length;i++){storeNames.push(results.rows.item(i).name);}resolve({db:db,storeNames:storeNames});},function(t,error){reject(error);});},function(sqlError){reject(sqlError);});});}function dropInstance$1(options,callback){callback=getCallback.apply(this,arguments);var currentConfig=this.config();options=typeof options!=='function'&&options||{};if(!options.name){options.name=options.name||currentConfig.name;options.storeName=options.storeName||currentConfig.storeName;}var self=this;var promise;if(!options.name){promise=Promise$1.reject('Invalid arguments');}else{promise=new Promise$1(function(resolve){var db;if(options.name===currentConfig.name){// use the db reference of the current instance
db=self._dbInfo.db;}else{db=openDatabase(options.name,'','',0);}if(!options.storeName){// drop all database tables
resolve(getAllStoreNames(db));}else{resolve({db:db,storeNames:[options.storeName]});}}).then(function(operationInfo){return new Promise$1(function(resolve,reject){operationInfo.db.transaction(function(t){function dropTable(storeName){return new Promise$1(function(resolve,reject){t.executeSql('DROP TABLE IF EXISTS '+storeName,[],function(){resolve();},function(t,error){reject(error);});});}var operations=[];for(var i=0,len=operationInfo.storeNames.length;i<len;i++){operations.push(dropTable(operationInfo.storeNames[i]));}Promise$1.all(operations).then(function(){resolve();})["catch"](function(e){reject(e);});},function(sqlError){reject(sqlError);});});});}executeCallback(promise,callback);return promise;}var webSQLStorage={_driver:'webSQLStorage',_initStorage:_initStorage$1,_support:isWebSQLValid(),iterate:iterate$1,getItem:getItem$1,setItem:setItem$1,removeItem:removeItem$1,clear:clear$1,length:length$1,key:key$1,keys:keys$1,dropInstance:dropInstance$1};function isLocalStorageValid(){try{return typeof localStorage!=='undefined'&&'setItem'in localStorage&&// in IE8 typeof localStorage.setItem === 'object'
!!localStorage.setItem;}catch(e){return false;}}function _getKeyPrefix(options,defaultConfig){var keyPrefix=options.name+'/';if(options.storeName!==defaultConfig.storeName){keyPrefix+=options.storeName+'/';}return keyPrefix;}// Check if localStorage throws when saving an item
function checkIfLocalStorageThrows(){var localStorageTestKey='_localforage_support_test';try{localStorage.setItem(localStorageTestKey,true);localStorage.removeItem(localStorageTestKey);return false;}catch(e){return true;}}// Check if localStorage is usable and allows to save an item
// This method checks if localStorage is usable in Safari Private Browsing
// mode, or in any other case where the available quota for localStorage
// is 0 and there wasn't any saved items yet.
function _isLocalStorageUsable(){return!checkIfLocalStorageThrows()||localStorage.length>0;}// Config the localStorage backend, using options set in the config.
function _initStorage$2(options){var self=this;var dbInfo={};if(options){for(var i in options){dbInfo[i]=options[i];}}dbInfo.keyPrefix=_getKeyPrefix(options,self._defaultConfig);if(!_isLocalStorageUsable()){return Promise$1.reject();}self._dbInfo=dbInfo;dbInfo.serializer=localforageSerializer;return Promise$1.resolve();}// Remove all keys from the datastore, effectively destroying all data in
// the app's key/value store!
function clear$2(callback){var self=this;var promise=self.ready().then(function(){var keyPrefix=self._dbInfo.keyPrefix;for(var i=localStorage.length-1;i>=0;i--){var key=localStorage.key(i);if(key.indexOf(keyPrefix)===0){localStorage.removeItem(key);}}});executeCallback(promise,callback);return promise;}// Retrieve an item from the store. Unlike the original async_storage
// library in Gaia, we don't modify return values at all. If a key's value
// is `undefined`, we pass that value to the callback function.
function getItem$2(key,callback){var self=this;key=normalizeKey(key);var promise=self.ready().then(function(){var dbInfo=self._dbInfo;var result=localStorage.getItem(dbInfo.keyPrefix+key);// If a result was found, parse it from the serialized
// string into a JS object. If result isn't truthy, the key
// is likely undefined and we'll pass it straight to the
// callback.
if(result){result=dbInfo.serializer.deserialize(result);}return result;});executeCallback(promise,callback);return promise;}// Iterate over all items in the store.
function iterate$2(iterator,callback){var self=this;var promise=self.ready().then(function(){var dbInfo=self._dbInfo;var keyPrefix=dbInfo.keyPrefix;var keyPrefixLength=keyPrefix.length;var length=localStorage.length;// We use a dedicated iterator instead of the `i` variable below
// so other keys we fetch in localStorage aren't counted in
// the `iterationNumber` argument passed to the `iterate()`
// callback.
//
// See: github.com/mozilla/localForage/pull/435#discussion_r38061530
var iterationNumber=1;for(var i=0;i<length;i++){var key=localStorage.key(i);if(key.indexOf(keyPrefix)!==0){continue;}var value=localStorage.getItem(key);// If a result was found, parse it from the serialized
// string into a JS object. If result isn't truthy, the
// key is likely undefined and we'll pass it straight
// to the iterator.
if(value){value=dbInfo.serializer.deserialize(value);}value=iterator(value,key.substring(keyPrefixLength),iterationNumber++);if(value!==void 0){return value;}}});executeCallback(promise,callback);return promise;}// Same as localStorage's key() method, except takes a callback.
function key$2(n,callback){var self=this;var promise=self.ready().then(function(){var dbInfo=self._dbInfo;var result;try{result=localStorage.key(n);}catch(error){result=null;}// Remove the prefix from the key, if a key is found.
if(result){result=result.substring(dbInfo.keyPrefix.length);}return result;});executeCallback(promise,callback);return promise;}function keys$2(callback){var self=this;var promise=self.ready().then(function(){var dbInfo=self._dbInfo;var length=localStorage.length;var keys=[];for(var i=0;i<length;i++){var itemKey=localStorage.key(i);if(itemKey.indexOf(dbInfo.keyPrefix)===0){keys.push(itemKey.substring(dbInfo.keyPrefix.length));}}return keys;});executeCallback(promise,callback);return promise;}// Supply the number of keys in the datastore to the callback function.
function length$2(callback){var self=this;var promise=self.keys().then(function(keys){return keys.length;});executeCallback(promise,callback);return promise;}// Remove an item from the store, nice and simple.
function removeItem$2(key,callback){var self=this;key=normalizeKey(key);var promise=self.ready().then(function(){var dbInfo=self._dbInfo;localStorage.removeItem(dbInfo.keyPrefix+key);});executeCallback(promise,callback);return promise;}// Set a key's value and run an optional callback once the value is set.
// Unlike Gaia's implementation, the callback function is passed the value,
// in case you want to operate on that value only after you're sure it
// saved, or something like that.
function setItem$2(key,value,callback){var self=this;key=normalizeKey(key);var promise=self.ready().then(function(){// Convert undefined values to null.
// https://github.com/mozilla/localForage/pull/42
if(value===undefined){value=null;}// Save the original value to pass to the callback.
var originalValue=value;return new Promise$1(function(resolve,reject){var dbInfo=self._dbInfo;dbInfo.serializer.serialize(value,function(value,error){if(error){reject(error);}else{try{localStorage.setItem(dbInfo.keyPrefix+key,value);resolve(originalValue);}catch(e){// localStorage capacity exceeded.
// TODO: Make this a specific error/event.
if(e.name==='QuotaExceededError'||e.name==='NS_ERROR_DOM_QUOTA_REACHED'){reject(e);}reject(e);}}});});});executeCallback(promise,callback);return promise;}function dropInstance$2(options,callback){callback=getCallback.apply(this,arguments);options=typeof options!=='function'&&options||{};if(!options.name){var currentConfig=this.config();options.name=options.name||currentConfig.name;options.storeName=options.storeName||currentConfig.storeName;}var self=this;var promise;if(!options.name){promise=Promise$1.reject('Invalid arguments');}else{promise=new Promise$1(function(resolve){if(!options.storeName){resolve(options.name+'/');}else{resolve(_getKeyPrefix(options,self._defaultConfig));}}).then(function(keyPrefix){for(var i=localStorage.length-1;i>=0;i--){var key=localStorage.key(i);if(key.indexOf(keyPrefix)===0){localStorage.removeItem(key);}}});}executeCallback(promise,callback);return promise;}var localStorageWrapper={_driver:'localStorageWrapper',_initStorage:_initStorage$2,_support:isLocalStorageValid(),iterate:iterate$2,getItem:getItem$2,setItem:setItem$2,removeItem:removeItem$2,clear:clear$2,length:length$2,key:key$2,keys:keys$2,dropInstance:dropInstance$2};var sameValue=function sameValue(x,y){return x===y||typeof x==='number'&&typeof y==='number'&&isNaN(x)&&isNaN(y);};var includes=function includes(array,searchElement){var len=array.length;var i=0;while(i<len){if(sameValue(array[i],searchElement)){return true;}i++;}return false;};var isArray=Array.isArray||function(arg){return Object.prototype.toString.call(arg)==='[object Array]';};// Drivers are stored here when `defineDriver()` is called.
// They are shared across all instances of localForage.
var DefinedDrivers={};var DriverSupport={};var DefaultDrivers={INDEXEDDB:asyncStorage,WEBSQL:webSQLStorage,LOCALSTORAGE:localStorageWrapper};var DefaultDriverOrder=[DefaultDrivers.INDEXEDDB._driver,DefaultDrivers.WEBSQL._driver,DefaultDrivers.LOCALSTORAGE._driver];var OptionalDriverMethods=['dropInstance'];var LibraryMethods=['clear','getItem','iterate','key','keys','length','removeItem','setItem'].concat(OptionalDriverMethods);var DefaultConfig={description:'',driver:DefaultDriverOrder.slice(),name:'localforage',// Default DB size is _JUST UNDER_ 5MB, as it's the highest size
// we can use without a prompt.
size:4980736,storeName:'keyvaluepairs',version:1.0};function callWhenReady(localForageInstance,libraryMethod){localForageInstance[libraryMethod]=function(){var _args=arguments;return localForageInstance.ready().then(function(){return localForageInstance[libraryMethod].apply(localForageInstance,_args);});};}function extend(){for(var i=1;i<arguments.length;i++){var arg=arguments[i];if(arg){for(var _key in arg){if(arg.hasOwnProperty(_key)){if(isArray(arg[_key])){arguments[0][_key]=arg[_key].slice();}else{arguments[0][_key]=arg[_key];}}}}}return arguments[0];}var LocalForage=function(){function LocalForage(options){_classCallCheck(this,LocalForage);for(var driverTypeKey in DefaultDrivers){if(DefaultDrivers.hasOwnProperty(driverTypeKey)){var driver=DefaultDrivers[driverTypeKey];var driverName=driver._driver;this[driverTypeKey]=driverName;if(!DefinedDrivers[driverName]){// we don't need to wait for the promise,
// since the default drivers can be defined
// in a blocking manner
this.defineDriver(driver);}}}this._defaultConfig=extend({},DefaultConfig);this._config=extend({},this._defaultConfig,options);this._driverSet=null;this._initDriver=null;this._ready=false;this._dbInfo=null;this._wrapLibraryMethodsWithReady();this.setDriver(this._config.driver)["catch"](function(){});}// Set any config values for localForage; can be called anytime before
// the first API call (e.g. `getItem`, `setItem`).
// We loop through options so we don't overwrite existing config
// values.
LocalForage.prototype.config=function config(options){// If the options argument is an object, we use it to set values.
// Otherwise, we return either a specified config value or all
// config values.
if((typeof options==='undefined'?'undefined':_typeof(options))==='object'){// If localforage is ready and fully initialized, we can't set
// any new configuration values. Instead, we return an error.
if(this._ready){return new Error("Can't call config() after localforage "+'has been used.');}for(var i in options){if(i==='storeName'){options[i]=options[i].replace(/\W/g,'_');}if(i==='version'&&typeof options[i]!=='number'){return new Error('Database version must be a number.');}this._config[i]=options[i];}// after all config options are set and
// the driver option is used, try setting it
if('driver'in options&&options.driver){return this.setDriver(this._config.driver);}return true;}else if(typeof options==='string'){return this._config[options];}else{return this._config;}};// Used to define a custom driver, shared across all instances of
// localForage.
LocalForage.prototype.defineDriver=function defineDriver(driverObject,callback,errorCallback){var promise=new Promise$1(function(resolve,reject){try{var driverName=driverObject._driver;var complianceError=new Error('Custom driver not compliant; see '+'https://mozilla.github.io/localForage/#definedriver');// A driver name should be defined and not overlap with the
// library-defined, default drivers.
if(!driverObject._driver){reject(complianceError);return;}var driverMethods=LibraryMethods.concat('_initStorage');for(var i=0,len=driverMethods.length;i<len;i++){var driverMethodName=driverMethods[i];// when the property is there,
// it should be a method even when optional
var isRequired=!includes(OptionalDriverMethods,driverMethodName);if((isRequired||driverObject[driverMethodName])&&typeof driverObject[driverMethodName]!=='function'){reject(complianceError);return;}}var configureMissingMethods=function configureMissingMethods(){var methodNotImplementedFactory=function methodNotImplementedFactory(methodName){return function(){var error=new Error('Method '+methodName+' is not implemented by the current driver');var promise=Promise$1.reject(error);executeCallback(promise,arguments[arguments.length-1]);return promise;};};for(var _i=0,_len=OptionalDriverMethods.length;_i<_len;_i++){var optionalDriverMethod=OptionalDriverMethods[_i];if(!driverObject[optionalDriverMethod]){driverObject[optionalDriverMethod]=methodNotImplementedFactory(optionalDriverMethod);}}};configureMissingMethods();var setDriverSupport=function setDriverSupport(support){if(DefinedDrivers[driverName]){console.info('Redefining LocalForage driver: '+driverName);}DefinedDrivers[driverName]=driverObject;DriverSupport[driverName]=support;// don't use a then, so that we can define
// drivers that have simple _support methods
// in a blocking manner
resolve();};if('_support'in driverObject){if(driverObject._support&&typeof driverObject._support==='function'){driverObject._support().then(setDriverSupport,reject);}else{setDriverSupport(!!driverObject._support);}}else{setDriverSupport(true);}}catch(e){reject(e);}});executeTwoCallbacks(promise,callback,errorCallback);return promise;};LocalForage.prototype.driver=function driver(){return this._driver||null;};LocalForage.prototype.getDriver=function getDriver(driverName,callback,errorCallback){var getDriverPromise=DefinedDrivers[driverName]?Promise$1.resolve(DefinedDrivers[driverName]):Promise$1.reject(new Error('Driver not found.'));executeTwoCallbacks(getDriverPromise,callback,errorCallback);return getDriverPromise;};LocalForage.prototype.getSerializer=function getSerializer(callback){var serializerPromise=Promise$1.resolve(localforageSerializer);executeTwoCallbacks(serializerPromise,callback);return serializerPromise;};LocalForage.prototype.ready=function ready(callback){var self=this;var promise=self._driverSet.then(function(){if(self._ready===null){self._ready=self._initDriver();}return self._ready;});executeTwoCallbacks(promise,callback,callback);return promise;};LocalForage.prototype.setDriver=function setDriver(drivers,callback,errorCallback){var self=this;if(!isArray(drivers)){drivers=[drivers];}var supportedDrivers=this._getSupportedDrivers(drivers);function setDriverToConfig(){self._config.driver=self.driver();}function extendSelfWithDriver(driver){self._extend(driver);setDriverToConfig();self._ready=self._initStorage(self._config);return self._ready;}function initDriver(supportedDrivers){return function(){var currentDriverIndex=0;function driverPromiseLoop(){while(currentDriverIndex<supportedDrivers.length){var driverName=supportedDrivers[currentDriverIndex];currentDriverIndex++;self._dbInfo=null;self._ready=null;return self.getDriver(driverName).then(extendSelfWithDriver)["catch"](driverPromiseLoop);}setDriverToConfig();var error=new Error('No available storage method found.');self._driverSet=Promise$1.reject(error);return self._driverSet;}return driverPromiseLoop();};}// There might be a driver initialization in progress
// so wait for it to finish in order to avoid a possible
// race condition to set _dbInfo
var oldDriverSetDone=this._driverSet!==null?this._driverSet["catch"](function(){return Promise$1.resolve();}):Promise$1.resolve();this._driverSet=oldDriverSetDone.then(function(){var driverName=supportedDrivers[0];self._dbInfo=null;self._ready=null;return self.getDriver(driverName).then(function(driver){self._driver=driver._driver;setDriverToConfig();self._wrapLibraryMethodsWithReady();self._initDriver=initDriver(supportedDrivers);});})["catch"](function(){setDriverToConfig();var error=new Error('No available storage method found.');self._driverSet=Promise$1.reject(error);return self._driverSet;});executeTwoCallbacks(this._driverSet,callback,errorCallback);return this._driverSet;};LocalForage.prototype.supports=function supports(driverName){return!!DriverSupport[driverName];};LocalForage.prototype._extend=function _extend(libraryMethodsAndProperties){extend(this,libraryMethodsAndProperties);};LocalForage.prototype._getSupportedDrivers=function _getSupportedDrivers(drivers){var supportedDrivers=[];for(var i=0,len=drivers.length;i<len;i++){var driverName=drivers[i];if(this.supports(driverName)){supportedDrivers.push(driverName);}}return supportedDrivers;};LocalForage.prototype._wrapLibraryMethodsWithReady=function _wrapLibraryMethodsWithReady(){// Add a stub for each driver API method that delays the call to the
// corresponding driver method until localForage is ready. These stubs
// will be replaced by the driver methods as soon as the driver is
// loaded, so there is no performance impact.
for(var i=0,len=LibraryMethods.length;i<len;i++){callWhenReady(this,LibraryMethods[i]);}};LocalForage.prototype.createInstance=function createInstance(options){return new LocalForage(options);};return LocalForage;}();// The actual localForage object that we expose as a module or via a
// global. It's extended by pulling in one of our other libraries.
var localforage_js=new LocalForage();module.exports=localforage_js;},{"3":3}]},{},[4])(4);});})(localforage);Object.defineProperty(store,"__esModule",{value:true});store.default=void 0;var _core$2=core;var _request=_interopRequireDefault$4(request$1);var _mime=_interopRequireDefault$4(mime);var _path$1=_interopRequireDefault$4(path$1);var _eventEmitter$1=_interopRequireDefault$4(eventEmitter.exports);var _localforage=_interopRequireDefault$4(localforage.exports);function _interopRequireDefault$4(obj){return obj&&obj.__esModule?obj:{default:obj};}/**
			 * Handles saving and requesting files from local storage
			 * @class
			 * @param {string} name This should be the name of the application for modals
			 * @param {function} [requester]
			 * @param {function} [resolver]
			 */var Store=/*#__PURE__*/function(){function Store(name,requester,resolver){_classCallCheck3(this,Store);this.urlCache={};this.storage=undefined;this.name=name;this.requester=requester||_request.default;this.resolver=resolver;this.online=true;this.checkRequirements();this.addListeners();}/**
			   * Checks to see if localForage exists in global namspace,
			   * Requires localForage if it isn't there
			   * @private
			   */_createClass3(Store,[{key:"checkRequirements",value:function checkRequirements(){try{var _store2;if(typeof _localforage.default==="undefined"){_store2=_localforage.default;}this.storage=_store2.createInstance({name:this.name});}catch(e){throw new Error("localForage lib not loaded");}}/**
			   * Add online and offline event listeners
			   * @private
			   */},{key:"addListeners",value:function addListeners(){this._status=this.status.bind(this);window.addEventListener('online',this._status);window.addEventListener('offline',this._status);}/**
			   * Remove online and offline event listeners
			   * @private
			   */},{key:"removeListeners",value:function removeListeners(){window.removeEventListener('online',this._status);window.removeEventListener('offline',this._status);this._status=undefined;}/**
			   * Update the online / offline status
			   * @private
			   */},{key:"status",value:function status(event){var online=navigator.onLine;this.online=online;if(online){this.emit("online",this);}else{this.emit("offline",this);}}/**
			   * Add all of a book resources to the store
			   * @param  {Resources} resources  book resources
			   * @param  {boolean} [force] force resaving resources
			   * @return {Promise<object>} store objects
			   */},{key:"add",value:function add(resources,force){var _this54=this;var mapped=resources.resources.map(function(item){var href=item.href;var url=_this54.resolver(href);var encodedUrl=window.encodeURIComponent(url);return _this54.storage.getItem(encodedUrl).then(function(item){if(!item||force){return _this54.requester(url,"binary").then(function(data){return _this54.storage.setItem(encodedUrl,data);});}else{return item;}});});return Promise.all(mapped);}/**
			   * Put binary data from a url to storage
			   * @param  {string} url  a url to request from storage
			   * @param  {boolean} [withCredentials]
			   * @param  {object} [headers]
			   * @return {Promise<Blob>}
			   */},{key:"put",value:function put(url,withCredentials,headers){var _this55=this;var encodedUrl=window.encodeURIComponent(url);return this.storage.getItem(encodedUrl).then(function(result){if(!result){return _this55.requester(url,"binary",withCredentials,headers).then(function(data){return _this55.storage.setItem(encodedUrl,data);});}return result;});}/**
			   * Request a url
			   * @param  {string} url  a url to request from storage
			   * @param  {string} [type] specify the type of the returned result
			   * @param  {boolean} [withCredentials]
			   * @param  {object} [headers]
			   * @return {Promise<Blob | string | JSON | Document | XMLDocument>}
			   */},{key:"request",value:function request(url,type,withCredentials,headers){var _this56=this;if(this.online){// From network
return this.requester(url,type,withCredentials,headers).then(function(data){// save to store if not present
_this56.put(url);return data;});}else{// From store
return this.retrieve(url,type);}}/**
			   * Request a url from storage
			   * @param  {string} url  a url to request from storage
			   * @param  {string} [type] specify the type of the returned result
			   * @return {Promise<Blob | string | JSON | Document | XMLDocument>}
			   */},{key:"retrieve",value:function retrieve(url,type){var _this57=this;new _core$2.defer();var response;var path=new _path$1.default(url);// If type isn't set, determine it from the file extension
if(!type){type=path.extension;}if(type=="blob"){response=this.getBlob(url);}else{response=this.getText(url);}return response.then(function(r){var deferred=new _core$2.defer();var result;if(r){result=_this57.handleResponse(r,type);deferred.resolve(result);}else{deferred.reject({message:"File not found in storage: "+url,stack:new Error().stack});}return deferred.promise;});}/**
			   * Handle the response from request
			   * @private
			   * @param  {any} response
			   * @param  {string} [type]
			   * @return {any} the parsed result
			   */},{key:"handleResponse",value:function handleResponse(response,type){var r;if(type=="json"){r=JSON.parse(response);}else if((0,_core$2.isXml)(type)){r=(0,_core$2.parse)(response,"text/xml");}else if(type=="xhtml"){r=(0,_core$2.parse)(response,"application/xhtml+xml");}else if(type=="html"||type=="htm"){r=(0,_core$2.parse)(response,"text/html");}else{r=response;}return r;}/**
			   * Get a Blob from Storage by Url
			   * @param  {string} url
			   * @param  {string} [mimeType]
			   * @return {Blob}
			   */},{key:"getBlob",value:function getBlob(url,mimeType){var encodedUrl=window.encodeURIComponent(url);return this.storage.getItem(encodedUrl).then(function(uint8array){if(!uint8array)return;mimeType=mimeType||_mime.default.lookup(url);return new Blob([uint8array],{type:mimeType});});}/**
			   * Get Text from Storage by Url
			   * @param  {string} url
			   * @param  {string} [mimeType]
			   * @return {string}
			   */},{key:"getText",value:function getText(url,mimeType){var encodedUrl=window.encodeURIComponent(url);mimeType=mimeType||_mime.default.lookup(url);return this.storage.getItem(encodedUrl).then(function(uint8array){var deferred=new _core$2.defer();var reader=new FileReader();var blob;if(!uint8array)return;blob=new Blob([uint8array],{type:mimeType});reader.addEventListener("loadend",function(){deferred.resolve(reader.result);});reader.readAsText(blob,mimeType);return deferred.promise;});}/**
			   * Get a base64 encoded result from Storage by Url
			   * @param  {string} url
			   * @param  {string} [mimeType]
			   * @return {string} base64 encoded
			   */},{key:"getBase64",value:function getBase64(url,mimeType){var encodedUrl=window.encodeURIComponent(url);mimeType=mimeType||_mime.default.lookup(url);return this.storage.getItem(encodedUrl).then(function(uint8array){var deferred=new _core$2.defer();var reader=new FileReader();var blob;if(!uint8array)return;blob=new Blob([uint8array],{type:mimeType});reader.addEventListener("loadend",function(){deferred.resolve(reader.result);});reader.readAsDataURL(blob,mimeType);return deferred.promise;});}/**
			   * Create a Url from a stored item
			   * @param  {string} url
			   * @param  {object} [options.base64] use base64 encoding or blob url
			   * @return {Promise} url promise with Url string
			   */},{key:"createUrl",value:function createUrl(url,options){var deferred=new _core$2.defer();var _URL=window.URL||window.webkitURL||window.mozURL;var tempUrl;var response;var useBase64=options&&options.base64;if(url in this.urlCache){deferred.resolve(this.urlCache[url]);return deferred.promise;}if(useBase64){response=this.getBase64(url);if(response){response.then(function(tempUrl){this.urlCache[url]=tempUrl;deferred.resolve(tempUrl);}.bind(this));}}else{response=this.getBlob(url);if(response){response.then(function(blob){tempUrl=_URL.createObjectURL(blob);this.urlCache[url]=tempUrl;deferred.resolve(tempUrl);}.bind(this));}}if(!response){deferred.reject({message:"File not found in storage: "+url,stack:new Error().stack});}return deferred.promise;}/**
			   * Revoke Temp Url for a archive item
			   * @param  {string} url url of the item in the store
			   */},{key:"revokeUrl",value:function revokeUrl(url){var _URL=window.URL||window.webkitURL||window.mozURL;var fromCache=this.urlCache[url];if(fromCache)_URL.revokeObjectURL(fromCache);}},{key:"destroy",value:function destroy(){var _URL=window.URL||window.webkitURL||window.mozURL;for(var fromCache in this.urlCache){_URL.revokeObjectURL(fromCache);}this.urlCache={};this.removeListeners();}}]);return Store;}();(0,_eventEmitter$1.default)(Store.prototype);var _default$7=Store;store.default=_default$7;var displayoptions={};Object.defineProperty(displayoptions,"__esModule",{value:true});displayoptions.default=void 0;var _core$1=core;/**
			 * Open DisplayOptions Format Parser
			 * @class
			 * @param {document} displayOptionsDocument XML
			 */var DisplayOptions=/*#__PURE__*/function(){function DisplayOptions(displayOptionsDocument){_classCallCheck3(this,DisplayOptions);this.interactive="";this.fixedLayout="";this.openToSpread="";this.orientationLock="";if(displayOptionsDocument){this.parse(displayOptionsDocument);}}/**
			   * Parse XML
			   * @param  {document} displayOptionsDocument XML
			   * @return {DisplayOptions} self
			   */_createClass3(DisplayOptions,[{key:"parse",value:function parse(displayOptionsDocument){var _this58=this;if(!displayOptionsDocument){return this;}var displayOptionsNode=(0,_core$1.qs)(displayOptionsDocument,"display_options");if(!displayOptionsNode){return this;}var options=(0,_core$1.qsa)(displayOptionsNode,"option");options.forEach(function(el){var value="";if(el.childNodes.length){value=el.childNodes[0].nodeValue;}switch(el.attributes.name.value){case"interactive":_this58.interactive=value;break;case"fixed-layout":_this58.fixedLayout=value;break;case"open-to-spread":_this58.openToSpread=value;break;case"orientation-lock":_this58.orientationLock=value;break;}});return this;}},{key:"destroy",value:function destroy(){this.interactive=undefined;this.fixedLayout=undefined;this.openToSpread=undefined;this.orientationLock=undefined;}}]);return DisplayOptions;}();var _default$6=DisplayOptions;displayoptions.default=_default$6;Object.defineProperty(book,"__esModule",{value:true});book.default=void 0;var _eventEmitter=_interopRequireDefault$3(eventEmitter.exports);var _core=core;var _url=_interopRequireDefault$3(url);var _path=_interopRequireDefault$3(path$1);var _spine=_interopRequireDefault$3(spine);var _locations=_interopRequireDefault$3(locations);var _container=_interopRequireDefault$3(container);var _packaging=_interopRequireDefault$3(packaging);var _navigation=_interopRequireDefault$3(navigation);var _resources=_interopRequireDefault$3(resources);var _pagelist=_interopRequireDefault$3(pagelist);var _rendition$1=_interopRequireDefault$3(rendition);var _archive=_interopRequireDefault$3(archive);var _request2=_interopRequireDefault$3(request$1);var _epubcfi$1=_interopRequireDefault$3(epubcfi);var _store=_interopRequireDefault$3(store);var _displayoptions=_interopRequireDefault$3(displayoptions);var _constants$1=constants;function _interopRequireDefault$3(obj){return obj&&obj.__esModule?obj:{default:obj};}var CONTAINER_PATH="META-INF/container.xml";var IBOOKS_DISPLAY_OPTIONS_PATH="META-INF/com.apple.ibooks.display-options.xml";var INPUT_TYPE={BINARY:"binary",BASE64:"base64",EPUB:"epub",OPF:"opf",MANIFEST:"json",DIRECTORY:"directory"};/**
			 * An Epub representation with methods for the loading, parsing and manipulation
			 * of its contents.
			 * @class
			 * @param {string} [url]
			 * @param {object} [options]
			 * @param {method} [options.requestMethod] a request function to use instead of the default
			 * @param {boolean} [options.requestCredentials=undefined] send the xhr request withCredentials
			 * @param {object} [options.requestHeaders=undefined] send the xhr request headers
			 * @param {string} [options.encoding=binary] optional to pass 'binary' or base64' for archived Epubs
			 * @param {string} [options.replacements=none] use base64, blobUrl, or none for replacing assets in archived Epubs
			 * @param {method} [options.canonical] optional function to determine canonical urls for a path
			 * @param {string} [options.openAs] optional string to determine the input type
			 * @param {string} [options.store=false] cache the contents in local storage, value should be the name of the reader
			 * @returns {Book}
			 * @example new Book("/path/to/book.epub", {})
			 * @example new Book({ replacements: "blobUrl" })
			 */var Book=/*#__PURE__*/function(){function Book(url,options){var _this59=this;_classCallCheck3(this,Book);// Allow passing just options to the Book
if(typeof options==="undefined"&&typeof url!=="string"&&url instanceof Blob===false&&url instanceof ArrayBuffer===false){options=url;url=undefined;}this.settings=(0,_core.extend)(this.settings||{},{requestMethod:undefined,requestCredentials:undefined,requestHeaders:undefined,encoding:undefined,replacements:undefined,canonical:undefined,openAs:undefined,store:undefined});(0,_core.extend)(this.settings,options);// Promises
this.opening=new _core.defer();/**
			     * @member {promise} opened returns after the book is loaded
			     * @memberof Book
			     */this.opened=this.opening.promise;this.isOpen=false;this.loading={manifest:new _core.defer(),spine:new _core.defer(),metadata:new _core.defer(),cover:new _core.defer(),navigation:new _core.defer(),pageList:new _core.defer(),resources:new _core.defer(),displayOptions:new _core.defer()};this.loaded={manifest:this.loading.manifest.promise,spine:this.loading.spine.promise,metadata:this.loading.metadata.promise,cover:this.loading.cover.promise,navigation:this.loading.navigation.promise,pageList:this.loading.pageList.promise,resources:this.loading.resources.promise,displayOptions:this.loading.displayOptions.promise};/**
			     * @member {promise} ready returns after the book is loaded and parsed
			     * @memberof Book
			     * @private
			     */this.ready=Promise.all([this.loaded.manifest,this.loaded.spine,this.loaded.metadata,this.loaded.cover,this.loaded.navigation,this.loaded.resources,this.loaded.displayOptions]);// Queue for methods used before opening
this.isRendered=false;// this._q = queue(this);
/**
			     * @member {method} request
			     * @memberof Book
			     * @private
			     */this.request=this.settings.requestMethod||_request2.default;/**
			     * @member {Spine} spine
			     * @memberof Book
			     */this.spine=new _spine.default();/**
			     * @member {Locations} locations
			     * @memberof Book
			     */this.locations=new _locations.default(this.spine,this.load.bind(this));/**
			     * @member {Navigation} navigation
			     * @memberof Book
			     */this.navigation=undefined;/**
			     * @member {PageList} pagelist
			     * @memberof Book
			     */this.pageList=undefined;/**
			     * @member {Url} url
			     * @memberof Book
			     * @private
			     */this.url=undefined;/**
			     * @member {Path} path
			     * @memberof Book
			     * @private
			     */this.path=undefined;/**
			     * @member {boolean} archived
			     * @memberof Book
			     * @private
			     */this.archived=false;/**
			     * @member {Archive} archive
			     * @memberof Book
			     * @private
			     */this.archive=undefined;/**
			     * @member {Store} storage
			     * @memberof Book
			     * @private
			     */this.storage=undefined;/**
			     * @member {Resources} resources
			     * @memberof Book
			     * @private
			     */this.resources=undefined;/**
			     * @member {Rendition} rendition
			     * @memberof Book
			     * @private
			     */this.rendition=undefined;/**
			     * @member {Container} container
			     * @memberof Book
			     * @private
			     */this.container=undefined;/**
			     * @member {Packaging} packaging
			     * @memberof Book
			     * @private
			     */this.packaging=undefined;/**
			     * @member {DisplayOptions} displayOptions
			     * @memberof DisplayOptions
			     * @private
			     */this.displayOptions=undefined;// this.toc = undefined;
if(this.settings.store){this.store(this.settings.store);}if(url){this.open(url,this.settings.openAs).catch(function(error){var err=new Error("Cannot load book at "+url);_this59.emit(_constants$1.EVENTS.BOOK.OPEN_FAILED,err);});}}/**
			   * Open a epub or url
			   * @param {string | ArrayBuffer} input Url, Path or ArrayBuffer
			   * @param {string} [what="binary", "base64", "epub", "opf", "json", "directory"] force opening as a certain type
			   * @returns {Promise} of when the book has been loaded
			   * @example book.open("/path/to/book.epub")
			   */_createClass3(Book,[{key:"open",value:function open(input,what){var opening;var type=what||this.determineType(input);if(type===INPUT_TYPE.BINARY){this.archived=true;this.url=new _url.default("/","");opening=this.openEpub(input);}else if(type===INPUT_TYPE.BASE64){this.archived=true;this.url=new _url.default("/","");opening=this.openEpub(input,type);}else if(type===INPUT_TYPE.EPUB){this.archived=true;this.url=new _url.default("/","");opening=this.request(input,"binary",this.settings.requestCredentials,this.settings.requestHeaders).then(this.openEpub.bind(this));}else if(type==INPUT_TYPE.OPF){this.url=new _url.default(input);opening=this.openPackaging(this.url.Path.toString());}else if(type==INPUT_TYPE.MANIFEST){this.url=new _url.default(input);opening=this.openManifest(this.url.Path.toString());}else{this.url=new _url.default(input);opening=this.openContainer(CONTAINER_PATH).then(this.openPackaging.bind(this));}return opening;}/**
			   * Open an archived epub
			   * @private
			   * @param  {binary} data
			   * @param  {string} [encoding]
			   * @return {Promise}
			   */},{key:"openEpub",value:function openEpub(data,encoding){var _this60=this;return this.unarchive(data,encoding||this.settings.encoding).then(function(){return _this60.openContainer(CONTAINER_PATH);}).then(function(packagePath){return _this60.openPackaging(packagePath);});}/**
			   * Open the epub container
			   * @private
			   * @param  {string} url
			   * @return {string} packagePath
			   */},{key:"openContainer",value:function openContainer(url){var _this61=this;return this.load(url).then(function(xml){_this61.container=new _container.default(xml);return _this61.resolve(_this61.container.packagePath);});}/**
			   * Open the Open Packaging Format Xml
			   * @private
			   * @param  {string} url
			   * @return {Promise}
			   */},{key:"openPackaging",value:function openPackaging(url){var _this62=this;this.path=new _path.default(url);return this.load(url).then(function(xml){_this62.packaging=new _packaging.default(xml);return _this62.unpack(_this62.packaging);});}/**
			   * Open the manifest JSON
			   * @private
			   * @param  {string} url
			   * @return {Promise}
			   */},{key:"openManifest",value:function openManifest(url){var _this63=this;this.path=new _path.default(url);return this.load(url).then(function(json){_this63.packaging=new _packaging.default();_this63.packaging.load(json);return _this63.unpack(_this63.packaging);});}/**
			   * Load a resource from the Book
			   * @param  {string} path path to the resource to load
			   * @return {Promise}     returns a promise with the requested resource
			   */},{key:"load",value:function load(path){var resolved=this.resolve(path);if(this.archived){return this.archive.request(resolved);}else{return this.request(resolved,null,this.settings.requestCredentials,this.settings.requestHeaders);}}/**
			   * Resolve a path to it's absolute position in the Book
			   * @param  {string} path
			   * @param  {boolean} [absolute] force resolving the full URL
			   * @return {string}          the resolved path string
			   */},{key:"resolve",value:function resolve(path,absolute){if(!path){return;}var resolved=path;var isAbsolute=path.indexOf("://")>-1;if(isAbsolute){return path;}if(this.path){resolved=this.path.resolve(path);}if(absolute!=false&&this.url){resolved=this.url.resolve(resolved);}return resolved;}/**
			   * Get a canonical link to a path
			   * @param  {string} path
			   * @return {string} the canonical path string
			   */},{key:"canonical",value:function canonical(path){var url=path;if(!path){return"";}if(this.settings.canonical){url=this.settings.canonical(path);}else{url=this.resolve(path,true);}return url;}/**
			   * Determine the type of they input passed to open
			   * @private
			   * @param  {string} input
			   * @return {string}  binary | directory | epub | opf
			   */},{key:"determineType",value:function determineType(input){var url;var path;var extension;if(this.settings.encoding==="base64"){return INPUT_TYPE.BASE64;}if(typeof input!="string"){return INPUT_TYPE.BINARY;}url=new _url.default(input);path=url.path();extension=path.extension;// If there's a search string, remove it before determining type
if(extension){extension=extension.replace(/\?.*$/,"");}if(!extension){return INPUT_TYPE.DIRECTORY;}if(extension==="epub"){return INPUT_TYPE.EPUB;}if(extension==="opf"){return INPUT_TYPE.OPF;}if(extension==="json"){return INPUT_TYPE.MANIFEST;}}/**
			   * unpack the contents of the Books packaging
			   * @private
			   * @param {Packaging} packaging object
			   */},{key:"unpack",value:function unpack(packaging){var _this64=this;this.package=packaging;//TODO: deprecated this
if(this.packaging.metadata.layout===""){// rendition:layout not set - check display options if book is pre-paginated
this.load(this.url.resolve(IBOOKS_DISPLAY_OPTIONS_PATH)).then(function(xml){_this64.displayOptions=new _displayoptions.default(xml);_this64.loading.displayOptions.resolve(_this64.displayOptions);}).catch(function(err){_this64.displayOptions=new _displayoptions.default();_this64.loading.displayOptions.resolve(_this64.displayOptions);});}else{this.displayOptions=new _displayoptions.default();this.loading.displayOptions.resolve(this.displayOptions);}this.spine.unpack(this.packaging,this.resolve.bind(this),this.canonical.bind(this));this.resources=new _resources.default(this.packaging.manifest,{archive:this.archive,resolver:this.resolve.bind(this),request:this.request.bind(this),replacements:this.settings.replacements||(this.archived?"blobUrl":"base64")});this.loadNavigation(this.packaging).then(function(){// this.toc = this.navigation.toc;
_this64.loading.navigation.resolve(_this64.navigation);});if(this.packaging.coverPath){this.cover=this.resolve(this.packaging.coverPath);}// Resolve promises
this.loading.manifest.resolve(this.packaging.manifest);this.loading.metadata.resolve(this.packaging.metadata);this.loading.spine.resolve(this.spine);this.loading.cover.resolve(this.cover);this.loading.resources.resolve(this.resources);this.loading.pageList.resolve(this.pageList);this.isOpen=true;if(this.archived||this.settings.replacements&&this.settings.replacements!="none"){this.replacements().then(function(){_this64.loaded.displayOptions.then(function(){_this64.opening.resolve(_this64);});}).catch(function(err){console.error(err);});}else{// Resolve book opened promise
this.loaded.displayOptions.then(function(){_this64.opening.resolve(_this64);});}}/**
			   * Load Navigation and PageList from package
			   * @private
			   * @param {Packaging} packaging
			   */},{key:"loadNavigation",value:function loadNavigation(packaging){var _this65=this;var navPath=packaging.navPath||packaging.ncxPath;var toc=packaging.toc;// From json manifest
if(toc){return new Promise(function(resolve,reject){_this65.navigation=new _navigation.default(toc);if(packaging.pageList){_this65.pageList=new _pagelist.default(packaging.pageList);// TODO: handle page lists from Manifest
}resolve(_this65.navigation);});}if(!navPath){return new Promise(function(resolve,reject){_this65.navigation=new _navigation.default();_this65.pageList=new _pagelist.default();resolve(_this65.navigation);});}return this.load(navPath,"xml").then(function(xml){_this65.navigation=new _navigation.default(xml);_this65.pageList=new _pagelist.default(xml);return _this65.navigation;});}/**
			   * Gets a Section of the Book from the Spine
			   * Alias for `book.spine.get`
			   * @param {string} target
			   * @return {Section}
			   */},{key:"section",value:function section(target){return this.spine.get(target);}/**
			   * Sugar to render a book to an element
			   * @param  {element | string} element element or string to add a rendition to
			   * @param  {object} [options]
			   * @return {Rendition}
			   */},{key:"renderTo",value:function renderTo(element,options){this.rendition=new _rendition$1.default(this,options);this.rendition.attachTo(element);return this.rendition;}/**
			   * Set if request should use withCredentials
			   * @param {boolean} credentials
			   */},{key:"setRequestCredentials",value:function setRequestCredentials(credentials){this.settings.requestCredentials=credentials;}/**
			   * Set headers request should use
			   * @param {object} headers
			   */},{key:"setRequestHeaders",value:function setRequestHeaders(headers){this.settings.requestHeaders=headers;}/**
			   * Unarchive a zipped epub
			   * @private
			   * @param  {binary} input epub data
			   * @param  {string} [encoding]
			   * @return {Archive}
			   */},{key:"unarchive",value:function unarchive(input,encoding){this.archive=new _archive.default();return this.archive.open(input,encoding);}/**
			   * Store the epubs contents
			   * @private
			   * @param  {binary} input epub data
			   * @param  {string} [encoding]
			   * @return {Store}
			   */},{key:"store",value:function store(name){var _this66=this;// Use "blobUrl" or "base64" for replacements
var replacementsSetting=this.settings.replacements&&this.settings.replacements!=="none";// Save original url
var originalUrl=this.url;// Save original request method
var requester=this.settings.requestMethod||_request2.default.bind(this);// Create new Store
this.storage=new _store.default(name,requester,this.resolve.bind(this));// Replace request method to go through store
this.request=this.storage.request.bind(this.storage);this.opened.then(function(){if(_this66.archived){_this66.storage.requester=_this66.archive.request.bind(_this66.archive);}// Substitute hook
var substituteResources=function substituteResources(output,section){section.output=_this66.resources.substitute(output,section.url);};// Set to use replacements
_this66.resources.settings.replacements=replacementsSetting||"blobUrl";// Create replacement urls
_this66.resources.replacements().then(function(){return _this66.resources.replaceCss();});_this66.storage.on("offline",function(){// Remove url to use relative resolving for hrefs
_this66.url=new _url.default("/","");// Add hook to replace resources in contents
_this66.spine.hooks.serialize.register(substituteResources);});_this66.storage.on("online",function(){// Restore original url
_this66.url=originalUrl;// Remove hook
_this66.spine.hooks.serialize.deregister(substituteResources);});});return this.storage;}/**
			   * Get the cover url
			   * @return {Promise<?string>} coverUrl
			   */},{key:"coverUrl",value:function coverUrl(){var _this67=this;return this.loaded.cover.then(function(){if(!_this67.cover){return null;}if(_this67.archived){return _this67.archive.createUrl(_this67.cover);}else{return _this67.cover;}});}/**
			   * Load replacement urls
			   * @private
			   * @return {Promise} completed loading urls
			   */},{key:"replacements",value:function replacements(){var _this68=this;this.spine.hooks.serialize.register(function(output,section){section.output=_this68.resources.substitute(output,section.url);});return this.resources.replacements().then(function(){return _this68.resources.replaceCss();});}/**
			   * Find a DOM Range for a given CFI Range
			   * @param  {EpubCFI} cfiRange a epub cfi range
			   * @return {Promise}
			   */},{key:"getRange",value:function getRange(cfiRange){var cfi=new _epubcfi$1.default(cfiRange);var item=this.spine.get(cfi.spinePos);var _request=this.load.bind(this);if(!item){return new Promise(function(resolve,reject){reject("CFI could not be found");});}return item.load(_request).then(function(contents){var range=cfi.toRange(item.document);return range;});}/**
			   * Generates the Book Key using the identifier in the manifest or other string provided
			   * @param  {string} [identifier] to use instead of metadata identifier
			   * @return {string} key
			   */},{key:"key",value:function key(identifier){var ident=identifier||this.packaging.metadata.identifier||this.url.filename;return"epubjs:".concat(_constants$1.EPUBJS_VERSION,":").concat(ident);}/**
			   * Destroy the Book and all associated objects
			   */},{key:"destroy",value:function destroy(){this.opened=undefined;this.loading=undefined;this.loaded=undefined;this.ready=undefined;this.isOpen=false;this.isRendered=false;this.spine&&this.spine.destroy();this.locations&&this.locations.destroy();this.pageList&&this.pageList.destroy();this.archive&&this.archive.destroy();this.resources&&this.resources.destroy();this.container&&this.container.destroy();this.packaging&&this.packaging.destroy();this.rendition&&this.rendition.destroy();this.displayOptions&&this.displayOptions.destroy();this.spine=undefined;this.locations=undefined;this.pageList=undefined;this.archive=undefined;this.resources=undefined;this.container=undefined;this.packaging=undefined;this.rendition=undefined;this.navigation=undefined;this.url=undefined;this.path=undefined;this.archived=false;}}]);return Book;}();//-- Enable binding events to book
(0,_eventEmitter.default)(Book.prototype);var _default$5=Book;book.default=_default$5;var epub={};Object.defineProperty(epub,"__esModule",{value:true});epub.default=void 0;var _book=_interopRequireDefault$2(book);var _rendition=_interopRequireDefault$2(rendition);var _epubcfi=_interopRequireDefault$2(epubcfi);var _contents=_interopRequireDefault$2(contents);var utils=_interopRequireWildcard$2(core);var _constants=constants;_interopRequireDefault$2(iframe);_interopRequireDefault$2(_default$f);_interopRequireDefault$2(continuous);function _getRequireWildcardCache$2(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap();var cacheNodeInterop=new WeakMap();return(_getRequireWildcardCache$2=function _getRequireWildcardCache$2(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard$2(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj;}if(obj===null||_typeof3(obj)!=="object"&&typeof obj!=="function"){return{default:obj};}var cache=_getRequireWildcardCache$2(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj.default=obj;if(cache){cache.set(obj,newObj);}return newObj;}function _interopRequireDefault$2(obj){return obj&&obj.__esModule?obj:{default:obj};}/**
			 * Creates a new Book
			 * @param {string|ArrayBuffer} url URL, Path or ArrayBuffer
			 * @param {object} options to pass to the book
			 * @returns {Book} a new Book object
			 * @example ePub("/path/to/book.epub", {})
			 */function ePub(url,options){return new _book.default(url,options);}ePub.VERSION=_constants.EPUBJS_VERSION;if(typeof commonjsGlobal!=="undefined"){commonjsGlobal.EPUBJS_VERSION=_constants.EPUBJS_VERSION;}ePub.Book=_book.default;ePub.Rendition=_rendition.default;ePub.Contents=_contents.default;ePub.CFI=_epubcfi.default;ePub.utils=utils;var _default$4=ePub;epub.default=_default$4;(function(exports){Object.defineProperty(exports,"__esModule",{value:true});Object.defineProperty(exports,"Book",{enumerable:true,get:function get(){return _book.default;}});Object.defineProperty(exports,"Contents",{enumerable:true,get:function get(){return _contents.default;}});Object.defineProperty(exports,"EpubCFI",{enumerable:true,get:function get(){return _epubcfi.default;}});Object.defineProperty(exports,"Layout",{enumerable:true,get:function get(){return _layout.default;}});Object.defineProperty(exports,"Rendition",{enumerable:true,get:function get(){return _rendition.default;}});exports.default=void 0;var _book=_interopRequireDefault(book);var _epubcfi=_interopRequireDefault(epubcfi);var _rendition=_interopRequireDefault(rendition);var _contents=_interopRequireDefault(contents);var _layout=_interopRequireDefault(layout);var _epub=_interopRequireDefault(epub);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var _default=_epub.default;exports.default=_default;})(lib$1);var style$1={};Object.defineProperty(style$1,"__esModule",{value:true});style$1.default=void 0;var epubViewStyles={viewHolder:{position:'relative',height:'100%',width:'100%'},view:{height:'100%'}};var _default$3=epubViewStyles;style$1.default=_default$3;function _typeof$1(obj){"@babel/helpers - typeof";return _typeof$1="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj;}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;},_typeof$1(obj);}Object.defineProperty(EpubView$1,"__esModule",{value:true});EpubView$1.default=void 0;var _react$1=_interopRequireWildcard$1(react.exports);var _propTypes$1=_interopRequireDefault$1(propTypes.exports);var _index=_interopRequireDefault$1(lib$1);var _style$1=_interopRequireDefault$1(style$1);function _interopRequireDefault$1(obj){return obj&&obj.__esModule?obj:{default:obj};}function _getRequireWildcardCache$1(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap();var cacheNodeInterop=new WeakMap();return(_getRequireWildcardCache$1=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard$1(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj;}if(obj===null||_typeof$1(obj)!=="object"&&typeof obj!=="function"){return{default:obj};}var cache=_getRequireWildcardCache$1(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj.default=obj;if(cache){cache.set(obj,newObj);}return newObj;}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;})),keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty$1(target,key,source[key]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}return target;}function _classCallCheck$1(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties$1(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass$1(Constructor,protoProps,staticProps){if(protoProps)_defineProperties$1(Constructor.prototype,protoProps);if(staticProps)_defineProperties$1(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:false});return Constructor;}function _inherits$1(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function");}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});Object.defineProperty(subClass,"prototype",{writable:false});if(superClass)_setPrototypeOf$1(subClass,superClass);}function _setPrototypeOf$1(o,p){_setPrototypeOf$1=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf$1(o,p);}function _createSuper$1(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct$1();return function _createSuperInternal(){var Super=_getPrototypeOf$1(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf$1(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn$1(this,result);};}function _possibleConstructorReturn$1(self,call){if(call&&(_typeof$1(call)==="object"||typeof call==="function")){return call;}else if(call!==void 0){throw new TypeError("Derived constructors may only return object or undefined");}return _assertThisInitialized$1(self);}function _assertThisInitialized$1(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function _isNativeReflectConstruct$1(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}function _getPrototypeOf$1(o){_getPrototypeOf$1=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf$1(o);}function _defineProperty$1(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}// MTL removed - line does not seem like a requirement any more (and was causing an error)
// global.ePub = Epub; // Fix for v3 branch of epub.js -> needs ePub to by a global var
var EpubView=/*#__PURE__*/function(_Component){_inherits$1(EpubView,_Component);var _super=_createSuper$1(EpubView);function EpubView(props){var _this;_classCallCheck$1(this,EpubView);_this=_super.call(this,props);_defineProperty$1(_assertThisInitialized$1(_this),"onLocationChange",function(loc){var _this$props=_this.props,location=_this$props.location,locationChanged=_this$props.locationChanged;var newLocation=loc&&loc.start;if(location!==newLocation){_this.location=newLocation;locationChanged&&locationChanged(newLocation);}});_defineProperty$1(_assertThisInitialized$1(_this),"handleKeyPress",function(_ref){var key=_ref.key;key&&key==='ArrowRight'&&_this.nextPage();key&&key==='ArrowLeft'&&_this.prevPage();});_this.state={isLoaded:false,toc:[]};_this.viewerRef=/*#__PURE__*/_react$1.default.createRef();_this.location=props.location;_this.book=_this.rendition=_this.prevPage=_this.nextPage=null;return _this;}_createClass$1(EpubView,[{key:"componentDidMount",value:function componentDidMount(){this.initBook(true);document.addEventListener('keyup',this.handleKeyPress,false);}},{key:"initBook",value:function initBook(){var _this2=this;var _this$props2=this.props,url=_this$props2.url,tocChanged=_this$props2.tocChanged,epubInitOptions=_this$props2.epubInitOptions;if(this.book){this.book.destroy();}this.book=new _index.default(url,epubInitOptions);this.book.loaded.navigation.then(function(_ref2){var toc=_ref2.toc;_this2.setState({isLoaded:true,toc:toc},function(){tocChanged&&tocChanged(toc);_this2.initReader();});});}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.book=this.rendition=this.prevPage=this.nextPage=null;document.removeEventListener('keyup',this.handleKeyPress,false);}},{key:"shouldComponentUpdate",value:function shouldComponentUpdate(nextProps){return!this.state.isLoaded||nextProps.location!==this.props.location||nextProps.location!==this.props.location;}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps){if(prevProps.location!==this.props.location&&this.location!==this.props.location){this.rendition.display(this.props.location);}if(prevProps.url!==this.props.url){this.initBook();}}},{key:"initReader",value:function initReader(){var _this3=this;var toc=this.state.toc;var _this$props3=this.props,location=_this$props3.location,epubOptions=_this$props3.epubOptions,getRendition=_this$props3.getRendition;var node=this.viewerRef.current;this.rendition=this.book.renderTo(node,_objectSpread({contained:true,width:'100%',height:'100%'},epubOptions));this.prevPage=function(){_this3.rendition.prev();};this.nextPage=function(){_this3.rendition.next();};this.registerEvents();getRendition&&getRendition(this.rendition);if(typeof location==='string'||typeof location==='number'){this.rendition.display(location);}else if(toc.length>0&&toc[0].href){this.rendition.display(toc[0].href);}else{this.rendition.display();}}},{key:"registerEvents",value:function registerEvents(){var _this$props4=this.props,handleKeyPress=_this$props4.handleKeyPress,handleTextSelected=_this$props4.handleTextSelected;this.rendition.on('locationChanged',this.onLocationChange);this.rendition.on('keyup',handleKeyPress||this.handleKeyPress);if(handleTextSelected){this.rendition.on('selected',handleTextSelected);}}},{key:"renderBook",value:function renderBook(){var styles=this.props.styles;return/*#__PURE__*/_react$1.default.createElement("div",{ref:this.viewerRef,style:styles.view});}},{key:"render",value:function render(){var isLoaded=this.state.isLoaded;var _this$props5=this.props,loadingView=_this$props5.loadingView,styles=_this$props5.styles;return/*#__PURE__*/_react$1.default.createElement("div",{style:styles.viewHolder},isLoaded&&this.renderBook()||loadingView);}}]);return EpubView;}(_react$1.Component);EpubView.defaultProps={loadingView:null,locationChanged:null,tocChanged:null,styles:_style$1.default,epubOptions:{},epubInitOptions:{}};EpubView.propTypes={url:_propTypes$1.default.oneOfType([_propTypes$1.default.string,_propTypes$1.default.instanceOf(ArrayBuffer)]),loadingView:_propTypes$1.default.element,location:_propTypes$1.default.oneOfType([_propTypes$1.default.string,_propTypes$1.default.number]),locationChanged:_propTypes$1.default.func,tocChanged:_propTypes$1.default.func,styles:_propTypes$1.default.object,epubInitOptions:_propTypes$1.default.object,epubOptions:_propTypes$1.default.object,getRendition:_propTypes$1.default.func,handleKeyPress:_propTypes$1.default.func,handleTextSelected:_propTypes$1.default.func};var _default$2=EpubView;EpubView$1.default=_default$2;var ReactReader$1={};function _extends$1(){_extends$1=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};return _extends$1.apply(this,arguments);}var LEFT="Left";var RIGHT="Right";var UP="Up";var DOWN="Down";var defaultProps={delta:10,preventDefaultTouchmoveEvent:false,rotationAngle:0,trackMouse:false,trackTouch:true};var initialState={first:true,initial:[0,0],start:0,swiping:false,xy:[0,0]};var mouseMove="mousemove";var mouseUp="mouseup";var touchEnd="touchend";var touchMove="touchmove";var touchStart="touchstart";function getDirection(absX,absY,deltaX,deltaY){if(absX>absY){if(deltaX>0){return RIGHT;}return LEFT;}else if(deltaY>0){return DOWN;}return UP;}function rotateXYByAngle(pos,angle){if(angle===0)return pos;var angleInRadians=Math.PI/180*angle;var x=pos[0]*Math.cos(angleInRadians)+pos[1]*Math.sin(angleInRadians);var y=pos[1]*Math.cos(angleInRadians)-pos[0]*Math.sin(angleInRadians);return[x,y];}function getHandlers(set,handlerProps){var onStart=function onStart(event){if(event&&"touches"in event&&event.touches.length>1)return;set(function(state,props){if(props.trackMouse){document.addEventListener(mouseMove,onMove);document.addEventListener(mouseUp,onUp);}var _ref="touches"in event?event.touches[0]:event,clientX=_ref.clientX,clientY=_ref.clientY;var xy=rotateXYByAngle([clientX,clientY],props.rotationAngle);return _extends$1({},state,initialState,{initial:[].concat(xy),xy:xy,start:event.timeStamp||0});});};var onMove=function onMove(event){set(function(state,props){if("touches"in event&&event.touches.length>1){return state;}var _ref2="touches"in event?event.touches[0]:event,clientX=_ref2.clientX,clientY=_ref2.clientY;var _rotateXYByAngle=rotateXYByAngle([clientX,clientY],props.rotationAngle),x=_rotateXYByAngle[0],y=_rotateXYByAngle[1];var deltaX=x-state.xy[0];var deltaY=y-state.xy[1];var absX=Math.abs(deltaX);var absY=Math.abs(deltaY);var time=(event.timeStamp||0)-state.start;var velocity=Math.sqrt(absX*absX+absY*absY)/(time||1);var vxvy=[deltaX/(time||1),deltaY/(time||1)];var dir=getDirection(absX,absY,deltaX,deltaY);var delta=typeof props.delta==="number"?props.delta:props.delta[dir.toLowerCase()]||defaultProps.delta;if(absX<delta&&absY<delta&&!state.swiping)return state;var eventData={absX:absX,absY:absY,deltaX:deltaX,deltaY:deltaY,dir:dir,event:event,first:state.first,initial:state.initial,velocity:velocity,vxvy:vxvy};eventData.first&&props.onSwipeStart&&props.onSwipeStart(eventData);props.onSwiping&&props.onSwiping(eventData);var cancelablePageSwipe=false;if(props.onSwiping||props.onSwiped||"onSwiped"+dir in props){cancelablePageSwipe=true;}if(cancelablePageSwipe&&props.preventDefaultTouchmoveEvent&&props.trackTouch&&event.cancelable)event.preventDefault();return _extends$1({},state,{first:false,eventData:eventData,swiping:true});});};var onEnd=function onEnd(event){set(function(state,props){var eventData;if(state.swiping&&state.eventData){eventData=_extends$1({},state.eventData,{event:event});props.onSwiped&&props.onSwiped(eventData);var onSwipedDir=props["onSwiped"+eventData.dir];onSwipedDir&&onSwipedDir(eventData);}else{props.onTap&&props.onTap({event:event});}return _extends$1({},state,initialState,{eventData:eventData});});};var cleanUpMouse=function cleanUpMouse(){document.removeEventListener(mouseMove,onMove);document.removeEventListener(mouseUp,onUp);};var onUp=function onUp(e){cleanUpMouse();onEnd(e);};var attachTouch=function attachTouch(el,passive){var cleanup=function cleanup(){};if(el&&el.addEventListener){var tls=[[touchStart,onStart],[touchMove,onMove],[touchEnd,onEnd]];tls.forEach(function(_ref3){var e=_ref3[0],h=_ref3[1];return el.addEventListener(e,h,{passive:passive});});cleanup=function cleanup(){return tls.forEach(function(_ref4){var e=_ref4[0],h=_ref4[1];return el.removeEventListener(e,h);});};}return cleanup;};var onRef=function onRef(el){if(el===null)return;set(function(state,props){if(state.el===el)return state;var addState={};if(state.el&&state.el!==el&&state.cleanUpTouch){state.cleanUpTouch();addState.cleanUpTouch=undefined;}if(props.trackTouch&&el){addState.cleanUpTouch=attachTouch(el,!props.preventDefaultTouchmoveEvent);}return _extends$1({},state,{el:el},addState);});};var output={ref:onRef};if(handlerProps.trackMouse){output.onMouseDown=onStart;}return[output,attachTouch];}function updateTransientState(state,props,attachTouch){var addState={};if(!props.trackTouch&&state.cleanUpTouch){state.cleanUpTouch();addState.cleanUpTouch=undefined;}else if(props.trackTouch&&!state.cleanUpTouch){if(state.el){addState.cleanUpTouch=attachTouch(state.el,!props.preventDefaultTouchmoveEvent);}}return _extends$1({},state,addState);}function useSwipeable(options){var trackMouse=options.trackMouse;var transientState=react.exports.useRef(_extends$1({},initialState));var transientProps=react.exports.useRef(_extends$1({},defaultProps));transientProps.current=_extends$1({},defaultProps,options);var _React$useMemo=react.exports.useMemo(function(){return getHandlers(function(stateSetter){return transientState.current=stateSetter(transientState.current,transientProps.current);},{trackMouse:trackMouse});},[trackMouse]),handlers=_React$useMemo[0],attachTouch=_React$useMemo[1];transientState.current=updateTransientState(transientState.current,transientProps.current,attachTouch);return handlers;}var reactSwipeable_module=/*#__PURE__*/Object.freeze((_Object$freeze3={__proto__:null},_defineProperty3(_Object$freeze3,Symbol.toStringTag,'Module'),_defineProperty3(_Object$freeze3,"DOWN",DOWN),_defineProperty3(_Object$freeze3,"LEFT",LEFT),_defineProperty3(_Object$freeze3,"RIGHT",RIGHT),_defineProperty3(_Object$freeze3,"UP",UP),_defineProperty3(_Object$freeze3,"useSwipeable",useSwipeable),_Object$freeze3));var require$$2=/*@__PURE__*/getAugmentedNamespace(reactSwipeable_module);var style={};Object.defineProperty(style,"__esModule",{value:true});style.default=void 0;var reactReaderStyles={container:{overflow:'hidden',height:'100%'},readerArea:{position:'relative',zIndex:1,height:'100%',width:'100%',backgroundColor:'#fff',transition:'all .3s ease'},containerExpanded:{transform:'translateX(256px)'},titleArea:{position:'absolute',top:20,left:50,right:50,textAlign:'center',color:'#999'},reader:{position:'absolute',top:50,left:50,bottom:20,right:50},swipeWrapper:{position:'absolute',top:0,left:0,bottom:0,right:0,zIndex:200},prev:{left:1},next:{right:1},arrow:{outline:'none',border:'none',background:'none',position:'absolute',top:'50%',marginTop:-32,fontSize:64,padding:'0 10px',color:'#E2E2E2',fontFamily:'arial, sans-serif',cursor:'pointer',userSelect:'none',appearance:'none',fontWeight:'normal'},arrowHover:{color:'#777'},tocBackground:{position:'absolute',left:256,top:0,bottom:0,right:0,zIndex:1},tocArea:{position:'absolute',left:0,top:0,bottom:0,zIndex:0,width:256,overflowY:'auto',WebkitOverflowScrolling:'touch',background:'#f2f2f2',padding:'10px 0'},tocAreaButton:{userSelect:'none',appearance:'none',background:'none',border:'none',display:'block',fontFamily:'sans-serif',width:'100%',fontSize:'.9em',textAlign:'left',padding:'.9em 1em',borderBottom:'1px solid #ddd',color:'#aaa',boxSizing:'border-box',outline:'none',cursor:'pointer'},tocButton:{background:'none',border:'none',width:32,height:32,position:'absolute',top:10,left:10,borderRadius:2,outline:'none',cursor:'pointer'},tocButtonExpanded:{background:'#f2f2f2'},tocButtonBar:{position:'absolute',width:'60%',background:'#ccc',height:2,left:'50%',margin:'-1px -30%',top:'50%',transition:'all .5s ease'},tocButtonBarTop:{top:'35%'},tocButtonBottom:{top:'66%'},loadingView:{position:'absolute',top:'50%',left:'10%',right:'10%',color:'#ccc',textAlign:'center',margintop:'-.5em'}};var _default$1=reactReaderStyles;style.default=_default$1;function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj;}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;},_typeof(obj);}Object.defineProperty(ReactReader$1,"__esModule",{value:true});ReactReader$1.default=void 0;var _react=_interopRequireWildcard(react.exports);var _propTypes=_interopRequireDefault(propTypes.exports);var _reactSwipeable=require$$2;var _=lib$2;var _style=_interopRequireDefault(style);var _excluded=["children"],_excluded2=["title","showToc","loadingView","styles","locationChanged","swipeable","epubViewStyles"];function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap();var cacheNodeInterop=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj;}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{default:obj};}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj.default=obj;if(cache){cache.set(obj,newObj);}return newObj;}function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};return _extends.apply(this,arguments);}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:false});return Constructor;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function");}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});Object.defineProperty(subClass,"prototype",{writable:false});if(superClass)_setPrototypeOf(subClass,superClass);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call;}else if(call!==void 0){throw new TypeError("Derived constructors may only return object or undefined");}return _assertThisInitialized(self);}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf(o);}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _objectWithoutProperties(source,excluded){if(source==null)return{};var target=_objectWithoutPropertiesLoose(source,excluded);var key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];if(excluded.indexOf(key)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(source,key))continue;target[key]=source[key];}}return target;}function _objectWithoutPropertiesLoose(source,excluded){if(source==null)return{};var target={};var sourceKeys=Object.keys(source);var key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(excluded.indexOf(key)>=0)continue;target[key]=source[key];}return target;}var Swipeable=function Swipeable(_ref){var children=_ref.children,props=_objectWithoutProperties(_ref,_excluded);var handlers=(0,_reactSwipeable.useSwipeable)(props);return/*#__PURE__*/_react.default.createElement("div",handlers,children);};var TocItem=/*#__PURE__*/function(_PureComponent){_inherits(TocItem,_PureComponent);var _super=_createSuper(TocItem);function TocItem(){var _this;_classCallCheck(this,TocItem);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_defineProperty(_assertThisInitialized(_this),"setLocation",function(){_this.props.setLocation(_this.props.href);});return _this;}_createClass(TocItem,[{key:"render",value:function render(){var _this$props=this.props,label=_this$props.label,styles=_this$props.styles;return/*#__PURE__*/_react.default.createElement("button",{onClick:this.setLocation,style:styles},label);}}]);return TocItem;}(_react.PureComponent);TocItem.propTypes={label:_propTypes.default.string,href:_propTypes.default.string,setLocation:_propTypes.default.func,styles:_propTypes.default.object};var ReactReader=/*#__PURE__*/function(_PureComponent2){_inherits(ReactReader,_PureComponent2);var _super2=_createSuper(ReactReader);function ReactReader(props){var _this2;_classCallCheck(this,ReactReader);_this2=_super2.call(this,props);_defineProperty(_assertThisInitialized(_this2),"toggleToc",function(){_this2.setState({expandedToc:!_this2.state.expandedToc});});_defineProperty(_assertThisInitialized(_this2),"next",function(){var node=_this2.readerRef.current;node.nextPage();});_defineProperty(_assertThisInitialized(_this2),"prev",function(){var node=_this2.readerRef.current;node.prevPage();});_defineProperty(_assertThisInitialized(_this2),"onTocChange",function(toc){var tocChanged=_this2.props.tocChanged;_this2.setState({toc:toc},function(){return tocChanged&&tocChanged(toc);});});_defineProperty(_assertThisInitialized(_this2),"setLocation",function(loc){var locationChanged=_this2.props.locationChanged;_this2.setState({expandedToc:false},function(){return locationChanged&&locationChanged(loc);});});_this2.readerRef=/*#__PURE__*/_react.default.createRef();_this2.state={expandedToc:false,toc:false};return _this2;}_createClass(ReactReader,[{key:"renderToc",value:function renderToc(){var _this3=this;var _this$state=this.state,toc=_this$state.toc,expandedToc=_this$state.expandedToc;var styles=this.props.styles;return/*#__PURE__*/_react.default.createElement("div",null,/*#__PURE__*/_react.default.createElement("div",{style:styles.tocArea},/*#__PURE__*/_react.default.createElement("div",{style:styles.toc},toc.map(function(item,i){return/*#__PURE__*/_react.default.createElement(TocItem,_extends({},item,{key:i,setLocation:_this3.setLocation,styles:styles.tocAreaButton}));}))),expandedToc&&/*#__PURE__*/_react.default.createElement("div",{style:styles.tocBackground,onClick:this.toggleToc}));}},{key:"renderTocToggle",value:function renderTocToggle(){var expandedToc=this.state.expandedToc;var styles=this.props.styles;return/*#__PURE__*/_react.default.createElement("button",{style:Object.assign({},styles.tocButton,expandedToc?styles.tocButtonExpanded:{}),onClick:this.toggleToc},/*#__PURE__*/_react.default.createElement("span",{style:Object.assign({},styles.tocButtonBar,styles.tocButtonBarTop)}),/*#__PURE__*/_react.default.createElement("span",{style:Object.assign({},styles.tocButtonBar,styles.tocButtonBottom)}));}},{key:"render",value:function render(){var _this$props2=this.props,title=_this$props2.title,showToc=_this$props2.showToc,loadingView=_this$props2.loadingView,styles=_this$props2.styles,locationChanged=_this$props2.locationChanged,swipeable=_this$props2.swipeable,epubViewStyles=_this$props2.epubViewStyles,props=_objectWithoutProperties(_this$props2,_excluded2);var _this$state2=this.state,toc=_this$state2.toc,expandedToc=_this$state2.expandedToc;return/*#__PURE__*/_react.default.createElement("div",{style:styles.container},/*#__PURE__*/_react.default.createElement("div",{style:Object.assign({},styles.readerArea,expandedToc?styles.containerExpanded:{})},showToc&&this.renderTocToggle(),/*#__PURE__*/_react.default.createElement("div",{style:styles.titleArea},title),/*#__PURE__*/_react.default.createElement(Swipeable,{onSwipedRight:this.prev,onSwipedLeft:this.next,trackMouse:true},/*#__PURE__*/_react.default.createElement("div",{style:styles.reader},/*#__PURE__*/_react.default.createElement(_.EpubView,_extends({ref:this.readerRef,loadingView:loadingView,styles:epubViewStyles},props,{tocChanged:this.onTocChange,locationChanged:locationChanged})),swipeable&&/*#__PURE__*/_react.default.createElement("div",{style:styles.swipeWrapper}))),/*#__PURE__*/_react.default.createElement("button",{style:Object.assign({},styles.arrow,styles.prev),onClick:this.prev},"\u2039"),/*#__PURE__*/_react.default.createElement("button",{style:Object.assign({},styles.arrow,styles.next),onClick:this.next},"\u203A")),showToc&&toc&&this.renderToc());}}]);return ReactReader;}(_react.PureComponent);ReactReader.defaultProps={loadingView:/*#__PURE__*/_react.default.createElement("div",{style:_style.default.loadingView},"Loading\u2026"),locationChanged:null,tocChanged:null,showToc:true,styles:_style.default};ReactReader.propTypes={title:_propTypes.default.string,loadingView:_propTypes.default.element,showToc:_propTypes.default.bool,locationChanged:_propTypes.default.func,tocChanged:_propTypes.default.func,styles:_propTypes.default.object,epubViewStyles:_propTypes.default.object,swipeable:_propTypes.default.bool};var _default=ReactReader;ReactReader$1.default=_default;(function(exports){Object.defineProperty(exports,"__esModule",{value:true});Object.defineProperty(exports,"EpubView",{enumerable:true,get:function get(){return _EpubView.default;}});Object.defineProperty(exports,"EpubViewStyle",{enumerable:true,get:function get(){return _style.default;}});Object.defineProperty(exports,"ReactReader",{enumerable:true,get:function get(){return _ReactReader.default;}});Object.defineProperty(exports,"ReactReaderStyle",{enumerable:true,get:function get(){return _style2.default;}});var _EpubView=_interopRequireDefault(EpubView$1);var _style=_interopRequireDefault(style$1);var _ReactReader=_interopRequireDefault(ReactReader$1);var _style2=_interopRequireDefault(style);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}})(lib$2);var useUnfold=function useUnfold(){var display=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var _react$exports$useCon2=react.exports.useContext(IContext),setShowUnfold=_react$exports$useCon2.setShowUnfold,unfold=_react$exports$useCon2.unfold;react.exports.useEffect(function(){if(display){setShowUnfold(true);}return function(){setShowUnfold(false);};},[]);return{unfold:unfold,setShowUnfold:setShowUnfold};};var type$6=-1;var exts$6=["epub"];var Epub=function Epub(_ref19){var file=_ref19.file;var _react$exports$useSta=react.exports.useState(void 0),_react$exports$useSta2=_slicedToArray2(_react$exports$useSta,2),location=_react$exports$useSta2[0],setLocation=_react$exports$useSta2[1];var locationChanged=function locationChanged(epubcifi){setLocation(epubcifi);};var _useUnfold=useUnfold(true),unfold=_useUnfold.unfold;var fileUrl=useFileUrl();return/* @__PURE__ */React$1.createElement(Box,{w:"full",h:unfold?"full":"75vh",pos:unfold?"fixed":"unset",left:unfold?"0":"unset",top:unfold?"0":"unset",transition:"all 0.3s",backdropFilter:"blur(10px)",className:"epub-box"},/* @__PURE__ */React$1.createElement(lib$2.ReactReader,{location:location,locationChanged:locationChanged,url:fileUrl()}));};var __glob_7_2=/*#__PURE__*/Object.freeze((_Object$freeze4={__proto__:null},_defineProperty3(_Object$freeze4,Symbol.toStringTag,'Module'),_defineProperty3(_Object$freeze4,"type",type$6),_defineProperty3(_Object$freeze4,"exts",exts$6),_defineProperty3(_Object$freeze4,'default',Epub),_Object$freeze4));var type$5=6;var exts$5=[];var ImagePreview=function ImagePreview(_ref20){var file=_ref20.file;var fileUrl=useFileUrl();var _react$exports$useSta3=react.exports.useState(""),_react$exports$useSta4=_slicedToArray2(_react$exports$useSta3,2),url=_react$exports$useSta4[0],setUrl=_react$exports$useSta4[1];var _react$exports$useCon3=react.exports.useContext(IContext),getSetting=_react$exports$useCon3.getSetting,password=_react$exports$useCon3.password;react.exports.useEffect(function(){setUrl(fileUrl(file));},[]);return/* @__PURE__ */React$1.createElement(Center,{className:"image-box",w:"full"},/* @__PURE__ */React$1.createElement(Image$1,{maxH:"75vh",fallback:/* @__PURE__ */React$1.createElement(Spinner,{color:getSetting("icon color")||"#1890ff",size:"xl"}),rounded:"lg",src:url}));};var __glob_7_3=/*#__PURE__*/Object.freeze((_Object$freeze5={__proto__:null},_defineProperty3(_Object$freeze5,Symbol.toStringTag,'Module'),_defineProperty3(_Object$freeze5,"type",type$5),_defineProperty3(_Object$freeze5,"exts",exts$5),_defineProperty3(_Object$freeze5,'default',ImagePreview),_Object$freeze5));var back_end_address="/";if(back_end_address==="/"){back_end_address=window.location.origin+"/";}var host=back_end_address;var type$4=-1;var exts$4=["ipa"];var Ipa=function Ipa(_ref21){var file=_ref21.file;var _react$exports$useCon4=react.exports.useContext(IContext),getSetting=_react$exports$useCon4.getSetting;var ext=file.name.split(".").pop()||"";var fileUrl=useFileUrl();var _useTranslation2=useTranslation(),t=_useTranslation2.t;var url=fileUrl();var _react$exports$useSta5=react.exports.useState(false),_react$exports$useSta6=_slicedToArray2(_react$exports$useSta5,2),installing=_react$exports$useSta6[0],setInstalling=_react$exports$useSta6[1];return/* @__PURE__ */React$1.createElement(Center,{className:"no-preview",p:"4"},/* @__PURE__ */React$1.createElement(VStack,{spacing:"8"},/* @__PURE__ */React$1.createElement(Icon,{color:getSetting("icon color")||"#1890ff",boxSize:20,as:getIcon(file.type,ext)}),/* @__PURE__ */React$1.createElement(Heading,{size:"md"},file.name),/* @__PURE__ */React$1.createElement(HStack,{spacing:"8"},/* @__PURE__ */React$1.createElement(Button,{onClick:function onClick(){window.open(url,"_blank");}},t("Download")),/* @__PURE__ */React$1.createElement(Link,{href:"itms-services://?action=download-manifest&url=".concat(host,"i/").concat(btoa(url).replaceAll("/","_").replaceAll("=","-"),"/ipa.plist")},/* @__PURE__ */React$1.createElement(Button,{onClick:function onClick(){setInstalling(true);},colorScheme:"green"},installing?t("Installing"):t("Install"))))));};var __glob_7_4=/*#__PURE__*/Object.freeze((_Object$freeze6={__proto__:null},_defineProperty3(_Object$freeze6,Symbol.toStringTag,'Module'),_defineProperty3(_Object$freeze6,"type",type$4),_defineProperty3(_Object$freeze6,"exts",exts$4),_defineProperty3(_Object$freeze6,'default',Ipa),_Object$freeze6));var type$3=-1;var exts$3=[];var Pdf=function Pdf(_ref22){var url=_ref22.url,unfold=_ref22.unfold;return/* @__PURE__ */React$1.createElement(Center,{w:"full",h:"full",className:"pdf-preview-box"},/* @__PURE__ */React$1.createElement("iframe",{title:"pdf-viewer",width:"100%",height:"100%",src:"https://alist-org.github.io/pdf.js/web/viewer.html?file=".concat(url)}));};var __glob_7_7=/*#__PURE__*/Object.freeze((_Object$freeze7={__proto__:null},_defineProperty3(_Object$freeze7,Symbol.toStringTag,'Module'),_defineProperty3(_Object$freeze7,"type",type$3),_defineProperty3(_Object$freeze7,"exts",exts$3),_defineProperty3(_Object$freeze7,'default',Pdf),_Object$freeze7));var type$2=2;var exts$2=[];var Office=function Office(_ref23){var file=_ref23.file;var _useLocation=useLocation(),pathname=_useLocation.pathname;var _react$exports$useCon5=react.exports.useContext(IContext),password=_react$exports$useCon5.password;var fileUrl=useFileUrl(false,false);var _useUnfold2=useUnfold(false),unfold=_useUnfold2.unfold,setShowUnfold=_useUnfold2.setShowUnfold;var _React$1$useState5=React$1.useState(""),_React$1$useState6=_slicedToArray2(_React$1$useState5,2),show=_React$1$useState6[0],setShow=_React$1$useState6[1];var _React$1$useState7=React$1.useState(""),_React$1$useState8=_slicedToArray2(_React$1$useState7,2),pdf=_React$1$useState8[0],setPdf=_React$1$useState8[1];var url=fileUrl();var _React$1$useState9=React$1.useState("office"),_React$1$useState10=_slicedToArray2(_React$1$useState9,2),office=_React$1$useState10[0],setOffice=_React$1$useState10[1];var previews=[{name:"office",url:"https://view.officeapps.live.com/op/view.aspx?src=".concat(encodeURIComponent(url))},{name:"google",url:"https://docs.google.com/gview?url=".concat(encodeURIComponent(url),"&embedded=true")}];var refresh=function refresh(){if(file.driver==="AliDrive"){instance.post("preview",{path:pathname,password:password}).then(function(resp){var res=resp.data;if(res.code!==200){return;}var docOptions=aliyun.config({mount:document.querySelector("#office-preview"),url:res.data.preview_url});docOptions.setToken({token:res.data.access_token});});}else{if(file.name.endsWith(".pdf")){setPdf(fileUrl());setShow("pdf");}else{setShow("office");}setShowUnfold(true);}};react.exports.useEffect(function(){refresh();},[]);return/* @__PURE__ */React$1.createElement(Box,{w:"full",h:unfold?"full":"75vh",pos:unfold?"fixed":"unset",left:unfold?"0":"unset",top:unfold?"0":"unset",id:"office-preview",transition:"all 0.3s",backdropFilter:"blur(10px)",className:"office-preview-box"},show==="office"&&/* @__PURE__ */React$1.createElement(Box,{w:"full",h:"full"},/* @__PURE__ */React$1.createElement(RadioGroup,{m:"1",onChange:setOffice,value:office},/* @__PURE__ */React$1.createElement(Stack,{direction:"row"},previews.map(function(preview){return/* @__PURE__ */React$1.createElement(Radio,{value:preview.name,key:preview.name},preview.name);}))),previews.map(function(preview){return preview.name===office&&/* @__PURE__ */React$1.createElement("iframe",{key:preview.name,width:"100%",style:{height:"calc(100% - 24px - 0.25rem)"},src:preview.url,frameBorder:"0"});})),show==="pdf"&&/* @__PURE__ */React$1.createElement(Pdf,{url:pdf,unfold:unfold||false}));};var __glob_7_6=/*#__PURE__*/Object.freeze((_Object$freeze8={__proto__:null},_defineProperty3(_Object$freeze8,Symbol.toStringTag,'Module'),_defineProperty3(_Object$freeze8,"type",type$2),_defineProperty3(_Object$freeze8,"exts",exts$2),_defineProperty3(_Object$freeze8,'default',Office),_Object$freeze8));var type$1=-1;var exts$1=["plist"];var Plist=function Plist(_ref24){var file=_ref24.file;var _react$exports$useCon6=react.exports.useContext(IContext),getSetting=_react$exports$useCon6.getSetting;var ext=file.name.split(".").pop()||"";var fileUrl=useFileUrl();var _useTranslation3=useTranslation(),t=_useTranslation3.t;var url=fileUrl();var _react$exports$useSta7=react.exports.useState(false),_react$exports$useSta8=_slicedToArray2(_react$exports$useSta7,2),installing=_react$exports$useSta8[0],setInstalling=_react$exports$useSta8[1];return/* @__PURE__ */React$1.createElement(Center,{className:"no-preview",p:"4"},/* @__PURE__ */React$1.createElement(VStack,{spacing:"8"},/* @__PURE__ */React$1.createElement(Icon,{color:getSetting("icon color")||"#1890ff",boxSize:20,as:getIcon(file.type,ext)}),/* @__PURE__ */React$1.createElement(Heading,{size:"md"},file.name),/* @__PURE__ */React$1.createElement(HStack,{spacing:"8"},/* @__PURE__ */React$1.createElement(Button,{onClick:function onClick(){window.open(url,"_blank");}},t("Download")),/* @__PURE__ */React$1.createElement(Link,{href:"itms-services://?action=download-manifest&url="+url},/* @__PURE__ */React$1.createElement(Button,{onClick:function onClick(){setInstalling(true);},colorScheme:"green"},installing?t("Installing"):t("Install"))))));};var __glob_7_8=/*#__PURE__*/Object.freeze((_Object$freeze9={__proto__:null},_defineProperty3(_Object$freeze9,Symbol.toStringTag,'Module'),_defineProperty3(_Object$freeze9,"type",type$1),_defineProperty3(_Object$freeze9,"exts",exts$1),_defineProperty3(_Object$freeze9,'default',Plist),_Object$freeze9));var artplayer={exports:{}};/*!
			 * artplayer.js v4.3.1
			 * Github: https://github.com/zhw2590582/ArtPlayer#readme
			 * (c) 2017-2022 Harvey Zack
			 * Released under the MIT License.
			 */(function(module,exports){!function(t,e){module.exports=e();}(commonjsGlobal,function(){function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function");}function e(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n);}}function r(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;}function n(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}function o(t,e){return o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t;},o(t,e);}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&o(t,e);}function a(t){return a="function"==typeof Symbol&&"symbol"==_typeof3(Symbol.iterator)?function(t){return _typeof3(t);}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof3(t);},a(t);}function c(t,e){if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return n(t);}function l(t){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);},l(t);}!function(t,e){void 0===e&&(e={});var r=e.insertAt;if(t&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===r&&n.firstChild?n.insertBefore(o,n.firstChild):n.appendChild(o),o.styleSheet?o.styleSheet.cssText=t:o.appendChild(document.createTextNode(t));}}('.art-video-player{zoom:1;-webkit-tap-highlight-color:rgba(0,0,0,0);-ms-high-contrast-adjust:none;background-color:#000;color:#eee;direction:ltr;display:flex;font-family:Roboto,Arial,Helvetica,sans-serif;font-size:14px;height:100%;line-height:1.3;margin:0 auto;outline:0;position:relative;text-align:left;touch-action:manipulation;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:100%;z-index:20}.art-video-player *{box-sizing:border-box;margin:0;padding:0}.art-video-player ::-webkit-scrollbar{height:5px;width:5px}.art-video-player ::-webkit-scrollbar-thumb{background-color:#666}.art-video-player ::-webkit-scrollbar-thumb:hover{background-color:#ccc}.art-video-player .art-icon{align-items:center;display:inline-flex;justify-content:center;line-height:1.5}.art-video-player .art-icon svg{fill:#fff}.art-video-player img{max-width:100%;vertical-align:top}@supports ((-webkit-backdrop-filter:initial) or (backdrop-filter:initial)){.art-video-player .art-backdrop-filter{-webkit-backdrop-filter:saturate(180%) blur(20px);backdrop-filter:saturate(180%) blur(20px);background-color:rgba(0,0,0,.7)!important}}.art-video-player .art-video{background-color:#000;cursor:pointer;z-index:10}.art-video-player .art-poster,.art-video-player .art-video{bottom:0;height:100%;left:0;position:absolute;right:0;top:0;width:100%}.art-video-player .art-poster{background-position:50%;background-repeat:no-repeat;background-size:cover;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;z-index:11}.art-video-player .art-subtitle{bottom:10px;color:#fff;display:none;font-size:20px;padding:0 20px;pointer-events:none;position:absolute;text-align:center;text-shadow:.5px .5px .5px rgba(0,0,0,.5);width:100%;z-index:20}.art-video-player .art-subtitle p{height:-webkit-fit-content;height:-moz-fit-content;height:fit-content;line-height:1.2;margin:5px 0 0;word-break:break-all}.art-video-player .art-bilingual p:nth-child(n+2){transform:scale(.6);transform-origin:center top}.art-video-player.art-subtitle-show .art-subtitle{display:block}.art-video-player.art-control-show .art-subtitle{bottom:50px}.art-video-player .art-danmuku{z-index:30}.art-video-player .art-danmuku,.art-video-player .art-layers{bottom:0;height:100%;left:0;overflow:hidden;pointer-events:none;position:absolute;right:0;top:0;width:100%}.art-video-player .art-layers{display:none;z-index:40}.art-video-player .art-layers .art-layer{pointer-events:auto}.art-video-player.art-layer-show .art-layers{display:block}.art-video-player .art-mask{align-items:center;bottom:0;display:none;height:100%;justify-content:center;left:0;overflow:hidden;pointer-events:none;position:absolute;right:0;top:0;width:100%;z-index:50}.art-video-player .art-mask .art-state{align-items:center;bottom:65px;display:flex;height:60px;justify-content:center;opacity:.6;position:absolute;right:30px;width:60px}.art-video-player.art-mask-show .art-mask{display:flex}.art-video-player .art-loading{align-items:center;bottom:0;display:none;height:100%;justify-content:center;left:0;pointer-events:none;position:absolute;right:0;top:0;width:100%;z-index:70}.art-video-player.art-loading-show .art-loading{display:flex}.art-video-player .art-bottom{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAADGCAYAAAAT+OqFAAAAdklEQVQoz42QQQ7AIAgEF/T/D+kbq/RWAlnQyyazA4aoAB4FsBSA/bFjuF1EOL7VbrIrBuusmrt4ZZORfb6ehbWdnRHEIiITaEUKa5EJqUakRSaEYBJSCY2dEstQY7AuxahwXFrvZmWl2rh4JZ07z9dLtesfNj5q0FU3A5ObbwAAAABJRU5ErkJggg==) repeat-x bottom;bottom:0;display:flex;flex-direction:column;height:100px;justify-content:space-between;left:0;opacity:0;padding:50px 10px 0;pointer-events:none;position:absolute;right:0;transition:all .2s ease-in-out;visibility:hidden;z-index:60}.art-video-player .art-bottom .art-progress{pointer-events:auto;position:relative;z-index:0}.art-video-player .art-bottom .art-progress .art-control-progress{align-items:center;cursor:pointer;display:flex;flex-direction:row;height:4px;position:relative}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner{align-items:center;background:hsla(0,0%,100%,.2);display:flex;height:50%;position:relative;width:100%}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-loaded{background:hsla(0,0%,100%,.4);bottom:0;height:100%;left:0;position:absolute;right:0;top:0;width:0;z-index:10}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-played{bottom:0;height:100%;left:0;position:absolute;right:0;top:0;width:0;z-index:20}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-highlight{bottom:0;height:100%;left:0;pointer-events:none;position:absolute;right:0;top:0;z-index:30}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-highlight span{background:#fff;display:inline-block;height:100%;left:0;pointer-events:auto;position:absolute;top:0;width:7px}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator{align-items:center;border-radius:50%;justify-content:center;position:absolute;transform:scale(.1);transition:transform .1s ease-in-out;visibility:hidden;z-index:40}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator .art-icon{height:100%;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:100%}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-tip{background:rgba(0,0,0,.7);border-radius:3px;color:#fff;display:none;font-size:12px;font-weight:700;height:20px;left:0;line-height:20px;padding:0 5px;position:absolute;text-align:center;top:-25px;white-space:nowrap;z-index:50}.art-video-player .art-bottom .art-progress .art-control-thumbnails{background-color:rgba(0,0,0,.7);bottom:8px;display:none;left:0;pointer-events:none;position:absolute}.art-video-player .art-bottom .art-progress .art-control-loop{bottom:0;display:none;height:100%;left:0;pointer-events:none;position:absolute;right:0;top:0;width:100%}.art-video-player .art-bottom .art-progress .art-control-loop .art-loop-point{background:hsla(0,0%,100%,.75);height:8px;left:0;position:absolute;top:-2px;width:2px}.art-video-player .art-bottom .art-controls{align-items:center;display:flex;height:45px;justify-content:space-between;pointer-events:auto;position:relative;z-index:1}.art-video-player .art-bottom .art-controls .art-controls-left,.art-video-player .art-bottom .art-controls .art-controls-right{display:flex}.art-video-player .art-bottom .art-controls .art-control{align-items:center;cursor:pointer;display:flex;font-size:12px;line-height:1;min-height:36px;min-width:36px;opacity:.9;text-align:center;white-space:nowrap}.art-video-player .art-bottom .art-controls .art-control .art-icon{align-items:center;display:flex;float:left;height:36px;justify-content:center;width:36px}.art-video-player .art-bottom .art-controls .art-control:hover{opacity:1}.art-video-player .art-bottom .art-controls .art-control-onlyText{padding:0 10px}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel{float:left;height:100%;overflow:hidden;position:relative;transition:margin .2s cubic-bezier(.4,0,1,1),width .2s cubic-bezier(.4,0,1,1);width:0}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle{background:#fff;border-radius:12px;height:12px;left:0;margin-top:-6px;position:absolute;top:50%;width:12px}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:before{background:#fff;left:-54px}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:after{background:hsla(0,0%,100%,.2);left:6px}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:after,.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:before{content:"";display:block;height:3px;margin-top:-2px;position:absolute;top:50%;width:60px}.art-video-player .art-bottom .art-controls .art-control-volume:hover .art-volume-panel{width:60px}.art-video-player .art-bottom .art-controls .art-control-quality{position:relative;z-index:30}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys{background:rgba(0,0,0,.8);border-radius:3px;bottom:35px;color:#fff;display:none;padding:5px 0;position:absolute;text-align:center;width:100px}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys .art-quality-item{height:30px;line-height:30px;overflow:hidden;text-overflow:ellipsis;text-shadow:0 0 2px rgba(0,0,0,.5);white-space:nowrap}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys .art-quality-item:hover{background-color:hsla(0,0%,100%,.1)}.art-video-player .art-bottom .art-controls .art-control-quality:hover .art-qualitys{display:block}.art-video-player .art-bottom:hover .art-progress .art-control-progress .art-control-progress-inner{height:100%}.art-video-player .art-bottom:hover .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator{transform:scale(1);visibility:visible}.art-video-player.art-control-show .art-bottom,.art-video-player.art-hover .art-bottom{opacity:1;visibility:visible}.art-video-player.art-destroy .art-progress-indicator,.art-video-player.art-destroy .art-progress-tip,.art-video-player.art-error .art-progress-indicator,.art-video-player.art-error .art-progress-tip{display:none!important}.art-video-player.art-mobile .art-progress-indicator{transform:scale(1)!important;visibility:visible!important}.art-video-player .art-notice{display:none;font-size:14px;left:0;padding:10px;pointer-events:none;position:absolute;top:0;width:100%;z-index:80}.art-video-player .art-notice .art-notice-inner{background-color:rgba(0,0,0,.6);border-radius:3px;color:#fff;display:inline-block;padding:5px 10px}.art-video-player.art-notice-show .art-notice{display:flex}.art-video-player .art-contextmenus{background-color:rgba(0,0,0,.9);border-radius:3px;display:none;flex-direction:column;left:10px;min-width:200px;padding:5px 0;position:absolute;top:10px;z-index:120}.art-video-player .art-contextmenus .art-contextmenu{border-bottom:1px solid hsla(0,0%,100%,.1);color:#fff;cursor:pointer;display:block;font-size:12px;overflow:hidden;padding:10px 15px;text-overflow:ellipsis;text-shadow:0 0 2px rgba(0,0,0,.5);white-space:nowrap}.art-video-player .art-contextmenus .art-contextmenu a{color:#fff;text-decoration:none}.art-video-player .art-contextmenus .art-contextmenu span{display:inline-block;padding:0 7px}.art-video-player .art-contextmenus .art-contextmenu span.art-current,.art-video-player .art-contextmenus .art-contextmenu span:hover{color:#00c9ff}.art-video-player .art-contextmenus .art-contextmenu:hover{background-color:hsla(0,0%,100%,.1)}.art-video-player .art-contextmenus .art-contextmenu:last-child{border-bottom:none}.art-video-player.art-contextmenu-show .art-contextmenus{display:flex}.art-video-player .art-settings{background-color:rgba(0,0,0,.9);border-radius:3px;bottom:50px;display:none;font-size:13px;max-height:300px;overflow:auto;position:absolute;right:10px;transition:all .2s ease;z-index:90}.art-video-player .art-settings .art-setting-panel{display:none}.art-video-player .art-settings .art-setting-panel.art-current{display:block}.art-video-player .art-settings .art-setting-panel .art-setting-item{align-items:center;color:hsla(0,0%,100%,.8);cursor:pointer;display:flex;height:35px;justify-content:space-between;line-height:1;overflow:hidden;padding:0 5px}.art-video-player .art-settings .art-setting-panel .art-setting-item.art-current,.art-video-player .art-settings .art-setting-panel .art-setting-item:hover{background-color:hsla(0,0%,100%,.1);color:#fff}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-icon{align-items:center;display:flex;height:30px;justify-content:center;width:30px}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-icon-check{height:15px;visibility:hidden}.art-video-player .art-settings .art-setting-panel .art-setting-item.art-current .art-icon-check{visibility:visible}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-left{align-items:center;display:flex;white-space:nowrap}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-left .art-setting-item-left-icon{align-items:center;display:flex;height:24px;justify-content:center;margin-right:10px;width:24px}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right{align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-item-right-tooltip{color:hsla(0,0%,100%,.5);font-size:12px;white-space:nowrap}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-item-right-icon{align-items:center;display:flex;height:24px;justify-content:center;width:24px}.art-video-player .art-settings .art-setting-panel .art-setting-item-back{border-bottom:1px solid hsla(0,0%,100%,.1)}.art-video-player.art-setting-show .art-settings{display:block}.art-video-player .art-info{-webkit-font-smoothing:antialiased;background-color:rgba(0,0,0,.9);color:#fff;display:none;flex-direction:column;font-family:Noto Sans CJK SC DemiLight,Roboto,Segoe UI,Tahoma,Arial,Helvetica,sans-serif;font-size:12px;left:10px;padding:10px;position:absolute;top:10px;width:350px;z-index:100}.art-video-player .art-info .art-info-item{display:flex;margin-bottom:5px}.art-video-player .art-info .art-info-item .art-info-title{text-align:right;width:100px}.art-video-player .art-info .art-info-item .art-info-content{flex:1;overflow:hidden;padding-left:5px;text-overflow:ellipsis;white-space:nowrap}.art-video-player .art-info .art-info-item:last-child{margin-bottom:0}.art-video-player .art-info .art-info-close{cursor:pointer;position:absolute;right:5px;top:5px}.art-video-player.art-info-show .art-info{display:flex}.art-video-player.art-hide-cursor *{cursor:none!important}.art-video-player[data-aspect-ratio] video{box-sizing:content-box;-o-object-fit:fill;object-fit:fill}.art-video-player.art-fullscreen-web{bottom:0;height:100%!important;left:0;position:fixed;right:0;top:0;width:100%!important;z-index:9999}.art-fullscreen-rotate{background-color:#000;bottom:0;height:100%;left:0;position:fixed;right:0;top:0;width:100%;z-index:9999}.art-video-player .art-mini-header{align-items:center;background-color:rgba(0,0,0,.5);color:#fff;display:none;height:35px;justify-content:space-between;left:0;line-height:35px;opacity:0;position:absolute;right:0;top:0;transition:all .2s ease-in-out;visibility:hidden;z-index:110}.art-video-player .art-mini-header .art-mini-title{cursor:move;flex:1;overflow:hidden;padding:0 10px;text-overflow:ellipsis;white-space:nowrap}.art-video-player .art-mini-header .art-mini-close{cursor:pointer;font-size:22px;text-align:center;width:35px}.art-video-player.art-is-dragging{opacity:.7}.art-video-player.art-mini{box-shadow:0 2px 5px 0 rgba(0,0,0,.16),0 3px 6px 0 rgba(0,0,0,.2);height:225px;position:fixed;width:400px;z-index:9999}.art-video-player.art-mini .art-mini-header{display:flex;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.art-video-player.art-mini.art-hover .art-mini-header{opacity:1;visibility:visible}.art-video-player.art-mini .art-mask .art-state{position:static}.art-video-player.art-mini .art-bottom,.art-video-player.art-mini .art-contextmenu,.art-video-player.art-mini .art-danmu,.art-video-player.art-mini .art-info,.art-video-player.art-mini .art-layers,.art-video-player.art-mini .art-notice,.art-video-player.art-mini .art-setting,.art-video-player.art-mini .art-subtitle{display:none!important}.art-auto-size{align-items:center;display:flex;justify-content:center}.art-video-player[data-flip=horizontal] .art-video{transform:scaleX(-1)}.art-video-player[data-flip=vertical] .art-video{transform:scaleY(-1)}.art-video-player .art-layers .art-layer-log{background-color:rgba(0,0,0,.5);border-radius:3px;bottom:10px;color:#fff;display:none;font-size:13px;left:10px;padding:5px;pointer-events:none;position:absolute;text-shadow:0 0 2px rgba(0,0,0,.5);-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:120px}.art-video-player .art-layers .art-layer-log p{margin-bottom:0;word-break:break-all}.art-video-player .art-control-selector{position:relative}.art-video-player .art-control-selector .art-selector-list{background-color:rgba(0,0,0,.8);border-radius:3px;bottom:35px;color:#fff;display:none;max-height:200px;max-width:200px;min-width:100px;overflow:auto;padding:5px 0;position:absolute;text-align:center}.art-video-player .art-control-selector .art-selector-list .art-selector-item{height:30px;line-height:30px;overflow:hidden;padding:0 5px;text-overflow:ellipsis;text-shadow:0 0 2px rgba(0,0,0,.5);white-space:nowrap}.art-video-player .art-control-selector .art-selector-list .art-selector-item:hover{background-color:hsla(0,0%,100%,.1)}.art-video-player .art-control-selector .art-selector-list .art-selector-item.art-current,.art-video-player .art-control-selector .art-selector-list .art-selector-item:hover{color:#00c9ff}.art-video-player .art-control-selector:hover .art-selector-list{display:block}:root{--balloon-color:hsla(0,0%,6%,.95);--balloon-font-size:12px;--balloon-move:4px}button[aria-label][data-balloon-pos]{overflow:visible}[aria-label][data-balloon-pos]{cursor:pointer;position:relative}[aria-label][data-balloon-pos]:after{background:var(--balloon-color);border-radius:2px;color:#fff;content:attr(aria-label);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;font-size:var(--balloon-font-size);font-style:normal;font-weight:400;line-height:1.2;padding:.5em 1em;text-indent:0;text-shadow:none;white-space:nowrap}[aria-label][data-balloon-pos]:after,[aria-label][data-balloon-pos]:before{opacity:0;pointer-events:none;position:absolute;transition:all .18s ease-out .18s;z-index:10}[aria-label][data-balloon-pos]:before{border:5px solid transparent;border-top:5px solid var(--balloon-color);content:"";height:0;width:0}[aria-label][data-balloon-pos]:hover:after,[aria-label][data-balloon-pos]:hover:before{opacity:1;pointer-events:none}[aria-label][data-balloon-pos][data-balloon-pos=up]:after{margin-bottom:10px}[aria-label][data-balloon-pos][data-balloon-pos=up]:after,[aria-label][data-balloon-pos][data-balloon-pos=up]:before{bottom:100%;left:50%;transform:translate(-50%,var(--balloon-move));transform-origin:top}[aria-label][data-balloon-pos][data-balloon-pos=up]:hover:after,[aria-label][data-balloon-pos][data-balloon-pos=up]:hover:before{transform:translate(-50%)}');var s={exports:{}};!function(t,e){t.exports=function(){function t(e){return(t="function"==typeof Symbol&&"symbol"==_typeof3(Symbol.iterator)?function(t){return _typeof3(t);}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof3(t);})(e);}var e=Object.prototype.toString,r=function r(_r){if(void 0===_r)return"undefined";if(null===_r)return"null";var o=t(_r);if("boolean"===o)return"boolean";if("string"===o)return"string";if("number"===o)return"number";if("symbol"===o)return"symbol";if("function"===o)return function(t){return"GeneratorFunction"===n(t);}(_r)?"generatorfunction":"function";if(function(t){return Array.isArray?Array.isArray(t):t instanceof Array;}(_r))return"array";if(function(t){return!(!t.constructor||"function"!=typeof t.constructor.isBuffer)&&t.constructor.isBuffer(t);}(_r))return"buffer";if(function(t){try{if("number"==typeof t.length&&"function"==typeof t.callee)return!0;}catch(t){if(-1!==t.message.indexOf("callee"))return!0;}return!1;}(_r))return"arguments";if(function(t){return t instanceof Date||"function"==typeof t.toDateString&&"function"==typeof t.getDate&&"function"==typeof t.setDate;}(_r))return"date";if(function(t){return t instanceof Error||"string"==typeof t.message&&t.constructor&&"number"==typeof t.constructor.stackTraceLimit;}(_r))return"error";if(function(t){return t instanceof RegExp||"string"==typeof t.flags&&"boolean"==typeof t.ignoreCase&&"boolean"==typeof t.multiline&&"boolean"==typeof t.global;}(_r))return"regexp";switch(n(_r)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array";}if(function(t){return"function"==typeof t.throw&&"function"==typeof t.return&&"function"==typeof t.next;}(_r))return"generator";switch(o=e.call(_r)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator";}return o.slice(8,-1).toLowerCase().replace(/\s/g,"");};function n(t){return t.constructor?t.constructor.name:null;}function o(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:["option"];return i(t,e,n),a(t,e,n),function(t,e,n){var c=r(e),l=r(t);if("object"===c){if("object"!==l)throw new Error("[Type Error]: '".concat(n.join("."),"' require 'object' type, but got '").concat(l,"'"));Object.keys(e).forEach(function(r){var c=t[r],l=e[r],s=n.slice();s.push(r),i(c,l,s),a(c,l,s),o(c,l,s);});}if("array"===c){if("array"!==l)throw new Error("[Type Error]: '".concat(n.join("."),"' require 'array' type, but got '").concat(l,"'"));t.forEach(function(r,c){var l=t[c],s=e[c]||e[0],u=n.slice();u.push(c),i(l,s,u),a(l,s,u),o(l,s,u);});}}(t,e,n),t;}function i(t,e,n){if("string"===r(e)){var o=r(t);if("?"===e[0]&&(e=e.slice(1)+"|undefined"),!(-1<e.indexOf("|")?e.split("|").map(function(t){return t.toLowerCase().trim();}).filter(Boolean).some(function(t){return o===t;}):e.toLowerCase().trim()===o))throw new Error("[Type Error]: '".concat(n.join("."),"' require '").concat(e,"' type, but got '").concat(o,"'"));}}function a(t,e,n){if("function"===r(e)){var o=e(t,r(t),n);if(!0!==o){var i=r(o);throw"string"===i?new Error(o):"error"===i?o:new Error("[Validator Error]: The scheme for '".concat(n.join("."),"' validator require return true, but got '").concat(o,"'"));}}}return o.kindOf=r,o;}();}(s);var u=s.exports,p=function(){function e(){t(this,e);}return r(e,[{key:"on",value:function value(t,e,r){var n=this.e||(this.e={});return(n[t]||(n[t]=[])).push({fn:e,ctx:r}),this;}},{key:"once",value:function value(t,e,r){var n=this;function o(){n.off(t,o);for(var i=arguments.length,a=new Array(i),c=0;c<i;c++){a[c]=arguments[c];}e.apply(r,a);}return o._=e,this.on(t,o,r);}},{key:"emit",value:function value(t){for(var e=((this.e||(this.e={}))[t]||[]).slice(),r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++){n[o-1]=arguments[o];}for(var i=0;i<e.length;i+=1){e[i].fn.apply(e[i].ctx,n);}return this;}},{key:"off",value:function value(t,e){var r=this.e||(this.e={}),n=r[t],o=[];if(n&&e)for(var i=0,a=n.length;i<a;i+=1){n[i].fn!==e&&n[i].fn._!==e&&o.push(n[i]);}return o.length?r[t]=o:delete r[t],this;}}]),e;}(),f="undefined"!=typeof window?window.navigator.userAgent:"",d=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(f),h=/^((?!chrome|android).)*safari/i.test(f),v=/MicroMessenger/i.test(f),y=/MSIE|Trident/i.test(f);function m(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return e.querySelector(t);}function g(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return Array.from(e.querySelectorAll(t));}function b(t,e){return t.classList.add(e);}function w(t,e){return t.classList.remove(e);}function x(t,e){return t.classList.contains(e);}function O(t,e){return e instanceof Element?t.appendChild(e):t.insertAdjacentHTML("beforeend",String(e)),t.lastElementChild||t.lastChild;}function k(t,e,r){return t.style[e]=r,t;}function j(t,e){return Object.keys(e).forEach(function(r){k(t,r,e[r]);}),t;}function P(t,e){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=window.getComputedStyle(t,null).getPropertyValue(e);return r?parseFloat(n):n;}function S(t){return Array.from(t.parentElement.children).filter(function(e){return e!==t;});}function R(t,e){S(t).forEach(function(t){return w(t,e);}),b(t,e);}function E(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"up";d||(t.setAttribute("aria-label",e),t.setAttribute("data-balloon-pos",r));}function $(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=t.getBoundingClientRect(),n=window.innerHeight||document.documentElement.clientHeight,o=window.innerWidth||document.documentElement.clientWidth,i=r.top-e<=n&&r.top+r.height+e>=0,a=r.left-e<=o+e&&r.left+r.width+e>=0;return i&&a;}function C(t,e){return t.composedPath&&t.composedPath().indexOf(e)>-1;}function z(t,e){return e.parentNode.replaceChild(t,e),t;}function T(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0;}catch(t){return!1;}}function D(t,e,r){return D=T()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n))();return r&&o(i,r.prototype),i;},D.apply(null,arguments);}function A(t){var e="function"==typeof Map?new Map():void 0;return A=function A(t){if(null===t||(r=t,-1===Function.toString.call(r).indexOf("[native code]")))return t;var r;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n);}function n(){return D(t,arguments,l(this).constructor);}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),o(n,t);},A(t);}function M(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0;}catch(t){return!1;}}();return function(){var r,n=l(t);if(e){var o=l(this).constructor;r=Reflect.construct(n,arguments,o);}else r=n.apply(this,arguments);return c(this,r);};}var L=function(e){i(a,e);var o=M(a);function a(e,r){var i;return t(this,a),i=o.call(this,e),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(n(i),r||i.constructor),i.name="ArtPlayerError",i;}return r(a);}(A(Error));function F(t,e){if(!t)throw new L(e);return t;}function I(t){return"WEBVTT \r\n\r\n".concat(t.replace(/{[\s\S]*?}/g,"").replace(/\{\\([ibu])\}/g,"</$1>").replace(/\{\\([ibu])1\}/g,"<$1>").replace(/\{([ibu])\}/g,"<$1>").replace(/\{\/([ibu])\}/g,"</$1>").replace(/(\d\d:\d\d:\d\d),(\d\d\d)/g,"$1.$2").concat("\r\n\r\n"));}function B(t){return URL.createObjectURL(new Blob([t],{type:"text/vtt"}));}function q(t){var e=new RegExp("Dialogue:\\s\\d,(\\d+:\\d\\d:\\d\\d.\\d\\d),(\\d+:\\d\\d:\\d\\d.\\d\\d),([^,]*),([^,]*),(?:[^,]*,){4}([\\s\\S]*)$","i");function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t.split(/[:.]/).map(function(t,e,r){if(e===r.length-1){if(1===t.length)return".".concat(t,"00");if(2===t.length)return".".concat(t,"0");}else if(1===t.length)return(0===e?"0":":0")+t;return 0===e?t:e===r.length-1?".".concat(t):":".concat(t);}).join("");}return"WEBVTT\n\n".concat(t.split(/\r?\n/).map(function(t){var n=t.match(e);return n?{start:r(n[1].trim()),end:r(n[2].trim()),text:n[5].replace(/{[\s\S]*?}/g,"").replace(/(\\N)/g,"\n").trim().split(/\r?\n/).map(function(t){return t.trim();}).join("\n")}:null;}).filter(function(t){return t;}).map(function(t,e){return t?"".concat(e+1,"\n").concat(t.start," --\x3e ").concat(t.end,"\n").concat(t.text):"";}).filter(function(t){return t.trim();}).join("\n\n"));}function V(t){return t.includes("?")?V(t.split("?")[0]):t.includes("#")?V(t.split("#")[0]):t.trim().toLowerCase().split(".").pop();}function H(t,e){var r=document.createElement("a");r.style.display="none",r.href=t,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r);}function W(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++){n[r]=t[r];}return n;}function N(t){return function(t){if(Array.isArray(t))return W(t);}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t);}(t)||function(t,e){if(t){if("string"==typeof t)return W(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?W(t,e):void 0;}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}();}var _=Object.defineProperty,U=Object.prototype.hasOwnProperty;function X(t,e){return U.call(t,e);}function Y(t,e){return Object.getOwnPropertyDescriptor(t,e);}function Q(){for(var t=function t(_t2){return _t2&&"object"===a(_t2)&&!Array.isArray(_t2);},e=arguments.length,r=new Array(e),n=0;n<e;n++){r[n]=arguments[n];}return r.reduce(function(e,r){return Object.keys(r).forEach(function(n){var o=e[n],i=r[n];Array.isArray(o)&&Array.isArray(i)?e[n]=o.concat.apply(o,N(i)):!t(o)||!t(i)||i instanceof Element?e[n]=i:e[n]=Q(o,i);}),e;},{});}function Z(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise(function(e){return setTimeout(e,t);});}function J(t,e){var r,n,o=!1;return function i(){for(var a=arguments.length,c=new Array(a),l=0;l<a;l++){c[l]=arguments[l];}if(o)return r=c,void(n=this);o=!0,t.apply(this,c),setTimeout(function(){o=!1,r&&(i.apply(n,r),r=null,n=null);},e);};}function G(t,e,r){return Math.max(Math.min(t,Math.max(e,r)),Math.min(e,r));}function K(t){var e=Math.floor(t/3600),r=Math.floor((t-3600*e)/60),n=Math.floor(t-3600*e-60*r);return(e>0?[e,r,n]:[r,n]).map(function(t){return t<10?"0".concat(t):String(t);}).join(":");}function tt(t){return t.replace(/[&<>'"]/g,function(t){return{"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"}[t]||t;});}var et=Object.freeze({__proto__:null,query:m,queryAll:g,addClass:b,removeClass:w,hasClass:x,append:O,remove:function remove(t){return t.parentNode.removeChild(t);},setStyle:k,setStyles:j,getStyle:P,sublings:S,inverseClass:R,tooltip:E,isInViewport:$,includeFromEvent:C,replaceElement:z,ArtPlayerError:L,errorHandle:F,srtToVtt:I,vttToBlob:B,assToVtt:q,getExt:V,download:H,def:_,has:X,get:Y,mergeDeep:Q,sleep:Z,debounce:function debounce(t,e,r){var n;function o(){for(var o=arguments.length,i=new Array(o),a=0;a<o;a++){i[a]=arguments[a];}var c=function c(){n=null,t.apply(r,i);};clearTimeout(n),n=setTimeout(c,e);}return o.clearTimeout=function(){clearTimeout(n);},o;},throttle:J,clamp:G,secondToTime:K,escape:tt,userAgent:f,isMobile:d,isSafari:h,isWechat:v,isIE:y});function rt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t;}function nt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable;})),r.push.apply(r,n);}return r;}function ot(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?nt(Object(r),!0).forEach(function(e){rt(t,e,r[e]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):nt(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e));});}return t;}var it="boolean",at="string",ct="number",lt="object",st="function";function ut(t,e,r){return F(e===at||t instanceof Element,"".concat(r.join(".")," require '").concat(at,"' or 'Element' type"));}var pt={html:ut,disable:"?".concat(it),name:"?".concat(at),index:"?".concat(ct),style:"?".concat(lt),click:"?".concat(st),mounted:"?".concat(st),tooltip:"?".concat(at),width:"?".concat(ct),selector:"?".concat("array"),onSelect:"?".concat(st)},ft={container:ut,url:at,poster:at,title:at,type:at,theme:at,lang:at,volume:ct,isLive:it,muted:it,autoplay:it,autoSize:it,autoMini:it,loop:it,flip:it,playbackRate:it,aspectRatio:it,screenshot:it,setting:it,hotkey:it,pip:it,mutex:it,backdrop:it,fullscreen:it,fullscreenWeb:it,subtitleOffset:it,miniProgressBar:it,useSSR:it,ads:[{url:at}],plugins:[st],whitelist:["".concat(at,"|").concat(st,"|").concat("regexp")],layers:[pt],contextmenu:[pt],settings:[pt],controls:[ot(ot({},pt),{},{position:function position(t,e,r){var n=["top","left","right"];return F(n.includes(t),"".concat(r.join(".")," only accept ").concat(n.toString()," as parameters"));}})],quality:[{default:"?".concat(it),html:at,url:at}],highlight:[{time:ct,text:at}],thumbnails:{url:at,number:ct,column:ct},subtitle:{url:at,type:at,style:lt,encoding:at,bilingual:it},moreVideoAttr:lt,icons:lt,customType:lt},dt={propertys:["audioTracks","autoplay","buffered","controller","controls","crossOrigin","currentSrc","currentTime","defaultMuted","defaultPlaybackRate","duration","ended","error","loop","mediaGroup","muted","networkState","paused","playbackRate","played","preload","readyState","seekable","seeking","src","startDate","textTracks","videoTracks","volume"],methods:["addTextTrack","canPlayType","load","play","pause"],events:["abort","canplay","canplaythrough","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"],prototypes:["width","height","videoWidth","videoHeight","poster","webkitDecodedFrameCount","webkitDroppedFrameCount","playsInline","webkitSupportsFullscreen","webkitDisplayingFullscreen","onenterpictureinpicture","onleavepictureinpicture","disablePictureInPicture","cancelVideoFrameCallback","requestVideoFrameCallback","getVideoPlaybackQuality","requestPictureInPicture","webkitEnterFullScreen","webkitEnterFullscreen","webkitExitFullScreen","webkitExitFullscreen"]},ht=function(){function e(r){t(this,e),this.art=r;}return r(e,[{key:"state",get:function get(){var t=this.art,e=t.option,r=t.constructor.kindOf;return!d||e.whitelist.some(function(t){switch(r(t)){case"string":return"*"===t||f.indexOf(t)>-1;case"function":return t(f);case"regexp":return t.test(f);default:return!1;}});}}]),e;}(),vt=function(){function e(r){var n=this;t(this,e),this.art=r;var o=r.option,i=r.constructor,a=r.whitelist;o.container instanceof Element?this.$container=o.container:(this.$container=m(o.container),F(this.$container,"No container element found by ".concat(o.container)));var c=this.$container.tagName.toLowerCase();F("div"===c,"Unsupported container element type, only support 'div' but got '".concat(c,"'")),F(i.instances.every(function(t){return t.template.$container!==n.$container;}),"Cannot mount multiple instances on the same dom element"),this.query=this.query.bind(this),this.$container.dataset.artId=r.id,this.$original=this.$container.cloneNode(!0),a.state?this.desktop():this.mobile();}return r(e,[{key:"query",value:function value(t){return m(t,this.$container);}},{key:"desktop",value:function value(){var t=this.art.option;t.useSSR||(this.$container.innerHTML=e.html),this.$player=this.query(".art-video-player"),this.$video=this.query(".art-video"),this.$poster=this.query(".art-poster"),this.$subtitle=this.query(".art-subtitle"),this.$danmuku=this.query(".art-danmuku"),this.$bottom=this.query(".art-bottom"),this.$progress=this.query(".art-progress"),this.$controls=this.query(".art-controls"),this.$controlsLeft=this.query(".art-controls-left"),this.$controlsRight=this.query(".art-controls-right"),this.$layer=this.query(".art-layers"),this.$loading=this.query(".art-loading"),this.$notice=this.query(".art-notice"),this.$noticeInner=this.query(".art-notice-inner"),this.$mask=this.query(".art-mask"),this.$state=this.query(".art-state"),this.$setting=this.query(".art-settings"),this.$info=this.query(".art-info"),this.$infoPanel=this.query(".art-info-panel"),this.$infoClose=this.query(".art-info-close"),this.$miniHeader=this.query(".art-mini-header"),this.$miniTitle=this.query(".art-mini-title"),this.$miniClose=this.query(".art-mini-close"),this.$contextmenu=this.query(".art-contextmenus"),t.backdrop&&(b(this.$setting,"art-backdrop-filter"),b(this.$contextmenu,"art-backdrop-filter"),b(this.$info,"art-backdrop-filter")),d&&b(this.$player,"art-mobile");}},{key:"mobile",value:function value(){this.$container.innerHTML='<div class="art-video-player"><video class="art-video"></video></div>',this.$player=this.query(".art-video-player"),this.$video=this.query(".art-video");}},{key:"destroy",value:function value(t){t?z(this.$original,this.$container):b(this.$player,"art-destroy");}}],[{key:"html",get:function get(){return'<div class="art-video-player art-subtitle-show art-layer-show"><video class="art-video"></video><div class="art-poster"></div><div class="art-subtitle"></div><div class="art-danmuku"></div><div class="art-layers"></div><div class="art-mask"><div class="art-state"></div></div><div class="art-bottom"><div class="art-progress"></div><div class="art-controls"><div class="art-controls-left"></div><div class="art-controls-right"></div></div></div><div class="art-loading"></div><div class="art-notice"><div class="art-notice-inner"></div></div><div class="art-settings"></div><div class="art-info"><div class="art-info-panel"><div class="art-info-item"><div class="art-info-title">Player version:</div><div class="art-info-content">4.3.1</div></div><div class="art-info-item"><div class="art-info-title">Video url:</div><div class="art-info-content" data-video="src"></div></div><div class="art-info-item"><div class="art-info-title">Video volume:</div><div class="art-info-content" data-video="volume"></div></div><div class="art-info-item"><div class="art-info-title">Video time:</div><div class="art-info-content" data-video="currentTime"></div></div><div class="art-info-item"><div class="art-info-title">Video duration:</div><div class="art-info-content" data-video="duration"></div></div><div class="art-info-item"><div class="art-info-title">Video resolution:</div><div class="art-info-content"><span data-video="videoWidth"></span> x <span data-video="videoHeight"></span></div></div></div><div class="art-info-close">[x]</div></div><div class="art-mini-header"><div class="art-mini-title"></div><div class="art-mini-close">xD7</div></div><div class="art-contextmenus"></div></div>';}}]),e;}(),yt={"Video Info":"统计信息",Close:"关闭","Video Load Failed":"加载失败",Volume:"音量",Play:"播放",Pause:"暂停",Rate:"速度",Mute:"静音","Video Flip":"画面翻转",Horizontal:"水平",Vertical:"垂直",Reconnect:"重新连接","Hide Subtitle":"隐藏字幕","Show Subtitle":"显示字幕","Show Setting":"显示设置","Hide Setting":"隐藏设置",Screenshot:"截图","Play Speed":"播放速度","Aspect Ratio":"画面比例",Default:"默认",Normal:"正常",Open:"打开","Switch Video":"切换","Switch Subtitle":"切换字幕",Fullscreen:"全屏","Exit Fullscreen":"退出全屏","Web Fullscreen":"网页全屏","Exit Web Fullscreen":"退出网页全屏","Mini Player":"迷你播放器","PIP Mode":"画中画模式","Exit PIP Mode":"退出画中画模式","PIP Not Supported":"不支持画中画模式","Fullscreen Not Supported":"不支持全屏模式","Subtitle Offset":"字幕偏移"},mt={"Video Info":"統計訊息",Close:"關閉","Video Load Failed":"載入失敗",Volume:"音量",Play:"播放",Pause:"暫停",Rate:"速度",Mute:"靜音","Video Flip":"畫面翻轉",Horizontal:"水平",Vertical:"垂直",Reconnect:"重新連接","Hide Subtitle":"隱藏字幕","Show Subtitle":"顯示字幕","Show Setting":"顯示设置","Hide Setting":"隱藏设置",Screenshot:"截圖","Play Speed":"播放速度","Aspect Ratio":"畫面比例",Default:"默認",Normal:"正常",Open:"打開","Switch Video":"切換","Switch Subtitle":"切換字幕",Fullscreen:"全屏","Exit Fullscreen":"退出全屏","Web Fullscreen":"網頁全屏","Exit Web Fullscreen":"退出網頁全屏","Mini Player":"迷你播放器","PIP Mode":"畫中畫模式","Exit PIP Mode":"退出畫中畫模式","PIP Not Supported":"不支持畫中畫模式","Fullscreen Not Supported":"不支持全屏模式","Subtitle Offset":"字幕偏移"},gt=function(){function e(r){t(this,e),this.art=r,this.languages={"zh-cn":yt,"zh-tw":mt},this.init();}return r(e,[{key:"init",value:function value(){var t=this.art.option.lang.toLowerCase();this.language=this.languages[t]||{};}},{key:"get",value:function value(t){return this.language[t]||t;}},{key:"update",value:function value(t){this.languages=Q(this.languages,t),this.init();}}]),e;}();var bt={exports:{}};!function(t){!function(){var e="undefined"!=typeof window&&void 0!==window.document?window.document:{},r=t.exports,n=function(){for(var t,r=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],n=0,o=r.length,i={};n<o;n++){if((t=r[n])&&t[1]in e){for(n=0;n<t.length;n++){i[r[0][n]]=t[n];}return i;}}return!1;}(),o={change:n.fullscreenchange,error:n.fullscreenerror},i={request:function request(t,r){return new Promise(function(o,i){var a=function(){this.off("change",a),o();}.bind(this);this.on("change",a);var c=(t=t||e.documentElement)[n.requestFullscreen](r);c instanceof Promise&&c.then(a).catch(i);}.bind(this));},exit:function exit(){return new Promise(function(t,r){if(this.isFullscreen){var o=function(){this.off("change",o),t();}.bind(this);this.on("change",o);var i=e[n.exitFullscreen]();i instanceof Promise&&i.then(o).catch(r);}else t();}.bind(this));},toggle:function toggle(t,e){return this.isFullscreen?this.exit():this.request(t,e);},onchange:function onchange(t){this.on("change",t);},onerror:function onerror(t){this.on("error",t);},on:function on(t,r){var n=o[t];n&&e.addEventListener(n,r,!1);},off:function off(t,r){var n=o[t];n&&e.removeEventListener(n,r,!1);},raw:n};n?(Object.defineProperties(i,{isFullscreen:{get:function get(){return Boolean(e[n.fullscreenElement]);}},element:{enumerable:!0,get:function get(){return e[n.fullscreenElement];}},isEnabled:{enumerable:!0,get:function get(){return Boolean(e[n.fullscreenEnabled]);}}}),r?t.exports=i:window.screenfull=i):r?t.exports={isEnabled:!1}:window.screenfull={isEnabled:!1};}();}(bt);var wt=bt.exports;function xt(t){var e=t.i18n,r=t.notice,n=t.template.$video;t.once("ready",function(){wt.isEnabled?function(t){var e=t.notice,r=t.template.$player;wt.on("change",function(){return t.emit("fullscreen",wt.isFullscreen);}),_(t,"fullscreen",{get:function get(){return wt.isFullscreen;},set:function set(n){n?wt.request(r).then(function(){b(r,"art-fullscreen"),t.aspectRatioReset=!0,t.autoSize=!1,t.emit("resize"),t.emit("fullscreen",!0),e.show="";}):wt.exit().then(function(){w(r,"art-fullscreen"),t.aspectRatioReset=!0,t.autoSize=t.option.autoSize,t.emit("resize"),t.emit("fullscreen"),e.show="";});}});}(t):document.fullscreenEnabled||n.webkitSupportsFullscreen?function(t){var e=t.notice,r=t.template.$video;_(t,"fullscreen",{get:function get(){return r.webkitDisplayingFullscreen;},set:function set(n){n?(r.webkitEnterFullscreen(),t.emit("fullscreen",!0),e.show=""):(r.webkitExitFullscreen(),t.emit("fullscreen"),e.show="");}});}(t):_(t,"fullscreen",{get:function get(){return!1;},set:function set(){r.show=e.get("Fullscreen Not Supported");}}),_(t,"fullscreen",Y(t,"fullscreen"));});}function Ot(t){var e=t.i18n,r=t.notice,n=t.template.$video;document.pictureInPictureEnabled?function(t){var e=t.template.$video,r=t.events.proxy,n=t.notice;e.disablePictureInPicture=!1,_(t,"pip",{get:function get(){return document.pictureInPictureElement;},set:function set(t){t?e.requestPictureInPicture().catch(function(t){throw n.show=t,t;}):document.exitPictureInPicture().catch(function(t){throw n.show=t,t;});}}),r(e,"enterpictureinpicture",function(){t.emit("pip",!0);}),r(e,"leavepictureinpicture",function(){t.emit("pip");});}(t):n.webkitSupportsPresentationMode?function(t){var e=t.template.$video;e.webkitSetPresentationMode("inline"),_(t,"pip",{get:function get(){return"picture-in-picture"===e.webkitPresentationMode;},set:function set(r){r?(e.webkitSetPresentationMode("picture-in-picture"),t.emit("pip",!0)):(e.webkitSetPresentationMode("inline"),t.emit("pip"));}});}(t):_(t,"pip",{get:function get(){return!1;},set:function set(){r.show=e.get("PIP Not Supported");}});}var kt=r(function e(r){t(this,e),function(t){var e=t.option,r=t.template.$video;_(t,"url",{get:function get(){return r.currentSrc;},set:function set(n){var o=e.type||V(n),i=e.customType[o];o&&i?Z().then(function(){t.loading.show=!0,i.call(t,r,n,t);}):(t.url&&t.url!==n&&t.once("video:canplay",function(){t.isReady&&t.emit("restart");}),r.src=n,t.option.url=n,t.emit("url",n));}});}(r),function(t){var e=t.template.$video;_(t,"attr",{value:function value(t,r){if(void 0===r)return e[t];e[t]=r;}});}(r),function(t){var e=t.i18n,r=t.notice,n=t.option,o=t.constructor.instances,i=t.template.$video;_(t,"play",{value:function value(){var a=i.play();if(a&&a.then&&a.then().catch(function(t){throw r.show=t,t;}),n.mutex)for(var c=0;c<o.length;c++){var l=o[c];l!==t&&l.pause();}return r.show=e.get("Play"),t.emit("play"),a;}});}(r),function(t){var e=t.template.$video,r=t.i18n,n=t.notice;_(t,"pause",{value:function value(){var o=e.pause();return n.show=r.get("Pause"),t.emit("pause"),o;}});}(r),function(t){_(t,"toggle",{value:function value(){return t.playing?t.pause():t.play();}});}(r),function(t){var e=t.notice;_(t,"seek",{set:function set(r){t.currentTime=r,t.emit("seek",t.currentTime),t.duration&&(e.show="".concat(K(t.currentTime)," / ").concat(K(t.duration)));}}),_(t,"forward",{set:function set(e){t.seek=t.currentTime+e;}}),_(t,"backward",{set:function set(e){t.seek=t.currentTime-e;}});}(r),function(t){var e=t.template.$video,r=t.i18n,n=t.notice,o=t.storage;_(t,"volume",{get:function get(){return e.volume||0;},set:function set(i){e.volume=G(i,0,1),n.show="".concat(r.get("Volume"),": ").concat(parseInt(100*e.volume,10)),0!==e.volume&&o.set("volume",e.volume),t.emit("volume",e.volume);}}),_(t,"muted",{get:function get(){return e.muted;},set:function set(r){e.muted=r,t.emit("volume",e.volume);}});}(r),function(t){var e=t.template.$video;_(t,"currentTime",{get:function get(){return e.currentTime||0;},set:function set(r){r=parseFloat(r),Number.isNaN(r)||(e.currentTime=G(r,0,t.duration));}});}(r),function(t){_(t,"duration",{get:function get(){var e=t.template.$video.duration;return e===1/0?0:e||0;}});}(r),function(t){var e=t.i18n,r=t.option,n=t.notice;function o(o,i,a){return new Promise(function(c){if(o===t.url)return c(o);URL.revokeObjectURL(t.url),t.url=o,t.once("video:canplay",function(){t.playbackRate=!1,t.aspectRatio=!1,t.flip="normal",t.autoSize=r.autoSize,t.currentTime=a,t.notice.show="",t.playing&&t.play(),i&&(n.show="".concat(e.get("Switch Video"),": ").concat(i)),t.emit("switch",o),c(o);});});}_(t,"switchQuality",{value:function value(e,r){return o(e,r,t.currentTime);}}),_(t,"switchUrl",{value:function value(t,e){return o(t,e,0);}});}(r),function(t){var e=t.template.$video,r=t.i18n,n=t.notice;_(t,"playbackRate",{get:function get(){return e.playbackRate;},set:function set(o){if(o){if(o===e.playbackRate)return;var i=[.25,.5,.75,1,1.25,1.5,1.75,2];F(i.includes(o),"'playbackRate' only accept ".concat(i.toString()," as parameters")),e.playbackRate=o,n.show="".concat(r.get("Rate"),": ").concat(1===o?r.get("Normal"):"".concat(o,"x")),t.emit("playbackRate",o);}else t.playbackRate=1,t.emit("playbackRate");}});}(r),function(t){var e=t.template,r=e.$video,n=e.$player,o=t.i18n,i=t.notice;_(t,"aspectRatio",{get:function get(){return n.dataset.aspectRatio||"default";},set:function set(e){e||(e="default");var a=["default","4:3","16:9"];if(F(a.includes(e),"'aspectRatio' only accept ".concat(a.toString()," as parameters")),"default"===e)k(r,"width",null),k(r,"height",null),k(r,"padding",null),delete n.dataset.aspectRatio;else{var c=e.split(":").map(Number),l=r.videoWidth,s=r.videoHeight,u=n.clientWidth,p=n.clientHeight,f=l/s,d=c[0]/c[1];if(f>d){var h=d*s/l;k(r,"width","".concat(100*h,"%")),k(r,"height","100%"),k(r,"padding","0 ".concat((u-u*h)/2,"px"));}else{var v=l/d/s;k(r,"width","100%"),k(r,"height","".concat(100*v,"%")),k(r,"padding","".concat((p-p*v)/2,"px 0"));}n.dataset.aspectRatio=e;}i.show="".concat(o.get("Aspect Ratio"),": ").concat("default"===e?o.get("Default"):e),t.emit("aspectRatio",e);}}),_(t,"aspectRatioReset",{set:function set(e){if(e){var r=t.aspectRatio;t.aspectRatio=r;}}});}(r),function(t){var e=t.option,r=t.notice,n=t.template.$video,o=document.createElement("canvas");_(t,"getDataURL",{value:function value(){return new Promise(function(t,e){try{o.width=n.videoWidth,o.height=n.videoHeight,o.getContext("2d").drawImage(n,0,0),t(o.toDataURL("image/png"));}catch(t){r.show=t,e(t);}});}}),_(t,"getBlobUrl",{value:function value(){return new Promise(function(t,e){try{o.width=n.videoWidth,o.height=n.videoHeight,o.getContext("2d").drawImage(n,0,0),o.toBlob(function(e){t(URL.createObjectURL(e));});}catch(t){r.show=t,e(t);}});}}),_(t,"screenshot",{value:function value(){return t.getDataURL().then(function(r){return H(r,"".concat(e.title||"artplayer","_").concat(K(n.currentTime),".png")),t.emit("screenshot",r),r;});}});}(r),xt(r),function(t){var e=t.notice,r=t.template.$player;_(t,"fullscreenWeb",{get:function get(){return x(r,"art-fullscreen-web");},set:function set(n){n?(b(r,"art-fullscreen-web"),t.aspectRatioReset=!0,t.autoSize=!1,t.emit("resize"),t.emit("fullscreenWeb",!0),e.show=""):(w(r,"art-fullscreen-web"),t.aspectRatioReset=!0,t.autoSize=t.option.autoSize,t.emit("resize"),t.emit("fullscreenWeb"),e.show="");}});}(r),Ot(r),function(t){var e=t.template.$video;_(t,"loaded",{get:function get(){return t.loadedTime/e.duration;}}),_(t,"loadedTime",{get:function get(){return e.buffered.length?e.buffered.end(e.buffered.length-1):0;}});}(r),function(t){_(t,"played",{get:function get(){return t.currentTime/t.duration;}});}(r),function(t){var e=t.template.$video;_(t,"playing",{get:function get(){return!!(e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>2);}});}(r),function(t){var e=t.template,r=e.$container,n=e.$player,o=e.$video;_(t,"autoSize",{get:function get(){return x(r,"art-auto-size");},set:function set(e){if(e){var i=o.videoWidth,a=o.videoHeight,c=r.getBoundingClientRect(),l=c.width,s=c.height,u=i/a,p=l/s;if(b(r,"art-auto-size"),p>u)k(n,"width","".concat(s*u/l*100,"%")),k(n,"height","100%");else{var f=l/u/s*100;k(n,"width","100%"),k(n,"height","".concat(f,"%"));}t.emit("autoSize",{width:t.width,height:t.height});}else w(r,"art-auto-size"),k(n,"width",null),k(n,"height",null),t.emit("autoSize");}});}(r),function(t){_(t,"rect",{get:function get(){return t.template.$player.getBoundingClientRect();}});for(var e=["bottom","height","left","right","top","width"],r=function r(_r2){var n=e[_r2];_(t,n,{get:function get(){return t.rect[n];}});},n=0;n<e.length;n++){r(n);}_(t,"x",{get:function get(){return t.left+window.pageXOffset;}}),_(t,"y",{get:function get(){return t.top+window.pageYOffset;}});}(r),function(t){var e=t.template.$player,r=t.i18n,n=t.notice;_(t,"flip",{get:function get(){return e.dataset.flip||"normal";},set:function set(o){o||(o="normal");var i=["normal","horizontal","vertical"];F(i.includes(o),"'flip' only accept ".concat(i.toString()," as parameters")),"normal"===o?delete e.dataset.flip:(t.rotate=!1,e.dataset.flip=o);var a=o.replace(o[0],o[0].toUpperCase());n.show="".concat(r.get("Video Flip"),": ").concat(r.get(a)),t.emit("flip",o);}});}(r),function(t){var e=t.i18n,r=t.option,n=t.storage,o=t.events.proxy,i=t.template,a=i.$player,c=i.$miniClose,l=i.$miniTitle,s=i.$miniHeader,u="",p=!1,f=0,d=0,h=0,v=0;o(s,"mousedown",function(e){p=!0,f=e.pageX,d=e.pageY,h=t.left,v=t.top;}),o(document,"mousemove",function(t){if(p){b(a,"art-is-dragging");var e=v+t.pageY-d,r=h+t.pageX-f;k(a,"top","".concat(e,"px")),k(a,"left","".concat(r,"px")),n.set("top",e),n.set("left",r);}}),o(document,"mouseup",function(){p=!1,w(a,"art-is-dragging");}),o(c,"click",function(){t.mini=!1,p=!1,w(a,"art-is-dragging");}),O(l,r.title||e.get("Mini Player")),_(t,"mini",{get:function get(){return x(a,"art-mini");},set:function set(e){if(e){t.autoSize=!1,u=a.style.cssText,b(a,"art-mini");var o=n.get("top"),i=n.get("left");if(o&&i)k(a,"top","".concat(o,"px")),k(a,"left","".concat(i,"px")),$(s)||(n.del("top"),n.del("left"),t.mini=!0);else{var c=document.body,l=c.clientHeight-t.height-50,p=c.clientWidth-t.width-50;n.set("top",l),n.set("left",p),k(a,"top","".concat(l,"px")),k(a,"left","".concat(p,"px"));}t.aspectRatio=!1,t.playbackRate=!1,t.notice.show="",t.emit("mini",!0);}else a.style.cssText=u,w(a,"art-mini"),k(a,"top",null),k(a,"left",null),t.aspectRatio=!1,t.playbackRate=!1,t.autoSize=r.autoSize,t.notice.show="",t.emit("mini");}});}(r),function(t){var e=[];_(t,"loop",{get:function get(){return e;},set:function set(r){if(Array.isArray(r)&&"number"==typeof r[0]&&"number"==typeof r[1]){var n=G(r[0],0,Math.min(r[1],t.duration)),o=G(r[1],n,t.duration);o-n>=1?(e=[n,o],t.emit("loop",e)):(e=[],t.emit("loop"));}else e=[],t.emit("loop");}}),t.on("video:timeupdate",function(){e.length&&(t.currentTime<e[0]||t.currentTime>e[1])&&(t.seek=e[0]);});}(r),function(t){var e=t.option,r=t.template.$poster;_(t,"poster",{get:function get(){return e.poster;},set:function set(t){e.poster=t,k(r,"backgroundImage","url(".concat(t,")"));}});}(r),function(t){var e=t.option,r=t.template,n=r.$container,o=r.$video,i=n.style.height;_(t,"autoHeight",{get:function get(){return x(n,"art-auto-height");},set:function set(r){if(r){var a=n.clientWidth,c=o.videoHeight*(a/o.videoWidth);k(n,"height",c+"px"),b(n,"art-auto-height"),t.autoSize=e.autoSize,t.emit("autoHeight",c);}else k(n,"height",i),w(n,"art-auto-height"),t.autoSize=e.autoSize,t.emit("autoHeight");}});}(r),function(t){var e=t.option,r=t.template.$player;_(t,"theme",{get:function get(){return getComputedStyle(r).getPropertyValue("--theme");},set:function set(t){e.theme=t,r.style.setProperty("--theme",t);}});}(r),function(t){_(t,"title",{get:function get(){return t.option.title;},set:function set(e){t.option.title=e;}});}(r),function(t){var e=["mini","pip","fullscreen","fullscreenWeb"];!function(e){for(var r=function r(_r3){var n=e[_r3];t.on(n,function(){t[n]&&e.filter(function(t){return t!==n;}).forEach(function(e){t[e]&&(t[e]=!1);});});},n=0;n<e.length;n++){r(n);}}(e),_(t,"normalSize",{get:function get(){return e.every(function(e){return!t[e];});}});}(r),function(t){var e=t.constructor.utils.clamp,r=t.notice,n=t.template,o=t.i18n,i=0,a=[];t.on("subtitle:switch",function(){a=[];}),_(t,"subtitleOffset",{get:function get(){return i;},set:function set(c){if(n.$track&&n.$track.track){var l=Array.from(n.$track.track.cues);i=e(c,-5,5);for(var s=0;s<l.length;s++){var u=l[s];a[s]||(a[s]={startTime:u.startTime,endTime:u.endTime}),u.startTime=e(a[s].startTime+i,0,t.duration),u.endTime=e(a[s].endTime+i,0,t.duration);}t.subtitle.update(),r.show="".concat(o.get("Subtitle Offset"),": ").concat(c,"s"),t.emit("subtitleOffset",c);}else t.emit("subtitleOffset",0);}});}(r),function(t){var e=t.option,r=t.events.proxy,n=t.template,o=n.$player,i=n.$video,a=n.$poster,c=t.i18n,l=t.notice,s=0;r(i,"click",function(){t.toggle();}),r(i,"dblclick",function(){t.fullscreen=!t.fullscreen;});for(var u=0;u<dt.events.length;u++){r(i,dt.events[u],function(e){t.emit("video:".concat(e.type),e);});}t.on("video:canplay",function(){s=0,t.loading.show=!1;}),t.once("video:canplay",function(){t.loading.show=!1,t.controls.show=!0,t.mask.show=!0,t.isReady=!0,t.emit("ready");}),t.on("video:ended",function(){e.loop?(t.seek=0,t.play(),t.controls.show=!1,t.mask.show=!1):(t.controls.show=!0,t.mask.show=!0);}),t.on("video:error",function(){s<5?Z(1e3).then(function(){s+=1,t.url=e.url,l.show="".concat(c.get("Reconnect"),": ").concat(s),t.emit("error",s);}):(t.loading.show=!1,t.controls.show=!1,b(o,"art-error"),Z(1e3).then(function(){l.show=c.get("Video Load Failed"),t.destroy(!1);}));}),t.once("video:loadedmetadata",function(){t.autoSize=e.autoSize,d&&(t.loading.show=!1,t.controls.show=!0,t.mask.show=!0);}),t.on("video:loadstart",function(){t.loading.show=!0;}),t.on("video:pause",function(){t.controls.show=!0,t.mask.show=!0;}),t.on("video:play",function(){t.mask.show=!1,k(a,"display","none");}),t.on("video:playing",function(){t.mask.show=!1;}),t.on("video:seeked",function(){t.loading.show=!1;}),t.on("video:seeking",function(){t.loading.show=!0;}),t.on("video:timeupdate",function(){t.mask.show=!1;}),t.on("video:waiting",function(){t.loading.show=!0;});}(r),function(t){var e=t.option,r=t.storage,n=t.template,o=n.$video,i=n.$poster;Object.keys(e.moreVideoAttr).forEach(function(r){t.attr(r,e.moreVideoAttr[r]);}),e.muted&&(t.muted=e.muted),e.volume&&(o.volume=G(e.volume,0,1));var a=r.get("volume");"number"==typeof a&&(o.volume=G(a,0,1)),e.poster&&k(i,"backgroundImage","url(".concat(e.poster,")")),e.autoplay&&(o.autoplay=e.autoplay),e.theme&&(t.theme=e.theme),0===e.ads.length&&(t.url=e.url);}(r);});function jt(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=l(t));){;}return t;}function Pt(){return Pt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=jt(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value;}},Pt.apply(this,arguments);}var St=function(){function e(r){t(this,e),this.id=0,this.art=r,this.add=this.add.bind(this);}return r(e,[{key:"show",get:function get(){return x(this.art.template.$player,"art-".concat(this.name,"-show"));},set:function set(t){var e=this.art.template.$player,r="art-".concat(this.name,"-show");t?b(e,r):w(e,r),this.art.emit(this.name,t);}},{key:"toggle",set:function set(t){t&&(this.show=!this.show);}},{key:"add",value:function value(t){var e=this,r="function"==typeof t?t(this.art):t;if(r.html=r.html||"",u(r,pt),this.$parent&&this.name&&!r.disable){var n=r.name||"".concat(this.name).concat(this.id);F(!X(this,n),"Cannot add an existing name [".concat(n,"] to the [").concat(this.name,"]")),this.id+=1;var o=document.createElement("div");b(o,"art-".concat(this.name)),b(o,"art-".concat(this.name,"-").concat(n));var i=Array.from(this.$parent.children);o.dataset.index=r.index||this.id;var a=i.find(function(t){return Number(t.dataset.index)>=Number(o.dataset.index);});return a?a.insertAdjacentElement("beforebegin",o):O(this.$parent,o),r.html&&O(o,r.html),r.style&&j(o,r.style),r.tooltip&&E(o,r.tooltip),r.click&&this.art.events.proxy(o,"click",function(t){t.preventDefault(),r.click.call(e.art,e,t);}),r.selector&&["left","right"].includes(r.position)&&this.selector(r,o),r.mounted&&r.mounted.call(this.art,o),1===o.childNodes.length&&3===o.childNodes[0].nodeType&&b(o,"art-control-onlyText"),_(this,n,{value:o}),o;}}},{key:"selector",value:function value(t,e){var r=this,n=this.art.events,o=n.hover,i=n.proxy;b(e,"art-control-selector");var a=document.createElement("div");b(a,"art-selector-value"),O(a,t.html),e.innerText="",O(e,a);var c=t.selector.map(function(t,e){return'<div class="art-selector-item '.concat(t.default?"art-current":"",'" data-index="').concat(e,'">').concat(t.html,"</div>");}).join(""),l=document.createElement("div");b(l,"art-selector-list"),O(l,c),O(e,l);var s=function s(){var t=P(e,"width")/2-P(l,"width")/2;l.style.left="".concat(t,"px");};o(e,s),i(l,"click",function(e){var n=(e.composedPath()||[]).find(function(t){return x(t,"art-selector-item");});if(n){R(n,"art-current");var o=Number(n.dataset.index),i=t.selector[o]||{};if(a.innerText=n.innerText,t.onSelect){var c=t.onSelect.call(r.art,i,n,e);"string"!=typeof c&&"number"!=typeof c||(a.innerHTML=c);}s(),r.art.emit("selector",i,n);}});}}]),e;}();function Rt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable;})),r.push.apply(r,n);}return r;}function Et(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Rt(Object(r),!0).forEach(function(e){rt(t,e,r[e]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Rt(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e));});}return t;}function $t(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable;})),r.push.apply(r,n);}return r;}function Ct(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?$t(Object(r),!0).forEach(function(e){rt(t,e,r[e]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):$t(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e));});}return t;}function zt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable;})),r.push.apply(r,n);}return r;}function Tt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?zt(Object(r),!0).forEach(function(e){rt(t,e,r[e]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):zt(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e));});}return t;}function Dt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable;})),r.push.apply(r,n);}return r;}function At(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Dt(Object(r),!0).forEach(function(e){rt(t,e,r[e]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Dt(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e));});}return t;}function Mt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable;})),r.push.apply(r,n);}return r;}function Lt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Mt(Object(r),!0).forEach(function(e){rt(t,e,r[e]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Mt(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e));});}return t;}function Ft(t,e){var r=t.template.$progress,n=r.getBoundingClientRect().left,o=G(("number"==typeof e.pageX?e.pageX:e.touches[0].clientX)-n,0,r.clientWidth),i=o/r.clientWidth*t.duration;return{second:i,time:K(i),width:o,percentage:G(o/r.clientWidth,0,1)};}function It(t){return function(e){var r=e.icons,n=e.option,o=e.events.proxy;return Lt(Lt({},t),{},{html:'<div class="art-control-progress-inner"><div class="art-progress-loaded"></div><div class="art-progress-played"></div><div class="art-progress-highlight"></div><div class="art-progress-indicator"></div><div class="art-progress-tip"></div></div>',mounted:function mounted(t){var i=!1,a=m(".art-progress-loaded",t),c=m(".art-progress-played",t),l=m(".art-progress-highlight",t),s=m(".art-progress-indicator",t),u=m(".art-progress-tip",t);k(c,"backgroundColor","var(--theme)");var p=14;function f(t,e){"loaded"===t&&k(a,"width","".concat(100*e,"%")),"played"===t&&(k(c,"width","".concat(100*e,"%")),k(s,"left","calc(".concat(100*e,"% - ").concat(p/2,"px)")));}r.indicator?(p=16,O(s,r.indicator)):j(s,{backgroundColor:"var(--theme)"}),j(s,{left:"-".concat(p/2,"px"),width:"".concat(p,"px"),height:"".concat(p,"px")});for(var d=0;d<n.highlight.length;d++){var h=n.highlight[d],v=G(h.time,0,e.duration)/e.duration*100;O(l,'<span data-text="'.concat(h.text,'" data-time="').concat(h.time,'" style="left: ').concat(v,'%"></span>'));}f("loaded",e.loaded),e.on("video:progress",function(){f("loaded",e.loaded);}),e.on("video:timeupdate",function(){f("played",e.played);}),e.on("video:ended",function(){f("played",1);}),o(t,"mousemove",function(r){k(u,"display","block"),C(r,l)?function(r){var n=Ft(e,r).width,o=r.target.dataset.text;u.innerHTML=o;var i=u.clientWidth;n<=i/2?k(u,"left",0):n>t.clientWidth-i/2?k(u,"left","".concat(t.clientWidth-i,"px")):k(u,"left","".concat(n-i/2,"px"));}(r):function(r){var n=Ft(e,r),o=n.width,i=n.time;u.innerHTML=i;var a=u.clientWidth;o<=a/2?k(u,"left",0):o>t.clientWidth-a/2?k(u,"left","".concat(t.clientWidth-a,"px")):k(u,"left","".concat(o-a/2,"px"));}(r);}),o(t,"mouseout",function(){k(u,"display","none");}),o(t,"click",function(t){if(t.target!==s){var r=Ft(e,t),n=r.second;f("played",r.percentage),e.seek=n;}}),o(s,"mousedown",function(){i=!0;}),o(document,"mousemove",function(t){if(i){var r=Ft(e,t),n=r.second;f("played",r.percentage),e.seek=n;}}),o(document,"mouseup",function(){i&&(i=!1);}),o(s,"touchstart",function(t){1===t.touches.length&&(i=!0);}),o(document,"touchmove",function(t){if(1===t.touches.length&&i){var r=Ft(e,t),n=r.second;f("played",r.percentage),e.seek=n;}}),o(document,"touchend",function(){i&&(i=!1);});}});};}function Bt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable;})),r.push.apply(r,n);}return r;}function qt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Bt(Object(r),!0).forEach(function(e){rt(t,e,r[e]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Bt(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e));});}return t;}function Vt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable;})),r.push.apply(r,n);}return r;}function Ht(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Vt(Object(r),!0).forEach(function(e){rt(t,e,r[e]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Vt(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e));});}return t;}function Wt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable;})),r.push.apply(r,n);}return r;}function Nt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Wt(Object(r),!0).forEach(function(e){rt(t,e,r[e]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Wt(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e));});}return t;}function _t(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable;})),r.push.apply(r,n);}return r;}function Ut(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?_t(Object(r),!0).forEach(function(e){rt(t,e,r[e]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):_t(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e));});}return t;}function Xt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable;})),r.push.apply(r,n);}return r;}function Yt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Xt(Object(r),!0).forEach(function(e){rt(t,e,r[e]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Xt(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e));});}return t;}function Qt(t){return function(e){return Yt(Yt({},t),{},{mounted:function mounted(t){var r=e.option,n=e.template,o=n.$progress,i=n.$video,a=e.events,c=a.proxy,l=a.loadImg,s=null,u=!1,p=!1;c(o,"mousemove",function(n){u||(u=!0,l(r.thumbnails.url).then(function(t){s=t,p=!0;})),p&&(k(t,"display","block"),function(n){var a=Ft(e,n).width,c=r.thumbnails,l=c.url,u=c.number,p=c.column,f=s.naturalWidth/p,d=f/(i.videoWidth/i.videoHeight),h=o.clientWidth/u,v=Math.floor(a/h),y=Math.ceil(v/p)-1,m=v%p||p-1;k(t,"backgroundImage","url(".concat(l,")")),k(t,"height","".concat(d,"px")),k(t,"width","".concat(f,"px")),k(t,"backgroundPosition","-".concat(m*f,"px -").concat(y*d,"px")),a<=f/2?k(t,"left",0):a>o.clientWidth-f/2?k(t,"left","".concat(o.clientWidth-f,"px")):k(t,"left","".concat(a-f/2,"px"));}(n));}),c(o,"mouseout",function(){k(t,"display","none");});}});};}function Zt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable;})),r.push.apply(r,n);}return r;}function Jt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Zt(Object(r),!0).forEach(function(e){rt(t,e,r[e]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Zt(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e));});}return t;}function Gt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable;})),r.push.apply(r,n);}return r;}function Kt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Gt(Object(r),!0).forEach(function(e){rt(t,e,r[e]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Gt(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e));});}return t;}function te(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable;})),r.push.apply(r,n);}return r;}function ee(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?te(Object(r),!0).forEach(function(e){rt(t,e,r[e]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):te(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e));});}return t;}function re(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0;}catch(t){return!1;}}();return function(){var r,n=l(t);if(e){var o=l(this).constructor;r=Reflect.construct(n,arguments,o);}else r=n.apply(this,arguments);return c(this,r);};}var ne=function(e){i(o,e);var n=re(o);function o(e){var r;t(this,o),(r=n.call(this,e)).name="control";var i=e.option,a=e.template.$player;return r.mouseMoveTime=Date.now(),e.on("mousemove",function(){r.show=!0,w(a,"art-hide-cursor"),b(a,"art-hover"),r.mouseMoveTime=Date.now();}),e.on("video:timeupdate",function(){e.playing&&r.show&&Date.now()-r.mouseMoveTime>=3e3&&(r.show=!1,b(a,"art-hide-cursor"),w(a,"art-hover"));}),e.once("ready",function(){r.add(It({name:"progress",disable:i.isLive,position:"top",index:10})),r.add(Qt({name:"thumbnails",disable:!i.thumbnails.url||i.isLive,position:"top",index:20})),r.add(function(t){return function(e){return ee(ee({},t),{},{mounted:function mounted(t){var r=O(t,'<span class="art-loop-point"></span>'),n=O(t,'<span class="art-loop-point"></span>');e.on("loop",function(o){o?(k(t,"display","block"),k(r,"left","calc(".concat(o[0]/e.duration*100,"% - ").concat(r.clientWidth,"px)")),k(n,"left","".concat(o[1]/e.duration*100,"%"))):k(t,"display","none");});}});};}({name:"loop",disable:!1,position:"top",index:30})),r.add(function(t){return function(e){return At(At({},t),{},{mounted:function mounted(t){var r=e.events.proxy,n=e.icons,o=e.i18n,i=O(t,n.play),a=O(t,n.pause);function c(){k(i,"display","flex"),k(a,"display","none");}function l(){k(i,"display","none"),k(a,"display","flex");}E(i,o.get("Play")),E(a,o.get("Pause")),r(i,"click",function(){e.play();}),r(a,"click",function(){e.pause();}),e.playing?l():c(),e.on("video:playing",function(){l();}),e.on("video:pause",function(){c();});}});};}({name:"playAndPause",disable:!1,position:"left",index:10})),r.add(function(t){return function(e){return Nt(Nt({},t),{},{mounted:function mounted(t){var r=e.events.proxy,n=e.icons,o=e.i18n,i=!1,a=O(t,n.volume),c=O(t,n.volumeClose),l=O(t,'<div class="art-volume-panel"></div>'),s=O(l,'<div class="art-volume-slider-handle"></div>');function u(t){var e=l.getBoundingClientRect().left;return G(t.pageX-e-6,0,54)/48;}function p(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.7;if(e.muted||0===t)k(a,"display","none"),k(c,"display","flex"),k(s,"left","0");else{var r=48*t;k(a,"display","flex"),k(c,"display","none"),k(s,"left","".concat(r,"px"));}}E(a,o.get("Mute")),k(c,"display","none"),d&&k(l,"display","none"),p(e.volume),e.on("video:volumechange",function(){p(e.volume);}),r(a,"click",function(){e.muted=!0;}),r(c,"click",function(){e.muted=!1;}),r(l,"click",function(t){e.muted=!1,e.volume=u(t);}),r(s,"mousedown",function(){i=!0;}),r(t,"mousemove",function(t){i&&(e.muted=!1,e.volume=u(t));}),r(document,"mouseup",function(){i&&(i=!1);});}});};}({name:"volume",disable:!1,position:"left",index:20})),r.add(function(t){return function(e){return Ht(Ht({},t),{},{mounted:function mounted(t){function r(){var r="".concat(K(e.currentTime)," / ").concat(K(e.duration));r!==t.innerText&&(t.innerText=r);}r();for(var n=["video:loadedmetadata","video:timeupdate","video:progress"],o=0;o<n.length;o++){e.on(n[o],r);}}});};}({name:"time",disable:i.isLive,position:"left",index:30})),r.add(function(t){return function(e){var r=e.option.quality,n=r.find(function(t){return t.default;})||r[0];return Kt(Kt({},t),{},{html:n?n.html:"",selector:r,onSelect:function onSelect(t){e.switchQuality(t.url,t.html);}});};}({name:"quality",disable:0===i.quality.length,position:"right",index:10})),r.add(function(t){return function(e){return Jt(Jt({},t),{},{tooltip:e.i18n.get("Screenshot"),mounted:function mounted(t){var r=e.events.proxy;O(t,e.icons.screenshot),r(t,"click",function(){e.screenshot();});}});};}({name:"screenshot",disable:!i.screenshot,position:"right",index:20})),r.add(function(t){return function(e){return qt(qt({},t),{},{tooltip:e.i18n.get("Hide Subtitle"),mounted:function mounted(t){var r=e.events.proxy,n=e.icons,o=e.i18n,i=e.subtitle;O(t,n.subtitle),r(t,"click",function(){i.toggle=!0;}),e.on("subtitle",function(e){E(t,o.get(e?"Hide Subtitle":"Show Subtitle"));});}});};}({name:"subtitle",disable:!i.subtitle.url,position:"right",index:30})),r.add(function(t){return function(e){return Ut(Ut({},t),{},{tooltip:e.i18n.get("Show Setting"),mounted:function mounted(t){var r=e.events.proxy,n=e.icons,o=e.i18n,i=e.setting;O(t,n.setting),r(t,"click",function(){i.toggle=!0;}),e.on("setting",function(e){E(t,o.get(e?"Hide Setting":"Show Setting"));});}});};}({name:"setting",disable:!i.setting,position:"right",index:40})),r.add(function(t){return function(e){return Tt(Tt({},t),{},{tooltip:e.i18n.get("PIP Mode"),mounted:function mounted(t){var r=e.events.proxy,n=e.icons,o=e.i18n;O(t,n.pip),r(t,"click",function(){e.pip=!e.pip;}),e.on("pip",function(e){E(t,o.get(e?"Exit PIP Mode":"PIP Mode"));});}});};}({name:"pip",disable:!i.pip,position:"right",index:50})),r.add(function(t){return function(e){return Ct(Ct({},t),{},{tooltip:e.i18n.get("Web Fullscreen"),mounted:function mounted(t){var r=e.events.proxy,n=e.icons,o=e.i18n;O(t,n.fullscreenWeb),r(t,"click",function(){e.fullscreenWeb=!e.fullscreenWeb;}),e.on("fullscreenWeb",function(e){E(t,o.get(e?"Exit Web Fullscreen":"Web Fullscreen"));});}});};}({name:"fullscreenWeb",disable:!i.fullscreenWeb,position:"right",index:60})),r.add(function(t){return function(e){return Et(Et({},t),{},{tooltip:e.i18n.get("Fullscreen"),mounted:function mounted(t){var r=e.events.proxy,n=e.icons,o=e.i18n;O(t,n.fullscreen),r(t,"click",function(){e.fullscreen=!e.fullscreen;}),e.on("fullscreen",function(e){E(t,o.get(e?"Exit Fullscreen":"Fullscreen"));});}});};}({name:"fullscreen",disable:!i.fullscreen,position:"right",index:70}));for(var t=0;t<i.controls.length;t++){r.add(i.controls[t]);}}),r;}return r(o,[{key:"add",value:function value(t){var e="function"==typeof t?t(this.art):t,r=this.art.template,n=r.$progress,i=r.$controlsLeft,a=r.$controlsRight;switch(e.position){case"top":this.$parent=n;break;case"left":this.$parent=i;break;case"right":this.$parent=a;break;default:F(!1,"Control option.position must one of 'top', 'left', 'right'");}Pt(l(o.prototype),"add",this).call(this,e);}}]),o;}(St);function oe(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable;})),r.push.apply(r,n);}return r;}function ie(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?oe(Object(r),!0).forEach(function(e){rt(t,e,r[e]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):oe(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e));});}return t;}function ae(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable;})),r.push.apply(r,n);}return r;}function ce(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ae(Object(r),!0).forEach(function(e){rt(t,e,r[e]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ae(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e));});}return t;}function le(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable;})),r.push.apply(r,n);}return r;}function se(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?le(Object(r),!0).forEach(function(e){rt(t,e,r[e]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):le(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e));});}return t;}function ue(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable;})),r.push.apply(r,n);}return r;}function pe(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ue(Object(r),!0).forEach(function(e){rt(t,e,r[e]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ue(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e));});}return t;}function fe(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable;})),r.push.apply(r,n);}return r;}function de(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?fe(Object(r),!0).forEach(function(e){rt(t,e,r[e]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):fe(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e));});}return t;}function he(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable;})),r.push.apply(r,n);}return r;}function ve(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?he(Object(r),!0).forEach(function(e){rt(t,e,r[e]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):he(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e));});}return t;}function ye(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0;}catch(t){return!1;}}();return function(){var r,n=l(t);if(e){var o=l(this).constructor;r=Reflect.construct(n,arguments,o);}else r=n.apply(this,arguments);return c(this,r);};}var me=function(e){i(o,e);var n=ye(o);function o(e){var r;return t(this,o),(r=n.call(this,e)).art=e,r.name="contextmenu",r.$parent=e.template.$contextmenu,e.once("ready",function(){d||r.init();}),r;}return r(o,[{key:"init",value:function value(){var t=this,e=this.art,r=e.option,n=e.template,o=n.$player,i=n.$contextmenu,a=e.events.proxy;this.add(function(t){return function(e){var r=e.i18n;return ie(ie({},t),{},{html:"".concat(r.get("Play Speed"),':<span data-value="0.5">0.5</span><span data-value="0.75">0.75</span><span data-value="1.0" class="art-current">').concat(r.get("Normal"),'</span><span data-value="1.25">1.25</span><span data-value="1.5">1.5</span><span data-value="2.0">2.0</span>'),click:function click(t,r){var n=r.target.dataset.value;n&&(e.playbackRate=Number(n),t.show=!1);},mounted:function mounted(t){e.on("playbackRate",function(e){var r=g("span",t).find(function(t){return Number(t.dataset.value)===e;});r&&R(r,"art-current");});}});};}({disable:!r.playbackRate,name:"playbackRate",index:10})),this.add(function(t){return function(e){var r=e.i18n;return ce(ce({},t),{},{html:"".concat(r.get("Aspect Ratio"),':<span data-value="default" class="art-current">').concat(r.get("Default"),'</span><span data-value="4:3">4:3</span><span data-value="16:9">16:9</span>'),click:function click(t,r){var n=r.target.dataset.value;n&&(e.aspectRatio=n,t.show=!1);},mounted:function mounted(t){e.on("aspectRatio",function(e){var r=g("span",t).find(function(t){return t.dataset.value===e;});r&&R(r,"art-current");});}});};}({disable:!r.aspectRatio,name:"aspectRatio",index:20})),this.add(function(t){return function(e){var r=e.i18n;return se(se({},t),{},{html:"".concat(r.get("Video Flip"),':<span data-value="normal" class="art-current">').concat(r.get("Normal"),'</span><span data-value="horizontal">').concat(r.get("Horizontal"),'</span><span data-value="vertical">').concat(r.get("Vertical"),"</span>"),click:function click(t,r){var n=r.target.dataset.value;n&&(e.flip=n,t.show=!1);},mounted:function mounted(t){e.on("flip",function(e){var r=g("span",t).find(function(t){return t.dataset.value===e;});r&&R(r,"art-current");});}});};}({disable:!r.flip,name:"flip",index:30})),this.add(function(t){return function(e){return pe(pe({},t),{},{html:e.i18n.get("Video Info"),click:function click(t){e.info.show=!0,t.show=!1;}});};}({disable:!1,name:"info",index:40})),this.add(function(t){return de(de({},t),{},{html:'<a href="https://artplayer.org" target="_blank">ArtPlayer 4.3.1</a>'});}({disable:!1,name:"version",index:50})),this.add(function(t){return function(e){return ve(ve({},t),{},{html:e.i18n.get("Close"),click:function click(t){t.show=!1;}});};}({disable:!1,name:"close",index:60}));for(var c=0;c<r.contextmenu.length;c++){this.add(r.contextmenu[c]);}a(o,"contextmenu",function(e){e.preventDefault(),t.show=!0;var r=e.clientX,n=e.clientY,a=o.getBoundingClientRect(),c=a.height,l=a.width,s=a.left,u=a.top,p=i.getBoundingClientRect(),f=p.height,d=p.width,h=r-s,v=n-u;r+d>s+l&&(h=l-d),n+f>u+c&&(v=c-f),j(i,{top:"".concat(v,"px"),left:"".concat(h,"px")});}),a(o,"click",function(e){C(e,i)||(t.show=!1);}),this.art.on("blur",function(){t.show=!1;});}}]),o;}(St);function ge(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0;}catch(t){return!1;}}();return function(){var r,n=l(t);if(e){var o=l(this).constructor;r=Reflect.construct(n,arguments,o);}else r=n.apply(this,arguments);return c(this,r);};}var be=function(e){i(o,e);var n=ge(o);function o(e){var r;return t(this,o),(r=n.call(this,e)).name="info",e.once("ready",function(){d||r.init();}),r;}return r(o,[{key:"init",value:function value(){var t=this,e=this.art,r=e.events.proxy,n=e.template,o=n.$infoPanel,i=n.$infoClose,a=n.$video;r(i,"click",function(){t.show=!1;});var c=null,l=g("[data-video]",o)||[];this.art.on("destroy",function(){clearTimeout(c);}),function t(){for(var e=0;e<l.length;e++){var r=l[e],n=a[r.dataset.video],o="number"==typeof n?n.toFixed(2):n;r.innerText!==o&&(r.innerText=o);}c=setTimeout(t,1e3);}();}}]),o;}(St);function we(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable;})),r.push.apply(r,n);}return r;}function xe(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?we(Object(r),!0).forEach(function(e){rt(t,e,r[e]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):we(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e));});}return t;}function Oe(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0;}catch(t){return!1;}}();return function(){var r,n=l(t);if(e){var o=l(this).constructor;r=Reflect.construct(n,arguments,o);}else r=n.apply(this,arguments);return c(this,r);};}var ke=function(e){i(o,e);var n=Oe(o);function o(e){var r;return t(this,o),(r=n.call(this,e)).name="subtitle",e.once("ready",function(){r.init(e.option.subtitle);}),r;}return r(o,[{key:"url",get:function get(){return this.art.template.$track.src;},set:function set(t){this.switch(t);}},{key:"textTrack",get:function get(){return this.art.template.$video.textTracks[0];}},{key:"activeCue",get:function get(){return this.textTrack.activeCues[0];}},{key:"bilingual",get:function get(){return x(this.art.template.$subtitle,"art-bilingual");},set:function set(t){var e=this.art.template.$subtitle;t?b(e,"art-bilingual"):w(e,"art-bilingual");}},{key:"style",value:function value(t,e){var r=this.art.template.$subtitle;return"object"===a(t)?j(r,t):k(r,t,e);}},{key:"update",value:function value(){var t=this.art.template.$subtitle;t.innerHTML="",this.activeCue&&(t.innerHTML=this.activeCue.text.split(/\r?\n/).map(function(t){return"<p>".concat(tt(t),"</p>");}).join(""),this.art.emit("subtitleUpdate",this.activeCue.text));}},{key:"switch",value:function value(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.art,n=r.i18n,o=r.notice,i=r.option,a=xe(xe(xe({},i.subtitle),e),{},{url:t});return this.init(a).then(function(t){return e.name&&(o.show="".concat(n.get("Switch Subtitle"),": ").concat(e.name)),t;});}},{key:"init",value:function value(t){var e=this;if(u(t,ft.subtitle),t.url){var r=this.art,n=r.notice,o=r.events.proxy,i=r.template,a=i.$subtitle,c=i.$video;if(!i.$track){var l=document.createElement("track");l.default=!0,l.kind="metadata",c.appendChild(l),this.art.template.$track=l,o(this.textTrack,"cuechange",this.update.bind(this));}return this.style(t.style),this.bilingual=t.bilingual,F(window.fetch,"fetch not support"),fetch(t.url).then(function(t){return t.arrayBuffer();}).then(function(r){F(window.TextDecoder,"TextDecoder not support");var n=new TextDecoder(t.encoding).decode(r);switch(e.art.emit("subtitleLoad",t.url),t.type||V(t.url)){case"srt":return B(I(n));case"ass":return B(q(n));case"vtt":return B(n);default:return t.url;}}).then(function(t){return a.innerHTML="",e.url===t||(URL.revokeObjectURL(e.url),e.art.template.$track.src=t,e.art.emit("subtitleSwitch",t)),t;}).catch(function(t){throw n.show=t,t;});}}}]),o;}(St);var je=function(){function e(r){var n=this;t(this,e),this.destroyEvents=[],this.proxy=this.proxy.bind(this),this.hover=this.hover.bind(this),this.loadImg=this.loadImg.bind(this),r.whitelist.state&&r.once("ready",function(){!function(t,e){var r=t.template.$player;e.proxy(document,["click","contextmenu"],function(e){C(e,r)?(t.isFocus=!0,t.emit("focus")):(t.isFocus=!1,t.emit("blur"));});}(r,n),function(t,e){var r=t.template.$player;e.hover(r,function(){b(r,"art-hover"),t.emit("hover",!0);},function(){w(r,"art-hover"),t.emit("hover");});}(r,n),function(t,e){var r=t.template.$player;e.proxy(r,"mousemove",function(e){t.emit("mousemove",e);});}(r,n),function(t,e){var r=t.notice,n=t.option,o=J(function(){t.normalSize&&(t.autoSize=n.autoSize),t.aspectRatioReset=!0,r.show="",t.emit("resize");},500);e.proxy(window,["orientationchange","resize"],function(){o();}),screen&&screen.orientation&&screen.orientation.onchange&&e.proxy(screen.orientation,"change",function(){o();});}(r,n),function(t,e){if(d&&!t.option.isLive){var r=t.notice,n=t.template.$video,o=!1,i=0,a=0;e.proxy(n,"touchstart",function(t){1===t.touches.length&&(o=!0,i=t.touches[0].clientX);}),e.proxy(n,"touchmove",function(e){if(1===e.touches.length&&o){var c=G((e.touches[0].clientX-i)/n.clientWidth,-1,1);a=G(t.currentTime+t.duration*c,0,t.duration),r.show="".concat(K(a)," / ").concat(K(t.duration));}}),e.proxy(document,"touchend",function(){o&&a&&(t.seek=a),o=!1,i=0,a=0;});}}(r,n),function(t,e){var r=t.option,n=t.template.$container,o=J(function(){t.emit("view",$(n,50));},200);e.proxy(window,"scroll",function(){o();}),t.on("view",function(e){r.autoMini&&(t.mini=!e);});}(r,n);});}return r(e,[{key:"proxy",value:function value(t,e,r){var n=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(Array.isArray(e))return e.map(function(e){return n.proxy(t,e,r,o);});t.addEventListener(e,r,o);var i=function i(){return t.removeEventListener(e,r,o);};return this.destroyEvents.push(i),i;}},{key:"hover",value:function value(t,e,r){e&&this.proxy(t,"mouseenter",e),r&&this.proxy(t,"mouseleave",r);}},{key:"loadImg",value:function value(t){var e=this;return new Promise(function(r,n){var o;if(t instanceof HTMLImageElement)o=t;else{if("string"!=typeof t)return n(new L("Unable to get Image"));(o=new Image()).src=t;}if(o.complete)return r(o);e.proxy(o,"load",function(){return r(o);}),e.proxy(o,"error",function(){return n(new L("Failed to load Image: ".concat(o.src)));});});}},{key:"destroy",value:function value(){for(var t=0;t<this.destroyEvents.length;t++){this.destroyEvents[t]();}}}]),e;}(),Pe=function(){function e(r){var n=this;t(this,e),this.art=r,this.keys={},r.once("ready",function(){r.option.hotkey&&!d&&n.init();});}return r(e,[{key:"init",value:function value(){var t=this,e=this.art.events.proxy;this.add(27,function(){t.art.fullscreenWeb&&(t.art.fullscreenWeb=!1);}),this.add(32,function(){t.art.toggle();}),this.add(37,function(){t.art.backward=5;}),this.add(38,function(){t.art.volume+=.1;}),this.add(39,function(){t.art.forward=5;}),this.add(40,function(){t.art.volume-=.1;}),e(window,"keydown",function(e){if(t.art.isFocus){var r=document.activeElement.tagName.toUpperCase(),n=document.activeElement.getAttribute("contenteditable");if("INPUT"!==r&&"TEXTAREA"!==r&&""!==n&&"true"!==n){var o=t.keys[e.keyCode];if(o){e.preventDefault();for(var i=0;i<o.length;i++){o[i].call(t.art,e);}t.art.emit("hotkey",e);}}}});}},{key:"add",value:function value(t,e){return this.keys[t]?this.keys[t].push(e):this.keys[t]=[e],this;}},{key:"remove",value:function value(t,e){if(this.keys[t]){var r=this.keys[t].indexOf(e);-1!==r&&this.keys[t].splice(r,1);}return this;}}]),e;}();function Se(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0;}catch(t){return!1;}}();return function(){var r,n=l(t);if(e){var o=l(this).constructor;r=Reflect.construct(n,arguments,o);}else r=n.apply(this,arguments);return c(this,r);};}var Re=function(e){i(o,e);var n=Se(o);function o(e){var r;t(this,o),r=n.call(this,e);var i=e.option,a=e.template.$layer;return r.name="layer",r.$parent=a,e.once("ready",function(){for(var t=0;t<i.layers.length;t++){r.add(i.layers[t]);}}),r;}return r(o);}(St);function Ee(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0;}catch(t){return!1;}}();return function(){var r,n=l(t);if(e){var o=l(this).constructor;r=Reflect.construct(n,arguments,o);}else r=n.apply(this,arguments);return c(this,r);};}var $e=function(e){i(o,e);var n=Ee(o);function o(e){var r;return t(this,o),(r=n.call(this,e)).name="loading",O(e.template.$loading,e.icons.loading),r;}return r(o);}(St),Ce=function(){function e(r){t(this,e),this.art=r,this.time=2e3,this.timer=null;}return r(e,[{key:"show",set:function set(t){var e=this.art.template,r=e.$player,n=e.$noticeInner;if(!t)return w(r,"art-notice-show");n.innerText=t instanceof Error?t.message.trim():t,b(r,"art-notice-show"),clearTimeout(this.timer),this.timer=setTimeout(function(){n.innerText="",w(r,"art-notice-show");},this.time);}}]),e;}();function ze(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0;}catch(t){return!1;}}();return function(){var r,n=l(t);if(e){var o=l(this).constructor;r=Reflect.construct(n,arguments,o);}else r=n.apply(this,arguments);return c(this,r);};}var Te=function(e){i(o,e);var n=ze(o);function o(e){var r;return t(this,o),(r=n.call(this,e)).name="mask",O(e.template.$state,e.icons.state),r;}return r(o);}(St);function De(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable;})),r.push.apply(r,n);}return r;}var Ae=r(function e(r){var n=this;t(this,e);var o=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?De(Object(r),!0).forEach(function(e){rt(t,e,r[e]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):De(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e));});}return t;}({loading:'<svg xmlns="http://www.w3.org/2000/svg" width="50px" height="50px" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="uil-default"><rect x="0" y="0" width="100" height="100" fill="none" class="bk"/><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(0 50 50) translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-1s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(30 50 50) translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.9166666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(60 50 50) translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.8333333333333334s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(90 50 50) translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.75s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(120 50 50) translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.6666666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(150 50 50) translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5833333333333334s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(180 50 50) translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(210 50 50) translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.4166666666666667s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(240 50 50) translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.3333333333333333s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(270 50 50) translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.25s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(300 50 50) translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.16666666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(330 50 50) translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.08333333333333333s" repeatCount="indefinite"/></rect></svg>',state:'<svg xmlns="http://www.w3.org/2000/svg" height="60" width="60" style="filter: drop-shadow(0px 1px 1px black);" viewBox="0 0 24 24"><path d="M20,2H4C1.8,2,0,3.8,0,6v12c0,2.2,1.8,4,4,4h16c2.2,0,4-1.8,4-4V6C24,3.8,22.2,2,20,2z M15.6,12.8L10.5,16 C9.9,16.5,9,16,9,15.2V8.8C9,8,9.9,7.5,10.5,8l5.1,3.2C16.3,11.5,16.3,12.5,15.6,12.8z"/></svg>',play:'<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 22 22"><path d="M17.982 9.275L8.06 3.27A2.013 2.013 0 0 0 5 4.994v12.011a2.017 2.017 0 0 0 3.06 1.725l9.922-6.005a2.017 2.017 0 0 0 0-3.45z"></path></svg>',pause:'<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 22 22"><path d="M7 3a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2zM15 3a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2z"></path></svg>',check:'<svg xmlns="http://www.w3.org/2000/svg" height="100%" version="1.1" viewBox="0 0 24 24" width="100%"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z" fill="#fff" /></svg>',volume:'<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 22 22"><path d="M10.188 4.65L6 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39V5.04a.498.498 0 0 0-.812-.39zM14.446 3.778a1 1 0 0 0-.862 1.804 6.002 6.002 0 0 1-.007 10.838 1 1 0 0 0 .86 1.806A8.001 8.001 0 0 0 19 11a8.001 8.001 0 0 0-4.554-7.222z"></path><path d="M15 11a3.998 3.998 0 0 0-2-3.465v6.93A3.998 3.998 0 0 0 15 11z"></path></svg>',volumeClose:'<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 22 22"><path d="M15 11a3.998 3.998 0 0 0-2-3.465v2.636l1.865 1.865A4.02 4.02 0 0 0 15 11z"></path><path d="M13.583 5.583A5.998 5.998 0 0 1 17 11a6 6 0 0 1-.585 2.587l1.477 1.477a8.001 8.001 0 0 0-3.446-11.286 1 1 0 0 0-.863 1.805zM18.778 18.778l-2.121-2.121-1.414-1.414-1.415-1.415L13 13l-2-2-3.889-3.889-3.889-3.889a.999.999 0 1 0-1.414 1.414L5.172 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39v-3.131l2.587 2.587-.01.005a1 1 0 0 0 .86 1.806c.215-.102.424-.214.627-.333l2.3 2.3a1.001 1.001 0 0 0 1.414-1.416zM11 5.04a.5.5 0 0 0-.813-.39L8.682 5.854 11 8.172V5.04z"></path></svg>',subtitle:'<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 48 48"><path d="M0 0h48v48H0z" fill="none"/><path d="M40 8H8c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h32c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM8 24h8v4H8v-4zm20 12H8v-4h20v4zm12 0h-8v-4h8v4zm0-8H20v-4h20v4z"/></svg>',screenshot:'<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 50 50">\t<path d="M 19.402344 6 C 17.019531 6 14.96875 7.679688 14.5 10.011719 L 14.097656 12 L 9 12 C 6.238281 12 4 14.238281 4 17 L 4 38 C 4 40.761719 6.238281 43 9 43 L 41 43 C 43.761719 43 46 40.761719 46 38 L 46 17 C 46 14.238281 43.761719 12 41 12 L 35.902344 12 L 35.5 10.011719 C 35.03125 7.679688 32.980469 6 30.597656 6 Z M 25 17 C 30.519531 17 35 21.480469 35 27 C 35 32.519531 30.519531 37 25 37 C 19.480469 37 15 32.519531 15 27 C 15 21.480469 19.480469 17 25 17 Z M 25 19 C 20.589844 19 17 22.589844 17 27 C 17 31.410156 20.589844 35 25 35 C 29.410156 35 33 31.410156 33 27 C 33 22.589844 29.410156 19 25 19 Z "/></svg>',setting:'<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 22 22"><circle cx="11" cy="11" r="2"></circle><path d="M19.164 8.861L17.6 8.6a6.978 6.978 0 0 0-1.186-2.099l.574-1.533a1 1 0 0 0-.436-1.217l-1.997-1.153a1.001 1.001 0 0 0-1.272.23l-1.008 1.225a7.04 7.04 0 0 0-2.55.001L8.716 2.829a1 1 0 0 0-1.272-.23L5.447 3.751a1 1 0 0 0-.436 1.217l.574 1.533A6.997 6.997 0 0 0 4.4 8.6l-1.564.261A.999.999 0 0 0 2 9.847v2.306c0 .489.353.906.836.986l1.613.269a7 7 0 0 0 1.228 2.075l-.558 1.487a1 1 0 0 0 .436 1.217l1.997 1.153c.423.244.961.147 1.272-.23l1.04-1.263a7.089 7.089 0 0 0 2.272 0l1.04 1.263a1 1 0 0 0 1.272.23l1.997-1.153a1 1 0 0 0 .436-1.217l-.557-1.487c.521-.61.94-1.31 1.228-2.075l1.613-.269a.999.999 0 0 0 .835-.986V9.847a.999.999 0 0 0-.836-.986zM11 15a4 4 0 1 1 0-8 4 4 0 0 1 0 8z"></path></svg>',fullscreen:'<svg xmlns="http://www.w3.org/2000/svg" height="36" width="36" viewBox="0 0 36 36">\t<path d="m 10,16 2,0 0,-4 4,0 0,-2 L 10,10 l 0,6 0,0 z"></path>\t<path d="m 20,10 0,2 4,0 0,4 2,0 L 26,10 l -6,0 0,0 z"></path>\t<path d="m 24,24 -4,0 0,2 L 26,26 l 0,-6 -2,0 0,4 0,0 z"></path>\t<path d="M 12,20 10,20 10,26 l 6,0 0,-2 -4,0 0,-4 0,0 z"></path></svg>',fullscreenWeb:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" height="36" width="36">\t<path d="m 28,11 0,14 -20,0 0,-14 z m -18,2 16,0 0,10 -16,0 0,-10 z" fill-rule="evenodd"></path></svg>',pip:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" height="32" width="32"><path d="M25,17 L17,17 L17,23 L25,23 L25,17 L25,17 Z M29,25 L29,10.98 C29,9.88 28.1,9 27,9 L9,9 C7.9,9 7,9.88 7,10.98 L7,25 C7,26.1 7.9,27 9,27 L27,27 C28.1,27 29,26.1 29,25 L29,25 Z M27,25.02 L9,25.02 L9,10.97 L27,10.97 L27,25.02 L27,25.02 Z"></path></svg>',arrowLeft:'<svg xmlns="http://www.w3.org/2000/svg" height="100%" version="1.1" viewBox="0 0 32 32" width="100%"><path d="M 19.41,20.09 14.83,15.5 19.41,10.91 18,9.5 l -6,6 6,6 z" fill="#fff" /></svg>',arrowRight:'<svg xmlns="http://www.w3.org/2000/svg" height="100%" version="1.1" viewBox="0 0 32 32" width="100%"><path d="m 12.59,20.34 4.58,-4.59 -4.58,-4.59 1.41,-1.41 6,6 -6,6 z" fill="#fff"/></svg>',playbackRate:'<svg height="24" viewBox="0 0 24 24" width="24"><path d="M10,8v8l6-4L10,8L10,8z M6.3,5L5.7,4.2C7.2,3,9,2.2,11,2l0.1,1C9.3,3.2,7.7,3.9,6.3,5z            M5,6.3L4.2,5.7C3,7.2,2.2,9,2,11 l1,.1C3.2,9.3,3.9,7.7,5,6.3z            M5,17.7c-1.1-1.4-1.8-3.1-2-4.8L2,13c0.2,2,1,3.8,2.2,5.4L5,17.7z            M11.1,21c-1.8-0.2-3.4-0.9-4.8-2 l-0.6,.8C7.2,21,9,21.8,11,22L11.1,21z            M22,12c0-5.2-3.9-9.4-9-10l-0.1,1c4.6,.5,8.1,4.3,8.1,9s-3.5,8.5-8.1,9l0.1,1 C18.2,21.5,22,17.2,22,12z" fill="white" data-darkreader-inline-fill="" style="--darkreader-inline-fill:#a8a6a4;"></path></svg>',aspectRatio:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 88 88" width="88" height="88" preserveAspectRatio="xMidYMid meet" style="width: 100%; height: 100%; transform: translate3d(0px, 0px, 0px);"><defs><clipPath id="__lottie_element_216"><rect width="88" height="88" x="0" y="0"></rect></clipPath></defs><g clip-path="url(#__lottie_element_216)"><g transform="matrix(1,0,0,1,44,44)" opacity="1" style="display: block;"><g opacity="1" transform="matrix(1,0,0,1,0,0)"><path fill="rgb(255,255,255)" fill-opacity="1" d=" M12.437999725341797,-12.70199966430664 C12.437999725341797,-12.70199966430664 9.618000030517578,-9.881999969482422 9.618000030517578,-9.881999969482422 C8.82800006866455,-9.092000007629395 8.82800006866455,-7.831999778747559 9.618000030517578,-7.052000045776367 C9.618000030517578,-7.052000045776367 16.687999725341797,0.017999999225139618 16.687999725341797,0.017999999225139618 C16.687999725341797,0.017999999225139618 9.618000030517578,7.0879998207092285 9.618000030517578,7.0879998207092285 C8.82800006866455,7.877999782562256 8.82800006866455,9.137999534606934 9.618000030517578,9.918000221252441 C9.618000030517578,9.918000221252441 12.437999725341797,12.748000144958496 12.437999725341797,12.748000144958496 C13.227999687194824,13.527999877929688 14.48799991607666,13.527999877929688 15.267999649047852,12.748000144958496 C15.267999649047852,12.748000144958496 26.58799934387207,1.437999963760376 26.58799934387207,1.437999963760376 C27.368000030517578,0.6579999923706055 27.368000030517578,-0.6119999885559082 26.58799934387207,-1.3919999599456787 C26.58799934387207,-1.3919999599456787 15.267999649047852,-12.70199966430664 15.267999649047852,-12.70199966430664 C14.48799991607666,-13.491999626159668 13.227999687194824,-13.491999626159668 12.437999725341797,-12.70199966430664z M-12.442000389099121,-12.70199966430664 C-13.182000160217285,-13.442000389099121 -14.362000465393066,-13.482000350952148 -15.142000198364258,-12.821999549865723 C-15.142000198364258,-12.821999549865723 -15.272000312805176,-12.70199966430664 -15.272000312805176,-12.70199966430664 C-15.272000312805176,-12.70199966430664 -26.582000732421875,-1.3919999599456787 -26.582000732421875,-1.3919999599456787 C-27.32200050354004,-0.6520000100135803 -27.36199951171875,0.5180000066757202 -26.70199966430664,1.3079999685287476 C-26.70199966430664,1.3079999685287476 -26.582000732421875,1.437999963760376 -26.582000732421875,1.437999963760376 C-26.582000732421875,1.437999963760376 -15.272000312805176,12.748000144958496 -15.272000312805176,12.748000144958496 C-14.531999588012695,13.48799991607666 -13.362000465393066,13.527999877929688 -12.571999549865723,12.868000030517578 C-12.571999549865723,12.868000030517578 -12.442000389099121,12.748000144958496 -12.442000389099121,12.748000144958496 C-12.442000389099121,12.748000144958496 -9.612000465393066,9.918000221252441 -9.612000465393066,9.918000221252441 C-8.871999740600586,9.178000450134277 -8.831999778747559,8.008000373840332 -9.501999855041504,7.2179999351501465 C-9.501999855041504,7.2179999351501465 -9.612000465393066,7.0879998207092285 -9.612000465393066,7.0879998207092285 C-9.612000465393066,7.0879998207092285 -16.68199920654297,0.017999999225139618 -16.68199920654297,0.017999999225139618 C-16.68199920654297,0.017999999225139618 -9.612000465393066,-7.052000045776367 -9.612000465393066,-7.052000045776367 C-8.871999740600586,-7.791999816894531 -8.831999778747559,-8.961999893188477 -9.501999855041504,-9.751999855041504 C-9.501999855041504,-9.751999855041504 -9.612000465393066,-9.881999969482422 -9.612000465393066,-9.881999969482422 C-9.612000465393066,-9.881999969482422 -12.442000389099121,-12.70199966430664 -12.442000389099121,-12.70199966430664z M28,-28 C32.41999816894531,-28 36,-24.420000076293945 36,-20 C36,-20 36,20 36,20 C36,24.420000076293945 32.41999816894531,28 28,28 C28,28 -28,28 -28,28 C-32.41999816894531,28 -36,24.420000076293945 -36,20 C-36,20 -36,-20 -36,-20 C-36,-24.420000076293945 -32.41999816894531,-28 -28,-28 C-28,-28 28,-28 28,-28z" data-darkreader-inline-fill="" style="--darkreader-inline-fill:#a8a6a4;"></path></g></g></g></svg>',config:'<svg height="24" viewBox="0 0 24 24" width="24"><path d="M15,17h6v1h-6V17z M11,17H3v1h8v2h1v-2v-1v-2h-1V17z M14,8h1V6V5V3h-1v2H3v1h11V8z            M18,5v1h3V5H18z M6,14h1v-2v-1V9H6v2H3v1 h3V14z M10,12h11v-1H10V12z" fill="white" data-darkreader-inline-fill="" style="--darkreader-inline-fill:#a8a6a4;"></path></svg>'},r.option.icons);Object.keys(o).forEach(function(t){_(n,t,{get:function get(){var e=document.createElement("i");return b(e,"art-icon"),b(e,"art-icon-".concat(t)),O(e,o[t]),e;}});});});function Me(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0;}catch(t){return!1;}}();return function(){var r,n=l(t);if(e){var o=l(this).constructor;r=Reflect.construct(n,arguments,o);}else r=n.apply(this,arguments);return c(this,r);};}function Le(t,e,r){for(var n=0;n<t.length;n++){var o=t[n];o._parentItem=e,o._parentList=r,o.selector&&Le(o.selector,o,t);}return t;}var Fe=function(e){i(o,e);var n=Me(o);function o(e){var r;t(this,o),r=n.call(this,e);var i=e.option,a=e.events.proxy,c=e.template,l=c.$setting,s=c.$player;return r.art=e,r.name="setting",r.$parent=l,r.width=250,r.option=[],r.cache=new Map(),i.setting&&(e.once("ready",function(){i.playbackRate&&r.option.push(function(t){var e=t.i18n,r=t.icons;function n(t){return 1===t?e.get("Normal"):t;}function o(t,e,r){e&&(e.innerText=n(r));var o=g(".art-setting-item",t).find(function(t){return Number(t.dataset.value)===r;});o&&R(o,"art-current");}return{width:200,html:e.get("Play Speed"),tooltip:n(t.playbackRate),icon:r.playbackRate,selector:[.5,.75,1,1.25,1.5,2].map(function(e){return{value:e,default:e===t.playbackRate,html:n(e)};}),onSelect:function onSelect(e){t.playbackRate=e.value;},mounted:function mounted(e,r){o(e,r._$tooltip,t.playbackRate),t.on("playbackRate",function(){o(e,r._$tooltip,t.playbackRate);});}};}(e)),i.aspectRatio&&r.option.push(function(t){var e=t.i18n,r=t.icons;function n(t){return"default"===t?e.get("Default"):t;}function o(t,e,r){e&&(e.innerText=n(r));var o=g(".art-setting-item",t).find(function(t){return t.dataset.value===r;});o&&R(o,"art-current");}return{width:200,html:e.get("Aspect Ratio"),icon:r.aspectRatio,tooltip:n(t.aspectRatio),selector:["default","4:3","16:9"].map(function(e){return{value:e,default:e===t.aspectRatio,html:n(e)};}),onSelect:function onSelect(e){t.aspectRatio=e.value;},mounted:function mounted(e,r){o(e,r._$tooltip,t.aspectRatio),t.on("aspectRatio",function(){o(e,r._$tooltip,t.aspectRatio);});}};}(e)),i.flip&&r.option.push(function(t){var e=t.i18n,r=t.icons,n={normal:"Normal",horizontal:"Horizontal",vertical:"Vertical"};function o(t,r,o){r&&(r.innerText=e.get(n[o]));var i=g(".art-setting-item",t).find(function(t){return t.dataset.value===o;});i&&R(i,"art-current");}return{width:200,html:e.get("Video Flip"),tooltip:e.get(n[t.flip]),icon:r.config,selector:Object.keys(n).map(function(r){return{value:r,default:r===t.flip,html:e.get(n[r])};}),onSelect:function onSelect(e){t.flip=e.value;},mounted:function mounted(e,r){o(e,r._$tooltip,t.flip),t.on("flip",function(){o(e,r._$tooltip,t.flip);});}};}(e)),i.subtitleOffset&&r.option.push(function(t){var e=t.i18n,r=t.icons;function n(t){return 0===t?e.get("Normal"):t;}function o(t,e,r){e&&(e.innerText=n(r));var o=g(".art-setting-item",t).find(function(t){return Number(t.dataset.value)===r;});o&&R(o,"art-current");}return{width:200,html:e.get("Subtitle Offset"),tooltip:n(t.subtitleOffset),icon:r.subtitle,selector:[-5,-4,-3,-2,-1,0,1,2,3,4,5].map(function(e){return{value:e,default:e===t.subtitleOffset,html:n(e)};}),onSelect:function onSelect(e){t.subtitleOffset=e.value;},mounted:function mounted(e,r){o(e,r._$tooltip,t.subtitleOffset),t.on("subtitleOffset",function(){o(e,r._$tooltip,t.subtitleOffset);});}};}(e));for(var t=0;t<i.settings.length;t++){r.option.push(i.settings[t]);}r.option=Le(r.option),r.init(r.option);}),e.on("blur",function(){r.show&&(r.show=!1,r.init(r.option));}),a(s,"click",function(t){!r.show||C(t,e.controls.setting)||C(t,r.$parent)||(r.show=!1,r.init(r.option));})),r;}return r(o,[{key:"creatHeader",value:function value(t){var e=this,r=this.art,n=r.icons,o=r.events.proxy,i=document.createElement("div");b(i,"art-setting-item"),b(i,"art-setting-item-back");var a=O(i,'<div class="art-setting-item-left"></div>'),c=document.createElement("div");return b(c,"art-setting-item-left-icon"),O(c,n.arrowLeft),O(a,c),O(a,t._parentItem.html),o(i,"click",function(){e.init(t._parentList);}),i;}},{key:"creatItem",value:function value(t){var e=this,r=this.art,n=r.icons,o=r.events.proxy,i=t.selector&&t.selector.length,a=document.createElement("div");b(a,"art-setting-item"),t.default&&b(a,"art-current"),void 0!==t.value&&(a.dataset.value=t.value);var c=O(a,'<div class="art-setting-item-left"></div>'),l=O(a,'<div class="art-setting-item-right"></div>'),s=document.createElement("div");if(b(s,"art-setting-item-left-icon"),O(s,i?t.icon||n.config:n.check),O(c,s),O(c,t.html),i){var u=document.createElement("div");b(u,"art-setting-item-right-tooltip"),O(l,u),t._$tooltip=u,t.tooltip&&(u.innerHTML=t.tooltip);var p=document.createElement("div");b(p,"art-setting-item-right-icon"),O(p,n.arrowRight),O(l,p);}return o(a,"click",function(r){if(i)e.init(t.selector,t.width);else if(R(a,"art-current"),t._parentList&&e.init(t._parentList),t._parentItem&&t._parentItem.onSelect){var n=t._parentItem.onSelect.call(e.art,t,a,r);t._parentItem._$tooltip&&("string"!=typeof n&&"number"!=typeof n||(t._parentItem._$tooltip.innerHTML=n));}}),a;}},{key:"add",value:function value(t){"function"==typeof t?this.option.push(t(this.art)):this.option.push(t),this.option=Le(this.option),this.init(this.option);}},{key:"init",value:function value(t,e){if(this.cache.has(t)){var r=this.cache.get(t);R(r,"art-current"),k(this.$parent,"width","".concat(r.dataset.width,"px"));}else{var n=document.createElement("div");b(n,"art-setting-panel"),t[0]&&t[0]._parentItem&&O(n,this.creatHeader(t[0]));for(var o=0;o<t.length;o++){O(n,this.creatItem(t[o]));}n.dataset.width=e||this.width,O(this.$parent,n),this.cache.set(t,n),R(n,"art-current"),k(this.$parent,"width","".concat(n.dataset.width,"px")),t[0]&&t[0]._parentItem&&t[0]._parentItem.mounted&&t[0]._parentItem.mounted.call(this.art,n,t[0]._parentItem);}}}]),o;}(St),Ie=function(){function e(){t(this,e),this.name="artplayer_settings",this.settings={};}return r(e,[{key:"get",value:function value(t){try{var e=JSON.parse(window.localStorage.getItem(this.name))||{};return t?e[t]:e;}catch(e){return t?this.settings[t]:this.settings;}}},{key:"set",value:function value(t,e){try{var r=Object.assign({},this.get(),rt({},t,e));window.localStorage.setItem(this.name,JSON.stringify(r));}catch(r){this.settings[t]=e;}}},{key:"del",value:function value(t){try{var e=this.get();delete e[t],window.localStorage.setItem(this.name,JSON.stringify(e));}catch(e){delete this.settings[t];}}},{key:"clean",value:function value(){try{window.localStorage.removeItem(this.name);}catch(t){this.settings={};}}}]),e;}();function Be(t){return t.layers.add({name:"miniProgressBar",style:{display:"none",position:"absolute",left:0,right:0,bottom:0,height:"2px",backgroundColor:"var(--theme)"},mounted:function mounted(e){t.on("control",function(t){e.style.display=t?"none":"block";}),t.on("destroy",function(){e.style.display="none";}),t.on("video:timeupdate",function(){e.style.width="".concat(100*t.played,"%");});}}),{name:"miniProgressBar"};}var qe=function(){function e(r){t(this,e),this.art=r,this.id=0;var n=r.option;!n.isLive&&n.miniProgressBar&&this.add(Be);for(var o=0;o<n.plugins.length;o++){this.add(n.plugins[o]);}}return r(e,[{key:"add",value:function value(t){this.id+=1;var e=t.call(this,this.art),r=e&&e.name||t.name||"plugin".concat(this.id);return F(!X(this,r),"Cannot add a plugin that already has the same name: ".concat(r)),_(this,r,{value:e}),this;}}]),e;}(),Ve=function(){function e(r){t(this,e),this.art=r,this.init();}return r(e,[{key:"current",get:function get(){return this.art.option.ads[this.index];}},{key:"prev",get:function get(){return this.art.option.ads[this.index-1];}},{key:"next",get:function get(){return this.art.option.ads[this.index+1];}},{key:"init",value:function value(){this.index=0,this.isEnd=!1,this.playing=!1,this.urlCache=this.art.option.url,this.current&&(this.playing=!0,this.play(this.current));}},{key:"play",value:function value(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.isEnd||(this.art.switchUrl(e.url),this.art.once("video:timeupdate",function(){t.art.emit("ads:start",e);}),this.art.once("video:ended",function(){var e=t.next;e?(t.index+=1,t.play(e)):t.end();}));}},{key:"end",value:function value(){this.isEnd||(this.isEnd=!0,this.playing=!1,this.art.option.url=this.urlCache,this.art.switchUrl(this.urlCache),this.art.emit("ads:end"));}}]),e;}(),He=r(function e(r){t(this,e);for(var n=r.option,o=r.events.proxy,i=r.template.$video,a=0;a<dt.events.length;a++){o(i,dt.events[a],function(t){r.emit("video:".concat(t.type),t);});}Object.keys(n.moreVideoAttr).forEach(function(t){i[t]=n.moreVideoAttr[t];}),n.muted&&(i.muted=n.muted),n.volume&&(i.volume=G(n.volume,0,1)),n.poster&&(i.poster=n.poster),n.autoplay&&(i.autoplay=n.autoplay);var c=n.type||V(n.url),l=n.customType[c];c&&l?(l(i,n.url,r),r.emit("customType",c)):(i.src=n.url,r.emit("url",i.src));});function We(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0;}catch(t){return!1;}}();return function(){var r,n=l(t);if(e){var o=l(this).constructor;r=Reflect.construct(n,arguments,o);}else r=n.apply(this,arguments);return c(this,r);};}var Ne=0,_e=[],Ue=function(e){i(a,e);var o=We(a);function a(e){var r;t(this,a),(r=o.call(this)).id=++Ne;var i=Q(a.option,e);return r.option=u(i,ft),r.isReady=!1,r.isFocus=!1,r.isDestroy=!1,r.whitelist=new ht(n(r)),r.template=new vt(n(r)),r.events=new je(n(r)),r.whitelist.state?(r.storage=new Ie(n(r)),r.icons=new Ae(n(r)),r.i18n=new gt(n(r)),r.notice=new Ce(n(r)),r.player=new kt(n(r)),r.layers=new Re(n(r)),r.controls=new ne(n(r)),r.contextmenu=new me(n(r)),r.subtitle=new ke(n(r)),r.ads=new Ve(n(r)),r.info=new be(n(r)),r.loading=new $e(n(r)),r.hotkey=new Pe(n(r)),r.mask=new Te(n(r)),r.setting=new Fe(n(r)),r.plugins=new qe(n(r))):r.mobile=new He(n(r)),_e.push(n(r)),r;}return r(a,[{key:"proxy",get:function get(){return this.events.proxy;}},{key:"query",get:function get(){return this.template.query;}},{key:"destroy",value:function value(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.events.destroy(),this.template.destroy(t),_e.splice(_e.indexOf(this),1),this.isDestroy=!0,this.emit("destroy");}}],[{key:"instances",get:function get(){return _e;}},{key:"version",get:function get(){return"4.3.1";}},{key:"env",get:function get(){return"production";}},{key:"build",get:function get(){return"1644803300119";}},{key:"config",get:function get(){return dt;}},{key:"utils",get:function get(){return et;}},{key:"scheme",get:function get(){return ft;}},{key:"Emitter",get:function get(){return p;}},{key:"validator",get:function get(){return u;}},{key:"kindOf",get:function get(){return u.kindOf;}},{key:"html",get:function get(){return vt.html;}},{key:"option",get:function get(){return{container:"#artplayer",url:"",poster:"",title:"",type:"",theme:"#f00",volume:.7,isLive:!1,muted:!1,autoplay:!1,autoSize:!1,autoMini:!1,loop:!1,flip:!1,playbackRate:!1,aspectRatio:!1,screenshot:!1,setting:!1,hotkey:!0,pip:!1,mutex:!0,backdrop:!0,fullscreen:!1,fullscreenWeb:!1,subtitleOffset:!1,miniProgressBar:!1,useSSR:!1,ads:[],layers:[],contextmenu:[],controls:[],settings:[],quality:[],highlight:[],plugins:[],whitelist:[],thumbnails:{url:"",number:60,column:10},subtitle:{url:"",type:"",style:{},encoding:"utf-8",bilingual:!1},moreVideoAttr:{controls:!1,preload:h?"auto":"metadata"},icons:{},customType:{},lang:navigator.language.toLowerCase()};}}]),a;}(p);return console.log("%c ArtPlayer %c 4.3.1 %c https://artplayer.org","color: #fff; background: #5f5f5f","color: #fff; background: #4bc729",""),Ue;});})(artplayer);var Artplayer=artplayer.exports;var flv={exports:{}};(function(module,exports){(function webpackUniversalModuleDefinition(root,factory){module.exports=factory();})(self,function(){return(/******/function(){// webpackBootstrap
/******/var __webpack_modules__={/***/"./node_modules/es6-promise/dist/es6-promise.js":/*!******************************************************!*\
			  !*** ./node_modules/es6-promise/dist/es6-promise.js ***!
			  \******************************************************/ /***/function node_modulesEs6PromiseDistEs6PromiseJs(module,__unused_webpack_exports,__webpack_require__){/*!
			 * @overview es6-promise - a tiny implementation of Promises/A+.
			 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
			 * @license   Licensed under MIT license
			 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
			 * @version   v4.2.8+1e68dce6
			 */(function(global,factory){module.exports=factory();})(this,function(){function objectOrFunction(x){var type=_typeof3(x);return x!==null&&(type==='object'||type==='function');}function isFunction(x){return typeof x==='function';}var _isArray=void 0;if(Array.isArray){_isArray=Array.isArray;}else{_isArray=function _isArray(x){return Object.prototype.toString.call(x)==='[object Array]';};}var isArray=_isArray;var len=0;var vertxNext=void 0;var customSchedulerFn=void 0;var asap=function asap(callback,arg){queue[len]=callback;queue[len+1]=arg;len+=2;if(len===2){// If len is 2, that means that we need to schedule an async flush.
// If additional callbacks are queued before the queue is flushed, they
// will be processed by this flush that we are scheduling.
if(customSchedulerFn){customSchedulerFn(flush);}else{scheduleFlush();}}};function setScheduler(scheduleFn){customSchedulerFn=scheduleFn;}function setAsap(asapFn){asap=asapFn;}var browserWindow=typeof window!=='undefined'?window:undefined;var browserGlobal=browserWindow||{};var BrowserMutationObserver=browserGlobal.MutationObserver||browserGlobal.WebKitMutationObserver;var isNode=typeof self==='undefined'&&typeof process!=='undefined'&&{}.toString.call(process)==='[object process]';// test for web worker but not in IE10
var isWorker=typeof Uint8ClampedArray!=='undefined'&&typeof importScripts!=='undefined'&&typeof MessageChannel!=='undefined';// node
function useNextTick(){// node version 0.10.x displays a deprecation warning when nextTick is used recursively
// see https://github.com/cujojs/when/issues/410 for details
return function(){return process.nextTick(flush);};}// vertx
function useVertxTimer(){if(typeof vertxNext!=='undefined'){return function(){vertxNext(flush);};}return useSetTimeout();}function useMutationObserver(){var iterations=0;var observer=new BrowserMutationObserver(flush);var node=document.createTextNode('');observer.observe(node,{characterData:true});return function(){node.data=iterations=++iterations%2;};}// web worker
function useMessageChannel(){var channel=new MessageChannel();channel.port1.onmessage=flush;return function(){return channel.port2.postMessage(0);};}function useSetTimeout(){// Store setTimeout reference so es6-promise will be unaffected by
// other code modifying setTimeout (like sinon.useFakeTimers())
var globalSetTimeout=setTimeout;return function(){return globalSetTimeout(flush,1);};}var queue=new Array(1000);function flush(){for(var i=0;i<len;i+=2){var callback=queue[i];var arg=queue[i+1];callback(arg);queue[i]=undefined;queue[i+1]=undefined;}len=0;}function attemptVertx(){try{var vertx=Function('return this')().require('vertx');vertxNext=vertx.runOnLoop||vertx.runOnContext;return useVertxTimer();}catch(e){return useSetTimeout();}}var scheduleFlush=void 0;// Decide what async method to use to triggering processing of queued callbacks:
if(isNode){scheduleFlush=useNextTick();}else if(BrowserMutationObserver){scheduleFlush=useMutationObserver();}else if(isWorker){scheduleFlush=useMessageChannel();}else if(browserWindow===undefined&&"function"==='function'){scheduleFlush=attemptVertx();}else{scheduleFlush=useSetTimeout();}function then(onFulfillment,onRejection){var parent=this;var child=new this.constructor(noop);if(child[PROMISE_ID]===undefined){makePromise(child);}var _state=parent._state;if(_state){var callback=arguments[_state-1];asap(function(){return invokeCallback(_state,child,callback,parent._result);});}else{subscribe(parent,child,onFulfillment,onRejection);}return child;}/**
			      `Promise.resolve` returns a promise that will become resolved with the
			      passed `value`. It is shorthand for the following:
			    
			      ```javascript
			      let promise = new Promise(function(resolve, reject){
			        resolve(1);
			      });
			    
			      promise.then(function(value){
			        // value === 1
			      });
			      ```
			    
			      Instead of writing the above, your code now simply becomes the following:
			    
			      ```javascript
			      let promise = Promise.resolve(1);
			    
			      promise.then(function(value){
			        // value === 1
			      });
			      ```
			    
			      @method resolve
			      @static
			      @param {Any} value value that the returned promise will be resolved with
			      Useful for tooling.
			      @return {Promise} a promise that will become fulfilled with the given
			      `value`
			    */function resolve$1(object){/*jshint validthis:true */var Constructor=this;if(object&&_typeof3(object)==='object'&&object.constructor===Constructor){return object;}var promise=new Constructor(noop);resolve(promise,object);return promise;}var PROMISE_ID=Math.random().toString(36).substring(2);function noop(){}var PENDING=void 0;var FULFILLED=1;var REJECTED=2;function selfFulfillment(){return new TypeError("You cannot resolve a promise with itself");}function cannotReturnOwn(){return new TypeError('A promises callback cannot return that same promise.');}function tryThen(then$$1,value,fulfillmentHandler,rejectionHandler){try{then$$1.call(value,fulfillmentHandler,rejectionHandler);}catch(e){return e;}}function handleForeignThenable(promise,thenable,then$$1){asap(function(promise){var sealed=false;var error=tryThen(then$$1,thenable,function(value){if(sealed){return;}sealed=true;if(thenable!==value){resolve(promise,value);}else{fulfill(promise,value);}},function(reason){if(sealed){return;}sealed=true;reject(promise,reason);},'Settle: '+(promise._label||' unknown promise'));if(!sealed&&error){sealed=true;reject(promise,error);}},promise);}function handleOwnThenable(promise,thenable){if(thenable._state===FULFILLED){fulfill(promise,thenable._result);}else if(thenable._state===REJECTED){reject(promise,thenable._result);}else{subscribe(thenable,undefined,function(value){return resolve(promise,value);},function(reason){return reject(promise,reason);});}}function handleMaybeThenable(promise,maybeThenable,then$$1){if(maybeThenable.constructor===promise.constructor&&then$$1===then&&maybeThenable.constructor.resolve===resolve$1){handleOwnThenable(promise,maybeThenable);}else{if(then$$1===undefined){fulfill(promise,maybeThenable);}else if(isFunction(then$$1)){handleForeignThenable(promise,maybeThenable,then$$1);}else{fulfill(promise,maybeThenable);}}}function resolve(promise,value){if(promise===value){reject(promise,selfFulfillment());}else if(objectOrFunction(value)){var then$$1=void 0;try{then$$1=value.then;}catch(error){reject(promise,error);return;}handleMaybeThenable(promise,value,then$$1);}else{fulfill(promise,value);}}function publishRejection(promise){if(promise._onerror){promise._onerror(promise._result);}publish(promise);}function fulfill(promise,value){if(promise._state!==PENDING){return;}promise._result=value;promise._state=FULFILLED;if(promise._subscribers.length!==0){asap(publish,promise);}}function reject(promise,reason){if(promise._state!==PENDING){return;}promise._state=REJECTED;promise._result=reason;asap(publishRejection,promise);}function subscribe(parent,child,onFulfillment,onRejection){var _subscribers=parent._subscribers;var length=_subscribers.length;parent._onerror=null;_subscribers[length]=child;_subscribers[length+FULFILLED]=onFulfillment;_subscribers[length+REJECTED]=onRejection;if(length===0&&parent._state){asap(publish,parent);}}function publish(promise){var subscribers=promise._subscribers;var settled=promise._state;if(subscribers.length===0){return;}var child=void 0,callback=void 0,detail=promise._result;for(var i=0;i<subscribers.length;i+=3){child=subscribers[i];callback=subscribers[i+settled];if(child){invokeCallback(settled,child,callback,detail);}else{callback(detail);}}promise._subscribers.length=0;}function invokeCallback(settled,promise,callback,detail){var hasCallback=isFunction(callback),value=void 0,error=void 0,succeeded=true;if(hasCallback){try{value=callback(detail);}catch(e){succeeded=false;error=e;}if(promise===value){reject(promise,cannotReturnOwn());return;}}else{value=detail;}if(promise._state!==PENDING);else if(hasCallback&&succeeded){resolve(promise,value);}else if(succeeded===false){reject(promise,error);}else if(settled===FULFILLED){fulfill(promise,value);}else if(settled===REJECTED){reject(promise,value);}}function initializePromise(promise,resolver){try{resolver(function resolvePromise(value){resolve(promise,value);},function rejectPromise(reason){reject(promise,reason);});}catch(e){reject(promise,e);}}var id=0;function nextId(){return id++;}function makePromise(promise){promise[PROMISE_ID]=id++;promise._state=undefined;promise._result=undefined;promise._subscribers=[];}function validationError(){return new Error('Array Methods must be provided an Array');}var Enumerator=function(){function Enumerator(Constructor,input){this._instanceConstructor=Constructor;this.promise=new Constructor(noop);if(!this.promise[PROMISE_ID]){makePromise(this.promise);}if(isArray(input)){this.length=input.length;this._remaining=input.length;this._result=new Array(this.length);if(this.length===0){fulfill(this.promise,this._result);}else{this.length=this.length||0;this._enumerate(input);if(this._remaining===0){fulfill(this.promise,this._result);}}}else{reject(this.promise,validationError());}}Enumerator.prototype._enumerate=function _enumerate(input){for(var i=0;this._state===PENDING&&i<input.length;i++){this._eachEntry(input[i],i);}};Enumerator.prototype._eachEntry=function _eachEntry(entry,i){var c=this._instanceConstructor;var resolve$$1=c.resolve;if(resolve$$1===resolve$1){var _then=void 0;var error=void 0;var didError=false;try{_then=entry.then;}catch(e){didError=true;error=e;}if(_then===then&&entry._state!==PENDING){this._settledAt(entry._state,i,entry._result);}else if(typeof _then!=='function'){this._remaining--;this._result[i]=entry;}else if(c===Promise$1){var promise=new c(noop);if(didError){reject(promise,error);}else{handleMaybeThenable(promise,entry,_then);}this._willSettleAt(promise,i);}else{this._willSettleAt(new c(function(resolve$$1){return resolve$$1(entry);}),i);}}else{this._willSettleAt(resolve$$1(entry),i);}};Enumerator.prototype._settledAt=function _settledAt(state,i,value){var promise=this.promise;if(promise._state===PENDING){this._remaining--;if(state===REJECTED){reject(promise,value);}else{this._result[i]=value;}}if(this._remaining===0){fulfill(promise,this._result);}};Enumerator.prototype._willSettleAt=function _willSettleAt(promise,i){var enumerator=this;subscribe(promise,undefined,function(value){return enumerator._settledAt(FULFILLED,i,value);},function(reason){return enumerator._settledAt(REJECTED,i,reason);});};return Enumerator;}();/**
			      `Promise.all` accepts an array of promises, and returns a new promise which
			      is fulfilled with an array of fulfillment values for the passed promises, or
			      rejected with the reason of the first passed promise to be rejected. It casts all
			      elements of the passed iterable to promises as it runs this algorithm.
			    
			      Example:
			    
			      ```javascript
			      let promise1 = resolve(1);
			      let promise2 = resolve(2);
			      let promise3 = resolve(3);
			      let promises = [ promise1, promise2, promise3 ];
			    
			      Promise.all(promises).then(function(array){
			        // The array here would be [ 1, 2, 3 ];
			      });
			      ```
			    
			      If any of the `promises` given to `all` are rejected, the first promise
			      that is rejected will be given as an argument to the returned promises's
			      rejection handler. For example:
			    
			      Example:
			    
			      ```javascript
			      let promise1 = resolve(1);
			      let promise2 = reject(new Error("2"));
			      let promise3 = reject(new Error("3"));
			      let promises = [ promise1, promise2, promise3 ];
			    
			      Promise.all(promises).then(function(array){
			        // Code here never runs because there are rejected promises!
			      }, function(error) {
			        // error.message === "2"
			      });
			      ```
			    
			      @method all
			      @static
			      @param {Array} entries array of promises
			      @param {String} label optional string for labeling the promise.
			      Useful for tooling.
			      @return {Promise} promise that is fulfilled when all `promises` have been
			      fulfilled, or rejected if any of them become rejected.
			      @static
			    */function all(entries){return new Enumerator(this,entries).promise;}/**
			      `Promise.race` returns a new promise which is settled in the same way as the
			      first passed promise to settle.
			    
			      Example:
			    
			      ```javascript
			      let promise1 = new Promise(function(resolve, reject){
			        setTimeout(function(){
			          resolve('promise 1');
			        }, 200);
			      });
			    
			      let promise2 = new Promise(function(resolve, reject){
			        setTimeout(function(){
			          resolve('promise 2');
			        }, 100);
			      });
			    
			      Promise.race([promise1, promise2]).then(function(result){
			        // result === 'promise 2' because it was resolved before promise1
			        // was resolved.
			      });
			      ```
			    
			      `Promise.race` is deterministic in that only the state of the first
			      settled promise matters. For example, even if other promises given to the
			      `promises` array argument are resolved, but the first settled promise has
			      become rejected before the other promises became fulfilled, the returned
			      promise will become rejected:
			    
			      ```javascript
			      let promise1 = new Promise(function(resolve, reject){
			        setTimeout(function(){
			          resolve('promise 1');
			        }, 200);
			      });
			    
			      let promise2 = new Promise(function(resolve, reject){
			        setTimeout(function(){
			          reject(new Error('promise 2'));
			        }, 100);
			      });
			    
			      Promise.race([promise1, promise2]).then(function(result){
			        // Code here never runs
			      }, function(reason){
			        // reason.message === 'promise 2' because promise 2 became rejected before
			        // promise 1 became fulfilled
			      });
			      ```
			    
			      An example real-world use case is implementing timeouts:
			    
			      ```javascript
			      Promise.race([ajax('foo.json'), timeout(5000)])
			      ```
			    
			      @method race
			      @static
			      @param {Array} promises array of promises to observe
			      Useful for tooling.
			      @return {Promise} a promise which settles in the same way as the first passed
			      promise to settle.
			    */function race(entries){/*jshint validthis:true */var Constructor=this;if(!isArray(entries)){return new Constructor(function(_,reject){return reject(new TypeError('You must pass an array to race.'));});}else{return new Constructor(function(resolve,reject){var length=entries.length;for(var i=0;i<length;i++){Constructor.resolve(entries[i]).then(resolve,reject);}});}}/**
			      `Promise.reject` returns a promise rejected with the passed `reason`.
			      It is shorthand for the following:
			    
			      ```javascript
			      let promise = new Promise(function(resolve, reject){
			        reject(new Error('WHOOPS'));
			      });
			    
			      promise.then(function(value){
			        // Code here doesn't run because the promise is rejected!
			      }, function(reason){
			        // reason.message === 'WHOOPS'
			      });
			      ```
			    
			      Instead of writing the above, your code now simply becomes the following:
			    
			      ```javascript
			      let promise = Promise.reject(new Error('WHOOPS'));
			    
			      promise.then(function(value){
			        // Code here doesn't run because the promise is rejected!
			      }, function(reason){
			        // reason.message === 'WHOOPS'
			      });
			      ```
			    
			      @method reject
			      @static
			      @param {Any} reason value that the returned promise will be rejected with.
			      Useful for tooling.
			      @return {Promise} a promise rejected with the given `reason`.
			    */function reject$1(reason){/*jshint validthis:true */var Constructor=this;var promise=new Constructor(noop);reject(promise,reason);return promise;}function needsResolver(){throw new TypeError('You must pass a resolver function as the first argument to the promise constructor');}function needsNew(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");}/**
			      Promise objects represent the eventual result of an asynchronous operation. The
			      primary way of interacting with a promise is through its `then` method, which
			      registers callbacks to receive either a promise's eventual value or the reason
			      why the promise cannot be fulfilled.
			    
			      Terminology
			      -----------
			    
			      - `promise` is an object or function with a `then` method whose behavior conforms to this specification.
			      - `thenable` is an object or function that defines a `then` method.
			      - `value` is any legal JavaScript value (including undefined, a thenable, or a promise).
			      - `exception` is a value that is thrown using the throw statement.
			      - `reason` is a value that indicates why a promise was rejected.
			      - `settled` the final resting state of a promise, fulfilled or rejected.
			    
			      A promise can be in one of three states: pending, fulfilled, or rejected.
			    
			      Promises that are fulfilled have a fulfillment value and are in the fulfilled
			      state.  Promises that are rejected have a rejection reason and are in the
			      rejected state.  A fulfillment value is never a thenable.
			    
			      Promises can also be said to *resolve* a value.  If this value is also a
			      promise, then the original promise's settled state will match the value's
			      settled state.  So a promise that *resolves* a promise that rejects will
			      itself reject, and a promise that *resolves* a promise that fulfills will
			      itself fulfill.
			    
			    
			      Basic Usage:
			      ------------
			    
			      ```js
			      let promise = new Promise(function(resolve, reject) {
			        // on success
			        resolve(value);
			    
			        // on failure
			        reject(reason);
			      });
			    
			      promise.then(function(value) {
			        // on fulfillment
			      }, function(reason) {
			        // on rejection
			      });
			      ```
			    
			      Advanced Usage:
			      ---------------
			    
			      Promises shine when abstracting away asynchronous interactions such as
			      `XMLHttpRequest`s.
			    
			      ```js
			      function getJSON(url) {
			        return new Promise(function(resolve, reject){
			          let xhr = new XMLHttpRequest();
			    
			          xhr.open('GET', url);
			          xhr.onreadystatechange = handler;
			          xhr.responseType = 'json';
			          xhr.setRequestHeader('Accept', 'application/json');
			          xhr.send();
			    
			          function handler() {
			            if (this.readyState === this.DONE) {
			              if (this.status === 200) {
			                resolve(this.response);
			              } else {
			                reject(new Error('getJSON: `' + url + '` failed with status: [' + this.status + ']'));
			              }
			            }
			          };
			        });
			      }
			    
			      getJSON('/posts.json').then(function(json) {
			        // on fulfillment
			      }, function(reason) {
			        // on rejection
			      });
			      ```
			    
			      Unlike callbacks, promises are great composable primitives.
			    
			      ```js
			      Promise.all([
			        getJSON('/posts'),
			        getJSON('/comments')
			      ]).then(function(values){
			        values[0] // => postsJSON
			        values[1] // => commentsJSON
			    
			        return values;
			      });
			      ```
			    
			      @class Promise
			      @param {Function} resolver
			      Useful for tooling.
			      @constructor
			    */var Promise$1=function(){function Promise(resolver){this[PROMISE_ID]=nextId();this._result=this._state=undefined;this._subscribers=[];if(noop!==resolver){typeof resolver!=='function'&&needsResolver();this instanceof Promise?initializePromise(this,resolver):needsNew();}}/**
			        The primary way of interacting with a promise is through its `then` method,
			        which registers callbacks to receive either a promise's eventual value or the
			        reason why the promise cannot be fulfilled.
			         ```js
			        findUser().then(function(user){
			          // user is available
			        }, function(reason){
			          // user is unavailable, and you are given the reason why
			        });
			        ```
			         Chaining
			        --------
			         The return value of `then` is itself a promise.  This second, 'downstream'
			        promise is resolved with the return value of the first promise's fulfillment
			        or rejection handler, or rejected if the handler throws an exception.
			         ```js
			        findUser().then(function (user) {
			          return user.name;
			        }, function (reason) {
			          return 'default name';
			        }).then(function (userName) {
			          // If `findUser` fulfilled, `userName` will be the user's name, otherwise it
			          // will be `'default name'`
			        });
			         findUser().then(function (user) {
			          throw new Error('Found user, but still unhappy');
			        }, function (reason) {
			          throw new Error('`findUser` rejected and we're unhappy');
			        }).then(function (value) {
			          // never reached
			        }, function (reason) {
			          // if `findUser` fulfilled, `reason` will be 'Found user, but still unhappy'.
			          // If `findUser` rejected, `reason` will be '`findUser` rejected and we're unhappy'.
			        });
			        ```
			        If the downstream promise does not specify a rejection handler, rejection reasons will be propagated further downstream.
			         ```js
			        findUser().then(function (user) {
			          throw new PedagogicalException('Upstream error');
			        }).then(function (value) {
			          // never reached
			        }).then(function (value) {
			          // never reached
			        }, function (reason) {
			          // The `PedgagocialException` is propagated all the way down to here
			        });
			        ```
			         Assimilation
			        ------------
			         Sometimes the value you want to propagate to a downstream promise can only be
			        retrieved asynchronously. This can be achieved by returning a promise in the
			        fulfillment or rejection handler. The downstream promise will then be pending
			        until the returned promise is settled. This is called *assimilation*.
			         ```js
			        findUser().then(function (user) {
			          return findCommentsByAuthor(user);
			        }).then(function (comments) {
			          // The user's comments are now available
			        });
			        ```
			         If the assimliated promise rejects, then the downstream promise will also reject.
			         ```js
			        findUser().then(function (user) {
			          return findCommentsByAuthor(user);
			        }).then(function (comments) {
			          // If `findCommentsByAuthor` fulfills, we'll have the value here
			        }, function (reason) {
			          // If `findCommentsByAuthor` rejects, we'll have the reason here
			        });
			        ```
			         Simple Example
			        --------------
			         Synchronous Example
			         ```javascript
			        let result;
			         try {
			          result = findResult();
			          // success
			        } catch(reason) {
			          // failure
			        }
			        ```
			         Errback Example
			         ```js
			        findResult(function(result, err){
			          if (err) {
			            // failure
			          } else {
			            // success
			          }
			        });
			        ```
			         Promise Example;
			         ```javascript
			        findResult().then(function(result){
			          // success
			        }, function(reason){
			          // failure
			        });
			        ```
			         Advanced Example
			        --------------
			         Synchronous Example
			         ```javascript
			        let author, books;
			         try {
			          author = findAuthor();
			          books  = findBooksByAuthor(author);
			          // success
			        } catch(reason) {
			          // failure
			        }
			        ```
			         Errback Example
			         ```js
			         function foundBooks(books) {
			         }
			         function failure(reason) {
			         }
			         findAuthor(function(author, err){
			          if (err) {
			            failure(err);
			            // failure
			          } else {
			            try {
			              findBoooksByAuthor(author, function(books, err) {
			                if (err) {
			                  failure(err);
			                } else {
			                  try {
			                    foundBooks(books);
			                  } catch(reason) {
			                    failure(reason);
			                  }
			                }
			              });
			            } catch(error) {
			              failure(err);
			            }
			            // success
			          }
			        });
			        ```
			         Promise Example;
			         ```javascript
			        findAuthor().
			          then(findBooksByAuthor).
			          then(function(books){
			            // found books
			        }).catch(function(reason){
			          // something went wrong
			        });
			        ```
			         @method then
			        @param {Function} onFulfilled
			        @param {Function} onRejected
			        Useful for tooling.
			        @return {Promise}
			        */ /**
			        `catch` is simply sugar for `then(undefined, onRejection)` which makes it the same
			        as the catch block of a try/catch statement.
			        ```js
			        function findAuthor(){
			        throw new Error('couldn't find that author');
			        }
			        // synchronous
			        try {
			        findAuthor();
			        } catch(reason) {
			        // something went wrong
			        }
			        // async with promises
			        findAuthor().catch(function(reason){
			        // something went wrong
			        });
			        ```
			        @method catch
			        @param {Function} onRejection
			        Useful for tooling.
			        @return {Promise}
			        */Promise.prototype.catch=function _catch(onRejection){return this.then(null,onRejection);};/**
			          `finally` will be invoked regardless of the promise's fate just as native
			          try/catch/finally behaves
			        
			          Synchronous example:
			        
			          ```js
			          findAuthor() {
			            if (Math.random() > 0.5) {
			              throw new Error();
			            }
			            return new Author();
			          }
			        
			          try {
			            return findAuthor(); // succeed or fail
			          } catch(error) {
			            return findOtherAuther();
			          } finally {
			            // always runs
			            // doesn't affect the return value
			          }
			          ```
			        
			          Asynchronous example:
			        
			          ```js
			          findAuthor().catch(function(reason){
			            return findOtherAuther();
			          }).finally(function(){
			            // author was either found, or not
			          });
			          ```
			        
			          @method finally
			          @param {Function} callback
			          @return {Promise}
			        */Promise.prototype.finally=function _finally(callback){var promise=this;var constructor=promise.constructor;if(isFunction(callback)){return promise.then(function(value){return constructor.resolve(callback()).then(function(){return value;});},function(reason){return constructor.resolve(callback()).then(function(){throw reason;});});}return promise.then(callback,callback);};return Promise;}();Promise$1.prototype.then=then;Promise$1.all=all;Promise$1.race=race;Promise$1.resolve=resolve$1;Promise$1.reject=reject$1;Promise$1._setScheduler=setScheduler;Promise$1._setAsap=setAsap;Promise$1._asap=asap;/*global self*/function polyfill(){var local=void 0;if(typeof __webpack_require__.g!=='undefined'){local=__webpack_require__.g;}else if(typeof self!=='undefined'){local=self;}else{try{local=Function('return this')();}catch(e){throw new Error('polyfill failed because global object is unavailable in this environment');}}var P=local.Promise;if(P){var promiseToString=null;try{promiseToString=Object.prototype.toString.call(P.resolve());}catch(e){// silently ignored
}if(promiseToString==='[object Promise]'&&!P.cast){return;}}local.Promise=Promise$1;}// Strange compat..
Promise$1.polyfill=polyfill;Promise$1.Promise=Promise$1;return Promise$1;});/***/},/***/"./node_modules/events/events.js":/*!***************************************!*\
			  !*** ./node_modules/events/events.js ***!
			  \***************************************/ /***/function node_modulesEventsEventsJs(module){// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
var R=(typeof Reflect==="undefined"?"undefined":_typeof3(Reflect))==='object'?Reflect:null;var ReflectApply=R&&typeof R.apply==='function'?R.apply:function ReflectApply(target,receiver,args){return Function.prototype.apply.call(target,receiver,args);};var ReflectOwnKeys;if(R&&typeof R.ownKeys==='function'){ReflectOwnKeys=R.ownKeys;}else if(Object.getOwnPropertySymbols){ReflectOwnKeys=function ReflectOwnKeys(target){return Object.getOwnPropertyNames(target).concat(Object.getOwnPropertySymbols(target));};}else{ReflectOwnKeys=function ReflectOwnKeys(target){return Object.getOwnPropertyNames(target);};}function ProcessEmitWarning(warning){if(console&&console.warn)console.warn(warning);}var NumberIsNaN=Number.isNaN||function NumberIsNaN(value){return value!==value;};function EventEmitter(){EventEmitter.init.call(this);}module.exports=EventEmitter;module.exports.once=once;// Backwards-compat with node 0.10.x
EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._eventsCount=0;EventEmitter.prototype._maxListeners=undefined;// By default EventEmitters will print a warning if more than 10 listeners are
// added to it. This is a useful default which helps finding memory leaks.
var defaultMaxListeners=10;function checkListener(listener){if(typeof listener!=='function'){throw new TypeError('The "listener" argument must be of type Function. Received type '+_typeof3(listener));}}Object.defineProperty(EventEmitter,'defaultMaxListeners',{enumerable:true,get:function get(){return defaultMaxListeners;},set:function set(arg){if(typeof arg!=='number'||arg<0||NumberIsNaN(arg)){throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+arg+'.');}defaultMaxListeners=arg;}});EventEmitter.init=function(){if(this._events===undefined||this._events===Object.getPrototypeOf(this)._events){this._events=Object.create(null);this._eventsCount=0;}this._maxListeners=this._maxListeners||undefined;};// Obviously not all Emitters should be limited to 10. This function allows
// that to be increased. Set to zero for unlimited.
EventEmitter.prototype.setMaxListeners=function setMaxListeners(n){if(typeof n!=='number'||n<0||NumberIsNaN(n)){throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+n+'.');}this._maxListeners=n;return this;};function _getMaxListeners(that){if(that._maxListeners===undefined)return EventEmitter.defaultMaxListeners;return that._maxListeners;}EventEmitter.prototype.getMaxListeners=function getMaxListeners(){return _getMaxListeners(this);};EventEmitter.prototype.emit=function emit(type){var args=[];for(var i=1;i<arguments.length;i++){args.push(arguments[i]);}var doError=type==='error';var events=this._events;if(events!==undefined)doError=doError&&events.error===undefined;else if(!doError)return false;// If there is no 'error' event listener then throw.
if(doError){var er;if(args.length>0)er=args[0];if(er instanceof Error){// Note: The comments on the `throw` lines are intentional, they show
// up in Node's output if this results in an unhandled exception.
throw er;// Unhandled 'error' event
}// At least give some kind of context to the user
var err=new Error('Unhandled error.'+(er?' ('+er.message+')':''));err.context=er;throw err;// Unhandled 'error' event
}var handler=events[type];if(handler===undefined)return false;if(typeof handler==='function'){ReflectApply(handler,this,args);}else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i){ReflectApply(listeners[i],this,args);}}return true;};function _addListener(target,type,listener,prepend){var m;var events;var existing;checkListener(listener);events=target._events;if(events===undefined){events=target._events=Object.create(null);target._eventsCount=0;}else{// To avoid recursion in the case that type === "newListener"! Before
// adding it to the listeners, first emit "newListener".
if(events.newListener!==undefined){target.emit('newListener',type,listener.listener?listener.listener:listener);// Re-assign `events` because a newListener handler could have caused the
// this._events to be assigned to a new object
events=target._events;}existing=events[type];}if(existing===undefined){// Optimize the case of one listener. Don't need the extra array object.
existing=events[type]=listener;++target._eventsCount;}else{if(typeof existing==='function'){// Adding the second element, need to change to array.
existing=events[type]=prepend?[listener,existing]:[existing,listener];// If we've already got an array, just append.
}else if(prepend){existing.unshift(listener);}else{existing.push(listener);}// Check for listener leak
m=_getMaxListeners(target);if(m>0&&existing.length>m&&!existing.warned){existing.warned=true;// No error code for this since it is a Warning
// eslint-disable-next-line no-restricted-syntax
var w=new Error('Possible EventEmitter memory leak detected. '+existing.length+' '+String(type)+' listeners '+'added. Use emitter.setMaxListeners() to '+'increase limit');w.name='MaxListenersExceededWarning';w.emitter=target;w.type=type;w.count=existing.length;ProcessEmitWarning(w);}}return target;}EventEmitter.prototype.addListener=function addListener(type,listener){return _addListener(this,type,listener,false);};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.prependListener=function prependListener(type,listener){return _addListener(this,type,listener,true);};function onceWrapper(){if(!this.fired){this.target.removeListener(this.type,this.wrapFn);this.fired=true;if(arguments.length===0)return this.listener.call(this.target);return this.listener.apply(this.target,arguments);}}function _onceWrap(target,type,listener){var state={fired:false,wrapFn:undefined,target:target,type:type,listener:listener};var wrapped=onceWrapper.bind(state);wrapped.listener=listener;state.wrapFn=wrapped;return wrapped;}EventEmitter.prototype.once=function once(type,listener){checkListener(listener);this.on(type,_onceWrap(this,type,listener));return this;};EventEmitter.prototype.prependOnceListener=function prependOnceListener(type,listener){checkListener(listener);this.prependListener(type,_onceWrap(this,type,listener));return this;};// Emits a 'removeListener' event if and only if the listener was removed.
EventEmitter.prototype.removeListener=function removeListener(type,listener){var list,events,position,i,originalListener;checkListener(listener);events=this._events;if(events===undefined)return this;list=events[type];if(list===undefined)return this;if(list===listener||list.listener===listener){if(--this._eventsCount===0)this._events=Object.create(null);else{delete events[type];if(events.removeListener)this.emit('removeListener',type,list.listener||listener);}}else if(typeof list!=='function'){position=-1;for(i=list.length-1;i>=0;i--){if(list[i]===listener||list[i].listener===listener){originalListener=list[i].listener;position=i;break;}}if(position<0)return this;if(position===0)list.shift();else{spliceOne(list,position);}if(list.length===1)events[type]=list[0];if(events.removeListener!==undefined)this.emit('removeListener',type,originalListener||listener);}return this;};EventEmitter.prototype.off=EventEmitter.prototype.removeListener;EventEmitter.prototype.removeAllListeners=function removeAllListeners(type){var listeners,events,i;events=this._events;if(events===undefined)return this;// not listening for removeListener, no need to emit
if(events.removeListener===undefined){if(arguments.length===0){this._events=Object.create(null);this._eventsCount=0;}else if(events[type]!==undefined){if(--this._eventsCount===0)this._events=Object.create(null);else delete events[type];}return this;}// emit removeListener for all listeners on all events
if(arguments.length===0){var keys=Object.keys(events);var key;for(i=0;i<keys.length;++i){key=keys[i];if(key==='removeListener')continue;this.removeAllListeners(key);}this.removeAllListeners('removeListener');this._events=Object.create(null);this._eventsCount=0;return this;}listeners=events[type];if(typeof listeners==='function'){this.removeListener(type,listeners);}else if(listeners!==undefined){// LIFO order
for(i=listeners.length-1;i>=0;i--){this.removeListener(type,listeners[i]);}}return this;};function _listeners(target,type,unwrap){var events=target._events;if(events===undefined)return[];var evlistener=events[type];if(evlistener===undefined)return[];if(typeof evlistener==='function')return unwrap?[evlistener.listener||evlistener]:[evlistener];return unwrap?unwrapListeners(evlistener):arrayClone(evlistener,evlistener.length);}EventEmitter.prototype.listeners=function listeners(type){return _listeners(this,type,true);};EventEmitter.prototype.rawListeners=function rawListeners(type){return _listeners(this,type,false);};EventEmitter.listenerCount=function(emitter,type){if(typeof emitter.listenerCount==='function'){return emitter.listenerCount(type);}else{return listenerCount.call(emitter,type);}};EventEmitter.prototype.listenerCount=listenerCount;function listenerCount(type){var events=this._events;if(events!==undefined){var evlistener=events[type];if(typeof evlistener==='function'){return 1;}else if(evlistener!==undefined){return evlistener.length;}}return 0;}EventEmitter.prototype.eventNames=function eventNames(){return this._eventsCount>0?ReflectOwnKeys(this._events):[];};function arrayClone(arr,n){var copy=new Array(n);for(var i=0;i<n;++i){copy[i]=arr[i];}return copy;}function spliceOne(list,index){for(;index+1<list.length;index++){list[index]=list[index+1];}list.pop();}function unwrapListeners(arr){var ret=new Array(arr.length);for(var i=0;i<ret.length;++i){ret[i]=arr[i].listener||arr[i];}return ret;}function once(emitter,name){return new Promise(function(resolve,reject){function errorListener(err){emitter.removeListener(name,resolver);reject(err);}function resolver(){if(typeof emitter.removeListener==='function'){emitter.removeListener('error',errorListener);}resolve([].slice.call(arguments));}eventTargetAgnosticAddListener(emitter,name,resolver,{once:true});if(name!=='error'){addErrorHandlerIfEventEmitter(emitter,errorListener,{once:true});}});}function addErrorHandlerIfEventEmitter(emitter,handler,flags){if(typeof emitter.on==='function'){eventTargetAgnosticAddListener(emitter,'error',handler,flags);}}function eventTargetAgnosticAddListener(emitter,name,listener,flags){if(typeof emitter.on==='function'){if(flags.once){emitter.once(name,listener);}else{emitter.on(name,listener);}}else if(typeof emitter.addEventListener==='function'){// EventTarget does not have `error` event semantics like Node
// EventEmitters, we do not listen for `error` events here.
emitter.addEventListener(name,function wrapListener(arg){// IE does not have builtin `{ once: true }` support so we
// have to do it manually.
if(flags.once){emitter.removeEventListener(name,wrapListener);}listener(arg);});}else{throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+_typeof3(emitter));}}/***/},/***/"./node_modules/webworkify-webpack/index.js":/*!**************************************************!*\
			  !*** ./node_modules/webworkify-webpack/index.js ***!
			  \**************************************************/ /***/function node_modulesWebworkifyWebpackIndexJs(module,__unused_webpack_exports,__webpack_require__){function webpackBootstrapFunc(modules){/******/ // The module cache
/******/var installedModules={};/******/ // The require function
/******/function __nested_webpack_require_164__(moduleId){/******/ // Check if module is in cache
/******/if(installedModules[moduleId])/******/return installedModules[moduleId].exports;/******/ // Create a new module (and put it into the cache)
/******/var module=installedModules[moduleId]={/******/i:moduleId,/******/l:false,/******/exports:{}/******/};/******/ // Execute the module function
/******/modules[moduleId].call(module.exports,module,module.exports,__nested_webpack_require_164__);/******/ // Flag the module as loaded
/******/module.l=true;/******/ // Return the exports of the module
/******/return module.exports;/******/}/******/ // expose the modules object (__webpack_modules__)
/******/__nested_webpack_require_164__.m=modules;/******/ // expose the module cache
/******/__nested_webpack_require_164__.c=installedModules;/******/ // identity function for calling harmony imports with the correct context
/******/__nested_webpack_require_164__.i=function(value){return value;};/******/ // define getter function for harmony exports
/******/__nested_webpack_require_164__.d=function(exports,name,getter){/******/if(!__nested_webpack_require_164__.o(exports,name)){/******/Object.defineProperty(exports,name,{/******/configurable:false,/******/enumerable:true,/******/get:getter/******/});/******/}/******/};/******/ // define __esModule on exports
/******/__nested_webpack_require_164__.r=function(exports){/******/Object.defineProperty(exports,'__esModule',{value:true});/******/};/******/ // getDefaultExport function for compatibility with non-harmony modules
/******/__nested_webpack_require_164__.n=function(module){/******/var getter=module&&module.__esModule?/******/function getDefault(){return module['default'];}:/******/function getModuleExports(){return module;};/******/__nested_webpack_require_164__.d(getter,'a',getter);/******/return getter;/******/};/******/ // Object.prototype.hasOwnProperty.call
/******/__nested_webpack_require_164__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property);};/******/ // __webpack_public_path__
/******/__nested_webpack_require_164__.p="/";/******/ // on error function for async loading
/******/__nested_webpack_require_164__.oe=function(err){console.error(err);throw err;};var f=__nested_webpack_require_164__(__nested_webpack_require_164__.s=ENTRY_MODULE);return f.default||f;// try to call default if defined to also support babel esmodule exports
}var moduleNameReqExp='[\\.|\\-|\\+|\\w|\/|@]+';var dependencyRegExp='\\(\\s*(\/\\*.*?\\*\/)?\\s*.*?('+moduleNameReqExp+').*?\\)';// additional chars when output.pathinfo is true
// http://stackoverflow.com/a/2593661/130442
function quoteRegExp(str){return(str+'').replace(/[.?*+^$[\]\\(){}|-]/g,'\\$&');}function isNumeric(n){return!isNaN(1*n);// 1 * n converts integers, integers as string ("123"), 1e3 and "1e3" to integers and strings to NaN
}function getModuleDependencies(sources,module,queueName){var retval={};retval[queueName]=[];var fnString=module.toString();var wrapperSignature=fnString.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!wrapperSignature)return retval;var webpackRequireName=wrapperSignature[1];// main bundle deps
var re=new RegExp('(\\\\n|\\W)'+quoteRegExp(webpackRequireName)+dependencyRegExp,'g');var match;while(match=re.exec(fnString)){if(match[3]==='dll-reference')continue;retval[queueName].push(match[3]);}// dll deps
re=new RegExp('\\('+quoteRegExp(webpackRequireName)+'\\("(dll-reference\\s('+moduleNameReqExp+'))"\\)\\)'+dependencyRegExp,'g');while(match=re.exec(fnString)){if(!sources[match[2]]){retval[queueName].push(match[1]);sources[match[2]]=__webpack_require__(match[1]).m;}retval[match[2]]=retval[match[2]]||[];retval[match[2]].push(match[4]);}// convert 1e3 back to 1000 - this can be important after uglify-js converted 1000 to 1e3
var keys=Object.keys(retval);for(var i=0;i<keys.length;i++){for(var j=0;j<retval[keys[i]].length;j++){if(isNumeric(retval[keys[i]][j])){retval[keys[i]][j]=1*retval[keys[i]][j];}}}return retval;}function hasValuesInQueues(queues){var keys=Object.keys(queues);return keys.reduce(function(hasValues,key){return hasValues||queues[key].length>0;},false);}function getRequiredModules(sources,moduleId){var modulesQueue={main:[moduleId]};var requiredModules={main:[]};var seenModules={main:{}};while(hasValuesInQueues(modulesQueue)){var queues=Object.keys(modulesQueue);for(var i=0;i<queues.length;i++){var queueName=queues[i];var queue=modulesQueue[queueName];var moduleToCheck=queue.pop();seenModules[queueName]=seenModules[queueName]||{};if(seenModules[queueName][moduleToCheck]||!sources[queueName][moduleToCheck])continue;seenModules[queueName][moduleToCheck]=true;requiredModules[queueName]=requiredModules[queueName]||[];requiredModules[queueName].push(moduleToCheck);var newModules=getModuleDependencies(sources,sources[queueName][moduleToCheck],queueName);var newModulesKeys=Object.keys(newModules);for(var j=0;j<newModulesKeys.length;j++){modulesQueue[newModulesKeys[j]]=modulesQueue[newModulesKeys[j]]||[];modulesQueue[newModulesKeys[j]]=modulesQueue[newModulesKeys[j]].concat(newModules[newModulesKeys[j]]);}}}return requiredModules;}module.exports=function(moduleId,options){options=options||{};var sources={main:__webpack_require__.m};var requiredModules=options.all?{main:Object.keys(sources.main)}:getRequiredModules(sources,moduleId);var src='';Object.keys(requiredModules).filter(function(m){return m!=='main';}).forEach(function(module){var entryModule=0;while(requiredModules[module][entryModule]){entryModule++;}requiredModules[module].push(entryModule);sources[module][entryModule]='(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })';src=src+'var '+module+' = ('+webpackBootstrapFunc.toString().replace('ENTRY_MODULE',JSON.stringify(entryModule))+')({'+requiredModules[module].map(function(id){return''+JSON.stringify(id)+': '+sources[module][id].toString();}).join(',')+'});\n';});src=src+'new (('+webpackBootstrapFunc.toString().replace('ENTRY_MODULE',JSON.stringify(moduleId))+')({'+requiredModules.main.map(function(id){return''+JSON.stringify(id)+': '+sources.main[id].toString();}).join(',')+'}))(self);';var blob=new window.Blob([src],{type:'text/javascript'});if(options.bare){return blob;}var URL=window.URL||window.webkitURL||window.mozURL||window.msURL;var workerUrl=URL.createObjectURL(blob);var worker=new window.Worker(workerUrl);worker.objectURL=workerUrl;return worker;};/***/},/***/"./src/config.js":/*!***********************!*\
			  !*** ./src/config.js ***!
			  \***********************/ /***/function srcConfigJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export */__webpack_require__.d(__webpack_exports__,{/* harmony export */"defaultConfig":function defaultConfig(){return(/* binding */_defaultConfig);},/* harmony export */"createDefaultConfig":function createDefaultConfig(){return(/* binding */_createDefaultConfig);}/* harmony export */});/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */var _defaultConfig={enableWorker:false,enableStashBuffer:true,stashInitialSize:undefined,isLive:false,lazyLoad:true,lazyLoadMaxDuration:3*60,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:true,// autoCleanupSourceBuffer: default as false, leave unspecified
autoCleanupMaxBackwardDuration:3*60,autoCleanupMinBackwardDuration:2*60,statisticsInfoReportInterval:600,fixAudioTimestampGap:true,accurateSeek:false,seekType:'range',seekParamStart:'bstart',seekParamEnd:'bend',rangeLoadZeroStart:false,customSeekHandler:undefined,reuseRedirectedURL:false,// referrerPolicy: leave as unspecified
headers:undefined,customLoader:undefined};function _createDefaultConfig(){return Object.assign({},_defaultConfig);}/***/},/***/"./src/core/features.js":/*!******************************!*\
			  !*** ./src/core/features.js ***!
			  \******************************/ /***/function srcCoreFeaturesJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var _io_io_controller_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../io/io-controller.js */"./src/io/io-controller.js");/* harmony import */var _config_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../config.js */"./src/config.js");/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */var Features=/** @class */function(){function Features(){}Features.supportMSEH264Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"');};Features.supportNetworkStreamIO=function(){var ioctl=new _io_io_controller_js__WEBPACK_IMPORTED_MODULE_0__.default({},(0,_config_js__WEBPACK_IMPORTED_MODULE_1__.createDefaultConfig)());var loaderType=ioctl.loaderType;ioctl.destroy();return loaderType=='fetch-stream-loader'||loaderType=='xhr-moz-chunked-loader';};Features.getNetworkLoaderTypeName=function(){var ioctl=new _io_io_controller_js__WEBPACK_IMPORTED_MODULE_0__.default({},(0,_config_js__WEBPACK_IMPORTED_MODULE_1__.createDefaultConfig)());var loaderType=ioctl.loaderType;ioctl.destroy();return loaderType;};Features.supportNativeMediaPlayback=function(mimeType){if(Features.videoElement==undefined){Features.videoElement=window.document.createElement('video');}var canPlay=Features.videoElement.canPlayType(mimeType);return canPlay==='probably'||canPlay=='maybe';};Features.getFeatureList=function(){var features={mseFlvPlayback:false,mseLiveFlvPlayback:false,networkStreamIO:false,networkLoaderName:'',nativeMP4H264Playback:false,nativeWebmVP8Playback:false,nativeWebmVP9Playback:false};features.mseFlvPlayback=Features.supportMSEH264Playback();features.networkStreamIO=Features.supportNetworkStreamIO();features.networkLoaderName=Features.getNetworkLoaderTypeName();features.mseLiveFlvPlayback=features.mseFlvPlayback&&features.networkStreamIO;features.nativeMP4H264Playback=Features.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"');features.nativeWebmVP8Playback=Features.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"');features.nativeWebmVP9Playback=Features.supportNativeMediaPlayback('video/webm; codecs="vp9"');return features;};return Features;}();/* harmony default export */__webpack_exports__["default"]=Features;/***/},/***/"./src/core/media-info.js":/*!********************************!*\
			  !*** ./src/core/media-info.js ***!
			  \********************************/ /***/function srcCoreMediaInfoJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */var MediaInfo=/** @class */function(){function MediaInfo(){this.mimeType=null;this.duration=null;this.hasAudio=null;this.hasVideo=null;this.audioCodec=null;this.videoCodec=null;this.audioDataRate=null;this.videoDataRate=null;this.audioSampleRate=null;this.audioChannelCount=null;this.width=null;this.height=null;this.fps=null;this.profile=null;this.level=null;this.refFrames=null;this.chromaFormat=null;this.sarNum=null;this.sarDen=null;this.metadata=null;this.segments=null;// MediaInfo[]
this.segmentCount=null;this.hasKeyframesIndex=null;this.keyframesIndex=null;}MediaInfo.prototype.isComplete=function(){var audioInfoComplete=this.hasAudio===false||this.hasAudio===true&&this.audioCodec!=null&&this.audioSampleRate!=null&&this.audioChannelCount!=null;var videoInfoComplete=this.hasVideo===false||this.hasVideo===true&&this.videoCodec!=null&&this.width!=null&&this.height!=null&&this.fps!=null&&this.profile!=null&&this.level!=null&&this.refFrames!=null&&this.chromaFormat!=null&&this.sarNum!=null&&this.sarDen!=null;// keyframesIndex may not be present
return this.mimeType!=null&&this.duration!=null&&this.metadata!=null&&this.hasKeyframesIndex!=null&&audioInfoComplete&&videoInfoComplete;};MediaInfo.prototype.isSeekable=function(){return this.hasKeyframesIndex===true;};MediaInfo.prototype.getNearestKeyframe=function(milliseconds){if(this.keyframesIndex==null){return null;}var table=this.keyframesIndex;var keyframeIdx=this._search(table.times,milliseconds);return{index:keyframeIdx,milliseconds:table.times[keyframeIdx],fileposition:table.filepositions[keyframeIdx]};};MediaInfo.prototype._search=function(list,value){var idx=0;var last=list.length-1;var mid=0;var lbound=0;var ubound=last;if(value<list[0]){idx=0;lbound=ubound+1;// skip search
}while(lbound<=ubound){mid=lbound+Math.floor((ubound-lbound)/2);if(mid===last||value>=list[mid]&&value<list[mid+1]){idx=mid;break;}else if(list[mid]<value){lbound=mid+1;}else{ubound=mid-1;}}return idx;};return MediaInfo;}();/* harmony default export */__webpack_exports__["default"]=MediaInfo;/***/},/***/"./src/core/media-segment-info.js":/*!****************************************!*\
			  !*** ./src/core/media-segment-info.js ***!
			  \****************************************/ /***/function srcCoreMediaSegmentInfoJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export */__webpack_require__.d(__webpack_exports__,{/* harmony export */"SampleInfo":function SampleInfo(){return(/* binding */_SampleInfo);},/* harmony export */"MediaSegmentInfo":function MediaSegmentInfo(){return(/* binding */_MediaSegmentInfo);},/* harmony export */"IDRSampleList":function IDRSampleList(){return(/* binding */_IDRSampleList);},/* harmony export */"MediaSegmentInfoList":function MediaSegmentInfoList(){return(/* binding */_MediaSegmentInfoList);}/* harmony export */});/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */ // Represents an media sample (audio / video)
var _SampleInfo=/** @class */function(){function SampleInfo(dts,pts,duration,originalDts,isSync){this.dts=dts;this.pts=pts;this.duration=duration;this.originalDts=originalDts;this.isSyncPoint=isSync;this.fileposition=null;}return SampleInfo;}();// Media Segment concept is defined in Media Source Extensions spec.
// Particularly in ISO BMFF format, an Media Segment contains a moof box followed by a mdat box.
var _MediaSegmentInfo=/** @class */function(){function MediaSegmentInfo(){this.beginDts=0;this.endDts=0;this.beginPts=0;this.endPts=0;this.originalBeginDts=0;this.originalEndDts=0;this.syncPoints=[];// SampleInfo[n], for video IDR frames only
this.firstSample=null;// SampleInfo
this.lastSample=null;// SampleInfo
}MediaSegmentInfo.prototype.appendSyncPoint=function(sampleInfo){sampleInfo.isSyncPoint=true;this.syncPoints.push(sampleInfo);};return MediaSegmentInfo;}();// Ordered list for recording video IDR frames, sorted by originalDts
var _IDRSampleList=/** @class */function(){function IDRSampleList(){this._list=[];}IDRSampleList.prototype.clear=function(){this._list=[];};IDRSampleList.prototype.appendArray=function(syncPoints){var list=this._list;if(syncPoints.length===0){return;}if(list.length>0&&syncPoints[0].originalDts<list[list.length-1].originalDts){this.clear();}Array.prototype.push.apply(list,syncPoints);};IDRSampleList.prototype.getLastSyncPointBeforeDts=function(dts){if(this._list.length==0){return null;}var list=this._list;var idx=0;var last=list.length-1;var mid=0;var lbound=0;var ubound=last;if(dts<list[0].dts){idx=0;lbound=ubound+1;}while(lbound<=ubound){mid=lbound+Math.floor((ubound-lbound)/2);if(mid===last||dts>=list[mid].dts&&dts<list[mid+1].dts){idx=mid;break;}else if(list[mid].dts<dts){lbound=mid+1;}else{ubound=mid-1;}}return this._list[idx];};return IDRSampleList;}();// Data structure for recording information of media segments in single track.
var _MediaSegmentInfoList=/** @class */function(){function MediaSegmentInfoList(type){this._type=type;this._list=[];this._lastAppendLocation=-1;// cached last insert location
}Object.defineProperty(MediaSegmentInfoList.prototype,"type",{get:function get(){return this._type;},enumerable:false,configurable:true});Object.defineProperty(MediaSegmentInfoList.prototype,"length",{get:function get(){return this._list.length;},enumerable:false,configurable:true});MediaSegmentInfoList.prototype.isEmpty=function(){return this._list.length===0;};MediaSegmentInfoList.prototype.clear=function(){this._list=[];this._lastAppendLocation=-1;};MediaSegmentInfoList.prototype._searchNearestSegmentBefore=function(originalBeginDts){var list=this._list;if(list.length===0){return-2;}var last=list.length-1;var mid=0;var lbound=0;var ubound=last;var idx=0;if(originalBeginDts<list[0].originalBeginDts){idx=-1;return idx;}while(lbound<=ubound){mid=lbound+Math.floor((ubound-lbound)/2);if(mid===last||originalBeginDts>list[mid].lastSample.originalDts&&originalBeginDts<list[mid+1].originalBeginDts){idx=mid;break;}else if(list[mid].originalBeginDts<originalBeginDts){lbound=mid+1;}else{ubound=mid-1;}}return idx;};MediaSegmentInfoList.prototype._searchNearestSegmentAfter=function(originalBeginDts){return this._searchNearestSegmentBefore(originalBeginDts)+1;};MediaSegmentInfoList.prototype.append=function(mediaSegmentInfo){var list=this._list;var msi=mediaSegmentInfo;var lastAppendIdx=this._lastAppendLocation;var insertIdx=0;if(lastAppendIdx!==-1&&lastAppendIdx<list.length&&msi.originalBeginDts>=list[lastAppendIdx].lastSample.originalDts&&(lastAppendIdx===list.length-1||lastAppendIdx<list.length-1&&msi.originalBeginDts<list[lastAppendIdx+1].originalBeginDts)){insertIdx=lastAppendIdx+1;// use cached location idx
}else{if(list.length>0){insertIdx=this._searchNearestSegmentBefore(msi.originalBeginDts)+1;}}this._lastAppendLocation=insertIdx;this._list.splice(insertIdx,0,msi);};MediaSegmentInfoList.prototype.getLastSegmentBefore=function(originalBeginDts){var idx=this._searchNearestSegmentBefore(originalBeginDts);if(idx>=0){return this._list[idx];}else{// -1
return null;}};MediaSegmentInfoList.prototype.getLastSampleBefore=function(originalBeginDts){var segment=this.getLastSegmentBefore(originalBeginDts);if(segment!=null){return segment.lastSample;}else{return null;}};MediaSegmentInfoList.prototype.getLastSyncPointBefore=function(originalBeginDts){var segmentIdx=this._searchNearestSegmentBefore(originalBeginDts);var syncPoints=this._list[segmentIdx].syncPoints;while(syncPoints.length===0&&segmentIdx>0){segmentIdx--;syncPoints=this._list[segmentIdx].syncPoints;}if(syncPoints.length>0){return syncPoints[syncPoints.length-1];}else{return null;}};return MediaSegmentInfoList;}();/***/},/***/"./src/core/mse-controller.js":/*!************************************!*\
			  !*** ./src/core/mse-controller.js ***!
			  \************************************/ /***/function srcCoreMseControllerJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var events__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! events */"./node_modules/events/events.js");/* harmony import */var events__WEBPACK_IMPORTED_MODULE_0___default=/*#__PURE__*/__webpack_require__.n(events__WEBPACK_IMPORTED_MODULE_0__);/* harmony import */var _utils_logger_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../utils/logger.js */"./src/utils/logger.js");/* harmony import */var _utils_browser_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../utils/browser.js */"./src/utils/browser.js");/* harmony import */var _mse_events_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ./mse-events.js */"./src/core/mse-events.js");/* harmony import */var _media_segment_info_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(/*! ./media-segment-info.js */"./src/core/media-segment-info.js");/* harmony import */var _utils_exception_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(/*! ../utils/exception.js */"./src/utils/exception.js");/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */ // Media Source Extensions controller
var MSEController=/** @class */function(){function MSEController(config){this.TAG='MSEController';this._config=config;this._emitter=new(events__WEBPACK_IMPORTED_MODULE_0___default())();if(this._config.isLive&&this._config.autoCleanupSourceBuffer==undefined){// For live stream, do auto cleanup by default
this._config.autoCleanupSourceBuffer=true;}this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)};this._mediaSource=null;this._mediaSourceObjectURL=null;this._mediaElement=null;this._isBufferFull=false;this._hasPendingEos=false;this._requireSetMediaDuration=false;this._pendingMediaDuration=0;this._pendingSourceBufferInit=[];this._mimeTypes={video:null,audio:null};this._sourceBuffers={video:null,audio:null};this._lastInitSegments={video:null,audio:null};this._pendingSegments={video:[],audio:[]};this._pendingRemoveRanges={video:[],audio:[]};this._idrList=new _media_segment_info_js__WEBPACK_IMPORTED_MODULE_4__.IDRSampleList();}MSEController.prototype.destroy=function(){if(this._mediaElement||this._mediaSource){this.detachMediaElement();}this.e=null;this._emitter.removeAllListeners();this._emitter=null;};MSEController.prototype.on=function(event,listener){this._emitter.addListener(event,listener);};MSEController.prototype.off=function(event,listener){this._emitter.removeListener(event,listener);};MSEController.prototype.attachMediaElement=function(mediaElement){if(this._mediaSource){throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_5__.IllegalStateException('MediaSource has been attached to an HTMLMediaElement!');}var ms=this._mediaSource=new window.MediaSource();ms.addEventListener('sourceopen',this.e.onSourceOpen);ms.addEventListener('sourceended',this.e.onSourceEnded);ms.addEventListener('sourceclose',this.e.onSourceClose);this._mediaElement=mediaElement;this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource);mediaElement.src=this._mediaSourceObjectURL;};MSEController.prototype.detachMediaElement=function(){if(this._mediaSource){var ms=this._mediaSource;for(var type in this._sourceBuffers){// pending segments should be discard
var ps=this._pendingSegments[type];ps.splice(0,ps.length);this._pendingSegments[type]=null;this._pendingRemoveRanges[type]=null;this._lastInitSegments[type]=null;// remove all sourcebuffers
var sb=this._sourceBuffers[type];if(sb){if(ms.readyState!=='closed'){// ms edge can throw an error: Unexpected call to method or property access
try{ms.removeSourceBuffer(sb);}catch(error){_utils_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.e(this.TAG,error.message);}sb.removeEventListener('error',this.e.onSourceBufferError);sb.removeEventListener('updateend',this.e.onSourceBufferUpdateEnd);}this._mimeTypes[type]=null;this._sourceBuffers[type]=null;}}if(ms.readyState==='open'){try{ms.endOfStream();}catch(error){_utils_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.e(this.TAG,error.message);}}ms.removeEventListener('sourceopen',this.e.onSourceOpen);ms.removeEventListener('sourceended',this.e.onSourceEnded);ms.removeEventListener('sourceclose',this.e.onSourceClose);this._pendingSourceBufferInit=[];this._isBufferFull=false;this._idrList.clear();this._mediaSource=null;}if(this._mediaElement){this._mediaElement.src='';this._mediaElement.removeAttribute('src');this._mediaElement=null;}if(this._mediaSourceObjectURL){window.URL.revokeObjectURL(this._mediaSourceObjectURL);this._mediaSourceObjectURL=null;}};MSEController.prototype.appendInitSegment=function(initSegment,deferred){if(!this._mediaSource||this._mediaSource.readyState!=='open'){// sourcebuffer creation requires mediaSource.readyState === 'open'
// so we defer the sourcebuffer creation, until sourceopen event triggered
this._pendingSourceBufferInit.push(initSegment);// make sure that this InitSegment is in the front of pending segments queue
this._pendingSegments[initSegment.type].push(initSegment);return;}var is=initSegment;var mimeType=""+is.container;if(is.codec&&is.codec.length>0){mimeType+=";codecs="+is.codec;}var firstInitSegment=false;_utils_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.v(this.TAG,'Received Initialization Segment, mimeType: '+mimeType);this._lastInitSegments[is.type]=is;if(mimeType!==this._mimeTypes[is.type]){if(!this._mimeTypes[is.type]){// empty, first chance create sourcebuffer
firstInitSegment=true;try{var sb=this._sourceBuffers[is.type]=this._mediaSource.addSourceBuffer(mimeType);sb.addEventListener('error',this.e.onSourceBufferError);sb.addEventListener('updateend',this.e.onSourceBufferUpdateEnd);}catch(error){_utils_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.e(this.TAG,error.message);this._emitter.emit(_mse_events_js__WEBPACK_IMPORTED_MODULE_3__.default.ERROR,{code:error.code,msg:error.message});return;}}else{_utils_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.v(this.TAG,"Notice: "+is.type+" mimeType changed, origin: "+this._mimeTypes[is.type]+", target: "+mimeType);}this._mimeTypes[is.type]=mimeType;}if(!deferred){// deferred means this InitSegment has been pushed to pendingSegments queue
this._pendingSegments[is.type].push(is);}if(!firstInitSegment){// append immediately only if init segment in subsequence
if(this._sourceBuffers[is.type]&&!this._sourceBuffers[is.type].updating){this._doAppendSegments();}}if(_utils_browser_js__WEBPACK_IMPORTED_MODULE_2__.default.safari&&is.container==='audio/mpeg'&&is.mediaDuration>0){// 'audio/mpeg' track under Safari may cause MediaElement's duration to be NaN
// Manually correct MediaSource.duration to make progress bar seekable, and report right duration
this._requireSetMediaDuration=true;this._pendingMediaDuration=is.mediaDuration/1000;// in seconds
this._updateMediaSourceDuration();}};MSEController.prototype.appendMediaSegment=function(mediaSegment){var ms=mediaSegment;this._pendingSegments[ms.type].push(ms);if(this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()){this._doCleanupSourceBuffer();}var sb=this._sourceBuffers[ms.type];if(sb&&!sb.updating&&!this._hasPendingRemoveRanges()){this._doAppendSegments();}};MSEController.prototype.seek=function(seconds){// remove all appended buffers
for(var type in this._sourceBuffers){if(!this._sourceBuffers[type]){continue;}// abort current buffer append algorithm
var sb=this._sourceBuffers[type];if(this._mediaSource.readyState==='open'){try{// If range removal algorithm is running, InvalidStateError will be throwed
// Ignore it.
sb.abort();}catch(error){_utils_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.e(this.TAG,error.message);}}// IDRList should be clear
this._idrList.clear();// pending segments should be discard
var ps=this._pendingSegments[type];ps.splice(0,ps.length);if(this._mediaSource.readyState==='closed'){// Parent MediaSource object has been detached from HTMLMediaElement
continue;}// record ranges to be remove from SourceBuffer
for(var i=0;i<sb.buffered.length;i++){var start=sb.buffered.start(i);var end=sb.buffered.end(i);this._pendingRemoveRanges[type].push({start:start,end:end});}// if sb is not updating, let's remove ranges now!
if(!sb.updating){this._doRemoveRanges();}// Safari 10 may get InvalidStateError in the later appendBuffer() after SourceBuffer.remove() call
// Internal parser's state may be invalid at this time. Re-append last InitSegment to workaround.
// Related issue: https://bugs.webkit.org/show_bug.cgi?id=159230
if(_utils_browser_js__WEBPACK_IMPORTED_MODULE_2__.default.safari){var lastInitSegment=this._lastInitSegments[type];if(lastInitSegment){this._pendingSegments[type].push(lastInitSegment);if(!sb.updating){this._doAppendSegments();}}}}};MSEController.prototype.endOfStream=function(){var ms=this._mediaSource;var sb=this._sourceBuffers;if(!ms||ms.readyState!=='open'){if(ms&&ms.readyState==='closed'&&this._hasPendingSegments()){// If MediaSource hasn't turned into open state, and there're pending segments
// Mark pending endOfStream, defer call until all pending segments appended complete
this._hasPendingEos=true;}return;}if(sb.video&&sb.video.updating||sb.audio&&sb.audio.updating){// If any sourcebuffer is updating, defer endOfStream operation
// See _onSourceBufferUpdateEnd()
this._hasPendingEos=true;}else{this._hasPendingEos=false;// Notify media data loading complete
// This is helpful for correcting total duration to match last media segment
// Otherwise MediaElement's ended event may not be triggered
ms.endOfStream();}};MSEController.prototype.getNearestKeyframe=function(dts){return this._idrList.getLastSyncPointBeforeDts(dts);};MSEController.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer){return false;}var currentTime=this._mediaElement.currentTime;for(var type in this._sourceBuffers){var sb=this._sourceBuffers[type];if(sb){var buffered=sb.buffered;if(buffered.length>=1){if(currentTime-buffered.start(0)>=this._config.autoCleanupMaxBackwardDuration){return true;}}}}return false;};MSEController.prototype._doCleanupSourceBuffer=function(){var currentTime=this._mediaElement.currentTime;for(var type in this._sourceBuffers){var sb=this._sourceBuffers[type];if(sb){var buffered=sb.buffered;var doRemove=false;for(var i=0;i<buffered.length;i++){var start=buffered.start(i);var end=buffered.end(i);if(start<=currentTime&&currentTime<end+3){// padding 3 seconds
if(currentTime-start>=this._config.autoCleanupMaxBackwardDuration){doRemove=true;var removeEnd=currentTime-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[type].push({start:start,end:removeEnd});}}else if(end<currentTime){doRemove=true;this._pendingRemoveRanges[type].push({start:start,end:end});}}if(doRemove&&!sb.updating){this._doRemoveRanges();}}}};MSEController.prototype._updateMediaSourceDuration=function(){var sb=this._sourceBuffers;if(this._mediaElement.readyState===0||this._mediaSource.readyState!=='open'){return;}if(sb.video&&sb.video.updating||sb.audio&&sb.audio.updating){return;}var current=this._mediaSource.duration;var target=this._pendingMediaDuration;if(target>0&&(isNaN(current)||target>current)){_utils_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.v(this.TAG,"Update MediaSource duration from "+current+" to "+target);this._mediaSource.duration=target;}this._requireSetMediaDuration=false;this._pendingMediaDuration=0;};MSEController.prototype._doRemoveRanges=function(){for(var type in this._pendingRemoveRanges){if(!this._sourceBuffers[type]||this._sourceBuffers[type].updating){continue;}var sb=this._sourceBuffers[type];var ranges=this._pendingRemoveRanges[type];while(ranges.length&&!sb.updating){var range=ranges.shift();sb.remove(range.start,range.end);}}};MSEController.prototype._doAppendSegments=function(){var pendingSegments=this._pendingSegments;for(var type in pendingSegments){if(!this._sourceBuffers[type]||this._sourceBuffers[type].updating){continue;}if(pendingSegments[type].length>0){var segment=pendingSegments[type].shift();if(segment.timestampOffset){// For MPEG audio stream in MSE, if unbuffered-seeking occurred
// We need explicitly set timestampOffset to the desired point in timeline for mpeg SourceBuffer.
var currentOffset=this._sourceBuffers[type].timestampOffset;var targetOffset=segment.timestampOffset/1000;// in seconds
var delta=Math.abs(currentOffset-targetOffset);if(delta>0.1){// If time delta > 100ms
_utils_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.v(this.TAG,"Update MPEG audio timestampOffset from "+currentOffset+" to "+targetOffset);this._sourceBuffers[type].timestampOffset=targetOffset;}delete segment.timestampOffset;}if(!segment.data||segment.data.byteLength===0){// Ignore empty buffer
continue;}try{this._sourceBuffers[type].appendBuffer(segment.data);this._isBufferFull=false;if(type==='video'&&segment.hasOwnProperty('info')){this._idrList.appendArray(segment.info.syncPoints);}}catch(error){this._pendingSegments[type].unshift(segment);if(error.code===22){// QuotaExceededError
/* Notice that FireFox may not throw QuotaExceededError if SourceBuffer is full
			                         * Currently we can only do lazy-load to avoid SourceBuffer become scattered.
			                         * SourceBuffer eviction policy may be changed in future version of FireFox.
			                         *
			                         * Related issues:
			                         * https://bugzilla.mozilla.org/show_bug.cgi?id=1279885
			                         * https://bugzilla.mozilla.org/show_bug.cgi?id=1280023
			                         */ // report buffer full, abort network IO
if(!this._isBufferFull){this._emitter.emit(_mse_events_js__WEBPACK_IMPORTED_MODULE_3__.default.BUFFER_FULL);}this._isBufferFull=true;}else{_utils_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.e(this.TAG,error.message);this._emitter.emit(_mse_events_js__WEBPACK_IMPORTED_MODULE_3__.default.ERROR,{code:error.code,msg:error.message});}}}}};MSEController.prototype._onSourceOpen=function(){_utils_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.v(this.TAG,'MediaSource onSourceOpen');this._mediaSource.removeEventListener('sourceopen',this.e.onSourceOpen);// deferred sourcebuffer creation / initialization
if(this._pendingSourceBufferInit.length>0){var pendings=this._pendingSourceBufferInit;while(pendings.length){var segment=pendings.shift();this.appendInitSegment(segment,true);}}// there may be some pending media segments, append them
if(this._hasPendingSegments()){this._doAppendSegments();}this._emitter.emit(_mse_events_js__WEBPACK_IMPORTED_MODULE_3__.default.SOURCE_OPEN);};MSEController.prototype._onSourceEnded=function(){// fired on endOfStream
_utils_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.v(this.TAG,'MediaSource onSourceEnded');};MSEController.prototype._onSourceClose=function(){// fired on detaching from media element
_utils_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.v(this.TAG,'MediaSource onSourceClose');if(this._mediaSource&&this.e!=null){this._mediaSource.removeEventListener('sourceopen',this.e.onSourceOpen);this._mediaSource.removeEventListener('sourceended',this.e.onSourceEnded);this._mediaSource.removeEventListener('sourceclose',this.e.onSourceClose);}};MSEController.prototype._hasPendingSegments=function(){var ps=this._pendingSegments;return ps.video.length>0||ps.audio.length>0;};MSEController.prototype._hasPendingRemoveRanges=function(){var prr=this._pendingRemoveRanges;return prr.video.length>0||prr.audio.length>0;};MSEController.prototype._onSourceBufferUpdateEnd=function(){if(this._requireSetMediaDuration){this._updateMediaSourceDuration();}else if(this._hasPendingRemoveRanges()){this._doRemoveRanges();}else if(this._hasPendingSegments()){this._doAppendSegments();}else if(this._hasPendingEos){this.endOfStream();}this._emitter.emit(_mse_events_js__WEBPACK_IMPORTED_MODULE_3__.default.UPDATE_END);};MSEController.prototype._onSourceBufferError=function(e){_utils_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.e(this.TAG,"SourceBuffer Error: "+e);// this error might not always be fatal, just ignore it
};return MSEController;}();/* harmony default export */__webpack_exports__["default"]=MSEController;/***/},/***/"./src/core/mse-events.js":/*!********************************!*\
			  !*** ./src/core/mse-events.js ***!
			  \********************************/ /***/function srcCoreMseEventsJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */var MSEEvents={ERROR:'error',SOURCE_OPEN:'source_open',UPDATE_END:'update_end',BUFFER_FULL:'buffer_full'};/* harmony default export */__webpack_exports__["default"]=MSEEvents;/***/},/***/"./src/core/transmuxer.js":/*!********************************!*\
			  !*** ./src/core/transmuxer.js ***!
			  \********************************/ /***/function srcCoreTransmuxerJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var events__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! events */"./node_modules/events/events.js");/* harmony import */var events__WEBPACK_IMPORTED_MODULE_0___default=/*#__PURE__*/__webpack_require__.n(events__WEBPACK_IMPORTED_MODULE_0__);/* harmony import */var webworkify_webpack__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! webworkify-webpack */"./node_modules/webworkify-webpack/index.js");/* harmony import */var webworkify_webpack__WEBPACK_IMPORTED_MODULE_1___default=/*#__PURE__*/__webpack_require__.n(webworkify_webpack__WEBPACK_IMPORTED_MODULE_1__);/* harmony import */var _utils_logger_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../utils/logger.js */"./src/utils/logger.js");/* harmony import */var _utils_logging_control_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ../utils/logging-control.js */"./src/utils/logging-control.js");/* harmony import */var _transmuxing_controller_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(/*! ./transmuxing-controller.js */"./src/core/transmuxing-controller.js");/* harmony import */var _transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(/*! ./transmuxing-events.js */"./src/core/transmuxing-events.js");/* harmony import */var _media_info_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(/*! ./media-info.js */"./src/core/media-info.js");/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */var Transmuxer=/** @class */function(){function Transmuxer(mediaDataSource,config){this.TAG='Transmuxer';this._emitter=new(events__WEBPACK_IMPORTED_MODULE_0___default())();if(config.enableWorker&&typeof Worker!=='undefined'){try{this._worker=webworkify_webpack__WEBPACK_IMPORTED_MODULE_1___default()(/*require.resolve*/ /*! ./transmuxing-worker */"./src/core/transmuxing-worker.js");this._workerDestroying=false;this._worker.addEventListener('message',this._onWorkerMessage.bind(this));this._worker.postMessage({cmd:'init',param:[mediaDataSource,config]});this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)};_utils_logging_control_js__WEBPACK_IMPORTED_MODULE_3__.default.registerListener(this.e.onLoggingConfigChanged);this._worker.postMessage({cmd:'logging_config',param:_utils_logging_control_js__WEBPACK_IMPORTED_MODULE_3__.default.getConfig()});}catch(error){_utils_logger_js__WEBPACK_IMPORTED_MODULE_2__.default.e(this.TAG,'Error while initialize transmuxing worker, fallback to inline transmuxing');this._worker=null;this._controller=new _transmuxing_controller_js__WEBPACK_IMPORTED_MODULE_4__.default(mediaDataSource,config);}}else{this._controller=new _transmuxing_controller_js__WEBPACK_IMPORTED_MODULE_4__.default(mediaDataSource,config);}if(this._controller){var ctl=this._controller;ctl.on(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.IO_ERROR,this._onIOError.bind(this));ctl.on(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.DEMUX_ERROR,this._onDemuxError.bind(this));ctl.on(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.INIT_SEGMENT,this._onInitSegment.bind(this));ctl.on(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.MEDIA_SEGMENT,this._onMediaSegment.bind(this));ctl.on(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.LOADING_COMPLETE,this._onLoadingComplete.bind(this));ctl.on(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this));ctl.on(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.MEDIA_INFO,this._onMediaInfo.bind(this));ctl.on(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.METADATA_ARRIVED,this._onMetaDataArrived.bind(this));ctl.on(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this));ctl.on(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.STATISTICS_INFO,this._onStatisticsInfo.bind(this));ctl.on(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this));}}Transmuxer.prototype.destroy=function(){if(this._worker){if(!this._workerDestroying){this._workerDestroying=true;this._worker.postMessage({cmd:'destroy'});_utils_logging_control_js__WEBPACK_IMPORTED_MODULE_3__.default.removeListener(this.e.onLoggingConfigChanged);this.e=null;}}else{this._controller.destroy();this._controller=null;}this._emitter.removeAllListeners();this._emitter=null;};Transmuxer.prototype.on=function(event,listener){this._emitter.addListener(event,listener);};Transmuxer.prototype.off=function(event,listener){this._emitter.removeListener(event,listener);};Transmuxer.prototype.hasWorker=function(){return this._worker!=null;};Transmuxer.prototype.open=function(){if(this._worker){this._worker.postMessage({cmd:'start'});}else{this._controller.start();}};Transmuxer.prototype.close=function(){if(this._worker){this._worker.postMessage({cmd:'stop'});}else{this._controller.stop();}};Transmuxer.prototype.seek=function(milliseconds){if(this._worker){this._worker.postMessage({cmd:'seek',param:milliseconds});}else{this._controller.seek(milliseconds);}};Transmuxer.prototype.pause=function(){if(this._worker){this._worker.postMessage({cmd:'pause'});}else{this._controller.pause();}};Transmuxer.prototype.resume=function(){if(this._worker){this._worker.postMessage({cmd:'resume'});}else{this._controller.resume();}};Transmuxer.prototype._onInitSegment=function(type,initSegment){var _this=this;// do async invoke
Promise.resolve().then(function(){_this._emitter.emit(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.INIT_SEGMENT,type,initSegment);});};Transmuxer.prototype._onMediaSegment=function(type,mediaSegment){var _this=this;Promise.resolve().then(function(){_this._emitter.emit(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.MEDIA_SEGMENT,type,mediaSegment);});};Transmuxer.prototype._onLoadingComplete=function(){var _this=this;Promise.resolve().then(function(){_this._emitter.emit(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.LOADING_COMPLETE);});};Transmuxer.prototype._onRecoveredEarlyEof=function(){var _this=this;Promise.resolve().then(function(){_this._emitter.emit(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.RECOVERED_EARLY_EOF);});};Transmuxer.prototype._onMediaInfo=function(mediaInfo){var _this=this;Promise.resolve().then(function(){_this._emitter.emit(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.MEDIA_INFO,mediaInfo);});};Transmuxer.prototype._onMetaDataArrived=function(metadata){var _this=this;Promise.resolve().then(function(){_this._emitter.emit(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.METADATA_ARRIVED,metadata);});};Transmuxer.prototype._onScriptDataArrived=function(data){var _this=this;Promise.resolve().then(function(){_this._emitter.emit(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.SCRIPTDATA_ARRIVED,data);});};Transmuxer.prototype._onStatisticsInfo=function(statisticsInfo){var _this=this;Promise.resolve().then(function(){_this._emitter.emit(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.STATISTICS_INFO,statisticsInfo);});};Transmuxer.prototype._onIOError=function(type,info){var _this=this;Promise.resolve().then(function(){_this._emitter.emit(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.IO_ERROR,type,info);});};Transmuxer.prototype._onDemuxError=function(type,info){var _this=this;Promise.resolve().then(function(){_this._emitter.emit(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.DEMUX_ERROR,type,info);});};Transmuxer.prototype._onRecommendSeekpoint=function(milliseconds){var _this=this;Promise.resolve().then(function(){_this._emitter.emit(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.RECOMMEND_SEEKPOINT,milliseconds);});};Transmuxer.prototype._onLoggingConfigChanged=function(config){if(this._worker){this._worker.postMessage({cmd:'logging_config',param:config});}};Transmuxer.prototype._onWorkerMessage=function(e){var message=e.data;var data=message.data;if(message.msg==='destroyed'||this._workerDestroying){this._workerDestroying=false;this._worker.terminate();this._worker=null;return;}switch(message.msg){case _transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.INIT_SEGMENT:case _transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.MEDIA_SEGMENT:this._emitter.emit(message.msg,data.type,data.data);break;case _transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.LOADING_COMPLETE:case _transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.RECOVERED_EARLY_EOF:this._emitter.emit(message.msg);break;case _transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.MEDIA_INFO:Object.setPrototypeOf(data,_media_info_js__WEBPACK_IMPORTED_MODULE_6__.default.prototype);this._emitter.emit(message.msg,data);break;case _transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.METADATA_ARRIVED:case _transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.SCRIPTDATA_ARRIVED:case _transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.STATISTICS_INFO:this._emitter.emit(message.msg,data);break;case _transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.IO_ERROR:case _transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.DEMUX_ERROR:this._emitter.emit(message.msg,data.type,data.info);break;case _transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.RECOMMEND_SEEKPOINT:this._emitter.emit(message.msg,data);break;case'logcat_callback':_utils_logger_js__WEBPACK_IMPORTED_MODULE_2__.default.emitter.emit('log',data.type,data.logcat);break;}};return Transmuxer;}();/* harmony default export */__webpack_exports__["default"]=Transmuxer;/***/},/***/"./src/core/transmuxing-controller.js":/*!********************************************!*\
			  !*** ./src/core/transmuxing-controller.js ***!
			  \********************************************/ /***/function srcCoreTransmuxingControllerJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var events__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! events */"./node_modules/events/events.js");/* harmony import */var events__WEBPACK_IMPORTED_MODULE_0___default=/*#__PURE__*/__webpack_require__.n(events__WEBPACK_IMPORTED_MODULE_0__);/* harmony import */var _utils_logger_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../utils/logger.js */"./src/utils/logger.js");/* harmony import */var _utils_browser_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../utils/browser.js */"./src/utils/browser.js");/* harmony import */var _media_info_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ./media-info.js */"./src/core/media-info.js");/* harmony import */var _demux_flv_demuxer_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(/*! ../demux/flv-demuxer.js */"./src/demux/flv-demuxer.js");/* harmony import */var _remux_mp4_remuxer_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(/*! ../remux/mp4-remuxer.js */"./src/remux/mp4-remuxer.js");/* harmony import */var _demux_demux_errors_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(/*! ../demux/demux-errors.js */"./src/demux/demux-errors.js");/* harmony import */var _io_io_controller_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(/*! ../io/io-controller.js */"./src/io/io-controller.js");/* harmony import */var _transmuxing_events_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(/*! ./transmuxing-events.js */"./src/core/transmuxing-events.js");/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */ // Transmuxing (IO, Demuxing, Remuxing) controller, with multipart support
var TransmuxingController=/** @class */function(){function TransmuxingController(mediaDataSource,config){this.TAG='TransmuxingController';this._emitter=new(events__WEBPACK_IMPORTED_MODULE_0___default())();this._config=config;// treat single part media as multipart media, which has only one segment
if(!mediaDataSource.segments){mediaDataSource.segments=[{duration:mediaDataSource.duration,filesize:mediaDataSource.filesize,url:mediaDataSource.url}];}// fill in default IO params if not exists
if(typeof mediaDataSource.cors!=='boolean'){mediaDataSource.cors=true;}if(typeof mediaDataSource.withCredentials!=='boolean'){mediaDataSource.withCredentials=false;}this._mediaDataSource=mediaDataSource;this._currentSegmentIndex=0;var totalDuration=0;this._mediaDataSource.segments.forEach(function(segment){// timestampBase for each segment, and calculate total duration
segment.timestampBase=totalDuration;totalDuration+=segment.duration;// params needed by IOController
segment.cors=mediaDataSource.cors;segment.withCredentials=mediaDataSource.withCredentials;// referrer policy control, if exist
if(config.referrerPolicy){segment.referrerPolicy=config.referrerPolicy;}});if(!isNaN(totalDuration)&&this._mediaDataSource.duration!==totalDuration){this._mediaDataSource.duration=totalDuration;}this._mediaInfo=null;this._demuxer=null;this._remuxer=null;this._ioctl=null;this._pendingSeekTime=null;this._pendingResolveSeekPoint=null;this._statisticsReporter=null;}TransmuxingController.prototype.destroy=function(){this._mediaInfo=null;this._mediaDataSource=null;if(this._statisticsReporter){this._disableStatisticsReporter();}if(this._ioctl){this._ioctl.destroy();this._ioctl=null;}if(this._demuxer){this._demuxer.destroy();this._demuxer=null;}if(this._remuxer){this._remuxer.destroy();this._remuxer=null;}this._emitter.removeAllListeners();this._emitter=null;};TransmuxingController.prototype.on=function(event,listener){this._emitter.addListener(event,listener);};TransmuxingController.prototype.off=function(event,listener){this._emitter.removeListener(event,listener);};TransmuxingController.prototype.start=function(){this._loadSegment(0);this._enableStatisticsReporter();};TransmuxingController.prototype._loadSegment=function(segmentIndex,optionalFrom){this._currentSegmentIndex=segmentIndex;var dataSource=this._mediaDataSource.segments[segmentIndex];var ioctl=this._ioctl=new _io_io_controller_js__WEBPACK_IMPORTED_MODULE_7__.default(dataSource,this._config,segmentIndex);ioctl.onError=this._onIOException.bind(this);ioctl.onSeeked=this._onIOSeeked.bind(this);ioctl.onComplete=this._onIOComplete.bind(this);ioctl.onRedirect=this._onIORedirect.bind(this);ioctl.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this);if(optionalFrom){this._demuxer.bindDataSource(this._ioctl);}else{ioctl.onDataArrival=this._onInitChunkArrival.bind(this);}ioctl.open(optionalFrom);};TransmuxingController.prototype.stop=function(){this._internalAbort();this._disableStatisticsReporter();};TransmuxingController.prototype._internalAbort=function(){if(this._ioctl){this._ioctl.destroy();this._ioctl=null;}};TransmuxingController.prototype.pause=function(){if(this._ioctl&&this._ioctl.isWorking()){this._ioctl.pause();this._disableStatisticsReporter();}};TransmuxingController.prototype.resume=function(){if(this._ioctl&&this._ioctl.isPaused()){this._ioctl.resume();this._enableStatisticsReporter();}};TransmuxingController.prototype.seek=function(milliseconds){if(this._mediaInfo==null||!this._mediaInfo.isSeekable()){return;}var targetSegmentIndex=this._searchSegmentIndexContains(milliseconds);if(targetSegmentIndex===this._currentSegmentIndex){// intra-segment seeking
var segmentInfo=this._mediaInfo.segments[targetSegmentIndex];if(segmentInfo==undefined){// current segment loading started, but mediainfo hasn't received yet
// wait for the metadata loaded, then seek to expected position
this._pendingSeekTime=milliseconds;}else{var keyframe=segmentInfo.getNearestKeyframe(milliseconds);this._remuxer.seek(keyframe.milliseconds);this._ioctl.seek(keyframe.fileposition);// Will be resolved in _onRemuxerMediaSegmentArrival()
this._pendingResolveSeekPoint=keyframe.milliseconds;}}else{// cross-segment seeking
var targetSegmentInfo=this._mediaInfo.segments[targetSegmentIndex];if(targetSegmentInfo==undefined){// target segment hasn't been loaded. We need metadata then seek to expected time
this._pendingSeekTime=milliseconds;this._internalAbort();this._remuxer.seek();this._remuxer.insertDiscontinuity();this._loadSegment(targetSegmentIndex);// Here we wait for the metadata loaded, then seek to expected position
}else{// We have target segment's metadata, direct seek to target position
var keyframe=targetSegmentInfo.getNearestKeyframe(milliseconds);this._internalAbort();this._remuxer.seek(milliseconds);this._remuxer.insertDiscontinuity();this._demuxer.resetMediaInfo();this._demuxer.timestampBase=this._mediaDataSource.segments[targetSegmentIndex].timestampBase;this._loadSegment(targetSegmentIndex,keyframe.fileposition);this._pendingResolveSeekPoint=keyframe.milliseconds;this._reportSegmentMediaInfo(targetSegmentIndex);}}this._enableStatisticsReporter();};TransmuxingController.prototype._searchSegmentIndexContains=function(milliseconds){var segments=this._mediaDataSource.segments;var idx=segments.length-1;for(var i=0;i<segments.length;i++){if(milliseconds<segments[i].timestampBase){idx=i-1;break;}}return idx;};TransmuxingController.prototype._onInitChunkArrival=function(data,byteStart){var _this=this;var probeData=null;var consumed=0;if(byteStart>0){// IOController seeked immediately after opened, byteStart > 0 callback may received
this._demuxer.bindDataSource(this._ioctl);this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase;consumed=this._demuxer.parseChunks(data,byteStart);}else if((probeData=_demux_flv_demuxer_js__WEBPACK_IMPORTED_MODULE_4__.default.probe(data)).match){// Always create new FLVDemuxer
this._demuxer=new _demux_flv_demuxer_js__WEBPACK_IMPORTED_MODULE_4__.default(probeData,this._config);if(!this._remuxer){this._remuxer=new _remux_mp4_remuxer_js__WEBPACK_IMPORTED_MODULE_5__.default(this._config);}var mds=this._mediaDataSource;if(mds.duration!=undefined&&!isNaN(mds.duration)){this._demuxer.overridedDuration=mds.duration;}if(typeof mds.hasAudio==='boolean'){this._demuxer.overridedHasAudio=mds.hasAudio;}if(typeof mds.hasVideo==='boolean'){this._demuxer.overridedHasVideo=mds.hasVideo;}this._demuxer.timestampBase=mds.segments[this._currentSegmentIndex].timestampBase;this._demuxer.onError=this._onDemuxException.bind(this);this._demuxer.onMediaInfo=this._onMediaInfo.bind(this);this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this);this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this);this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl));this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this);this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this);consumed=this._demuxer.parseChunks(data,byteStart);}else{probeData=null;_utils_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.e(this.TAG,'Non-FLV, Unsupported media type!');Promise.resolve().then(function(){_this._internalAbort();});this._emitter.emit(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_8__.default.DEMUX_ERROR,_demux_demux_errors_js__WEBPACK_IMPORTED_MODULE_6__.default.FORMAT_UNSUPPORTED,'Non-FLV, Unsupported media type');consumed=0;}return consumed;};TransmuxingController.prototype._onMediaInfo=function(mediaInfo){var _this=this;if(this._mediaInfo==null){// Store first segment's mediainfo as global mediaInfo
this._mediaInfo=Object.assign({},mediaInfo);this._mediaInfo.keyframesIndex=null;this._mediaInfo.segments=[];this._mediaInfo.segmentCount=this._mediaDataSource.segments.length;Object.setPrototypeOf(this._mediaInfo,_media_info_js__WEBPACK_IMPORTED_MODULE_3__.default.prototype);}var segmentInfo=Object.assign({},mediaInfo);Object.setPrototypeOf(segmentInfo,_media_info_js__WEBPACK_IMPORTED_MODULE_3__.default.prototype);this._mediaInfo.segments[this._currentSegmentIndex]=segmentInfo;// notify mediaInfo update
this._reportSegmentMediaInfo(this._currentSegmentIndex);if(this._pendingSeekTime!=null){Promise.resolve().then(function(){var target=_this._pendingSeekTime;_this._pendingSeekTime=null;_this.seek(target);});}};TransmuxingController.prototype._onMetaDataArrived=function(metadata){this._emitter.emit(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_8__.default.METADATA_ARRIVED,metadata);};TransmuxingController.prototype._onScriptDataArrived=function(data){this._emitter.emit(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_8__.default.SCRIPTDATA_ARRIVED,data);};TransmuxingController.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity();};TransmuxingController.prototype._onIOComplete=function(extraData){var segmentIndex=extraData;var nextSegmentIndex=segmentIndex+1;if(nextSegmentIndex<this._mediaDataSource.segments.length){this._internalAbort();this._remuxer.flushStashedSamples();this._loadSegment(nextSegmentIndex);}else{this._remuxer.flushStashedSamples();this._emitter.emit(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_8__.default.LOADING_COMPLETE);this._disableStatisticsReporter();}};TransmuxingController.prototype._onIORedirect=function(redirectedURL){var segmentIndex=this._ioctl.extraData;this._mediaDataSource.segments[segmentIndex].redirectedURL=redirectedURL;};TransmuxingController.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_8__.default.RECOVERED_EARLY_EOF);};TransmuxingController.prototype._onIOException=function(type,info){_utils_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.e(this.TAG,"IOException: type = "+type+", code = "+info.code+", msg = "+info.msg);this._emitter.emit(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_8__.default.IO_ERROR,type,info);this._disableStatisticsReporter();};TransmuxingController.prototype._onDemuxException=function(type,info){_utils_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.e(this.TAG,"DemuxException: type = "+type+", info = "+info);this._emitter.emit(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_8__.default.DEMUX_ERROR,type,info);};TransmuxingController.prototype._onRemuxerInitSegmentArrival=function(type,initSegment){this._emitter.emit(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_8__.default.INIT_SEGMENT,type,initSegment);};TransmuxingController.prototype._onRemuxerMediaSegmentArrival=function(type,mediaSegment){if(this._pendingSeekTime!=null){// Media segments after new-segment cross-seeking should be dropped.
return;}this._emitter.emit(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_8__.default.MEDIA_SEGMENT,type,mediaSegment);// Resolve pending seekPoint
if(this._pendingResolveSeekPoint!=null&&type==='video'){var syncPoints=mediaSegment.info.syncPoints;var seekpoint=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null;// Safari: Pass PTS for recommend_seekpoint
if(_utils_browser_js__WEBPACK_IMPORTED_MODULE_2__.default.safari&&syncPoints.length>0&&syncPoints[0].originalDts===seekpoint){seekpoint=syncPoints[0].pts;}// else: use original DTS (keyframe.milliseconds)
this._emitter.emit(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_8__.default.RECOMMEND_SEEKPOINT,seekpoint);}};TransmuxingController.prototype._enableStatisticsReporter=function(){if(this._statisticsReporter==null){this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval);}};TransmuxingController.prototype._disableStatisticsReporter=function(){if(this._statisticsReporter){self.clearInterval(this._statisticsReporter);this._statisticsReporter=null;}};TransmuxingController.prototype._reportSegmentMediaInfo=function(segmentIndex){var segmentInfo=this._mediaInfo.segments[segmentIndex];var exportInfo=Object.assign({},segmentInfo);exportInfo.duration=this._mediaInfo.duration;exportInfo.segmentCount=this._mediaInfo.segmentCount;delete exportInfo.segments;delete exportInfo.keyframesIndex;this._emitter.emit(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_8__.default.MEDIA_INFO,exportInfo);};TransmuxingController.prototype._reportStatisticsInfo=function(){var info={};info.url=this._ioctl.currentURL;info.hasRedirect=this._ioctl.hasRedirect;if(info.hasRedirect){info.redirectedURL=this._ioctl.currentRedirectedURL;}info.speed=this._ioctl.currentSpeed;info.loaderType=this._ioctl.loaderType;info.currentSegmentIndex=this._currentSegmentIndex;info.totalSegmentCount=this._mediaDataSource.segments.length;this._emitter.emit(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_8__.default.STATISTICS_INFO,info);};return TransmuxingController;}();/* harmony default export */__webpack_exports__["default"]=TransmuxingController;/***/},/***/"./src/core/transmuxing-events.js":/*!****************************************!*\
			  !*** ./src/core/transmuxing-events.js ***!
			  \****************************************/ /***/function srcCoreTransmuxingEventsJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */var TransmuxingEvents={IO_ERROR:'io_error',DEMUX_ERROR:'demux_error',INIT_SEGMENT:'init_segment',MEDIA_SEGMENT:'media_segment',LOADING_COMPLETE:'loading_complete',RECOVERED_EARLY_EOF:'recovered_early_eof',MEDIA_INFO:'media_info',METADATA_ARRIVED:'metadata_arrived',SCRIPTDATA_ARRIVED:'scriptdata_arrived',STATISTICS_INFO:'statistics_info',RECOMMEND_SEEKPOINT:'recommend_seekpoint'};/* harmony default export */__webpack_exports__["default"]=TransmuxingEvents;/***/},/***/"./src/core/transmuxing-worker.js":/*!****************************************!*\
			  !*** ./src/core/transmuxing-worker.js ***!
			  \****************************************/ /***/function srcCoreTransmuxingWorkerJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var _utils_logging_control_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../utils/logging-control.js */"./src/utils/logging-control.js");/* harmony import */var _utils_polyfill_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../utils/polyfill.js */"./src/utils/polyfill.js");/* harmony import */var _transmuxing_controller_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ./transmuxing-controller.js */"./src/core/transmuxing-controller.js");/* harmony import */var _transmuxing_events_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ./transmuxing-events.js */"./src/core/transmuxing-events.js");/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */ /* post message to worker:
			   data: {
			       cmd: string
			       param: any
			   }

			   receive message from worker:
			   data: {
			       msg: string,
			       data: any
			   }
			 */var TransmuxingWorker=function TransmuxingWorker(self){var controller=null;var logcatListener=onLogcatCallback.bind(this);_utils_polyfill_js__WEBPACK_IMPORTED_MODULE_1__.default.install();self.addEventListener('message',function(e){switch(e.data.cmd){case'init':controller=new _transmuxing_controller_js__WEBPACK_IMPORTED_MODULE_2__.default(e.data.param[0],e.data.param[1]);controller.on(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_3__.default.IO_ERROR,onIOError.bind(this));controller.on(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_3__.default.DEMUX_ERROR,onDemuxError.bind(this));controller.on(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_3__.default.INIT_SEGMENT,onInitSegment.bind(this));controller.on(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_3__.default.MEDIA_SEGMENT,onMediaSegment.bind(this));controller.on(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_3__.default.LOADING_COMPLETE,onLoadingComplete.bind(this));controller.on(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_3__.default.RECOVERED_EARLY_EOF,onRecoveredEarlyEof.bind(this));controller.on(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_3__.default.MEDIA_INFO,onMediaInfo.bind(this));controller.on(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_3__.default.METADATA_ARRIVED,onMetaDataArrived.bind(this));controller.on(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_3__.default.SCRIPTDATA_ARRIVED,onScriptDataArrived.bind(this));controller.on(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_3__.default.STATISTICS_INFO,onStatisticsInfo.bind(this));controller.on(_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_3__.default.RECOMMEND_SEEKPOINT,onRecommendSeekpoint.bind(this));break;case'destroy':if(controller){controller.destroy();controller=null;}self.postMessage({msg:'destroyed'});break;case'start':controller.start();break;case'stop':controller.stop();break;case'seek':controller.seek(e.data.param);break;case'pause':controller.pause();break;case'resume':controller.resume();break;case'logging_config':{var config=e.data.param;_utils_logging_control_js__WEBPACK_IMPORTED_MODULE_0__.default.applyConfig(config);if(config.enableCallback===true){_utils_logging_control_js__WEBPACK_IMPORTED_MODULE_0__.default.addLogListener(logcatListener);}else{_utils_logging_control_js__WEBPACK_IMPORTED_MODULE_0__.default.removeLogListener(logcatListener);}break;}}});function onInitSegment(type,initSegment){var obj={msg:_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_3__.default.INIT_SEGMENT,data:{type:type,data:initSegment}};self.postMessage(obj,[initSegment.data]);// data: ArrayBuffer
}function onMediaSegment(type,mediaSegment){var obj={msg:_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_3__.default.MEDIA_SEGMENT,data:{type:type,data:mediaSegment}};self.postMessage(obj,[mediaSegment.data]);// data: ArrayBuffer
}function onLoadingComplete(){var obj={msg:_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_3__.default.LOADING_COMPLETE};self.postMessage(obj);}function onRecoveredEarlyEof(){var obj={msg:_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_3__.default.RECOVERED_EARLY_EOF};self.postMessage(obj);}function onMediaInfo(mediaInfo){var obj={msg:_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_3__.default.MEDIA_INFO,data:mediaInfo};self.postMessage(obj);}function onMetaDataArrived(metadata){var obj={msg:_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_3__.default.METADATA_ARRIVED,data:metadata};self.postMessage(obj);}function onScriptDataArrived(data){var obj={msg:_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_3__.default.SCRIPTDATA_ARRIVED,data:data};self.postMessage(obj);}function onStatisticsInfo(statInfo){var obj={msg:_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_3__.default.STATISTICS_INFO,data:statInfo};self.postMessage(obj);}function onIOError(type,info){self.postMessage({msg:_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_3__.default.IO_ERROR,data:{type:type,info:info}});}function onDemuxError(type,info){self.postMessage({msg:_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_3__.default.DEMUX_ERROR,data:{type:type,info:info}});}function onRecommendSeekpoint(milliseconds){self.postMessage({msg:_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_3__.default.RECOMMEND_SEEKPOINT,data:milliseconds});}function onLogcatCallback(type,str){self.postMessage({msg:'logcat_callback',data:{type:type,logcat:str}});}};/* harmony default export */__webpack_exports__["default"]=TransmuxingWorker;/***/},/***/"./src/demux/amf-parser.js":/*!*********************************!*\
			  !*** ./src/demux/amf-parser.js ***!
			  \*********************************/ /***/function srcDemuxAmfParserJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var _utils_logger_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../utils/logger.js */"./src/utils/logger.js");/* harmony import */var _utils_utf8_conv_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../utils/utf8-conv.js */"./src/utils/utf8-conv.js");/* harmony import */var _utils_exception_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../utils/exception.js */"./src/utils/exception.js");/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */var le=function(){var buf=new ArrayBuffer(2);new DataView(buf).setInt16(0,256,true);// little-endian write
return new Int16Array(buf)[0]===256;// platform-spec read, if equal then LE
}();var AMF=/** @class */function(){function AMF(){}AMF.parseScriptData=function(arrayBuffer,dataOffset,dataSize){var data={};try{var name_1=AMF.parseValue(arrayBuffer,dataOffset,dataSize);var value=AMF.parseValue(arrayBuffer,dataOffset+name_1.size,dataSize-name_1.size);data[name_1.data]=value.data;}catch(e){_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.e('AMF',e.toString());}return data;};AMF.parseObject=function(arrayBuffer,dataOffset,dataSize){if(dataSize<3){throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_2__.IllegalStateException('Data not enough when parse ScriptDataObject');}var name=AMF.parseString(arrayBuffer,dataOffset,dataSize);var value=AMF.parseValue(arrayBuffer,dataOffset+name.size,dataSize-name.size);var isObjectEnd=value.objectEnd;return{data:{name:name.data,value:value.data},size:name.size+value.size,objectEnd:isObjectEnd};};AMF.parseVariable=function(arrayBuffer,dataOffset,dataSize){return AMF.parseObject(arrayBuffer,dataOffset,dataSize);};AMF.parseString=function(arrayBuffer,dataOffset,dataSize){if(dataSize<2){throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_2__.IllegalStateException('Data not enough when parse String');}var v=new DataView(arrayBuffer,dataOffset,dataSize);var length=v.getUint16(0,!le);var str;if(length>0){str=(0,_utils_utf8_conv_js__WEBPACK_IMPORTED_MODULE_1__.default)(new Uint8Array(arrayBuffer,dataOffset+2,length));}else{str='';}return{data:str,size:2+length};};AMF.parseLongString=function(arrayBuffer,dataOffset,dataSize){if(dataSize<4){throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_2__.IllegalStateException('Data not enough when parse LongString');}var v=new DataView(arrayBuffer,dataOffset,dataSize);var length=v.getUint32(0,!le);var str;if(length>0){str=(0,_utils_utf8_conv_js__WEBPACK_IMPORTED_MODULE_1__.default)(new Uint8Array(arrayBuffer,dataOffset+4,length));}else{str='';}return{data:str,size:4+length};};AMF.parseDate=function(arrayBuffer,dataOffset,dataSize){if(dataSize<10){throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_2__.IllegalStateException('Data size invalid when parse Date');}var v=new DataView(arrayBuffer,dataOffset,dataSize);var timestamp=v.getFloat64(0,!le);var localTimeOffset=v.getInt16(8,!le);timestamp+=localTimeOffset*60*1000;// get UTC time
return{data:new Date(timestamp),size:8+2};};AMF.parseValue=function(arrayBuffer,dataOffset,dataSize){if(dataSize<1){throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_2__.IllegalStateException('Data not enough when parse Value');}var v=new DataView(arrayBuffer,dataOffset,dataSize);var offset=1;var type=v.getUint8(0);var value;var objectEnd=false;try{switch(type){case 0:// Number(Double) type
value=v.getFloat64(1,!le);offset+=8;break;case 1:{// Boolean type
var b=v.getUint8(1);value=b?true:false;offset+=1;break;}case 2:{// String type
var amfstr=AMF.parseString(arrayBuffer,dataOffset+1,dataSize-1);value=amfstr.data;offset+=amfstr.size;break;}case 3:{// Object(s) type
value={};var terminal=0;// workaround for malformed Objects which has missing ScriptDataObjectEnd
if((v.getUint32(dataSize-4,!le)&0x00FFFFFF)===9){terminal=3;}while(offset<dataSize-4){// 4 === type(UI8) + ScriptDataObjectEnd(UI24)
var amfobj=AMF.parseObject(arrayBuffer,dataOffset+offset,dataSize-offset-terminal);if(amfobj.objectEnd)break;value[amfobj.data.name]=amfobj.data.value;offset+=amfobj.size;}if(offset<=dataSize-3){var marker=v.getUint32(offset-1,!le)&0x00FFFFFF;if(marker===9){offset+=3;}}break;}case 8:{// ECMA array type (Mixed array)
value={};offset+=4;// ECMAArrayLength(UI32)
var terminal=0;// workaround for malformed MixedArrays which has missing ScriptDataObjectEnd
if((v.getUint32(dataSize-4,!le)&0x00FFFFFF)===9){terminal=3;}while(offset<dataSize-8){// 8 === type(UI8) + ECMAArrayLength(UI32) + ScriptDataVariableEnd(UI24)
var amfvar=AMF.parseVariable(arrayBuffer,dataOffset+offset,dataSize-offset-terminal);if(amfvar.objectEnd)break;value[amfvar.data.name]=amfvar.data.value;offset+=amfvar.size;}if(offset<=dataSize-3){var marker=v.getUint32(offset-1,!le)&0x00FFFFFF;if(marker===9){offset+=3;}}break;}case 9:// ScriptDataObjectEnd
value=undefined;offset=1;objectEnd=true;break;case 10:{// Strict array type
// ScriptDataValue[n]. NOTE: according to video_file_format_spec_v10_1.pdf
value=[];var strictArrayLength=v.getUint32(1,!le);offset+=4;for(var i=0;i<strictArrayLength;i++){var val=AMF.parseValue(arrayBuffer,dataOffset+offset,dataSize-offset);value.push(val.data);offset+=val.size;}break;}case 11:{// Date type
var date=AMF.parseDate(arrayBuffer,dataOffset+1,dataSize-1);value=date.data;offset+=date.size;break;}case 12:{// Long string type
var amfLongStr=AMF.parseString(arrayBuffer,dataOffset+1,dataSize-1);value=amfLongStr.data;offset+=amfLongStr.size;break;}default:// ignore and skip
offset=dataSize;_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.w('AMF','Unsupported AMF value type '+type);}}catch(e){_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.e('AMF',e.toString());}return{data:value,size:offset,objectEnd:objectEnd};};return AMF;}();/* harmony default export */__webpack_exports__["default"]=AMF;/***/},/***/"./src/demux/demux-errors.js":/*!***********************************!*\
			  !*** ./src/demux/demux-errors.js ***!
			  \***********************************/ /***/function srcDemuxDemuxErrorsJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */var DemuxErrors={OK:'OK',FORMAT_ERROR:'FormatError',FORMAT_UNSUPPORTED:'FormatUnsupported',CODEC_UNSUPPORTED:'CodecUnsupported'};/* harmony default export */__webpack_exports__["default"]=DemuxErrors;/***/},/***/"./src/demux/exp-golomb.js":/*!*********************************!*\
			  !*** ./src/demux/exp-golomb.js ***!
			  \*********************************/ /***/function srcDemuxExpGolombJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var _utils_exception_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../utils/exception.js */"./src/utils/exception.js");/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */ // Exponential-Golomb buffer decoder
var ExpGolomb=/** @class */function(){function ExpGolomb(uint8array){this.TAG='ExpGolomb';this._buffer=uint8array;this._buffer_index=0;this._total_bytes=uint8array.byteLength;this._total_bits=uint8array.byteLength*8;this._current_word=0;this._current_word_bits_left=0;}ExpGolomb.prototype.destroy=function(){this._buffer=null;};ExpGolomb.prototype._fillCurrentWord=function(){var buffer_bytes_left=this._total_bytes-this._buffer_index;if(buffer_bytes_left<=0)throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_0__.IllegalStateException('ExpGolomb: _fillCurrentWord() but no bytes available');var bytes_read=Math.min(4,buffer_bytes_left);var word=new Uint8Array(4);word.set(this._buffer.subarray(this._buffer_index,this._buffer_index+bytes_read));this._current_word=new DataView(word.buffer).getUint32(0,false);this._buffer_index+=bytes_read;this._current_word_bits_left=bytes_read*8;};ExpGolomb.prototype.readBits=function(bits){if(bits>32)throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_0__.InvalidArgumentException('ExpGolomb: readBits() bits exceeded max 32bits!');if(bits<=this._current_word_bits_left){var result_1=this._current_word>>>32-bits;this._current_word<<=bits;this._current_word_bits_left-=bits;return result_1;}var result=this._current_word_bits_left?this._current_word:0;result=result>>>32-this._current_word_bits_left;var bits_need_left=bits-this._current_word_bits_left;this._fillCurrentWord();var bits_read_next=Math.min(bits_need_left,this._current_word_bits_left);var result2=this._current_word>>>32-bits_read_next;this._current_word<<=bits_read_next;this._current_word_bits_left-=bits_read_next;result=result<<bits_read_next|result2;return result;};ExpGolomb.prototype.readBool=function(){return this.readBits(1)===1;};ExpGolomb.prototype.readByte=function(){return this.readBits(8);};ExpGolomb.prototype._skipLeadingZero=function(){var zero_count;for(zero_count=0;zero_count<this._current_word_bits_left;zero_count++){if(0!==(this._current_word&0x80000000>>>zero_count)){this._current_word<<=zero_count;this._current_word_bits_left-=zero_count;return zero_count;}}this._fillCurrentWord();return zero_count+this._skipLeadingZero();};ExpGolomb.prototype.readUEG=function(){var leading_zeros=this._skipLeadingZero();return this.readBits(leading_zeros+1)-1;};ExpGolomb.prototype.readSEG=function(){var value=this.readUEG();if(value&0x01){return value+1>>>1;}else{return-1*(value>>>1);}};return ExpGolomb;}();/* harmony default export */__webpack_exports__["default"]=ExpGolomb;/***/},/***/"./src/demux/flv-demuxer.js":/*!**********************************!*\
			  !*** ./src/demux/flv-demuxer.js ***!
			  \**********************************/ /***/function srcDemuxFlvDemuxerJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var _utils_logger_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../utils/logger.js */"./src/utils/logger.js");/* harmony import */var _amf_parser_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ./amf-parser.js */"./src/demux/amf-parser.js");/* harmony import */var _sps_parser_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ./sps-parser.js */"./src/demux/sps-parser.js");/* harmony import */var _demux_errors_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ./demux-errors.js */"./src/demux/demux-errors.js");/* harmony import */var _core_media_info_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(/*! ../core/media-info.js */"./src/core/media-info.js");/* harmony import */var _utils_exception_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(/*! ../utils/exception.js */"./src/utils/exception.js");function ReadBig32(array,index){return array[index]<<24|array[index+1]<<16|array[index+2]<<8|array[index+3];}var FLVDemuxer=/** @class */function(){function FLVDemuxer(probeData,config){this.TAG='FLVDemuxer';this._config=config;this._onError=null;this._onMediaInfo=null;this._onMetaDataArrived=null;this._onScriptDataArrived=null;this._onTrackMetadata=null;this._onDataAvailable=null;this._dataOffset=probeData.dataOffset;this._firstParse=true;this._dispatch=false;this._hasAudio=probeData.hasAudioTrack;this._hasVideo=probeData.hasVideoTrack;this._hasAudioFlagOverrided=false;this._hasVideoFlagOverrided=false;this._audioInitialMetadataDispatched=false;this._videoInitialMetadataDispatched=false;this._mediaInfo=new _core_media_info_js__WEBPACK_IMPORTED_MODULE_4__.default();this._mediaInfo.hasAudio=this._hasAudio;this._mediaInfo.hasVideo=this._hasVideo;this._metadata=null;this._audioMetadata=null;this._videoMetadata=null;this._naluLengthSize=4;this._timestampBase=0;// int32, in milliseconds
this._timescale=1000;this._duration=0;// int32, in milliseconds
this._durationOverrided=false;this._referenceFrameRate={fixed:true,fps:23.976,fps_num:23976,fps_den:1000};this._flvSoundRateTable=[5500,11025,22050,44100,48000];this._mpegSamplingRates=[96000,88200,64000,48000,44100,32000,24000,22050,16000,12000,11025,8000,7350];this._mpegAudioV10SampleRateTable=[44100,48000,32000,0];this._mpegAudioV20SampleRateTable=[22050,24000,16000,0];this._mpegAudioV25SampleRateTable=[11025,12000,8000,0];this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1];this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1];this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1];this._videoTrack={type:'video',id:1,sequenceNumber:0,samples:[],length:0};this._audioTrack={type:'audio',id:2,sequenceNumber:0,samples:[],length:0};this._littleEndian=function(){var buf=new ArrayBuffer(2);new DataView(buf).setInt16(0,256,true);// little-endian write
return new Int16Array(buf)[0]===256;// platform-spec read, if equal then LE
}();}FLVDemuxer.prototype.destroy=function(){this._mediaInfo=null;this._metadata=null;this._audioMetadata=null;this._videoMetadata=null;this._videoTrack=null;this._audioTrack=null;this._onError=null;this._onMediaInfo=null;this._onMetaDataArrived=null;this._onScriptDataArrived=null;this._onTrackMetadata=null;this._onDataAvailable=null;};FLVDemuxer.probe=function(buffer){var data=new Uint8Array(buffer);var mismatch={match:false};if(data[0]!==0x46||data[1]!==0x4C||data[2]!==0x56||data[3]!==0x01){return mismatch;}var hasAudio=(data[4]&4)>>>2!==0;var hasVideo=(data[4]&1)!==0;var offset=ReadBig32(data,5);if(offset<9){return mismatch;}return{match:true,consumed:offset,dataOffset:offset,hasAudioTrack:hasAudio,hasVideoTrack:hasVideo};};FLVDemuxer.prototype.bindDataSource=function(loader){loader.onDataArrival=this.parseChunks.bind(this);return this;};Object.defineProperty(FLVDemuxer.prototype,"onTrackMetadata",{// prototype: function(type: string, metadata: any): void
get:function get(){return this._onTrackMetadata;},set:function set(callback){this._onTrackMetadata=callback;},enumerable:false,configurable:true});Object.defineProperty(FLVDemuxer.prototype,"onMediaInfo",{// prototype: function(mediaInfo: MediaInfo): void
get:function get(){return this._onMediaInfo;},set:function set(callback){this._onMediaInfo=callback;},enumerable:false,configurable:true});Object.defineProperty(FLVDemuxer.prototype,"onMetaDataArrived",{get:function get(){return this._onMetaDataArrived;},set:function set(callback){this._onMetaDataArrived=callback;},enumerable:false,configurable:true});Object.defineProperty(FLVDemuxer.prototype,"onScriptDataArrived",{get:function get(){return this._onScriptDataArrived;},set:function set(callback){this._onScriptDataArrived=callback;},enumerable:false,configurable:true});Object.defineProperty(FLVDemuxer.prototype,"onError",{// prototype: function(type: number, info: string): void
get:function get(){return this._onError;},set:function set(callback){this._onError=callback;},enumerable:false,configurable:true});Object.defineProperty(FLVDemuxer.prototype,"onDataAvailable",{// prototype: function(videoTrack: any, audioTrack: any): void
get:function get(){return this._onDataAvailable;},set:function set(callback){this._onDataAvailable=callback;},enumerable:false,configurable:true});Object.defineProperty(FLVDemuxer.prototype,"timestampBase",{// timestamp base for output samples, must be in milliseconds
get:function get(){return this._timestampBase;},set:function set(base){this._timestampBase=base;},enumerable:false,configurable:true});Object.defineProperty(FLVDemuxer.prototype,"overridedDuration",{get:function get(){return this._duration;},// Force-override media duration. Must be in milliseconds, int32
set:function set(duration){this._durationOverrided=true;this._duration=duration;this._mediaInfo.duration=duration;},enumerable:false,configurable:true});Object.defineProperty(FLVDemuxer.prototype,"overridedHasAudio",{// Force-override audio track present flag, boolean
set:function set(hasAudio){this._hasAudioFlagOverrided=true;this._hasAudio=hasAudio;this._mediaInfo.hasAudio=hasAudio;},enumerable:false,configurable:true});Object.defineProperty(FLVDemuxer.prototype,"overridedHasVideo",{// Force-override video track present flag, boolean
set:function set(hasVideo){this._hasVideoFlagOverrided=true;this._hasVideo=hasVideo;this._mediaInfo.hasVideo=hasVideo;},enumerable:false,configurable:true});FLVDemuxer.prototype.resetMediaInfo=function(){this._mediaInfo=new _core_media_info_js__WEBPACK_IMPORTED_MODULE_4__.default();};FLVDemuxer.prototype._isInitialMetadataDispatched=function(){if(this._hasAudio&&this._hasVideo){// both audio & video
return this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched;}if(this._hasAudio&&!this._hasVideo){// audio only
return this._audioInitialMetadataDispatched;}if(!this._hasAudio&&this._hasVideo){// video only
return this._videoInitialMetadataDispatched;}return false;};// function parseChunks(chunk: ArrayBuffer, byteStart: number): number;
FLVDemuxer.prototype.parseChunks=function(chunk,byteStart){if(!this._onError||!this._onMediaInfo||!this._onTrackMetadata||!this._onDataAvailable){throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_5__.IllegalStateException('Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified');}var offset=0;var le=this._littleEndian;if(byteStart===0){// buffer with FLV header
if(chunk.byteLength>13){var probeData=FLVDemuxer.probe(chunk);offset=probeData.dataOffset;}else{return 0;}}if(this._firstParse){// handle PreviousTagSize0 before Tag1
this._firstParse=false;if(byteStart+offset!==this._dataOffset){_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.w(this.TAG,'First time parsing but chunk byteStart invalid!');}var v=new DataView(chunk,offset);var prevTagSize0=v.getUint32(0,!le);if(prevTagSize0!==0){_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.w(this.TAG,'PrevTagSize0 !== 0 !!!');}offset+=4;}while(offset<chunk.byteLength){this._dispatch=true;var v=new DataView(chunk,offset);if(offset+11+4>chunk.byteLength){// data not enough for parsing an flv tag
break;}var tagType=v.getUint8(0);var dataSize=v.getUint32(0,!le)&0x00FFFFFF;if(offset+11+dataSize+4>chunk.byteLength){// data not enough for parsing actual data body
break;}if(tagType!==8&&tagType!==9&&tagType!==18){_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.w(this.TAG,"Unsupported tag type "+tagType+", skipped");// consume the whole tag (skip it)
offset+=11+dataSize+4;continue;}var ts2=v.getUint8(4);var ts1=v.getUint8(5);var ts0=v.getUint8(6);var ts3=v.getUint8(7);var timestamp=ts0|ts1<<8|ts2<<16|ts3<<24;var streamId=v.getUint32(7,!le)&0x00FFFFFF;if(streamId!==0){_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.w(this.TAG,'Meet tag which has StreamID != 0!');}var dataOffset=offset+11;switch(tagType){case 8:// Audio
this._parseAudioData(chunk,dataOffset,dataSize,timestamp);break;case 9:// Video
this._parseVideoData(chunk,dataOffset,dataSize,timestamp,byteStart+offset);break;case 18:// ScriptDataObject
this._parseScriptData(chunk,dataOffset,dataSize);break;}var prevTagSize=v.getUint32(11+dataSize,!le);if(prevTagSize!==11+dataSize){_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.w(this.TAG,"Invalid PrevTagSize "+prevTagSize);}offset+=11+dataSize+4;// tagBody + dataSize + prevTagSize
}// dispatch parsed frames to consumer (typically, the remuxer)
if(this._isInitialMetadataDispatched()){if(this._dispatch&&(this._audioTrack.length||this._videoTrack.length)){this._onDataAvailable(this._audioTrack,this._videoTrack);}}return offset;// consumed bytes, just equals latest offset index
};FLVDemuxer.prototype._parseScriptData=function(arrayBuffer,dataOffset,dataSize){var scriptData=_amf_parser_js__WEBPACK_IMPORTED_MODULE_1__.default.parseScriptData(arrayBuffer,dataOffset,dataSize);if(scriptData.hasOwnProperty('onMetaData')){if(scriptData.onMetaData==null||_typeof3(scriptData.onMetaData)!=='object'){_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.w(this.TAG,'Invalid onMetaData structure!');return;}if(this._metadata){_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.w(this.TAG,'Found another onMetaData tag!');}this._metadata=scriptData;var onMetaData=this._metadata.onMetaData;if(this._onMetaDataArrived){this._onMetaDataArrived(Object.assign({},onMetaData));}if(typeof onMetaData.hasAudio==='boolean'){// hasAudio
if(this._hasAudioFlagOverrided===false){this._hasAudio=onMetaData.hasAudio;this._mediaInfo.hasAudio=this._hasAudio;}}if(typeof onMetaData.hasVideo==='boolean'){// hasVideo
if(this._hasVideoFlagOverrided===false){this._hasVideo=onMetaData.hasVideo;this._mediaInfo.hasVideo=this._hasVideo;}}if(typeof onMetaData.audiodatarate==='number'){// audiodatarate
this._mediaInfo.audioDataRate=onMetaData.audiodatarate;}if(typeof onMetaData.videodatarate==='number'){// videodatarate
this._mediaInfo.videoDataRate=onMetaData.videodatarate;}if(typeof onMetaData.width==='number'){// width
this._mediaInfo.width=onMetaData.width;}if(typeof onMetaData.height==='number'){// height
this._mediaInfo.height=onMetaData.height;}if(typeof onMetaData.duration==='number'){// duration
if(!this._durationOverrided){var duration=Math.floor(onMetaData.duration*this._timescale);this._duration=duration;this._mediaInfo.duration=duration;}}else{this._mediaInfo.duration=0;}if(typeof onMetaData.framerate==='number'){// framerate
var fps_num=Math.floor(onMetaData.framerate*1000);if(fps_num>0){var fps=fps_num/1000;this._referenceFrameRate.fixed=true;this._referenceFrameRate.fps=fps;this._referenceFrameRate.fps_num=fps_num;this._referenceFrameRate.fps_den=1000;this._mediaInfo.fps=fps;}}if(_typeof3(onMetaData.keyframes)==='object'){// keyframes
this._mediaInfo.hasKeyframesIndex=true;var keyframes=onMetaData.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(keyframes);onMetaData.keyframes=null;// keyframes has been extracted, remove it
}else{this._mediaInfo.hasKeyframesIndex=false;}this._dispatch=false;this._mediaInfo.metadata=onMetaData;_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.v(this.TAG,'Parsed onMetaData');if(this._mediaInfo.isComplete()){this._onMediaInfo(this._mediaInfo);}}if(Object.keys(scriptData).length>0){if(this._onScriptDataArrived){this._onScriptDataArrived(Object.assign({},scriptData));}}};FLVDemuxer.prototype._parseKeyframesIndex=function(keyframes){var times=[];var filepositions=[];// ignore first keyframe which is actually AVC Sequence Header (AVCDecoderConfigurationRecord)
for(var i=1;i<keyframes.times.length;i++){var time=this._timestampBase+Math.floor(keyframes.times[i]*1000);times.push(time);filepositions.push(keyframes.filepositions[i]);}return{times:times,filepositions:filepositions};};FLVDemuxer.prototype._parseAudioData=function(arrayBuffer,dataOffset,dataSize,tagTimestamp){if(dataSize<=1){_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.w(this.TAG,'Flv: Invalid audio packet, missing SoundData payload!');return;}if(this._hasAudioFlagOverrided===true&&this._hasAudio===false){// If hasAudio: false indicated explicitly in MediaDataSource,
// Ignore all the audio packets
return;}this._littleEndian;var v=new DataView(arrayBuffer,dataOffset,dataSize);var soundSpec=v.getUint8(0);var soundFormat=soundSpec>>>4;if(soundFormat!==2&&soundFormat!==10){// MP3 or AAC
this._onError(_demux_errors_js__WEBPACK_IMPORTED_MODULE_3__.default.CODEC_UNSUPPORTED,'Flv: Unsupported audio codec idx: '+soundFormat);return;}var soundRate=0;var soundRateIndex=(soundSpec&12)>>>2;if(soundRateIndex>=0&&soundRateIndex<=4){soundRate=this._flvSoundRateTable[soundRateIndex];}else{this._onError(_demux_errors_js__WEBPACK_IMPORTED_MODULE_3__.default.FORMAT_ERROR,'Flv: Invalid audio sample rate idx: '+soundRateIndex);return;}var soundType=soundSpec&1;var meta=this._audioMetadata;var track=this._audioTrack;if(!meta){if(this._hasAudio===false&&this._hasAudioFlagOverrided===false){this._hasAudio=true;this._mediaInfo.hasAudio=true;}// initial metadata
meta=this._audioMetadata={};meta.type='audio';meta.id=track.id;meta.timescale=this._timescale;meta.duration=this._duration;meta.audioSampleRate=soundRate;meta.channelCount=soundType===0?1:2;}if(soundFormat===10){// AAC
var aacData=this._parseAACAudioData(arrayBuffer,dataOffset+1,dataSize-1);if(aacData==undefined){return;}if(aacData.packetType===0){// AAC sequence header (AudioSpecificConfig)
if(meta.config){_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.w(this.TAG,'Found another AudioSpecificConfig!');}var misc=aacData.data;meta.audioSampleRate=misc.samplingRate;meta.channelCount=misc.channelCount;meta.codec=misc.codec;meta.originalCodec=misc.originalCodec;meta.config=misc.config;// The decode result of an aac sample is 1024 PCM samples
meta.refSampleDuration=1024/meta.audioSampleRate*meta.timescale;_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.v(this.TAG,'Parsed AudioSpecificConfig');if(this._isInitialMetadataDispatched()){// Non-initial metadata, force dispatch (or flush) parsed frames to remuxer
if(this._dispatch&&(this._audioTrack.length||this._videoTrack.length)){this._onDataAvailable(this._audioTrack,this._videoTrack);}}else{this._audioInitialMetadataDispatched=true;}// then notify new metadata
this._dispatch=false;this._onTrackMetadata('audio',meta);var mi=this._mediaInfo;mi.audioCodec=meta.originalCodec;mi.audioSampleRate=meta.audioSampleRate;mi.audioChannelCount=meta.channelCount;if(mi.hasVideo){if(mi.videoCodec!=null){mi.mimeType='video/x-flv; codecs="'+mi.videoCodec+','+mi.audioCodec+'"';}}else{mi.mimeType='video/x-flv; codecs="'+mi.audioCodec+'"';}if(mi.isComplete()){this._onMediaInfo(mi);}}else if(aacData.packetType===1){// AAC raw frame data
var dts=this._timestampBase+tagTimestamp;var aacSample={unit:aacData.data,length:aacData.data.byteLength,dts:dts,pts:dts};track.samples.push(aacSample);track.length+=aacData.data.length;}else{_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.e(this.TAG,"Flv: Unsupported AAC data type "+aacData.packetType);}}else if(soundFormat===2){// MP3
if(!meta.codec){// We need metadata for mp3 audio track, extract info from frame header
var misc=this._parseMP3AudioData(arrayBuffer,dataOffset+1,dataSize-1,true);if(misc==undefined){return;}meta.audioSampleRate=misc.samplingRate;meta.channelCount=misc.channelCount;meta.codec=misc.codec;meta.originalCodec=misc.originalCodec;// The decode result of an mp3 sample is 1152 PCM samples
meta.refSampleDuration=1152/meta.audioSampleRate*meta.timescale;_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.v(this.TAG,'Parsed MPEG Audio Frame Header');this._audioInitialMetadataDispatched=true;this._onTrackMetadata('audio',meta);var mi=this._mediaInfo;mi.audioCodec=meta.codec;mi.audioSampleRate=meta.audioSampleRate;mi.audioChannelCount=meta.channelCount;mi.audioDataRate=misc.bitRate;if(mi.hasVideo){if(mi.videoCodec!=null){mi.mimeType='video/x-flv; codecs="'+mi.videoCodec+','+mi.audioCodec+'"';}}else{mi.mimeType='video/x-flv; codecs="'+mi.audioCodec+'"';}if(mi.isComplete()){this._onMediaInfo(mi);}}// This packet is always a valid audio packet, extract it
var data=this._parseMP3AudioData(arrayBuffer,dataOffset+1,dataSize-1,false);if(data==undefined){return;}var dts=this._timestampBase+tagTimestamp;var mp3Sample={unit:data,length:data.byteLength,dts:dts,pts:dts};track.samples.push(mp3Sample);track.length+=data.length;}};FLVDemuxer.prototype._parseAACAudioData=function(arrayBuffer,dataOffset,dataSize){if(dataSize<=1){_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.w(this.TAG,'Flv: Invalid AAC packet, missing AACPacketType or/and Data!');return;}var result={};var array=new Uint8Array(arrayBuffer,dataOffset,dataSize);result.packetType=array[0];if(array[0]===0){result.data=this._parseAACAudioSpecificConfig(arrayBuffer,dataOffset+1,dataSize-1);}else{result.data=array.subarray(1);}return result;};FLVDemuxer.prototype._parseAACAudioSpecificConfig=function(arrayBuffer,dataOffset,dataSize){var array=new Uint8Array(arrayBuffer,dataOffset,dataSize);var config=null;/* Audio Object Type:
			           0: Null
			           1: AAC Main
			           2: AAC LC
			           3: AAC SSR (Scalable Sample Rate)
			           4: AAC LTP (Long Term Prediction)
			           5: HE-AAC / SBR (Spectral Band Replication)
			           6: AAC Scalable
			        */var audioObjectType=0;var originalAudioObjectType=0;var samplingIndex=0;var extensionSamplingIndex=null;// 5 bits
audioObjectType=originalAudioObjectType=array[0]>>>3;// 4 bits
samplingIndex=(array[0]&0x07)<<1|array[1]>>>7;if(samplingIndex<0||samplingIndex>=this._mpegSamplingRates.length){this._onError(_demux_errors_js__WEBPACK_IMPORTED_MODULE_3__.default.FORMAT_ERROR,'Flv: AAC invalid sampling frequency index!');return;}var samplingFrequence=this._mpegSamplingRates[samplingIndex];// 4 bits
var channelConfig=(array[1]&0x78)>>>3;if(channelConfig<0||channelConfig>=8){this._onError(_demux_errors_js__WEBPACK_IMPORTED_MODULE_3__.default.FORMAT_ERROR,'Flv: AAC invalid channel configuration');return;}if(audioObjectType===5){// HE-AAC?
// 4 bits
extensionSamplingIndex=(array[1]&0x07)<<1|array[2]>>>7;// 5 bits
(array[2]&0x7C)>>>2;}// workarounds for various browsers
var userAgent=self.navigator.userAgent.toLowerCase();if(userAgent.indexOf('firefox')!==-1){// firefox: use SBR (HE-AAC) if freq less than 24kHz
if(samplingIndex>=6){audioObjectType=5;config=new Array(4);extensionSamplingIndex=samplingIndex-3;}else{// use LC-AAC
audioObjectType=2;config=new Array(2);extensionSamplingIndex=samplingIndex;}}else if(userAgent.indexOf('android')!==-1){// android: always use LC-AAC
audioObjectType=2;config=new Array(2);extensionSamplingIndex=samplingIndex;}else{// for other browsers, e.g. chrome...
// Always use HE-AAC to make it easier to switch aac codec profile
audioObjectType=5;extensionSamplingIndex=samplingIndex;config=new Array(4);if(samplingIndex>=6){extensionSamplingIndex=samplingIndex-3;}else if(channelConfig===1){// Mono channel
audioObjectType=2;config=new Array(2);extensionSamplingIndex=samplingIndex;}}config[0]=audioObjectType<<3;config[0]|=(samplingIndex&0x0F)>>>1;config[1]=(samplingIndex&0x0F)<<7;config[1]|=(channelConfig&0x0F)<<3;if(audioObjectType===5){config[1]|=(extensionSamplingIndex&0x0F)>>>1;config[2]=(extensionSamplingIndex&0x01)<<7;// extended audio object type: force to 2 (LC-AAC)
config[2]|=2<<2;config[3]=0;}return{config:config,samplingRate:samplingFrequence,channelCount:channelConfig,codec:'mp4a.40.'+audioObjectType,originalCodec:'mp4a.40.'+originalAudioObjectType};};FLVDemuxer.prototype._parseMP3AudioData=function(arrayBuffer,dataOffset,dataSize,requestHeader){if(dataSize<4){_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.w(this.TAG,'Flv: Invalid MP3 packet, header missing!');return;}this._littleEndian;var array=new Uint8Array(arrayBuffer,dataOffset,dataSize);var result=null;if(requestHeader){if(array[0]!==0xFF){return;}var ver=array[1]>>>3&0x03;var layer=(array[1]&0x06)>>1;var bitrate_index=(array[2]&0xF0)>>>4;var sampling_freq_index=(array[2]&0x0C)>>>2;var channel_mode=array[3]>>>6&0x03;var channel_count=channel_mode!==3?2:1;var sample_rate=0;var bit_rate=0;var codec='mp3';switch(ver){case 0:// MPEG 2.5
sample_rate=this._mpegAudioV25SampleRateTable[sampling_freq_index];break;case 2:// MPEG 2
sample_rate=this._mpegAudioV20SampleRateTable[sampling_freq_index];break;case 3:// MPEG 1
sample_rate=this._mpegAudioV10SampleRateTable[sampling_freq_index];break;}switch(layer){case 1:// Layer 3
if(bitrate_index<this._mpegAudioL3BitRateTable.length){bit_rate=this._mpegAudioL3BitRateTable[bitrate_index];}break;case 2:// Layer 2
if(bitrate_index<this._mpegAudioL2BitRateTable.length){bit_rate=this._mpegAudioL2BitRateTable[bitrate_index];}break;case 3:// Layer 1
if(bitrate_index<this._mpegAudioL1BitRateTable.length){bit_rate=this._mpegAudioL1BitRateTable[bitrate_index];}break;}result={bitRate:bit_rate,samplingRate:sample_rate,channelCount:channel_count,codec:codec,originalCodec:codec};}else{result=array;}return result;};FLVDemuxer.prototype._parseVideoData=function(arrayBuffer,dataOffset,dataSize,tagTimestamp,tagPosition){if(dataSize<=1){_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.w(this.TAG,'Flv: Invalid video packet, missing VideoData payload!');return;}if(this._hasVideoFlagOverrided===true&&this._hasVideo===false){// If hasVideo: false indicated explicitly in MediaDataSource,
// Ignore all the video packets
return;}var spec=new Uint8Array(arrayBuffer,dataOffset,dataSize)[0];var frameType=(spec&240)>>>4;var codecId=spec&15;if(codecId!==7){this._onError(_demux_errors_js__WEBPACK_IMPORTED_MODULE_3__.default.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+codecId);return;}this._parseAVCVideoPacket(arrayBuffer,dataOffset+1,dataSize-1,tagTimestamp,tagPosition,frameType);};FLVDemuxer.prototype._parseAVCVideoPacket=function(arrayBuffer,dataOffset,dataSize,tagTimestamp,tagPosition,frameType){if(dataSize<4){_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.w(this.TAG,'Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime');return;}var le=this._littleEndian;var v=new DataView(arrayBuffer,dataOffset,dataSize);var packetType=v.getUint8(0);var cts_unsigned=v.getUint32(0,!le)&0x00FFFFFF;var cts=cts_unsigned<<8>>8;// convert to 24-bit signed int
if(packetType===0){// AVCDecoderConfigurationRecord
this._parseAVCDecoderConfigurationRecord(arrayBuffer,dataOffset+4,dataSize-4);}else if(packetType===1){// One or more Nalus
this._parseAVCVideoData(arrayBuffer,dataOffset+4,dataSize-4,tagTimestamp,tagPosition,frameType,cts);}else if(packetType===2);else{this._onError(_demux_errors_js__WEBPACK_IMPORTED_MODULE_3__.default.FORMAT_ERROR,"Flv: Invalid video packet type "+packetType);return;}};FLVDemuxer.prototype._parseAVCDecoderConfigurationRecord=function(arrayBuffer,dataOffset,dataSize){if(dataSize<7){_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.w(this.TAG,'Flv: Invalid AVCDecoderConfigurationRecord, lack of data!');return;}var meta=this._videoMetadata;var track=this._videoTrack;var le=this._littleEndian;var v=new DataView(arrayBuffer,dataOffset,dataSize);if(!meta){if(this._hasVideo===false&&this._hasVideoFlagOverrided===false){this._hasVideo=true;this._mediaInfo.hasVideo=true;}meta=this._videoMetadata={};meta.type='video';meta.id=track.id;meta.timescale=this._timescale;meta.duration=this._duration;}else{if(typeof meta.avcc!=='undefined'){_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.w(this.TAG,'Found another AVCDecoderConfigurationRecord!');}}var version=v.getUint8(0);// configurationVersion
var avcProfile=v.getUint8(1);// avcProfileIndication
v.getUint8(2);// profile_compatibility
v.getUint8(3);// AVCLevelIndication
if(version!==1||avcProfile===0){this._onError(_demux_errors_js__WEBPACK_IMPORTED_MODULE_3__.default.FORMAT_ERROR,'Flv: Invalid AVCDecoderConfigurationRecord');return;}this._naluLengthSize=(v.getUint8(4)&3)+1;// lengthSizeMinusOne
if(this._naluLengthSize!==3&&this._naluLengthSize!==4){// holy shit!!!
this._onError(_demux_errors_js__WEBPACK_IMPORTED_MODULE_3__.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));return;}var spsCount=v.getUint8(5)&31;// numOfSequenceParameterSets
if(spsCount===0){this._onError(_demux_errors_js__WEBPACK_IMPORTED_MODULE_3__.default.FORMAT_ERROR,'Flv: Invalid AVCDecoderConfigurationRecord: No SPS');return;}else if(spsCount>1){_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+spsCount);}var offset=6;for(var i=0;i<spsCount;i++){var len=v.getUint16(offset,!le);// sequenceParameterSetLength
offset+=2;if(len===0){continue;}// Notice: Nalu without startcode header (00 00 00 01)
var sps=new Uint8Array(arrayBuffer,dataOffset+offset,len);offset+=len;var config=_sps_parser_js__WEBPACK_IMPORTED_MODULE_2__.default.parseSPS(sps);if(i!==0){// ignore other sps's config
continue;}meta.codecWidth=config.codec_size.width;meta.codecHeight=config.codec_size.height;meta.presentWidth=config.present_size.width;meta.presentHeight=config.present_size.height;meta.profile=config.profile_string;meta.level=config.level_string;meta.bitDepth=config.bit_depth;meta.chromaFormat=config.chroma_format;meta.sarRatio=config.sar_ratio;meta.frameRate=config.frame_rate;if(config.frame_rate.fixed===false||config.frame_rate.fps_num===0||config.frame_rate.fps_den===0){meta.frameRate=this._referenceFrameRate;}var fps_den=meta.frameRate.fps_den;var fps_num=meta.frameRate.fps_num;meta.refSampleDuration=meta.timescale*(fps_den/fps_num);var codecArray=sps.subarray(1,4);var codecString='avc1.';for(var j=0;j<3;j++){var h=codecArray[j].toString(16);if(h.length<2){h='0'+h;}codecString+=h;}meta.codec=codecString;var mi=this._mediaInfo;mi.width=meta.codecWidth;mi.height=meta.codecHeight;mi.fps=meta.frameRate.fps;mi.profile=meta.profile;mi.level=meta.level;mi.refFrames=config.ref_frames;mi.chromaFormat=config.chroma_format_string;mi.sarNum=meta.sarRatio.width;mi.sarDen=meta.sarRatio.height;mi.videoCodec=codecString;if(mi.hasAudio){if(mi.audioCodec!=null){mi.mimeType='video/x-flv; codecs="'+mi.videoCodec+','+mi.audioCodec+'"';}}else{mi.mimeType='video/x-flv; codecs="'+mi.videoCodec+'"';}if(mi.isComplete()){this._onMediaInfo(mi);}}var ppsCount=v.getUint8(offset);// numOfPictureParameterSets
if(ppsCount===0){this._onError(_demux_errors_js__WEBPACK_IMPORTED_MODULE_3__.default.FORMAT_ERROR,'Flv: Invalid AVCDecoderConfigurationRecord: No PPS');return;}else if(ppsCount>1){_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+ppsCount);}offset++;for(var i=0;i<ppsCount;i++){var len=v.getUint16(offset,!le);// pictureParameterSetLength
offset+=2;if(len===0){continue;}// pps is useless for extracting video information
offset+=len;}meta.avcc=new Uint8Array(dataSize);meta.avcc.set(new Uint8Array(arrayBuffer,dataOffset,dataSize),0);_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.v(this.TAG,'Parsed AVCDecoderConfigurationRecord');if(this._isInitialMetadataDispatched()){// flush parsed frames
if(this._dispatch&&(this._audioTrack.length||this._videoTrack.length)){this._onDataAvailable(this._audioTrack,this._videoTrack);}}else{this._videoInitialMetadataDispatched=true;}// notify new metadata
this._dispatch=false;this._onTrackMetadata('video',meta);};FLVDemuxer.prototype._parseAVCVideoData=function(arrayBuffer,dataOffset,dataSize,tagTimestamp,tagPosition,frameType,cts){var le=this._littleEndian;var v=new DataView(arrayBuffer,dataOffset,dataSize);var units=[],length=0;var offset=0;var lengthSize=this._naluLengthSize;var dts=this._timestampBase+tagTimestamp;var keyframe=frameType===1;// from FLV Frame Type constants
while(offset<dataSize){if(offset+4>=dataSize){_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.w(this.TAG,"Malformed Nalu near timestamp "+dts+", offset = "+offset+", dataSize = "+dataSize);break;// data not enough for next Nalu
}// Nalu with length-header (AVC1)
var naluSize=v.getUint32(offset,!le);// Big-Endian read
if(lengthSize===3){naluSize>>>=8;}if(naluSize>dataSize-lengthSize){_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.w(this.TAG,"Malformed Nalus near timestamp "+dts+", NaluSize > DataSize!");return;}var unitType=v.getUint8(offset+lengthSize)&0x1F;if(unitType===5){// IDR
keyframe=true;}var data=new Uint8Array(arrayBuffer,dataOffset+offset,lengthSize+naluSize);var unit={type:unitType,data:data};units.push(unit);length+=data.byteLength;offset+=lengthSize+naluSize;}if(units.length){var track=this._videoTrack;var avcSample={units:units,length:length,isKeyframe:keyframe,dts:dts,cts:cts,pts:dts+cts};if(keyframe){avcSample.fileposition=tagPosition;}track.samples.push(avcSample);track.length+=length;}};return FLVDemuxer;}();/* harmony default export */__webpack_exports__["default"]=FLVDemuxer;/***/},/***/"./src/demux/sps-parser.js":/*!*********************************!*\
			  !*** ./src/demux/sps-parser.js ***!
			  \*********************************/ /***/function srcDemuxSpsParserJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var _exp_golomb_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./exp-golomb.js */"./src/demux/exp-golomb.js");/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */var SPSParser=/** @class */function(){function SPSParser(){}SPSParser._ebsp2rbsp=function(uint8array){var src=uint8array;var src_length=src.byteLength;var dst=new Uint8Array(src_length);var dst_idx=0;for(var i=0;i<src_length;i++){if(i>=2){// Unescape: Skip 0x03 after 00 00
if(src[i]===0x03&&src[i-1]===0x00&&src[i-2]===0x00){continue;}}dst[dst_idx]=src[i];dst_idx++;}return new Uint8Array(dst.buffer,0,dst_idx);};SPSParser.parseSPS=function(uint8array){var rbsp=SPSParser._ebsp2rbsp(uint8array);var gb=new _exp_golomb_js__WEBPACK_IMPORTED_MODULE_0__.default(rbsp);gb.readByte();var profile_idc=gb.readByte();// profile_idc
gb.readByte();// constraint_set_flags[5] + reserved_zero[3]
var level_idc=gb.readByte();// level_idc
gb.readUEG();// seq_parameter_set_id
var profile_string=SPSParser.getProfileString(profile_idc);var level_string=SPSParser.getLevelString(level_idc);var chroma_format_idc=1;var chroma_format=420;var chroma_format_table=[0,420,422,444];var bit_depth=8;if(profile_idc===100||profile_idc===110||profile_idc===122||profile_idc===244||profile_idc===44||profile_idc===83||profile_idc===86||profile_idc===118||profile_idc===128||profile_idc===138||profile_idc===144){chroma_format_idc=gb.readUEG();if(chroma_format_idc===3){gb.readBits(1);// separate_colour_plane_flag
}if(chroma_format_idc<=3){chroma_format=chroma_format_table[chroma_format_idc];}bit_depth=gb.readUEG()+8;// bit_depth_luma_minus8
gb.readUEG();// bit_depth_chroma_minus8
gb.readBits(1);// qpprime_y_zero_transform_bypass_flag
if(gb.readBool()){// seq_scaling_matrix_present_flag
var scaling_list_count=chroma_format_idc!==3?8:12;for(var i=0;i<scaling_list_count;i++){if(gb.readBool()){// seq_scaling_list_present_flag
if(i<6){SPSParser._skipScalingList(gb,16);}else{SPSParser._skipScalingList(gb,64);}}}}}gb.readUEG();// log2_max_frame_num_minus4
var pic_order_cnt_type=gb.readUEG();if(pic_order_cnt_type===0){gb.readUEG();// log2_max_pic_order_cnt_lsb_minus_4
}else if(pic_order_cnt_type===1){gb.readBits(1);// delta_pic_order_always_zero_flag
gb.readSEG();// offset_for_non_ref_pic
gb.readSEG();// offset_for_top_to_bottom_field
var num_ref_frames_in_pic_order_cnt_cycle=gb.readUEG();for(var i=0;i<num_ref_frames_in_pic_order_cnt_cycle;i++){gb.readSEG();// offset_for_ref_frame
}}var ref_frames=gb.readUEG();// max_num_ref_frames
gb.readBits(1);// gaps_in_frame_num_value_allowed_flag
var pic_width_in_mbs_minus1=gb.readUEG();var pic_height_in_map_units_minus1=gb.readUEG();var frame_mbs_only_flag=gb.readBits(1);if(frame_mbs_only_flag===0){gb.readBits(1);// mb_adaptive_frame_field_flag
}gb.readBits(1);// direct_8x8_inference_flag
var frame_crop_left_offset=0;var frame_crop_right_offset=0;var frame_crop_top_offset=0;var frame_crop_bottom_offset=0;var frame_cropping_flag=gb.readBool();if(frame_cropping_flag){frame_crop_left_offset=gb.readUEG();frame_crop_right_offset=gb.readUEG();frame_crop_top_offset=gb.readUEG();frame_crop_bottom_offset=gb.readUEG();}var sar_width=1,sar_height=1;var fps=0,fps_fixed=true,fps_num=0,fps_den=0;var vui_parameters_present_flag=gb.readBool();if(vui_parameters_present_flag){if(gb.readBool()){// aspect_ratio_info_present_flag
var aspect_ratio_idc=gb.readByte();var sar_w_table=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2];var sar_h_table=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];if(aspect_ratio_idc>0&&aspect_ratio_idc<16){sar_width=sar_w_table[aspect_ratio_idc-1];sar_height=sar_h_table[aspect_ratio_idc-1];}else if(aspect_ratio_idc===255){sar_width=gb.readByte()<<8|gb.readByte();sar_height=gb.readByte()<<8|gb.readByte();}}if(gb.readBool()){// overscan_info_present_flag
gb.readBool();// overscan_appropriate_flag
}if(gb.readBool()){// video_signal_type_present_flag
gb.readBits(4);// video_format & video_full_range_flag
if(gb.readBool()){// colour_description_present_flag
gb.readBits(24);// colour_primaries & transfer_characteristics & matrix_coefficients
}}if(gb.readBool()){// chroma_loc_info_present_flag
gb.readUEG();// chroma_sample_loc_type_top_field
gb.readUEG();// chroma_sample_loc_type_bottom_field
}if(gb.readBool()){// timing_info_present_flag
var num_units_in_tick=gb.readBits(32);var time_scale=gb.readBits(32);fps_fixed=gb.readBool();// fixed_frame_rate_flag
fps_num=time_scale;fps_den=num_units_in_tick*2;fps=fps_num/fps_den;}}var sarScale=1;if(sar_width!==1||sar_height!==1){sarScale=sar_width/sar_height;}var crop_unit_x=0,crop_unit_y=0;if(chroma_format_idc===0){crop_unit_x=1;crop_unit_y=2-frame_mbs_only_flag;}else{var sub_wc=chroma_format_idc===3?1:2;var sub_hc=chroma_format_idc===1?2:1;crop_unit_x=sub_wc;crop_unit_y=sub_hc*(2-frame_mbs_only_flag);}var codec_width=(pic_width_in_mbs_minus1+1)*16;var codec_height=(2-frame_mbs_only_flag)*((pic_height_in_map_units_minus1+1)*16);codec_width-=(frame_crop_left_offset+frame_crop_right_offset)*crop_unit_x;codec_height-=(frame_crop_top_offset+frame_crop_bottom_offset)*crop_unit_y;var present_width=Math.ceil(codec_width*sarScale);gb.destroy();gb=null;return{profile_string:profile_string,level_string:level_string,bit_depth:bit_depth,ref_frames:ref_frames,chroma_format:chroma_format,chroma_format_string:SPSParser.getChromaFormatString(chroma_format),frame_rate:{fixed:fps_fixed,fps:fps,fps_den:fps_den,fps_num:fps_num},sar_ratio:{width:sar_width,height:sar_height},codec_size:{width:codec_width,height:codec_height},present_size:{width:present_width,height:codec_height}};};SPSParser._skipScalingList=function(gb,count){var last_scale=8,next_scale=8;var delta_scale=0;for(var i=0;i<count;i++){if(next_scale!==0){delta_scale=gb.readSEG();next_scale=(last_scale+delta_scale+256)%256;}last_scale=next_scale===0?last_scale:next_scale;}};SPSParser.getProfileString=function(profile_idc){switch(profile_idc){case 66:return'Baseline';case 77:return'Main';case 88:return'Extended';case 100:return'High';case 110:return'High10';case 122:return'High422';case 244:return'High444';default:return'Unknown';}};SPSParser.getLevelString=function(level_idc){return(level_idc/10).toFixed(1);};SPSParser.getChromaFormatString=function(chroma){switch(chroma){case 420:return'4:2:0';case 422:return'4:2:2';case 444:return'4:4:4';default:return'Unknown';}};return SPSParser;}();/* harmony default export */__webpack_exports__["default"]=SPSParser;/***/},/***/"./src/flv.js":/*!********************!*\
			  !*** ./src/flv.js ***!
			  \********************/ /***/function srcFlvJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var _utils_polyfill_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./utils/polyfill.js */"./src/utils/polyfill.js");/* harmony import */var _core_features_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ./core/features.js */"./src/core/features.js");/* harmony import */var _io_loader_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ./io/loader.js */"./src/io/loader.js");/* harmony import */var _player_flv_player_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ./player/flv-player.js */"./src/player/flv-player.js");/* harmony import */var _player_native_player_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(/*! ./player/native-player.js */"./src/player/native-player.js");/* harmony import */var _player_player_events_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(/*! ./player/player-events.js */"./src/player/player-events.js");/* harmony import */var _player_player_errors_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(/*! ./player/player-errors.js */"./src/player/player-errors.js");/* harmony import */var _utils_logging_control_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(/*! ./utils/logging-control.js */"./src/utils/logging-control.js");/* harmony import */var _utils_exception_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(/*! ./utils/exception.js */"./src/utils/exception.js");/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */ // here are all the interfaces
// install polyfills
_utils_polyfill_js__WEBPACK_IMPORTED_MODULE_0__.default.install();// factory method
function createPlayer(mediaDataSource,optionalConfig){var mds=mediaDataSource;if(mds==null||_typeof3(mds)!=='object'){throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_8__.InvalidArgumentException('MediaDataSource must be an javascript object!');}if(!mds.hasOwnProperty('type')){throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_8__.InvalidArgumentException('MediaDataSource must has type field to indicate video file type!');}switch(mds.type){case'flv':return new _player_flv_player_js__WEBPACK_IMPORTED_MODULE_3__.default(mds,optionalConfig);default:return new _player_native_player_js__WEBPACK_IMPORTED_MODULE_4__.default(mds,optionalConfig);}}// feature detection
function isSupported(){return _core_features_js__WEBPACK_IMPORTED_MODULE_1__.default.supportMSEH264Playback();}function getFeatureList(){return _core_features_js__WEBPACK_IMPORTED_MODULE_1__.default.getFeatureList();}// interfaces
var flvjs={};flvjs.createPlayer=createPlayer;flvjs.isSupported=isSupported;flvjs.getFeatureList=getFeatureList;flvjs.BaseLoader=_io_loader_js__WEBPACK_IMPORTED_MODULE_2__.BaseLoader;flvjs.LoaderStatus=_io_loader_js__WEBPACK_IMPORTED_MODULE_2__.LoaderStatus;flvjs.LoaderErrors=_io_loader_js__WEBPACK_IMPORTED_MODULE_2__.LoaderErrors;flvjs.Events=_player_player_events_js__WEBPACK_IMPORTED_MODULE_5__.default;flvjs.ErrorTypes=_player_player_errors_js__WEBPACK_IMPORTED_MODULE_6__.ErrorTypes;flvjs.ErrorDetails=_player_player_errors_js__WEBPACK_IMPORTED_MODULE_6__.ErrorDetails;flvjs.FlvPlayer=_player_flv_player_js__WEBPACK_IMPORTED_MODULE_3__.default;flvjs.NativePlayer=_player_native_player_js__WEBPACK_IMPORTED_MODULE_4__.default;flvjs.LoggingControl=_utils_logging_control_js__WEBPACK_IMPORTED_MODULE_7__.default;Object.defineProperty(flvjs,'version',{enumerable:true,get:function get(){// replace by webpack.DefinePlugin
return"1.6.2";}});/* harmony default export */__webpack_exports__["default"]=flvjs;/***/},/***/"./src/index.js":/*!**********************!*\
			  !*** ./src/index.js ***!
			  \**********************/ /***/function srcIndexJs(module,__unused_webpack_exports,__webpack_require__){// entry/index file
// make it compatible with browserify's umd wrapper
module.exports=__webpack_require__(/*! ./flv.js */"./src/flv.js").default;/***/},/***/"./src/io/fetch-stream-loader.js":/*!***************************************!*\
			  !*** ./src/io/fetch-stream-loader.js ***!
			  \***************************************/ /***/function srcIoFetchStreamLoaderJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var _utils_browser_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../utils/browser.js */"./src/utils/browser.js");/* harmony import */var _loader_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ./loader.js */"./src/io/loader.js");/* harmony import */var _utils_exception_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../utils/exception.js */"./src/utils/exception.js");/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */var __extends=function(){var _extendStatics=function extendStatics(d,b){_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;}||function(d,b){for(var p in b){if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p];}};return _extendStatics(d,b);};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");_extendStatics(d,b);function __(){this.constructor=d;}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};}();/* fetch + stream IO loader. Currently working on chrome 43+.
			 * fetch provides a better alternative http API to XMLHttpRequest
			 *
			 * fetch spec   https://fetch.spec.whatwg.org/
			 * stream spec  https://streams.spec.whatwg.org/
			 */var FetchStreamLoader=/** @class */function(_super){__extends(FetchStreamLoader,_super);function FetchStreamLoader(seekHandler,config){var _this=_super.call(this,'fetch-stream-loader')||this;_this.TAG='FetchStreamLoader';_this._seekHandler=seekHandler;_this._config=config;_this._needStash=true;_this._requestAbort=false;_this._contentLength=null;_this._receivedLength=0;return _this;}FetchStreamLoader.isSupported=function(){try{// fetch + stream is broken on Microsoft Edge. Disable before build 15048.
// see https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/8196907/
// Fixed in Jan 10, 2017. Build 15048+ removed from blacklist.
var isWorkWellEdge=_utils_browser_js__WEBPACK_IMPORTED_MODULE_0__.default.msedge&&_utils_browser_js__WEBPACK_IMPORTED_MODULE_0__.default.version.minor>=15048;var browserNotBlacklisted=_utils_browser_js__WEBPACK_IMPORTED_MODULE_0__.default.msedge?isWorkWellEdge:true;return self.fetch&&self.ReadableStream&&browserNotBlacklisted;}catch(e){return false;}};FetchStreamLoader.prototype.destroy=function(){if(this.isWorking()){this.abort();}_super.prototype.destroy.call(this);};FetchStreamLoader.prototype.open=function(dataSource,range){var _this=this;this._dataSource=dataSource;this._range=range;var sourceURL=dataSource.url;if(this._config.reuseRedirectedURL&&dataSource.redirectedURL!=undefined){sourceURL=dataSource.redirectedURL;}var seekConfig=this._seekHandler.getConfig(sourceURL,range);var headers=new self.Headers();if(_typeof3(seekConfig.headers)==='object'){var configHeaders=seekConfig.headers;for(var key in configHeaders){if(configHeaders.hasOwnProperty(key)){headers.append(key,configHeaders[key]);}}}var params={method:'GET',headers:headers,mode:'cors',cache:'default',// The default policy of Fetch API in the whatwg standard
// Safari incorrectly indicates 'no-referrer' as default policy, fuck it
referrerPolicy:'no-referrer-when-downgrade'};// add additional headers
if(_typeof3(this._config.headers)==='object'){for(var key in this._config.headers){headers.append(key,this._config.headers[key]);}}// cors is enabled by default
if(dataSource.cors===false){// no-cors means 'disregard cors policy', which can only be used in ServiceWorker
params.mode='same-origin';}// withCredentials is disabled by default
if(dataSource.withCredentials){params.credentials='include';}// referrerPolicy from config
if(dataSource.referrerPolicy){params.referrerPolicy=dataSource.referrerPolicy;}// add abort controller, by wmlgl 2019-5-10 12:21:27
if(self.AbortController){this._abortController=new self.AbortController();params.signal=this._abortController.signal;}this._status=_loader_js__WEBPACK_IMPORTED_MODULE_1__.LoaderStatus.kConnecting;self.fetch(seekConfig.url,params).then(function(res){if(_this._requestAbort){_this._status=_loader_js__WEBPACK_IMPORTED_MODULE_1__.LoaderStatus.kIdle;res.body.cancel();return;}if(res.ok&&res.status>=200&&res.status<=299){if(res.url!==seekConfig.url){if(_this._onURLRedirect){var redirectedURL=_this._seekHandler.removeURLParameters(res.url);_this._onURLRedirect(redirectedURL);}}var lengthHeader=res.headers.get('Content-Length');if(lengthHeader!=null){_this._contentLength=parseInt(lengthHeader);if(_this._contentLength!==0){if(_this._onContentLengthKnown){_this._onContentLengthKnown(_this._contentLength);}}}return _this._pump.call(_this,res.body.getReader());}else{_this._status=_loader_js__WEBPACK_IMPORTED_MODULE_1__.LoaderStatus.kError;if(_this._onError){_this._onError(_loader_js__WEBPACK_IMPORTED_MODULE_1__.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:res.status,msg:res.statusText});}else{throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_2__.RuntimeException('FetchStreamLoader: Http code invalid, '+res.status+' '+res.statusText);}}}).catch(function(e){if(_this._abortController&&_this._abortController.signal.aborted){return;}_this._status=_loader_js__WEBPACK_IMPORTED_MODULE_1__.LoaderStatus.kError;if(_this._onError){_this._onError(_loader_js__WEBPACK_IMPORTED_MODULE_1__.LoaderErrors.EXCEPTION,{code:-1,msg:e.message});}else{throw e;}});};FetchStreamLoader.prototype.abort=function(){this._requestAbort=true;if(this._status!==_loader_js__WEBPACK_IMPORTED_MODULE_1__.LoaderStatus.kBuffering||!_utils_browser_js__WEBPACK_IMPORTED_MODULE_0__.default.chrome){// Chrome may throw Exception-like things here, avoid using if is buffering
if(this._abortController){try{this._abortController.abort();}catch(e){}}}};FetchStreamLoader.prototype._pump=function(reader){var _this=this;return reader.read().then(function(result){if(result.done){// First check received length
if(_this._contentLength!==null&&_this._receivedLength<_this._contentLength){// Report Early-EOF
_this._status=_loader_js__WEBPACK_IMPORTED_MODULE_1__.LoaderStatus.kError;var type=_loader_js__WEBPACK_IMPORTED_MODULE_1__.LoaderErrors.EARLY_EOF;var info={code:-1,msg:'Fetch stream meet Early-EOF'};if(_this._onError){_this._onError(type,info);}else{throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_2__.RuntimeException(info.msg);}}else{// OK. Download complete
_this._status=_loader_js__WEBPACK_IMPORTED_MODULE_1__.LoaderStatus.kComplete;if(_this._onComplete){_this._onComplete(_this._range.from,_this._range.from+_this._receivedLength-1);}}}else{if(_this._abortController&&_this._abortController.signal.aborted){_this._status=_loader_js__WEBPACK_IMPORTED_MODULE_1__.LoaderStatus.kComplete;return;}else if(_this._requestAbort===true){_this._status=_loader_js__WEBPACK_IMPORTED_MODULE_1__.LoaderStatus.kComplete;return reader.cancel();}_this._status=_loader_js__WEBPACK_IMPORTED_MODULE_1__.LoaderStatus.kBuffering;var chunk=result.value.buffer;var byteStart=_this._range.from+_this._receivedLength;_this._receivedLength+=chunk.byteLength;if(_this._onDataArrival){_this._onDataArrival(chunk,byteStart,_this._receivedLength);}_this._pump(reader);}}).catch(function(e){if(_this._abortController&&_this._abortController.signal.aborted){_this._status=_loader_js__WEBPACK_IMPORTED_MODULE_1__.LoaderStatus.kComplete;return;}if(e.code===11&&_utils_browser_js__WEBPACK_IMPORTED_MODULE_0__.default.msedge){// InvalidStateError on Microsoft Edge
// Workaround: Edge may throw InvalidStateError after ReadableStreamReader.cancel() call
// Ignore the unknown exception.
// Related issue: https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/11265202/
return;}_this._status=_loader_js__WEBPACK_IMPORTED_MODULE_1__.LoaderStatus.kError;var type=0;var info=null;if((e.code===19||e.message==='network error')&&(// NETWORK_ERR
_this._contentLength===null||_this._contentLength!==null&&_this._receivedLength<_this._contentLength)){type=_loader_js__WEBPACK_IMPORTED_MODULE_1__.LoaderErrors.EARLY_EOF;info={code:e.code,msg:'Fetch stream meet Early-EOF'};}else{type=_loader_js__WEBPACK_IMPORTED_MODULE_1__.LoaderErrors.EXCEPTION;info={code:e.code,msg:e.message};}if(_this._onError){_this._onError(type,info);}else{throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_2__.RuntimeException(info.msg);}});};return FetchStreamLoader;}(_loader_js__WEBPACK_IMPORTED_MODULE_1__.BaseLoader);/* harmony default export */__webpack_exports__["default"]=FetchStreamLoader;/***/},/***/"./src/io/io-controller.js":/*!*********************************!*\
			  !*** ./src/io/io-controller.js ***!
			  \*********************************/ /***/function srcIoIoControllerJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var _utils_logger_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../utils/logger.js */"./src/utils/logger.js");/* harmony import */var _speed_sampler_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ./speed-sampler.js */"./src/io/speed-sampler.js");/* harmony import */var _loader_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ./loader.js */"./src/io/loader.js");/* harmony import */var _fetch_stream_loader_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ./fetch-stream-loader.js */"./src/io/fetch-stream-loader.js");/* harmony import */var _xhr_moz_chunked_loader_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(/*! ./xhr-moz-chunked-loader.js */"./src/io/xhr-moz-chunked-loader.js");/* harmony import */var _xhr_range_loader_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(/*! ./xhr-range-loader.js */"./src/io/xhr-range-loader.js");/* harmony import */var _websocket_loader_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(/*! ./websocket-loader.js */"./src/io/websocket-loader.js");/* harmony import */var _range_seek_handler_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(/*! ./range-seek-handler.js */"./src/io/range-seek-handler.js");/* harmony import */var _param_seek_handler_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(/*! ./param-seek-handler.js */"./src/io/param-seek-handler.js");/* harmony import */var _utils_exception_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(/*! ../utils/exception.js */"./src/utils/exception.js");/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */ /**
			 * DataSource: {
			 *     url: string,
			 *     filesize: number,
			 *     cors: boolean,
			 *     withCredentials: boolean
			 * }
			 *
			 */ // Manage IO Loaders
var IOController=/** @class */function(){function IOController(dataSource,config,extraData){this.TAG='IOController';this._config=config;this._extraData=extraData;this._stashInitialSize=1024*384;// default initial size: 384KB
if(config.stashInitialSize!=undefined&&config.stashInitialSize>0){// apply from config
this._stashInitialSize=config.stashInitialSize;}this._stashUsed=0;this._stashSize=this._stashInitialSize;this._bufferSize=1024*1024*3;// initial size: 3MB
this._stashBuffer=new ArrayBuffer(this._bufferSize);this._stashByteStart=0;this._enableStash=true;if(config.enableStashBuffer===false){this._enableStash=false;}this._loader=null;this._loaderClass=null;this._seekHandler=null;this._dataSource=dataSource;this._isWebSocketURL=/wss?:\/\/(.+?)/.test(dataSource.url);this._refTotalLength=dataSource.filesize?dataSource.filesize:null;this._totalLength=this._refTotalLength;this._fullRequestFlag=false;this._currentRange=null;this._redirectedURL=null;this._speedNormalized=0;this._speedSampler=new _speed_sampler_js__WEBPACK_IMPORTED_MODULE_1__.default();this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096];this._isEarlyEofReconnecting=false;this._paused=false;this._resumeFrom=0;this._onDataArrival=null;this._onSeeked=null;this._onError=null;this._onComplete=null;this._onRedirect=null;this._onRecoveredEarlyEof=null;this._selectSeekHandler();this._selectLoader();this._createLoader();}IOController.prototype.destroy=function(){if(this._loader.isWorking()){this._loader.abort();}this._loader.destroy();this._loader=null;this._loaderClass=null;this._dataSource=null;this._stashBuffer=null;this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0;this._currentRange=null;this._speedSampler=null;this._isEarlyEofReconnecting=false;this._onDataArrival=null;this._onSeeked=null;this._onError=null;this._onComplete=null;this._onRedirect=null;this._onRecoveredEarlyEof=null;this._extraData=null;};IOController.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused;};IOController.prototype.isPaused=function(){return this._paused;};Object.defineProperty(IOController.prototype,"status",{get:function get(){return this._loader.status;},enumerable:false,configurable:true});Object.defineProperty(IOController.prototype,"extraData",{get:function get(){return this._extraData;},set:function set(data){this._extraData=data;},enumerable:false,configurable:true});Object.defineProperty(IOController.prototype,"onDataArrival",{// prototype: function onDataArrival(chunks: ArrayBuffer, byteStart: number): number
get:function get(){return this._onDataArrival;},set:function set(callback){this._onDataArrival=callback;},enumerable:false,configurable:true});Object.defineProperty(IOController.prototype,"onSeeked",{get:function get(){return this._onSeeked;},set:function set(callback){this._onSeeked=callback;},enumerable:false,configurable:true});Object.defineProperty(IOController.prototype,"onError",{// prototype: function onError(type: number, info: {code: number, msg: string}): void
get:function get(){return this._onError;},set:function set(callback){this._onError=callback;},enumerable:false,configurable:true});Object.defineProperty(IOController.prototype,"onComplete",{get:function get(){return this._onComplete;},set:function set(callback){this._onComplete=callback;},enumerable:false,configurable:true});Object.defineProperty(IOController.prototype,"onRedirect",{get:function get(){return this._onRedirect;},set:function set(callback){this._onRedirect=callback;},enumerable:false,configurable:true});Object.defineProperty(IOController.prototype,"onRecoveredEarlyEof",{get:function get(){return this._onRecoveredEarlyEof;},set:function set(callback){this._onRecoveredEarlyEof=callback;},enumerable:false,configurable:true});Object.defineProperty(IOController.prototype,"currentURL",{get:function get(){return this._dataSource.url;},enumerable:false,configurable:true});Object.defineProperty(IOController.prototype,"hasRedirect",{get:function get(){return this._redirectedURL!=null||this._dataSource.redirectedURL!=undefined;},enumerable:false,configurable:true});Object.defineProperty(IOController.prototype,"currentRedirectedURL",{get:function get(){return this._redirectedURL||this._dataSource.redirectedURL;},enumerable:false,configurable:true});Object.defineProperty(IOController.prototype,"currentSpeed",{// in KB/s
get:function get(){if(this._loaderClass===_xhr_range_loader_js__WEBPACK_IMPORTED_MODULE_5__.default){// SpeedSampler is inaccuracy if loader is RangeLoader
return this._loader.currentSpeed;}return this._speedSampler.lastSecondKBps;},enumerable:false,configurable:true});Object.defineProperty(IOController.prototype,"loaderType",{get:function get(){return this._loader.type;},enumerable:false,configurable:true});IOController.prototype._selectSeekHandler=function(){var config=this._config;if(config.seekType==='range'){this._seekHandler=new _range_seek_handler_js__WEBPACK_IMPORTED_MODULE_7__.default(this._config.rangeLoadZeroStart);}else if(config.seekType==='param'){var paramStart=config.seekParamStart||'bstart';var paramEnd=config.seekParamEnd||'bend';this._seekHandler=new _param_seek_handler_js__WEBPACK_IMPORTED_MODULE_8__.default(paramStart,paramEnd);}else if(config.seekType==='custom'){if(typeof config.customSeekHandler!=='function'){throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_9__.InvalidArgumentException('Custom seekType specified in config but invalid customSeekHandler!');}this._seekHandler=new config.customSeekHandler();}else{throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_9__.InvalidArgumentException("Invalid seekType in config: "+config.seekType);}};IOController.prototype._selectLoader=function(){if(this._config.customLoader!=null){this._loaderClass=this._config.customLoader;}else if(this._isWebSocketURL){this._loaderClass=_websocket_loader_js__WEBPACK_IMPORTED_MODULE_6__.default;}else if(_fetch_stream_loader_js__WEBPACK_IMPORTED_MODULE_3__.default.isSupported()){this._loaderClass=_fetch_stream_loader_js__WEBPACK_IMPORTED_MODULE_3__.default;}else if(_xhr_moz_chunked_loader_js__WEBPACK_IMPORTED_MODULE_4__.default.isSupported()){this._loaderClass=_xhr_moz_chunked_loader_js__WEBPACK_IMPORTED_MODULE_4__.default;}else if(_xhr_range_loader_js__WEBPACK_IMPORTED_MODULE_5__.default.isSupported()){this._loaderClass=_xhr_range_loader_js__WEBPACK_IMPORTED_MODULE_5__.default;}else{throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_9__.RuntimeException('Your browser doesn\'t support xhr with arraybuffer responseType!');}};IOController.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config);if(this._loader.needStashBuffer===false){this._enableStash=false;}this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this);this._loader.onURLRedirect=this._onURLRedirect.bind(this);this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this);this._loader.onComplete=this._onLoaderComplete.bind(this);this._loader.onError=this._onLoaderError.bind(this);};IOController.prototype.open=function(optionalFrom){this._currentRange={from:0,to:-1};if(optionalFrom){this._currentRange.from=optionalFrom;}this._speedSampler.reset();if(!optionalFrom){this._fullRequestFlag=true;}this._loader.open(this._dataSource,Object.assign({},this._currentRange));};IOController.prototype.abort=function(){this._loader.abort();if(this._paused){this._paused=false;this._resumeFrom=0;}};IOController.prototype.pause=function(){if(this.isWorking()){this._loader.abort();if(this._stashUsed!==0){this._resumeFrom=this._stashByteStart;this._currentRange.to=this._stashByteStart-1;}else{this._resumeFrom=this._currentRange.to+1;}this._stashUsed=0;this._stashByteStart=0;this._paused=true;}};IOController.prototype.resume=function(){if(this._paused){this._paused=false;var bytes=this._resumeFrom;this._resumeFrom=0;this._internalSeek(bytes,true);}};IOController.prototype.seek=function(bytes){this._paused=false;this._stashUsed=0;this._stashByteStart=0;this._internalSeek(bytes,true);};/**
			     * When seeking request is from media seeking, unconsumed stash data should be dropped
			     * However, stash data shouldn't be dropped if seeking requested from http reconnection
			     *
			     * @dropUnconsumed: Ignore and discard all unconsumed data in stash buffer
			     */IOController.prototype._internalSeek=function(bytes,dropUnconsumed){if(this._loader.isWorking()){this._loader.abort();}// dispatch & flush stash buffer before seek
this._flushStashBuffer(dropUnconsumed);this._loader.destroy();this._loader=null;var requestRange={from:bytes,to:-1};this._currentRange={from:requestRange.from,to:-1};this._speedSampler.reset();this._stashSize=this._stashInitialSize;this._createLoader();this._loader.open(this._dataSource,requestRange);if(this._onSeeked){this._onSeeked();}};IOController.prototype.updateUrl=function(url){if(!url||typeof url!=='string'||url.length===0){throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_9__.InvalidArgumentException('Url must be a non-empty string!');}this._dataSource.url=url;// TODO: replace with new url
};IOController.prototype._expandBuffer=function(expectedBytes){var bufferNewSize=this._stashSize;while(bufferNewSize+1024*1024*1<expectedBytes){bufferNewSize*=2;}bufferNewSize+=1024*1024*1;// bufferSize = stashSize + 1MB
if(bufferNewSize===this._bufferSize){return;}var newBuffer=new ArrayBuffer(bufferNewSize);if(this._stashUsed>0){// copy existing data into new buffer
var stashOldArray=new Uint8Array(this._stashBuffer,0,this._stashUsed);var stashNewArray=new Uint8Array(newBuffer,0,bufferNewSize);stashNewArray.set(stashOldArray,0);}this._stashBuffer=newBuffer;this._bufferSize=bufferNewSize;};IOController.prototype._normalizeSpeed=function(input){var list=this._speedNormalizeList;var last=list.length-1;var mid=0;var lbound=0;var ubound=last;if(input<list[0]){return list[0];}// binary search
while(lbound<=ubound){mid=lbound+Math.floor((ubound-lbound)/2);if(mid===last||input>=list[mid]&&input<list[mid+1]){return list[mid];}else if(list[mid]<input){lbound=mid+1;}else{ubound=mid-1;}}};IOController.prototype._adjustStashSize=function(normalized){var stashSizeKB=0;if(this._config.isLive){// live stream: always use single normalized speed for size of stashSizeKB
stashSizeKB=normalized;}else{if(normalized<512){stashSizeKB=normalized;}else if(normalized>=512&&normalized<=1024){stashSizeKB=Math.floor(normalized*1.5);}else{stashSizeKB=normalized*2;}}if(stashSizeKB>8192){stashSizeKB=8192;}var bufferSize=stashSizeKB*1024+1024*1024*1;// stashSize + 1MB
if(this._bufferSize<bufferSize){this._expandBuffer(bufferSize);}this._stashSize=stashSizeKB*1024;};IOController.prototype._dispatchChunks=function(chunks,byteStart){this._currentRange.to=byteStart+chunks.byteLength-1;return this._onDataArrival(chunks,byteStart);};IOController.prototype._onURLRedirect=function(redirectedURL){this._redirectedURL=redirectedURL;if(this._onRedirect){this._onRedirect(redirectedURL);}};IOController.prototype._onContentLengthKnown=function(contentLength){if(contentLength&&this._fullRequestFlag){this._totalLength=contentLength;this._fullRequestFlag=false;}};IOController.prototype._onLoaderChunkArrival=function(chunk,byteStart,receivedLength){if(!this._onDataArrival){throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_9__.IllegalStateException('IOController: No existing consumer (onDataArrival) callback!');}if(this._paused){return;}if(this._isEarlyEofReconnecting){// Auto-reconnect for EarlyEof succeed, notify to upper-layer by callback
this._isEarlyEofReconnecting=false;if(this._onRecoveredEarlyEof){this._onRecoveredEarlyEof();}}this._speedSampler.addBytes(chunk.byteLength);// adjust stash buffer size according to network speed dynamically
var KBps=this._speedSampler.lastSecondKBps;if(KBps!==0){var normalized=this._normalizeSpeed(KBps);if(this._speedNormalized!==normalized){this._speedNormalized=normalized;this._adjustStashSize(normalized);}}if(!this._enableStash){// disable stash
if(this._stashUsed===0){// dispatch chunk directly to consumer;
// check ret value (consumed bytes) and stash unconsumed to stashBuffer
var consumed=this._dispatchChunks(chunk,byteStart);if(consumed<chunk.byteLength){// unconsumed data remain.
var remain=chunk.byteLength-consumed;if(remain>this._bufferSize){this._expandBuffer(remain);}var stashArray=new Uint8Array(this._stashBuffer,0,this._bufferSize);stashArray.set(new Uint8Array(chunk,consumed),0);this._stashUsed+=remain;this._stashByteStart=byteStart+consumed;}}else{// else: Merge chunk into stashBuffer, and dispatch stashBuffer to consumer.
if(this._stashUsed+chunk.byteLength>this._bufferSize){this._expandBuffer(this._stashUsed+chunk.byteLength);}var stashArray=new Uint8Array(this._stashBuffer,0,this._bufferSize);stashArray.set(new Uint8Array(chunk),this._stashUsed);this._stashUsed+=chunk.byteLength;var consumed=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart);if(consumed<this._stashUsed&&consumed>0){// unconsumed data remain
var remainArray=new Uint8Array(this._stashBuffer,consumed);stashArray.set(remainArray,0);}this._stashUsed-=consumed;this._stashByteStart+=consumed;}}else{// enable stash
if(this._stashUsed===0&&this._stashByteStart===0){// seeked? or init chunk?
// This is the first chunk after seek action
this._stashByteStart=byteStart;}if(this._stashUsed+chunk.byteLength<=this._stashSize){// just stash
var stashArray=new Uint8Array(this._stashBuffer,0,this._stashSize);stashArray.set(new Uint8Array(chunk),this._stashUsed);this._stashUsed+=chunk.byteLength;}else{// stashUsed + chunkSize > stashSize, size limit exceeded
var stashArray=new Uint8Array(this._stashBuffer,0,this._bufferSize);if(this._stashUsed>0){// There're stash datas in buffer
// dispatch the whole stashBuffer, and stash remain data
// then append chunk to stashBuffer (stash)
var buffer=this._stashBuffer.slice(0,this._stashUsed);var consumed=this._dispatchChunks(buffer,this._stashByteStart);if(consumed<buffer.byteLength){if(consumed>0){var remainArray=new Uint8Array(buffer,consumed);stashArray.set(remainArray,0);this._stashUsed=remainArray.byteLength;this._stashByteStart+=consumed;}}else{this._stashUsed=0;this._stashByteStart+=consumed;}if(this._stashUsed+chunk.byteLength>this._bufferSize){this._expandBuffer(this._stashUsed+chunk.byteLength);stashArray=new Uint8Array(this._stashBuffer,0,this._bufferSize);}stashArray.set(new Uint8Array(chunk),this._stashUsed);this._stashUsed+=chunk.byteLength;}else{// stash buffer empty, but chunkSize > stashSize (oh, holy shit)
// dispatch chunk directly and stash remain data
var consumed=this._dispatchChunks(chunk,byteStart);if(consumed<chunk.byteLength){var remain=chunk.byteLength-consumed;if(remain>this._bufferSize){this._expandBuffer(remain);stashArray=new Uint8Array(this._stashBuffer,0,this._bufferSize);}stashArray.set(new Uint8Array(chunk,consumed),0);this._stashUsed+=remain;this._stashByteStart=byteStart+consumed;}}}}};IOController.prototype._flushStashBuffer=function(dropUnconsumed){if(this._stashUsed>0){var buffer=this._stashBuffer.slice(0,this._stashUsed);var consumed=this._dispatchChunks(buffer,this._stashByteStart);var remain=buffer.byteLength-consumed;if(consumed<buffer.byteLength){if(dropUnconsumed){_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.w(this.TAG,remain+" bytes unconsumed data remain when flush buffer, dropped");}else{if(consumed>0){var stashArray=new Uint8Array(this._stashBuffer,0,this._bufferSize);var remainArray=new Uint8Array(buffer,consumed);stashArray.set(remainArray,0);this._stashUsed=remainArray.byteLength;this._stashByteStart+=consumed;}return 0;}}this._stashUsed=0;this._stashByteStart=0;return remain;}return 0;};IOController.prototype._onLoaderComplete=function(from,to){// Force-flush stash buffer, and drop unconsumed data
this._flushStashBuffer(true);if(this._onComplete){this._onComplete(this._extraData);}};IOController.prototype._onLoaderError=function(type,data){_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.e(this.TAG,"Loader error, code = "+data.code+", msg = "+data.msg);this._flushStashBuffer(false);if(this._isEarlyEofReconnecting){// Auto-reconnect for EarlyEof failed, throw UnrecoverableEarlyEof error to upper-layer
this._isEarlyEofReconnecting=false;type=_loader_js__WEBPACK_IMPORTED_MODULE_2__.LoaderErrors.UNRECOVERABLE_EARLY_EOF;}switch(type){case _loader_js__WEBPACK_IMPORTED_MODULE_2__.LoaderErrors.EARLY_EOF:{if(!this._config.isLive){// Do internal http reconnect if not live stream
if(this._totalLength){var nextFrom=this._currentRange.to+1;if(nextFrom<this._totalLength){_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.w(this.TAG,'Connection lost, trying reconnect...');this._isEarlyEofReconnecting=true;this._internalSeek(nextFrom,false);}return;}// else: We don't know totalLength, throw UnrecoverableEarlyEof
}// live stream: throw UnrecoverableEarlyEof error to upper-layer
type=_loader_js__WEBPACK_IMPORTED_MODULE_2__.LoaderErrors.UNRECOVERABLE_EARLY_EOF;break;}case _loader_js__WEBPACK_IMPORTED_MODULE_2__.LoaderErrors.UNRECOVERABLE_EARLY_EOF:case _loader_js__WEBPACK_IMPORTED_MODULE_2__.LoaderErrors.CONNECTING_TIMEOUT:case _loader_js__WEBPACK_IMPORTED_MODULE_2__.LoaderErrors.HTTP_STATUS_CODE_INVALID:case _loader_js__WEBPACK_IMPORTED_MODULE_2__.LoaderErrors.EXCEPTION:break;}if(this._onError){this._onError(type,data);}else{throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_9__.RuntimeException('IOException: '+data.msg);}};return IOController;}();/* harmony default export */__webpack_exports__["default"]=IOController;/***/},/***/"./src/io/loader.js":/*!**************************!*\
			  !*** ./src/io/loader.js ***!
			  \**************************/ /***/function srcIoLoaderJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export */__webpack_require__.d(__webpack_exports__,{/* harmony export */"LoaderStatus":function LoaderStatus(){return(/* binding */_LoaderStatus);},/* harmony export */"LoaderErrors":function LoaderErrors(){return(/* binding */_LoaderErrors);},/* harmony export */"BaseLoader":function BaseLoader(){return(/* binding */_BaseLoader);}/* harmony export */});/* harmony import */var _utils_exception_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../utils/exception.js */"./src/utils/exception.js");/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */var _LoaderStatus={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4};var _LoaderErrors={OK:'OK',EXCEPTION:'Exception',HTTP_STATUS_CODE_INVALID:'HttpStatusCodeInvalid',CONNECTING_TIMEOUT:'ConnectingTimeout',EARLY_EOF:'EarlyEof',UNRECOVERABLE_EARLY_EOF:'UnrecoverableEarlyEof'};/* Loader has callbacks which have following prototypes:
			 *     function onContentLengthKnown(contentLength: number): void
			 *     function onURLRedirect(url: string): void
			 *     function onDataArrival(chunk: ArrayBuffer, byteStart: number, receivedLength: number): void
			 *     function onError(errorType: number, errorInfo: {code: number, msg: string}): void
			 *     function onComplete(rangeFrom: number, rangeTo: number): void
			 */var _BaseLoader=/** @class */function(){function BaseLoader(typeName){this._type=typeName||'undefined';this._status=_LoaderStatus.kIdle;this._needStash=false;// callbacks
this._onContentLengthKnown=null;this._onURLRedirect=null;this._onDataArrival=null;this._onError=null;this._onComplete=null;}BaseLoader.prototype.destroy=function(){this._status=_LoaderStatus.kIdle;this._onContentLengthKnown=null;this._onURLRedirect=null;this._onDataArrival=null;this._onError=null;this._onComplete=null;};BaseLoader.prototype.isWorking=function(){return this._status===_LoaderStatus.kConnecting||this._status===_LoaderStatus.kBuffering;};Object.defineProperty(BaseLoader.prototype,"type",{get:function get(){return this._type;},enumerable:false,configurable:true});Object.defineProperty(BaseLoader.prototype,"status",{get:function get(){return this._status;},enumerable:false,configurable:true});Object.defineProperty(BaseLoader.prototype,"needStashBuffer",{get:function get(){return this._needStash;},enumerable:false,configurable:true});Object.defineProperty(BaseLoader.prototype,"onContentLengthKnown",{get:function get(){return this._onContentLengthKnown;},set:function set(callback){this._onContentLengthKnown=callback;},enumerable:false,configurable:true});Object.defineProperty(BaseLoader.prototype,"onURLRedirect",{get:function get(){return this._onURLRedirect;},set:function set(callback){this._onURLRedirect=callback;},enumerable:false,configurable:true});Object.defineProperty(BaseLoader.prototype,"onDataArrival",{get:function get(){return this._onDataArrival;},set:function set(callback){this._onDataArrival=callback;},enumerable:false,configurable:true});Object.defineProperty(BaseLoader.prototype,"onError",{get:function get(){return this._onError;},set:function set(callback){this._onError=callback;},enumerable:false,configurable:true});Object.defineProperty(BaseLoader.prototype,"onComplete",{get:function get(){return this._onComplete;},set:function set(callback){this._onComplete=callback;},enumerable:false,configurable:true});// pure virtual
BaseLoader.prototype.open=function(dataSource,range){throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_0__.NotImplementedException('Unimplemented abstract function!');};BaseLoader.prototype.abort=function(){throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_0__.NotImplementedException('Unimplemented abstract function!');};return BaseLoader;}();/***/},/***/"./src/io/param-seek-handler.js":/*!**************************************!*\
			  !*** ./src/io/param-seek-handler.js ***!
			  \**************************************/ /***/function srcIoParamSeekHandlerJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */var ParamSeekHandler=/** @class */function(){function ParamSeekHandler(paramStart,paramEnd){this._startName=paramStart;this._endName=paramEnd;}ParamSeekHandler.prototype.getConfig=function(baseUrl,range){var url=baseUrl;if(range.from!==0||range.to!==-1){var needAnd=true;if(url.indexOf('?')===-1){url+='?';needAnd=false;}if(needAnd){url+='&';}url+=this._startName+"="+range.from.toString();if(range.to!==-1){url+="&"+this._endName+"="+range.to.toString();}}return{url:url,headers:{}};};ParamSeekHandler.prototype.removeURLParameters=function(seekedURL){var baseURL=seekedURL.split('?')[0];var params=undefined;var queryIndex=seekedURL.indexOf('?');if(queryIndex!==-1){params=seekedURL.substring(queryIndex+1);}var resultParams='';if(params!=undefined&&params.length>0){var pairs=params.split('&');for(var i=0;i<pairs.length;i++){var pair=pairs[i].split('=');var requireAnd=i>0;if(pair[0]!==this._startName&&pair[0]!==this._endName){if(requireAnd){resultParams+='&';}resultParams+=pairs[i];}}}return resultParams.length===0?baseURL:baseURL+'?'+resultParams;};return ParamSeekHandler;}();/* harmony default export */__webpack_exports__["default"]=ParamSeekHandler;/***/},/***/"./src/io/range-seek-handler.js":/*!**************************************!*\
			  !*** ./src/io/range-seek-handler.js ***!
			  \**************************************/ /***/function srcIoRangeSeekHandlerJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */var RangeSeekHandler=/** @class */function(){function RangeSeekHandler(zeroStart){this._zeroStart=zeroStart||false;}RangeSeekHandler.prototype.getConfig=function(url,range){var headers={};if(range.from!==0||range.to!==-1){var param=void 0;if(range.to!==-1){param="bytes="+range.from.toString()+"-"+range.to.toString();}else{param="bytes="+range.from.toString()+"-";}headers['Range']=param;}else if(this._zeroStart){headers['Range']='bytes=0-';}return{url:url,headers:headers};};RangeSeekHandler.prototype.removeURLParameters=function(seekedURL){return seekedURL;};return RangeSeekHandler;}();/* harmony default export */__webpack_exports__["default"]=RangeSeekHandler;/***/},/***/"./src/io/speed-sampler.js":/*!*********************************!*\
			  !*** ./src/io/speed-sampler.js ***!
			  \*********************************/ /***/function srcIoSpeedSamplerJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */ // Utility class to calculate realtime network I/O speed
var SpeedSampler=/** @class */function(){function SpeedSampler(){// milliseconds
this._firstCheckpoint=0;this._lastCheckpoint=0;this._intervalBytes=0;this._totalBytes=0;this._lastSecondBytes=0;// compatibility detection
if(self.performance&&self.performance.now){this._now=self.performance.now.bind(self.performance);}else{this._now=Date.now;}}SpeedSampler.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0;this._totalBytes=this._intervalBytes=0;this._lastSecondBytes=0;};SpeedSampler.prototype.addBytes=function(bytes){if(this._firstCheckpoint===0){this._firstCheckpoint=this._now();this._lastCheckpoint=this._firstCheckpoint;this._intervalBytes+=bytes;this._totalBytes+=bytes;}else if(this._now()-this._lastCheckpoint<1000){this._intervalBytes+=bytes;this._totalBytes+=bytes;}else{// duration >= 1000
this._lastSecondBytes=this._intervalBytes;this._intervalBytes=bytes;this._totalBytes+=bytes;this._lastCheckpoint=this._now();}};Object.defineProperty(SpeedSampler.prototype,"currentKBps",{get:function get(){this.addBytes(0);var durationSeconds=(this._now()-this._lastCheckpoint)/1000;if(durationSeconds==0)durationSeconds=1;return this._intervalBytes/durationSeconds/1024;},enumerable:false,configurable:true});Object.defineProperty(SpeedSampler.prototype,"lastSecondKBps",{get:function get(){this.addBytes(0);if(this._lastSecondBytes!==0){return this._lastSecondBytes/1024;}else{// lastSecondBytes === 0
if(this._now()-this._lastCheckpoint>=500){// if time interval since last checkpoint has exceeded 500ms
// the speed is nearly accurate
return this.currentKBps;}else{// We don't know
return 0;}}},enumerable:false,configurable:true});Object.defineProperty(SpeedSampler.prototype,"averageKBps",{get:function get(){var durationSeconds=(this._now()-this._firstCheckpoint)/1000;return this._totalBytes/durationSeconds/1024;},enumerable:false,configurable:true});return SpeedSampler;}();/* harmony default export */__webpack_exports__["default"]=SpeedSampler;/***/},/***/"./src/io/websocket-loader.js":/*!************************************!*\
			  !*** ./src/io/websocket-loader.js ***!
			  \************************************/ /***/function srcIoWebsocketLoaderJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var _loader_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./loader.js */"./src/io/loader.js");/* harmony import */var _utils_exception_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../utils/exception.js */"./src/utils/exception.js");/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */var __extends=function(){var _extendStatics2=function extendStatics(d,b){_extendStatics2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;}||function(d,b){for(var p in b){if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p];}};return _extendStatics2(d,b);};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");_extendStatics2(d,b);function __(){this.constructor=d;}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};}();// For FLV over WebSocket live stream
var WebSocketLoader=/** @class */function(_super){__extends(WebSocketLoader,_super);function WebSocketLoader(){var _this=_super.call(this,'websocket-loader')||this;_this.TAG='WebSocketLoader';_this._needStash=true;_this._ws=null;_this._requestAbort=false;_this._receivedLength=0;return _this;}WebSocketLoader.isSupported=function(){try{return typeof self.WebSocket!=='undefined';}catch(e){return false;}};WebSocketLoader.prototype.destroy=function(){if(this._ws){this.abort();}_super.prototype.destroy.call(this);};WebSocketLoader.prototype.open=function(dataSource){try{var ws=this._ws=new self.WebSocket(dataSource.url);ws.binaryType='arraybuffer';ws.onopen=this._onWebSocketOpen.bind(this);ws.onclose=this._onWebSocketClose.bind(this);ws.onmessage=this._onWebSocketMessage.bind(this);ws.onerror=this._onWebSocketError.bind(this);this._status=_loader_js__WEBPACK_IMPORTED_MODULE_0__.LoaderStatus.kConnecting;}catch(e){this._status=_loader_js__WEBPACK_IMPORTED_MODULE_0__.LoaderStatus.kError;var info={code:e.code,msg:e.message};if(this._onError){this._onError(_loader_js__WEBPACK_IMPORTED_MODULE_0__.LoaderErrors.EXCEPTION,info);}else{throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_1__.RuntimeException(info.msg);}}};WebSocketLoader.prototype.abort=function(){var ws=this._ws;if(ws&&(ws.readyState===0||ws.readyState===1)){// CONNECTING || OPEN
this._requestAbort=true;ws.close();}this._ws=null;this._status=_loader_js__WEBPACK_IMPORTED_MODULE_0__.LoaderStatus.kComplete;};WebSocketLoader.prototype._onWebSocketOpen=function(e){this._status=_loader_js__WEBPACK_IMPORTED_MODULE_0__.LoaderStatus.kBuffering;};WebSocketLoader.prototype._onWebSocketClose=function(e){if(this._requestAbort===true){this._requestAbort=false;return;}this._status=_loader_js__WEBPACK_IMPORTED_MODULE_0__.LoaderStatus.kComplete;if(this._onComplete){this._onComplete(0,this._receivedLength-1);}};WebSocketLoader.prototype._onWebSocketMessage=function(e){var _this=this;if(e.data instanceof ArrayBuffer){this._dispatchArrayBuffer(e.data);}else if(e.data instanceof Blob){var reader_1=new FileReader();reader_1.onload=function(){_this._dispatchArrayBuffer(reader_1.result);};reader_1.readAsArrayBuffer(e.data);}else{this._status=_loader_js__WEBPACK_IMPORTED_MODULE_0__.LoaderStatus.kError;var info={code:-1,msg:'Unsupported WebSocket message type: '+e.data.constructor.name};if(this._onError){this._onError(_loader_js__WEBPACK_IMPORTED_MODULE_0__.LoaderErrors.EXCEPTION,info);}else{throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_1__.RuntimeException(info.msg);}}};WebSocketLoader.prototype._dispatchArrayBuffer=function(arraybuffer){var chunk=arraybuffer;var byteStart=this._receivedLength;this._receivedLength+=chunk.byteLength;if(this._onDataArrival){this._onDataArrival(chunk,byteStart,this._receivedLength);}};WebSocketLoader.prototype._onWebSocketError=function(e){this._status=_loader_js__WEBPACK_IMPORTED_MODULE_0__.LoaderStatus.kError;var info={code:e.code,msg:e.message};if(this._onError){this._onError(_loader_js__WEBPACK_IMPORTED_MODULE_0__.LoaderErrors.EXCEPTION,info);}else{throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_1__.RuntimeException(info.msg);}};return WebSocketLoader;}(_loader_js__WEBPACK_IMPORTED_MODULE_0__.BaseLoader);/* harmony default export */__webpack_exports__["default"]=WebSocketLoader;/***/},/***/"./src/io/xhr-moz-chunked-loader.js":/*!******************************************!*\
			  !*** ./src/io/xhr-moz-chunked-loader.js ***!
			  \******************************************/ /***/function srcIoXhrMozChunkedLoaderJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var _utils_logger_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../utils/logger.js */"./src/utils/logger.js");/* harmony import */var _loader_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ./loader.js */"./src/io/loader.js");/* harmony import */var _utils_exception_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../utils/exception.js */"./src/utils/exception.js");/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */var __extends=function(){var _extendStatics3=function extendStatics(d,b){_extendStatics3=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;}||function(d,b){for(var p in b){if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p];}};return _extendStatics3(d,b);};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");_extendStatics3(d,b);function __(){this.constructor=d;}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};}();// For FireFox browser which supports `xhr.responseType = 'moz-chunked-arraybuffer'`
var MozChunkedLoader=/** @class */function(_super){__extends(MozChunkedLoader,_super);function MozChunkedLoader(seekHandler,config){var _this=_super.call(this,'xhr-moz-chunked-loader')||this;_this.TAG='MozChunkedLoader';_this._seekHandler=seekHandler;_this._config=config;_this._needStash=true;_this._xhr=null;_this._requestAbort=false;_this._contentLength=null;_this._receivedLength=0;return _this;}MozChunkedLoader.isSupported=function(){try{var xhr=new XMLHttpRequest();// Firefox 37- requires .open() to be called before setting responseType
xhr.open('GET','https://example.com',true);xhr.responseType='moz-chunked-arraybuffer';return xhr.responseType==='moz-chunked-arraybuffer';}catch(e){_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.w('MozChunkedLoader',e.message);return false;}};MozChunkedLoader.prototype.destroy=function(){if(this.isWorking()){this.abort();}if(this._xhr){this._xhr.onreadystatechange=null;this._xhr.onprogress=null;this._xhr.onloadend=null;this._xhr.onerror=null;this._xhr=null;}_super.prototype.destroy.call(this);};MozChunkedLoader.prototype.open=function(dataSource,range){this._dataSource=dataSource;this._range=range;var sourceURL=dataSource.url;if(this._config.reuseRedirectedURL&&dataSource.redirectedURL!=undefined){sourceURL=dataSource.redirectedURL;}var seekConfig=this._seekHandler.getConfig(sourceURL,range);this._requestURL=seekConfig.url;var xhr=this._xhr=new XMLHttpRequest();xhr.open('GET',seekConfig.url,true);xhr.responseType='moz-chunked-arraybuffer';xhr.onreadystatechange=this._onReadyStateChange.bind(this);xhr.onprogress=this._onProgress.bind(this);xhr.onloadend=this._onLoadEnd.bind(this);xhr.onerror=this._onXhrError.bind(this);// cors is auto detected and enabled by xhr
// withCredentials is disabled by default
if(dataSource.withCredentials){xhr.withCredentials=true;}if(_typeof3(seekConfig.headers)==='object'){var headers=seekConfig.headers;for(var key in headers){if(headers.hasOwnProperty(key)){xhr.setRequestHeader(key,headers[key]);}}}// add additional headers
if(_typeof3(this._config.headers)==='object'){var headers=this._config.headers;for(var key in headers){if(headers.hasOwnProperty(key)){xhr.setRequestHeader(key,headers[key]);}}}this._status=_loader_js__WEBPACK_IMPORTED_MODULE_1__.LoaderStatus.kConnecting;xhr.send();};MozChunkedLoader.prototype.abort=function(){this._requestAbort=true;if(this._xhr){this._xhr.abort();}this._status=_loader_js__WEBPACK_IMPORTED_MODULE_1__.LoaderStatus.kComplete;};MozChunkedLoader.prototype._onReadyStateChange=function(e){var xhr=e.target;if(xhr.readyState===2){// HEADERS_RECEIVED
if(xhr.responseURL!=undefined&&xhr.responseURL!==this._requestURL){if(this._onURLRedirect){var redirectedURL=this._seekHandler.removeURLParameters(xhr.responseURL);this._onURLRedirect(redirectedURL);}}if(xhr.status!==0&&(xhr.status<200||xhr.status>299)){this._status=_loader_js__WEBPACK_IMPORTED_MODULE_1__.LoaderStatus.kError;if(this._onError){this._onError(_loader_js__WEBPACK_IMPORTED_MODULE_1__.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:xhr.status,msg:xhr.statusText});}else{throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_2__.RuntimeException('MozChunkedLoader: Http code invalid, '+xhr.status+' '+xhr.statusText);}}else{this._status=_loader_js__WEBPACK_IMPORTED_MODULE_1__.LoaderStatus.kBuffering;}}};MozChunkedLoader.prototype._onProgress=function(e){if(this._status===_loader_js__WEBPACK_IMPORTED_MODULE_1__.LoaderStatus.kError){// Ignore error response
return;}if(this._contentLength===null){if(e.total!==null&&e.total!==0){this._contentLength=e.total;if(this._onContentLengthKnown){this._onContentLengthKnown(this._contentLength);}}}var chunk=e.target.response;var byteStart=this._range.from+this._receivedLength;this._receivedLength+=chunk.byteLength;if(this._onDataArrival){this._onDataArrival(chunk,byteStart,this._receivedLength);}};MozChunkedLoader.prototype._onLoadEnd=function(e){if(this._requestAbort===true){this._requestAbort=false;return;}else if(this._status===_loader_js__WEBPACK_IMPORTED_MODULE_1__.LoaderStatus.kError){return;}this._status=_loader_js__WEBPACK_IMPORTED_MODULE_1__.LoaderStatus.kComplete;if(this._onComplete){this._onComplete(this._range.from,this._range.from+this._receivedLength-1);}};MozChunkedLoader.prototype._onXhrError=function(e){this._status=_loader_js__WEBPACK_IMPORTED_MODULE_1__.LoaderStatus.kError;var type=0;var info=null;if(this._contentLength&&e.loaded<this._contentLength){type=_loader_js__WEBPACK_IMPORTED_MODULE_1__.LoaderErrors.EARLY_EOF;info={code:-1,msg:'Moz-Chunked stream meet Early-Eof'};}else{type=_loader_js__WEBPACK_IMPORTED_MODULE_1__.LoaderErrors.EXCEPTION;info={code:-1,msg:e.constructor.name+' '+e.type};}if(this._onError){this._onError(type,info);}else{throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_2__.RuntimeException(info.msg);}};return MozChunkedLoader;}(_loader_js__WEBPACK_IMPORTED_MODULE_1__.BaseLoader);/* harmony default export */__webpack_exports__["default"]=MozChunkedLoader;/***/},/***/"./src/io/xhr-range-loader.js":/*!************************************!*\
			  !*** ./src/io/xhr-range-loader.js ***!
			  \************************************/ /***/function srcIoXhrRangeLoaderJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var _utils_logger_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../utils/logger.js */"./src/utils/logger.js");/* harmony import */var _speed_sampler_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ./speed-sampler.js */"./src/io/speed-sampler.js");/* harmony import */var _loader_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ./loader.js */"./src/io/loader.js");/* harmony import */var _utils_exception_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ../utils/exception.js */"./src/utils/exception.js");/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */var __extends=function(){var _extendStatics4=function extendStatics(d,b){_extendStatics4=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;}||function(d,b){for(var p in b){if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p];}};return _extendStatics4(d,b);};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");_extendStatics4(d,b);function __(){this.constructor=d;}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};}();// Universal IO Loader, implemented by adding Range header in xhr's request header
var RangeLoader=/** @class */function(_super){__extends(RangeLoader,_super);function RangeLoader(seekHandler,config){var _this=_super.call(this,'xhr-range-loader')||this;_this.TAG='RangeLoader';_this._seekHandler=seekHandler;_this._config=config;_this._needStash=false;_this._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192];_this._currentChunkSizeKB=384;_this._currentSpeedNormalized=0;_this._zeroSpeedChunkCount=0;_this._xhr=null;_this._speedSampler=new _speed_sampler_js__WEBPACK_IMPORTED_MODULE_1__.default();_this._requestAbort=false;_this._waitForTotalLength=false;_this._totalLengthReceived=false;_this._currentRequestURL=null;_this._currentRedirectedURL=null;_this._currentRequestRange=null;_this._totalLength=null;// size of the entire file
_this._contentLength=null;// Content-Length of entire request range
_this._receivedLength=0;// total received bytes
_this._lastTimeLoaded=0;// received bytes of current request sub-range
return _this;}RangeLoader.isSupported=function(){try{var xhr=new XMLHttpRequest();xhr.open('GET','https://example.com',true);xhr.responseType='arraybuffer';return xhr.responseType==='arraybuffer';}catch(e){_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.w('RangeLoader',e.message);return false;}};RangeLoader.prototype.destroy=function(){if(this.isWorking()){this.abort();}if(this._xhr){this._xhr.onreadystatechange=null;this._xhr.onprogress=null;this._xhr.onload=null;this._xhr.onerror=null;this._xhr=null;}_super.prototype.destroy.call(this);};Object.defineProperty(RangeLoader.prototype,"currentSpeed",{get:function get(){return this._speedSampler.lastSecondKBps;},enumerable:false,configurable:true});RangeLoader.prototype.open=function(dataSource,range){this._dataSource=dataSource;this._range=range;this._status=_loader_js__WEBPACK_IMPORTED_MODULE_2__.LoaderStatus.kConnecting;var useRefTotalLength=false;if(this._dataSource.filesize!=undefined&&this._dataSource.filesize!==0){useRefTotalLength=true;this._totalLength=this._dataSource.filesize;}if(!this._totalLengthReceived&&!useRefTotalLength){// We need total filesize
this._waitForTotalLength=true;this._internalOpen(this._dataSource,{from:0,to:-1});}else{// We have filesize, start loading
this._openSubRange();}};RangeLoader.prototype._openSubRange=function(){var chunkSize=this._currentChunkSizeKB*1024;var from=this._range.from+this._receivedLength;var to=from+chunkSize;if(this._contentLength!=null){if(to-this._range.from>=this._contentLength){to=this._range.from+this._contentLength-1;}}this._currentRequestRange={from:from,to:to};this._internalOpen(this._dataSource,this._currentRequestRange);};RangeLoader.prototype._internalOpen=function(dataSource,range){this._lastTimeLoaded=0;var sourceURL=dataSource.url;if(this._config.reuseRedirectedURL){if(this._currentRedirectedURL!=undefined){sourceURL=this._currentRedirectedURL;}else if(dataSource.redirectedURL!=undefined){sourceURL=dataSource.redirectedURL;}}var seekConfig=this._seekHandler.getConfig(sourceURL,range);this._currentRequestURL=seekConfig.url;var xhr=this._xhr=new XMLHttpRequest();xhr.open('GET',seekConfig.url,true);xhr.responseType='arraybuffer';xhr.onreadystatechange=this._onReadyStateChange.bind(this);xhr.onprogress=this._onProgress.bind(this);xhr.onload=this._onLoad.bind(this);xhr.onerror=this._onXhrError.bind(this);if(dataSource.withCredentials){xhr.withCredentials=true;}if(_typeof3(seekConfig.headers)==='object'){var headers=seekConfig.headers;for(var key in headers){if(headers.hasOwnProperty(key)){xhr.setRequestHeader(key,headers[key]);}}}// add additional headers
if(_typeof3(this._config.headers)==='object'){var headers=this._config.headers;for(var key in headers){if(headers.hasOwnProperty(key)){xhr.setRequestHeader(key,headers[key]);}}}xhr.send();};RangeLoader.prototype.abort=function(){this._requestAbort=true;this._internalAbort();this._status=_loader_js__WEBPACK_IMPORTED_MODULE_2__.LoaderStatus.kComplete;};RangeLoader.prototype._internalAbort=function(){if(this._xhr){this._xhr.onreadystatechange=null;this._xhr.onprogress=null;this._xhr.onload=null;this._xhr.onerror=null;this._xhr.abort();this._xhr=null;}};RangeLoader.prototype._onReadyStateChange=function(e){var xhr=e.target;if(xhr.readyState===2){// HEADERS_RECEIVED
if(xhr.responseURL!=undefined){// if the browser support this property
var redirectedURL=this._seekHandler.removeURLParameters(xhr.responseURL);if(xhr.responseURL!==this._currentRequestURL&&redirectedURL!==this._currentRedirectedURL){this._currentRedirectedURL=redirectedURL;if(this._onURLRedirect){this._onURLRedirect(redirectedURL);}}}if(xhr.status>=200&&xhr.status<=299){if(this._waitForTotalLength){return;}this._status=_loader_js__WEBPACK_IMPORTED_MODULE_2__.LoaderStatus.kBuffering;}else{this._status=_loader_js__WEBPACK_IMPORTED_MODULE_2__.LoaderStatus.kError;if(this._onError){this._onError(_loader_js__WEBPACK_IMPORTED_MODULE_2__.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:xhr.status,msg:xhr.statusText});}else{throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_3__.RuntimeException('RangeLoader: Http code invalid, '+xhr.status+' '+xhr.statusText);}}}};RangeLoader.prototype._onProgress=function(e){if(this._status===_loader_js__WEBPACK_IMPORTED_MODULE_2__.LoaderStatus.kError){// Ignore error response
return;}if(this._contentLength===null){var openNextRange=false;if(this._waitForTotalLength){this._waitForTotalLength=false;this._totalLengthReceived=true;openNextRange=true;var total=e.total;this._internalAbort();if(total!=null&total!==0){this._totalLength=total;}}// calculate currrent request range's contentLength
if(this._range.to===-1){this._contentLength=this._totalLength-this._range.from;}else{// to !== -1
this._contentLength=this._range.to-this._range.from+1;}if(openNextRange){this._openSubRange();return;}if(this._onContentLengthKnown){this._onContentLengthKnown(this._contentLength);}}var delta=e.loaded-this._lastTimeLoaded;this._lastTimeLoaded=e.loaded;this._speedSampler.addBytes(delta);};RangeLoader.prototype._normalizeSpeed=function(input){var list=this._chunkSizeKBList;var last=list.length-1;var mid=0;var lbound=0;var ubound=last;if(input<list[0]){return list[0];}while(lbound<=ubound){mid=lbound+Math.floor((ubound-lbound)/2);if(mid===last||input>=list[mid]&&input<list[mid+1]){return list[mid];}else if(list[mid]<input){lbound=mid+1;}else{ubound=mid-1;}}};RangeLoader.prototype._onLoad=function(e){if(this._status===_loader_js__WEBPACK_IMPORTED_MODULE_2__.LoaderStatus.kError){// Ignore error response
return;}if(this._waitForTotalLength){this._waitForTotalLength=false;return;}this._lastTimeLoaded=0;var KBps=this._speedSampler.lastSecondKBps;if(KBps===0){this._zeroSpeedChunkCount++;if(this._zeroSpeedChunkCount>=3){// Try get currentKBps after 3 chunks
KBps=this._speedSampler.currentKBps;}}if(KBps!==0){var normalized=this._normalizeSpeed(KBps);if(this._currentSpeedNormalized!==normalized){this._currentSpeedNormalized=normalized;this._currentChunkSizeKB=normalized;}}var chunk=e.target.response;var byteStart=this._range.from+this._receivedLength;this._receivedLength+=chunk.byteLength;var reportComplete=false;if(this._contentLength!=null&&this._receivedLength<this._contentLength){// continue load next chunk
this._openSubRange();}else{reportComplete=true;}// dispatch received chunk
if(this._onDataArrival){this._onDataArrival(chunk,byteStart,this._receivedLength);}if(reportComplete){this._status=_loader_js__WEBPACK_IMPORTED_MODULE_2__.LoaderStatus.kComplete;if(this._onComplete){this._onComplete(this._range.from,this._range.from+this._receivedLength-1);}}};RangeLoader.prototype._onXhrError=function(e){this._status=_loader_js__WEBPACK_IMPORTED_MODULE_2__.LoaderStatus.kError;var type=0;var info=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength){type=_loader_js__WEBPACK_IMPORTED_MODULE_2__.LoaderErrors.EARLY_EOF;info={code:-1,msg:'RangeLoader meet Early-Eof'};}else{type=_loader_js__WEBPACK_IMPORTED_MODULE_2__.LoaderErrors.EXCEPTION;info={code:-1,msg:e.constructor.name+' '+e.type};}if(this._onError){this._onError(type,info);}else{throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_3__.RuntimeException(info.msg);}};return RangeLoader;}(_loader_js__WEBPACK_IMPORTED_MODULE_2__.BaseLoader);/* harmony default export */__webpack_exports__["default"]=RangeLoader;/***/},/***/"./src/player/flv-player.js":/*!**********************************!*\
			  !*** ./src/player/flv-player.js ***!
			  \**********************************/ /***/function srcPlayerFlvPlayerJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var events__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! events */"./node_modules/events/events.js");/* harmony import */var events__WEBPACK_IMPORTED_MODULE_0___default=/*#__PURE__*/__webpack_require__.n(events__WEBPACK_IMPORTED_MODULE_0__);/* harmony import */var _utils_logger_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../utils/logger.js */"./src/utils/logger.js");/* harmony import */var _utils_browser_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../utils/browser.js */"./src/utils/browser.js");/* harmony import */var _player_events_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ./player-events.js */"./src/player/player-events.js");/* harmony import */var _core_transmuxer_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(/*! ../core/transmuxer.js */"./src/core/transmuxer.js");/* harmony import */var _core_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(/*! ../core/transmuxing-events.js */"./src/core/transmuxing-events.js");/* harmony import */var _core_mse_controller_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(/*! ../core/mse-controller.js */"./src/core/mse-controller.js");/* harmony import */var _core_mse_events_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(/*! ../core/mse-events.js */"./src/core/mse-events.js");/* harmony import */var _player_errors_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(/*! ./player-errors.js */"./src/player/player-errors.js");/* harmony import */var _config_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(/*! ../config.js */"./src/config.js");/* harmony import */var _utils_exception_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(/*! ../utils/exception.js */"./src/utils/exception.js");/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */var FlvPlayer=/** @class */function(){function FlvPlayer(mediaDataSource,config){this.TAG='FlvPlayer';this._type='FlvPlayer';this._emitter=new(events__WEBPACK_IMPORTED_MODULE_0___default())();this._config=(0,_config_js__WEBPACK_IMPORTED_MODULE_9__.createDefaultConfig)();if(_typeof3(config)==='object'){Object.assign(this._config,config);}if(mediaDataSource.type.toLowerCase()!=='flv'){throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_10__.InvalidArgumentException('FlvPlayer requires an flv MediaDataSource input!');}if(mediaDataSource.isLive===true){this._config.isLive=true;}this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)};if(self.performance&&self.performance.now){this._now=self.performance.now.bind(self.performance);}else{this._now=Date.now;}this._pendingSeekTime=null;// in seconds
this._requestSetTime=false;this._seekpointRecord=null;this._progressChecker=null;this._mediaDataSource=mediaDataSource;this._mediaElement=null;this._msectl=null;this._transmuxer=null;this._mseSourceOpened=false;this._hasPendingLoad=false;this._receivedCanPlay=false;this._mediaInfo=null;this._statisticsInfo=null;var chromeNeedIDRFix=_utils_browser_js__WEBPACK_IMPORTED_MODULE_2__.default.chrome&&(_utils_browser_js__WEBPACK_IMPORTED_MODULE_2__.default.version.major<50||_utils_browser_js__WEBPACK_IMPORTED_MODULE_2__.default.version.major===50&&_utils_browser_js__WEBPACK_IMPORTED_MODULE_2__.default.version.build<2661);this._alwaysSeekKeyframe=chromeNeedIDRFix||_utils_browser_js__WEBPACK_IMPORTED_MODULE_2__.default.msedge||_utils_browser_js__WEBPACK_IMPORTED_MODULE_2__.default.msie?true:false;if(this._alwaysSeekKeyframe){this._config.accurateSeek=false;}}FlvPlayer.prototype.destroy=function(){if(this._progressChecker!=null){window.clearInterval(this._progressChecker);this._progressChecker=null;}if(this._transmuxer){this.unload();}if(this._mediaElement){this.detachMediaElement();}this.e=null;this._mediaDataSource=null;this._emitter.removeAllListeners();this._emitter=null;};FlvPlayer.prototype.on=function(event,listener){var _this=this;if(event===_player_events_js__WEBPACK_IMPORTED_MODULE_3__.default.MEDIA_INFO){if(this._mediaInfo!=null){Promise.resolve().then(function(){_this._emitter.emit(_player_events_js__WEBPACK_IMPORTED_MODULE_3__.default.MEDIA_INFO,_this.mediaInfo);});}}else if(event===_player_events_js__WEBPACK_IMPORTED_MODULE_3__.default.STATISTICS_INFO){if(this._statisticsInfo!=null){Promise.resolve().then(function(){_this._emitter.emit(_player_events_js__WEBPACK_IMPORTED_MODULE_3__.default.STATISTICS_INFO,_this.statisticsInfo);});}}this._emitter.addListener(event,listener);};FlvPlayer.prototype.off=function(event,listener){this._emitter.removeListener(event,listener);};FlvPlayer.prototype.attachMediaElement=function(mediaElement){var _this=this;this._mediaElement=mediaElement;mediaElement.addEventListener('loadedmetadata',this.e.onvLoadedMetadata);mediaElement.addEventListener('seeking',this.e.onvSeeking);mediaElement.addEventListener('canplay',this.e.onvCanPlay);mediaElement.addEventListener('stalled',this.e.onvStalled);mediaElement.addEventListener('progress',this.e.onvProgress);this._msectl=new _core_mse_controller_js__WEBPACK_IMPORTED_MODULE_6__.default(this._config);this._msectl.on(_core_mse_events_js__WEBPACK_IMPORTED_MODULE_7__.default.UPDATE_END,this._onmseUpdateEnd.bind(this));this._msectl.on(_core_mse_events_js__WEBPACK_IMPORTED_MODULE_7__.default.BUFFER_FULL,this._onmseBufferFull.bind(this));this._msectl.on(_core_mse_events_js__WEBPACK_IMPORTED_MODULE_7__.default.SOURCE_OPEN,function(){_this._mseSourceOpened=true;if(_this._hasPendingLoad){_this._hasPendingLoad=false;_this.load();}});this._msectl.on(_core_mse_events_js__WEBPACK_IMPORTED_MODULE_7__.default.ERROR,function(info){_this._emitter.emit(_player_events_js__WEBPACK_IMPORTED_MODULE_3__.default.ERROR,_player_errors_js__WEBPACK_IMPORTED_MODULE_8__.ErrorTypes.MEDIA_ERROR,_player_errors_js__WEBPACK_IMPORTED_MODULE_8__.ErrorDetails.MEDIA_MSE_ERROR,info);});this._msectl.attachMediaElement(mediaElement);if(this._pendingSeekTime!=null){try{mediaElement.currentTime=this._pendingSeekTime;this._pendingSeekTime=null;}catch(e){// IE11 may throw InvalidStateError if readyState === 0
// We can defer set currentTime operation after loadedmetadata
}}};FlvPlayer.prototype.detachMediaElement=function(){if(this._mediaElement){this._msectl.detachMediaElement();this._mediaElement.removeEventListener('loadedmetadata',this.e.onvLoadedMetadata);this._mediaElement.removeEventListener('seeking',this.e.onvSeeking);this._mediaElement.removeEventListener('canplay',this.e.onvCanPlay);this._mediaElement.removeEventListener('stalled',this.e.onvStalled);this._mediaElement.removeEventListener('progress',this.e.onvProgress);this._mediaElement=null;}if(this._msectl){this._msectl.destroy();this._msectl=null;}};FlvPlayer.prototype.load=function(){var _this=this;if(!this._mediaElement){throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_10__.IllegalStateException('HTMLMediaElement must be attached before load()!');}if(this._transmuxer){throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_10__.IllegalStateException('FlvPlayer.load() has been called, please call unload() first!');}if(this._hasPendingLoad){return;}if(this._config.deferLoadAfterSourceOpen&&this._mseSourceOpened===false){this._hasPendingLoad=true;return;}if(this._mediaElement.readyState>0){this._requestSetTime=true;// IE11 may throw InvalidStateError if readyState === 0
this._mediaElement.currentTime=0;}this._transmuxer=new _core_transmuxer_js__WEBPACK_IMPORTED_MODULE_4__.default(this._mediaDataSource,this._config);this._transmuxer.on(_core_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.INIT_SEGMENT,function(type,is){_this._msectl.appendInitSegment(is);});this._transmuxer.on(_core_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.MEDIA_SEGMENT,function(type,ms){_this._msectl.appendMediaSegment(ms);// lazyLoad check
if(_this._config.lazyLoad&&!_this._config.isLive){var currentTime=_this._mediaElement.currentTime;if(ms.info.endDts>=(currentTime+_this._config.lazyLoadMaxDuration)*1000){if(_this._progressChecker==null){_utils_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.v(_this.TAG,'Maximum buffering duration exceeded, suspend transmuxing task');_this._suspendTransmuxer();}}}});this._transmuxer.on(_core_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.LOADING_COMPLETE,function(){_this._msectl.endOfStream();_this._emitter.emit(_player_events_js__WEBPACK_IMPORTED_MODULE_3__.default.LOADING_COMPLETE);});this._transmuxer.on(_core_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.RECOVERED_EARLY_EOF,function(){_this._emitter.emit(_player_events_js__WEBPACK_IMPORTED_MODULE_3__.default.RECOVERED_EARLY_EOF);});this._transmuxer.on(_core_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.IO_ERROR,function(detail,info){_this._emitter.emit(_player_events_js__WEBPACK_IMPORTED_MODULE_3__.default.ERROR,_player_errors_js__WEBPACK_IMPORTED_MODULE_8__.ErrorTypes.NETWORK_ERROR,detail,info);});this._transmuxer.on(_core_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.DEMUX_ERROR,function(detail,info){_this._emitter.emit(_player_events_js__WEBPACK_IMPORTED_MODULE_3__.default.ERROR,_player_errors_js__WEBPACK_IMPORTED_MODULE_8__.ErrorTypes.MEDIA_ERROR,detail,{code:-1,msg:info});});this._transmuxer.on(_core_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.MEDIA_INFO,function(mediaInfo){_this._mediaInfo=mediaInfo;_this._emitter.emit(_player_events_js__WEBPACK_IMPORTED_MODULE_3__.default.MEDIA_INFO,Object.assign({},mediaInfo));});this._transmuxer.on(_core_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.METADATA_ARRIVED,function(metadata){_this._emitter.emit(_player_events_js__WEBPACK_IMPORTED_MODULE_3__.default.METADATA_ARRIVED,metadata);});this._transmuxer.on(_core_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.SCRIPTDATA_ARRIVED,function(data){_this._emitter.emit(_player_events_js__WEBPACK_IMPORTED_MODULE_3__.default.SCRIPTDATA_ARRIVED,data);});this._transmuxer.on(_core_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.STATISTICS_INFO,function(statInfo){_this._statisticsInfo=_this._fillStatisticsInfo(statInfo);_this._emitter.emit(_player_events_js__WEBPACK_IMPORTED_MODULE_3__.default.STATISTICS_INFO,Object.assign({},_this._statisticsInfo));});this._transmuxer.on(_core_transmuxing_events_js__WEBPACK_IMPORTED_MODULE_5__.default.RECOMMEND_SEEKPOINT,function(milliseconds){if(_this._mediaElement&&!_this._config.accurateSeek){_this._requestSetTime=true;_this._mediaElement.currentTime=milliseconds/1000;}});this._transmuxer.open();};FlvPlayer.prototype.unload=function(){if(this._mediaElement){this._mediaElement.pause();}if(this._msectl){this._msectl.seek(0);}if(this._transmuxer){this._transmuxer.close();this._transmuxer.destroy();this._transmuxer=null;}};FlvPlayer.prototype.play=function(){return this._mediaElement.play();};FlvPlayer.prototype.pause=function(){this._mediaElement.pause();};Object.defineProperty(FlvPlayer.prototype,"type",{get:function get(){return this._type;},enumerable:false,configurable:true});Object.defineProperty(FlvPlayer.prototype,"buffered",{get:function get(){return this._mediaElement.buffered;},enumerable:false,configurable:true});Object.defineProperty(FlvPlayer.prototype,"duration",{get:function get(){return this._mediaElement.duration;},enumerable:false,configurable:true});Object.defineProperty(FlvPlayer.prototype,"volume",{get:function get(){return this._mediaElement.volume;},set:function set(value){this._mediaElement.volume=value;},enumerable:false,configurable:true});Object.defineProperty(FlvPlayer.prototype,"muted",{get:function get(){return this._mediaElement.muted;},set:function set(muted){this._mediaElement.muted=muted;},enumerable:false,configurable:true});Object.defineProperty(FlvPlayer.prototype,"currentTime",{get:function get(){if(this._mediaElement){return this._mediaElement.currentTime;}return 0;},set:function set(seconds){if(this._mediaElement){this._internalSeek(seconds);}else{this._pendingSeekTime=seconds;}},enumerable:false,configurable:true});Object.defineProperty(FlvPlayer.prototype,"mediaInfo",{get:function get(){return Object.assign({},this._mediaInfo);},enumerable:false,configurable:true});Object.defineProperty(FlvPlayer.prototype,"statisticsInfo",{get:function get(){if(this._statisticsInfo==null){this._statisticsInfo={};}this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo);return Object.assign({},this._statisticsInfo);},enumerable:false,configurable:true});FlvPlayer.prototype._fillStatisticsInfo=function(statInfo){statInfo.playerType=this._type;if(!(this._mediaElement instanceof HTMLVideoElement)){return statInfo;}var hasQualityInfo=true;var decoded=0;var dropped=0;if(this._mediaElement.getVideoPlaybackQuality){var quality=this._mediaElement.getVideoPlaybackQuality();decoded=quality.totalVideoFrames;dropped=quality.droppedVideoFrames;}else if(this._mediaElement.webkitDecodedFrameCount!=undefined){decoded=this._mediaElement.webkitDecodedFrameCount;dropped=this._mediaElement.webkitDroppedFrameCount;}else{hasQualityInfo=false;}if(hasQualityInfo){statInfo.decodedFrames=decoded;statInfo.droppedFrames=dropped;}return statInfo;};FlvPlayer.prototype._onmseUpdateEnd=function(){if(!this._config.lazyLoad||this._config.isLive){return;}var buffered=this._mediaElement.buffered;var currentTime=this._mediaElement.currentTime;var currentRangeEnd=0;for(var i=0;i<buffered.length;i++){var start=buffered.start(i);var end=buffered.end(i);if(start<=currentTime&&currentTime<end){currentRangeEnd=end;break;}}if(currentRangeEnd>=currentTime+this._config.lazyLoadMaxDuration&&this._progressChecker==null){_utils_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.v(this.TAG,'Maximum buffering duration exceeded, suspend transmuxing task');this._suspendTransmuxer();}};FlvPlayer.prototype._onmseBufferFull=function(){_utils_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.v(this.TAG,'MSE SourceBuffer is full, suspend transmuxing task');if(this._progressChecker==null){this._suspendTransmuxer();}};FlvPlayer.prototype._suspendTransmuxer=function(){if(this._transmuxer){this._transmuxer.pause();if(this._progressChecker==null){this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1000);}}};FlvPlayer.prototype._checkProgressAndResume=function(){var currentTime=this._mediaElement.currentTime;var buffered=this._mediaElement.buffered;var needResume=false;for(var i=0;i<buffered.length;i++){var from=buffered.start(i);var to=buffered.end(i);if(currentTime>=from&&currentTime<to){if(currentTime>=to-this._config.lazyLoadRecoverDuration){needResume=true;}break;}}if(needResume){window.clearInterval(this._progressChecker);this._progressChecker=null;if(needResume){_utils_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.v(this.TAG,'Continue loading from paused position');this._transmuxer.resume();}}};FlvPlayer.prototype._isTimepointBuffered=function(seconds){var buffered=this._mediaElement.buffered;for(var i=0;i<buffered.length;i++){var from=buffered.start(i);var to=buffered.end(i);if(seconds>=from&&seconds<to){return true;}}return false;};FlvPlayer.prototype._internalSeek=function(seconds){var directSeek=this._isTimepointBuffered(seconds);var directSeekBegin=false;var directSeekBeginTime=0;if(seconds<1.0&&this._mediaElement.buffered.length>0){var videoBeginTime=this._mediaElement.buffered.start(0);if(videoBeginTime<1.0&&seconds<videoBeginTime||_utils_browser_js__WEBPACK_IMPORTED_MODULE_2__.default.safari){directSeekBegin=true;// also workaround for Safari: Seek to 0 may cause video stuck, use 0.1 to avoid
directSeekBeginTime=_utils_browser_js__WEBPACK_IMPORTED_MODULE_2__.default.safari?0.1:videoBeginTime;}}if(directSeekBegin){// seek to video begin, set currentTime directly if beginPTS buffered
this._requestSetTime=true;this._mediaElement.currentTime=directSeekBeginTime;}else if(directSeek){// buffered position
if(!this._alwaysSeekKeyframe){this._requestSetTime=true;this._mediaElement.currentTime=seconds;}else{var idr=this._msectl.getNearestKeyframe(Math.floor(seconds*1000));this._requestSetTime=true;if(idr!=null){this._mediaElement.currentTime=idr.dts/1000;}else{this._mediaElement.currentTime=seconds;}}if(this._progressChecker!=null){this._checkProgressAndResume();}}else{if(this._progressChecker!=null){window.clearInterval(this._progressChecker);this._progressChecker=null;}this._msectl.seek(seconds);this._transmuxer.seek(Math.floor(seconds*1000));// in milliseconds
// no need to set mediaElement.currentTime if non-accurateSeek,
// just wait for the recommend_seekpoint callback
if(this._config.accurateSeek){this._requestSetTime=true;this._mediaElement.currentTime=seconds;}}};FlvPlayer.prototype._checkAndApplyUnbufferedSeekpoint=function(){if(this._seekpointRecord){if(this._seekpointRecord.recordTime<=this._now()-100){var target=this._mediaElement.currentTime;this._seekpointRecord=null;if(!this._isTimepointBuffered(target)){if(this._progressChecker!=null){window.clearTimeout(this._progressChecker);this._progressChecker=null;}// .currentTime is consists with .buffered timestamp
// Chrome/Edge use DTS, while FireFox/Safari use PTS
this._msectl.seek(target);this._transmuxer.seek(Math.floor(target*1000));// set currentTime if accurateSeek, or wait for recommend_seekpoint callback
if(this._config.accurateSeek){this._requestSetTime=true;this._mediaElement.currentTime=target;}}}else{window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50);}}};FlvPlayer.prototype._checkAndResumeStuckPlayback=function(stalled){var media=this._mediaElement;if(stalled||!this._receivedCanPlay||media.readyState<2){// HAVE_CURRENT_DATA
var buffered=media.buffered;if(buffered.length>0&&media.currentTime<buffered.start(0)){_utils_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.w(this.TAG,"Playback seems stuck at "+media.currentTime+", seek to "+buffered.start(0));this._requestSetTime=true;this._mediaElement.currentTime=buffered.start(0);this._mediaElement.removeEventListener('progress',this.e.onvProgress);}}else{// Playback didn't stuck, remove progress event listener
this._mediaElement.removeEventListener('progress',this.e.onvProgress);}};FlvPlayer.prototype._onvLoadedMetadata=function(e){if(this._pendingSeekTime!=null){this._mediaElement.currentTime=this._pendingSeekTime;this._pendingSeekTime=null;}};FlvPlayer.prototype._onvSeeking=function(e){var target=this._mediaElement.currentTime;var buffered=this._mediaElement.buffered;if(this._requestSetTime){this._requestSetTime=false;return;}if(target<1.0&&buffered.length>0){// seek to video begin, set currentTime directly if beginPTS buffered
var videoBeginTime=buffered.start(0);if(videoBeginTime<1.0&&target<videoBeginTime||_utils_browser_js__WEBPACK_IMPORTED_MODULE_2__.default.safari){this._requestSetTime=true;// also workaround for Safari: Seek to 0 may cause video stuck, use 0.1 to avoid
this._mediaElement.currentTime=_utils_browser_js__WEBPACK_IMPORTED_MODULE_2__.default.safari?0.1:videoBeginTime;return;}}if(this._isTimepointBuffered(target)){if(this._alwaysSeekKeyframe){var idr=this._msectl.getNearestKeyframe(Math.floor(target*1000));if(idr!=null){this._requestSetTime=true;this._mediaElement.currentTime=idr.dts/1000;}}if(this._progressChecker!=null){this._checkProgressAndResume();}return;}this._seekpointRecord={seekPoint:target,recordTime:this._now()};window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50);};FlvPlayer.prototype._onvCanPlay=function(e){this._receivedCanPlay=true;this._mediaElement.removeEventListener('canplay',this.e.onvCanPlay);};FlvPlayer.prototype._onvStalled=function(e){this._checkAndResumeStuckPlayback(true);};FlvPlayer.prototype._onvProgress=function(e){this._checkAndResumeStuckPlayback();};return FlvPlayer;}();/* harmony default export */__webpack_exports__["default"]=FlvPlayer;/***/},/***/"./src/player/native-player.js":/*!*************************************!*\
			  !*** ./src/player/native-player.js ***!
			  \*************************************/ /***/function srcPlayerNativePlayerJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var events__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! events */"./node_modules/events/events.js");/* harmony import */var events__WEBPACK_IMPORTED_MODULE_0___default=/*#__PURE__*/__webpack_require__.n(events__WEBPACK_IMPORTED_MODULE_0__);/* harmony import */var _player_events_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ./player-events.js */"./src/player/player-events.js");/* harmony import */var _config_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../config.js */"./src/config.js");/* harmony import */var _utils_exception_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ../utils/exception.js */"./src/utils/exception.js");/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */ // Player wrapper for browser's native player (HTMLVideoElement) without MediaSource src. 
var NativePlayer=/** @class */function(){function NativePlayer(mediaDataSource,config){this.TAG='NativePlayer';this._type='NativePlayer';this._emitter=new(events__WEBPACK_IMPORTED_MODULE_0___default())();this._config=(0,_config_js__WEBPACK_IMPORTED_MODULE_2__.createDefaultConfig)();if(_typeof3(config)==='object'){Object.assign(this._config,config);}if(mediaDataSource.type.toLowerCase()==='flv'){throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_3__.InvalidArgumentException('NativePlayer does\'t support flv MediaDataSource input!');}if(mediaDataSource.hasOwnProperty('segments')){throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_3__.InvalidArgumentException("NativePlayer("+mediaDataSource.type+") doesn't support multipart playback!");}this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)};this._pendingSeekTime=null;this._statisticsReporter=null;this._mediaDataSource=mediaDataSource;this._mediaElement=null;}NativePlayer.prototype.destroy=function(){if(this._mediaElement){this.unload();this.detachMediaElement();}this.e=null;this._mediaDataSource=null;this._emitter.removeAllListeners();this._emitter=null;};NativePlayer.prototype.on=function(event,listener){var _this=this;if(event===_player_events_js__WEBPACK_IMPORTED_MODULE_1__.default.MEDIA_INFO){if(this._mediaElement!=null&&this._mediaElement.readyState!==0){// HAVE_NOTHING
Promise.resolve().then(function(){_this._emitter.emit(_player_events_js__WEBPACK_IMPORTED_MODULE_1__.default.MEDIA_INFO,_this.mediaInfo);});}}else if(event===_player_events_js__WEBPACK_IMPORTED_MODULE_1__.default.STATISTICS_INFO){if(this._mediaElement!=null&&this._mediaElement.readyState!==0){Promise.resolve().then(function(){_this._emitter.emit(_player_events_js__WEBPACK_IMPORTED_MODULE_1__.default.STATISTICS_INFO,_this.statisticsInfo);});}}this._emitter.addListener(event,listener);};NativePlayer.prototype.off=function(event,listener){this._emitter.removeListener(event,listener);};NativePlayer.prototype.attachMediaElement=function(mediaElement){this._mediaElement=mediaElement;mediaElement.addEventListener('loadedmetadata',this.e.onvLoadedMetadata);if(this._pendingSeekTime!=null){try{mediaElement.currentTime=this._pendingSeekTime;this._pendingSeekTime=null;}catch(e){// IE11 may throw InvalidStateError if readyState === 0
// Defer set currentTime operation after loadedmetadata
}}};NativePlayer.prototype.detachMediaElement=function(){if(this._mediaElement){this._mediaElement.src='';this._mediaElement.removeAttribute('src');this._mediaElement.removeEventListener('loadedmetadata',this.e.onvLoadedMetadata);this._mediaElement=null;}if(this._statisticsReporter!=null){window.clearInterval(this._statisticsReporter);this._statisticsReporter=null;}};NativePlayer.prototype.load=function(){if(!this._mediaElement){throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_3__.IllegalStateException('HTMLMediaElement must be attached before load()!');}this._mediaElement.src=this._mediaDataSource.url;if(this._mediaElement.readyState>0){this._mediaElement.currentTime=0;}this._mediaElement.preload='auto';this._mediaElement.load();this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval);};NativePlayer.prototype.unload=function(){if(this._mediaElement){this._mediaElement.src='';this._mediaElement.removeAttribute('src');}if(this._statisticsReporter!=null){window.clearInterval(this._statisticsReporter);this._statisticsReporter=null;}};NativePlayer.prototype.play=function(){return this._mediaElement.play();};NativePlayer.prototype.pause=function(){this._mediaElement.pause();};Object.defineProperty(NativePlayer.prototype,"type",{get:function get(){return this._type;},enumerable:false,configurable:true});Object.defineProperty(NativePlayer.prototype,"buffered",{get:function get(){return this._mediaElement.buffered;},enumerable:false,configurable:true});Object.defineProperty(NativePlayer.prototype,"duration",{get:function get(){return this._mediaElement.duration;},enumerable:false,configurable:true});Object.defineProperty(NativePlayer.prototype,"volume",{get:function get(){return this._mediaElement.volume;},set:function set(value){this._mediaElement.volume=value;},enumerable:false,configurable:true});Object.defineProperty(NativePlayer.prototype,"muted",{get:function get(){return this._mediaElement.muted;},set:function set(muted){this._mediaElement.muted=muted;},enumerable:false,configurable:true});Object.defineProperty(NativePlayer.prototype,"currentTime",{get:function get(){if(this._mediaElement){return this._mediaElement.currentTime;}return 0;},set:function set(seconds){if(this._mediaElement){this._mediaElement.currentTime=seconds;}else{this._pendingSeekTime=seconds;}},enumerable:false,configurable:true});Object.defineProperty(NativePlayer.prototype,"mediaInfo",{get:function get(){var mediaPrefix=this._mediaElement instanceof HTMLAudioElement?'audio/':'video/';var info={mimeType:mediaPrefix+this._mediaDataSource.type};if(this._mediaElement){info.duration=Math.floor(this._mediaElement.duration*1000);if(this._mediaElement instanceof HTMLVideoElement){info.width=this._mediaElement.videoWidth;info.height=this._mediaElement.videoHeight;}}return info;},enumerable:false,configurable:true});Object.defineProperty(NativePlayer.prototype,"statisticsInfo",{get:function get(){var info={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement)){return info;}var hasQualityInfo=true;var decoded=0;var dropped=0;if(this._mediaElement.getVideoPlaybackQuality){var quality=this._mediaElement.getVideoPlaybackQuality();decoded=quality.totalVideoFrames;dropped=quality.droppedVideoFrames;}else if(this._mediaElement.webkitDecodedFrameCount!=undefined){decoded=this._mediaElement.webkitDecodedFrameCount;dropped=this._mediaElement.webkitDroppedFrameCount;}else{hasQualityInfo=false;}if(hasQualityInfo){info.decodedFrames=decoded;info.droppedFrames=dropped;}return info;},enumerable:false,configurable:true});NativePlayer.prototype._onvLoadedMetadata=function(e){if(this._pendingSeekTime!=null){this._mediaElement.currentTime=this._pendingSeekTime;this._pendingSeekTime=null;}this._emitter.emit(_player_events_js__WEBPACK_IMPORTED_MODULE_1__.default.MEDIA_INFO,this.mediaInfo);};NativePlayer.prototype._reportStatisticsInfo=function(){this._emitter.emit(_player_events_js__WEBPACK_IMPORTED_MODULE_1__.default.STATISTICS_INFO,this.statisticsInfo);};return NativePlayer;}();/* harmony default export */__webpack_exports__["default"]=NativePlayer;/***/},/***/"./src/player/player-errors.js":/*!*************************************!*\
			  !*** ./src/player/player-errors.js ***!
			  \*************************************/ /***/function srcPlayerPlayerErrorsJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export */__webpack_require__.d(__webpack_exports__,{/* harmony export */"ErrorTypes":function ErrorTypes(){return(/* binding */_ErrorTypes);},/* harmony export */"ErrorDetails":function ErrorDetails(){return(/* binding */_ErrorDetails);}/* harmony export */});/* harmony import */var _io_loader_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../io/loader.js */"./src/io/loader.js");/* harmony import */var _demux_demux_errors_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../demux/demux-errors.js */"./src/demux/demux-errors.js");/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */var _ErrorTypes={NETWORK_ERROR:'NetworkError',MEDIA_ERROR:'MediaError',OTHER_ERROR:'OtherError'};var _ErrorDetails={NETWORK_EXCEPTION:_io_loader_js__WEBPACK_IMPORTED_MODULE_0__.LoaderErrors.EXCEPTION,NETWORK_STATUS_CODE_INVALID:_io_loader_js__WEBPACK_IMPORTED_MODULE_0__.LoaderErrors.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:_io_loader_js__WEBPACK_IMPORTED_MODULE_0__.LoaderErrors.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:_io_loader_js__WEBPACK_IMPORTED_MODULE_0__.LoaderErrors.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:'MediaMSEError',MEDIA_FORMAT_ERROR:_demux_demux_errors_js__WEBPACK_IMPORTED_MODULE_1__.default.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:_demux_demux_errors_js__WEBPACK_IMPORTED_MODULE_1__.default.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:_demux_demux_errors_js__WEBPACK_IMPORTED_MODULE_1__.default.CODEC_UNSUPPORTED};/***/},/***/"./src/player/player-events.js":/*!*************************************!*\
			  !*** ./src/player/player-events.js ***!
			  \*************************************/ /***/function srcPlayerPlayerEventsJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */var PlayerEvents={ERROR:'error',LOADING_COMPLETE:'loading_complete',RECOVERED_EARLY_EOF:'recovered_early_eof',MEDIA_INFO:'media_info',METADATA_ARRIVED:'metadata_arrived',SCRIPTDATA_ARRIVED:'scriptdata_arrived',STATISTICS_INFO:'statistics_info'};/* harmony default export */__webpack_exports__["default"]=PlayerEvents;/***/},/***/"./src/remux/aac-silent.js":/*!*********************************!*\
			  !*** ./src/remux/aac-silent.js ***!
			  \*********************************/ /***/function srcRemuxAacSilentJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * This file is modified from dailymotion's hls.js library (hls.js/src/helper/aac.js)
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */var AAC=/** @class */function(){function AAC(){}AAC.getSilentFrame=function(codec,channelCount){if(codec==='mp4a.40.2'){// handle LC-AAC
if(channelCount===1){return new Uint8Array([0x00,0xc8,0x00,0x80,0x23,0x80]);}else if(channelCount===2){return new Uint8Array([0x21,0x00,0x49,0x90,0x02,0x19,0x00,0x23,0x80]);}else if(channelCount===3){return new Uint8Array([0x00,0xc8,0x00,0x80,0x20,0x84,0x01,0x26,0x40,0x08,0x64,0x00,0x8e]);}else if(channelCount===4){return new Uint8Array([0x00,0xc8,0x00,0x80,0x20,0x84,0x01,0x26,0x40,0x08,0x64,0x00,0x80,0x2c,0x80,0x08,0x02,0x38]);}else if(channelCount===5){return new Uint8Array([0x00,0xc8,0x00,0x80,0x20,0x84,0x01,0x26,0x40,0x08,0x64,0x00,0x82,0x30,0x04,0x99,0x00,0x21,0x90,0x02,0x38]);}else if(channelCount===6){return new Uint8Array([0x00,0xc8,0x00,0x80,0x20,0x84,0x01,0x26,0x40,0x08,0x64,0x00,0x82,0x30,0x04,0x99,0x00,0x21,0x90,0x02,0x00,0xb2,0x00,0x20,0x08,0xe0]);}}else{// handle HE-AAC (mp4a.40.5 / mp4a.40.29)
if(channelCount===1){// ffmpeg -y -f lavfi -i "aevalsrc=0:d=0.05" -c:a libfdk_aac -profile:a aac_he -b:a 4k output.aac && hexdump -v -e '16/1 "0x%x," "\n"' -v output.aac
return new Uint8Array([0x1,0x40,0x22,0x80,0xa3,0x4e,0xe6,0x80,0xba,0x8,0x0,0x0,0x0,0x1c,0x6,0xf1,0xc1,0xa,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5e]);}else if(channelCount===2){// ffmpeg -y -f lavfi -i "aevalsrc=0|0:d=0.05" -c:a libfdk_aac -profile:a aac_he_v2 -b:a 4k output.aac && hexdump -v -e '16/1 "0x%x," "\n"' -v output.aac
return new Uint8Array([0x1,0x40,0x22,0x80,0xa3,0x5e,0xe6,0x80,0xba,0x8,0x0,0x0,0x0,0x0,0x95,0x0,0x6,0xf1,0xa1,0xa,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5e]);}else if(channelCount===3){// ffmpeg -y -f lavfi -i "aevalsrc=0|0|0:d=0.05" -c:a libfdk_aac -profile:a aac_he_v2 -b:a 4k output.aac && hexdump -v -e '16/1 "0x%x," "\n"' -v output.aac
return new Uint8Array([0x1,0x40,0x22,0x80,0xa3,0x5e,0xe6,0x80,0xba,0x8,0x0,0x0,0x0,0x0,0x95,0x0,0x6,0xf1,0xa1,0xa,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5e]);}}return null;};return AAC;}();/* harmony default export */__webpack_exports__["default"]=AAC;/***/},/***/"./src/remux/mp4-generator.js":/*!************************************!*\
			  !*** ./src/remux/mp4-generator.js ***!
			  \************************************/ /***/function srcRemuxMp4GeneratorJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * This file is derived from dailymotion's hls.js library (hls.js/src/remux/mp4-generator.js)
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */ //  MP4 boxes generator for ISO BMFF (ISO Base Media File Format, defined in ISO/IEC 14496-12)
var MP4=/** @class */function(){function MP4(){}MP4.init=function(){MP4.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],'.mp3':[]};for(var name_1 in MP4.types){if(MP4.types.hasOwnProperty(name_1)){MP4.types[name_1]=[name_1.charCodeAt(0),name_1.charCodeAt(1),name_1.charCodeAt(2),name_1.charCodeAt(3)];}}var constants=MP4.constants={};constants.FTYP=new Uint8Array([0x69,0x73,0x6F,0x6D,0x0,0x0,0x0,0x1,0x69,0x73,0x6F,0x6D,0x61,0x76,0x63,0x31// avc1
]);constants.STSD_PREFIX=new Uint8Array([0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01// entry_count
]);constants.STTS=new Uint8Array([0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00// entry_count
]);constants.STSC=constants.STCO=constants.STTS;constants.STSZ=new Uint8Array([0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00// sample_count
]);constants.HDLR_VIDEO=new Uint8Array([0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x76,0x69,0x64,0x65,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x56,0x69,0x64,0x65,0x6F,0x48,0x61,0x6E,0x64,0x6C,0x65,0x72,0x00// name: VideoHandler
]);constants.HDLR_AUDIO=new Uint8Array([0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x73,0x6F,0x75,0x6E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x53,0x6F,0x75,0x6E,0x64,0x48,0x61,0x6E,0x64,0x6C,0x65,0x72,0x00// name: SoundHandler
]);constants.DREF=new Uint8Array([0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x0C,0x75,0x72,0x6C,0x20,0x00,0x00,0x00,0x01// version(0) + flags
]);// Sound media header
constants.SMHD=new Uint8Array([0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00// balance(2) + reserved(2)
]);// video media header
constants.VMHD=new Uint8Array([0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00]);};// Generate a box
MP4.box=function(type){var size=8;var result=null;var datas=Array.prototype.slice.call(arguments,1);var arrayCount=datas.length;for(var i=0;i<arrayCount;i++){size+=datas[i].byteLength;}result=new Uint8Array(size);result[0]=size>>>24&0xFF;// size
result[1]=size>>>16&0xFF;result[2]=size>>>8&0xFF;result[3]=size&0xFF;result.set(type,4);// type
var offset=8;for(var i=0;i<arrayCount;i++){// data body
result.set(datas[i],offset);offset+=datas[i].byteLength;}return result;};// emit ftyp & moov
MP4.generateInitSegment=function(meta){var ftyp=MP4.box(MP4.types.ftyp,MP4.constants.FTYP);var moov=MP4.moov(meta);var result=new Uint8Array(ftyp.byteLength+moov.byteLength);result.set(ftyp,0);result.set(moov,ftyp.byteLength);return result;};// Movie metadata box
MP4.moov=function(meta){var mvhd=MP4.mvhd(meta.timescale,meta.duration);var trak=MP4.trak(meta);var mvex=MP4.mvex(meta);return MP4.box(MP4.types.moov,mvhd,trak,mvex);};// Movie header box
MP4.mvhd=function(timescale,duration){return MP4.box(MP4.types.mvhd,new Uint8Array([0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,timescale>>>24&0xFF,timescale>>>16&0xFF,timescale>>>8&0xFF,timescale&0xFF,duration>>>24&0xFF,duration>>>16&0xFF,duration>>>8&0xFF,duration&0xFF,0x00,0x01,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF// next_track_ID
]));};// Track box
MP4.trak=function(meta){return MP4.box(MP4.types.trak,MP4.tkhd(meta),MP4.mdia(meta));};// Track header box
MP4.tkhd=function(meta){var trackId=meta.id,duration=meta.duration;var width=meta.presentWidth,height=meta.presentHeight;return MP4.box(MP4.types.tkhd,new Uint8Array([0x00,0x00,0x00,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,trackId>>>24&0xFF,trackId>>>16&0xFF,trackId>>>8&0xFF,trackId&0xFF,0x00,0x00,0x00,0x00,duration>>>24&0xFF,duration>>>16&0xFF,duration>>>8&0xFF,duration&0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x00,0x00,0x00,width>>>8&0xFF,width&0xFF,0x00,0x00,height>>>8&0xFF,height&0xFF,0x00,0x00]));};// Media Box
MP4.mdia=function(meta){return MP4.box(MP4.types.mdia,MP4.mdhd(meta),MP4.hdlr(meta),MP4.minf(meta));};// Media header box
MP4.mdhd=function(meta){var timescale=meta.timescale;var duration=meta.duration;return MP4.box(MP4.types.mdhd,new Uint8Array([0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,timescale>>>24&0xFF,timescale>>>16&0xFF,timescale>>>8&0xFF,timescale&0xFF,duration>>>24&0xFF,duration>>>16&0xFF,duration>>>8&0xFF,duration&0xFF,0x55,0xC4,0x00,0x00// pre_defined = 0
]));};// Media handler reference box
MP4.hdlr=function(meta){var data=null;if(meta.type==='audio'){data=MP4.constants.HDLR_AUDIO;}else{data=MP4.constants.HDLR_VIDEO;}return MP4.box(MP4.types.hdlr,data);};// Media infomation box
MP4.minf=function(meta){var xmhd=null;if(meta.type==='audio'){xmhd=MP4.box(MP4.types.smhd,MP4.constants.SMHD);}else{xmhd=MP4.box(MP4.types.vmhd,MP4.constants.VMHD);}return MP4.box(MP4.types.minf,xmhd,MP4.dinf(),MP4.stbl(meta));};// Data infomation box
MP4.dinf=function(){var result=MP4.box(MP4.types.dinf,MP4.box(MP4.types.dref,MP4.constants.DREF));return result;};// Sample table box
MP4.stbl=function(meta){var result=MP4.box(MP4.types.stbl,// type: stbl
MP4.stsd(meta),// Sample Description Table
MP4.box(MP4.types.stts,MP4.constants.STTS),// Time-To-Sample
MP4.box(MP4.types.stsc,MP4.constants.STSC),// Sample-To-Chunk
MP4.box(MP4.types.stsz,MP4.constants.STSZ),// Sample size
MP4.box(MP4.types.stco,MP4.constants.STCO)// Chunk offset
);return result;};// Sample description box
MP4.stsd=function(meta){if(meta.type==='audio'){if(meta.codec==='mp3'){return MP4.box(MP4.types.stsd,MP4.constants.STSD_PREFIX,MP4.mp3(meta));}// else: aac -> mp4a
return MP4.box(MP4.types.stsd,MP4.constants.STSD_PREFIX,MP4.mp4a(meta));}else{return MP4.box(MP4.types.stsd,MP4.constants.STSD_PREFIX,MP4.avc1(meta));}};MP4.mp3=function(meta){var channelCount=meta.channelCount;var sampleRate=meta.audioSampleRate;var data=new Uint8Array([0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,channelCount,0x00,0x10,0x00,0x00,0x00,0x00,sampleRate>>>8&0xFF,sampleRate&0xFF,0x00,0x00]);return MP4.box(MP4.types['.mp3'],data);};MP4.mp4a=function(meta){var channelCount=meta.channelCount;var sampleRate=meta.audioSampleRate;var data=new Uint8Array([0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,channelCount,0x00,0x10,0x00,0x00,0x00,0x00,sampleRate>>>8&0xFF,sampleRate&0xFF,0x00,0x00]);return MP4.box(MP4.types.mp4a,data,MP4.esds(meta));};MP4.esds=function(meta){var config=meta.config||[];var configSize=config.length;var data=new Uint8Array([0x00,0x00,0x00,0x00,0x03,0x17+configSize,0x00,0x01,0x00,0x04,0x0F+configSize,0x40,0x15,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x05// descriptor_type
].concat([configSize]).concat(config).concat([0x06,0x01,0x02// GASpecificConfig
]));return MP4.box(MP4.types.esds,data);};MP4.avc1=function(meta){var avcc=meta.avcc;var width=meta.codecWidth,height=meta.codecHeight;var data=new Uint8Array([0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,width>>>8&0xFF,width&0xFF,height>>>8&0xFF,height&0xFF,0x00,0x48,0x00,0x00,0x00,0x48,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x0A,0x78,0x71,0x71,0x2F,0x66,0x6C,0x76,0x2E,0x6A,0x73,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0xFF,0xFF// pre_defined = -1
]);return MP4.box(MP4.types.avc1,data,MP4.box(MP4.types.avcC,avcc));};// Movie Extends box
MP4.mvex=function(meta){return MP4.box(MP4.types.mvex,MP4.trex(meta));};// Track Extends box
MP4.trex=function(meta){var trackId=meta.id;var data=new Uint8Array([0x00,0x00,0x00,0x00,trackId>>>24&0xFF,trackId>>>16&0xFF,trackId>>>8&0xFF,trackId&0xFF,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x01// default_sample_flags
]);return MP4.box(MP4.types.trex,data);};// Movie fragment box
MP4.moof=function(track,baseMediaDecodeTime){return MP4.box(MP4.types.moof,MP4.mfhd(track.sequenceNumber),MP4.traf(track,baseMediaDecodeTime));};MP4.mfhd=function(sequenceNumber){var data=new Uint8Array([0x00,0x00,0x00,0x00,sequenceNumber>>>24&0xFF,sequenceNumber>>>16&0xFF,sequenceNumber>>>8&0xFF,sequenceNumber&0xFF]);return MP4.box(MP4.types.mfhd,data);};// Track fragment box
MP4.traf=function(track,baseMediaDecodeTime){var trackId=track.id;// Track fragment header box
var tfhd=MP4.box(MP4.types.tfhd,new Uint8Array([0x00,0x00,0x00,0x00,trackId>>>24&0xFF,trackId>>>16&0xFF,trackId>>>8&0xFF,trackId&0xFF]));// Track Fragment Decode Time
var tfdt=MP4.box(MP4.types.tfdt,new Uint8Array([0x00,0x00,0x00,0x00,baseMediaDecodeTime>>>24&0xFF,baseMediaDecodeTime>>>16&0xFF,baseMediaDecodeTime>>>8&0xFF,baseMediaDecodeTime&0xFF]));var sdtp=MP4.sdtp(track);var trun=MP4.trun(track,sdtp.byteLength+16+16+8+16+8+8);return MP4.box(MP4.types.traf,tfhd,tfdt,trun,sdtp);};// Sample Dependency Type box
MP4.sdtp=function(track){var samples=track.samples||[];var sampleCount=samples.length;var data=new Uint8Array(4+sampleCount);// 0~4 bytes: version(0) & flags
for(var i=0;i<sampleCount;i++){var flags=samples[i].flags;data[i+4]=flags.isLeading<<6// is_leading: 2 (bit)
|flags.dependsOn<<4// sample_depends_on
|flags.isDependedOn<<2// sample_is_depended_on
|flags.hasRedundancy;// sample_has_redundancy
}return MP4.box(MP4.types.sdtp,data);};// Track fragment run box
MP4.trun=function(track,offset){var samples=track.samples||[];var sampleCount=samples.length;var dataSize=12+16*sampleCount;var data=new Uint8Array(dataSize);offset+=8+dataSize;data.set([0x00,0x00,0x0F,0x01,sampleCount>>>24&0xFF,sampleCount>>>16&0xFF,sampleCount>>>8&0xFF,sampleCount&0xFF,offset>>>24&0xFF,offset>>>16&0xFF,offset>>>8&0xFF,offset&0xFF],0);for(var i=0;i<sampleCount;i++){var duration=samples[i].duration;var size=samples[i].size;var flags=samples[i].flags;var cts=samples[i].cts;data.set([duration>>>24&0xFF,duration>>>16&0xFF,duration>>>8&0xFF,duration&0xFF,size>>>24&0xFF,size>>>16&0xFF,size>>>8&0xFF,size&0xFF,flags.isLeading<<2|flags.dependsOn,flags.isDependedOn<<6|flags.hasRedundancy<<4|flags.isNonSync,0x00,0x00,cts>>>24&0xFF,cts>>>16&0xFF,cts>>>8&0xFF,cts&0xFF],12+16*i);}return MP4.box(MP4.types.trun,data);};MP4.mdat=function(data){return MP4.box(MP4.types.mdat,data);};return MP4;}();MP4.init();/* harmony default export */__webpack_exports__["default"]=MP4;/***/},/***/"./src/remux/mp4-remuxer.js":/*!**********************************!*\
			  !*** ./src/remux/mp4-remuxer.js ***!
			  \**********************************/ /***/function srcRemuxMp4RemuxerJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var _utils_logger_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../utils/logger.js */"./src/utils/logger.js");/* harmony import */var _mp4_generator_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ./mp4-generator.js */"./src/remux/mp4-generator.js");/* harmony import */var _aac_silent_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ./aac-silent.js */"./src/remux/aac-silent.js");/* harmony import */var _utils_browser_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ../utils/browser.js */"./src/utils/browser.js");/* harmony import */var _core_media_segment_info_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(/*! ../core/media-segment-info.js */"./src/core/media-segment-info.js");/* harmony import */var _utils_exception_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(/*! ../utils/exception.js */"./src/utils/exception.js");/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */ // Fragmented mp4 remuxer
var MP4Remuxer=/** @class */function(){function MP4Remuxer(config){this.TAG='MP4Remuxer';this._config=config;this._isLive=config.isLive===true?true:false;this._dtsBase=-1;this._dtsBaseInited=false;this._audioDtsBase=Infinity;this._videoDtsBase=Infinity;this._audioNextDts=undefined;this._videoNextDts=undefined;this._audioStashedLastSample=null;this._videoStashedLastSample=null;this._audioMeta=null;this._videoMeta=null;this._audioSegmentInfoList=new _core_media_segment_info_js__WEBPACK_IMPORTED_MODULE_4__.MediaSegmentInfoList('audio');this._videoSegmentInfoList=new _core_media_segment_info_js__WEBPACK_IMPORTED_MODULE_4__.MediaSegmentInfoList('video');this._onInitSegment=null;this._onMediaSegment=null;// Workaround for chrome < 50: Always force first sample as a Random Access Point in media segment
// see https://bugs.chromium.org/p/chromium/issues/detail?id=229412
this._forceFirstIDR=_utils_browser_js__WEBPACK_IMPORTED_MODULE_3__.default.chrome&&(_utils_browser_js__WEBPACK_IMPORTED_MODULE_3__.default.version.major<50||_utils_browser_js__WEBPACK_IMPORTED_MODULE_3__.default.version.major===50&&_utils_browser_js__WEBPACK_IMPORTED_MODULE_3__.default.version.build<2661)?true:false;// Workaround for IE11/Edge: Fill silent aac frame after keyframe-seeking
// Make audio beginDts equals with video beginDts, in order to fix seek freeze
this._fillSilentAfterSeek=_utils_browser_js__WEBPACK_IMPORTED_MODULE_3__.default.msedge||_utils_browser_js__WEBPACK_IMPORTED_MODULE_3__.default.msie;// While only FireFox supports 'audio/mp4, codecs="mp3"', use 'audio/mpeg' for chrome, safari, ...
this._mp3UseMpegAudio=!_utils_browser_js__WEBPACK_IMPORTED_MODULE_3__.default.firefox;this._fillAudioTimestampGap=this._config.fixAudioTimestampGap;}MP4Remuxer.prototype.destroy=function(){this._dtsBase=-1;this._dtsBaseInited=false;this._audioMeta=null;this._videoMeta=null;this._audioSegmentInfoList.clear();this._audioSegmentInfoList=null;this._videoSegmentInfoList.clear();this._videoSegmentInfoList=null;this._onInitSegment=null;this._onMediaSegment=null;};MP4Remuxer.prototype.bindDataSource=function(producer){producer.onDataAvailable=this.remux.bind(this);producer.onTrackMetadata=this._onTrackMetadataReceived.bind(this);return this;};Object.defineProperty(MP4Remuxer.prototype,"onInitSegment",{/* prototype: function onInitSegment(type: string, initSegment: ArrayBuffer): void
			           InitSegment: {
			               type: string,
			               data: ArrayBuffer,
			               codec: string,
			               container: string
			           }
			        */get:function get(){return this._onInitSegment;},set:function set(callback){this._onInitSegment=callback;},enumerable:false,configurable:true});Object.defineProperty(MP4Remuxer.prototype,"onMediaSegment",{/* prototype: function onMediaSegment(type: string, mediaSegment: MediaSegment): void
			           MediaSegment: {
			               type: string,
			               data: ArrayBuffer,
			               sampleCount: int32
			               info: MediaSegmentInfo
			           }
			        */get:function get(){return this._onMediaSegment;},set:function set(callback){this._onMediaSegment=callback;},enumerable:false,configurable:true});MP4Remuxer.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=undefined;};MP4Remuxer.prototype.seek=function(originalDts){this._audioStashedLastSample=null;this._videoStashedLastSample=null;this._videoSegmentInfoList.clear();this._audioSegmentInfoList.clear();};MP4Remuxer.prototype.remux=function(audioTrack,videoTrack){if(!this._onMediaSegment){throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_5__.IllegalStateException('MP4Remuxer: onMediaSegment callback must be specificed!');}if(!this._dtsBaseInited){this._calculateDtsBase(audioTrack,videoTrack);}this._remuxVideo(videoTrack);this._remuxAudio(audioTrack);};MP4Remuxer.prototype._onTrackMetadataReceived=function(type,metadata){var metabox=null;var container='mp4';var codec=metadata.codec;if(type==='audio'){this._audioMeta=metadata;if(metadata.codec==='mp3'&&this._mp3UseMpegAudio){// 'audio/mpeg' for MP3 audio track
container='mpeg';codec='';metabox=new Uint8Array();}else{// 'audio/mp4, codecs="codec"'
metabox=_mp4_generator_js__WEBPACK_IMPORTED_MODULE_1__.default.generateInitSegment(metadata);}}else if(type==='video'){this._videoMeta=metadata;metabox=_mp4_generator_js__WEBPACK_IMPORTED_MODULE_1__.default.generateInitSegment(metadata);}else{return;}// dispatch metabox (Initialization Segment)
if(!this._onInitSegment){throw new _utils_exception_js__WEBPACK_IMPORTED_MODULE_5__.IllegalStateException('MP4Remuxer: onInitSegment callback must be specified!');}this._onInitSegment(type,{type:type,data:metabox.buffer,codec:codec,container:type+"/"+container,mediaDuration:metadata.duration// in timescale 1000 (milliseconds)
});};MP4Remuxer.prototype._calculateDtsBase=function(audioTrack,videoTrack){if(this._dtsBaseInited){return;}if(audioTrack.samples&&audioTrack.samples.length){this._audioDtsBase=audioTrack.samples[0].dts;}if(videoTrack.samples&&videoTrack.samples.length){this._videoDtsBase=videoTrack.samples[0].dts;}this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase);this._dtsBaseInited=true;};MP4Remuxer.prototype.flushStashedSamples=function(){var videoSample=this._videoStashedLastSample;var audioSample=this._audioStashedLastSample;var videoTrack={type:'video',id:1,sequenceNumber:0,samples:[],length:0};if(videoSample!=null){videoTrack.samples.push(videoSample);videoTrack.length=videoSample.length;}var audioTrack={type:'audio',id:2,sequenceNumber:0,samples:[],length:0};if(audioSample!=null){audioTrack.samples.push(audioSample);audioTrack.length=audioSample.length;}this._videoStashedLastSample=null;this._audioStashedLastSample=null;this._remuxVideo(videoTrack,true);this._remuxAudio(audioTrack,true);};MP4Remuxer.prototype._remuxAudio=function(audioTrack,force){if(this._audioMeta==null){return;}var track=audioTrack;var samples=track.samples;var dtsCorrection=undefined;var firstDts=-1,lastDts=-1;var refSampleDuration=this._audioMeta.refSampleDuration;var mpegRawTrack=this._audioMeta.codec==='mp3'&&this._mp3UseMpegAudio;var firstSegmentAfterSeek=this._dtsBaseInited&&this._audioNextDts===undefined;var insertPrefixSilentFrame=false;if(!samples||samples.length===0){return;}if(samples.length===1&&!force){// If [sample count in current batch] === 1 && (force != true)
// Ignore and keep in demuxer's queue
return;}// else if (force === true) do remux
var offset=0;var mdatbox=null;var mdatBytes=0;// calculate initial mdat size
if(mpegRawTrack){// for raw mpeg buffer
offset=0;mdatBytes=track.length;}else{// for fmp4 mdat box
offset=8;// size + type
mdatBytes=8+track.length;}var lastSample=null;// Pop the lastSample and waiting for stash
if(samples.length>1){lastSample=samples.pop();mdatBytes-=lastSample.length;}// Insert [stashed lastSample in the previous batch] to the front
if(this._audioStashedLastSample!=null){var sample=this._audioStashedLastSample;this._audioStashedLastSample=null;samples.unshift(sample);mdatBytes+=sample.length;}// Stash the lastSample of current batch, waiting for next batch
if(lastSample!=null){this._audioStashedLastSample=lastSample;}var firstSampleOriginalDts=samples[0].dts-this._dtsBase;// calculate dtsCorrection
if(this._audioNextDts){dtsCorrection=firstSampleOriginalDts-this._audioNextDts;}else{// this._audioNextDts == undefined
if(this._audioSegmentInfoList.isEmpty()){dtsCorrection=0;if(this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()){if(this._audioMeta.originalCodec!=='mp3'){insertPrefixSilentFrame=true;}}}else{var lastSample_1=this._audioSegmentInfoList.getLastSampleBefore(firstSampleOriginalDts);if(lastSample_1!=null){var distance=firstSampleOriginalDts-(lastSample_1.originalDts+lastSample_1.duration);if(distance<=3){distance=0;}var expectedDts=lastSample_1.dts+lastSample_1.duration+distance;dtsCorrection=firstSampleOriginalDts-expectedDts;}else{// lastSample == null, cannot found
dtsCorrection=0;}}}if(insertPrefixSilentFrame){// align audio segment beginDts to match with current video segment's beginDts
var firstSampleDts=firstSampleOriginalDts-dtsCorrection;var videoSegment=this._videoSegmentInfoList.getLastSegmentBefore(firstSampleOriginalDts);if(videoSegment!=null&&videoSegment.beginDts<firstSampleDts){var silentUnit=_aac_silent_js__WEBPACK_IMPORTED_MODULE_2__.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);if(silentUnit){var dts=videoSegment.beginDts;var silentFrameDuration=firstSampleDts-videoSegment.beginDts;_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.v(this.TAG,"InsertPrefixSilentAudio: dts: "+dts+", duration: "+silentFrameDuration);samples.unshift({unit:silentUnit,dts:dts,pts:dts});mdatBytes+=silentUnit.byteLength;}// silentUnit == null: Cannot generate, skip
}else{insertPrefixSilentFrame=false;}}var mp4Samples=[];// Correct dts for each sample, and calculate sample duration. Then output to mp4Samples
for(var i=0;i<samples.length;i++){var sample=samples[i];var unit=sample.unit;var originalDts=sample.dts-this._dtsBase;var dts=originalDts;var needFillSilentFrames=false;var silentFrames=null;var sampleDuration=0;if(originalDts<-0.001){continue;//pass the first sample with the invalid dts
}if(this._audioMeta.codec!=='mp3'){// for AAC codec, we need to keep dts increase based on refSampleDuration
var curRefDts=originalDts;var maxAudioFramesDrift=3;if(this._audioNextDts){curRefDts=this._audioNextDts;}dtsCorrection=originalDts-curRefDts;if(dtsCorrection<=-maxAudioFramesDrift*refSampleDuration){// If we're overlapping by more than maxAudioFramesDrift number of frame, drop this sample
_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.w(this.TAG,"Dropping 1 audio frame (originalDts: "+originalDts+" ms ,curRefDts: "+curRefDts+" ms)  due to dtsCorrection: "+dtsCorrection+" ms overlap.");continue;}else if(dtsCorrection>=maxAudioFramesDrift*refSampleDuration&&this._fillAudioTimestampGap&&!_utils_browser_js__WEBPACK_IMPORTED_MODULE_3__.default.safari){// Silent frame generation, if large timestamp gap detected && config.fixAudioTimestampGap
needFillSilentFrames=true;// We need to insert silent frames to fill timestamp gap
var frameCount=Math.floor(dtsCorrection/refSampleDuration);_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.w(this.TAG,'Large audio timestamp gap detected, may cause AV sync to drift. '+'Silent frames will be generated to avoid unsync.\n'+("originalDts: "+originalDts+" ms, curRefDts: "+curRefDts+" ms, ")+("dtsCorrection: "+Math.round(dtsCorrection)+" ms, generate: "+frameCount+" frames"));dts=Math.floor(curRefDts);sampleDuration=Math.floor(curRefDts+refSampleDuration)-dts;var silentUnit=_aac_silent_js__WEBPACK_IMPORTED_MODULE_2__.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);if(silentUnit==null){_utils_logger_js__WEBPACK_IMPORTED_MODULE_0__.default.w(this.TAG,'Unable to generate silent frame for '+(this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame"));// Repeat last frame
silentUnit=unit;}silentFrames=[];for(var j=0;j<frameCount;j++){curRefDts=curRefDts+refSampleDuration;var intDts=Math.floor(curRefDts);// change to integer
var intDuration=Math.floor(curRefDts+refSampleDuration)-intDts;var frame={dts:intDts,pts:intDts,cts:0,unit:silentUnit,size:silentUnit.byteLength,duration:intDuration,originalDts:originalDts,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};silentFrames.push(frame);mdatBytes+=frame.size;}this._audioNextDts=curRefDts+refSampleDuration;}else{dts=Math.floor(curRefDts);sampleDuration=Math.floor(curRefDts+refSampleDuration)-dts;this._audioNextDts=curRefDts+refSampleDuration;}}else{// keep the original dts calculate algorithm for mp3
dts=originalDts-dtsCorrection;if(i!==samples.length-1){var nextDts=samples[i+1].dts-this._dtsBase-dtsCorrection;sampleDuration=nextDts-dts;}else{// the last sample
if(lastSample!=null){// use stashed sample's dts to calculate sample duration
var nextDts=lastSample.dts-this._dtsBase-dtsCorrection;sampleDuration=nextDts-dts;}else if(mp4Samples.length>=1){// use second last sample duration
sampleDuration=mp4Samples[mp4Samples.length-1].duration;}else{// the only one sample, use reference sample duration
sampleDuration=Math.floor(refSampleDuration);}}this._audioNextDts=dts+sampleDuration;}if(firstDts===-1){firstDts=dts;}mp4Samples.push({dts:dts,pts:dts,cts:0,unit:sample.unit,size:sample.unit.byteLength,duration:sampleDuration,originalDts:originalDts,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}});if(needFillSilentFrames){// Silent frames should be inserted after wrong-duration frame
mp4Samples.push.apply(mp4Samples,silentFrames);}}if(mp4Samples.length===0){//no samples need to remux
track.samples=[];track.length=0;return;}// allocate mdatbox
if(mpegRawTrack){// allocate for raw mpeg buffer
mdatbox=new Uint8Array(mdatBytes);}else{// allocate for fmp4 mdat box
mdatbox=new Uint8Array(mdatBytes);// size field
mdatbox[0]=mdatBytes>>>24&0xFF;mdatbox[1]=mdatBytes>>>16&0xFF;mdatbox[2]=mdatBytes>>>8&0xFF;mdatbox[3]=mdatBytes&0xFF;// type field (fourCC)
mdatbox.set(_mp4_generator_js__WEBPACK_IMPORTED_MODULE_1__.default.types.mdat,4);}// Write samples into mdatbox
for(var i=0;i<mp4Samples.length;i++){var unit=mp4Samples[i].unit;mdatbox.set(unit,offset);offset+=unit.byteLength;}var latest=mp4Samples[mp4Samples.length-1];lastDts=latest.dts+latest.duration;//this._audioNextDts = lastDts;
// fill media segment info & add to info list
var info=new _core_media_segment_info_js__WEBPACK_IMPORTED_MODULE_4__.MediaSegmentInfo();info.beginDts=firstDts;info.endDts=lastDts;info.beginPts=firstDts;info.endPts=lastDts;info.originalBeginDts=mp4Samples[0].originalDts;info.originalEndDts=latest.originalDts+latest.duration;info.firstSample=new _core_media_segment_info_js__WEBPACK_IMPORTED_MODULE_4__.SampleInfo(mp4Samples[0].dts,mp4Samples[0].pts,mp4Samples[0].duration,mp4Samples[0].originalDts,false);info.lastSample=new _core_media_segment_info_js__WEBPACK_IMPORTED_MODULE_4__.SampleInfo(latest.dts,latest.pts,latest.duration,latest.originalDts,false);if(!this._isLive){this._audioSegmentInfoList.append(info);}track.samples=mp4Samples;track.sequenceNumber++;var moofbox=null;if(mpegRawTrack){// Generate empty buffer, because useless for raw mpeg
moofbox=new Uint8Array();}else{// Generate moof for fmp4 segment
moofbox=_mp4_generator_js__WEBPACK_IMPORTED_MODULE_1__.default.moof(track,firstDts);}track.samples=[];track.length=0;var segment={type:'audio',data:this._mergeBoxes(moofbox,mdatbox).buffer,sampleCount:mp4Samples.length,info:info};if(mpegRawTrack&&firstSegmentAfterSeek){// For MPEG audio stream in MSE, if seeking occurred, before appending new buffer
// We need explicitly set timestampOffset to the desired point in timeline for mpeg SourceBuffer.
segment.timestampOffset=firstDts;}this._onMediaSegment('audio',segment);};MP4Remuxer.prototype._remuxVideo=function(videoTrack,force){if(this._videoMeta==null){return;}var track=videoTrack;var samples=track.samples;var dtsCorrection=undefined;var firstDts=-1,lastDts=-1;var firstPts=-1,lastPts=-1;if(!samples||samples.length===0){return;}if(samples.length===1&&!force){// If [sample count in current batch] === 1 && (force != true)
// Ignore and keep in demuxer's queue
return;}// else if (force === true) do remux
var offset=8;var mdatbox=null;var mdatBytes=8+videoTrack.length;var lastSample=null;// Pop the lastSample and waiting for stash
if(samples.length>1){lastSample=samples.pop();mdatBytes-=lastSample.length;}// Insert [stashed lastSample in the previous batch] to the front
if(this._videoStashedLastSample!=null){var sample=this._videoStashedLastSample;this._videoStashedLastSample=null;samples.unshift(sample);mdatBytes+=sample.length;}// Stash the lastSample of current batch, waiting for next batch
if(lastSample!=null){this._videoStashedLastSample=lastSample;}var firstSampleOriginalDts=samples[0].dts-this._dtsBase;// calculate dtsCorrection
if(this._videoNextDts){dtsCorrection=firstSampleOriginalDts-this._videoNextDts;}else{// this._videoNextDts == undefined
if(this._videoSegmentInfoList.isEmpty()){dtsCorrection=0;}else{var lastSample_2=this._videoSegmentInfoList.getLastSampleBefore(firstSampleOriginalDts);if(lastSample_2!=null){var distance=firstSampleOriginalDts-(lastSample_2.originalDts+lastSample_2.duration);if(distance<=3){distance=0;}var expectedDts=lastSample_2.dts+lastSample_2.duration+distance;dtsCorrection=firstSampleOriginalDts-expectedDts;}else{// lastSample == null, cannot found
dtsCorrection=0;}}}var info=new _core_media_segment_info_js__WEBPACK_IMPORTED_MODULE_4__.MediaSegmentInfo();var mp4Samples=[];// Correct dts for each sample, and calculate sample duration. Then output to mp4Samples
for(var i=0;i<samples.length;i++){var sample=samples[i];var originalDts=sample.dts-this._dtsBase;var isKeyframe=sample.isKeyframe;var dts=originalDts-dtsCorrection;var cts=sample.cts;var pts=dts+cts;if(firstDts===-1){firstDts=dts;firstPts=pts;}var sampleDuration=0;if(i!==samples.length-1){var nextDts=samples[i+1].dts-this._dtsBase-dtsCorrection;sampleDuration=nextDts-dts;}else{// the last sample
if(lastSample!=null){// use stashed sample's dts to calculate sample duration
var nextDts=lastSample.dts-this._dtsBase-dtsCorrection;sampleDuration=nextDts-dts;}else if(mp4Samples.length>=1){// use second last sample duration
sampleDuration=mp4Samples[mp4Samples.length-1].duration;}else{// the only one sample, use reference sample duration
sampleDuration=Math.floor(this._videoMeta.refSampleDuration);}}if(isKeyframe){var syncPoint=new _core_media_segment_info_js__WEBPACK_IMPORTED_MODULE_4__.SampleInfo(dts,pts,sampleDuration,sample.dts,true);syncPoint.fileposition=sample.fileposition;info.appendSyncPoint(syncPoint);}mp4Samples.push({dts:dts,pts:pts,cts:cts,units:sample.units,size:sample.length,isKeyframe:isKeyframe,duration:sampleDuration,originalDts:originalDts,flags:{isLeading:0,dependsOn:isKeyframe?2:1,isDependedOn:isKeyframe?1:0,hasRedundancy:0,isNonSync:isKeyframe?0:1}});}// allocate mdatbox
mdatbox=new Uint8Array(mdatBytes);mdatbox[0]=mdatBytes>>>24&0xFF;mdatbox[1]=mdatBytes>>>16&0xFF;mdatbox[2]=mdatBytes>>>8&0xFF;mdatbox[3]=mdatBytes&0xFF;mdatbox.set(_mp4_generator_js__WEBPACK_IMPORTED_MODULE_1__.default.types.mdat,4);// Write samples into mdatbox
for(var i=0;i<mp4Samples.length;i++){var units=mp4Samples[i].units;while(units.length){var unit=units.shift();var data=unit.data;mdatbox.set(data,offset);offset+=data.byteLength;}}var latest=mp4Samples[mp4Samples.length-1];lastDts=latest.dts+latest.duration;lastPts=latest.pts+latest.duration;this._videoNextDts=lastDts;// fill media segment info & add to info list
info.beginDts=firstDts;info.endDts=lastDts;info.beginPts=firstPts;info.endPts=lastPts;info.originalBeginDts=mp4Samples[0].originalDts;info.originalEndDts=latest.originalDts+latest.duration;info.firstSample=new _core_media_segment_info_js__WEBPACK_IMPORTED_MODULE_4__.SampleInfo(mp4Samples[0].dts,mp4Samples[0].pts,mp4Samples[0].duration,mp4Samples[0].originalDts,mp4Samples[0].isKeyframe);info.lastSample=new _core_media_segment_info_js__WEBPACK_IMPORTED_MODULE_4__.SampleInfo(latest.dts,latest.pts,latest.duration,latest.originalDts,latest.isKeyframe);if(!this._isLive){this._videoSegmentInfoList.append(info);}track.samples=mp4Samples;track.sequenceNumber++;// workaround for chrome < 50: force first sample as a random access point
// see https://bugs.chromium.org/p/chromium/issues/detail?id=229412
if(this._forceFirstIDR){var flags=mp4Samples[0].flags;flags.dependsOn=2;flags.isNonSync=0;}var moofbox=_mp4_generator_js__WEBPACK_IMPORTED_MODULE_1__.default.moof(track,firstDts);track.samples=[];track.length=0;this._onMediaSegment('video',{type:'video',data:this._mergeBoxes(moofbox,mdatbox).buffer,sampleCount:mp4Samples.length,info:info});};MP4Remuxer.prototype._mergeBoxes=function(moof,mdat){var result=new Uint8Array(moof.byteLength+mdat.byteLength);result.set(moof,0);result.set(mdat,moof.byteLength);return result;};return MP4Remuxer;}();/* harmony default export */__webpack_exports__["default"]=MP4Remuxer;/***/},/***/"./src/utils/browser.js":/*!******************************!*\
			  !*** ./src/utils/browser.js ***!
			  \******************************/ /***/function srcUtilsBrowserJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */var Browser={};function detect(){// modified from jquery-browser-plugin
var ua=self.navigator.userAgent.toLowerCase();var match=/(edge)\/([\w.]+)/.exec(ua)||/(opr)[\/]([\w.]+)/.exec(ua)||/(chrome)[ \/]([\w.]+)/.exec(ua)||/(iemobile)[\/]([\w.]+)/.exec(ua)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(ua)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(ua)||/(webkit)[ \/]([\w.]+)/.exec(ua)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua)||/(msie) ([\w.]+)/.exec(ua)||ua.indexOf('trident')>=0&&/(rv)(?::| )([\w.]+)/.exec(ua)||ua.indexOf('compatible')<0&&/(firefox)[ \/]([\w.]+)/.exec(ua)||[];var platform_match=/(ipad)/.exec(ua)||/(ipod)/.exec(ua)||/(windows phone)/.exec(ua)||/(iphone)/.exec(ua)||/(kindle)/.exec(ua)||/(android)/.exec(ua)||/(windows)/.exec(ua)||/(mac)/.exec(ua)||/(linux)/.exec(ua)||/(cros)/.exec(ua)||[];var matched={browser:match[5]||match[3]||match[1]||'',version:match[2]||match[4]||'0',majorVersion:match[4]||match[2]||'0',platform:platform_match[0]||''};var browser={};if(matched.browser){browser[matched.browser]=true;var versionArray=matched.majorVersion.split('.');browser.version={major:parseInt(matched.majorVersion,10),string:matched.version};if(versionArray.length>1){browser.version.minor=parseInt(versionArray[1],10);}if(versionArray.length>2){browser.version.build=parseInt(versionArray[2],10);}}if(matched.platform){browser[matched.platform]=true;}if(browser.chrome||browser.opr||browser.safari){browser.webkit=true;}// MSIE. IE11 has 'rv' identifer
if(browser.rv||browser.iemobile){if(browser.rv){delete browser.rv;}var msie='msie';matched.browser=msie;browser[msie]=true;}// Microsoft Edge
if(browser.edge){delete browser.edge;var msedge='msedge';matched.browser=msedge;browser[msedge]=true;}// Opera 15+
if(browser.opr){var opera='opera';matched.browser=opera;browser[opera]=true;}// Stock android browsers are marked as Safari
if(browser.safari&&browser.android){var android='android';matched.browser=android;browser[android]=true;}browser.name=matched.browser;browser.platform=matched.platform;for(var key in Browser){if(Browser.hasOwnProperty(key)){delete Browser[key];}}Object.assign(Browser,browser);}detect();/* harmony default export */__webpack_exports__["default"]=Browser;/***/},/***/"./src/utils/exception.js":/*!********************************!*\
			  !*** ./src/utils/exception.js ***!
			  \********************************/ /***/function srcUtilsExceptionJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export */__webpack_require__.d(__webpack_exports__,{/* harmony export */"RuntimeException":function RuntimeException(){return(/* binding */_RuntimeException);},/* harmony export */"IllegalStateException":function IllegalStateException(){return(/* binding */_IllegalStateException);},/* harmony export */"InvalidArgumentException":function InvalidArgumentException(){return(/* binding */_InvalidArgumentException);},/* harmony export */"NotImplementedException":function NotImplementedException(){return(/* binding */_NotImplementedException);}/* harmony export */});/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */var __extends=function(){var _extendStatics5=function extendStatics(d,b){_extendStatics5=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;}||function(d,b){for(var p in b){if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p];}};return _extendStatics5(d,b);};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");_extendStatics5(d,b);function __(){this.constructor=d;}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};}();var _RuntimeException=/** @class */function(){function RuntimeException(message){this._message=message;}Object.defineProperty(RuntimeException.prototype,"name",{get:function get(){return'RuntimeException';},enumerable:false,configurable:true});Object.defineProperty(RuntimeException.prototype,"message",{get:function get(){return this._message;},enumerable:false,configurable:true});RuntimeException.prototype.toString=function(){return this.name+': '+this.message;};return RuntimeException;}();var _IllegalStateException=/** @class */function(_super){__extends(IllegalStateException,_super);function IllegalStateException(message){return _super.call(this,message)||this;}Object.defineProperty(IllegalStateException.prototype,"name",{get:function get(){return'IllegalStateException';},enumerable:false,configurable:true});return IllegalStateException;}(_RuntimeException);var _InvalidArgumentException=/** @class */function(_super){__extends(InvalidArgumentException,_super);function InvalidArgumentException(message){return _super.call(this,message)||this;}Object.defineProperty(InvalidArgumentException.prototype,"name",{get:function get(){return'InvalidArgumentException';},enumerable:false,configurable:true});return InvalidArgumentException;}(_RuntimeException);var _NotImplementedException=/** @class */function(_super){__extends(NotImplementedException,_super);function NotImplementedException(message){return _super.call(this,message)||this;}Object.defineProperty(NotImplementedException.prototype,"name",{get:function get(){return'NotImplementedException';},enumerable:false,configurable:true});return NotImplementedException;}(_RuntimeException);/***/},/***/"./src/utils/logger.js":/*!*****************************!*\
			  !*** ./src/utils/logger.js ***!
			  \*****************************/ /***/function srcUtilsLoggerJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var events__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! events */"./node_modules/events/events.js");/* harmony import */var events__WEBPACK_IMPORTED_MODULE_0___default=/*#__PURE__*/__webpack_require__.n(events__WEBPACK_IMPORTED_MODULE_0__);/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */var Log=/** @class */function(){function Log(){}Log.e=function(tag,msg){if(!tag||Log.FORCE_GLOBAL_TAG)tag=Log.GLOBAL_TAG;var str="["+tag+"] > "+msg;if(Log.ENABLE_CALLBACK){Log.emitter.emit('log','error',str);}if(!Log.ENABLE_ERROR){return;}if(console.error){console.error(str);}else if(console.warn){console.warn(str);}else{console.log(str);}};Log.i=function(tag,msg){if(!tag||Log.FORCE_GLOBAL_TAG)tag=Log.GLOBAL_TAG;var str="["+tag+"] > "+msg;if(Log.ENABLE_CALLBACK){Log.emitter.emit('log','info',str);}if(!Log.ENABLE_INFO){return;}if(console.info){console.info(str);}else{console.log(str);}};Log.w=function(tag,msg){if(!tag||Log.FORCE_GLOBAL_TAG)tag=Log.GLOBAL_TAG;var str="["+tag+"] > "+msg;if(Log.ENABLE_CALLBACK){Log.emitter.emit('log','warn',str);}if(!Log.ENABLE_WARN){return;}if(console.warn){console.warn(str);}else{console.log(str);}};Log.d=function(tag,msg){if(!tag||Log.FORCE_GLOBAL_TAG)tag=Log.GLOBAL_TAG;var str="["+tag+"] > "+msg;if(Log.ENABLE_CALLBACK){Log.emitter.emit('log','debug',str);}if(!Log.ENABLE_DEBUG){return;}if(console.debug){console.debug(str);}else{console.log(str);}};Log.v=function(tag,msg){if(!tag||Log.FORCE_GLOBAL_TAG)tag=Log.GLOBAL_TAG;var str="["+tag+"] > "+msg;if(Log.ENABLE_CALLBACK){Log.emitter.emit('log','verbose',str);}if(!Log.ENABLE_VERBOSE){return;}console.log(str);};return Log;}();Log.GLOBAL_TAG='flv.js';Log.FORCE_GLOBAL_TAG=false;Log.ENABLE_ERROR=true;Log.ENABLE_INFO=true;Log.ENABLE_WARN=true;Log.ENABLE_DEBUG=true;Log.ENABLE_VERBOSE=true;Log.ENABLE_CALLBACK=false;Log.emitter=new(events__WEBPACK_IMPORTED_MODULE_0___default())();/* harmony default export */__webpack_exports__["default"]=Log;/***/},/***/"./src/utils/logging-control.js":/*!**************************************!*\
			  !*** ./src/utils/logging-control.js ***!
			  \**************************************/ /***/function srcUtilsLoggingControlJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var events__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! events */"./node_modules/events/events.js");/* harmony import */var events__WEBPACK_IMPORTED_MODULE_0___default=/*#__PURE__*/__webpack_require__.n(events__WEBPACK_IMPORTED_MODULE_0__);/* harmony import */var _logger_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ./logger.js */"./src/utils/logger.js");/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */var LoggingControl=/** @class */function(){function LoggingControl(){}Object.defineProperty(LoggingControl,"forceGlobalTag",{get:function get(){return _logger_js__WEBPACK_IMPORTED_MODULE_1__.default.FORCE_GLOBAL_TAG;},set:function set(enable){_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.FORCE_GLOBAL_TAG=enable;LoggingControl._notifyChange();},enumerable:false,configurable:true});Object.defineProperty(LoggingControl,"globalTag",{get:function get(){return _logger_js__WEBPACK_IMPORTED_MODULE_1__.default.GLOBAL_TAG;},set:function set(tag){_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.GLOBAL_TAG=tag;LoggingControl._notifyChange();},enumerable:false,configurable:true});Object.defineProperty(LoggingControl,"enableAll",{get:function get(){return _logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_VERBOSE&&_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_DEBUG&&_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_INFO&&_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_WARN&&_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_ERROR;},set:function set(enable){_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_VERBOSE=enable;_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_DEBUG=enable;_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_INFO=enable;_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_WARN=enable;_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_ERROR=enable;LoggingControl._notifyChange();},enumerable:false,configurable:true});Object.defineProperty(LoggingControl,"enableDebug",{get:function get(){return _logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_DEBUG;},set:function set(enable){_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_DEBUG=enable;LoggingControl._notifyChange();},enumerable:false,configurable:true});Object.defineProperty(LoggingControl,"enableVerbose",{get:function get(){return _logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_VERBOSE;},set:function set(enable){_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_VERBOSE=enable;LoggingControl._notifyChange();},enumerable:false,configurable:true});Object.defineProperty(LoggingControl,"enableInfo",{get:function get(){return _logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_INFO;},set:function set(enable){_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_INFO=enable;LoggingControl._notifyChange();},enumerable:false,configurable:true});Object.defineProperty(LoggingControl,"enableWarn",{get:function get(){return _logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_WARN;},set:function set(enable){_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_WARN=enable;LoggingControl._notifyChange();},enumerable:false,configurable:true});Object.defineProperty(LoggingControl,"enableError",{get:function get(){return _logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_ERROR;},set:function set(enable){_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_ERROR=enable;LoggingControl._notifyChange();},enumerable:false,configurable:true});LoggingControl.getConfig=function(){return{globalTag:_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.GLOBAL_TAG,forceGlobalTag:_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.FORCE_GLOBAL_TAG,enableVerbose:_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_VERBOSE,enableDebug:_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_DEBUG,enableInfo:_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_INFO,enableWarn:_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_WARN,enableError:_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_ERROR,enableCallback:_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_CALLBACK};};LoggingControl.applyConfig=function(config){_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.GLOBAL_TAG=config.globalTag;_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.FORCE_GLOBAL_TAG=config.forceGlobalTag;_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_VERBOSE=config.enableVerbose;_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_DEBUG=config.enableDebug;_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_INFO=config.enableInfo;_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_WARN=config.enableWarn;_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_ERROR=config.enableError;_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_CALLBACK=config.enableCallback;};LoggingControl._notifyChange=function(){var emitter=LoggingControl.emitter;if(emitter.listenerCount('change')>0){var config=LoggingControl.getConfig();emitter.emit('change',config);}};LoggingControl.registerListener=function(listener){LoggingControl.emitter.addListener('change',listener);};LoggingControl.removeListener=function(listener){LoggingControl.emitter.removeListener('change',listener);};LoggingControl.addLogListener=function(listener){_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.emitter.addListener('log',listener);if(_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.emitter.listenerCount('log')>0){_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_CALLBACK=true;LoggingControl._notifyChange();}};LoggingControl.removeLogListener=function(listener){_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.emitter.removeListener('log',listener);if(_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.emitter.listenerCount('log')===0){_logger_js__WEBPACK_IMPORTED_MODULE_1__.default.ENABLE_CALLBACK=false;LoggingControl._notifyChange();}};return LoggingControl;}();LoggingControl.emitter=new(events__WEBPACK_IMPORTED_MODULE_0___default())();/* harmony default export */__webpack_exports__["default"]=LoggingControl;/***/},/***/"./src/utils/polyfill.js":/*!*******************************!*\
			  !*** ./src/utils/polyfill.js ***!
			  \*******************************/ /***/function srcUtilsPolyfillJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */var Polyfill=/** @class */function(){function Polyfill(){}Polyfill.install=function(){// ES6 Object.setPrototypeOf
Object.setPrototypeOf=Object.setPrototypeOf||function(obj,proto){obj.__proto__=proto;return obj;};// ES6 Object.assign
Object.assign=Object.assign||function(target){if(target===undefined||target===null){throw new TypeError('Cannot convert undefined or null to object');}var output=Object(target);for(var i=1;i<arguments.length;i++){var source=arguments[i];if(source!==undefined&&source!==null){for(var key in source){if(source.hasOwnProperty(key)){output[key]=source[key];}}}}return output;};// ES6 Promise (missing support in IE11)
if(typeof self.Promise!=='function'){__webpack_require__(/*! es6-promise */"./node_modules/es6-promise/dist/es6-promise.js").polyfill();}};return Polyfill;}();Polyfill.install();/* harmony default export */__webpack_exports__["default"]=Polyfill;/***/},/***/"./src/utils/utf8-conv.js":/*!********************************!*\
			  !*** ./src/utils/utf8-conv.js ***!
			  \********************************/ /***/function srcUtilsUtf8ConvJs(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/*
			 * Copyright (C) 2016 Bilibili. All Rights Reserved.
			 *
			 * This file is derived from C++ project libWinTF8 (https://github.com/m13253/libWinTF8)
			 * @author zheng qian <xqq@xqq.im>
			 *
			 * Licensed under the Apache License, Version 2.0 (the "License");
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *     http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an "AS IS" BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */function checkContinuation(uint8array,start,checkLength){var array=uint8array;if(start+checkLength<array.length){while(checkLength--){if((array[++start]&0xC0)!==0x80)return false;}return true;}else{return false;}}function decodeUTF8(uint8array){var out=[];var input=uint8array;var i=0;var length=uint8array.length;while(i<length){if(input[i]<0x80){out.push(String.fromCharCode(input[i]));++i;continue;}else if(input[i]<0xC0);else if(input[i]<0xE0){if(checkContinuation(input,i,1)){var ucs4=(input[i]&0x1F)<<6|input[i+1]&0x3F;if(ucs4>=0x80){out.push(String.fromCharCode(ucs4&0xFFFF));i+=2;continue;}}}else if(input[i]<0xF0){if(checkContinuation(input,i,2)){var ucs4=(input[i]&0xF)<<12|(input[i+1]&0x3F)<<6|input[i+2]&0x3F;if(ucs4>=0x800&&(ucs4&0xF800)!==0xD800){out.push(String.fromCharCode(ucs4&0xFFFF));i+=3;continue;}}}else if(input[i]<0xF8){if(checkContinuation(input,i,3)){var ucs4=(input[i]&0x7)<<18|(input[i+1]&0x3F)<<12|(input[i+2]&0x3F)<<6|input[i+3]&0x3F;if(ucs4>0x10000&&ucs4<0x110000){ucs4-=0x10000;out.push(String.fromCharCode(ucs4>>>10|0xD800));out.push(String.fromCharCode(ucs4&0x3FF|0xDC00));i+=4;continue;}}}out.push(String.fromCharCode(0xFFFD));++i;}return out.join('');}/* harmony default export */__webpack_exports__["default"]=decodeUTF8;/***/}/******/};/************************************************************************/ /******/ // The module cache
/******/var __webpack_module_cache__={};/******/ /******/ // The require function
/******/function __webpack_require__(moduleId){/******/ // Check if module is in cache
/******/var cachedModule=__webpack_module_cache__[moduleId];/******/if(cachedModule!==undefined){/******/return cachedModule.exports;/******/}/******/ // Create a new module (and put it into the cache)
/******/var module=__webpack_module_cache__[moduleId]={/******/ // no module.id needed
/******/ // no module.loaded needed
/******/exports:{}/******/};/******/ /******/ // Execute the module function
/******/__webpack_modules__[moduleId].call(module.exports,module,module.exports,__webpack_require__);/******/ /******/ // Return the exports of the module
/******/return module.exports;/******/}/******/ /******/ // expose the modules object (__webpack_modules__)
/******/__webpack_require__.m=__webpack_modules__;/******/ /************************************************************************/ /******/ /* webpack/runtime/compat get default export */ /******/!function(){/******/ // getDefaultExport function for compatibility with non-harmony modules
/******/__webpack_require__.n=function(module){/******/var getter=module&&module.__esModule?/******/function(){return module['default'];}:/******/function(){return module;};/******/__webpack_require__.d(getter,{a:getter});/******/return getter;/******/};/******/}();/******/ /******/ /* webpack/runtime/define property getters */ /******/!function(){/******/ // define getter functions for harmony exports
/******/__webpack_require__.d=function(exports,definition){/******/for(var key in definition){/******/if(__webpack_require__.o(definition,key)&&!__webpack_require__.o(exports,key)){/******/Object.defineProperty(exports,key,{enumerable:true,get:definition[key]});/******/}/******/}/******/};/******/}();/******/ /******/ /* webpack/runtime/global */ /******/!function(){/******/__webpack_require__.g=function(){/******/if((typeof globalThis==="undefined"?"undefined":_typeof3(globalThis))==='object')return globalThis;/******/try{/******/return this||new Function('return this')();/******/}catch(e){/******/if((typeof window==="undefined"?"undefined":_typeof3(window))==='object')return window;/******/}/******/}();/******/}();/******/ /******/ /* webpack/runtime/hasOwnProperty shorthand */ /******/!function(){/******/__webpack_require__.o=function(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop);};/******/}();/******/ /******/ /* webpack/runtime/make namespace object */ /******/!function(){/******/ // define __esModule on exports
/******/__webpack_require__.r=function(exports){/******/if(typeof Symbol!=='undefined'&&Symbol.toStringTag){/******/Object.defineProperty(exports,Symbol.toStringTag,{value:'Module'});/******/}/******/Object.defineProperty(exports,'__esModule',{value:true});/******/};/******/}();/******/ /************************************************************************/ /******/ /******/ // module factories are used so entry inlining is disabled
/******/ // startup
/******/ // Load entry module and return exports
/******/var __webpack_exports__=__webpack_require__("./src/index.js");/******/ /******/return __webpack_exports__;/******/}());});})(flv);var flvjs=/*@__PURE__*/getDefaultExportFromCjs(flv.exports);var userAgent=typeof window!=="undefined"?window.navigator.userAgent:"";var isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);/^((?!chrome|android).)*safari/i.test(userAgent);/MicroMessenger/i.test(userAgent);/MSIE|Trident/i.test(userAgent);var hls={exports:{}};(function(module,exports){typeof window!=="undefined"&&function webpackUniversalModuleDefinition(root,factory){module.exports=factory();}(commonjsGlobal,function(){return(/******/function(modules){// webpackBootstrap
/******/ // The module cache
/******/var installedModules={};/******/ /******/ // The require function
/******/function __webpack_require__(moduleId){/******/ /******/ // Check if module is in cache
/******/if(installedModules[moduleId]){/******/return installedModules[moduleId].exports;/******/}/******/ // Create a new module (and put it into the cache)
/******/var module=installedModules[moduleId]={/******/i:moduleId,/******/l:false,/******/exports:{}/******/};/******/ /******/ // Execute the module function
/******/modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);/******/ /******/ // Flag the module as loaded
/******/module.l=true;/******/ /******/ // Return the exports of the module
/******/return module.exports;/******/}/******/ /******/ /******/ // expose the modules object (__webpack_modules__)
/******/__webpack_require__.m=modules;/******/ /******/ // expose the module cache
/******/__webpack_require__.c=installedModules;/******/ /******/ // define getter function for harmony exports
/******/__webpack_require__.d=function(exports,name,getter){/******/if(!__webpack_require__.o(exports,name)){/******/Object.defineProperty(exports,name,{enumerable:true,get:getter});/******/}/******/};/******/ /******/ // define __esModule on exports
/******/__webpack_require__.r=function(exports){/******/if(typeof Symbol!=='undefined'&&Symbol.toStringTag){/******/Object.defineProperty(exports,Symbol.toStringTag,{value:'Module'});/******/}/******/Object.defineProperty(exports,'__esModule',{value:true});/******/};/******/ /******/ // create a fake namespace object
/******/ // mode & 1: value is a module id, require it
/******/ // mode & 2: merge all properties of value into the ns
/******/ // mode & 4: return value when already ns object
/******/ // mode & 8|1: behave like require
/******/__webpack_require__.t=function(value,mode){/******/if(mode&1)value=__webpack_require__(value);/******/if(mode&8)return value;/******/if(mode&4&&_typeof3(value)==='object'&&value&&value.__esModule)return value;/******/var ns=Object.create(null);/******/__webpack_require__.r(ns);/******/Object.defineProperty(ns,'default',{enumerable:true,value:value});/******/if(mode&2&&typeof value!='string')for(var key in value){__webpack_require__.d(ns,key,function(key){return value[key];}.bind(null,key));}/******/return ns;/******/};/******/ /******/ // getDefaultExport function for compatibility with non-harmony modules
/******/__webpack_require__.n=function(module){/******/var getter=module&&module.__esModule?/******/function getDefault(){return module['default'];}:/******/function getModuleExports(){return module;};/******/__webpack_require__.d(getter,'a',getter);/******/return getter;/******/};/******/ /******/ // Object.prototype.hasOwnProperty.call
/******/__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property);};/******/ /******/ // __webpack_public_path__
/******/__webpack_require__.p="/dist/";/******/ /******/ /******/ // Load entry module and return exports
/******/return __webpack_require__(__webpack_require__.s="./src/hls.ts");/******/}/************************************************************************/ /******/({/***/"./node_modules/eventemitter3/index.js":/*!*********************************************!*\
			  !*** ./node_modules/eventemitter3/index.js ***!
			  \*********************************************/ /*! no static exports found */ /***/function node_modulesEventemitter3IndexJs(module,exports,__webpack_require__){var has=Object.prototype.hasOwnProperty,prefix='~';/**
			 * Constructor to create a storage for our `EE` objects.
			 * An `Events` instance is a plain object whose properties are event names.
			 *
			 * @constructor
			 * @private
			 */function Events(){}//
// We try to not inherit from `Object.prototype`. In some engines creating an
// instance in this way is faster than calling `Object.create(null)` directly.
// If `Object.create(null)` is not supported we prefix the event names with a
// character to make sure that the built-in object properties are not
// overridden or used as an attack vector.
//
if(Object.create){Events.prototype=Object.create(null);//
// This hack is needed because the `__proto__` property is still inherited in
// some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.
//
if(!new Events().__proto__)prefix=false;}/**
			 * Representation of a single event listener.
			 *
			 * @param {Function} fn The listener function.
			 * @param {*} context The context to invoke the listener with.
			 * @param {Boolean} [once=false] Specify if the listener is a one-time listener.
			 * @constructor
			 * @private
			 */function EE(fn,context,once){this.fn=fn;this.context=context;this.once=once||false;}/**
			 * Add a listener for a given event.
			 *
			 * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.
			 * @param {(String|Symbol)} event The event name.
			 * @param {Function} fn The listener function.
			 * @param {*} context The context to invoke the listener with.
			 * @param {Boolean} once Specify if the listener is a one-time listener.
			 * @returns {EventEmitter}
			 * @private
			 */function addListener(emitter,event,fn,context,once){if(typeof fn!=='function'){throw new TypeError('The listener must be a function');}var listener=new EE(fn,context||emitter,once),evt=prefix?prefix+event:event;if(!emitter._events[evt])emitter._events[evt]=listener,emitter._eventsCount++;else if(!emitter._events[evt].fn)emitter._events[evt].push(listener);else emitter._events[evt]=[emitter._events[evt],listener];return emitter;}/**
			 * Clear event by name.
			 *
			 * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.
			 * @param {(String|Symbol)} evt The Event name.
			 * @private
			 */function clearEvent(emitter,evt){if(--emitter._eventsCount===0)emitter._events=new Events();else delete emitter._events[evt];}/**
			 * Minimal `EventEmitter` interface that is molded against the Node.js
			 * `EventEmitter` interface.
			 *
			 * @constructor
			 * @public
			 */function EventEmitter(){this._events=new Events();this._eventsCount=0;}/**
			 * Return an array listing the events for which the emitter has registered
			 * listeners.
			 *
			 * @returns {Array}
			 * @public
			 */EventEmitter.prototype.eventNames=function eventNames(){var names=[],events,name;if(this._eventsCount===0)return names;for(name in events=this._events){if(has.call(events,name))names.push(prefix?name.slice(1):name);}if(Object.getOwnPropertySymbols){return names.concat(Object.getOwnPropertySymbols(events));}return names;};/**
			 * Return the listeners registered for a given event.
			 *
			 * @param {(String|Symbol)} event The event name.
			 * @returns {Array} The registered listeners.
			 * @public
			 */EventEmitter.prototype.listeners=function listeners(event){var evt=prefix?prefix+event:event,handlers=this._events[evt];if(!handlers)return[];if(handlers.fn)return[handlers.fn];for(var i=0,l=handlers.length,ee=new Array(l);i<l;i++){ee[i]=handlers[i].fn;}return ee;};/**
			 * Return the number of listeners listening to a given event.
			 *
			 * @param {(String|Symbol)} event The event name.
			 * @returns {Number} The number of listeners.
			 * @public
			 */EventEmitter.prototype.listenerCount=function listenerCount(event){var evt=prefix?prefix+event:event,listeners=this._events[evt];if(!listeners)return 0;if(listeners.fn)return 1;return listeners.length;};/**
			 * Calls each of the listeners registered for a given event.
			 *
			 * @param {(String|Symbol)} event The event name.
			 * @returns {Boolean} `true` if the event had listeners, else `false`.
			 * @public
			 */EventEmitter.prototype.emit=function emit(event,a1,a2,a3,a4,a5){var evt=prefix?prefix+event:event;if(!this._events[evt])return false;var listeners=this._events[evt],len=arguments.length,args,i;if(listeners.fn){if(listeners.once)this.removeListener(event,listeners.fn,undefined,true);switch(len){case 1:return listeners.fn.call(listeners.context),true;case 2:return listeners.fn.call(listeners.context,a1),true;case 3:return listeners.fn.call(listeners.context,a1,a2),true;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),true;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),true;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),true;}for(i=1,args=new Array(len-1);i<len;i++){args[i-1]=arguments[i];}listeners.fn.apply(listeners.context,args);}else{var length=listeners.length,j;for(i=0;i<length;i++){if(listeners[i].once)this.removeListener(event,listeners[i].fn,undefined,true);switch(len){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;case 4:listeners[i].fn.call(listeners[i].context,a1,a2,a3);break;default:if(!args)for(j=1,args=new Array(len-1);j<len;j++){args[j-1]=arguments[j];}listeners[i].fn.apply(listeners[i].context,args);}}}return true;};/**
			 * Add a listener for a given event.
			 *
			 * @param {(String|Symbol)} event The event name.
			 * @param {Function} fn The listener function.
			 * @param {*} [context=this] The context to invoke the listener with.
			 * @returns {EventEmitter} `this`.
			 * @public
			 */EventEmitter.prototype.on=function on(event,fn,context){return addListener(this,event,fn,context,false);};/**
			 * Add a one-time listener for a given event.
			 *
			 * @param {(String|Symbol)} event The event name.
			 * @param {Function} fn The listener function.
			 * @param {*} [context=this] The context to invoke the listener with.
			 * @returns {EventEmitter} `this`.
			 * @public
			 */EventEmitter.prototype.once=function once(event,fn,context){return addListener(this,event,fn,context,true);};/**
			 * Remove the listeners of a given event.
			 *
			 * @param {(String|Symbol)} event The event name.
			 * @param {Function} fn Only remove the listeners that match this function.
			 * @param {*} context Only remove the listeners that have this context.
			 * @param {Boolean} once Only remove one-time listeners.
			 * @returns {EventEmitter} `this`.
			 * @public
			 */EventEmitter.prototype.removeListener=function removeListener(event,fn,context,once){var evt=prefix?prefix+event:event;if(!this._events[evt])return this;if(!fn){clearEvent(this,evt);return this;}var listeners=this._events[evt];if(listeners.fn){if(listeners.fn===fn&&(!once||listeners.once)&&(!context||listeners.context===context)){clearEvent(this,evt);}}else{for(var i=0,events=[],length=listeners.length;i<length;i++){if(listeners[i].fn!==fn||once&&!listeners[i].once||context&&listeners[i].context!==context){events.push(listeners[i]);}}//
// Reset the array, or remove it completely if we have no more listeners.
//
if(events.length)this._events[evt]=events.length===1?events[0]:events;else clearEvent(this,evt);}return this;};/**
			 * Remove all listeners, or those of the specified event.
			 *
			 * @param {(String|Symbol)} [event] The event name.
			 * @returns {EventEmitter} `this`.
			 * @public
			 */EventEmitter.prototype.removeAllListeners=function removeAllListeners(event){var evt;if(event){evt=prefix?prefix+event:event;if(this._events[evt])clearEvent(this,evt);}else{this._events=new Events();this._eventsCount=0;}return this;};//
// Alias methods names because people roll like that.
//
EventEmitter.prototype.off=EventEmitter.prototype.removeListener;EventEmitter.prototype.addListener=EventEmitter.prototype.on;//
// Expose the prefix.
//
EventEmitter.prefixed=prefix;//
// Allow `EventEmitter` to be imported as module namespace.
//
EventEmitter.EventEmitter=EventEmitter;//
// Expose the module.
//
{module.exports=EventEmitter;}/***/},/***/"./node_modules/url-toolkit/src/url-toolkit.js":/*!*****************************************************!*\
			  !*** ./node_modules/url-toolkit/src/url-toolkit.js ***!
			  \*****************************************************/ /*! no static exports found */ /***/function node_modulesUrlToolkitSrcUrlToolkitJs(module,exports,__webpack_require__){// see https://tools.ietf.org/html/rfc1808
(function(root){var URL_REGEX=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/;var FIRST_SEGMENT_REGEX=/^([^\/?#]*)([^]*)$/;var SLASH_DOT_REGEX=/(?:\/|^)\.(?=\/)/g;var SLASH_DOT_DOT_REGEX=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g;var URLToolkit={// If opts.alwaysNormalize is true then the path will always be normalized even when it starts with / or //
// E.g
// With opts.alwaysNormalize = false (default, spec compliant)
// http://a.com/b/cd + /e/f/../g => http://a.com/e/f/../g
// With opts.alwaysNormalize = true (not spec compliant)
// http://a.com/b/cd + /e/f/../g => http://a.com/e/g
buildAbsoluteURL:function buildAbsoluteURL(baseURL,relativeURL,opts){opts=opts||{};// remove any remaining space and CRLF
baseURL=baseURL.trim();relativeURL=relativeURL.trim();if(!relativeURL){// 2a) If the embedded URL is entirely empty, it inherits the
// entire base URL (i.e., is set equal to the base URL)
// and we are done.
if(!opts.alwaysNormalize){return baseURL;}var basePartsForNormalise=URLToolkit.parseURL(baseURL);if(!basePartsForNormalise){throw new Error('Error trying to parse base URL.');}basePartsForNormalise.path=URLToolkit.normalizePath(basePartsForNormalise.path);return URLToolkit.buildURLFromParts(basePartsForNormalise);}var relativeParts=URLToolkit.parseURL(relativeURL);if(!relativeParts){throw new Error('Error trying to parse relative URL.');}if(relativeParts.scheme){// 2b) If the embedded URL starts with a scheme name, it is
// interpreted as an absolute URL and we are done.
if(!opts.alwaysNormalize){return relativeURL;}relativeParts.path=URLToolkit.normalizePath(relativeParts.path);return URLToolkit.buildURLFromParts(relativeParts);}var baseParts=URLToolkit.parseURL(baseURL);if(!baseParts){throw new Error('Error trying to parse base URL.');}if(!baseParts.netLoc&&baseParts.path&&baseParts.path[0]!=='/'){// If netLoc missing and path doesn't start with '/', assume everthing before the first '/' is the netLoc
// This causes 'example.com/a' to be handled as '//example.com/a' instead of '/example.com/a'
var pathParts=FIRST_SEGMENT_REGEX.exec(baseParts.path);baseParts.netLoc=pathParts[1];baseParts.path=pathParts[2];}if(baseParts.netLoc&&!baseParts.path){baseParts.path='/';}var builtParts={// 2c) Otherwise, the embedded URL inherits the scheme of
// the base URL.
scheme:baseParts.scheme,netLoc:relativeParts.netLoc,path:null,params:relativeParts.params,query:relativeParts.query,fragment:relativeParts.fragment};if(!relativeParts.netLoc){// 3) If the embedded URL's <net_loc> is non-empty, we skip to
// Step 7.  Otherwise, the embedded URL inherits the <net_loc>
// (if any) of the base URL.
builtParts.netLoc=baseParts.netLoc;// 4) If the embedded URL path is preceded by a slash "/", the
// path is not relative and we skip to Step 7.
if(relativeParts.path[0]!=='/'){if(!relativeParts.path){// 5) If the embedded URL path is empty (and not preceded by a
// slash), then the embedded URL inherits the base URL path
builtParts.path=baseParts.path;// 5a) if the embedded URL's <params> is non-empty, we skip to
// step 7; otherwise, it inherits the <params> of the base
// URL (if any) and
if(!relativeParts.params){builtParts.params=baseParts.params;// 5b) if the embedded URL's <query> is non-empty, we skip to
// step 7; otherwise, it inherits the <query> of the base
// URL (if any) and we skip to step 7.
if(!relativeParts.query){builtParts.query=baseParts.query;}}}else{// 6) The last segment of the base URL's path (anything
// following the rightmost slash "/", or the entire path if no
// slash is present) is removed and the embedded URL's path is
// appended in its place.
var baseURLPath=baseParts.path;var newPath=baseURLPath.substring(0,baseURLPath.lastIndexOf('/')+1)+relativeParts.path;builtParts.path=URLToolkit.normalizePath(newPath);}}}if(builtParts.path===null){builtParts.path=opts.alwaysNormalize?URLToolkit.normalizePath(relativeParts.path):relativeParts.path;}return URLToolkit.buildURLFromParts(builtParts);},parseURL:function parseURL(url){var parts=URL_REGEX.exec(url);if(!parts){return null;}return{scheme:parts[1]||'',netLoc:parts[2]||'',path:parts[3]||'',params:parts[4]||'',query:parts[5]||'',fragment:parts[6]||''};},normalizePath:function normalizePath(path){// The following operations are
// then applied, in order, to the new path:
// 6a) All occurrences of "./", where "." is a complete path
// segment, are removed.
// 6b) If the path ends with "." as a complete path segment,
// that "." is removed.
path=path.split('').reverse().join('').replace(SLASH_DOT_REGEX,'');// 6c) All occurrences of "<segment>/../", where <segment> is a
// complete path segment not equal to "..", are removed.
// Removal of these path segments is performed iteratively,
// removing the leftmost matching pattern on each iteration,
// until no matching pattern remains.
// 6d) If the path ends with "<segment>/..", where <segment> is a
// complete path segment not equal to "..", that
// "<segment>/.." is removed.
while(path.length!==(path=path.replace(SLASH_DOT_DOT_REGEX,'')).length){}return path.split('').reverse().join('');},buildURLFromParts:function buildURLFromParts(parts){return parts.scheme+parts.netLoc+parts.path+parts.params+parts.query+parts.fragment;}};module.exports=URLToolkit;})();/***/},/***/"./node_modules/webworkify-webpack/index.js":/*!**************************************************!*\
			  !*** ./node_modules/webworkify-webpack/index.js ***!
			  \**************************************************/ /*! no static exports found */ /***/function node_modulesWebworkifyWebpackIndexJs(module,exports,__webpack_require__){function webpackBootstrapFunc(modules){/******/ // The module cache
/******/var installedModules={};/******/ // The require function
/******/function __webpack_require__(moduleId){/******/ // Check if module is in cache
/******/if(installedModules[moduleId])/******/return installedModules[moduleId].exports;/******/ // Create a new module (and put it into the cache)
/******/var module=installedModules[moduleId]={/******/i:moduleId,/******/l:false,/******/exports:{}/******/};/******/ // Execute the module function
/******/modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);/******/ // Flag the module as loaded
/******/module.l=true;/******/ // Return the exports of the module
/******/return module.exports;/******/}/******/ // expose the modules object (__webpack_modules__)
/******/__webpack_require__.m=modules;/******/ // expose the module cache
/******/__webpack_require__.c=installedModules;/******/ // identity function for calling harmony imports with the correct context
/******/__webpack_require__.i=function(value){return value;};/******/ // define getter function for harmony exports
/******/__webpack_require__.d=function(exports,name,getter){/******/if(!__webpack_require__.o(exports,name)){/******/Object.defineProperty(exports,name,{/******/configurable:false,/******/enumerable:true,/******/get:getter/******/});/******/}/******/};/******/ // define __esModule on exports
/******/__webpack_require__.r=function(exports){/******/Object.defineProperty(exports,'__esModule',{value:true});/******/};/******/ // getDefaultExport function for compatibility with non-harmony modules
/******/__webpack_require__.n=function(module){/******/var getter=module&&module.__esModule?/******/function getDefault(){return module['default'];}:/******/function getModuleExports(){return module;};/******/__webpack_require__.d(getter,'a',getter);/******/return getter;/******/};/******/ // Object.prototype.hasOwnProperty.call
/******/__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property);};/******/ // __webpack_public_path__
/******/__webpack_require__.p="/";/******/ // on error function for async loading
/******/__webpack_require__.oe=function(err){console.error(err);throw err;};var f=__webpack_require__(__webpack_require__.s=ENTRY_MODULE);return f.default||f;// try to call default if defined to also support babel esmodule exports
}var moduleNameReqExp='[\\.|\\-|\\+|\\w|\/|@]+';var dependencyRegExp='\\(\\s*(\/\\*.*?\\*\/)?\\s*.*?('+moduleNameReqExp+').*?\\)';// additional chars when output.pathinfo is true
// http://stackoverflow.com/a/2593661/130442
function quoteRegExp(str){return(str+'').replace(/[.?*+^$[\]\\(){}|-]/g,'\\$&');}function isNumeric(n){return!isNaN(1*n);// 1 * n converts integers, integers as string ("123"), 1e3 and "1e3" to integers and strings to NaN
}function getModuleDependencies(sources,module,queueName){var retval={};retval[queueName]=[];var fnString=module.toString();var wrapperSignature=fnString.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!wrapperSignature)return retval;var webpackRequireName=wrapperSignature[1];// main bundle deps
var re=new RegExp('(\\\\n|\\W)'+quoteRegExp(webpackRequireName)+dependencyRegExp,'g');var match;while(match=re.exec(fnString)){if(match[3]==='dll-reference')continue;retval[queueName].push(match[3]);}// dll deps
re=new RegExp('\\('+quoteRegExp(webpackRequireName)+'\\("(dll-reference\\s('+moduleNameReqExp+'))"\\)\\)'+dependencyRegExp,'g');while(match=re.exec(fnString)){if(!sources[match[2]]){retval[queueName].push(match[1]);sources[match[2]]=__webpack_require__(match[1]).m;}retval[match[2]]=retval[match[2]]||[];retval[match[2]].push(match[4]);}// convert 1e3 back to 1000 - this can be important after uglify-js converted 1000 to 1e3
var keys=Object.keys(retval);for(var i=0;i<keys.length;i++){for(var j=0;j<retval[keys[i]].length;j++){if(isNumeric(retval[keys[i]][j])){retval[keys[i]][j]=1*retval[keys[i]][j];}}}return retval;}function hasValuesInQueues(queues){var keys=Object.keys(queues);return keys.reduce(function(hasValues,key){return hasValues||queues[key].length>0;},false);}function getRequiredModules(sources,moduleId){var modulesQueue={main:[moduleId]};var requiredModules={main:[]};var seenModules={main:{}};while(hasValuesInQueues(modulesQueue)){var queues=Object.keys(modulesQueue);for(var i=0;i<queues.length;i++){var queueName=queues[i];var queue=modulesQueue[queueName];var moduleToCheck=queue.pop();seenModules[queueName]=seenModules[queueName]||{};if(seenModules[queueName][moduleToCheck]||!sources[queueName][moduleToCheck])continue;seenModules[queueName][moduleToCheck]=true;requiredModules[queueName]=requiredModules[queueName]||[];requiredModules[queueName].push(moduleToCheck);var newModules=getModuleDependencies(sources,sources[queueName][moduleToCheck],queueName);var newModulesKeys=Object.keys(newModules);for(var j=0;j<newModulesKeys.length;j++){modulesQueue[newModulesKeys[j]]=modulesQueue[newModulesKeys[j]]||[];modulesQueue[newModulesKeys[j]]=modulesQueue[newModulesKeys[j]].concat(newModules[newModulesKeys[j]]);}}}return requiredModules;}module.exports=function(moduleId,options){options=options||{};var sources={main:__webpack_require__.m};var requiredModules=options.all?{main:Object.keys(sources.main)}:getRequiredModules(sources,moduleId);var src='';Object.keys(requiredModules).filter(function(m){return m!=='main';}).forEach(function(module){var entryModule=0;while(requiredModules[module][entryModule]){entryModule++;}requiredModules[module].push(entryModule);sources[module][entryModule]='(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })';src=src+'var '+module+' = ('+webpackBootstrapFunc.toString().replace('ENTRY_MODULE',JSON.stringify(entryModule))+')({'+requiredModules[module].map(function(id){return''+JSON.stringify(id)+': '+sources[module][id].toString();}).join(',')+'});\n';});src=src+'new (('+webpackBootstrapFunc.toString().replace('ENTRY_MODULE',JSON.stringify(moduleId))+')({'+requiredModules.main.map(function(id){return''+JSON.stringify(id)+': '+sources.main[id].toString();}).join(',')+'}))(self);';var blob=new window.Blob([src],{type:'text/javascript'});if(options.bare){return blob;}var URL=window.URL||window.webkitURL||window.mozURL||window.msURL;var workerUrl=URL.createObjectURL(blob);var worker=new window.Worker(workerUrl);worker.objectURL=workerUrl;return worker;};/***/},/***/"./src/config.ts":/*!***********************!*\
			  !*** ./src/config.ts ***!
			  \***********************/ /*! exports provided: hlsDefaultConfig, mergeConfig, enableStreamingMode */ /***/function srcConfigTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"hlsDefaultConfig",function(){return hlsDefaultConfig;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"mergeConfig",function(){return mergeConfig;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"enableStreamingMode",function(){return enableStreamingMode;});/* harmony import */var _controller_abr_controller__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./controller/abr-controller */"./src/controller/abr-controller.ts");/* harmony import */var _controller_audio_stream_controller__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ./controller/audio-stream-controller */"./src/controller/audio-stream-controller.ts");/* harmony import */var _controller_audio_track_controller__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ./controller/audio-track-controller */"./src/controller/audio-track-controller.ts");/* harmony import */var _controller_subtitle_stream_controller__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ./controller/subtitle-stream-controller */"./src/controller/subtitle-stream-controller.ts");/* harmony import */var _controller_subtitle_track_controller__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(/*! ./controller/subtitle-track-controller */"./src/controller/subtitle-track-controller.ts");/* harmony import */var _controller_buffer_controller__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(/*! ./controller/buffer-controller */"./src/controller/buffer-controller.ts");/* harmony import */var _controller_timeline_controller__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(/*! ./controller/timeline-controller */"./src/controller/timeline-controller.ts");/* harmony import */var _controller_cap_level_controller__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(/*! ./controller/cap-level-controller */"./src/controller/cap-level-controller.ts");/* harmony import */var _controller_fps_controller__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(/*! ./controller/fps-controller */"./src/controller/fps-controller.ts");/* harmony import */var _controller_eme_controller__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(/*! ./controller/eme-controller */"./src/controller/eme-controller.ts");/* harmony import */var _controller_cmcd_controller__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(/*! ./controller/cmcd-controller */"./src/controller/cmcd-controller.ts");/* harmony import */var _utils_xhr_loader__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(/*! ./utils/xhr-loader */"./src/utils/xhr-loader.ts");/* harmony import */var _utils_fetch_loader__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(/*! ./utils/fetch-loader */"./src/utils/fetch-loader.ts");/* harmony import */var _utils_cues__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(/*! ./utils/cues */"./src/utils/cues.ts");/* harmony import */var _utils_mediakeys_helper__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(/*! ./utils/mediakeys-helper */"./src/utils/mediakeys-helper.ts");/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(/*! ./utils/logger */"./src/utils/logger.ts");function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};return _extends.apply(this,arguments);}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});}keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}// If possible, keep hlsDefaultConfig shallow
// It is cloned whenever a new Hls instance is created, by keeping the config
// shallow the properties are cloned, and we don't end up manipulating the default
var hlsDefaultConfig=_objectSpread(_objectSpread({autoStartLoad:true,// used by stream-controller
startPosition:-1,// used by stream-controller
defaultAudioCodec:undefined,// used by stream-controller
debug:false,// used by logger
capLevelOnFPSDrop:false,// used by fps-controller
capLevelToPlayerSize:false,// used by cap-level-controller
initialLiveManifestSize:1,// used by stream-controller
maxBufferLength:30,// used by stream-controller
backBufferLength:Infinity,// used by buffer-controller
maxBufferSize:60*1000*1000,// used by stream-controller
maxBufferHole:0.1,// used by stream-controller
highBufferWatchdogPeriod:2,// used by stream-controller
nudgeOffset:0.1,// used by stream-controller
nudgeMaxRetry:3,// used by stream-controller
maxFragLookUpTolerance:0.25,// used by stream-controller
liveSyncDurationCount:3,// used by latency-controller
liveMaxLatencyDurationCount:Infinity,// used by latency-controller
liveSyncDuration:undefined,// used by latency-controller
liveMaxLatencyDuration:undefined,// used by latency-controller
maxLiveSyncPlaybackRate:1,// used by latency-controller
liveDurationInfinity:false,// used by buffer-controller
liveBackBufferLength:null,// used by buffer-controller
maxMaxBufferLength:600,// used by stream-controller
enableWorker:true,// used by demuxer
enableSoftwareAES:true,// used by decrypter
manifestLoadingTimeOut:10000,// used by playlist-loader
manifestLoadingMaxRetry:1,// used by playlist-loader
manifestLoadingRetryDelay:1000,// used by playlist-loader
manifestLoadingMaxRetryTimeout:64000,// used by playlist-loader
startLevel:undefined,// used by level-controller
levelLoadingTimeOut:10000,// used by playlist-loader
levelLoadingMaxRetry:4,// used by playlist-loader
levelLoadingRetryDelay:1000,// used by playlist-loader
levelLoadingMaxRetryTimeout:64000,// used by playlist-loader
fragLoadingTimeOut:20000,// used by fragment-loader
fragLoadingMaxRetry:6,// used by fragment-loader
fragLoadingRetryDelay:1000,// used by fragment-loader
fragLoadingMaxRetryTimeout:64000,// used by fragment-loader
startFragPrefetch:false,// used by stream-controller
fpsDroppedMonitoringPeriod:5000,// used by fps-controller
fpsDroppedMonitoringThreshold:0.2,// used by fps-controller
appendErrorMaxRetry:3,// used by buffer-controller
loader:_utils_xhr_loader__WEBPACK_IMPORTED_MODULE_11__["default"],// loader: FetchLoader,
fLoader:undefined,// used by fragment-loader
pLoader:undefined,// used by playlist-loader
xhrSetup:undefined,// used by xhr-loader
licenseXhrSetup:undefined,// used by eme-controller
licenseResponseCallback:undefined,// used by eme-controller
abrController:_controller_abr_controller__WEBPACK_IMPORTED_MODULE_0__["default"],bufferController:_controller_buffer_controller__WEBPACK_IMPORTED_MODULE_5__["default"],capLevelController:_controller_cap_level_controller__WEBPACK_IMPORTED_MODULE_7__["default"],fpsController:_controller_fps_controller__WEBPACK_IMPORTED_MODULE_8__["default"],stretchShortVideoTrack:false,// used by mp4-remuxer
maxAudioFramesDrift:1,// used by mp4-remuxer
forceKeyFrameOnDiscontinuity:true,// used by ts-demuxer
abrEwmaFastLive:3,// used by abr-controller
abrEwmaSlowLive:9,// used by abr-controller
abrEwmaFastVoD:3,// used by abr-controller
abrEwmaSlowVoD:9,// used by abr-controller
abrEwmaDefaultEstimate:5e5,// 500 kbps  // used by abr-controller
abrBandWidthFactor:0.95,// used by abr-controller
abrBandWidthUpFactor:0.7,// used by abr-controller
abrMaxWithRealBitrate:false,// used by abr-controller
maxStarvationDelay:4,// used by abr-controller
maxLoadingDelay:4,// used by abr-controller
minAutoBitrate:0,// used by hls
emeEnabled:false,// used by eme-controller
widevineLicenseUrl:undefined,// used by eme-controller
drmSystemOptions:{},// used by eme-controller
requestMediaKeySystemAccessFunc:_utils_mediakeys_helper__WEBPACK_IMPORTED_MODULE_14__["requestMediaKeySystemAccess"],// used by eme-controller
testBandwidth:true,progressive:false,lowLatencyMode:true,cmcd:undefined},timelineConfig()),{},{subtitleStreamController:_controller_subtitle_stream_controller__WEBPACK_IMPORTED_MODULE_3__["SubtitleStreamController"],subtitleTrackController:_controller_subtitle_track_controller__WEBPACK_IMPORTED_MODULE_4__["default"],timelineController:_controller_timeline_controller__WEBPACK_IMPORTED_MODULE_6__["TimelineController"],audioStreamController:_controller_audio_stream_controller__WEBPACK_IMPORTED_MODULE_1__["default"],audioTrackController:_controller_audio_track_controller__WEBPACK_IMPORTED_MODULE_2__["default"],emeController:_controller_eme_controller__WEBPACK_IMPORTED_MODULE_9__["default"],cmcdController:_controller_cmcd_controller__WEBPACK_IMPORTED_MODULE_10__["default"]});function timelineConfig(){return{cueHandler:_utils_cues__WEBPACK_IMPORTED_MODULE_13__["default"],// used by timeline-controller
enableCEA708Captions:true,// used by timeline-controller
enableWebVTT:true,// used by timeline-controller
enableIMSC1:true,// used by timeline-controller
captionsTextTrack1Label:'English',// used by timeline-controller
captionsTextTrack1LanguageCode:'en',// used by timeline-controller
captionsTextTrack2Label:'Spanish',// used by timeline-controller
captionsTextTrack2LanguageCode:'es',// used by timeline-controller
captionsTextTrack3Label:'Unknown CC',// used by timeline-controller
captionsTextTrack3LanguageCode:'',// used by timeline-controller
captionsTextTrack4Label:'Unknown CC',// used by timeline-controller
captionsTextTrack4LanguageCode:'',// used by timeline-controller
renderTextTracksNatively:true};}function mergeConfig(defaultConfig,userConfig){if((userConfig.liveSyncDurationCount||userConfig.liveMaxLatencyDurationCount)&&(userConfig.liveSyncDuration||userConfig.liveMaxLatencyDuration)){throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");}if(userConfig.liveMaxLatencyDurationCount!==undefined&&(userConfig.liveSyncDurationCount===undefined||userConfig.liveMaxLatencyDurationCount<=userConfig.liveSyncDurationCount)){throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');}if(userConfig.liveMaxLatencyDuration!==undefined&&(userConfig.liveSyncDuration===undefined||userConfig.liveMaxLatencyDuration<=userConfig.liveSyncDuration)){throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');}return _extends({},defaultConfig,userConfig);}function enableStreamingMode(config){var currentLoader=config.loader;if(currentLoader!==_utils_fetch_loader__WEBPACK_IMPORTED_MODULE_12__["default"]&&currentLoader!==_utils_xhr_loader__WEBPACK_IMPORTED_MODULE_11__["default"]){// If a developer has configured their own loader, respect that choice
_utils_logger__WEBPACK_IMPORTED_MODULE_15__["logger"].log('[config]: Custom loader detected, cannot enable progressive streaming');config.progressive=false;}else{var canStreamProgressively=Object(_utils_fetch_loader__WEBPACK_IMPORTED_MODULE_12__["fetchSupported"])();if(canStreamProgressively){config.loader=_utils_fetch_loader__WEBPACK_IMPORTED_MODULE_12__["default"];config.progressive=true;config.enableSoftwareAES=true;_utils_logger__WEBPACK_IMPORTED_MODULE_15__["logger"].log('[config]: Progressive streaming enabled, using FetchLoader');}}}/***/},/***/"./src/controller/abr-controller.ts":/*!******************************************!*\
			  !*** ./src/controller/abr-controller.ts ***!
			  \******************************************/ /*! exports provided: default */ /***/function srcControllerAbrControllerTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var _home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./src/polyfills/number */"./src/polyfills/number.ts");/* harmony import */var _utils_ewma_bandwidth_estimator__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../utils/ewma-bandwidth-estimator */"./src/utils/ewma-bandwidth-estimator.ts");/* harmony import */var _events__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../events */"./src/events.ts");/* harmony import */var _utils_buffer_helper__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts");/* harmony import */var _errors__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(/*! ../errors */"./src/errors.ts");/* harmony import */var _types_loader__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(/*! ../types/loader */"./src/types/loader.ts");/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(/*! ../utils/logger */"./src/utils/logger.ts");function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}var AbrController=/*#__PURE__*/function(){function AbrController(hls){this.hls=void 0;this.lastLoadedFragLevel=0;this._nextAutoLevel=-1;this.timer=void 0;this.onCheck=this._abandonRulesCheck.bind(this);this.fragCurrent=null;this.partCurrent=null;this.bitrateTestDelay=0;this.bwEstimator=void 0;this.hls=hls;var config=hls.config;this.bwEstimator=new _utils_ewma_bandwidth_estimator__WEBPACK_IMPORTED_MODULE_1__["default"](config.abrEwmaSlowVoD,config.abrEwmaFastVoD,config.abrEwmaDefaultEstimate);this.registerListeners();}var _proto=AbrController.prototype;_proto.registerListeners=function registerListeners(){var hls=this.hls;hls.on(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].FRAG_LOADING,this.onFragLoading,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].FRAG_LOADED,this.onFragLoaded,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].FRAG_BUFFERED,this.onFragBuffered,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].LEVEL_LOADED,this.onLevelLoaded,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].ERROR,this.onError,this);};_proto.unregisterListeners=function unregisterListeners(){var hls=this.hls;hls.off(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].FRAG_LOADING,this.onFragLoading,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].FRAG_LOADED,this.onFragLoaded,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].FRAG_BUFFERED,this.onFragBuffered,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].LEVEL_LOADED,this.onLevelLoaded,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].ERROR,this.onError,this);};_proto.destroy=function destroy(){this.unregisterListeners();this.clearTimer();// @ts-ignore
this.hls=this.onCheck=null;this.fragCurrent=this.partCurrent=null;};_proto.onFragLoading=function onFragLoading(event,data){var frag=data.frag;if(frag.type===_types_loader__WEBPACK_IMPORTED_MODULE_5__["PlaylistLevelType"].MAIN){if(!this.timer){var _data$part;this.fragCurrent=frag;this.partCurrent=(_data$part=data.part)!=null?_data$part:null;this.timer=self.setInterval(this.onCheck,100);}}};_proto.onLevelLoaded=function onLevelLoaded(event,data){var config=this.hls.config;if(data.details.live){this.bwEstimator.update(config.abrEwmaSlowLive,config.abrEwmaFastLive);}else{this.bwEstimator.update(config.abrEwmaSlowVoD,config.abrEwmaFastVoD);}}/*
			      This method monitors the download rate of the current fragment, and will downswitch if that fragment will not load
			      quickly enough to prevent underbuffering
			    */;_proto._abandonRulesCheck=function _abandonRulesCheck(){var frag=this.fragCurrent,part=this.partCurrent,hls=this.hls;var autoLevelEnabled=hls.autoLevelEnabled,config=hls.config,media=hls.media;if(!frag||!media){return;}var stats=part?part.stats:frag.stats;var duration=part?part.duration:frag.duration;// If loading has been aborted and not in lowLatencyMode, stop timer and return
if(stats.aborted){_utils_logger__WEBPACK_IMPORTED_MODULE_6__["logger"].warn('frag loader destroy or aborted, disarm abandonRules');this.clearTimer();// reset forced auto level value so that next level will be selected
this._nextAutoLevel=-1;return;}// This check only runs if we're in ABR mode and actually playing
if(!autoLevelEnabled||media.paused||!media.playbackRate||!media.readyState){return;}var requestDelay=performance.now()-stats.loading.start;var playbackRate=Math.abs(media.playbackRate);// In order to work with a stable bandwidth, only begin monitoring bandwidth after half of the fragment has been loaded
if(requestDelay<=500*duration/playbackRate){return;}var levels=hls.levels,minAutoLevel=hls.minAutoLevel;var level=levels[frag.level];var expectedLen=stats.total||Math.max(stats.loaded,Math.round(duration*level.maxBitrate/8));var loadRate=Math.max(1,stats.bwEstimate?stats.bwEstimate/8:stats.loaded*1000/requestDelay);// fragLoadDelay is an estimate of the time (in seconds) it will take to buffer the entire fragment
var fragLoadedDelay=(expectedLen-stats.loaded)/loadRate;var pos=media.currentTime;// bufferStarvationDelay is an estimate of the amount time (in seconds) it will take to exhaust the buffer
var bufferStarvationDelay=(_utils_buffer_helper__WEBPACK_IMPORTED_MODULE_3__["BufferHelper"].bufferInfo(media,pos,config.maxBufferHole).end-pos)/playbackRate;// Attempt an emergency downswitch only if less than 2 fragment lengths are buffered, and the time to finish loading
// the current fragment is greater than the amount of buffer we have left
if(bufferStarvationDelay>=2*duration/playbackRate||fragLoadedDelay<=bufferStarvationDelay){return;}var fragLevelNextLoadedDelay=Number.POSITIVE_INFINITY;var nextLoadLevel;// Iterate through lower level and try to find the largest one that avoids rebuffering
for(nextLoadLevel=frag.level-1;nextLoadLevel>minAutoLevel;nextLoadLevel--){// compute time to load next fragment at lower level
// 0.8 : consider only 80% of current bw to be conservative
// 8 = bits per byte (bps/Bps)
var levelNextBitrate=levels[nextLoadLevel].maxBitrate;fragLevelNextLoadedDelay=duration*levelNextBitrate/(8*0.8*loadRate);if(fragLevelNextLoadedDelay<bufferStarvationDelay){break;}}// Only emergency switch down if it takes less time to load a new fragment at lowest level instead of continuing
// to load the current one
if(fragLevelNextLoadedDelay>=fragLoadedDelay){return;}var bwEstimate=this.bwEstimator.getEstimate();_utils_logger__WEBPACK_IMPORTED_MODULE_6__["logger"].warn("Fragment "+frag.sn+(part?' part '+part.index:'')+" of level "+frag.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+nextLoadLevel+"\n      Current BW estimate: "+(Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(bwEstimate)?(bwEstimate/1024).toFixed(3):'Unknown')+" Kb/s\n      Estimated load time for current fragment: "+fragLoadedDelay.toFixed(3)+" s\n      Estimated load time for the next fragment: "+fragLevelNextLoadedDelay.toFixed(3)+" s\n      Time to underbuffer: "+bufferStarvationDelay.toFixed(3)+" s");hls.nextLoadLevel=nextLoadLevel;this.bwEstimator.sample(requestDelay,stats.loaded);this.clearTimer();if(frag.loader){this.fragCurrent=this.partCurrent=null;frag.loader.abort();}hls.trigger(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].FRAG_LOAD_EMERGENCY_ABORTED,{frag:frag,part:part,stats:stats});};_proto.onFragLoaded=function onFragLoaded(event,_ref){var frag=_ref.frag,part=_ref.part;if(frag.type===_types_loader__WEBPACK_IMPORTED_MODULE_5__["PlaylistLevelType"].MAIN&&Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(frag.sn)){var stats=part?part.stats:frag.stats;var duration=part?part.duration:frag.duration;// stop monitoring bw once frag loaded
this.clearTimer();// store level id after successful fragment load
this.lastLoadedFragLevel=frag.level;// reset forced auto level value so that next level will be selected
this._nextAutoLevel=-1;// compute level average bitrate
if(this.hls.config.abrMaxWithRealBitrate){var level=this.hls.levels[frag.level];var loadedBytes=(level.loaded?level.loaded.bytes:0)+stats.loaded;var loadedDuration=(level.loaded?level.loaded.duration:0)+duration;level.loaded={bytes:loadedBytes,duration:loadedDuration};level.realBitrate=Math.round(8*loadedBytes/loadedDuration);}if(frag.bitrateTest){var fragBufferedData={stats:stats,frag:frag,part:part,id:frag.type};this.onFragBuffered(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].FRAG_BUFFERED,fragBufferedData);frag.bitrateTest=false;}}};_proto.onFragBuffered=function onFragBuffered(event,data){var frag=data.frag,part=data.part;var stats=part?part.stats:frag.stats;if(stats.aborted){return;}// Only count non-alt-audio frags which were actually buffered in our BW calculations
if(frag.type!==_types_loader__WEBPACK_IMPORTED_MODULE_5__["PlaylistLevelType"].MAIN||frag.sn==='initSegment'){return;}// Use the difference between parsing and request instead of buffering and request to compute fragLoadingProcessing;
// rationale is that buffer appending only happens once media is attached. This can happen when config.startFragPrefetch
// is used. If we used buffering in that case, our BW estimate sample will be very large.
var processingMs=stats.parsing.end-stats.loading.start;this.bwEstimator.sample(processingMs,stats.loaded);stats.bwEstimate=this.bwEstimator.getEstimate();if(frag.bitrateTest){this.bitrateTestDelay=processingMs/1000;}else{this.bitrateTestDelay=0;}};_proto.onError=function onError(event,data){// stop timer in case of frag loading error
switch(data.details){case _errors__WEBPACK_IMPORTED_MODULE_4__["ErrorDetails"].FRAG_LOAD_ERROR:case _errors__WEBPACK_IMPORTED_MODULE_4__["ErrorDetails"].FRAG_LOAD_TIMEOUT:this.clearTimer();break;}};_proto.clearTimer=function clearTimer(){self.clearInterval(this.timer);this.timer=undefined;}// return next auto level
;_proto.getNextABRAutoLevel=function getNextABRAutoLevel(){var fragCurrent=this.fragCurrent,partCurrent=this.partCurrent,hls=this.hls;var maxAutoLevel=hls.maxAutoLevel,config=hls.config,minAutoLevel=hls.minAutoLevel,media=hls.media;var currentFragDuration=partCurrent?partCurrent.duration:fragCurrent?fragCurrent.duration:0;var pos=media?media.currentTime:0;// playbackRate is the absolute value of the playback rate; if media.playbackRate is 0, we use 1 to load as
// if we're playing back at the normal rate.
var playbackRate=media&&media.playbackRate!==0?Math.abs(media.playbackRate):1.0;var avgbw=this.bwEstimator?this.bwEstimator.getEstimate():config.abrEwmaDefaultEstimate;// bufferStarvationDelay is the wall-clock time left until the playback buffer is exhausted.
var bufferStarvationDelay=(_utils_buffer_helper__WEBPACK_IMPORTED_MODULE_3__["BufferHelper"].bufferInfo(media,pos,config.maxBufferHole).end-pos)/playbackRate;// First, look to see if we can find a level matching with our avg bandwidth AND that could also guarantee no rebuffering at all
var bestLevel=this.findBestLevel(avgbw,minAutoLevel,maxAutoLevel,bufferStarvationDelay,config.abrBandWidthFactor,config.abrBandWidthUpFactor);if(bestLevel>=0){return bestLevel;}_utils_logger__WEBPACK_IMPORTED_MODULE_6__["logger"].trace((bufferStarvationDelay?'rebuffering expected':'buffer is empty')+", finding optimal quality level");// not possible to get rid of rebuffering ... let's try to find level that will guarantee less than maxStarvationDelay of rebuffering
// if no matching level found, logic will return 0
var maxStarvationDelay=currentFragDuration?Math.min(currentFragDuration,config.maxStarvationDelay):config.maxStarvationDelay;var bwFactor=config.abrBandWidthFactor;var bwUpFactor=config.abrBandWidthUpFactor;if(!bufferStarvationDelay){// in case buffer is empty, let's check if previous fragment was loaded to perform a bitrate test
var bitrateTestDelay=this.bitrateTestDelay;if(bitrateTestDelay){// if it is the case, then we need to adjust our max starvation delay using maxLoadingDelay config value
// max video loading delay used in  automatic start level selection :
// in that mode ABR controller will ensure that video loading time (ie the time to fetch the first fragment at lowest quality level +
// the time to fetch the fragment at the appropriate quality level is less than ```maxLoadingDelay``` )
// cap maxLoadingDelay and ensure it is not bigger 'than bitrate test' frag duration
var maxLoadingDelay=currentFragDuration?Math.min(currentFragDuration,config.maxLoadingDelay):config.maxLoadingDelay;maxStarvationDelay=maxLoadingDelay-bitrateTestDelay;_utils_logger__WEBPACK_IMPORTED_MODULE_6__["logger"].trace("bitrate test took "+Math.round(1000*bitrateTestDelay)+"ms, set first fragment max fetchDuration to "+Math.round(1000*maxStarvationDelay)+" ms");// don't use conservative factor on bitrate test
bwFactor=bwUpFactor=1;}}bestLevel=this.findBestLevel(avgbw,minAutoLevel,maxAutoLevel,bufferStarvationDelay+maxStarvationDelay,bwFactor,bwUpFactor);return Math.max(bestLevel,0);};_proto.findBestLevel=function findBestLevel(currentBw,minAutoLevel,maxAutoLevel,maxFetchDuration,bwFactor,bwUpFactor){var _level$details;var fragCurrent=this.fragCurrent,partCurrent=this.partCurrent,currentLevel=this.lastLoadedFragLevel;var levels=this.hls.levels;var level=levels[currentLevel];var live=!!(level!==null&&level!==void 0&&(_level$details=level.details)!==null&&_level$details!==void 0&&_level$details.live);var currentCodecSet=level===null||level===void 0?void 0:level.codecSet;var currentFragDuration=partCurrent?partCurrent.duration:fragCurrent?fragCurrent.duration:0;for(var i=maxAutoLevel;i>=minAutoLevel;i--){var levelInfo=levels[i];if(!levelInfo||currentCodecSet&&levelInfo.codecSet!==currentCodecSet){continue;}var levelDetails=levelInfo.details;var avgDuration=(partCurrent?levelDetails===null||levelDetails===void 0?void 0:levelDetails.partTarget:levelDetails===null||levelDetails===void 0?void 0:levelDetails.averagetargetduration)||currentFragDuration;var adjustedbw=void 0;// follow algorithm captured from stagefright :
// https://android.googlesource.com/platform/frameworks/av/+/master/media/libstagefright/httplive/LiveSession.cpp
// Pick the highest bandwidth stream below or equal to estimated bandwidth.
// consider only 80% of the available bandwidth, but if we are switching up,
// be even more conservative (70%) to avoid overestimating and immediately
// switching back.
if(i<=currentLevel){adjustedbw=bwFactor*currentBw;}else{adjustedbw=bwUpFactor*currentBw;}var bitrate=levels[i].maxBitrate;var fetchDuration=bitrate*avgDuration/adjustedbw;_utils_logger__WEBPACK_IMPORTED_MODULE_6__["logger"].trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+i+"/"+Math.round(adjustedbw)+"/"+bitrate+"/"+avgDuration+"/"+maxFetchDuration+"/"+fetchDuration);// if adjusted bw is greater than level bitrate AND
if(adjustedbw>bitrate&&(// fragment fetchDuration unknown OR live stream OR fragment fetchDuration less than max allowed fetch duration, then this level matches
// we don't account for max Fetch Duration for live streams, this is to avoid switching down when near the edge of live sliding window ...
// special case to support startLevel = -1 (bitrateTest) on live streams : in that case we should not exit loop so that findBestLevel will return -1
!fetchDuration||live&&!this.bitrateTestDelay||fetchDuration<maxFetchDuration)){// as we are looping from highest to lowest, this will return the best achievable quality level
return i;}}// not enough time budget even with quality level 0 ... rebuffering might happen
return-1;};_createClass(AbrController,[{key:"nextAutoLevel",get:function get(){var forcedAutoLevel=this._nextAutoLevel;var bwEstimator=this.bwEstimator;// in case next auto level has been forced, and bw not available or not reliable, return forced value
if(forcedAutoLevel!==-1&&(!bwEstimator||!bwEstimator.canEstimate())){return forcedAutoLevel;}// compute next level using ABR logic
var nextABRAutoLevel=this.getNextABRAutoLevel();// if forced auto level has been defined, use it to cap ABR computed quality level
if(forcedAutoLevel!==-1){nextABRAutoLevel=Math.min(forcedAutoLevel,nextABRAutoLevel);}return nextABRAutoLevel;},set:function set(nextLevel){this._nextAutoLevel=nextLevel;}}]);return AbrController;}();/* harmony default export */__webpack_exports__["default"]=AbrController;/***/},/***/"./src/controller/audio-stream-controller.ts":/*!***************************************************!*\
			  !*** ./src/controller/audio-stream-controller.ts ***!
			  \***************************************************/ /*! exports provided: default */ /***/function srcControllerAudioStreamControllerTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var _home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./src/polyfills/number */"./src/polyfills/number.ts");/* harmony import */var _base_stream_controller__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ./base-stream-controller */"./src/controller/base-stream-controller.ts");/* harmony import */var _events__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../events */"./src/events.ts");/* harmony import */var _utils_buffer_helper__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts");/* harmony import */var _fragment_tracker__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(/*! ./fragment-tracker */"./src/controller/fragment-tracker.ts");/* harmony import */var _types_level__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(/*! ../types/level */"./src/types/level.ts");/* harmony import */var _types_loader__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(/*! ../types/loader */"./src/types/loader.ts");/* harmony import */var _loader_fragment__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(/*! ../loader/fragment */"./src/loader/fragment.ts");/* harmony import */var _demux_chunk_cache__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(/*! ../demux/chunk-cache */"./src/demux/chunk-cache.ts");/* harmony import */var _demux_transmuxer_interface__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(/*! ../demux/transmuxer-interface */"./src/demux/transmuxer-interface.ts");/* harmony import */var _types_transmuxer__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(/*! ../types/transmuxer */"./src/types/transmuxer.ts");/* harmony import */var _fragment_finders__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(/*! ./fragment-finders */"./src/controller/fragment-finders.ts");/* harmony import */var _utils_discontinuities__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(/*! ../utils/discontinuities */"./src/utils/discontinuities.ts");/* harmony import */var _errors__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(/*! ../errors */"./src/errors.ts");/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(/*! ../utils/logger */"./src/utils/logger.ts");function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};return _extends.apply(this,arguments);}function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype);subClass.prototype.constructor=subClass;_setPrototypeOf(subClass,superClass);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}var TICK_INTERVAL=100;// how often to tick in ms
var AudioStreamController=/*#__PURE__*/function(_BaseStreamController){_inheritsLoose(AudioStreamController,_BaseStreamController);function AudioStreamController(hls,fragmentTracker){var _this;_this=_BaseStreamController.call(this,hls,fragmentTracker,'[audio-stream-controller]')||this;_this.videoBuffer=null;_this.videoTrackCC=-1;_this.waitingVideoCC=-1;_this.audioSwitch=false;_this.trackId=-1;_this.waitingData=null;_this.mainDetails=null;_this.bufferFlushed=false;_this._registerListeners();return _this;}var _proto=AudioStreamController.prototype;_proto.onHandlerDestroying=function onHandlerDestroying(){this._unregisterListeners();this.mainDetails=null;};_proto._registerListeners=function _registerListeners(){var hls=this.hls;hls.on(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].MEDIA_ATTACHED,this.onMediaAttached,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].MANIFEST_LOADING,this.onManifestLoading,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].LEVEL_LOADED,this.onLevelLoaded,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].ERROR,this.onError,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].BUFFER_RESET,this.onBufferReset,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].BUFFER_CREATED,this.onBufferCreated,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].BUFFER_FLUSHED,this.onBufferFlushed,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].INIT_PTS_FOUND,this.onInitPtsFound,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].FRAG_BUFFERED,this.onFragBuffered,this);};_proto._unregisterListeners=function _unregisterListeners(){var hls=this.hls;hls.off(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].MEDIA_ATTACHED,this.onMediaAttached,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].MANIFEST_LOADING,this.onManifestLoading,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].LEVEL_LOADED,this.onLevelLoaded,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].ERROR,this.onError,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].BUFFER_RESET,this.onBufferReset,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].BUFFER_CREATED,this.onBufferCreated,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].BUFFER_FLUSHED,this.onBufferFlushed,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].INIT_PTS_FOUND,this.onInitPtsFound,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].FRAG_BUFFERED,this.onFragBuffered,this);}// INIT_PTS_FOUND is triggered when the video track parsed in the stream-controller has a new PTS value
;_proto.onInitPtsFound=function onInitPtsFound(event,_ref){var frag=_ref.frag,id=_ref.id,initPTS=_ref.initPTS;// Always update the new INIT PTS
// Can change due level switch
if(id==='main'){var cc=frag.cc;this.initPTS[frag.cc]=initPTS;this.log("InitPTS for cc: "+cc+" found from main: "+initPTS);this.videoTrackCC=cc;// If we are waiting, tick immediately to unblock audio fragment transmuxing
if(this.state===_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].WAITING_INIT_PTS){this.tick();}}};_proto.startLoad=function startLoad(startPosition){if(!this.levels){this.startPosition=startPosition;this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].STOPPED;return;}var lastCurrentTime=this.lastCurrentTime;this.stopLoad();this.setInterval(TICK_INTERVAL);this.fragLoadError=0;if(lastCurrentTime>0&&startPosition===-1){this.log("Override startPosition with lastCurrentTime @"+lastCurrentTime.toFixed(3));this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].IDLE;}else{this.loadedmetadata=false;this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].WAITING_TRACK;}this.nextLoadPosition=this.startPosition=this.lastCurrentTime=startPosition;this.tick();};_proto.doTick=function doTick(){switch(this.state){case _base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].IDLE:this.doTickIdle();break;case _base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].WAITING_TRACK:{var _levels$trackId;var levels=this.levels,trackId=this.trackId;var details=levels===null||levels===void 0?void 0:(_levels$trackId=levels[trackId])===null||_levels$trackId===void 0?void 0:_levels$trackId.details;if(details){if(this.waitForCdnTuneIn(details)){break;}this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].WAITING_INIT_PTS;}break;}case _base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].FRAG_LOADING_WAITING_RETRY:{var _this$media;var now=performance.now();var retryDate=this.retryDate;// if current time is gt than retryDate, or if media seeking let's switch to IDLE state to retry loading
if(!retryDate||now>=retryDate||(_this$media=this.media)!==null&&_this$media!==void 0&&_this$media.seeking){this.log('RetryDate reached, switch back to IDLE state');this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].IDLE;}break;}case _base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].WAITING_INIT_PTS:{// Ensure we don't get stuck in the WAITING_INIT_PTS state if the waiting frag CC doesn't match any initPTS
var waitingData=this.waitingData;if(waitingData){var frag=waitingData.frag,part=waitingData.part,cache=waitingData.cache,complete=waitingData.complete;if(this.initPTS[frag.cc]!==undefined){this.waitingData=null;this.waitingVideoCC=-1;this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].FRAG_LOADING;var payload=cache.flush();var data={frag:frag,part:part,payload:payload,networkDetails:null};this._handleFragmentLoadProgress(data);if(complete){_BaseStreamController.prototype._handleFragmentLoadComplete.call(this,data);}}else if(this.videoTrackCC!==this.waitingVideoCC){// Drop waiting fragment if videoTrackCC has changed since waitingFragment was set and initPTS was not found
_utils_logger__WEBPACK_IMPORTED_MODULE_14__["logger"].log("Waiting fragment cc ("+frag.cc+") cancelled because video is at cc "+this.videoTrackCC);this.clearWaitingFragment();}else{// Drop waiting fragment if an earlier fragment is needed
var pos=this.getLoadPosition();var bufferInfo=_utils_buffer_helper__WEBPACK_IMPORTED_MODULE_3__["BufferHelper"].bufferInfo(this.mediaBuffer,pos,this.config.maxBufferHole);var waitingFragmentAtPosition=Object(_fragment_finders__WEBPACK_IMPORTED_MODULE_11__["fragmentWithinToleranceTest"])(bufferInfo.end,this.config.maxFragLookUpTolerance,frag);if(waitingFragmentAtPosition<0){_utils_logger__WEBPACK_IMPORTED_MODULE_14__["logger"].log("Waiting fragment cc ("+frag.cc+") @ "+frag.start+" cancelled because another fragment at "+bufferInfo.end+" is needed");this.clearWaitingFragment();}}}else{this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].IDLE;}}}this.onTickEnd();};_proto.clearWaitingFragment=function clearWaitingFragment(){var waitingData=this.waitingData;if(waitingData){this.fragmentTracker.removeFragment(waitingData.frag);this.waitingData=null;this.waitingVideoCC=-1;this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].IDLE;}};_proto.onTickEnd=function onTickEnd(){var media=this.media;if(!media||!media.readyState){// Exit early if we don't have media or if the media hasn't buffered anything yet (readyState 0)
return;}var mediaBuffer=this.mediaBuffer?this.mediaBuffer:media;var buffered=mediaBuffer.buffered;if(!this.loadedmetadata&&buffered.length){this.loadedmetadata=true;}this.lastCurrentTime=media.currentTime;};_proto.doTickIdle=function doTickIdle(){var _frag$decryptdata,_frag$decryptdata2;var hls=this.hls,levels=this.levels,media=this.media,trackId=this.trackId;var config=hls.config;if(!levels||!levels[trackId]){return;}// if video not attached AND
// start fragment already requested OR start frag prefetch not enabled
// exit loop
// => if media not attached but start frag prefetch is enabled and start frag not requested yet, we will not exit loop
if(!media&&(this.startFragRequested||!config.startFragPrefetch)){return;}var levelInfo=levels[trackId];var trackDetails=levelInfo.details;if(!trackDetails||trackDetails.live&&this.levelLastLoaded!==trackId||this.waitForCdnTuneIn(trackDetails)){this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].WAITING_TRACK;return;}if(this.bufferFlushed){this.bufferFlushed=false;this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,_loader_fragment__WEBPACK_IMPORTED_MODULE_7__["ElementaryStreamTypes"].AUDIO,_types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistLevelType"].AUDIO);}var bufferInfo=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,_types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistLevelType"].AUDIO);if(bufferInfo===null){return;}var bufferLen=bufferInfo.len;var maxBufLen=this.getMaxBufferLength();var audioSwitch=this.audioSwitch;// if buffer length is less than maxBufLen try to load a new fragment
if(bufferLen>=maxBufLen&&!audioSwitch){return;}if(!audioSwitch&&this._streamEnded(bufferInfo,trackDetails)){hls.trigger(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].BUFFER_EOS,{type:'audio'});this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].ENDED;return;}var fragments=trackDetails.fragments;var start=fragments[0].start;var targetBufferTime=bufferInfo.end;if(audioSwitch){var pos=this.getLoadPosition();targetBufferTime=pos;// if currentTime (pos) is less than alt audio playlist start time, it means that alt audio is ahead of currentTime
if(trackDetails.PTSKnown&&pos<start){// if everything is buffered from pos to start or if audio buffer upfront, let's seek to start
if(bufferInfo.end>start||bufferInfo.nextStart){this.log('Alt audio track ahead of main track, seek to start of alt audio track');media.currentTime=start+0.05;}}}var frag=this.getNextFragment(targetBufferTime,trackDetails);if(!frag){this.bufferFlushed=true;return;}if(((_frag$decryptdata=frag.decryptdata)===null||_frag$decryptdata===void 0?void 0:_frag$decryptdata.keyFormat)==='identity'&&!((_frag$decryptdata2=frag.decryptdata)!==null&&_frag$decryptdata2!==void 0&&_frag$decryptdata2.key)){this.loadKey(frag,trackDetails);}else{this.loadFragment(frag,trackDetails,targetBufferTime);}};_proto.getMaxBufferLength=function getMaxBufferLength(){var maxConfigBuffer=_BaseStreamController.prototype.getMaxBufferLength.call(this);var mainBufferInfo=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,_types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistLevelType"].MAIN);if(mainBufferInfo===null){return maxConfigBuffer;}return Math.max(maxConfigBuffer,mainBufferInfo.len);};_proto.onMediaDetaching=function onMediaDetaching(){this.videoBuffer=null;_BaseStreamController.prototype.onMediaDetaching.call(this);};_proto.onAudioTracksUpdated=function onAudioTracksUpdated(event,_ref2){var audioTracks=_ref2.audioTracks;this.resetTransmuxer();this.levels=audioTracks.map(function(mediaPlaylist){return new _types_level__WEBPACK_IMPORTED_MODULE_5__["Level"](mediaPlaylist);});};_proto.onAudioTrackSwitching=function onAudioTrackSwitching(event,data){// if any URL found on new audio track, it is an alternate audio track
var altAudio=!!data.url;this.trackId=data.id;var fragCurrent=this.fragCurrent;if(fragCurrent!==null&&fragCurrent!==void 0&&fragCurrent.loader){fragCurrent.loader.abort();}this.fragCurrent=null;this.clearWaitingFragment();// destroy useless transmuxer when switching audio to main
if(!altAudio){this.resetTransmuxer();}else{// switching to audio track, start timer if not already started
this.setInterval(TICK_INTERVAL);}// should we switch tracks ?
if(altAudio){this.audioSwitch=true;// main audio track are handled by stream-controller, just do something if switching to alt audio track
this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].IDLE;}else{this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].STOPPED;}this.tick();};_proto.onManifestLoading=function onManifestLoading(){this.mainDetails=null;this.fragmentTracker.removeAllFragments();this.startPosition=this.lastCurrentTime=0;this.bufferFlushed=false;};_proto.onLevelLoaded=function onLevelLoaded(event,data){this.mainDetails=data.details;};_proto.onAudioTrackLoaded=function onAudioTrackLoaded(event,data){var _track$details;var levels=this.levels;var newDetails=data.details,trackId=data.id;if(!levels){this.warn("Audio tracks were reset while loading level "+trackId);return;}this.log("Track "+trackId+" loaded ["+newDetails.startSN+","+newDetails.endSN+"],duration:"+newDetails.totalduration);var track=levels[trackId];var sliding=0;if(newDetails.live||(_track$details=track.details)!==null&&_track$details!==void 0&&_track$details.live){var mainDetails=this.mainDetails;if(!newDetails.fragments[0]){newDetails.deltaUpdateFailed=true;}if(newDetails.deltaUpdateFailed||!mainDetails){return;}if(!track.details&&newDetails.hasProgramDateTime&&mainDetails.hasProgramDateTime){// Make sure our audio rendition is aligned with the "main" rendition, using
// pdt as our reference times.
Object(_utils_discontinuities__WEBPACK_IMPORTED_MODULE_12__["alignMediaPlaylistByPDT"])(newDetails,mainDetails);sliding=newDetails.fragments[0].start;}else{sliding=this.alignPlaylists(newDetails,track.details);}}track.details=newDetails;this.levelLastLoaded=trackId;// compute start position if we are aligned with the main playlist
if(!this.startFragRequested&&(this.mainDetails||!newDetails.live)){this.setStartPosition(track.details,sliding);}// only switch back to IDLE state if we were waiting for track to start downloading a new fragment
if(this.state===_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].WAITING_TRACK&&!this.waitForCdnTuneIn(newDetails)){this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].IDLE;}// trigger handler right now
this.tick();};_proto._handleFragmentLoadProgress=function _handleFragmentLoadProgress(data){var _frag$initSegment;var frag=data.frag,part=data.part,payload=data.payload;var config=this.config,trackId=this.trackId,levels=this.levels;if(!levels){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+frag.sn+" of level "+frag.level+" will not be buffered");return;}var track=levels[trackId];console.assert(track,'Audio track is defined on fragment load progress');var details=track.details;console.assert(details,'Audio track details are defined on fragment load progress');var audioCodec=config.defaultAudioCodec||track.audioCodec||'mp4a.40.2';var transmuxer=this.transmuxer;if(!transmuxer){transmuxer=this.transmuxer=new _demux_transmuxer_interface__WEBPACK_IMPORTED_MODULE_9__["default"](this.hls,_types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistLevelType"].AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this));}// Check if we have video initPTS
// If not we need to wait for it
var initPTS=this.initPTS[frag.cc];var initSegmentData=(_frag$initSegment=frag.initSegment)===null||_frag$initSegment===void 0?void 0:_frag$initSegment.data;if(initPTS!==undefined){// this.log(`Transmuxing ${sn} of [${details.startSN} ,${details.endSN}],track ${trackId}`);
// time Offset is accurate if level PTS is known, or if playlist is not sliding (not live)
var accurateTimeOffset=false;// details.PTSKnown || !details.live;
var partIndex=part?part.index:-1;var partial=partIndex!==-1;var chunkMeta=new _types_transmuxer__WEBPACK_IMPORTED_MODULE_10__["ChunkMetadata"](frag.level,frag.sn,frag.stats.chunkCount,payload.byteLength,partIndex,partial);transmuxer.push(payload,initSegmentData,audioCodec,'',frag,part,details.totalduration,accurateTimeOffset,chunkMeta,initPTS);}else{_utils_logger__WEBPACK_IMPORTED_MODULE_14__["logger"].log("Unknown video PTS for cc "+frag.cc+", waiting for video PTS before demuxing audio frag "+frag.sn+" of ["+details.startSN+" ,"+details.endSN+"],track "+trackId);var _this$waitingData=this.waitingData=this.waitingData||{frag:frag,part:part,cache:new _demux_chunk_cache__WEBPACK_IMPORTED_MODULE_8__["default"](),complete:false},cache=_this$waitingData.cache;cache.push(new Uint8Array(payload));this.waitingVideoCC=this.videoTrackCC;this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].WAITING_INIT_PTS;}};_proto._handleFragmentLoadComplete=function _handleFragmentLoadComplete(fragLoadedData){if(this.waitingData){this.waitingData.complete=true;return;}_BaseStreamController.prototype._handleFragmentLoadComplete.call(this,fragLoadedData);};_proto.onBufferReset=function/* event: Events.BUFFER_RESET */onBufferReset(){// reset reference to sourcebuffers
this.mediaBuffer=this.videoBuffer=null;this.loadedmetadata=false;};_proto.onBufferCreated=function onBufferCreated(event,data){var audioTrack=data.tracks.audio;if(audioTrack){this.mediaBuffer=audioTrack.buffer;}if(data.tracks.video){this.videoBuffer=data.tracks.video.buffer;}};_proto.onFragBuffered=function onFragBuffered(event,data){var frag=data.frag,part=data.part;if(frag.type!==_types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistLevelType"].AUDIO){return;}if(this.fragContextChanged(frag)){// If a level switch was requested while a fragment was buffering, it will emit the FRAG_BUFFERED event upon completion
// Avoid setting state back to IDLE or concluding the audio switch; otherwise, the switched-to track will not buffer
this.warn("Fragment "+frag.sn+(part?' p: '+part.index:'')+" of level "+frag.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return;}if(frag.sn!=='initSegment'){this.fragPrevious=frag;if(this.audioSwitch){this.audioSwitch=false;this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].AUDIO_TRACK_SWITCHED,{id:this.trackId});}}this.fragBufferedComplete(frag,part);};_proto.onError=function onError(event,data){switch(data.details){case _errors__WEBPACK_IMPORTED_MODULE_13__["ErrorDetails"].FRAG_LOAD_ERROR:case _errors__WEBPACK_IMPORTED_MODULE_13__["ErrorDetails"].FRAG_LOAD_TIMEOUT:case _errors__WEBPACK_IMPORTED_MODULE_13__["ErrorDetails"].KEY_LOAD_ERROR:case _errors__WEBPACK_IMPORTED_MODULE_13__["ErrorDetails"].KEY_LOAD_TIMEOUT:// TODO: Skip fragments that do not belong to this.fragCurrent audio-group id
this.onFragmentOrKeyLoadError(_types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistLevelType"].AUDIO,data);break;case _errors__WEBPACK_IMPORTED_MODULE_13__["ErrorDetails"].AUDIO_TRACK_LOAD_ERROR:case _errors__WEBPACK_IMPORTED_MODULE_13__["ErrorDetails"].AUDIO_TRACK_LOAD_TIMEOUT://  when in ERROR state, don't switch back to IDLE state in case a non-fatal error is received
if(this.state!==_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].ERROR&&this.state!==_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].STOPPED){// if fatal error, stop processing, otherwise move to IDLE to retry loading
this.state=data.fatal?_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].ERROR:_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].IDLE;this.warn(data.details+" while loading frag, switching to "+this.state+" state");}break;case _errors__WEBPACK_IMPORTED_MODULE_13__["ErrorDetails"].BUFFER_FULL_ERROR:// if in appending state
if(data.parent==='audio'&&(this.state===_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].PARSING||this.state===_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].PARSED)){var flushBuffer=true;var bufferedInfo=this.getFwdBufferInfo(this.mediaBuffer,_types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistLevelType"].AUDIO);// 0.5 : tolerance needed as some browsers stalls playback before reaching buffered end
// reduce max buf len if current position is buffered
if(bufferedInfo&&bufferedInfo.len>0.5){flushBuffer=!this.reduceMaxBufferLength(bufferedInfo.len);}if(flushBuffer){// current position is not buffered, but browser is still complaining about buffer full error
// this happens on IE/Edge, refer to https://github.com/video-dev/hls.js/pull/708
// in that case flush the whole audio buffer to recover
this.warn('Buffer full error also media.currentTime is not buffered, flush audio buffer');this.fragCurrent=null;_BaseStreamController.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,'audio');}this.resetLoadingState();}break;}};_proto.onBufferFlushed=function onBufferFlushed(event,_ref3){var type=_ref3.type;if(type===_loader_fragment__WEBPACK_IMPORTED_MODULE_7__["ElementaryStreamTypes"].AUDIO){this.bufferFlushed=true;}};_proto._handleTransmuxComplete=function _handleTransmuxComplete(transmuxResult){var _id3$samples;var id='audio';var hls=this.hls;var remuxResult=transmuxResult.remuxResult,chunkMeta=transmuxResult.chunkMeta;var context=this.getCurrentContext(chunkMeta);if(!context){this.warn("The loading context changed while buffering fragment "+chunkMeta.sn+" of level "+chunkMeta.level+". This chunk will not be buffered.");this.resetLiveStartWhenNotLoaded(chunkMeta.level);return;}var frag=context.frag,part=context.part;var audio=remuxResult.audio,text=remuxResult.text,id3=remuxResult.id3,initSegment=remuxResult.initSegment;// Check if the current fragment has been aborted. We check this by first seeing if we're still playing the current level.
// If we are, subsequently check if the currently loading fragment (fragCurrent) has changed.
if(this.fragContextChanged(frag)){return;}this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].PARSING;if(this.audioSwitch&&audio){this.completeAudioSwitch();}if(initSegment!==null&&initSegment!==void 0&&initSegment.tracks){this._bufferInitSegment(initSegment.tracks,frag,chunkMeta);hls.trigger(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].FRAG_PARSING_INIT_SEGMENT,{frag:frag,id:id,tracks:initSegment.tracks});// Only flush audio from old audio tracks when PTS is known on new audio track
}if(audio){var startPTS=audio.startPTS,endPTS=audio.endPTS,startDTS=audio.startDTS,endDTS=audio.endDTS;if(part){part.elementaryStreams[_loader_fragment__WEBPACK_IMPORTED_MODULE_7__["ElementaryStreamTypes"].AUDIO]={startPTS:startPTS,endPTS:endPTS,startDTS:startDTS,endDTS:endDTS};}frag.setElementaryStreamInfo(_loader_fragment__WEBPACK_IMPORTED_MODULE_7__["ElementaryStreamTypes"].AUDIO,startPTS,endPTS,startDTS,endDTS);this.bufferFragmentData(audio,frag,part,chunkMeta);}if(id3!==null&&id3!==void 0&&(_id3$samples=id3.samples)!==null&&_id3$samples!==void 0&&_id3$samples.length){var emittedID3=_extends({frag:frag,id:id},id3);hls.trigger(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].FRAG_PARSING_METADATA,emittedID3);}if(text){var emittedText=_extends({frag:frag,id:id},text);hls.trigger(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].FRAG_PARSING_USERDATA,emittedText);}};_proto._bufferInitSegment=function _bufferInitSegment(tracks,frag,chunkMeta){if(this.state!==_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].PARSING){return;}// delete any video track found on audio transmuxer
if(tracks.video){delete tracks.video;}// include levelCodec in audio and video tracks
var track=tracks.audio;if(!track){return;}track.levelCodec=track.codec;track.id='audio';this.log("Init audio buffer, container:"+track.container+", codecs[parsed]=["+track.codec+"]");this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].BUFFER_CODECS,tracks);var initSegment=track.initSegment;if(initSegment!==null&&initSegment!==void 0&&initSegment.byteLength){var segment={type:'audio',frag:frag,part:null,chunkMeta:chunkMeta,parent:frag.type,data:initSegment};this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].BUFFER_APPENDING,segment);}// trigger handler right now
this.tick();};_proto.loadFragment=function loadFragment(frag,trackDetails,targetBufferTime){// only load if fragment is not loaded or if in audio switch
var fragState=this.fragmentTracker.getState(frag);this.fragCurrent=frag;// we force a frag loading in audio switch as fragment tracker might not have evicted previous frags in case of quick audio switch
if(this.audioSwitch||fragState===_fragment_tracker__WEBPACK_IMPORTED_MODULE_4__["FragmentState"].NOT_LOADED||fragState===_fragment_tracker__WEBPACK_IMPORTED_MODULE_4__["FragmentState"].PARTIAL){if(frag.sn==='initSegment'){this._loadInitSegment(frag);}else if(trackDetails.live&&!Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(this.initPTS[frag.cc])){this.log("Waiting for video PTS in continuity counter "+frag.cc+" of live stream before loading audio fragment "+frag.sn+" of level "+this.trackId);this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].WAITING_INIT_PTS;}else{this.startFragRequested=true;_BaseStreamController.prototype.loadFragment.call(this,frag,trackDetails,targetBufferTime);}}};_proto.completeAudioSwitch=function completeAudioSwitch(){var hls=this.hls,media=this.media,trackId=this.trackId;if(media){this.log('Switching audio track : flushing all audio');_BaseStreamController.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,'audio');}this.audioSwitch=false;hls.trigger(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].AUDIO_TRACK_SWITCHED,{id:trackId});};return AudioStreamController;}(_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["default"]);/* harmony default export */__webpack_exports__["default"]=AudioStreamController;/***/},/***/"./src/controller/audio-track-controller.ts":/*!**************************************************!*\
			  !*** ./src/controller/audio-track-controller.ts ***!
			  \**************************************************/ /*! exports provided: default */ /***/function srcControllerAudioTrackControllerTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var _events__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../events */"./src/events.ts");/* harmony import */var _errors__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../errors */"./src/errors.ts");/* harmony import */var _base_playlist_controller__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ./base-playlist-controller */"./src/controller/base-playlist-controller.ts");/* harmony import */var _types_loader__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ../types/loader */"./src/types/loader.ts");function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype);subClass.prototype.constructor=subClass;_setPrototypeOf(subClass,superClass);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}var AudioTrackController=/*#__PURE__*/function(_BasePlaylistControll){_inheritsLoose(AudioTrackController,_BasePlaylistControll);function AudioTrackController(hls){var _this;_this=_BasePlaylistControll.call(this,hls,'[audio-track-controller]')||this;_this.tracks=[];_this.groupId=null;_this.tracksInGroup=[];_this.trackId=-1;_this.trackName='';_this.selectDefaultTrack=true;_this.registerListeners();return _this;}var _proto=AudioTrackController.prototype;_proto.registerListeners=function registerListeners(){var hls=this.hls;hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MANIFEST_LOADING,this.onManifestLoading,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MANIFEST_PARSED,this.onManifestParsed,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].LEVEL_LOADING,this.onLevelLoading,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].LEVEL_SWITCHING,this.onLevelSwitching,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].ERROR,this.onError,this);};_proto.unregisterListeners=function unregisterListeners(){var hls=this.hls;hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MANIFEST_LOADING,this.onManifestLoading,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MANIFEST_PARSED,this.onManifestParsed,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].LEVEL_LOADING,this.onLevelLoading,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].LEVEL_SWITCHING,this.onLevelSwitching,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].ERROR,this.onError,this);};_proto.destroy=function destroy(){this.unregisterListeners();this.tracks.length=0;this.tracksInGroup.length=0;_BasePlaylistControll.prototype.destroy.call(this);};_proto.onManifestLoading=function onManifestLoading(){this.tracks=[];this.groupId=null;this.tracksInGroup=[];this.trackId=-1;this.trackName='';this.selectDefaultTrack=true;};_proto.onManifestParsed=function onManifestParsed(event,data){this.tracks=data.audioTracks||[];};_proto.onAudioTrackLoaded=function onAudioTrackLoaded(event,data){var id=data.id,details=data.details;var currentTrack=this.tracksInGroup[id];if(!currentTrack){this.warn("Invalid audio track id "+id);return;}var curDetails=currentTrack.details;currentTrack.details=data.details;this.log("audioTrack "+id+" loaded ["+details.startSN+"-"+details.endSN+"]");if(id===this.trackId){this.retryCount=0;this.playlistLoaded(id,data,curDetails);}};_proto.onLevelLoading=function onLevelLoading(event,data){this.switchLevel(data.level);};_proto.onLevelSwitching=function onLevelSwitching(event,data){this.switchLevel(data.level);};_proto.switchLevel=function switchLevel(levelIndex){var levelInfo=this.hls.levels[levelIndex];if(!(levelInfo!==null&&levelInfo!==void 0&&levelInfo.audioGroupIds)){return;}var audioGroupId=levelInfo.audioGroupIds[levelInfo.urlId];if(this.groupId!==audioGroupId){this.groupId=audioGroupId;var audioTracks=this.tracks.filter(function(track){return!audioGroupId||track.groupId===audioGroupId;});// Disable selectDefaultTrack if there are no default tracks
if(this.selectDefaultTrack&&!audioTracks.some(function(track){return track.default;})){this.selectDefaultTrack=false;}this.tracksInGroup=audioTracks;var audioTracksUpdated={audioTracks:audioTracks};this.log("Updating audio tracks, "+audioTracks.length+" track(s) found in \""+audioGroupId+"\" group-id");this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].AUDIO_TRACKS_UPDATED,audioTracksUpdated);this.selectInitialTrack();}};_proto.onError=function onError(event,data){_BasePlaylistControll.prototype.onError.call(this,event,data);if(data.fatal||!data.context){return;}if(data.context.type===_types_loader__WEBPACK_IMPORTED_MODULE_3__["PlaylistContextType"].AUDIO_TRACK&&data.context.id===this.trackId&&data.context.groupId===this.groupId){this.retryLoadingOrFail(data);}};_proto.setAudioTrack=function setAudioTrack(newId){var tracks=this.tracksInGroup;// check if level idx is valid
if(newId<0||newId>=tracks.length){this.warn('Invalid id passed to audio-track controller');return;}// stopping live reloading timer if any
this.clearTimer();var lastTrack=tracks[this.trackId];this.log("Now switching to audio-track index "+newId);var track=tracks[newId];var id=track.id,_track$groupId=track.groupId,groupId=_track$groupId===void 0?'':_track$groupId,name=track.name,type=track.type,url=track.url;this.trackId=newId;this.trackName=name;this.selectDefaultTrack=false;this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].AUDIO_TRACK_SWITCHING,{id:id,groupId:groupId,name:name,type:type,url:url});// Do not reload track unless live
if(track.details&&!track.details.live){return;}var hlsUrlParameters=this.switchParams(track.url,lastTrack===null||lastTrack===void 0?void 0:lastTrack.details);this.loadPlaylist(hlsUrlParameters);};_proto.selectInitialTrack=function selectInitialTrack(){var audioTracks=this.tracksInGroup;console.assert(audioTracks.length,'Initial audio track should be selected when tracks are known');var currentAudioTrackName=this.trackName;var trackId=this.findTrackId(currentAudioTrackName)||this.findTrackId();if(trackId!==-1){this.setAudioTrack(trackId);}else{this.warn("No track found for running audio group-ID: "+this.groupId);this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].ERROR,{type:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorTypes"].MEDIA_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorDetails"].AUDIO_TRACK_LOAD_ERROR,fatal:true});}};_proto.findTrackId=function findTrackId(name){var audioTracks=this.tracksInGroup;for(var i=0;i<audioTracks.length;i++){var track=audioTracks[i];if(!this.selectDefaultTrack||track.default){if(!name||name===track.name){return track.id;}}}return-1;};_proto.loadPlaylist=function loadPlaylist(hlsUrlParameters){var audioTrack=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(audioTrack)){var id=audioTrack.id;var groupId=audioTrack.groupId;var url=audioTrack.url;if(hlsUrlParameters){try{url=hlsUrlParameters.addDirectives(url);}catch(error){this.warn("Could not construct new URL with HLS Delivery Directives: "+error);}}// track not retrieved yet, or live playlist we need to (re)load it
this.log("loading audio-track playlist for id: "+id);this.clearTimer();this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].AUDIO_TRACK_LOADING,{url:url,id:id,groupId:groupId,deliveryDirectives:hlsUrlParameters||null});}};_createClass(AudioTrackController,[{key:"audioTracks",get:function get(){return this.tracksInGroup;}},{key:"audioTrack",get:function get(){return this.trackId;},set:function set(newId){// If audio track is selected from API then don't choose from the manifest default track
this.selectDefaultTrack=false;this.setAudioTrack(newId);}}]);return AudioTrackController;}(_base_playlist_controller__WEBPACK_IMPORTED_MODULE_2__["default"]);/* harmony default export */__webpack_exports__["default"]=AudioTrackController;/***/},/***/"./src/controller/base-playlist-controller.ts":/*!****************************************************!*\
			  !*** ./src/controller/base-playlist-controller.ts ***!
			  \****************************************************/ /*! exports provided: default */ /***/function srcControllerBasePlaylistControllerTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"default",function(){return BasePlaylistController;});/* harmony import */var _home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./src/polyfills/number */"./src/polyfills/number.ts");/* harmony import */var _types_level__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../types/level */"./src/types/level.ts");/* harmony import */var _level_helper__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ./level-helper */"./src/controller/level-helper.ts");/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ../utils/logger */"./src/utils/logger.ts");/* harmony import */var _errors__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(/*! ../errors */"./src/errors.ts");var BasePlaylistController=/*#__PURE__*/function(){function BasePlaylistController(hls,logPrefix){this.hls=void 0;this.timer=-1;this.canLoad=false;this.retryCount=0;this.log=void 0;this.warn=void 0;this.log=_utils_logger__WEBPACK_IMPORTED_MODULE_3__["logger"].log.bind(_utils_logger__WEBPACK_IMPORTED_MODULE_3__["logger"],logPrefix+":");this.warn=_utils_logger__WEBPACK_IMPORTED_MODULE_3__["logger"].warn.bind(_utils_logger__WEBPACK_IMPORTED_MODULE_3__["logger"],logPrefix+":");this.hls=hls;}var _proto=BasePlaylistController.prototype;_proto.destroy=function destroy(){this.clearTimer();// @ts-ignore
this.hls=this.log=this.warn=null;};_proto.onError=function onError(event,data){if(data.fatal&&data.type===_errors__WEBPACK_IMPORTED_MODULE_4__["ErrorTypes"].NETWORK_ERROR){this.clearTimer();}};_proto.clearTimer=function clearTimer(){clearTimeout(this.timer);this.timer=-1;};_proto.startLoad=function startLoad(){this.canLoad=true;this.retryCount=0;this.loadPlaylist();};_proto.stopLoad=function stopLoad(){this.canLoad=false;this.clearTimer();};_proto.switchParams=function switchParams(playlistUri,previous){var renditionReports=previous===null||previous===void 0?void 0:previous.renditionReports;if(renditionReports){for(var i=0;i<renditionReports.length;i++){var attr=renditionReports[i];var uri=''+attr.URI;if(uri===playlistUri.substr(-uri.length)){var msn=parseInt(attr['LAST-MSN']);var part=parseInt(attr['LAST-PART']);if(previous&&this.hls.config.lowLatencyMode){var currentGoal=Math.min(previous.age-previous.partTarget,previous.targetduration);if(part!==undefined&&currentGoal>previous.partTarget){part+=1;}}if(Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(msn)){return new _types_level__WEBPACK_IMPORTED_MODULE_1__["HlsUrlParameters"](msn,Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(part)?part:undefined,_types_level__WEBPACK_IMPORTED_MODULE_1__["HlsSkip"].No);}}}}};_proto.loadPlaylist=function loadPlaylist(hlsUrlParameters){};_proto.shouldLoadTrack=function shouldLoadTrack(track){return this.canLoad&&track&&!!track.url&&(!track.details||track.details.live);};_proto.playlistLoaded=function playlistLoaded(index,data,previousDetails){var _this=this;var details=data.details,stats=data.stats;// Set last updated date-time
var elapsed=stats.loading.end?Math.max(0,self.performance.now()-stats.loading.end):0;details.advancedDateTime=Date.now()-elapsed;// if current playlist is a live playlist, arm a timer to reload it
if(details.live||previousDetails!==null&&previousDetails!==void 0&&previousDetails.live){details.reloaded(previousDetails);if(previousDetails){this.log("live playlist "+index+" "+(details.advanced?'REFRESHED '+details.lastPartSn+'-'+details.lastPartIndex:'MISSED'));}// Merge live playlists to adjust fragment starts and fill in delta playlist skipped segments
if(previousDetails&&details.fragments.length>0){Object(_level_helper__WEBPACK_IMPORTED_MODULE_2__["mergeDetails"])(previousDetails,details);}if(!this.canLoad||!details.live){return;}var deliveryDirectives;var msn=undefined;var part=undefined;if(details.canBlockReload&&details.endSN&&details.advanced){// Load level with LL-HLS delivery directives
var lowLatencyMode=this.hls.config.lowLatencyMode;var lastPartSn=details.lastPartSn;var endSn=details.endSN;var lastPartIndex=details.lastPartIndex;var hasParts=lastPartIndex!==-1;var lastPart=lastPartSn===endSn;// When low latency mode is disabled, we'll skip part requests once the last part index is found
var nextSnStartIndex=lowLatencyMode?0:lastPartIndex;if(hasParts){msn=lastPart?endSn+1:lastPartSn;part=lastPart?nextSnStartIndex:lastPartIndex+1;}else{msn=endSn+1;}// Low-Latency CDN Tune-in: "age" header and time since load indicates we're behind by more than one part
// Update directives to obtain the Playlist that has the estimated additional duration of media
var lastAdvanced=details.age;var cdnAge=lastAdvanced+details.ageHeader;var currentGoal=Math.min(cdnAge-details.partTarget,details.targetduration*1.5);if(currentGoal>0){if(previousDetails&&currentGoal>previousDetails.tuneInGoal){// If we attempted to get the next or latest playlist update, but currentGoal increased,
// then we either can't catchup, or the "age" header cannot be trusted.
this.warn("CDN Tune-in goal increased from: "+previousDetails.tuneInGoal+" to: "+currentGoal+" with playlist age: "+details.age);currentGoal=0;}else{var segments=Math.floor(currentGoal/details.targetduration);msn+=segments;if(part!==undefined){var parts=Math.round(currentGoal%details.targetduration/details.partTarget);part+=parts;}this.log("CDN Tune-in age: "+details.ageHeader+"s last advanced "+lastAdvanced.toFixed(2)+"s goal: "+currentGoal+" skip sn "+segments+" to part "+part);}details.tuneInGoal=currentGoal;}deliveryDirectives=this.getDeliveryDirectives(details,data.deliveryDirectives,msn,part);if(lowLatencyMode||!lastPart){this.loadPlaylist(deliveryDirectives);return;}}else{deliveryDirectives=this.getDeliveryDirectives(details,data.deliveryDirectives,msn,part);}var reloadInterval=Object(_level_helper__WEBPACK_IMPORTED_MODULE_2__["computeReloadInterval"])(details,stats);if(msn!==undefined&&details.canBlockReload){reloadInterval-=details.partTarget||1;}this.log("reload live playlist "+index+" in "+Math.round(reloadInterval)+" ms");this.timer=self.setTimeout(function(){return _this.loadPlaylist(deliveryDirectives);},reloadInterval);}else{this.clearTimer();}};_proto.getDeliveryDirectives=function getDeliveryDirectives(details,previousDeliveryDirectives,msn,part){var skip=Object(_types_level__WEBPACK_IMPORTED_MODULE_1__["getSkipValue"])(details,msn);if(previousDeliveryDirectives!==null&&previousDeliveryDirectives!==void 0&&previousDeliveryDirectives.skip&&details.deltaUpdateFailed){msn=previousDeliveryDirectives.msn;part=previousDeliveryDirectives.part;skip=_types_level__WEBPACK_IMPORTED_MODULE_1__["HlsSkip"].No;}return new _types_level__WEBPACK_IMPORTED_MODULE_1__["HlsUrlParameters"](msn,part,skip);};_proto.retryLoadingOrFail=function retryLoadingOrFail(errorEvent){var _this2=this;var config=this.hls.config;var retry=this.retryCount<config.levelLoadingMaxRetry;if(retry){var _errorEvent$context;this.retryCount++;if(errorEvent.details.indexOf('LoadTimeOut')>-1&&(_errorEvent$context=errorEvent.context)!==null&&_errorEvent$context!==void 0&&_errorEvent$context.deliveryDirectives){// The LL-HLS request already timed out so retry immediately
this.warn("retry playlist loading #"+this.retryCount+" after \""+errorEvent.details+"\"");this.loadPlaylist();}else{// exponential backoff capped to max retry timeout
var delay=Math.min(Math.pow(2,this.retryCount)*config.levelLoadingRetryDelay,config.levelLoadingMaxRetryTimeout);// Schedule level/track reload
this.timer=self.setTimeout(function(){return _this2.loadPlaylist();},delay);this.warn("retry playlist loading #"+this.retryCount+" in "+delay+" ms after \""+errorEvent.details+"\"");}}else{this.warn("cannot recover from error \""+errorEvent.details+"\"");// stopping live reloading timer if any
this.clearTimer();// switch error to fatal
errorEvent.fatal=true;}return retry;};return BasePlaylistController;}();/***/},/***/"./src/controller/base-stream-controller.ts":/*!**************************************************!*\
			  !*** ./src/controller/base-stream-controller.ts ***!
			  \**************************************************/ /*! exports provided: State, default */ /***/function srcControllerBaseStreamControllerTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"State",function(){return State;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"default",function(){return BaseStreamController;});/* harmony import */var _home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./src/polyfills/number */"./src/polyfills/number.ts");/* harmony import */var _task_loop__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../task-loop */"./src/task-loop.ts");/* harmony import */var _fragment_tracker__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ./fragment-tracker */"./src/controller/fragment-tracker.ts");/* harmony import */var _utils_buffer_helper__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts");/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(/*! ../utils/logger */"./src/utils/logger.ts");/* harmony import */var _events__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(/*! ../events */"./src/events.ts");/* harmony import */var _errors__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(/*! ../errors */"./src/errors.ts");/* harmony import */var _types_transmuxer__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(/*! ../types/transmuxer */"./src/types/transmuxer.ts");/* harmony import */var _utils_mp4_tools__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts");/* harmony import */var _utils_discontinuities__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(/*! ../utils/discontinuities */"./src/utils/discontinuities.ts");/* harmony import */var _fragment_finders__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(/*! ./fragment-finders */"./src/controller/fragment-finders.ts");/* harmony import */var _level_helper__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(/*! ./level-helper */"./src/controller/level-helper.ts");/* harmony import */var _loader_fragment_loader__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(/*! ../loader/fragment-loader */"./src/loader/fragment-loader.ts");/* harmony import */var _crypt_decrypter__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(/*! ../crypt/decrypter */"./src/crypt/decrypter.ts");/* harmony import */var _utils_time_ranges__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(/*! ../utils/time-ranges */"./src/utils/time-ranges.ts");/* harmony import */var _types_loader__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(/*! ../types/loader */"./src/types/loader.ts");function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype);subClass.prototype.constructor=subClass;_setPrototypeOf(subClass,superClass);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}var State={STOPPED:'STOPPED',IDLE:'IDLE',KEY_LOADING:'KEY_LOADING',FRAG_LOADING:'FRAG_LOADING',FRAG_LOADING_WAITING_RETRY:'FRAG_LOADING_WAITING_RETRY',WAITING_TRACK:'WAITING_TRACK',PARSING:'PARSING',PARSED:'PARSED',BACKTRACKING:'BACKTRACKING',ENDED:'ENDED',ERROR:'ERROR',WAITING_INIT_PTS:'WAITING_INIT_PTS',WAITING_LEVEL:'WAITING_LEVEL'};var BaseStreamController=/*#__PURE__*/function(_TaskLoop){_inheritsLoose(BaseStreamController,_TaskLoop);function BaseStreamController(hls,fragmentTracker,logPrefix){var _this;_this=_TaskLoop.call(this)||this;_this.hls=void 0;_this.fragPrevious=null;_this.fragCurrent=null;_this.fragmentTracker=void 0;_this.transmuxer=null;_this._state=State.STOPPED;_this.media=void 0;_this.mediaBuffer=void 0;_this.config=void 0;_this.bitrateTest=false;_this.lastCurrentTime=0;_this.nextLoadPosition=0;_this.startPosition=0;_this.loadedmetadata=false;_this.fragLoadError=0;_this.retryDate=0;_this.levels=null;_this.fragmentLoader=void 0;_this.levelLastLoaded=null;_this.startFragRequested=false;_this.decrypter=void 0;_this.initPTS=[];_this.onvseeking=null;_this.onvended=null;_this.logPrefix='';_this.log=void 0;_this.warn=void 0;_this.logPrefix=logPrefix;_this.log=_utils_logger__WEBPACK_IMPORTED_MODULE_4__["logger"].log.bind(_utils_logger__WEBPACK_IMPORTED_MODULE_4__["logger"],logPrefix+":");_this.warn=_utils_logger__WEBPACK_IMPORTED_MODULE_4__["logger"].warn.bind(_utils_logger__WEBPACK_IMPORTED_MODULE_4__["logger"],logPrefix+":");_this.hls=hls;_this.fragmentLoader=new _loader_fragment_loader__WEBPACK_IMPORTED_MODULE_12__["default"](hls.config);_this.fragmentTracker=fragmentTracker;_this.config=hls.config;_this.decrypter=new _crypt_decrypter__WEBPACK_IMPORTED_MODULE_13__["default"](hls,hls.config);hls.on(_events__WEBPACK_IMPORTED_MODULE_5__["Events"].KEY_LOADED,_this.onKeyLoaded,_assertThisInitialized(_this));return _this;}var _proto=BaseStreamController.prototype;_proto.doTick=function doTick(){this.onTickEnd();};_proto.onTickEnd=function onTickEnd(){}// eslint-disable-next-line @typescript-eslint/no-unused-vars
;_proto.startLoad=function startLoad(startPosition){};_proto.stopLoad=function stopLoad(){this.fragmentLoader.abort();var frag=this.fragCurrent;if(frag){this.fragmentTracker.removeFragment(frag);}this.resetTransmuxer();this.fragCurrent=null;this.fragPrevious=null;this.clearInterval();this.clearNextTick();this.state=State.STOPPED;};_proto._streamEnded=function _streamEnded(bufferInfo,levelDetails){var fragCurrent=this.fragCurrent,fragmentTracker=this.fragmentTracker;// we just got done loading the final fragment and there is no other buffered range after ...
// rationale is that in case there are any buffered ranges after, it means that there are unbuffered portion in between
// so we should not switch to ENDED in that case, to be able to buffer them
if(!levelDetails.live&&fragCurrent&&// NOTE: Because of the way parts are currently parsed/represented in the playlist, we can end up
// in situations where the current fragment is actually greater than levelDetails.endSN. While
// this feels like the "wrong place" to account for that, this is a narrower/safer change than
// updating e.g. M3U8Parser::parseLevelPlaylist().
fragCurrent.sn>=levelDetails.endSN&&!bufferInfo.nextStart){var partList=levelDetails.partList;// Since the last part isn't guaranteed to correspond to fragCurrent for ll-hls, check instead if the last part is buffered.
if(partList!==null&&partList!==void 0&&partList.length){var lastPart=partList[partList.length-1];// Checking the midpoint of the part for potential margin of error and related issues.
// NOTE: Technically I believe parts could yield content that is < the computed duration (including potential a duration of 0)
// and still be spec-compliant, so there may still be edge cases here. Likewise, there could be issues in end of stream
// part mismatches for independent audio and video playlists/segments.
var lastPartBuffered=_utils_buffer_helper__WEBPACK_IMPORTED_MODULE_3__["BufferHelper"].isBuffered(this.media,lastPart.start+lastPart.duration/2);return lastPartBuffered;}var fragState=fragmentTracker.getState(fragCurrent);return fragState===_fragment_tracker__WEBPACK_IMPORTED_MODULE_2__["FragmentState"].PARTIAL||fragState===_fragment_tracker__WEBPACK_IMPORTED_MODULE_2__["FragmentState"].OK;}return false;};_proto.onMediaAttached=function onMediaAttached(event,data){var media=this.media=this.mediaBuffer=data.media;this.onvseeking=this.onMediaSeeking.bind(this);this.onvended=this.onMediaEnded.bind(this);media.addEventListener('seeking',this.onvseeking);media.addEventListener('ended',this.onvended);var config=this.config;if(this.levels&&config.autoStartLoad&&this.state===State.STOPPED){this.startLoad(config.startPosition);}};_proto.onMediaDetaching=function onMediaDetaching(){var media=this.media;if(media!==null&&media!==void 0&&media.ended){this.log('MSE detaching and video ended, reset startPosition');this.startPosition=this.lastCurrentTime=0;}// remove video listeners
if(media){media.removeEventListener('seeking',this.onvseeking);media.removeEventListener('ended',this.onvended);this.onvseeking=this.onvended=null;}this.media=this.mediaBuffer=null;this.loadedmetadata=false;this.fragmentTracker.removeAllFragments();this.stopLoad();};_proto.onMediaSeeking=function onMediaSeeking(){var config=this.config,fragCurrent=this.fragCurrent,media=this.media,mediaBuffer=this.mediaBuffer,state=this.state;var currentTime=media?media.currentTime:0;var bufferInfo=_utils_buffer_helper__WEBPACK_IMPORTED_MODULE_3__["BufferHelper"].bufferInfo(mediaBuffer||media,currentTime,config.maxBufferHole);this.log("media seeking to "+(Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(currentTime)?currentTime.toFixed(3):currentTime)+", state: "+state);if(state===State.ENDED){this.resetLoadingState();}else if(fragCurrent&&!bufferInfo.len){// check if we are seeking to a unbuffered area AND if frag loading is in progress
var tolerance=config.maxFragLookUpTolerance;var fragStartOffset=fragCurrent.start-tolerance;var fragEndOffset=fragCurrent.start+fragCurrent.duration+tolerance;var pastFragment=currentTime>fragEndOffset;// check if the seek position is past current fragment, and if so abort loading
if(currentTime<fragStartOffset||pastFragment){if(pastFragment&&fragCurrent.loader){this.log('seeking outside of buffer while fragment load in progress, cancel fragment load');fragCurrent.loader.abort();}this.resetLoadingState();}}if(media){this.lastCurrentTime=currentTime;}// in case seeking occurs although no media buffered, adjust startPosition and nextLoadPosition to seek target
if(!this.loadedmetadata&&!bufferInfo.len){this.nextLoadPosition=this.startPosition=currentTime;}// Async tick to speed up processing
this.tickImmediate();};_proto.onMediaEnded=function onMediaEnded(){// reset startPosition and lastCurrentTime to restart playback @ stream beginning
this.startPosition=this.lastCurrentTime=0;};_proto.onKeyLoaded=function onKeyLoaded(event,data){if(this.state!==State.KEY_LOADING||data.frag!==this.fragCurrent||!this.levels){return;}this.state=State.IDLE;var levelDetails=this.levels[data.frag.level].details;if(levelDetails){this.loadFragment(data.frag,levelDetails,data.frag.start);}};_proto.onHandlerDestroying=function onHandlerDestroying(){this.stopLoad();_TaskLoop.prototype.onHandlerDestroying.call(this);};_proto.onHandlerDestroyed=function onHandlerDestroyed(){this.state=State.STOPPED;this.hls.off(_events__WEBPACK_IMPORTED_MODULE_5__["Events"].KEY_LOADED,this.onKeyLoaded,this);if(this.fragmentLoader){this.fragmentLoader.destroy();}if(this.decrypter){this.decrypter.destroy();}this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null;_TaskLoop.prototype.onHandlerDestroyed.call(this);};_proto.loadKey=function loadKey(frag,details){this.log("Loading key for "+frag.sn+" of ["+details.startSN+"-"+details.endSN+"], "+(this.logPrefix==='[stream-controller]'?'level':'track')+" "+frag.level);this.state=State.KEY_LOADING;this.fragCurrent=frag;this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_5__["Events"].KEY_LOADING,{frag:frag});};_proto.loadFragment=function loadFragment(frag,levelDetails,targetBufferTime){this._loadFragForPlayback(frag,levelDetails,targetBufferTime);};_proto._loadFragForPlayback=function _loadFragForPlayback(frag,levelDetails,targetBufferTime){var _this2=this;var progressCallback=function progressCallback(data){if(_this2.fragContextChanged(frag)){_this2.warn("Fragment "+frag.sn+(data.part?' p: '+data.part.index:'')+" of level "+frag.level+" was dropped during download.");_this2.fragmentTracker.removeFragment(frag);return;}frag.stats.chunkCount++;_this2._handleFragmentLoadProgress(data);};this._doFragLoad(frag,levelDetails,targetBufferTime,progressCallback).then(function(data){if(!data){// if we're here we probably needed to backtrack or are waiting for more parts
return;}_this2.fragLoadError=0;var state=_this2.state;if(_this2.fragContextChanged(frag)){if(state===State.FRAG_LOADING||state===State.BACKTRACKING||!_this2.fragCurrent&&state===State.PARSING){_this2.fragmentTracker.removeFragment(frag);_this2.state=State.IDLE;}return;}if('payload'in data){_this2.log("Loaded fragment "+frag.sn+" of level "+frag.level);_this2.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_5__["Events"].FRAG_LOADED,data);// Tracker backtrack must be called after onFragLoaded to update the fragment entity state to BACKTRACKED
// This happens after handleTransmuxComplete when the worker or progressive is disabled
if(_this2.state===State.BACKTRACKING){_this2.fragmentTracker.backtrack(frag,data);_this2.resetFragmentLoading(frag);return;}}// Pass through the whole payload; controllers not implementing progressive loading receive data from this callback
_this2._handleFragmentLoadComplete(data);}).catch(function(reason){_this2.warn(reason);_this2.resetFragmentLoading(frag);});};_proto.flushMainBuffer=function flushMainBuffer(startOffset,endOffset,type){if(type===void 0){type=null;}if(!(startOffset-endOffset)){return;}// When alternate audio is playing, the audio-stream-controller is responsible for the audio buffer. Otherwise,
// passing a null type flushes both buffers
var flushScope={startOffset:startOffset,endOffset:endOffset,type:type};// Reset load errors on flush
this.fragLoadError=0;this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_5__["Events"].BUFFER_FLUSHING,flushScope);};_proto._loadInitSegment=function _loadInitSegment(frag){var _this3=this;this._doFragLoad(frag).then(function(data){if(!data||_this3.fragContextChanged(frag)||!_this3.levels){throw new Error('init load aborted');}return data;}).then(function(data){var hls=_this3.hls;var payload=data.payload;var decryptData=frag.decryptdata;// check to see if the payload needs to be decrypted
if(payload&&payload.byteLength>0&&decryptData&&decryptData.key&&decryptData.iv&&decryptData.method==='AES-128'){var startTime=self.performance.now();// decrypt the subtitles
return _this3.decrypter.webCryptoDecrypt(new Uint8Array(payload),decryptData.key.buffer,decryptData.iv.buffer).then(function(decryptedData){var endTime=self.performance.now();hls.trigger(_events__WEBPACK_IMPORTED_MODULE_5__["Events"].FRAG_DECRYPTED,{frag:frag,payload:decryptedData,stats:{tstart:startTime,tdecrypt:endTime}});data.payload=decryptedData;return data;});}return data;}).then(function(data){var fragCurrent=_this3.fragCurrent,hls=_this3.hls,levels=_this3.levels;if(!levels){throw new Error('init load aborted, missing levels');}var details=levels[frag.level].details;console.assert(details,'Level details are defined when init segment is loaded');var stats=frag.stats;_this3.state=State.IDLE;_this3.fragLoadError=0;frag.data=new Uint8Array(data.payload);stats.parsing.start=stats.buffering.start=self.performance.now();stats.parsing.end=stats.buffering.end=self.performance.now();// Silence FRAG_BUFFERED event if fragCurrent is null
if(data.frag===fragCurrent){hls.trigger(_events__WEBPACK_IMPORTED_MODULE_5__["Events"].FRAG_BUFFERED,{stats:stats,frag:fragCurrent,part:null,id:frag.type});}_this3.tick();}).catch(function(reason){_this3.warn(reason);_this3.resetFragmentLoading(frag);});};_proto.fragContextChanged=function fragContextChanged(frag){var fragCurrent=this.fragCurrent;return!frag||!fragCurrent||frag.level!==fragCurrent.level||frag.sn!==fragCurrent.sn||frag.urlId!==fragCurrent.urlId;};_proto.fragBufferedComplete=function fragBufferedComplete(frag,part){var media=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+frag.type+" sn: "+frag.sn+(part?' part: '+part.index:'')+" of "+(this.logPrefix==='[stream-controller]'?'level':'track')+" "+frag.level+" "+_utils_time_ranges__WEBPACK_IMPORTED_MODULE_14__["default"].toString(_utils_buffer_helper__WEBPACK_IMPORTED_MODULE_3__["BufferHelper"].getBuffered(media)));this.state=State.IDLE;this.tick();};_proto._handleFragmentLoadComplete=function _handleFragmentLoadComplete(fragLoadedEndData){var transmuxer=this.transmuxer;if(!transmuxer){return;}var frag=fragLoadedEndData.frag,part=fragLoadedEndData.part,partsLoaded=fragLoadedEndData.partsLoaded;// If we did not load parts, or loaded all parts, we have complete (not partial) fragment data
var complete=!partsLoaded||partsLoaded.length===0||partsLoaded.some(function(fragLoaded){return!fragLoaded;});var chunkMeta=new _types_transmuxer__WEBPACK_IMPORTED_MODULE_7__["ChunkMetadata"](frag.level,frag.sn,frag.stats.chunkCount+1,0,part?part.index:-1,!complete);transmuxer.flush(chunkMeta);}// eslint-disable-next-line @typescript-eslint/no-unused-vars
;_proto._handleFragmentLoadProgress=function _handleFragmentLoadProgress(frag){};_proto._doFragLoad=function _doFragLoad(frag,details,targetBufferTime,progressCallback){var _this4=this;if(targetBufferTime===void 0){targetBufferTime=null;}if(!this.levels){throw new Error('frag load aborted, missing levels');}targetBufferTime=Math.max(frag.start,targetBufferTime||0);if(this.config.lowLatencyMode&&details){var partList=details.partList;if(partList&&progressCallback){if(targetBufferTime>frag.end&&details.fragmentHint){frag=details.fragmentHint;}var partIndex=this.getNextPart(partList,frag,targetBufferTime);if(partIndex>-1){var part=partList[partIndex];this.log("Loading part sn: "+frag.sn+" p: "+part.index+" cc: "+frag.cc+" of playlist ["+details.startSN+"-"+details.endSN+"] parts [0-"+partIndex+"-"+(partList.length-1)+"] "+(this.logPrefix==='[stream-controller]'?'level':'track')+": "+frag.level+", target: "+parseFloat(targetBufferTime.toFixed(3)));this.nextLoadPosition=part.start+part.duration;this.state=State.FRAG_LOADING;this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_5__["Events"].FRAG_LOADING,{frag:frag,part:partList[partIndex],targetBufferTime:targetBufferTime});return this.doFragPartsLoad(frag,partList,partIndex,progressCallback).catch(function(error){return _this4.handleFragLoadError(error);});}else if(!frag.url||this.loadedEndOfParts(partList,targetBufferTime)){// Fragment hint has no parts
return Promise.resolve(null);}}}this.log("Loading fragment "+frag.sn+" cc: "+frag.cc+" "+(details?'of ['+details.startSN+'-'+details.endSN+'] ':'')+(this.logPrefix==='[stream-controller]'?'level':'track')+": "+frag.level+", target: "+parseFloat(targetBufferTime.toFixed(3)));// Don't update nextLoadPosition for fragments which are not buffered
if(Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(frag.sn)&&!this.bitrateTest){this.nextLoadPosition=frag.start+frag.duration;}this.state=State.FRAG_LOADING;this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_5__["Events"].FRAG_LOADING,{frag:frag,targetBufferTime:targetBufferTime});return this.fragmentLoader.load(frag,progressCallback).catch(function(error){return _this4.handleFragLoadError(error);});};_proto.doFragPartsLoad=function doFragPartsLoad(frag,partList,partIndex,progressCallback){var _this5=this;return new Promise(function(resolve,reject){var partsLoaded=[];var loadPartIndex=function loadPartIndex(index){var part=partList[index];_this5.fragmentLoader.loadPart(frag,part,progressCallback).then(function(partLoadedData){partsLoaded[part.index]=partLoadedData;var loadedPart=partLoadedData.part;_this5.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_5__["Events"].FRAG_LOADED,partLoadedData);var nextPart=partList[index+1];if(nextPart&&nextPart.fragment===frag){loadPartIndex(index+1);}else{return resolve({frag:frag,part:loadedPart,partsLoaded:partsLoaded});}}).catch(reject);};loadPartIndex(partIndex);});};_proto.handleFragLoadError=function handleFragLoadError(_ref){var data=_ref.data;if(data&&data.details===_errors__WEBPACK_IMPORTED_MODULE_6__["ErrorDetails"].INTERNAL_ABORTED){this.handleFragLoadAborted(data.frag,data.part);}else{this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_5__["Events"].ERROR,data);}return null;};_proto._handleTransmuxerFlush=function _handleTransmuxerFlush(chunkMeta){var context=this.getCurrentContext(chunkMeta);if(!context||this.state!==State.PARSING){if(!this.fragCurrent){this.state=State.IDLE;}return;}var frag=context.frag,part=context.part,level=context.level;var now=self.performance.now();frag.stats.parsing.end=now;if(part){part.stats.parsing.end=now;}this.updateLevelTiming(frag,part,level,chunkMeta.partial);};_proto.getCurrentContext=function getCurrentContext(chunkMeta){var levels=this.levels;var levelIndex=chunkMeta.level,sn=chunkMeta.sn,partIndex=chunkMeta.part;if(!levels||!levels[levelIndex]){this.warn("Levels object was unset while buffering fragment "+sn+" of level "+levelIndex+". The current chunk will not be buffered.");return null;}var level=levels[levelIndex];var part=partIndex>-1?Object(_level_helper__WEBPACK_IMPORTED_MODULE_11__["getPartWith"])(level,sn,partIndex):null;var frag=part?part.fragment:Object(_level_helper__WEBPACK_IMPORTED_MODULE_11__["getFragmentWithSN"])(level,sn,this.fragCurrent);if(!frag){return null;}return{frag:frag,part:part,level:level};};_proto.bufferFragmentData=function bufferFragmentData(data,frag,part,chunkMeta){if(!data||this.state!==State.PARSING){return;}var data1=data.data1,data2=data.data2;var buffer=data1;if(data1&&data2){// Combine the moof + mdat so that we buffer with a single append
buffer=Object(_utils_mp4_tools__WEBPACK_IMPORTED_MODULE_8__["appendUint8Array"])(data1,data2);}if(!buffer||!buffer.length){return;}var segment={type:data.type,frag:frag,part:part,chunkMeta:chunkMeta,parent:frag.type,data:buffer};this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_5__["Events"].BUFFER_APPENDING,segment);if(data.dropped&&data.independent&&!part){// Clear buffer so that we reload previous segments sequentially if required
this.flushBufferGap(frag);}};_proto.flushBufferGap=function flushBufferGap(frag){var media=this.media;if(!media){return;}// If currentTime is not buffered, clear the back buffer so that we can backtrack as much as needed
if(!_utils_buffer_helper__WEBPACK_IMPORTED_MODULE_3__["BufferHelper"].isBuffered(media,media.currentTime)){this.flushMainBuffer(0,frag.start);return;}// Remove back-buffer without interrupting playback to allow back tracking
var currentTime=media.currentTime;var bufferInfo=_utils_buffer_helper__WEBPACK_IMPORTED_MODULE_3__["BufferHelper"].bufferInfo(media,currentTime,0);var fragDuration=frag.duration;var segmentFraction=Math.min(this.config.maxFragLookUpTolerance*2,fragDuration*0.25);var start=Math.max(Math.min(frag.start-segmentFraction,bufferInfo.end-segmentFraction),currentTime+segmentFraction);if(frag.start-start>segmentFraction){this.flushMainBuffer(start,frag.start);}};_proto.getFwdBufferInfo=function getFwdBufferInfo(bufferable,type){var config=this.config;var pos=this.getLoadPosition();if(!Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(pos)){return null;}var bufferInfo=_utils_buffer_helper__WEBPACK_IMPORTED_MODULE_3__["BufferHelper"].bufferInfo(bufferable,pos,config.maxBufferHole);// Workaround flaw in getting forward buffer when maxBufferHole is smaller than gap at current pos
if(bufferInfo.len===0&&bufferInfo.nextStart!==undefined){var bufferedFragAtPos=this.fragmentTracker.getBufferedFrag(pos,type);if(bufferedFragAtPos&&bufferInfo.nextStart<bufferedFragAtPos.end){return _utils_buffer_helper__WEBPACK_IMPORTED_MODULE_3__["BufferHelper"].bufferInfo(bufferable,pos,Math.max(bufferInfo.nextStart,config.maxBufferHole));}}return bufferInfo;};_proto.getMaxBufferLength=function getMaxBufferLength(levelBitrate){var config=this.config;var maxBufLen;if(levelBitrate){maxBufLen=Math.max(8*config.maxBufferSize/levelBitrate,config.maxBufferLength);}else{maxBufLen=config.maxBufferLength;}return Math.min(maxBufLen,config.maxMaxBufferLength);};_proto.reduceMaxBufferLength=function reduceMaxBufferLength(threshold){var config=this.config;var minLength=threshold||config.maxBufferLength;if(config.maxMaxBufferLength>=minLength){// reduce max buffer length as it might be too high. we do this to avoid loop flushing ...
config.maxMaxBufferLength/=2;this.warn("Reduce max buffer length to "+config.maxMaxBufferLength+"s");return true;}return false;};_proto.getNextFragment=function getNextFragment(pos,levelDetails){var _frag,_frag2;var fragments=levelDetails.fragments;var fragLen=fragments.length;if(!fragLen){return null;}// find fragment index, contiguous with end of buffer position
var config=this.config;var start=fragments[0].start;var frag;if(levelDetails.live){var initialLiveManifestSize=config.initialLiveManifestSize;if(fragLen<initialLiveManifestSize){this.warn("Not enough fragments to start playback (have: "+fragLen+", need: "+initialLiveManifestSize+")");return null;}// The real fragment start times for a live stream are only known after the PTS range for that level is known.
// In order to discover the range, we load the best matching fragment for that level and demux it.
// Do not load using live logic if the starting frag is requested - we want to use getFragmentAtPosition() so that
// we get the fragment matching that start time
if(!levelDetails.PTSKnown&&!this.startFragRequested&&this.startPosition===-1){frag=this.getInitialLiveFragment(levelDetails,fragments);this.startPosition=frag?this.hls.liveSyncPosition||frag.start:pos;}}else if(pos<=start){// VoD playlist: if loadPosition before start of playlist, load first fragment
frag=fragments[0];}// If we haven't run into any special cases already, just load the fragment most closely matching the requested position
if(!frag){var end=config.lowLatencyMode?levelDetails.partEnd:levelDetails.fragmentEnd;frag=this.getFragmentAtPosition(pos,end,levelDetails);}// If an initSegment is present, it must be buffered first
if((_frag=frag)!==null&&_frag!==void 0&&_frag.initSegment&&!((_frag2=frag)!==null&&_frag2!==void 0&&_frag2.initSegment.data)&&!this.bitrateTest){frag=frag.initSegment;}return frag;};_proto.getNextPart=function getNextPart(partList,frag,targetBufferTime){var nextPart=-1;var contiguous=false;var independentAttrOmitted=true;for(var i=0,len=partList.length;i<len;i++){var part=partList[i];independentAttrOmitted=independentAttrOmitted&&!part.independent;if(nextPart>-1&&targetBufferTime<part.start){break;}var loaded=part.loaded;if(!loaded&&(contiguous||part.independent||independentAttrOmitted)&&part.fragment===frag){nextPart=i;}contiguous=loaded;}return nextPart;};_proto.loadedEndOfParts=function loadedEndOfParts(partList,targetBufferTime){var lastPart=partList[partList.length-1];return lastPart&&targetBufferTime>lastPart.start&&lastPart.loaded;}/*
			   This method is used find the best matching first fragment for a live playlist. This fragment is used to calculate the
			   "sliding" of the playlist, which is its offset from the start of playback. After sliding we can compute the real
			   start and end times for each fragment in the playlist (after which this method will not need to be called).
			  */;_proto.getInitialLiveFragment=function getInitialLiveFragment(levelDetails,fragments){var fragPrevious=this.fragPrevious;var frag=null;if(fragPrevious){if(levelDetails.hasProgramDateTime){// Prefer using PDT, because it can be accurate enough to choose the correct fragment without knowing the level sliding
this.log("Live playlist, switching playlist, load frag with same PDT: "+fragPrevious.programDateTime);frag=Object(_fragment_finders__WEBPACK_IMPORTED_MODULE_10__["findFragmentByPDT"])(fragments,fragPrevious.endProgramDateTime,this.config.maxFragLookUpTolerance);}if(!frag){// SN does not need to be accurate between renditions, but depending on the packaging it may be so.
var targetSN=fragPrevious.sn+1;if(targetSN>=levelDetails.startSN&&targetSN<=levelDetails.endSN){var fragNext=fragments[targetSN-levelDetails.startSN];// Ensure that we're staying within the continuity range, since PTS resets upon a new range
if(fragPrevious.cc===fragNext.cc){frag=fragNext;this.log("Live playlist, switching playlist, load frag with next SN: "+frag.sn);}}// It's important to stay within the continuity range if available; otherwise the fragments in the playlist
// will have the wrong start times
if(!frag){frag=Object(_fragment_finders__WEBPACK_IMPORTED_MODULE_10__["findFragWithCC"])(fragments,fragPrevious.cc);if(frag){this.log("Live playlist, switching playlist, load frag with same CC: "+frag.sn);}}}}else{// Find a new start fragment when fragPrevious is null
var liveStart=this.hls.liveSyncPosition;if(liveStart!==null){frag=this.getFragmentAtPosition(liveStart,this.bitrateTest?levelDetails.fragmentEnd:levelDetails.edge,levelDetails);}}return frag;}/*
			  This method finds the best matching fragment given the provided position.
			   */;_proto.getFragmentAtPosition=function getFragmentAtPosition(bufferEnd,end,levelDetails){var config=this.config,fragPrevious=this.fragPrevious;var fragments=levelDetails.fragments,endSN=levelDetails.endSN;var fragmentHint=levelDetails.fragmentHint;var tolerance=config.maxFragLookUpTolerance;var loadingParts=!!(config.lowLatencyMode&&levelDetails.partList&&fragmentHint);if(loadingParts&&fragmentHint&&!this.bitrateTest){// Include incomplete fragment with parts at end
fragments=fragments.concat(fragmentHint);endSN=fragmentHint.sn;}var frag;if(bufferEnd<end){var lookupTolerance=bufferEnd>end-tolerance?0:tolerance;// Remove the tolerance if it would put the bufferEnd past the actual end of stream
// Uses buffer and sequence number to calculate switch segment (required if using EXT-X-DISCONTINUITY-SEQUENCE)
frag=Object(_fragment_finders__WEBPACK_IMPORTED_MODULE_10__["findFragmentByPTS"])(fragPrevious,fragments,bufferEnd,lookupTolerance);}else{// reach end of playlist
frag=fragments[fragments.length-1];}if(frag){var curSNIdx=frag.sn-levelDetails.startSN;var sameLevel=fragPrevious&&frag.level===fragPrevious.level;var nextFrag=fragments[curSNIdx+1];var fragState=this.fragmentTracker.getState(frag);if(fragState===_fragment_tracker__WEBPACK_IMPORTED_MODULE_2__["FragmentState"].BACKTRACKED){frag=null;var i=curSNIdx;while(fragments[i]&&this.fragmentTracker.getState(fragments[i])===_fragment_tracker__WEBPACK_IMPORTED_MODULE_2__["FragmentState"].BACKTRACKED){// When fragPrevious is null, backtrack to first the first fragment is not BACKTRACKED for loading
// When fragPrevious is set, we want the first BACKTRACKED fragment for parsing and buffering
if(!fragPrevious){frag=fragments[--i];}else{frag=fragments[i--];}}if(!frag){frag=nextFrag;}}else if(fragPrevious&&frag.sn===fragPrevious.sn&&!loadingParts){// Force the next fragment to load if the previous one was already selected. This can occasionally happen with
// non-uniform fragment durations
if(sameLevel){if(frag.sn<endSN&&this.fragmentTracker.getState(nextFrag)!==_fragment_tracker__WEBPACK_IMPORTED_MODULE_2__["FragmentState"].OK){this.log("SN "+frag.sn+" just loaded, load next one: "+nextFrag.sn);frag=nextFrag;}else{frag=null;}}}}return frag;};_proto.synchronizeToLiveEdge=function synchronizeToLiveEdge(levelDetails){var config=this.config,media=this.media;if(!media){return;}var liveSyncPosition=this.hls.liveSyncPosition;var currentTime=media.currentTime;var start=levelDetails.fragments[0].start;var end=levelDetails.edge;var withinSlidingWindow=currentTime>=start-config.maxFragLookUpTolerance&&currentTime<=end;// Continue if we can seek forward to sync position or if current time is outside of sliding window
if(liveSyncPosition!==null&&media.duration>liveSyncPosition&&(currentTime<liveSyncPosition||!withinSlidingWindow)){// Continue if buffer is starving or if current time is behind max latency
var maxLatency=config.liveMaxLatencyDuration!==undefined?config.liveMaxLatencyDuration:config.liveMaxLatencyDurationCount*levelDetails.targetduration;if(!withinSlidingWindow&&media.readyState<4||currentTime<end-maxLatency){if(!this.loadedmetadata){this.nextLoadPosition=liveSyncPosition;}// Only seek if ready and there is not a significant forward buffer available for playback
if(media.readyState){this.warn("Playback: "+currentTime.toFixed(3)+" is located too far from the end of live sliding playlist: "+end+", reset currentTime to : "+liveSyncPosition.toFixed(3));media.currentTime=liveSyncPosition;}}}};_proto.alignPlaylists=function alignPlaylists(details,previousDetails){var levels=this.levels,levelLastLoaded=this.levelLastLoaded,fragPrevious=this.fragPrevious;var lastLevel=levelLastLoaded!==null?levels[levelLastLoaded]:null;// FIXME: If not for `shouldAlignOnDiscontinuities` requiring fragPrevious.cc,
//  this could all go in level-helper mergeDetails()
var length=details.fragments.length;if(!length){this.warn("No fragments in live playlist");return 0;}var slidingStart=details.fragments[0].start;var firstLevelLoad=!previousDetails;var aligned=details.alignedSliding&&Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(slidingStart);if(firstLevelLoad||!aligned&&!slidingStart){Object(_utils_discontinuities__WEBPACK_IMPORTED_MODULE_9__["alignStream"])(fragPrevious,lastLevel,details);var alignedSlidingStart=details.fragments[0].start;this.log("Live playlist sliding: "+alignedSlidingStart.toFixed(2)+" start-sn: "+(previousDetails?previousDetails.startSN:'na')+"->"+details.startSN+" prev-sn: "+(fragPrevious?fragPrevious.sn:'na')+" fragments: "+length);return alignedSlidingStart;}return slidingStart;};_proto.waitForCdnTuneIn=function waitForCdnTuneIn(details){// Wait for Low-Latency CDN Tune-in to get an updated playlist
var advancePartLimit=3;return details.live&&details.canBlockReload&&details.tuneInGoal>Math.max(details.partHoldBack,details.partTarget*advancePartLimit);};_proto.setStartPosition=function setStartPosition(details,sliding){// compute start position if set to -1. use it straight away if value is defined
var startPosition=this.startPosition;if(startPosition<sliding){startPosition=-1;}if(startPosition===-1||this.lastCurrentTime===-1){// first, check if start time offset has been set in playlist, if yes, use this value
var startTimeOffset=details.startTimeOffset;if(Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(startTimeOffset)){startPosition=sliding+startTimeOffset;if(startTimeOffset<0){startPosition+=details.totalduration;}startPosition=Math.min(Math.max(sliding,startPosition),sliding+details.totalduration);this.log("Start time offset "+startTimeOffset+" found in playlist, adjust startPosition to "+startPosition);this.startPosition=startPosition;}else if(details.live){// Leave this.startPosition at -1, so that we can use `getInitialLiveFragment` logic when startPosition has
// not been specified via the config or an as an argument to startLoad (#3736).
startPosition=this.hls.liveSyncPosition||sliding;}else{this.startPosition=startPosition=0;}this.lastCurrentTime=startPosition;}this.nextLoadPosition=startPosition;};_proto.getLoadPosition=function getLoadPosition(){var media=this.media;// if we have not yet loaded any fragment, start loading from start position
var pos=0;if(this.loadedmetadata&&media){pos=media.currentTime;}else if(this.nextLoadPosition){pos=this.nextLoadPosition;}return pos;};_proto.handleFragLoadAborted=function handleFragLoadAborted(frag,part){if(this.transmuxer&&frag.sn!=='initSegment'&&frag.stats.aborted){this.warn("Fragment "+frag.sn+(part?' part'+part.index:'')+" of level "+frag.level+" was aborted");this.resetFragmentLoading(frag);}};_proto.resetFragmentLoading=function resetFragmentLoading(frag){if(!this.fragCurrent||!this.fragContextChanged(frag)){this.state=State.IDLE;}};_proto.onFragmentOrKeyLoadError=function onFragmentOrKeyLoadError(filterType,data){if(data.fatal){return;}var frag=data.frag;// Handle frag error related to caller's filterType
if(!frag||frag.type!==filterType){return;}var fragCurrent=this.fragCurrent;console.assert(fragCurrent&&frag.sn===fragCurrent.sn&&frag.level===fragCurrent.level&&frag.urlId===fragCurrent.urlId,'Frag load error must match current frag to retry');var config=this.config;// keep retrying until the limit will be reached
if(this.fragLoadError+1<=config.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(frag.level)){return;}// exponential backoff capped to config.fragLoadingMaxRetryTimeout
var delay=Math.min(Math.pow(2,this.fragLoadError)*config.fragLoadingRetryDelay,config.fragLoadingMaxRetryTimeout);this.warn("Fragment "+frag.sn+" of "+filterType+" "+frag.level+" failed to load, retrying in "+delay+"ms");this.retryDate=self.performance.now()+delay;this.fragLoadError++;this.state=State.FRAG_LOADING_WAITING_RETRY;}else if(data.levelRetry){if(filterType===_types_loader__WEBPACK_IMPORTED_MODULE_15__["PlaylistLevelType"].AUDIO){// Reset current fragment since audio track audio is essential and may not have a fail-over track
this.fragCurrent=null;}// Fragment errors that result in a level switch or redundant fail-over
// should reset the stream controller state to idle
this.fragLoadError=0;this.state=State.IDLE;}else{_utils_logger__WEBPACK_IMPORTED_MODULE_4__["logger"].error(data.details+" reaches max retry, redispatch as fatal ...");// switch error to fatal
data.fatal=true;this.hls.stopLoad();this.state=State.ERROR;}};_proto.afterBufferFlushed=function afterBufferFlushed(media,bufferType,playlistType){if(!media){return;}// After successful buffer flushing, filter flushed fragments from bufferedFrags use mediaBuffered instead of media
// (so that we will check against video.buffered ranges in case of alt audio track)
var bufferedTimeRanges=_utils_buffer_helper__WEBPACK_IMPORTED_MODULE_3__["BufferHelper"].getBuffered(media);this.fragmentTracker.detectEvictedFragments(bufferType,bufferedTimeRanges,playlistType);if(this.state===State.ENDED){this.resetLoadingState();}};_proto.resetLoadingState=function resetLoadingState(){this.fragCurrent=null;this.fragPrevious=null;this.state=State.IDLE;};_proto.resetLiveStartWhenNotLoaded=function resetLiveStartWhenNotLoaded(level){// if loadedmetadata is not set, it means that we are emergency switch down on first frag
// in that case, reset startFragRequested flag
if(!this.loadedmetadata){this.startFragRequested=false;var details=this.levels?this.levels[level].details:null;if(details!==null&&details!==void 0&&details.live){// We can't afford to retry after a delay in a live scenario. Update the start position and return to IDLE.
this.startPosition=-1;this.setStartPosition(details,0);this.resetLoadingState();return true;}this.nextLoadPosition=this.startPosition;}return false;};_proto.updateLevelTiming=function updateLevelTiming(frag,part,level,partial){var _this6=this;var details=level.details;console.assert(!!details,'level.details must be defined');var parsed=Object.keys(frag.elementaryStreams).reduce(function(result,type){var info=frag.elementaryStreams[type];if(info){var parsedDuration=info.endPTS-info.startPTS;if(parsedDuration<=0){// Destroy the transmuxer after it's next time offset failed to advance because duration was <= 0.
// The new transmuxer will be configured with a time offset matching the next fragment start,
// preventing the timeline from shifting.
_this6.warn("Could not parse fragment "+frag.sn+" "+type+" duration reliably ("+parsedDuration+") resetting transmuxer to fallback to playlist timing");_this6.resetTransmuxer();return result||false;}var drift=partial?0:Object(_level_helper__WEBPACK_IMPORTED_MODULE_11__["updateFragPTSDTS"])(details,frag,info.startPTS,info.endPTS,info.startDTS,info.endDTS);_this6.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_5__["Events"].LEVEL_PTS_UPDATED,{details:details,level:level,drift:drift,type:type,frag:frag,start:info.startPTS,end:info.endPTS});return true;}return result;},false);if(parsed){this.state=State.PARSED;this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_5__["Events"].FRAG_PARSED,{frag:frag,part:part});}else{this.resetLoadingState();}};_proto.resetTransmuxer=function resetTransmuxer(){if(this.transmuxer){this.transmuxer.destroy();this.transmuxer=null;}};_createClass(BaseStreamController,[{key:"state",get:function get(){return this._state;},set:function set(nextState){var previousState=this._state;if(previousState!==nextState){this._state=nextState;this.log(previousState+"->"+nextState);}}}]);return BaseStreamController;}(_task_loop__WEBPACK_IMPORTED_MODULE_1__["default"]);/***/},/***/"./src/controller/buffer-controller.ts":/*!*********************************************!*\
			  !*** ./src/controller/buffer-controller.ts ***!
			  \*********************************************/ /*! exports provided: default */ /***/function srcControllerBufferControllerTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"default",function(){return BufferController;});/* harmony import */var _home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./src/polyfills/number */"./src/polyfills/number.ts");/* harmony import */var _events__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../events */"./src/events.ts");/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../utils/logger */"./src/utils/logger.ts");/* harmony import */var _errors__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ../errors */"./src/errors.ts");/* harmony import */var _utils_buffer_helper__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts");/* harmony import */var _utils_mediasource_helper__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(/*! ../utils/mediasource-helper */"./src/utils/mediasource-helper.ts");/* harmony import */var _loader_fragment__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(/*! ../loader/fragment */"./src/loader/fragment.ts");/* harmony import */var _buffer_operation_queue__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(/*! ./buffer-operation-queue */"./src/controller/buffer-operation-queue.ts");var MediaSource=Object(_utils_mediasource_helper__WEBPACK_IMPORTED_MODULE_5__["getMediaSource"])();var VIDEO_CODEC_PROFILE_REPACE=/([ha]vc.)(?:\.[^.,]+)+/;var BufferController=/*#__PURE__*/function(){// The level details used to determine duration, target-duration and live
// cache the self generated object url to detect hijack of video tag
// A queue of buffer operations which require the SourceBuffer to not be updating upon execution
// References to event listeners for each SourceBuffer, so that they can be referenced for event removal
// The number of BUFFER_CODEC events received before any sourceBuffers are created
// The total number of BUFFER_CODEC events received
// A reference to the attached media element
// A reference to the active media source
// counters
function BufferController(_hls){var _this=this;this.details=null;this._objectUrl=null;this.operationQueue=void 0;this.listeners=void 0;this.hls=void 0;this.bufferCodecEventsExpected=0;this._bufferCodecEventsTotal=0;this.media=null;this.mediaSource=null;this.appendError=0;this.tracks={};this.pendingTracks={};this.sourceBuffer=void 0;this._onMediaSourceOpen=function(){var hls=_this.hls,media=_this.media,mediaSource=_this.mediaSource;_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].log('[buffer-controller]: Media source opened');if(media){_this.updateMediaElementDuration();hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].MEDIA_ATTACHED,{media:media});}if(mediaSource){// once received, don't listen anymore to sourceopen event
mediaSource.removeEventListener('sourceopen',_this._onMediaSourceOpen);}_this.checkPendingTracks();};this._onMediaSourceClose=function(){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].log('[buffer-controller]: Media source closed');};this._onMediaSourceEnded=function(){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].log('[buffer-controller]: Media source ended');};this.hls=_hls;this._initSourceBuffer();this.registerListeners();}var _proto=BufferController.prototype;_proto.hasSourceTypes=function hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0;};_proto.destroy=function destroy(){this.unregisterListeners();this.details=null;};_proto.registerListeners=function registerListeners(){var hls=this.hls;hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].MEDIA_ATTACHING,this.onMediaAttaching,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].MANIFEST_PARSED,this.onManifestParsed,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].BUFFER_RESET,this.onBufferReset,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].BUFFER_APPENDING,this.onBufferAppending,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].BUFFER_CODECS,this.onBufferCodecs,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].BUFFER_EOS,this.onBufferEos,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].BUFFER_FLUSHING,this.onBufferFlushing,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].LEVEL_UPDATED,this.onLevelUpdated,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].FRAG_PARSED,this.onFragParsed,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].FRAG_CHANGED,this.onFragChanged,this);};_proto.unregisterListeners=function unregisterListeners(){var hls=this.hls;hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].MEDIA_ATTACHING,this.onMediaAttaching,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].MANIFEST_PARSED,this.onManifestParsed,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].BUFFER_RESET,this.onBufferReset,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].BUFFER_APPENDING,this.onBufferAppending,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].BUFFER_CODECS,this.onBufferCodecs,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].BUFFER_EOS,this.onBufferEos,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].BUFFER_FLUSHING,this.onBufferFlushing,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].LEVEL_UPDATED,this.onLevelUpdated,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].FRAG_PARSED,this.onFragParsed,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].FRAG_CHANGED,this.onFragChanged,this);};_proto._initSourceBuffer=function _initSourceBuffer(){this.sourceBuffer={};this.operationQueue=new _buffer_operation_queue__WEBPACK_IMPORTED_MODULE_7__["default"](this.sourceBuffer);this.listeners={audio:[],video:[],audiovideo:[]};};_proto.onManifestParsed=function onManifestParsed(event,data){// in case of alt audio 2 BUFFER_CODECS events will be triggered, one per stream controller
// sourcebuffers will be created all at once when the expected nb of tracks will be reached
// in case alt audio is not used, only one BUFFER_CODEC event will be fired from main stream controller
// it will contain the expected nb of source buffers, no need to compute it
var codecEvents=2;if(data.audio&&!data.video||!data.altAudio){codecEvents=1;}this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=codecEvents;this.details=null;_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected");};_proto.onMediaAttaching=function onMediaAttaching(event,data){var media=this.media=data.media;if(media&&MediaSource){var ms=this.mediaSource=new MediaSource();// MediaSource listeners are arrow functions with a lexical scope, and do not need to be bound
ms.addEventListener('sourceopen',this._onMediaSourceOpen);ms.addEventListener('sourceended',this._onMediaSourceEnded);ms.addEventListener('sourceclose',this._onMediaSourceClose);// link video and media Source
media.src=self.URL.createObjectURL(ms);// cache the locally generated object url
this._objectUrl=media.src;}};_proto.onMediaDetaching=function onMediaDetaching(){var media=this.media,mediaSource=this.mediaSource,_objectUrl=this._objectUrl;if(mediaSource){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].log('[buffer-controller]: media source detaching');if(mediaSource.readyState==='open'){try{// endOfStream could trigger exception if any sourcebuffer is in updating state
// we don't really care about checking sourcebuffer state here,
// as we are anyway detaching the MediaSource
// let's just avoid this exception to propagate
mediaSource.endOfStream();}catch(err){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].warn("[buffer-controller]: onMediaDetaching: "+err.message+" while calling endOfStream");}}// Clean up the SourceBuffers by invoking onBufferReset
this.onBufferReset();mediaSource.removeEventListener('sourceopen',this._onMediaSourceOpen);mediaSource.removeEventListener('sourceended',this._onMediaSourceEnded);mediaSource.removeEventListener('sourceclose',this._onMediaSourceClose);// Detach properly the MediaSource from the HTMLMediaElement as
// suggested in https://github.com/w3c/media-source/issues/53.
if(media){if(_objectUrl){self.URL.revokeObjectURL(_objectUrl);}// clean up video tag src only if it's our own url. some external libraries might
// hijack the video tag and change its 'src' without destroying the Hls instance first
if(media.src===_objectUrl){media.removeAttribute('src');media.load();}else{_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].warn('[buffer-controller]: media.src was changed by a third party - skip cleanup');}}this.mediaSource=null;this.media=null;this._objectUrl=null;this.bufferCodecEventsExpected=this._bufferCodecEventsTotal;this.pendingTracks={};this.tracks={};}this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].MEDIA_DETACHED,undefined);};_proto.onBufferReset=function onBufferReset(){var _this2=this;this.getSourceBufferTypes().forEach(function(type){var sb=_this2.sourceBuffer[type];try{if(sb){_this2.removeBufferListeners(type);if(_this2.mediaSource){_this2.mediaSource.removeSourceBuffer(sb);}// Synchronously remove the SB from the map before the next call in order to prevent an async function from
// accessing it
_this2.sourceBuffer[type]=undefined;}}catch(err){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].warn("[buffer-controller]: Failed to reset the "+type+" buffer",err);}});this._initSourceBuffer();};_proto.onBufferCodecs=function onBufferCodecs(event,data){var _this3=this;var sourceBufferCount=this.getSourceBufferTypes().length;Object.keys(data).forEach(function(trackName){if(sourceBufferCount){// check if SourceBuffer codec needs to change
var track=_this3.tracks[trackName];if(track&&typeof track.buffer.changeType==='function'){var _data$trackName=data[trackName],codec=_data$trackName.codec,levelCodec=_data$trackName.levelCodec,container=_data$trackName.container;var currentCodec=(track.levelCodec||track.codec).replace(VIDEO_CODEC_PROFILE_REPACE,'$1');var nextCodec=(levelCodec||codec).replace(VIDEO_CODEC_PROFILE_REPACE,'$1');if(currentCodec!==nextCodec){var mimeType=container+";codecs="+(levelCodec||codec);_this3.appendChangeType(trackName,mimeType);}}}else{// if source buffer(s) not created yet, appended buffer tracks in this.pendingTracks
_this3.pendingTracks[trackName]=data[trackName];}});// if sourcebuffers already created, do nothing ...
if(sourceBufferCount){return;}this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0);if(this.mediaSource&&this.mediaSource.readyState==='open'){this.checkPendingTracks();}};_proto.appendChangeType=function appendChangeType(type,mimeType){var _this4=this;var operationQueue=this.operationQueue;var operation={execute:function execute(){var sb=_this4.sourceBuffer[type];if(sb){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].log("[buffer-controller]: changing "+type+" sourceBuffer type to "+mimeType);sb.changeType(mimeType);}operationQueue.shiftAndExecuteNext(type);},onStart:function onStart(){},onComplete:function onComplete(){},onError:function onError(e){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].warn("[buffer-controller]: Failed to change "+type+" SourceBuffer type",e);}};operationQueue.append(operation,type);};_proto.onBufferAppending=function onBufferAppending(event,eventData){var _this5=this;var hls=this.hls,operationQueue=this.operationQueue,tracks=this.tracks;var data=eventData.data,type=eventData.type,frag=eventData.frag,part=eventData.part,chunkMeta=eventData.chunkMeta;var chunkStats=chunkMeta.buffering[type];var bufferAppendingStart=self.performance.now();chunkStats.start=bufferAppendingStart;var fragBuffering=frag.stats.buffering;var partBuffering=part?part.stats.buffering:null;if(fragBuffering.start===0){fragBuffering.start=bufferAppendingStart;}if(partBuffering&&partBuffering.start===0){partBuffering.start=bufferAppendingStart;}// TODO: Only update timestampOffset when audio/mpeg fragment or part is not contiguous with previously appended
// Adjusting `SourceBuffer.timestampOffset` (desired point in the timeline where the next frames should be appended)
// in Chrome browser when we detect MPEG audio container and time delta between level PTS and `SourceBuffer.timestampOffset`
// is greater than 100ms (this is enough to handle seek for VOD or level change for LIVE videos).
// More info here: https://github.com/video-dev/hls.js/issues/332#issuecomment-257986486
var audioTrack=tracks.audio;var checkTimestampOffset=type==='audio'&&chunkMeta.id===1&&(audioTrack===null||audioTrack===void 0?void 0:audioTrack.container)==='audio/mpeg';var operation={execute:function execute(){chunkStats.executeStart=self.performance.now();if(checkTimestampOffset){var sb=_this5.sourceBuffer[type];if(sb){var delta=frag.start-sb.timestampOffset;if(Math.abs(delta)>=0.1){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+frag.start+" (delta: "+delta+") sn: "+frag.sn+")");sb.timestampOffset=frag.start;}}}_this5.appendExecutor(data,type);},onStart:function onStart(){// logger.debug(`[buffer-controller]: ${type} SourceBuffer updatestart`);
},onComplete:function onComplete(){// logger.debug(`[buffer-controller]: ${type} SourceBuffer updateend`);
var end=self.performance.now();chunkStats.executeEnd=chunkStats.end=end;if(fragBuffering.first===0){fragBuffering.first=end;}if(partBuffering&&partBuffering.first===0){partBuffering.first=end;}var sourceBuffer=_this5.sourceBuffer;var timeRanges={};for(var _type in sourceBuffer){timeRanges[_type]=_utils_buffer_helper__WEBPACK_IMPORTED_MODULE_4__["BufferHelper"].getBuffered(sourceBuffer[_type]);}_this5.appendError=0;_this5.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].BUFFER_APPENDED,{type:type,frag:frag,part:part,chunkMeta:chunkMeta,parent:frag.type,timeRanges:timeRanges});},onError:function onError(err){// in case any error occured while appending, put back segment in segments table
_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].error("[buffer-controller]: Error encountered while trying to append to the "+type+" SourceBuffer",err);var event={type:_errors__WEBPACK_IMPORTED_MODULE_3__["ErrorTypes"].MEDIA_ERROR,parent:frag.type,details:_errors__WEBPACK_IMPORTED_MODULE_3__["ErrorDetails"].BUFFER_APPEND_ERROR,err:err,fatal:false};if(err.code===DOMException.QUOTA_EXCEEDED_ERR){// QuotaExceededError: http://www.w3.org/TR/html5/infrastructure.html#quotaexceedederror
// let's stop appending any segments, and report BUFFER_FULL_ERROR error
event.details=_errors__WEBPACK_IMPORTED_MODULE_3__["ErrorDetails"].BUFFER_FULL_ERROR;}else{_this5.appendError++;event.details=_errors__WEBPACK_IMPORTED_MODULE_3__["ErrorDetails"].BUFFER_APPEND_ERROR;/* with UHD content, we could get loop of quota exceeded error until
			            browser is able to evict some data from sourcebuffer. Retrying can help recover.
			          */if(_this5.appendError>hls.config.appendErrorMaxRetry){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].error("[buffer-controller]: Failed "+hls.config.appendErrorMaxRetry+" times to append segment in sourceBuffer");event.fatal=true;}}hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].ERROR,event);}};operationQueue.append(operation,type);};_proto.onBufferFlushing=function onBufferFlushing(event,data){var _this6=this;var operationQueue=this.operationQueue;var flushOperation=function flushOperation(type){return{execute:_this6.removeExecutor.bind(_this6,type,data.startOffset,data.endOffset),onStart:function onStart(){// logger.debug(`[buffer-controller]: Started flushing ${data.startOffset} -> ${data.endOffset} for ${type} Source Buffer`);
},onComplete:function onComplete(){// logger.debug(`[buffer-controller]: Finished flushing ${data.startOffset} -> ${data.endOffset} for ${type} Source Buffer`);
_this6.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].BUFFER_FLUSHED,{type:type});},onError:function onError(e){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].warn("[buffer-controller]: Failed to remove from "+type+" SourceBuffer",e);}};};if(data.type){operationQueue.append(flushOperation(data.type),data.type);}else{this.getSourceBufferTypes().forEach(function(type){operationQueue.append(flushOperation(type),type);});}};_proto.onFragParsed=function onFragParsed(event,data){var _this7=this;var frag=data.frag,part=data.part;var buffersAppendedTo=[];var elementaryStreams=part?part.elementaryStreams:frag.elementaryStreams;if(elementaryStreams[_loader_fragment__WEBPACK_IMPORTED_MODULE_6__["ElementaryStreamTypes"].AUDIOVIDEO]){buffersAppendedTo.push('audiovideo');}else{if(elementaryStreams[_loader_fragment__WEBPACK_IMPORTED_MODULE_6__["ElementaryStreamTypes"].AUDIO]){buffersAppendedTo.push('audio');}if(elementaryStreams[_loader_fragment__WEBPACK_IMPORTED_MODULE_6__["ElementaryStreamTypes"].VIDEO]){buffersAppendedTo.push('video');}}var onUnblocked=function onUnblocked(){var now=self.performance.now();frag.stats.buffering.end=now;if(part){part.stats.buffering.end=now;}var stats=part?part.stats:frag.stats;_this7.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].FRAG_BUFFERED,{frag:frag,part:part,stats:stats,id:frag.type});};if(buffersAppendedTo.length===0){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].warn("Fragments must have at least one ElementaryStreamType set. type: "+frag.type+" level: "+frag.level+" sn: "+frag.sn);}this.blockBuffers(onUnblocked,buffersAppendedTo);};_proto.onFragChanged=function onFragChanged(event,data){this.flushBackBuffer();}// on BUFFER_EOS mark matching sourcebuffer(s) as ended and trigger checkEos()
// an undefined data.type will mark all buffers as EOS.
;_proto.onBufferEos=function onBufferEos(event,data){var _this8=this;var ended=this.getSourceBufferTypes().reduce(function(acc,type){var sb=_this8.sourceBuffer[type];if(!data.type||data.type===type){if(sb&&!sb.ended){sb.ended=true;_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].log("[buffer-controller]: "+type+" sourceBuffer now EOS");}}return acc&&!!(!sb||sb.ended);},true);if(ended){this.blockBuffers(function(){var mediaSource=_this8.mediaSource;if(!mediaSource||mediaSource.readyState!=='open'){return;}// Allow this to throw and be caught by the enqueueing function
mediaSource.endOfStream();});}};_proto.onLevelUpdated=function onLevelUpdated(event,_ref){var details=_ref.details;if(!details.fragments.length){return;}this.details=details;if(this.getSourceBufferTypes().length){this.blockBuffers(this.updateMediaElementDuration.bind(this));}else{this.updateMediaElementDuration();}};_proto.flushBackBuffer=function flushBackBuffer(){var hls=this.hls,details=this.details,media=this.media,sourceBuffer=this.sourceBuffer;if(!media||details===null){return;}var sourceBufferTypes=this.getSourceBufferTypes();if(!sourceBufferTypes.length){return;}// Support for deprecated liveBackBufferLength
var backBufferLength=details.live&&hls.config.liveBackBufferLength!==null?hls.config.liveBackBufferLength:hls.config.backBufferLength;if(!Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(backBufferLength)||backBufferLength<0){return;}var currentTime=media.currentTime;var targetDuration=details.levelTargetDuration;var maxBackBufferLength=Math.max(backBufferLength,targetDuration);var targetBackBufferPosition=Math.floor(currentTime/targetDuration)*targetDuration-maxBackBufferLength;sourceBufferTypes.forEach(function(type){var sb=sourceBuffer[type];if(sb){var buffered=_utils_buffer_helper__WEBPACK_IMPORTED_MODULE_4__["BufferHelper"].getBuffered(sb);// when target buffer start exceeds actual buffer start
if(buffered.length>0&&targetBackBufferPosition>buffered.start(0)){hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].BACK_BUFFER_REACHED,{bufferEnd:targetBackBufferPosition});// Support for deprecated event:
if(details.live){hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].LIVE_BACK_BUFFER_REACHED,{bufferEnd:targetBackBufferPosition});}hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].BUFFER_FLUSHING,{startOffset:0,endOffset:targetBackBufferPosition,type:type});}}});}/**
			   * Update Media Source duration to current level duration or override to Infinity if configuration parameter
			   * 'liveDurationInfinity` is set to `true`
			   * More details: https://github.com/video-dev/hls.js/issues/355
			   */;_proto.updateMediaElementDuration=function updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=='open'){return;}var details=this.details,hls=this.hls,media=this.media,mediaSource=this.mediaSource;var levelDuration=details.fragments[0].start+details.totalduration;var mediaDuration=media.duration;var msDuration=Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(mediaSource.duration)?mediaSource.duration:0;if(details.live&&hls.config.liveDurationInfinity){// Override duration to Infinity
_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].log('[buffer-controller]: Media Source duration is set to Infinity');mediaSource.duration=Infinity;this.updateSeekableRange(details);}else if(levelDuration>msDuration&&levelDuration>mediaDuration||!Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(mediaDuration)){// levelDuration was the last value we set.
// not using mediaSource.duration as the browser may tweak this value
// only update Media Source duration if its value increase, this is to avoid
// flushing already buffered portion when switching between quality level
_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].log("[buffer-controller]: Updating Media Source duration to "+levelDuration.toFixed(3));mediaSource.duration=levelDuration;}};_proto.updateSeekableRange=function updateSeekableRange(levelDetails){var mediaSource=this.mediaSource;var fragments=levelDetails.fragments;var len=fragments.length;if(len&&levelDetails.live&&mediaSource!==null&&mediaSource!==void 0&&mediaSource.setLiveSeekableRange){var start=Math.max(0,fragments[0].start);var end=Math.max(start,start+levelDetails.totalduration);mediaSource.setLiveSeekableRange(start,end);}};_proto.checkPendingTracks=function checkPendingTracks(){var bufferCodecEventsExpected=this.bufferCodecEventsExpected,operationQueue=this.operationQueue,pendingTracks=this.pendingTracks;// Check if we've received all of the expected bufferCodec events. When none remain, create all the sourceBuffers at once.
// This is important because the MSE spec allows implementations to throw QuotaExceededErrors if creating new sourceBuffers after
// data has been appended to existing ones.
// 2 tracks is the max (one for audio, one for video). If we've reach this max go ahead and create the buffers.
var pendingTracksCount=Object.keys(pendingTracks).length;if(pendingTracksCount&&!bufferCodecEventsExpected||pendingTracksCount===2){// ok, let's create them now !
this.createSourceBuffers(pendingTracks);this.pendingTracks={};// append any pending segments now !
var buffers=this.getSourceBufferTypes();if(buffers.length===0){this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].ERROR,{type:_errors__WEBPACK_IMPORTED_MODULE_3__["ErrorTypes"].MEDIA_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_3__["ErrorDetails"].BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:true,reason:'could not create source buffer for media codec(s)'});return;}buffers.forEach(function(type){operationQueue.executeNext(type);});}};_proto.createSourceBuffers=function createSourceBuffers(tracks){var sourceBuffer=this.sourceBuffer,mediaSource=this.mediaSource;if(!mediaSource){throw Error('createSourceBuffers called when mediaSource was null');}var tracksCreated=0;for(var trackName in tracks){if(!sourceBuffer[trackName]){var track=tracks[trackName];if(!track){throw Error("source buffer exists for track "+trackName+", however track does not");}// use levelCodec as first priority
var codec=track.levelCodec||track.codec;var mimeType=track.container+";codecs="+codec;_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].log("[buffer-controller]: creating sourceBuffer("+mimeType+")");try{var sb=sourceBuffer[trackName]=mediaSource.addSourceBuffer(mimeType);var sbName=trackName;this.addBufferListener(sbName,'updatestart',this._onSBUpdateStart);this.addBufferListener(sbName,'updateend',this._onSBUpdateEnd);this.addBufferListener(sbName,'error',this._onSBUpdateError);this.tracks[trackName]={buffer:sb,codec:codec,container:track.container,levelCodec:track.levelCodec,id:track.id};tracksCreated++;}catch(err){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].error("[buffer-controller]: error while trying to add sourceBuffer: "+err.message);this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].ERROR,{type:_errors__WEBPACK_IMPORTED_MODULE_3__["ErrorTypes"].MEDIA_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_3__["ErrorDetails"].BUFFER_ADD_CODEC_ERROR,fatal:false,error:err,mimeType:mimeType});}}}if(tracksCreated){this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].BUFFER_CREATED,{tracks:this.tracks});}}// Keep as arrow functions so that we can directly reference these functions directly as event listeners
;_proto._onSBUpdateStart=function _onSBUpdateStart(type){var operationQueue=this.operationQueue;var operation=operationQueue.current(type);operation.onStart();};_proto._onSBUpdateEnd=function _onSBUpdateEnd(type){var operationQueue=this.operationQueue;var operation=operationQueue.current(type);operation.onComplete();operationQueue.shiftAndExecuteNext(type);};_proto._onSBUpdateError=function _onSBUpdateError(type,event){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].error("[buffer-controller]: "+type+" SourceBuffer error",event);// according to http://www.w3.org/TR/media-source/#sourcebuffer-append-error
// SourceBuffer errors are not necessarily fatal; if so, the HTMLMediaElement will fire an error event
this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].ERROR,{type:_errors__WEBPACK_IMPORTED_MODULE_3__["ErrorTypes"].MEDIA_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_3__["ErrorDetails"].BUFFER_APPENDING_ERROR,fatal:false});// updateend is always fired after error, so we'll allow that to shift the current operation off of the queue
var operation=this.operationQueue.current(type);if(operation){operation.onError(event);}}// This method must result in an updateend event; if remove is not called, _onSBUpdateEnd must be called manually
;_proto.removeExecutor=function removeExecutor(type,startOffset,endOffset){var media=this.media,mediaSource=this.mediaSource,operationQueue=this.operationQueue,sourceBuffer=this.sourceBuffer;var sb=sourceBuffer[type];if(!media||!mediaSource||!sb){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].warn("[buffer-controller]: Attempting to remove from the "+type+" SourceBuffer, but it does not exist");operationQueue.shiftAndExecuteNext(type);return;}var mediaDuration=Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(media.duration)?media.duration:Infinity;var msDuration=Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(mediaSource.duration)?mediaSource.duration:Infinity;var removeStart=Math.max(0,startOffset);var removeEnd=Math.min(endOffset,mediaDuration,msDuration);if(removeEnd>removeStart){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].log("[buffer-controller]: Removing ["+removeStart+","+removeEnd+"] from the "+type+" SourceBuffer");console.assert(!sb.updating,type+" sourceBuffer must not be updating");sb.remove(removeStart,removeEnd);}else{// Cycle the queue
operationQueue.shiftAndExecuteNext(type);}}// This method must result in an updateend event; if append is not called, _onSBUpdateEnd must be called manually
;_proto.appendExecutor=function appendExecutor(data,type){var operationQueue=this.operationQueue,sourceBuffer=this.sourceBuffer;var sb=sourceBuffer[type];if(!sb){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].warn("[buffer-controller]: Attempting to append to the "+type+" SourceBuffer, but it does not exist");operationQueue.shiftAndExecuteNext(type);return;}sb.ended=false;console.assert(!sb.updating,type+" sourceBuffer must not be updating");sb.appendBuffer(data);}// Enqueues an operation to each SourceBuffer queue which, upon execution, resolves a promise. When all promises
// resolve, the onUnblocked function is executed. Functions calling this method do not need to unblock the queue
// upon completion, since we already do it here
;_proto.blockBuffers=function blockBuffers(onUnblocked,buffers){var _this9=this;if(buffers===void 0){buffers=this.getSourceBufferTypes();}if(!buffers.length){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].log('[buffer-controller]: Blocking operation requested, but no SourceBuffers exist');Promise.resolve(onUnblocked);return;}var operationQueue=this.operationQueue;// logger.debug(`[buffer-controller]: Blocking ${buffers} SourceBuffer`);
var blockingOperations=buffers.map(function(type){return operationQueue.appendBlocker(type);});Promise.all(blockingOperations).then(function(){// logger.debug(`[buffer-controller]: Blocking operation resolved; unblocking ${buffers} SourceBuffer`);
onUnblocked();buffers.forEach(function(type){var sb=_this9.sourceBuffer[type];// Only cycle the queue if the SB is not updating. There's a bug in Chrome which sets the SB updating flag to
// true when changing the MediaSource duration (https://bugs.chromium.org/p/chromium/issues/detail?id=959359&can=2&q=mediasource%20duration)
// While this is a workaround, it's probably useful to have around
if(!sb||!sb.updating){operationQueue.shiftAndExecuteNext(type);}});});};_proto.getSourceBufferTypes=function getSourceBufferTypes(){return Object.keys(this.sourceBuffer);};_proto.addBufferListener=function addBufferListener(type,event,fn){var buffer=this.sourceBuffer[type];if(!buffer){return;}var listener=fn.bind(this,type);this.listeners[type].push({event:event,listener:listener});buffer.addEventListener(event,listener);};_proto.removeBufferListeners=function removeBufferListeners(type){var buffer=this.sourceBuffer[type];if(!buffer){return;}this.listeners[type].forEach(function(l){buffer.removeEventListener(l.event,l.listener);});};return BufferController;}();/***/},/***/"./src/controller/buffer-operation-queue.ts":/*!**************************************************!*\
			  !*** ./src/controller/buffer-operation-queue.ts ***!
			  \**************************************************/ /*! exports provided: default */ /***/function srcControllerBufferOperationQueueTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"default",function(){return BufferOperationQueue;});/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../utils/logger */"./src/utils/logger.ts");var BufferOperationQueue=/*#__PURE__*/function(){function BufferOperationQueue(sourceBufferReference){this.buffers=void 0;this.queues={video:[],audio:[],audiovideo:[]};this.buffers=sourceBufferReference;}var _proto=BufferOperationQueue.prototype;_proto.append=function append(operation,type){var queue=this.queues[type];queue.push(operation);if(queue.length===1&&this.buffers[type]){this.executeNext(type);}};_proto.insertAbort=function insertAbort(operation,type){var queue=this.queues[type];queue.unshift(operation);this.executeNext(type);};_proto.appendBlocker=function appendBlocker(type){var execute;var promise=new Promise(function(resolve){execute=resolve;});var operation={execute:execute,onStart:function onStart(){},onComplete:function onComplete(){},onError:function onError(){}};this.append(operation,type);return promise;};_proto.executeNext=function executeNext(type){var buffers=this.buffers,queues=this.queues;var sb=buffers[type];var queue=queues[type];if(queue.length){var operation=queue[0];try{// Operations are expected to result in an 'updateend' event being fired. If not, the queue will lock. Operations
// which do not end with this event must call _onSBUpdateEnd manually
operation.execute();}catch(e){_utils_logger__WEBPACK_IMPORTED_MODULE_0__["logger"].warn('[buffer-operation-queue]: Unhandled exception executing the current operation');operation.onError(e);// Only shift the current operation off, otherwise the updateend handler will do this for us
if(!sb||!sb.updating){queue.shift();this.executeNext(type);}}}};_proto.shiftAndExecuteNext=function shiftAndExecuteNext(type){this.queues[type].shift();this.executeNext(type);};_proto.current=function current(type){return this.queues[type][0];};return BufferOperationQueue;}();/***/},/***/"./src/controller/cap-level-controller.ts":/*!************************************************!*\
			  !*** ./src/controller/cap-level-controller.ts ***!
			  \************************************************/ /*! exports provided: default */ /***/function srcControllerCapLevelControllerTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var _events__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../events */"./src/events.ts");function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}/*
			 * cap stream level to media size dimension controller
			 */var CapLevelController=/*#__PURE__*/function(){function CapLevelController(hls){this.autoLevelCapping=void 0;this.firstLevel=void 0;this.media=void 0;this.restrictedLevels=void 0;this.timer=void 0;this.hls=void 0;this.streamController=void 0;this.clientRect=void 0;this.hls=hls;this.autoLevelCapping=Number.POSITIVE_INFINITY;this.firstLevel=-1;this.media=null;this.restrictedLevels=[];this.timer=undefined;this.clientRect=null;this.registerListeners();}var _proto=CapLevelController.prototype;_proto.setStreamController=function setStreamController(streamController){this.streamController=streamController;};_proto.destroy=function destroy(){this.unregisterListener();if(this.hls.config.capLevelToPlayerSize){this.stopCapping();}this.media=null;this.clientRect=null;// @ts-ignore
this.hls=this.streamController=null;};_proto.registerListeners=function registerListeners(){var hls=this.hls;hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MEDIA_ATTACHING,this.onMediaAttaching,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MANIFEST_PARSED,this.onManifestParsed,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].BUFFER_CODECS,this.onBufferCodecs,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);};_proto.unregisterListener=function unregisterListener(){var hls=this.hls;hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MEDIA_ATTACHING,this.onMediaAttaching,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MANIFEST_PARSED,this.onManifestParsed,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].BUFFER_CODECS,this.onBufferCodecs,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);};_proto.onFpsDropLevelCapping=function onFpsDropLevelCapping(event,data){// Don't add a restricted level more than once
if(CapLevelController.isLevelAllowed(data.droppedLevel,this.restrictedLevels)){this.restrictedLevels.push(data.droppedLevel);}};_proto.onMediaAttaching=function onMediaAttaching(event,data){this.media=data.media instanceof HTMLVideoElement?data.media:null;};_proto.onManifestParsed=function onManifestParsed(event,data){var hls=this.hls;this.restrictedLevels=[];this.firstLevel=data.firstLevel;if(hls.config.capLevelToPlayerSize&&data.video){// Start capping immediately if the manifest has signaled video codecs
this.startCapping();}}// Only activate capping when playing a video stream; otherwise, multi-bitrate audio-only streams will be restricted
// to the first level
;_proto.onBufferCodecs=function onBufferCodecs(event,data){var hls=this.hls;if(hls.config.capLevelToPlayerSize&&data.video){// If the manifest did not signal a video codec capping has been deferred until we're certain video is present
this.startCapping();}};_proto.onMediaDetaching=function onMediaDetaching(){this.stopCapping();};_proto.detectPlayerSize=function detectPlayerSize(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var levels=this.hls.levels;if(levels.length){var hls=this.hls;hls.autoLevelCapping=this.getMaxLevel(levels.length-1);if(hls.autoLevelCapping>this.autoLevelCapping&&this.streamController){// if auto level capping has a higher value for the previous one, flush the buffer using nextLevelSwitch
// usually happen when the user go to the fullscreen mode.
this.streamController.nextLevelSwitch();}this.autoLevelCapping=hls.autoLevelCapping;}}}/*
			   * returns level should be the one with the dimensions equal or greater than the media (player) dimensions (so the video will be downscaled)
			   */;_proto.getMaxLevel=function getMaxLevel(capLevelIndex){var _this=this;var levels=this.hls.levels;if(!levels.length){return-1;}var validLevels=levels.filter(function(level,index){return CapLevelController.isLevelAllowed(index,_this.restrictedLevels)&&index<=capLevelIndex;});this.clientRect=null;return CapLevelController.getMaxLevelByMediaSize(validLevels,this.mediaWidth,this.mediaHeight);};_proto.startCapping=function startCapping(){if(this.timer){// Don't reset capping if started twice; this can happen if the manifest signals a video codec
return;}this.autoLevelCapping=Number.POSITIVE_INFINITY;this.hls.firstLevel=this.getMaxLevel(this.firstLevel);self.clearInterval(this.timer);this.timer=self.setInterval(this.detectPlayerSize.bind(this),1000);this.detectPlayerSize();};_proto.stopCapping=function stopCapping(){this.restrictedLevels=[];this.firstLevel=-1;this.autoLevelCapping=Number.POSITIVE_INFINITY;if(this.timer){self.clearInterval(this.timer);this.timer=undefined;}};_proto.getDimensions=function getDimensions(){if(this.clientRect){return this.clientRect;}var media=this.media;var boundsRect={width:0,height:0};if(media){var clientRect=media.getBoundingClientRect();boundsRect.width=clientRect.width;boundsRect.height=clientRect.height;if(!boundsRect.width&&!boundsRect.height){// When the media element has no width or height (equivalent to not being in the DOM),
// then use its width and height attributes (media.width, media.height)
boundsRect.width=clientRect.right-clientRect.left||media.width||0;boundsRect.height=clientRect.bottom-clientRect.top||media.height||0;}}this.clientRect=boundsRect;return boundsRect;};CapLevelController.isLevelAllowed=function isLevelAllowed(level,restrictedLevels){if(restrictedLevels===void 0){restrictedLevels=[];}return restrictedLevels.indexOf(level)===-1;};CapLevelController.getMaxLevelByMediaSize=function getMaxLevelByMediaSize(levels,width,height){if(!levels||!levels.length){return-1;}// Levels can have the same dimensions but differing bandwidths - since levels are ordered, we can look to the next
// to determine whether we've chosen the greatest bandwidth for the media's dimensions
var atGreatestBandiwdth=function atGreatestBandiwdth(curLevel,nextLevel){if(!nextLevel){return true;}return curLevel.width!==nextLevel.width||curLevel.height!==nextLevel.height;};// If we run through the loop without breaking, the media's dimensions are greater than every level, so default to
// the max level
var maxLevelIndex=levels.length-1;for(var i=0;i<levels.length;i+=1){var level=levels[i];if((level.width>=width||level.height>=height)&&atGreatestBandiwdth(level,levels[i+1])){maxLevelIndex=i;break;}}return maxLevelIndex;};_createClass(CapLevelController,[{key:"mediaWidth",get:function get(){return this.getDimensions().width*CapLevelController.contentScaleFactor;}},{key:"mediaHeight",get:function get(){return this.getDimensions().height*CapLevelController.contentScaleFactor;}}],[{key:"contentScaleFactor",get:function get(){var pixelRatio=1;try{pixelRatio=self.devicePixelRatio;}catch(e){/* no-op */}return pixelRatio;}}]);return CapLevelController;}();/* harmony default export */__webpack_exports__["default"]=CapLevelController;/***/},/***/"./src/controller/cmcd-controller.ts":/*!*******************************************!*\
			  !*** ./src/controller/cmcd-controller.ts ***!
			  \*******************************************/ /*! exports provided: default */ /***/function srcControllerCmcdControllerTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"default",function(){return CMCDController;});/* harmony import */var _events__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../events */"./src/events.ts");/* harmony import */var _types_cmcd__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../types/cmcd */"./src/types/cmcd.ts");/* harmony import */var _utils_buffer_helper__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts");/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ../utils/logger */"./src/utils/logger.ts");function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}function _createForOfIteratorHelperLoose(o,allowArrayLike){var it=typeof Symbol!=="undefined"&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;return function(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};};}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};return _extends.apply(this,arguments);}/**
			 * Controller to deal with Common Media Client Data (CMCD)
			 * @see https://cdn.cta.tech/cta/media/media/resources/standards/pdfs/cta-5004-final.pdf
			 */var CMCDController=/*#__PURE__*/function(){// eslint-disable-line no-restricted-globals
// eslint-disable-line no-restricted-globals
function CMCDController(hls){var _this=this;this.hls=void 0;this.config=void 0;this.media=void 0;this.sid=void 0;this.cid=void 0;this.useHeaders=false;this.initialized=false;this.starved=false;this.buffering=true;this.audioBuffer=void 0;this.videoBuffer=void 0;this.onWaiting=function(){if(_this.initialized){_this.starved=true;}_this.buffering=true;};this.onPlaying=function(){if(!_this.initialized){_this.initialized=true;}_this.buffering=false;};this.applyPlaylistData=function(context){try{_this.apply(context,{ot:_types_cmcd__WEBPACK_IMPORTED_MODULE_1__["CMCDObjectType"].MANIFEST,su:!_this.initialized});}catch(error){_utils_logger__WEBPACK_IMPORTED_MODULE_3__["logger"].warn('Could not generate manifest CMCD data.',error);}};this.applyFragmentData=function(context){try{var fragment=context.frag;var level=_this.hls.levels[fragment.level];var ot=_this.getObjectType(fragment);var data={d:fragment.duration*1000,ot:ot};if(ot===_types_cmcd__WEBPACK_IMPORTED_MODULE_1__["CMCDObjectType"].VIDEO||ot===_types_cmcd__WEBPACK_IMPORTED_MODULE_1__["CMCDObjectType"].AUDIO||ot==_types_cmcd__WEBPACK_IMPORTED_MODULE_1__["CMCDObjectType"].MUXED){data.br=level.bitrate/1000;data.tb=_this.getTopBandwidth(ot)/1000;data.bl=_this.getBufferLength(ot);}_this.apply(context,data);}catch(error){_utils_logger__WEBPACK_IMPORTED_MODULE_3__["logger"].warn('Could not generate segment CMCD data.',error);}};this.hls=hls;var config=this.config=hls.config;var cmcd=config.cmcd;if(cmcd!=null){config.pLoader=this.createPlaylistLoader();config.fLoader=this.createFragmentLoader();this.sid=cmcd.sessionId||CMCDController.uuid();this.cid=cmcd.contentId;this.useHeaders=cmcd.useHeaders===true;this.registerListeners();}}var _proto=CMCDController.prototype;_proto.registerListeners=function registerListeners(){var hls=this.hls;hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MEDIA_ATTACHED,this.onMediaAttached,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MEDIA_DETACHED,this.onMediaDetached,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].BUFFER_CREATED,this.onBufferCreated,this);};_proto.unregisterListeners=function unregisterListeners(){var hls=this.hls;hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MEDIA_ATTACHED,this.onMediaAttached,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MEDIA_DETACHED,this.onMediaDetached,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].BUFFER_CREATED,this.onBufferCreated,this);this.onMediaDetached();};_proto.destroy=function destroy(){this.unregisterListeners();// @ts-ignore
this.hls=this.config=this.audioBuffer=this.videoBuffer=null;};_proto.onMediaAttached=function onMediaAttached(event,data){this.media=data.media;this.media.addEventListener('waiting',this.onWaiting);this.media.addEventListener('playing',this.onPlaying);};_proto.onMediaDetached=function onMediaDetached(){if(!this.media){return;}this.media.removeEventListener('waiting',this.onWaiting);this.media.removeEventListener('playing',this.onPlaying);// @ts-ignore
this.media=null;};_proto.onBufferCreated=function onBufferCreated(event,data){var _data$tracks$audio,_data$tracks$video;this.audioBuffer=(_data$tracks$audio=data.tracks.audio)===null||_data$tracks$audio===void 0?void 0:_data$tracks$audio.buffer;this.videoBuffer=(_data$tracks$video=data.tracks.video)===null||_data$tracks$video===void 0?void 0:_data$tracks$video.buffer;};/**
			   * Create baseline CMCD data
			   */_proto.createData=function createData(){var _this$media;return{v:_types_cmcd__WEBPACK_IMPORTED_MODULE_1__["CMCDVersion"],sf:_types_cmcd__WEBPACK_IMPORTED_MODULE_1__["CMCDStreamingFormat"].HLS,sid:this.sid,cid:this.cid,pr:(_this$media=this.media)===null||_this$media===void 0?void 0:_this$media.playbackRate,mtp:this.hls.bandwidthEstimate/1000};}/**
			   * Apply CMCD data to a request.
			   */;_proto.apply=function apply(context,data){if(data===void 0){data={};}// apply baseline data
_extends(data,this.createData());var isVideo=data.ot===_types_cmcd__WEBPACK_IMPORTED_MODULE_1__["CMCDObjectType"].INIT||data.ot===_types_cmcd__WEBPACK_IMPORTED_MODULE_1__["CMCDObjectType"].VIDEO||data.ot===_types_cmcd__WEBPACK_IMPORTED_MODULE_1__["CMCDObjectType"].MUXED;if(this.starved&&isVideo){data.bs=true;data.su=true;this.starved=false;}if(data.su==null){data.su=this.buffering;}// TODO: Implement rtp, nrr, nor, dl
if(this.useHeaders){var headers=CMCDController.toHeaders(data);if(!Object.keys(headers).length){return;}if(!context.headers){context.headers={};}_extends(context.headers,headers);}else{var query=CMCDController.toQuery(data);if(!query){return;}context.url=CMCDController.appendQueryToUri(context.url,query);}}/**
			   * Apply CMCD data to a manifest request.
			   */;/**
			   * The CMCD object type.
			   */_proto.getObjectType=function getObjectType(fragment){var type=fragment.type;if(type==='subtitle'){return _types_cmcd__WEBPACK_IMPORTED_MODULE_1__["CMCDObjectType"].TIMED_TEXT;}if(fragment.sn==='initSegment'){return _types_cmcd__WEBPACK_IMPORTED_MODULE_1__["CMCDObjectType"].INIT;}if(type==='audio'){return _types_cmcd__WEBPACK_IMPORTED_MODULE_1__["CMCDObjectType"].AUDIO;}if(type==='main'){if(!this.hls.audioTracks.length){return _types_cmcd__WEBPACK_IMPORTED_MODULE_1__["CMCDObjectType"].MUXED;}return _types_cmcd__WEBPACK_IMPORTED_MODULE_1__["CMCDObjectType"].VIDEO;}return undefined;}/**
			   * Get the highest bitrate.
			   */;_proto.getTopBandwidth=function getTopBandwidth(type){var bitrate=0;var levels;var hls=this.hls;if(type===_types_cmcd__WEBPACK_IMPORTED_MODULE_1__["CMCDObjectType"].AUDIO){levels=hls.audioTracks;}else{var max=hls.maxAutoLevel;var len=max>-1?max+1:hls.levels.length;levels=hls.levels.slice(0,len);}for(var _iterator=_createForOfIteratorHelperLoose(levels),_step;!(_step=_iterator()).done;){var level=_step.value;if(level.bitrate>bitrate){bitrate=level.bitrate;}}return bitrate>0?bitrate:NaN;}/**
			   * Get the buffer length for a media type in milliseconds
			   */;_proto.getBufferLength=function getBufferLength(type){var media=this.hls.media;var buffer=type===_types_cmcd__WEBPACK_IMPORTED_MODULE_1__["CMCDObjectType"].AUDIO?this.audioBuffer:this.videoBuffer;if(!buffer||!media){return NaN;}var info=_utils_buffer_helper__WEBPACK_IMPORTED_MODULE_2__["BufferHelper"].bufferInfo(buffer,media.currentTime,this.config.maxBufferHole);return info.len*1000;}/**
			   * Create a playlist loader
			   */;_proto.createPlaylistLoader=function createPlaylistLoader(){var pLoader=this.config.pLoader;var apply=this.applyPlaylistData;var Ctor=pLoader||this.config.loader;return/*#__PURE__*/function(){function CmcdPlaylistLoader(config){this.loader=void 0;this.loader=new Ctor(config);}var _proto2=CmcdPlaylistLoader.prototype;_proto2.destroy=function destroy(){this.loader.destroy();};_proto2.abort=function abort(){this.loader.abort();};_proto2.load=function load(context,config,callbacks){apply(context);this.loader.load(context,config,callbacks);};_createClass(CmcdPlaylistLoader,[{key:"stats",get:function get(){return this.loader.stats;}},{key:"context",get:function get(){return this.loader.context;}}]);return CmcdPlaylistLoader;}();}/**
			   * Create a playlist loader
			   */;_proto.createFragmentLoader=function createFragmentLoader(){var fLoader=this.config.fLoader;var apply=this.applyFragmentData;var Ctor=fLoader||this.config.loader;return/*#__PURE__*/function(){function CmcdFragmentLoader(config){this.loader=void 0;this.loader=new Ctor(config);}var _proto3=CmcdFragmentLoader.prototype;_proto3.destroy=function destroy(){this.loader.destroy();};_proto3.abort=function abort(){this.loader.abort();};_proto3.load=function load(context,config,callbacks){apply(context);this.loader.load(context,config,callbacks);};_createClass(CmcdFragmentLoader,[{key:"stats",get:function get(){return this.loader.stats;}},{key:"context",get:function get(){return this.loader.context;}}]);return CmcdFragmentLoader;}();}/**
			   * Generate a random v4 UUI
			   *
			   * @returns {string}
			   */;CMCDController.uuid=function uuid(){var url=URL.createObjectURL(new Blob());var uuid=url.toString();URL.revokeObjectURL(url);return uuid.substr(uuid.lastIndexOf('/')+1);}/**
			   * Serialize a CMCD data object according to the rules defined in the
			   * section 3.2 of
			   * [CTA-5004](https://cdn.cta.tech/cta/media/media/resources/standards/pdfs/cta-5004-final.pdf).
			   */;CMCDController.serialize=function serialize(data){var results=[];var isValid=function isValid(value){return!Number.isNaN(value)&&value!=null&&value!==''&&value!==false;};var toRounded=function toRounded(value){return Math.round(value);};var toHundred=function toHundred(value){return toRounded(value/100)*100;};var toUrlSafe=function toUrlSafe(value){return encodeURIComponent(value);};var formatters={br:toRounded,d:toRounded,bl:toHundred,dl:toHundred,mtp:toHundred,nor:toUrlSafe,rtp:toHundred,tb:toRounded};var keys=Object.keys(data||{}).sort();for(var _iterator2=_createForOfIteratorHelperLoose(keys),_step2;!(_step2=_iterator2()).done;){var key=_step2.value;var value=data[key];// ignore invalid values
if(!isValid(value)){continue;}// Version should only be reported if not equal to 1.
if(key==='v'&&value===1){continue;}// Playback rate should only be sent if not equal to 1.
if(key=='pr'&&value===1){continue;}// Certain values require special formatting
var formatter=formatters[key];if(formatter){value=formatter(value);}// Serialize the key/value pair
var type=_typeof3(value);var result=void 0;if(key==='ot'||key==='sf'||key==='st'){result=key+"="+value;}else if(type==='boolean'){result=key;}else if(type==='number'){result=key+"="+value;}else{result=key+"="+JSON.stringify(value);}results.push(result);}return results.join(',');}/**
			   * Convert a CMCD data object to request headers according to the rules
			   * defined in the section 2.1 and 3.2 of
			   * [CTA-5004](https://cdn.cta.tech/cta/media/media/resources/standards/pdfs/cta-5004-final.pdf).
			   */;CMCDController.toHeaders=function toHeaders(data){var keys=Object.keys(data);var headers={};var headerNames=['Object','Request','Session','Status'];var headerGroups=[{},{},{},{}];var headerMap={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3};for(var _i=0,_keys=keys;_i<_keys.length;_i++){var key=_keys[_i];// Unmapped fields are mapped to the Request header
var index=headerMap[key]!=null?headerMap[key]:1;headerGroups[index][key]=data[key];}for(var i=0;i<headerGroups.length;i++){var value=CMCDController.serialize(headerGroups[i]);if(value){headers["CMCD-"+headerNames[i]]=value;}}return headers;}/**
			   * Convert a CMCD data object to query args according to the rules
			   * defined in the section 2.2 and 3.2 of
			   * [CTA-5004](https://cdn.cta.tech/cta/media/media/resources/standards/pdfs/cta-5004-final.pdf).
			   */;CMCDController.toQuery=function toQuery(data){return"CMCD="+encodeURIComponent(CMCDController.serialize(data));}/**
			   * Append query args to a uri.
			   */;CMCDController.appendQueryToUri=function appendQueryToUri(uri,query){if(!query){return uri;}var separator=uri.includes('?')?'&':'?';return""+uri+separator+query;};return CMCDController;}();/***/},/***/"./src/controller/eme-controller.ts":/*!******************************************!*\
			  !*** ./src/controller/eme-controller.ts ***!
			  \******************************************/ /*! exports provided: default */ /***/function srcControllerEmeControllerTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var _events__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../events */"./src/events.ts");/* harmony import */var _errors__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../errors */"./src/errors.ts");/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../utils/logger */"./src/utils/logger.ts");/* harmony import */var _utils_mediakeys_helper__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ../utils/mediakeys-helper */"./src/utils/mediakeys-helper.ts");function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}/**
			 * @author Stephan Hesse <disparat@gmail.com> | <tchakabam@gmail.com>
			 *
			 * DRM support for Hls.js
			 */var MAX_LICENSE_REQUEST_FAILURES=3;/**
			 * @see https://developer.mozilla.org/en-US/docs/Web/API/MediaKeySystemConfiguration
			 * @param {Array<string>} audioCodecs List of required audio codecs to support
			 * @param {Array<string>} videoCodecs List of required video codecs to support
			 * @param {object} drmSystemOptions Optional parameters/requirements for the key-system
			 * @returns {Array<MediaSystemConfiguration>} An array of supported configurations
			 */var createWidevineMediaKeySystemConfigurations=function createWidevineMediaKeySystemConfigurations(audioCodecs,videoCodecs,drmSystemOptions){/* jshint ignore:line */var baseConfig={// initDataTypes: ['keyids', 'mp4'],
// label: "",
// persistentState: "not-allowed", // or "required" ?
// distinctiveIdentifier: "not-allowed", // or "required" ?
// sessionTypes: ['temporary'],
audioCapabilities:[],// { contentType: 'audio/mp4; codecs="mp4a.40.2"' }
videoCapabilities:[]// { contentType: 'video/mp4; codecs="avc1.42E01E"' }
};audioCodecs.forEach(function(codec){baseConfig.audioCapabilities.push({contentType:"audio/mp4; codecs=\""+codec+"\"",robustness:drmSystemOptions.audioRobustness||''});});videoCodecs.forEach(function(codec){baseConfig.videoCapabilities.push({contentType:"video/mp4; codecs=\""+codec+"\"",robustness:drmSystemOptions.videoRobustness||''});});return[baseConfig];};/**
			 * The idea here is to handle key-system (and their respective platforms) specific configuration differences
			 * in order to work with the local requestMediaKeySystemAccess method.
			 *
			 * We can also rule-out platform-related key-system support at this point by throwing an error.
			 *
			 * @param {string} keySystem Identifier for the key-system, see `KeySystems` enum
			 * @param {Array<string>} audioCodecs List of required audio codecs to support
			 * @param {Array<string>} videoCodecs List of required video codecs to support
			 * @throws will throw an error if a unknown key system is passed
			 * @returns {Array<MediaSystemConfiguration>} A non-empty Array of MediaKeySystemConfiguration objects
			 */var getSupportedMediaKeySystemConfigurations=function getSupportedMediaKeySystemConfigurations(keySystem,audioCodecs,videoCodecs,drmSystemOptions){switch(keySystem){case _utils_mediakeys_helper__WEBPACK_IMPORTED_MODULE_3__["KeySystems"].WIDEVINE:return createWidevineMediaKeySystemConfigurations(audioCodecs,videoCodecs,drmSystemOptions);default:throw new Error("Unknown key-system: "+keySystem);}};/**
			 * Controller to deal with encrypted media extensions (EME)
			 * @see https://developer.mozilla.org/en-US/docs/Web/API/Encrypted_Media_Extensions_API
			 *
			 * @class
			 * @constructor
			 */var EMEController=/*#__PURE__*/function(){/**
			   * @constructs
			   * @param {Hls} hls Our Hls.js instance
			   */function EMEController(hls){this.hls=void 0;this._widevineLicenseUrl=void 0;this._licenseXhrSetup=void 0;this._licenseResponseCallback=void 0;this._emeEnabled=void 0;this._requestMediaKeySystemAccess=void 0;this._drmSystemOptions=void 0;this._config=void 0;this._mediaKeysList=[];this._media=null;this._hasSetMediaKeys=false;this._requestLicenseFailureCount=0;this.mediaKeysPromise=null;this._onMediaEncrypted=this.onMediaEncrypted.bind(this);this.hls=hls;this._config=hls.config;this._widevineLicenseUrl=this._config.widevineLicenseUrl;this._licenseXhrSetup=this._config.licenseXhrSetup;this._licenseResponseCallback=this._config.licenseResponseCallback;this._emeEnabled=this._config.emeEnabled;this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc;this._drmSystemOptions=this._config.drmSystemOptions;this._registerListeners();}var _proto=EMEController.prototype;_proto.destroy=function destroy(){this._unregisterListeners();// @ts-ignore
this.hls=this._onMediaEncrypted=null;this._requestMediaKeySystemAccess=null;};_proto._registerListeners=function _registerListeners(){this.hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MEDIA_ATTACHED,this.onMediaAttached,this);this.hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MEDIA_DETACHED,this.onMediaDetached,this);this.hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MANIFEST_PARSED,this.onManifestParsed,this);};_proto._unregisterListeners=function _unregisterListeners(){this.hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MEDIA_ATTACHED,this.onMediaAttached,this);this.hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MEDIA_DETACHED,this.onMediaDetached,this);this.hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MANIFEST_PARSED,this.onManifestParsed,this);}/**
			   * @param {string} keySystem Identifier for the key-system, see `KeySystems` enum
			   * @returns {string} License server URL for key-system (if any configured, otherwise causes error)
			   * @throws if a unsupported keysystem is passed
			   */;_proto.getLicenseServerUrl=function getLicenseServerUrl(keySystem){switch(keySystem){case _utils_mediakeys_helper__WEBPACK_IMPORTED_MODULE_3__["KeySystems"].WIDEVINE:if(!this._widevineLicenseUrl){break;}return this._widevineLicenseUrl;}throw new Error("no license server URL configured for key-system \""+keySystem+"\"");}/**
			   * Requests access object and adds it to our list upon success
			   * @private
			   * @param {string} keySystem System ID (see `KeySystems`)
			   * @param {Array<string>} audioCodecs List of required audio codecs to support
			   * @param {Array<string>} videoCodecs List of required video codecs to support
			   * @throws When a unsupported KeySystem is passed
			   */;_proto._attemptKeySystemAccess=function _attemptKeySystemAccess(keySystem,audioCodecs,videoCodecs){var _this=this;// This can throw, but is caught in event handler callpath
var mediaKeySystemConfigs=getSupportedMediaKeySystemConfigurations(keySystem,audioCodecs,videoCodecs,this._drmSystemOptions);_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].log('Requesting encrypted media key-system access');// expecting interface like window.navigator.requestMediaKeySystemAccess
var keySystemAccessPromise=this.requestMediaKeySystemAccess(keySystem,mediaKeySystemConfigs);this.mediaKeysPromise=keySystemAccessPromise.then(function(mediaKeySystemAccess){return _this._onMediaKeySystemAccessObtained(keySystem,mediaKeySystemAccess);});keySystemAccessPromise.catch(function(err){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].error("Failed to obtain key-system \""+keySystem+"\" access:",err);});};/**
			   * Handles obtaining access to a key-system
			   * @private
			   * @param {string} keySystem
			   * @param {MediaKeySystemAccess} mediaKeySystemAccess https://developer.mozilla.org/en-US/docs/Web/API/MediaKeySystemAccess
			   */_proto._onMediaKeySystemAccessObtained=function _onMediaKeySystemAccessObtained(keySystem,mediaKeySystemAccess){var _this2=this;_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].log("Access for key-system \""+keySystem+"\" obtained");var mediaKeysListItem={mediaKeysSessionInitialized:false,mediaKeySystemAccess:mediaKeySystemAccess,mediaKeySystemDomain:keySystem};this._mediaKeysList.push(mediaKeysListItem);var mediaKeysPromise=Promise.resolve().then(function(){return mediaKeySystemAccess.createMediaKeys();}).then(function(mediaKeys){mediaKeysListItem.mediaKeys=mediaKeys;_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].log("Media-keys created for key-system \""+keySystem+"\"");_this2._onMediaKeysCreated();return mediaKeys;});mediaKeysPromise.catch(function(err){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].error('Failed to create media-keys:',err);});return mediaKeysPromise;}/**
			   * Handles key-creation (represents access to CDM). We are going to create key-sessions upon this
			   * for all existing keys where no session exists yet.
			   *
			   * @private
			   */;_proto._onMediaKeysCreated=function _onMediaKeysCreated(){var _this3=this;// check for all key-list items if a session exists, otherwise, create one
this._mediaKeysList.forEach(function(mediaKeysListItem){if(!mediaKeysListItem.mediaKeysSession){// mediaKeys is definitely initialized here
mediaKeysListItem.mediaKeysSession=mediaKeysListItem.mediaKeys.createSession();_this3._onNewMediaKeySession(mediaKeysListItem.mediaKeysSession);}});}/**
			   * @private
			   * @param {*} keySession
			   */;_proto._onNewMediaKeySession=function _onNewMediaKeySession(keySession){var _this4=this;_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].log("New key-system session "+keySession.sessionId);keySession.addEventListener('message',function(event){_this4._onKeySessionMessage(keySession,event.message);},false);}/**
			   * @private
			   * @param {MediaKeySession} keySession
			   * @param {ArrayBuffer} message
			   */;_proto._onKeySessionMessage=function _onKeySessionMessage(keySession,message){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].log('Got EME message event, creating license request');this._requestLicense(message,function(data){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].log("Received license data (length: "+(data?data.byteLength:data)+"), updating key-session");keySession.update(data);});}/**
			   * @private
			   * @param e {MediaEncryptedEvent}
			   */;_proto.onMediaEncrypted=function onMediaEncrypted(e){var _this5=this;_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].log("Media is encrypted using \""+e.initDataType+"\" init data type");if(!this.mediaKeysPromise){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].error('Fatal: Media is encrypted but no CDM access or no keys have been requested');this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].ERROR,{type:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorTypes"].KEY_SYSTEM_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorDetails"].KEY_SYSTEM_NO_KEYS,fatal:true});return;}var finallySetKeyAndStartSession=function finallySetKeyAndStartSession(mediaKeys){if(!_this5._media){return;}_this5._attemptSetMediaKeys(mediaKeys);_this5._generateRequestWithPreferredKeySession(e.initDataType,e.initData);};// Could use `Promise.finally` but some Promise polyfills are missing it
this.mediaKeysPromise.then(finallySetKeyAndStartSession).catch(finallySetKeyAndStartSession);}/**
			   * @private
			   */;_proto._attemptSetMediaKeys=function _attemptSetMediaKeys(mediaKeys){if(!this._media){throw new Error('Attempted to set mediaKeys without first attaching a media element');}if(!this._hasSetMediaKeys){// FIXME: see if we can/want/need-to really to deal with several potential key-sessions?
var keysListItem=this._mediaKeysList[0];if(!keysListItem||!keysListItem.mediaKeys){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].error('Fatal: Media is encrypted but no CDM access or no keys have been obtained yet');this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].ERROR,{type:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorTypes"].KEY_SYSTEM_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorDetails"].KEY_SYSTEM_NO_KEYS,fatal:true});return;}_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].log('Setting keys for encrypted media');this._media.setMediaKeys(keysListItem.mediaKeys);this._hasSetMediaKeys=true;}}/**
			   * @private
			   */;_proto._generateRequestWithPreferredKeySession=function _generateRequestWithPreferredKeySession(initDataType,initData){var _this6=this;// FIXME: see if we can/want/need-to really to deal with several potential key-sessions?
var keysListItem=this._mediaKeysList[0];if(!keysListItem){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].error('Fatal: Media is encrypted but not any key-system access has been obtained yet');this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].ERROR,{type:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorTypes"].KEY_SYSTEM_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorDetails"].KEY_SYSTEM_NO_ACCESS,fatal:true});return;}if(keysListItem.mediaKeysSessionInitialized){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].warn('Key-Session already initialized but requested again');return;}var keySession=keysListItem.mediaKeysSession;if(!keySession){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].error('Fatal: Media is encrypted but no key-session existing');this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].ERROR,{type:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorTypes"].KEY_SYSTEM_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorDetails"].KEY_SYSTEM_NO_SESSION,fatal:true});return;}// initData is null if the media is not CORS-same-origin
if(!initData){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].warn('Fatal: initData required for generating a key session is null');this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].ERROR,{type:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorTypes"].KEY_SYSTEM_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorDetails"].KEY_SYSTEM_NO_INIT_DATA,fatal:true});return;}_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].log("Generating key-session request for \""+initDataType+"\" init data type");keysListItem.mediaKeysSessionInitialized=true;keySession.generateRequest(initDataType,initData).then(function(){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].debug('Key-session generation succeeded');}).catch(function(err){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].error('Error generating key-session request:',err);_this6.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].ERROR,{type:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorTypes"].KEY_SYSTEM_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorDetails"].KEY_SYSTEM_NO_SESSION,fatal:false});});}/**
			   * @private
			   * @param {string} url License server URL
			   * @param {ArrayBuffer} keyMessage Message data issued by key-system
			   * @param {function} callback Called when XHR has succeeded
			   * @returns {XMLHttpRequest} Unsent (but opened state) XHR object
			   * @throws if XMLHttpRequest construction failed
			   */;_proto._createLicenseXhr=function _createLicenseXhr(url,keyMessage,callback){var xhr=new XMLHttpRequest();xhr.responseType='arraybuffer';xhr.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,xhr,url,keyMessage,callback);var licenseXhrSetup=this._licenseXhrSetup;if(licenseXhrSetup){try{licenseXhrSetup.call(this.hls,xhr,url);licenseXhrSetup=undefined;}catch(e){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].error(e);}}try{// if licenseXhrSetup did not yet call open, let's do it now
if(!xhr.readyState){xhr.open('POST',url,true);}if(licenseXhrSetup){licenseXhrSetup.call(this.hls,xhr,url);}}catch(e){// IE11 throws an exception on xhr.open if attempting to access an HTTP resource over HTTPS
throw new Error("issue setting up KeySystem license XHR "+e);}return xhr;}/**
			   * @private
			   * @param {XMLHttpRequest} xhr
			   * @param {string} url License server URL
			   * @param {ArrayBuffer} keyMessage Message data issued by key-system
			   * @param {function} callback Called when XHR has succeeded
			   */;_proto._onLicenseRequestReadyStageChange=function _onLicenseRequestReadyStageChange(xhr,url,keyMessage,callback){switch(xhr.readyState){case 4:if(xhr.status===200){this._requestLicenseFailureCount=0;_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].log('License request succeeded');var _data=xhr.response;var licenseResponseCallback=this._licenseResponseCallback;if(licenseResponseCallback){try{_data=licenseResponseCallback.call(this.hls,xhr,url);}catch(e){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].error(e);}}callback(_data);}else{_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].error("License Request XHR failed ("+url+"). Status: "+xhr.status+" ("+xhr.statusText+")");this._requestLicenseFailureCount++;if(this._requestLicenseFailureCount>MAX_LICENSE_REQUEST_FAILURES){this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].ERROR,{type:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorTypes"].KEY_SYSTEM_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorDetails"].KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:true});return;}var attemptsLeft=MAX_LICENSE_REQUEST_FAILURES-this._requestLicenseFailureCount+1;_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].warn("Retrying license request, "+attemptsLeft+" attempts left");this._requestLicense(keyMessage,callback);}break;}}/**
			   * @private
			   * @param {MediaKeysListItem} keysListItem
			   * @param {ArrayBuffer} keyMessage
			   * @returns {ArrayBuffer} Challenge data posted to license server
			   * @throws if KeySystem is unsupported
			   */;_proto._generateLicenseRequestChallenge=function _generateLicenseRequestChallenge(keysListItem,keyMessage){switch(keysListItem.mediaKeySystemDomain){// case KeySystems.PLAYREADY:
// from https://github.com/MicrosoftEdge/Demos/blob/master/eme/scripts/demo.js
/*
			      if (this.licenseType !== this.LICENSE_TYPE_WIDEVINE) {
			        // For PlayReady CDMs, we need to dig the Challenge out of the XML.
			        var keyMessageXml = new DOMParser().parseFromString(String.fromCharCode.apply(null, new Uint16Array(keyMessage)), 'application/xml');
			        if (keyMessageXml.getElementsByTagName('Challenge')[0]) {
			            challenge = atob(keyMessageXml.getElementsByTagName('Challenge')[0].childNodes[0].nodeValue);
			        } else {
			            throw 'Cannot find <Challenge> in key message';
			        }
			        var headerNames = keyMessageXml.getElementsByTagName('name');
			        var headerValues = keyMessageXml.getElementsByTagName('value');
			        if (headerNames.length !== headerValues.length) {
			            throw 'Mismatched header <name>/<value> pair in key message';
			        }
			        for (var i = 0; i < headerNames.length; i++) {
			            xhr.setRequestHeader(headerNames[i].childNodes[0].nodeValue, headerValues[i].childNodes[0].nodeValue);
			        }
			      }
			      break;
			      */case _utils_mediakeys_helper__WEBPACK_IMPORTED_MODULE_3__["KeySystems"].WIDEVINE:// For Widevine CDMs, the challenge is the keyMessage.
return keyMessage;}throw new Error("unsupported key-system: "+keysListItem.mediaKeySystemDomain);}/**
			   * @private
			   * @param keyMessage
			   * @param callback
			   */;_proto._requestLicense=function _requestLicense(keyMessage,callback){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].log('Requesting content license for key-system');var keysListItem=this._mediaKeysList[0];if(!keysListItem){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].error('Fatal error: Media is encrypted but no key-system access has been obtained yet');this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].ERROR,{type:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorTypes"].KEY_SYSTEM_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorDetails"].KEY_SYSTEM_NO_ACCESS,fatal:true});return;}try{var _url=this.getLicenseServerUrl(keysListItem.mediaKeySystemDomain);var _xhr=this._createLicenseXhr(_url,keyMessage,callback);_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].log("Sending license request to URL: "+_url);var challenge=this._generateLicenseRequestChallenge(keysListItem,keyMessage);_xhr.send(challenge);}catch(e){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].error("Failure requesting DRM license: "+e);this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].ERROR,{type:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorTypes"].KEY_SYSTEM_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorDetails"].KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:true});}};_proto.onMediaAttached=function onMediaAttached(event,data){if(!this._emeEnabled){return;}var media=data.media;// keep reference of media
this._media=media;media.addEventListener('encrypted',this._onMediaEncrypted);};_proto.onMediaDetached=function onMediaDetached(){var media=this._media;var mediaKeysList=this._mediaKeysList;if(!media){return;}media.removeEventListener('encrypted',this._onMediaEncrypted);this._media=null;this._mediaKeysList=[];// Close all sessions and remove media keys from the video element.
Promise.all(mediaKeysList.map(function(mediaKeysListItem){if(mediaKeysListItem.mediaKeysSession){return mediaKeysListItem.mediaKeysSession.close().catch(function(){// Ignore errors when closing the sessions. Closing a session that
// generated no key requests will throw an error.
});}})).then(function(){return media.setMediaKeys(null);}).catch(function(){// Ignore any failures while removing media keys from the video element.
});};_proto.onManifestParsed=function onManifestParsed(event,data){if(!this._emeEnabled){return;}var audioCodecs=data.levels.map(function(level){return level.audioCodec;}).filter(function(audioCodec){return!!audioCodec;});var videoCodecs=data.levels.map(function(level){return level.videoCodec;}).filter(function(videoCodec){return!!videoCodec;});this._attemptKeySystemAccess(_utils_mediakeys_helper__WEBPACK_IMPORTED_MODULE_3__["KeySystems"].WIDEVINE,audioCodecs,videoCodecs);};_createClass(EMEController,[{key:"requestMediaKeySystemAccess",get:function get(){if(!this._requestMediaKeySystemAccess){throw new Error('No requestMediaKeySystemAccess function configured');}return this._requestMediaKeySystemAccess;}}]);return EMEController;}();/* harmony default export */__webpack_exports__["default"]=EMEController;/***/},/***/"./src/controller/fps-controller.ts":/*!******************************************!*\
			  !*** ./src/controller/fps-controller.ts ***!
			  \******************************************/ /*! exports provided: default */ /***/function srcControllerFpsControllerTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var _events__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../events */"./src/events.ts");/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../utils/logger */"./src/utils/logger.ts");var FPSController=/*#__PURE__*/function(){// stream controller must be provided as a dependency!
function FPSController(hls){this.hls=void 0;this.isVideoPlaybackQualityAvailable=false;this.timer=void 0;this.media=null;this.lastTime=void 0;this.lastDroppedFrames=0;this.lastDecodedFrames=0;this.streamController=void 0;this.hls=hls;this.registerListeners();}var _proto=FPSController.prototype;_proto.setStreamController=function setStreamController(streamController){this.streamController=streamController;};_proto.registerListeners=function registerListeners(){this.hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MEDIA_ATTACHING,this.onMediaAttaching,this);};_proto.unregisterListeners=function unregisterListeners(){this.hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MEDIA_ATTACHING,this.onMediaAttaching);};_proto.destroy=function destroy(){if(this.timer){clearInterval(this.timer);}this.unregisterListeners();this.isVideoPlaybackQualityAvailable=false;this.media=null;};_proto.onMediaAttaching=function onMediaAttaching(event,data){var config=this.hls.config;if(config.capLevelOnFPSDrop){var media=data.media instanceof self.HTMLVideoElement?data.media:null;this.media=media;if(media&&typeof media.getVideoPlaybackQuality==='function'){this.isVideoPlaybackQualityAvailable=true;}self.clearInterval(this.timer);this.timer=self.setInterval(this.checkFPSInterval.bind(this),config.fpsDroppedMonitoringPeriod);}};_proto.checkFPS=function checkFPS(video,decodedFrames,droppedFrames){var currentTime=performance.now();if(decodedFrames){if(this.lastTime){var currentPeriod=currentTime-this.lastTime;var currentDropped=droppedFrames-this.lastDroppedFrames;var currentDecoded=decodedFrames-this.lastDecodedFrames;var droppedFPS=1000*currentDropped/currentPeriod;var hls=this.hls;hls.trigger(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].FPS_DROP,{currentDropped:currentDropped,currentDecoded:currentDecoded,totalDroppedFrames:droppedFrames});if(droppedFPS>0){// logger.log('checkFPS : droppedFPS/decodedFPS:' + droppedFPS/(1000 * currentDecoded / currentPeriod));
if(currentDropped>hls.config.fpsDroppedMonitoringThreshold*currentDecoded){var currentLevel=hls.currentLevel;_utils_logger__WEBPACK_IMPORTED_MODULE_1__["logger"].warn('drop FPS ratio greater than max allowed value for currentLevel: '+currentLevel);if(currentLevel>0&&(hls.autoLevelCapping===-1||hls.autoLevelCapping>=currentLevel)){currentLevel=currentLevel-1;hls.trigger(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].FPS_DROP_LEVEL_CAPPING,{level:currentLevel,droppedLevel:hls.currentLevel});hls.autoLevelCapping=currentLevel;this.streamController.nextLevelSwitch();}}}}this.lastTime=currentTime;this.lastDroppedFrames=droppedFrames;this.lastDecodedFrames=decodedFrames;}};_proto.checkFPSInterval=function checkFPSInterval(){var video=this.media;if(video){if(this.isVideoPlaybackQualityAvailable){var videoPlaybackQuality=video.getVideoPlaybackQuality();this.checkFPS(video,videoPlaybackQuality.totalVideoFrames,videoPlaybackQuality.droppedVideoFrames);}else{// HTMLVideoElement doesn't include the webkit types
this.checkFPS(video,video.webkitDecodedFrameCount,video.webkitDroppedFrameCount);}}};return FPSController;}();/* harmony default export */__webpack_exports__["default"]=FPSController;/***/},/***/"./src/controller/fragment-finders.ts":/*!********************************************!*\
			  !*** ./src/controller/fragment-finders.ts ***!
			  \********************************************/ /*! exports provided: findFragmentByPDT, findFragmentByPTS, fragmentWithinToleranceTest, pdtWithinToleranceTest, findFragWithCC */ /***/function srcControllerFragmentFindersTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"findFragmentByPDT",function(){return findFragmentByPDT;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"findFragmentByPTS",function(){return findFragmentByPTS;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"fragmentWithinToleranceTest",function(){return fragmentWithinToleranceTest;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"pdtWithinToleranceTest",function(){return pdtWithinToleranceTest;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"findFragWithCC",function(){return findFragWithCC;});/* harmony import */var _home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./src/polyfills/number */"./src/polyfills/number.ts");/* harmony import */var _utils_binary_search__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../utils/binary-search */"./src/utils/binary-search.ts");/**
			 * Returns first fragment whose endPdt value exceeds the given PDT.
			 * @param {Array<Fragment>} fragments - The array of candidate fragments
			 * @param {number|null} [PDTValue = null] - The PDT value which must be exceeded
			 * @param {number} [maxFragLookUpTolerance = 0] - The amount of time that a fragment's start/end can be within in order to be considered contiguous
			 * @returns {*|null} fragment - The best matching fragment
			 */function findFragmentByPDT(fragments,PDTValue,maxFragLookUpTolerance){if(PDTValue===null||!Array.isArray(fragments)||!fragments.length||!Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(PDTValue)){return null;}// if less than start
var startPDT=fragments[0].programDateTime;if(PDTValue<(startPDT||0)){return null;}var endPDT=fragments[fragments.length-1].endProgramDateTime;if(PDTValue>=(endPDT||0)){return null;}maxFragLookUpTolerance=maxFragLookUpTolerance||0;for(var seg=0;seg<fragments.length;++seg){var frag=fragments[seg];if(pdtWithinToleranceTest(PDTValue,maxFragLookUpTolerance,frag)){return frag;}}return null;}/**
			 * Finds a fragment based on the SN of the previous fragment; or based on the needs of the current buffer.
			 * This method compensates for small buffer gaps by applying a tolerance to the start of any candidate fragment, thus
			 * breaking any traps which would cause the same fragment to be continuously selected within a small range.
			 * @param {*} fragPrevious - The last frag successfully appended
			 * @param {Array} fragments - The array of candidate fragments
			 * @param {number} [bufferEnd = 0] - The end of the contiguous buffered range the playhead is currently within
			 * @param {number} maxFragLookUpTolerance - The amount of time that a fragment's start/end can be within in order to be considered contiguous
			 * @returns {*} foundFrag - The best matching fragment
			 */function findFragmentByPTS(fragPrevious,fragments,bufferEnd,maxFragLookUpTolerance){if(bufferEnd===void 0){bufferEnd=0;}if(maxFragLookUpTolerance===void 0){maxFragLookUpTolerance=0;}var fragNext=null;if(fragPrevious){fragNext=fragments[fragPrevious.sn-fragments[0].sn+1]||null;}else if(bufferEnd===0&&fragments[0].start===0){fragNext=fragments[0];}// Prefer the next fragment if it's within tolerance
if(fragNext&&fragmentWithinToleranceTest(bufferEnd,maxFragLookUpTolerance,fragNext)===0){return fragNext;}// We might be seeking past the tolerance so find the best match
var foundFragment=_utils_binary_search__WEBPACK_IMPORTED_MODULE_1__["default"].search(fragments,fragmentWithinToleranceTest.bind(null,bufferEnd,maxFragLookUpTolerance));if(foundFragment){return foundFragment;}// If no match was found return the next fragment after fragPrevious, or null
return fragNext;}/**
			 * The test function used by the findFragmentBySn's BinarySearch to look for the best match to the current buffer conditions.
			 * @param {*} candidate - The fragment to test
			 * @param {number} [bufferEnd = 0] - The end of the current buffered range the playhead is currently within
			 * @param {number} [maxFragLookUpTolerance = 0] - The amount of time that a fragment's start can be within in order to be considered contiguous
			 * @returns {number} - 0 if it matches, 1 if too low, -1 if too high
			 */function fragmentWithinToleranceTest(bufferEnd,maxFragLookUpTolerance,candidate){if(bufferEnd===void 0){bufferEnd=0;}if(maxFragLookUpTolerance===void 0){maxFragLookUpTolerance=0;}// offset should be within fragment boundary - config.maxFragLookUpTolerance
// this is to cope with situations like
// bufferEnd = 9.991
// frag[Ø] : [0,10]
// frag[1] : [10,20]
// bufferEnd is within frag[0] range ... although what we are expecting is to return frag[1] here
//              frag start               frag start+duration
//                  |-----------------------------|
//              <--->                         <--->
//  ...--------><-----------------------------><---------....
// previous frag         matching fragment         next frag
//  return -1             return 0                 return 1
// logger.log(`level/sn/start/end/bufEnd:${level}/${candidate.sn}/${candidate.start}/${(candidate.start+candidate.duration)}/${bufferEnd}`);
// Set the lookup tolerance to be small enough to detect the current segment - ensures we don't skip over very small segments
var candidateLookupTolerance=Math.min(maxFragLookUpTolerance,candidate.duration+(candidate.deltaPTS?candidate.deltaPTS:0));if(candidate.start+candidate.duration-candidateLookupTolerance<=bufferEnd){return 1;}else if(candidate.start-candidateLookupTolerance>bufferEnd&&candidate.start){// if maxFragLookUpTolerance will have negative value then don't return -1 for first element
return-1;}return 0;}/**
			 * The test function used by the findFragmentByPdt's BinarySearch to look for the best match to the current buffer conditions.
			 * This function tests the candidate's program date time values, as represented in Unix time
			 * @param {*} candidate - The fragment to test
			 * @param {number} [pdtBufferEnd = 0] - The Unix time representing the end of the current buffered range
			 * @param {number} [maxFragLookUpTolerance = 0] - The amount of time that a fragment's start can be within in order to be considered contiguous
			 * @returns {boolean} True if contiguous, false otherwise
			 */function pdtWithinToleranceTest(pdtBufferEnd,maxFragLookUpTolerance,candidate){var candidateLookupTolerance=Math.min(maxFragLookUpTolerance,candidate.duration+(candidate.deltaPTS?candidate.deltaPTS:0))*1000;// endProgramDateTime can be null, default to zero
var endProgramDateTime=candidate.endProgramDateTime||0;return endProgramDateTime-candidateLookupTolerance>pdtBufferEnd;}function findFragWithCC(fragments,cc){return _utils_binary_search__WEBPACK_IMPORTED_MODULE_1__["default"].search(fragments,function(candidate){if(candidate.cc<cc){return 1;}else if(candidate.cc>cc){return-1;}else{return 0;}});}/***/},/***/"./src/controller/fragment-tracker.ts":/*!********************************************!*\
			  !*** ./src/controller/fragment-tracker.ts ***!
			  \********************************************/ /*! exports provided: FragmentState, FragmentTracker */ /***/function srcControllerFragmentTrackerTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"FragmentState",function(){return FragmentState;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"FragmentTracker",function(){return FragmentTracker;});/* harmony import */var _events__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../events */"./src/events.ts");/* harmony import */var _types_loader__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../types/loader */"./src/types/loader.ts");var FragmentState;(function(FragmentState){FragmentState["NOT_LOADED"]="NOT_LOADED";FragmentState["BACKTRACKED"]="BACKTRACKED";FragmentState["APPENDING"]="APPENDING";FragmentState["PARTIAL"]="PARTIAL";FragmentState["OK"]="OK";})(FragmentState||(FragmentState={}));var FragmentTracker=/*#__PURE__*/function(){function FragmentTracker(hls){this.activeFragment=null;this.activeParts=null;this.fragments=Object.create(null);this.timeRanges=Object.create(null);this.bufferPadding=0.2;this.hls=void 0;this.hls=hls;this._registerListeners();}var _proto=FragmentTracker.prototype;_proto._registerListeners=function _registerListeners(){var hls=this.hls;hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].BUFFER_APPENDED,this.onBufferAppended,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].FRAG_BUFFERED,this.onFragBuffered,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].FRAG_LOADED,this.onFragLoaded,this);};_proto._unregisterListeners=function _unregisterListeners(){var hls=this.hls;hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].BUFFER_APPENDED,this.onBufferAppended,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].FRAG_BUFFERED,this.onFragBuffered,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].FRAG_LOADED,this.onFragLoaded,this);};_proto.destroy=function destroy(){this._unregisterListeners();// @ts-ignore
this.fragments=this.timeRanges=null;}/**
			   * Return a Fragment with an appended range that matches the position and levelType.
			   * If not found any Fragment, return null
			   */;_proto.getAppendedFrag=function getAppendedFrag(position,levelType){if(levelType===_types_loader__WEBPACK_IMPORTED_MODULE_1__["PlaylistLevelType"].MAIN){var activeFragment=this.activeFragment,activeParts=this.activeParts;if(!activeFragment){return null;}if(activeParts){for(var i=activeParts.length;i--;){var activePart=activeParts[i];var appendedPTS=activePart?activePart.end:activeFragment.appendedPTS;if(activePart.start<=position&&appendedPTS!==undefined&&position<=appendedPTS){// 9 is a magic number. remove parts from lookup after a match but keep some short seeks back.
if(i>9){this.activeParts=activeParts.slice(i-9);}return activePart;}}}else if(activeFragment.start<=position&&activeFragment.appendedPTS!==undefined&&position<=activeFragment.appendedPTS){return activeFragment;}}return this.getBufferedFrag(position,levelType);}/**
			   * Return a buffered Fragment that matches the position and levelType.
			   * A buffered Fragment is one whose loading, parsing and appending is done (completed or "partial" meaning aborted).
			   * If not found any Fragment, return null
			   */;_proto.getBufferedFrag=function getBufferedFrag(position,levelType){var fragments=this.fragments;var keys=Object.keys(fragments);for(var i=keys.length;i--;){var fragmentEntity=fragments[keys[i]];if((fragmentEntity===null||fragmentEntity===void 0?void 0:fragmentEntity.body.type)===levelType&&fragmentEntity.buffered){var frag=fragmentEntity.body;if(frag.start<=position&&position<=frag.end){return frag;}}}return null;}/**
			   * Partial fragments effected by coded frame eviction will be removed
			   * The browser will unload parts of the buffer to free up memory for new buffer data
			   * Fragments will need to be reloaded when the buffer is freed up, removing partial fragments will allow them to reload(since there might be parts that are still playable)
			   */;_proto.detectEvictedFragments=function detectEvictedFragments(elementaryStream,timeRange,playlistType){var _this=this;// Check if any flagged fragments have been unloaded
Object.keys(this.fragments).forEach(function(key){var fragmentEntity=_this.fragments[key];if(!fragmentEntity){return;}if(!fragmentEntity.buffered){if(fragmentEntity.body.type===playlistType){_this.removeFragment(fragmentEntity.body);}return;}var esData=fragmentEntity.range[elementaryStream];if(!esData){return;}esData.time.some(function(time){var isNotBuffered=!_this.isTimeBuffered(time.startPTS,time.endPTS,timeRange);if(isNotBuffered){// Unregister partial fragment as it needs to load again to be reused
_this.removeFragment(fragmentEntity.body);}return isNotBuffered;});});}/**
			   * Checks if the fragment passed in is loaded in the buffer properly
			   * Partially loaded fragments will be registered as a partial fragment
			   */;_proto.detectPartialFragments=function detectPartialFragments(data){var _this2=this;var timeRanges=this.timeRanges;var frag=data.frag,part=data.part;if(!timeRanges||frag.sn==='initSegment'){return;}var fragKey=getFragmentKey(frag);var fragmentEntity=this.fragments[fragKey];if(!fragmentEntity){return;}Object.keys(timeRanges).forEach(function(elementaryStream){var streamInfo=frag.elementaryStreams[elementaryStream];if(!streamInfo){return;}var timeRange=timeRanges[elementaryStream];var partial=part!==null||streamInfo.partial===true;fragmentEntity.range[elementaryStream]=_this2.getBufferedTimes(frag,part,partial,timeRange);});fragmentEntity.backtrack=fragmentEntity.loaded=null;if(Object.keys(fragmentEntity.range).length){fragmentEntity.buffered=true;}else{// remove fragment if nothing was appended
this.removeFragment(fragmentEntity.body);}};_proto.fragBuffered=function fragBuffered(frag){var fragKey=getFragmentKey(frag);var fragmentEntity=this.fragments[fragKey];if(fragmentEntity){fragmentEntity.backtrack=fragmentEntity.loaded=null;fragmentEntity.buffered=true;}};_proto.getBufferedTimes=function getBufferedTimes(fragment,part,partial,timeRange){var buffered={time:[],partial:partial};var startPTS=part?part.start:fragment.start;var endPTS=part?part.end:fragment.end;var minEndPTS=fragment.minEndPTS||endPTS;var maxStartPTS=fragment.maxStartPTS||startPTS;for(var i=0;i<timeRange.length;i++){var startTime=timeRange.start(i)-this.bufferPadding;var endTime=timeRange.end(i)+this.bufferPadding;if(maxStartPTS>=startTime&&minEndPTS<=endTime){// Fragment is entirely contained in buffer
// No need to check the other timeRange times since it's completely playable
buffered.time.push({startPTS:Math.max(startPTS,timeRange.start(i)),endPTS:Math.min(endPTS,timeRange.end(i))});break;}else if(startPTS<endTime&&endPTS>startTime){buffered.partial=true;// Check for intersection with buffer
// Get playable sections of the fragment
buffered.time.push({startPTS:Math.max(startPTS,timeRange.start(i)),endPTS:Math.min(endPTS,timeRange.end(i))});}else if(endPTS<=startTime){// No need to check the rest of the timeRange as it is in order
break;}}return buffered;}/**
			   * Gets the partial fragment for a certain time
			   */;_proto.getPartialFragment=function getPartialFragment(time){var bestFragment=null;var timePadding;var startTime;var endTime;var bestOverlap=0;var bufferPadding=this.bufferPadding,fragments=this.fragments;Object.keys(fragments).forEach(function(key){var fragmentEntity=fragments[key];if(!fragmentEntity){return;}if(isPartial(fragmentEntity)){startTime=fragmentEntity.body.start-bufferPadding;endTime=fragmentEntity.body.end+bufferPadding;if(time>=startTime&&time<=endTime){// Use the fragment that has the most padding from start and end time
timePadding=Math.min(time-startTime,endTime-time);if(bestOverlap<=timePadding){bestFragment=fragmentEntity.body;bestOverlap=timePadding;}}}});return bestFragment;};_proto.getState=function getState(fragment){var fragKey=getFragmentKey(fragment);var fragmentEntity=this.fragments[fragKey];if(fragmentEntity){if(!fragmentEntity.buffered){if(fragmentEntity.backtrack){return FragmentState.BACKTRACKED;}return FragmentState.APPENDING;}else if(isPartial(fragmentEntity)){return FragmentState.PARTIAL;}else{return FragmentState.OK;}}return FragmentState.NOT_LOADED;};_proto.backtrack=function backtrack(frag,data){var fragKey=getFragmentKey(frag);var fragmentEntity=this.fragments[fragKey];if(!fragmentEntity||fragmentEntity.backtrack){return null;}var backtrack=fragmentEntity.backtrack=data?data:fragmentEntity.loaded;fragmentEntity.loaded=null;return backtrack;};_proto.getBacktrackData=function getBacktrackData(fragment){var fragKey=getFragmentKey(fragment);var fragmentEntity=this.fragments[fragKey];if(fragmentEntity){var _backtrack$payload;var backtrack=fragmentEntity.backtrack;// If data was already sent to Worker it is detached no longer available
if(backtrack!==null&&backtrack!==void 0&&(_backtrack$payload=backtrack.payload)!==null&&_backtrack$payload!==void 0&&_backtrack$payload.byteLength){return backtrack;}else{this.removeFragment(fragment);}}return null;};_proto.isTimeBuffered=function isTimeBuffered(startPTS,endPTS,timeRange){var startTime;var endTime;for(var i=0;i<timeRange.length;i++){startTime=timeRange.start(i)-this.bufferPadding;endTime=timeRange.end(i)+this.bufferPadding;if(startPTS>=startTime&&endPTS<=endTime){return true;}if(endPTS<=startTime){// No need to check the rest of the timeRange as it is in order
return false;}}return false;};_proto.onFragLoaded=function onFragLoaded(event,data){var frag=data.frag,part=data.part;// don't track initsegment (for which sn is not a number)
// don't track frags used for bitrateTest, they're irrelevant.
// don't track parts for memory efficiency
if(frag.sn==='initSegment'||frag.bitrateTest||part){return;}var fragKey=getFragmentKey(frag);this.fragments[fragKey]={body:frag,loaded:data,backtrack:null,buffered:false,range:Object.create(null)};};_proto.onBufferAppended=function onBufferAppended(event,data){var _this3=this;var frag=data.frag,part=data.part,timeRanges=data.timeRanges;if(frag.type===_types_loader__WEBPACK_IMPORTED_MODULE_1__["PlaylistLevelType"].MAIN){this.activeFragment=frag;if(part){var activeParts=this.activeParts;if(!activeParts){this.activeParts=activeParts=[];}activeParts.push(part);}else{this.activeParts=null;}}// Store the latest timeRanges loaded in the buffer
this.timeRanges=timeRanges;Object.keys(timeRanges).forEach(function(elementaryStream){var timeRange=timeRanges[elementaryStream];_this3.detectEvictedFragments(elementaryStream,timeRange);if(!part){for(var i=0;i<timeRange.length;i++){frag.appendedPTS=Math.max(timeRange.end(i),frag.appendedPTS||0);}}});};_proto.onFragBuffered=function onFragBuffered(event,data){this.detectPartialFragments(data);};_proto.hasFragment=function hasFragment(fragment){var fragKey=getFragmentKey(fragment);return!!this.fragments[fragKey];};_proto.removeFragmentsInRange=function removeFragmentsInRange(start,end,playlistType){var _this4=this;Object.keys(this.fragments).forEach(function(key){var fragmentEntity=_this4.fragments[key];if(!fragmentEntity){return;}if(fragmentEntity.buffered){var frag=fragmentEntity.body;if(frag.type===playlistType&&frag.start<end&&frag.end>start){_this4.removeFragment(frag);}}});};_proto.removeFragment=function removeFragment(fragment){var fragKey=getFragmentKey(fragment);fragment.stats.loaded=0;fragment.clearElementaryStreamInfo();delete this.fragments[fragKey];};_proto.removeAllFragments=function removeAllFragments(){this.fragments=Object.create(null);this.activeFragment=null;this.activeParts=null;};return FragmentTracker;}();function isPartial(fragmentEntity){var _fragmentEntity$range,_fragmentEntity$range2;return fragmentEntity.buffered&&(((_fragmentEntity$range=fragmentEntity.range.video)===null||_fragmentEntity$range===void 0?void 0:_fragmentEntity$range.partial)||((_fragmentEntity$range2=fragmentEntity.range.audio)===null||_fragmentEntity$range2===void 0?void 0:_fragmentEntity$range2.partial));}function getFragmentKey(fragment){return fragment.type+"_"+fragment.level+"_"+fragment.urlId+"_"+fragment.sn;}/***/},/***/"./src/controller/gap-controller.ts":/*!******************************************!*\
			  !*** ./src/controller/gap-controller.ts ***!
			  \******************************************/ /*! exports provided: STALL_MINIMUM_DURATION_MS, MAX_START_GAP_JUMP, SKIP_BUFFER_HOLE_STEP_SECONDS, SKIP_BUFFER_RANGE_START, default */ /***/function srcControllerGapControllerTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"STALL_MINIMUM_DURATION_MS",function(){return STALL_MINIMUM_DURATION_MS;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"MAX_START_GAP_JUMP",function(){return MAX_START_GAP_JUMP;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return SKIP_BUFFER_HOLE_STEP_SECONDS;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"SKIP_BUFFER_RANGE_START",function(){return SKIP_BUFFER_RANGE_START;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"default",function(){return GapController;});/* harmony import */var _utils_buffer_helper__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts");/* harmony import */var _errors__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../errors */"./src/errors.ts");/* harmony import */var _events__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../events */"./src/events.ts");/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ../utils/logger */"./src/utils/logger.ts");var STALL_MINIMUM_DURATION_MS=250;var MAX_START_GAP_JUMP=2.0;var SKIP_BUFFER_HOLE_STEP_SECONDS=0.1;var SKIP_BUFFER_RANGE_START=0.05;var GapController=/*#__PURE__*/function(){function GapController(config,media,fragmentTracker,hls){this.config=void 0;this.media=void 0;this.fragmentTracker=void 0;this.hls=void 0;this.nudgeRetry=0;this.stallReported=false;this.stalled=null;this.moved=false;this.seeking=false;this.config=config;this.media=media;this.fragmentTracker=fragmentTracker;this.hls=hls;}var _proto=GapController.prototype;_proto.destroy=function destroy(){// @ts-ignore
this.hls=this.fragmentTracker=this.media=null;}/**
			   * Checks if the playhead is stuck within a gap, and if so, attempts to free it.
			   * A gap is an unbuffered range between two buffered ranges (or the start and the first buffered range).
			   *
			   * @param {number} lastCurrentTime Previously read playhead position
			   */;_proto.poll=function poll(lastCurrentTime){var config=this.config,media=this.media,stalled=this.stalled;var currentTime=media.currentTime,seeking=media.seeking;var seeked=this.seeking&&!seeking;var beginSeek=!this.seeking&&seeking;this.seeking=seeking;// The playhead is moving, no-op
if(currentTime!==lastCurrentTime){this.moved=true;if(stalled!==null){// The playhead is now moving, but was previously stalled
if(this.stallReported){var _stalledDuration=self.performance.now()-stalled;_utils_logger__WEBPACK_IMPORTED_MODULE_3__["logger"].warn("playback not stuck anymore @"+currentTime+", after "+Math.round(_stalledDuration)+"ms");this.stallReported=false;}this.stalled=null;this.nudgeRetry=0;}return;}// Clear stalled state when beginning or finishing seeking so that we don't report stalls coming out of a seek
if(beginSeek||seeked){this.stalled=null;}// The playhead should not be moving
if(media.paused||media.ended||media.playbackRate===0||!_utils_buffer_helper__WEBPACK_IMPORTED_MODULE_0__["BufferHelper"].getBuffered(media).length){return;}var bufferInfo=_utils_buffer_helper__WEBPACK_IMPORTED_MODULE_0__["BufferHelper"].bufferInfo(media,currentTime,0);var isBuffered=bufferInfo.len>0;var nextStart=bufferInfo.nextStart||0;// There is no playable buffer (seeked, waiting for buffer)
if(!isBuffered&&!nextStart){return;}if(seeking){// Waiting for seeking in a buffered range to complete
var hasEnoughBuffer=bufferInfo.len>MAX_START_GAP_JUMP;// Next buffered range is too far ahead to jump to while still seeking
var noBufferGap=!nextStart||nextStart-currentTime>MAX_START_GAP_JUMP&&!this.fragmentTracker.getPartialFragment(currentTime);if(hasEnoughBuffer||noBufferGap){return;}// Reset moved state when seeking to a point in or before a gap
this.moved=false;}// Skip start gaps if we haven't played, but the last poll detected the start of a stall
// The addition poll gives the browser a chance to jump the gap for us
if(!this.moved&&this.stalled!==null){var _level$details;// Jump start gaps within jump threshold
var startJump=Math.max(nextStart,bufferInfo.start||0)-currentTime;// When joining a live stream with audio tracks, account for live playlist window sliding by allowing
// a larger jump over start gaps caused by the audio-stream-controller buffering a start fragment
// that begins over 1 target duration after the video start position.
var level=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null;var isLive=level===null||level===void 0?void 0:(_level$details=level.details)===null||_level$details===void 0?void 0:_level$details.live;var maxStartGapJump=isLive?level.details.targetduration*2:MAX_START_GAP_JUMP;if(startJump>0&&startJump<=maxStartGapJump){this._trySkipBufferHole(null);return;}}// Start tracking stall time
var tnow=self.performance.now();if(stalled===null){this.stalled=tnow;return;}var stalledDuration=tnow-stalled;if(!seeking&&stalledDuration>=STALL_MINIMUM_DURATION_MS){// Report stalling after trying to fix
this._reportStall(bufferInfo.len);}var bufferedWithHoles=_utils_buffer_helper__WEBPACK_IMPORTED_MODULE_0__["BufferHelper"].bufferInfo(media,currentTime,config.maxBufferHole);this._tryFixBufferStall(bufferedWithHoles,stalledDuration);}/**
			   * Detects and attempts to fix known buffer stalling issues.
			   * @param bufferInfo - The properties of the current buffer.
			   * @param stalledDurationMs - The amount of time Hls.js has been stalling for.
			   * @private
			   */;_proto._tryFixBufferStall=function _tryFixBufferStall(bufferInfo,stalledDurationMs){var config=this.config,fragmentTracker=this.fragmentTracker,media=this.media;var currentTime=media.currentTime;var partial=fragmentTracker.getPartialFragment(currentTime);if(partial){// Try to skip over the buffer hole caused by a partial fragment
// This method isn't limited by the size of the gap between buffered ranges
var targetTime=this._trySkipBufferHole(partial);// we return here in this case, meaning
// the branch below only executes when we don't handle a partial fragment
if(targetTime){return;}}// if we haven't had to skip over a buffer hole of a partial fragment
// we may just have to "nudge" the playlist as the browser decoding/rendering engine
// needs to cross some sort of threshold covering all source-buffers content
// to start playing properly.
if(bufferInfo.len>config.maxBufferHole&&stalledDurationMs>config.highBufferWatchdogPeriod*1000){_utils_logger__WEBPACK_IMPORTED_MODULE_3__["logger"].warn('Trying to nudge playhead over buffer-hole');// Try to nudge currentTime over a buffer hole if we've been stalling for the configured amount of seconds
// We only try to jump the hole if it's under the configured size
// Reset stalled so to rearm watchdog timer
this.stalled=null;this._tryNudgeBuffer();}}/**
			   * Triggers a BUFFER_STALLED_ERROR event, but only once per stall period.
			   * @param bufferLen - The playhead distance from the end of the current buffer segment.
			   * @private
			   */;_proto._reportStall=function _reportStall(bufferLen){var hls=this.hls,media=this.media,stallReported=this.stallReported;if(!stallReported){// Report stalled error once
this.stallReported=true;_utils_logger__WEBPACK_IMPORTED_MODULE_3__["logger"].warn("Playback stalling at @"+media.currentTime+" due to low buffer (buffer="+bufferLen+")");hls.trigger(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].ERROR,{type:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorTypes"].MEDIA_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorDetails"].BUFFER_STALLED_ERROR,fatal:false,buffer:bufferLen});}}/**
			   * Attempts to fix buffer stalls by jumping over known gaps caused by partial fragments
			   * @param partial - The partial fragment found at the current time (where playback is stalling).
			   * @private
			   */;_proto._trySkipBufferHole=function _trySkipBufferHole(partial){var config=this.config,hls=this.hls,media=this.media;var currentTime=media.currentTime;var lastEndTime=0;// Check if currentTime is between unbuffered regions of partial fragments
var buffered=_utils_buffer_helper__WEBPACK_IMPORTED_MODULE_0__["BufferHelper"].getBuffered(media);for(var i=0;i<buffered.length;i++){var startTime=buffered.start(i);if(currentTime+config.maxBufferHole>=lastEndTime&&currentTime<startTime){var targetTime=Math.max(startTime+SKIP_BUFFER_RANGE_START,media.currentTime+SKIP_BUFFER_HOLE_STEP_SECONDS);_utils_logger__WEBPACK_IMPORTED_MODULE_3__["logger"].warn("skipping hole, adjusting currentTime from "+currentTime+" to "+targetTime);this.moved=true;this.stalled=null;media.currentTime=targetTime;if(partial){hls.trigger(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].ERROR,{type:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorTypes"].MEDIA_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorDetails"].BUFFER_SEEK_OVER_HOLE,fatal:false,reason:"fragment loaded with buffer holes, seeking from "+currentTime+" to "+targetTime,frag:partial});}return targetTime;}lastEndTime=buffered.end(i);}return 0;}/**
			   * Attempts to fix buffer stalls by advancing the mediaElement's current time by a small amount.
			   * @private
			   */;_proto._tryNudgeBuffer=function _tryNudgeBuffer(){var config=this.config,hls=this.hls,media=this.media;var currentTime=media.currentTime;var nudgeRetry=(this.nudgeRetry||0)+1;this.nudgeRetry=nudgeRetry;if(nudgeRetry<config.nudgeMaxRetry){var targetTime=currentTime+nudgeRetry*config.nudgeOffset;// playback stalled in buffered area ... let's nudge currentTime to try to overcome this
_utils_logger__WEBPACK_IMPORTED_MODULE_3__["logger"].warn("Nudging 'currentTime' from "+currentTime+" to "+targetTime);media.currentTime=targetTime;hls.trigger(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].ERROR,{type:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorTypes"].MEDIA_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorDetails"].BUFFER_NUDGE_ON_STALL,fatal:false});}else{_utils_logger__WEBPACK_IMPORTED_MODULE_3__["logger"].error("Playhead still not moving while enough data buffered @"+currentTime+" after "+config.nudgeMaxRetry+" nudges");hls.trigger(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].ERROR,{type:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorTypes"].MEDIA_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorDetails"].BUFFER_STALLED_ERROR,fatal:true});}};return GapController;}();/***/},/***/"./src/controller/id3-track-controller.ts":/*!************************************************!*\
			  !*** ./src/controller/id3-track-controller.ts ***!
			  \************************************************/ /*! exports provided: default */ /***/function srcControllerId3TrackControllerTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var _events__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../events */"./src/events.ts");/* harmony import */var _utils_texttrack_utils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../utils/texttrack-utils */"./src/utils/texttrack-utils.ts");/* harmony import */var _demux_id3__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../demux/id3 */"./src/demux/id3.ts");var MIN_CUE_DURATION=0.25;var ID3TrackController=/*#__PURE__*/function(){function ID3TrackController(hls){this.hls=void 0;this.id3Track=null;this.media=null;this.hls=hls;this._registerListeners();}var _proto=ID3TrackController.prototype;_proto.destroy=function destroy(){this._unregisterListeners();};_proto._registerListeners=function _registerListeners(){var hls=this.hls;hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MEDIA_ATTACHED,this.onMediaAttached,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].FRAG_PARSING_METADATA,this.onFragParsingMetadata,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].BUFFER_FLUSHING,this.onBufferFlushing,this);};_proto._unregisterListeners=function _unregisterListeners(){var hls=this.hls;hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MEDIA_ATTACHED,this.onMediaAttached,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].FRAG_PARSING_METADATA,this.onFragParsingMetadata,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].BUFFER_FLUSHING,this.onBufferFlushing,this);}// Add ID3 metatadata text track.
;_proto.onMediaAttached=function onMediaAttached(event,data){this.media=data.media;};_proto.onMediaDetaching=function onMediaDetaching(){if(!this.id3Track){return;}Object(_utils_texttrack_utils__WEBPACK_IMPORTED_MODULE_1__["clearCurrentCues"])(this.id3Track);this.id3Track=null;this.media=null;};_proto.getID3Track=function getID3Track(textTracks){if(!this.media){return;}for(var i=0;i<textTracks.length;i++){var textTrack=textTracks[i];if(textTrack.kind==='metadata'&&textTrack.label==='id3'){// send 'addtrack' when reusing the textTrack for metadata,
// same as what we do for captions
Object(_utils_texttrack_utils__WEBPACK_IMPORTED_MODULE_1__["sendAddTrackEvent"])(textTrack,this.media);return textTrack;}}return this.media.addTextTrack('metadata','id3');};_proto.onFragParsingMetadata=function onFragParsingMetadata(event,data){if(!this.media){return;}var fragment=data.frag;var samples=data.samples;// create track dynamically
if(!this.id3Track){this.id3Track=this.getID3Track(this.media.textTracks);this.id3Track.mode='hidden';}// Attempt to recreate Safari functionality by creating
// WebKitDataCue objects when available and store the decoded
// ID3 data in the value property of the cue
var Cue=self.WebKitDataCue||self.VTTCue||self.TextTrackCue;for(var i=0;i<samples.length;i++){var frames=_demux_id3__WEBPACK_IMPORTED_MODULE_2__["getID3Frames"](samples[i].data);if(frames){var startTime=samples[i].pts;var endTime=i<samples.length-1?samples[i+1].pts:fragment.end;var timeDiff=endTime-startTime;if(timeDiff<=0){endTime=startTime+MIN_CUE_DURATION;}for(var j=0;j<frames.length;j++){var frame=frames[j];// Safari doesn't put the timestamp frame in the TextTrack
if(!_demux_id3__WEBPACK_IMPORTED_MODULE_2__["isTimeStampFrame"](frame)){var cue=new Cue(startTime,endTime,'');cue.value=frame;this.id3Track.addCue(cue);}}}}};_proto.onBufferFlushing=function onBufferFlushing(event,_ref){var startOffset=_ref.startOffset,endOffset=_ref.endOffset,type=_ref.type;if(!type||type==='audio'){// id3 cues come from parsed audio only remove cues when audio buffer is cleared
var id3Track=this.id3Track;if(id3Track){Object(_utils_texttrack_utils__WEBPACK_IMPORTED_MODULE_1__["removeCuesInRange"])(id3Track,startOffset,endOffset);}}};return ID3TrackController;}();/* harmony default export */__webpack_exports__["default"]=ID3TrackController;/***/},/***/"./src/controller/latency-controller.ts":/*!**********************************************!*\
			  !*** ./src/controller/latency-controller.ts ***!
			  \**********************************************/ /*! exports provided: default */ /***/function srcControllerLatencyControllerTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"default",function(){return LatencyController;});/* harmony import */var _errors__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../errors */"./src/errors.ts");/* harmony import */var _events__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../events */"./src/events.ts");/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../utils/logger */"./src/utils/logger.ts");function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}var LatencyController=/*#__PURE__*/function(){function LatencyController(hls){var _this=this;this.hls=void 0;this.config=void 0;this.media=null;this.levelDetails=null;this.currentTime=0;this.stallCount=0;this._latency=null;this.timeupdateHandler=function(){return _this.timeupdate();};this.hls=hls;this.config=hls.config;this.registerListeners();}var _proto=LatencyController.prototype;_proto.destroy=function destroy(){this.unregisterListeners();this.onMediaDetaching();this.levelDetails=null;// @ts-ignore
this.hls=this.timeupdateHandler=null;};_proto.registerListeners=function registerListeners(){this.hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].MEDIA_ATTACHED,this.onMediaAttached,this);this.hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);this.hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].MANIFEST_LOADING,this.onManifestLoading,this);this.hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].LEVEL_UPDATED,this.onLevelUpdated,this);this.hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].ERROR,this.onError,this);};_proto.unregisterListeners=function unregisterListeners(){this.hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].MEDIA_ATTACHED,this.onMediaAttached);this.hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].MEDIA_DETACHING,this.onMediaDetaching);this.hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].MANIFEST_LOADING,this.onManifestLoading);this.hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].LEVEL_UPDATED,this.onLevelUpdated);this.hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].ERROR,this.onError);};_proto.onMediaAttached=function onMediaAttached(event,data){this.media=data.media;this.media.addEventListener('timeupdate',this.timeupdateHandler);};_proto.onMediaDetaching=function onMediaDetaching(){if(this.media){this.media.removeEventListener('timeupdate',this.timeupdateHandler);this.media=null;}};_proto.onManifestLoading=function onManifestLoading(){this.levelDetails=null;this._latency=null;this.stallCount=0;};_proto.onLevelUpdated=function onLevelUpdated(event,_ref){var details=_ref.details;this.levelDetails=details;if(details.advanced){this.timeupdate();}if(!details.live&&this.media){this.media.removeEventListener('timeupdate',this.timeupdateHandler);}};_proto.onError=function onError(event,data){if(data.details!==_errors__WEBPACK_IMPORTED_MODULE_0__["ErrorDetails"].BUFFER_STALLED_ERROR){return;}this.stallCount++;_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].warn('[playback-rate-controller]: Stall detected, adjusting target latency');};_proto.timeupdate=function timeupdate(){var media=this.media,levelDetails=this.levelDetails;if(!media||!levelDetails){return;}this.currentTime=media.currentTime;var latency=this.computeLatency();if(latency===null){return;}this._latency=latency;// Adapt playbackRate to meet target latency in low-latency mode
var _this$config=this.config,lowLatencyMode=_this$config.lowLatencyMode,maxLiveSyncPlaybackRate=_this$config.maxLiveSyncPlaybackRate;if(!lowLatencyMode||maxLiveSyncPlaybackRate===1){return;}var targetLatency=this.targetLatency;if(targetLatency===null){return;}var distanceFromTarget=latency-targetLatency;// Only adjust playbackRate when within one target duration of targetLatency
// and more than one second from under-buffering.
// Playback further than one target duration from target can be considered DVR playback.
var liveMinLatencyDuration=Math.min(this.maxLatency,targetLatency+levelDetails.targetduration);var inLiveRange=distanceFromTarget<liveMinLatencyDuration;if(levelDetails.live&&inLiveRange&&distanceFromTarget>0.05&&this.forwardBufferLength>1){var max=Math.min(2,Math.max(1.0,maxLiveSyncPlaybackRate));var rate=Math.round(2/(1+Math.exp(-0.75*distanceFromTarget-this.edgeStalled))*20)/20;media.playbackRate=Math.min(max,Math.max(1,rate));}else if(media.playbackRate!==1&&media.playbackRate!==0){media.playbackRate=1;}};_proto.estimateLiveEdge=function estimateLiveEdge(){var levelDetails=this.levelDetails;if(levelDetails===null){return null;}return levelDetails.edge+levelDetails.age;};_proto.computeLatency=function computeLatency(){var liveEdge=this.estimateLiveEdge();if(liveEdge===null){return null;}return liveEdge-this.currentTime;};_createClass(LatencyController,[{key:"latency",get:function get(){return this._latency||0;}},{key:"maxLatency",get:function get(){var config=this.config,levelDetails=this.levelDetails;if(config.liveMaxLatencyDuration!==undefined){return config.liveMaxLatencyDuration;}return levelDetails?config.liveMaxLatencyDurationCount*levelDetails.targetduration:0;}},{key:"targetLatency",get:function get(){var levelDetails=this.levelDetails;if(levelDetails===null){return null;}var holdBack=levelDetails.holdBack,partHoldBack=levelDetails.partHoldBack,targetduration=levelDetails.targetduration;var _this$config2=this.config,liveSyncDuration=_this$config2.liveSyncDuration,liveSyncDurationCount=_this$config2.liveSyncDurationCount,lowLatencyMode=_this$config2.lowLatencyMode;var userConfig=this.hls.userConfig;var targetLatency=lowLatencyMode?partHoldBack||holdBack:holdBack;if(userConfig.liveSyncDuration||userConfig.liveSyncDurationCount||targetLatency===0){targetLatency=liveSyncDuration!==undefined?liveSyncDuration:liveSyncDurationCount*targetduration;}var maxLiveSyncOnStallIncrease=targetduration;var liveSyncOnStallIncrease=1.0;return targetLatency+Math.min(this.stallCount*liveSyncOnStallIncrease,maxLiveSyncOnStallIncrease);}},{key:"liveSyncPosition",get:function get(){var liveEdge=this.estimateLiveEdge();var targetLatency=this.targetLatency;var levelDetails=this.levelDetails;if(liveEdge===null||targetLatency===null||levelDetails===null){return null;}var edge=levelDetails.edge;var syncPosition=liveEdge-targetLatency-this.edgeStalled;var min=edge-levelDetails.totalduration;var max=edge-(this.config.lowLatencyMode&&levelDetails.partTarget||levelDetails.targetduration);return Math.min(Math.max(min,syncPosition),max);}},{key:"drift",get:function get(){var levelDetails=this.levelDetails;if(levelDetails===null){return 1;}return levelDetails.drift;}},{key:"edgeStalled",get:function get(){var levelDetails=this.levelDetails;if(levelDetails===null){return 0;}var maxLevelUpdateAge=(this.config.lowLatencyMode&&levelDetails.partTarget||levelDetails.targetduration)*3;return Math.max(levelDetails.age-maxLevelUpdateAge,0);}},{key:"forwardBufferLength",get:function get(){var media=this.media,levelDetails=this.levelDetails;if(!media||!levelDetails){return 0;}var bufferedRanges=media.buffered.length;return bufferedRanges?media.buffered.end(bufferedRanges-1):levelDetails.edge-this.currentTime;}}]);return LatencyController;}();/***/},/***/"./src/controller/level-controller.ts":/*!********************************************!*\
			  !*** ./src/controller/level-controller.ts ***!
			  \********************************************/ /*! exports provided: default */ /***/function srcControllerLevelControllerTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"default",function(){return LevelController;});/* harmony import */var _types_level__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../types/level */"./src/types/level.ts");/* harmony import */var _events__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../events */"./src/events.ts");/* harmony import */var _errors__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../errors */"./src/errors.ts");/* harmony import */var _utils_codecs__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ../utils/codecs */"./src/utils/codecs.ts");/* harmony import */var _level_helper__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(/*! ./level-helper */"./src/controller/level-helper.ts");/* harmony import */var _base_playlist_controller__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(/*! ./base-playlist-controller */"./src/controller/base-playlist-controller.ts");/* harmony import */var _types_loader__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(/*! ../types/loader */"./src/types/loader.ts");function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};return _extends.apply(this,arguments);}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype);subClass.prototype.constructor=subClass;_setPrototypeOf(subClass,superClass);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}/*
			 * Level Controller
			 */var chromeOrFirefox=/chrome|firefox/.test(navigator.userAgent.toLowerCase());var LevelController=/*#__PURE__*/function(_BasePlaylistControll){_inheritsLoose(LevelController,_BasePlaylistControll);function LevelController(hls){var _this;_this=_BasePlaylistControll.call(this,hls,'[level-controller]')||this;_this._levels=[];_this._firstLevel=-1;_this._startLevel=void 0;_this.currentLevelIndex=-1;_this.manualLevelIndex=-1;_this.onParsedComplete=void 0;_this._registerListeners();return _this;}var _proto=LevelController.prototype;_proto._registerListeners=function _registerListeners(){var hls=this.hls;hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].MANIFEST_LOADED,this.onManifestLoaded,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].LEVEL_LOADED,this.onLevelLoaded,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].FRAG_LOADED,this.onFragLoaded,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].ERROR,this.onError,this);};_proto._unregisterListeners=function _unregisterListeners(){var hls=this.hls;hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].MANIFEST_LOADED,this.onManifestLoaded,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].LEVEL_LOADED,this.onLevelLoaded,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].FRAG_LOADED,this.onFragLoaded,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].ERROR,this.onError,this);};_proto.destroy=function destroy(){this._unregisterListeners();this.manualLevelIndex=-1;this._levels.length=0;_BasePlaylistControll.prototype.destroy.call(this);};_proto.startLoad=function startLoad(){var levels=this._levels;// clean up live level details to force reload them, and reset load errors
levels.forEach(function(level){level.loadError=0;});_BasePlaylistControll.prototype.startLoad.call(this);};_proto.onManifestLoaded=function onManifestLoaded(event,data){var levels=[];var audioTracks=[];var subtitleTracks=[];var bitrateStart;var levelSet={};var levelFromSet;var resolutionFound=false;var videoCodecFound=false;var audioCodecFound=false;// regroup redundant levels together
data.levels.forEach(function(levelParsed){var attributes=levelParsed.attrs;resolutionFound=resolutionFound||!!(levelParsed.width&&levelParsed.height);videoCodecFound=videoCodecFound||!!levelParsed.videoCodec;audioCodecFound=audioCodecFound||!!levelParsed.audioCodec;// erase audio codec info if browser does not support mp4a.40.34.
// demuxer will autodetect codec and fallback to mpeg/audio
if(chromeOrFirefox&&levelParsed.audioCodec&&levelParsed.audioCodec.indexOf('mp4a.40.34')!==-1){levelParsed.audioCodec=undefined;}var levelKey=levelParsed.bitrate+"-"+levelParsed.attrs.RESOLUTION+"-"+levelParsed.attrs.CODECS;levelFromSet=levelSet[levelKey];if(!levelFromSet){levelFromSet=new _types_level__WEBPACK_IMPORTED_MODULE_0__["Level"](levelParsed);levelSet[levelKey]=levelFromSet;levels.push(levelFromSet);}else{levelFromSet.url.push(levelParsed.url);}if(attributes){if(attributes.AUDIO){Object(_level_helper__WEBPACK_IMPORTED_MODULE_4__["addGroupId"])(levelFromSet,'audio',attributes.AUDIO);}if(attributes.SUBTITLES){Object(_level_helper__WEBPACK_IMPORTED_MODULE_4__["addGroupId"])(levelFromSet,'text',attributes.SUBTITLES);}}});// remove audio-only level if we also have levels with video codecs or RESOLUTION signalled
if((resolutionFound||videoCodecFound)&&audioCodecFound){levels=levels.filter(function(_ref){var videoCodec=_ref.videoCodec,width=_ref.width,height=_ref.height;return!!videoCodec||!!(width&&height);});}// only keep levels with supported audio/video codecs
levels=levels.filter(function(_ref2){var audioCodec=_ref2.audioCodec,videoCodec=_ref2.videoCodec;return(!audioCodec||Object(_utils_codecs__WEBPACK_IMPORTED_MODULE_3__["isCodecSupportedInMp4"])(audioCodec,'audio'))&&(!videoCodec||Object(_utils_codecs__WEBPACK_IMPORTED_MODULE_3__["isCodecSupportedInMp4"])(videoCodec,'video'));});if(data.audioTracks){audioTracks=data.audioTracks.filter(function(track){return!track.audioCodec||Object(_utils_codecs__WEBPACK_IMPORTED_MODULE_3__["isCodecSupportedInMp4"])(track.audioCodec,'audio');});// Assign ids after filtering as array indices by group-id
Object(_level_helper__WEBPACK_IMPORTED_MODULE_4__["assignTrackIdsByGroup"])(audioTracks);}if(data.subtitles){subtitleTracks=data.subtitles;Object(_level_helper__WEBPACK_IMPORTED_MODULE_4__["assignTrackIdsByGroup"])(subtitleTracks);}if(levels.length>0){// start bitrate is the first bitrate of the manifest
bitrateStart=levels[0].bitrate;// sort level on bitrate
levels.sort(function(a,b){return a.bitrate-b.bitrate;});this._levels=levels;// find index of first level in sorted levels
for(var i=0;i<levels.length;i++){if(levels[i].bitrate===bitrateStart){this._firstLevel=i;this.log("manifest loaded, "+levels.length+" level(s) found, first bitrate: "+bitrateStart);break;}}// Audio is only alternate if manifest include a URI along with the audio group tag,
// and this is not an audio-only stream where levels contain audio-only
var audioOnly=audioCodecFound&&!videoCodecFound;var edata={levels:levels,audioTracks:audioTracks,subtitleTracks:subtitleTracks,firstLevel:this._firstLevel,stats:data.stats,audio:audioCodecFound,video:videoCodecFound,altAudio:!audioOnly&&audioTracks.some(function(t){return!!t.url;})};this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].MANIFEST_PARSED,edata);// Initiate loading after all controllers have received MANIFEST_PARSED
if(this.hls.config.autoStartLoad||this.hls.forceStartLoad){this.hls.startLoad(this.hls.config.startPosition);}}else{this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].ERROR,{type:_errors__WEBPACK_IMPORTED_MODULE_2__["ErrorTypes"].MEDIA_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_2__["ErrorDetails"].MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:true,url:data.url,reason:'no level with compatible codecs found in manifest'});}};_proto.onError=function onError(event,data){_BasePlaylistControll.prototype.onError.call(this,event,data);if(data.fatal){return;}// Switch to redundant level when track fails to load
var context=data.context;var level=this._levels[this.currentLevelIndex];if(context&&(context.type===_types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistContextType"].AUDIO_TRACK&&level.audioGroupIds&&context.groupId===level.audioGroupIds[level.urlId]||context.type===_types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistContextType"].SUBTITLE_TRACK&&level.textGroupIds&&context.groupId===level.textGroupIds[level.urlId])){this.redundantFailover(this.currentLevelIndex);return;}var levelError=false;var levelSwitch=true;var levelIndex;// try to recover not fatal errors
switch(data.details){case _errors__WEBPACK_IMPORTED_MODULE_2__["ErrorDetails"].FRAG_LOAD_ERROR:case _errors__WEBPACK_IMPORTED_MODULE_2__["ErrorDetails"].FRAG_LOAD_TIMEOUT:case _errors__WEBPACK_IMPORTED_MODULE_2__["ErrorDetails"].KEY_LOAD_ERROR:case _errors__WEBPACK_IMPORTED_MODULE_2__["ErrorDetails"].KEY_LOAD_TIMEOUT:if(data.frag){var _level=this._levels[data.frag.level];// Set levelIndex when we're out of fragment retries
if(_level){_level.fragmentError++;if(_level.fragmentError>this.hls.config.fragLoadingMaxRetry){levelIndex=data.frag.level;}}else{levelIndex=data.frag.level;}}break;case _errors__WEBPACK_IMPORTED_MODULE_2__["ErrorDetails"].LEVEL_LOAD_ERROR:case _errors__WEBPACK_IMPORTED_MODULE_2__["ErrorDetails"].LEVEL_LOAD_TIMEOUT:// Do not perform level switch if an error occurred using delivery directives
// Attempt to reload level without directives first
if(context){if(context.deliveryDirectives){levelSwitch=false;}levelIndex=context.level;}levelError=true;break;case _errors__WEBPACK_IMPORTED_MODULE_2__["ErrorDetails"].REMUX_ALLOC_ERROR:levelIndex=data.level;levelError=true;break;}if(levelIndex!==undefined){this.recoverLevel(data,levelIndex,levelError,levelSwitch);}}/**
			   * Switch to a redundant stream if any available.
			   * If redundant stream is not available, emergency switch down if ABR mode is enabled.
			   */;_proto.recoverLevel=function recoverLevel(errorEvent,levelIndex,levelError,levelSwitch){var errorDetails=errorEvent.details;var level=this._levels[levelIndex];level.loadError++;if(levelError){var retrying=this.retryLoadingOrFail(errorEvent);if(retrying){// boolean used to inform stream controller not to switch back to IDLE on non fatal error
errorEvent.levelRetry=true;}else{this.currentLevelIndex=-1;return;}}if(levelSwitch){var redundantLevels=level.url.length;// Try redundant fail-over until level.loadError reaches redundantLevels
if(redundantLevels>1&&level.loadError<redundantLevels){errorEvent.levelRetry=true;this.redundantFailover(levelIndex);}else if(this.manualLevelIndex===-1){// Search for available level in auto level selection mode, cycling from highest to lowest bitrate
var nextLevel=levelIndex===0?this._levels.length-1:levelIndex-1;if(this.currentLevelIndex!==nextLevel&&this._levels[nextLevel].loadError===0){this.warn(errorDetails+": switch to "+nextLevel);errorEvent.levelRetry=true;this.hls.nextAutoLevel=nextLevel;}}}};_proto.redundantFailover=function redundantFailover(levelIndex){var level=this._levels[levelIndex];var redundantLevels=level.url.length;if(redundantLevels>1){// Update the url id of all levels so that we stay on the same set of variants when level switching
var newUrlId=(level.urlId+1)%redundantLevels;this.warn("Switching to redundant URL-id "+newUrlId);this._levels.forEach(function(level){level.urlId=newUrlId;});this.level=levelIndex;}}// reset errors on the successful load of a fragment
;_proto.onFragLoaded=function onFragLoaded(event,_ref3){var frag=_ref3.frag;if(frag!==undefined&&frag.type===_types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistLevelType"].MAIN){var level=this._levels[frag.level];if(level!==undefined){level.fragmentError=0;level.loadError=0;}}};_proto.onLevelLoaded=function onLevelLoaded(event,data){var _data$deliveryDirecti2;var level=data.level,details=data.details;var curLevel=this._levels[level];if(!curLevel){var _data$deliveryDirecti;this.warn("Invalid level index "+level);if((_data$deliveryDirecti=data.deliveryDirectives)!==null&&_data$deliveryDirecti!==void 0&&_data$deliveryDirecti.skip){details.deltaUpdateFailed=true;}return;}// only process level loaded events matching with expected level
if(level===this.currentLevelIndex){// reset level load error counter on successful level loaded only if there is no issues with fragments
if(curLevel.fragmentError===0){curLevel.loadError=0;this.retryCount=0;}this.playlistLoaded(level,data,curLevel.details);}else if((_data$deliveryDirecti2=data.deliveryDirectives)!==null&&_data$deliveryDirecti2!==void 0&&_data$deliveryDirecti2.skip){// received a delta playlist update that cannot be merged
details.deltaUpdateFailed=true;}};_proto.onAudioTrackSwitched=function onAudioTrackSwitched(event,data){var currentLevel=this.hls.levels[this.currentLevelIndex];if(!currentLevel){return;}if(currentLevel.audioGroupIds){var urlId=-1;var audioGroupId=this.hls.audioTracks[data.id].groupId;for(var i=0;i<currentLevel.audioGroupIds.length;i++){if(currentLevel.audioGroupIds[i]===audioGroupId){urlId=i;break;}}if(urlId!==currentLevel.urlId){currentLevel.urlId=urlId;this.startLoad();}}};_proto.loadPlaylist=function loadPlaylist(hlsUrlParameters){var level=this.currentLevelIndex;var currentLevel=this._levels[level];if(this.canLoad&&currentLevel&&currentLevel.url.length>0){var id=currentLevel.urlId;var url=currentLevel.url[id];if(hlsUrlParameters){try{url=hlsUrlParameters.addDirectives(url);}catch(error){this.warn("Could not construct new URL with HLS Delivery Directives: "+error);}}this.log("Attempt loading level index "+level+(hlsUrlParameters?' at sn '+hlsUrlParameters.msn+' part '+hlsUrlParameters.part:'')+" with URL-id "+id+" "+url);// console.log('Current audio track group ID:', this.hls.audioTracks[this.hls.audioTrack].groupId);
// console.log('New video quality level audio group id:', levelObject.attrs.AUDIO, level);
this.clearTimer();this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].LEVEL_LOADING,{url:url,level:level,id:id,deliveryDirectives:hlsUrlParameters||null});}};_proto.removeLevel=function removeLevel(levelIndex,urlId){var filterLevelAndGroupByIdIndex=function filterLevelAndGroupByIdIndex(url,id){return id!==urlId;};var levels=this._levels.filter(function(level,index){if(index!==levelIndex){return true;}if(level.url.length>1&&urlId!==undefined){level.url=level.url.filter(filterLevelAndGroupByIdIndex);if(level.audioGroupIds){level.audioGroupIds=level.audioGroupIds.filter(filterLevelAndGroupByIdIndex);}if(level.textGroupIds){level.textGroupIds=level.textGroupIds.filter(filterLevelAndGroupByIdIndex);}level.urlId=0;return true;}return false;}).map(function(level,index){var details=level.details;if(details!==null&&details!==void 0&&details.fragments){details.fragments.forEach(function(fragment){fragment.level=index;});}return level;});this._levels=levels;this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].LEVELS_UPDATED,{levels:levels});};_createClass(LevelController,[{key:"levels",get:function get(){if(this._levels.length===0){return null;}return this._levels;}},{key:"level",get:function get(){return this.currentLevelIndex;},set:function set(newLevel){var _levels$newLevel;var levels=this._levels;if(levels.length===0){return;}if(this.currentLevelIndex===newLevel&&(_levels$newLevel=levels[newLevel])!==null&&_levels$newLevel!==void 0&&_levels$newLevel.details){return;}// check if level idx is valid
if(newLevel<0||newLevel>=levels.length){// invalid level id given, trigger error
var fatal=newLevel<0;this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].ERROR,{type:_errors__WEBPACK_IMPORTED_MODULE_2__["ErrorTypes"].OTHER_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_2__["ErrorDetails"].LEVEL_SWITCH_ERROR,level:newLevel,fatal:fatal,reason:'invalid level idx'});if(fatal){return;}newLevel=Math.min(newLevel,levels.length-1);}// stopping live reloading timer if any
this.clearTimer();var lastLevelIndex=this.currentLevelIndex;var lastLevel=levels[lastLevelIndex];var level=levels[newLevel];this.log("switching to level "+newLevel+" from "+lastLevelIndex);this.currentLevelIndex=newLevel;var levelSwitchingData=_extends({},level,{level:newLevel,maxBitrate:level.maxBitrate,uri:level.uri,urlId:level.urlId});// @ts-ignore
delete levelSwitchingData._urlId;this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].LEVEL_SWITCHING,levelSwitchingData);// check if we need to load playlist for this level
var levelDetails=level.details;if(!levelDetails||levelDetails.live){// level not retrieved yet, or live playlist we need to (re)load it
var hlsUrlParameters=this.switchParams(level.uri,lastLevel===null||lastLevel===void 0?void 0:lastLevel.details);this.loadPlaylist(hlsUrlParameters);}}},{key:"manualLevel",get:function get(){return this.manualLevelIndex;},set:function set(newLevel){this.manualLevelIndex=newLevel;if(this._startLevel===undefined){this._startLevel=newLevel;}if(newLevel!==-1){this.level=newLevel;}}},{key:"firstLevel",get:function get(){return this._firstLevel;},set:function set(newLevel){this._firstLevel=newLevel;}},{key:"startLevel",get:function get(){// hls.startLevel takes precedence over config.startLevel
// if none of these values are defined, fallback on this._firstLevel (first quality level appearing in variant manifest)
if(this._startLevel===undefined){var configStartLevel=this.hls.config.startLevel;if(configStartLevel!==undefined){return configStartLevel;}else{return this._firstLevel;}}else{return this._startLevel;}},set:function set(newLevel){this._startLevel=newLevel;}},{key:"nextLoadLevel",get:function get(){if(this.manualLevelIndex!==-1){return this.manualLevelIndex;}else{return this.hls.nextAutoLevel;}},set:function set(nextLevel){this.level=nextLevel;if(this.manualLevelIndex===-1){this.hls.nextAutoLevel=nextLevel;}}}]);return LevelController;}(_base_playlist_controller__WEBPACK_IMPORTED_MODULE_5__["default"]);/***/},/***/"./src/controller/level-helper.ts":/*!****************************************!*\
			  !*** ./src/controller/level-helper.ts ***!
			  \****************************************/ /*! exports provided: addGroupId, assignTrackIdsByGroup, updatePTS, updateFragPTSDTS, mergeDetails, mapPartIntersection, mapFragmentIntersection, adjustSliding, addSliding, computeReloadInterval, getFragmentWithSN, getPartWith */ /***/function srcControllerLevelHelperTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"addGroupId",function(){return addGroupId;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"assignTrackIdsByGroup",function(){return assignTrackIdsByGroup;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"updatePTS",function(){return updatePTS;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"updateFragPTSDTS",function(){return updateFragPTSDTS;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"mergeDetails",function(){return mergeDetails;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"mapPartIntersection",function(){return mapPartIntersection;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"mapFragmentIntersection",function(){return mapFragmentIntersection;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"adjustSliding",function(){return adjustSliding;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"addSliding",function(){return addSliding;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"computeReloadInterval",function(){return computeReloadInterval;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"getFragmentWithSN",function(){return getFragmentWithSN;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"getPartWith",function(){return getPartWith;});/* harmony import */var _home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./src/polyfills/number */"./src/polyfills/number.ts");/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../utils/logger */"./src/utils/logger.ts");/**
			 * @module LevelHelper
			 * Providing methods dealing with playlist sliding and drift
			 * */function addGroupId(level,type,id){switch(type){case'audio':if(!level.audioGroupIds){level.audioGroupIds=[];}level.audioGroupIds.push(id);break;case'text':if(!level.textGroupIds){level.textGroupIds=[];}level.textGroupIds.push(id);break;}}function assignTrackIdsByGroup(tracks){var groups={};tracks.forEach(function(track){var groupId=track.groupId||'';track.id=groups[groupId]=groups[groupId]||0;groups[groupId]++;});}function updatePTS(fragments,fromIdx,toIdx){var fragFrom=fragments[fromIdx];var fragTo=fragments[toIdx];updateFromToPTS(fragFrom,fragTo);}function updateFromToPTS(fragFrom,fragTo){var fragToPTS=fragTo.startPTS;// if we know startPTS[toIdx]
if(Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(fragToPTS)){// update fragment duration.
// it helps to fix drifts between playlist reported duration and fragment real duration
var duration=0;var frag;if(fragTo.sn>fragFrom.sn){duration=fragToPTS-fragFrom.start;frag=fragFrom;}else{duration=fragFrom.start-fragToPTS;frag=fragTo;}// TODO? Drift can go either way, or the playlist could be completely accurate
// console.assert(duration > 0,
//   `duration of ${duration} computed for frag ${frag.sn}, level ${frag.level}, there should be some duration drift between playlist and fragment!`);
if(frag.duration!==duration){frag.duration=duration;}// we dont know startPTS[toIdx]
}else if(fragTo.sn>fragFrom.sn){var contiguous=fragFrom.cc===fragTo.cc;// TODO: With part-loading end/durations we need to confirm the whole fragment is loaded before using (or setting) minEndPTS
if(contiguous&&fragFrom.minEndPTS){fragTo.start=fragFrom.start+(fragFrom.minEndPTS-fragFrom.start);}else{fragTo.start=fragFrom.start+fragFrom.duration;}}else{fragTo.start=Math.max(fragFrom.start-fragTo.duration,0);}}function updateFragPTSDTS(details,frag,startPTS,endPTS,startDTS,endDTS){var parsedMediaDuration=endPTS-startPTS;if(parsedMediaDuration<=0){_utils_logger__WEBPACK_IMPORTED_MODULE_1__["logger"].warn('Fragment should have a positive duration',frag);endPTS=startPTS+frag.duration;endDTS=startDTS+frag.duration;}var maxStartPTS=startPTS;var minEndPTS=endPTS;var fragStartPts=frag.startPTS;var fragEndPts=frag.endPTS;if(Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(fragStartPts)){// delta PTS between audio and video
var deltaPTS=Math.abs(fragStartPts-startPTS);if(!Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(frag.deltaPTS)){frag.deltaPTS=deltaPTS;}else{frag.deltaPTS=Math.max(deltaPTS,frag.deltaPTS);}maxStartPTS=Math.max(startPTS,fragStartPts);startPTS=Math.min(startPTS,fragStartPts);startDTS=Math.min(startDTS,frag.startDTS);minEndPTS=Math.min(endPTS,fragEndPts);endPTS=Math.max(endPTS,fragEndPts);endDTS=Math.max(endDTS,frag.endDTS);}frag.duration=endPTS-startPTS;var drift=startPTS-frag.start;frag.appendedPTS=endPTS;frag.start=frag.startPTS=startPTS;frag.maxStartPTS=maxStartPTS;frag.startDTS=startDTS;frag.endPTS=endPTS;frag.minEndPTS=minEndPTS;frag.endDTS=endDTS;var sn=frag.sn;// 'initSegment'
// exit if sn out of range
if(!details||sn<details.startSN||sn>details.endSN){return 0;}var i;var fragIdx=sn-details.startSN;var fragments=details.fragments;// update frag reference in fragments array
// rationale is that fragments array might not contain this frag object.
// this will happen if playlist has been refreshed between frag loading and call to updateFragPTSDTS()
// if we don't update frag, we won't be able to propagate PTS info on the playlist
// resulting in invalid sliding computation
fragments[fragIdx]=frag;// adjust fragment PTS/duration from seqnum-1 to frag 0
for(i=fragIdx;i>0;i--){updateFromToPTS(fragments[i],fragments[i-1]);}// adjust fragment PTS/duration from seqnum to last frag
for(i=fragIdx;i<fragments.length-1;i++){updateFromToPTS(fragments[i],fragments[i+1]);}if(details.fragmentHint){updateFromToPTS(fragments[fragments.length-1],details.fragmentHint);}details.PTSKnown=details.alignedSliding=true;return drift;}function mergeDetails(oldDetails,newDetails){// Track the last initSegment processed. Initialize it to the last one on the timeline.
var currentInitSegment=null;var oldFragments=oldDetails.fragments;for(var i=oldFragments.length-1;i>=0;i--){var oldInit=oldFragments[i].initSegment;if(oldInit){currentInitSegment=oldInit;break;}}if(oldDetails.fragmentHint){// prevent PTS and duration from being adjusted on the next hint
delete oldDetails.fragmentHint.endPTS;}// check if old/new playlists have fragments in common
// loop through overlapping SN and update startPTS , cc, and duration if any found
var ccOffset=0;var PTSFrag;mapFragmentIntersection(oldDetails,newDetails,function(oldFrag,newFrag){if(oldFrag.relurl){// Do not compare CC if the old fragment has no url. This is a level.fragmentHint used by LL-HLS parts.
// It maybe be off by 1 if it was created before any parts or discontinuity tags were appended to the end
// of the playlist.
ccOffset=oldFrag.cc-newFrag.cc;}if(Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(oldFrag.startPTS)&&Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(oldFrag.endPTS)){newFrag.start=newFrag.startPTS=oldFrag.startPTS;newFrag.startDTS=oldFrag.startDTS;newFrag.appendedPTS=oldFrag.appendedPTS;newFrag.maxStartPTS=oldFrag.maxStartPTS;newFrag.endPTS=oldFrag.endPTS;newFrag.endDTS=oldFrag.endDTS;newFrag.minEndPTS=oldFrag.minEndPTS;newFrag.duration=oldFrag.endPTS-oldFrag.startPTS;if(newFrag.duration){PTSFrag=newFrag;}// PTS is known when any segment has startPTS and endPTS
newDetails.PTSKnown=newDetails.alignedSliding=true;}newFrag.elementaryStreams=oldFrag.elementaryStreams;newFrag.loader=oldFrag.loader;newFrag.stats=oldFrag.stats;newFrag.urlId=oldFrag.urlId;if(oldFrag.initSegment){newFrag.initSegment=oldFrag.initSegment;currentInitSegment=oldFrag.initSegment;}});if(currentInitSegment){var fragmentsToCheck=newDetails.fragmentHint?newDetails.fragments.concat(newDetails.fragmentHint):newDetails.fragments;fragmentsToCheck.forEach(function(frag){var _currentInitSegment;if(!frag.initSegment||frag.initSegment.relurl===((_currentInitSegment=currentInitSegment)===null||_currentInitSegment===void 0?void 0:_currentInitSegment.relurl)){frag.initSegment=currentInitSegment;}});}if(newDetails.skippedSegments){newDetails.deltaUpdateFailed=newDetails.fragments.some(function(frag){return!frag;});if(newDetails.deltaUpdateFailed){_utils_logger__WEBPACK_IMPORTED_MODULE_1__["logger"].warn('[level-helper] Previous playlist missing segments skipped in delta playlist');for(var _i=newDetails.skippedSegments;_i--;){newDetails.fragments.shift();}newDetails.startSN=newDetails.fragments[0].sn;newDetails.startCC=newDetails.fragments[0].cc;}}var newFragments=newDetails.fragments;if(ccOffset){_utils_logger__WEBPACK_IMPORTED_MODULE_1__["logger"].warn('discontinuity sliding from playlist, take drift into account');for(var _i2=0;_i2<newFragments.length;_i2++){newFragments[_i2].cc+=ccOffset;}}if(newDetails.skippedSegments){newDetails.startCC=newDetails.fragments[0].cc;}// Merge parts
mapPartIntersection(oldDetails.partList,newDetails.partList,function(oldPart,newPart){newPart.elementaryStreams=oldPart.elementaryStreams;newPart.stats=oldPart.stats;});// if at least one fragment contains PTS info, recompute PTS information for all fragments
if(PTSFrag){updateFragPTSDTS(newDetails,PTSFrag,PTSFrag.startPTS,PTSFrag.endPTS,PTSFrag.startDTS,PTSFrag.endDTS);}else{// ensure that delta is within oldFragments range
// also adjust sliding in case delta is 0 (we could have old=[50-60] and new=old=[50-61])
// in that case we also need to adjust start offset of all fragments
adjustSliding(oldDetails,newDetails);}if(newFragments.length){newDetails.totalduration=newDetails.edge-newFragments[0].start;}newDetails.driftStartTime=oldDetails.driftStartTime;newDetails.driftStart=oldDetails.driftStart;var advancedDateTime=newDetails.advancedDateTime;if(newDetails.advanced&&advancedDateTime){var edge=newDetails.edge;if(!newDetails.driftStart){newDetails.driftStartTime=advancedDateTime;newDetails.driftStart=edge;}newDetails.driftEndTime=advancedDateTime;newDetails.driftEnd=edge;}else{newDetails.driftEndTime=oldDetails.driftEndTime;newDetails.driftEnd=oldDetails.driftEnd;newDetails.advancedDateTime=oldDetails.advancedDateTime;}}function mapPartIntersection(oldParts,newParts,intersectionFn){if(oldParts&&newParts){var delta=0;for(var i=0,len=oldParts.length;i<=len;i++){var _oldPart=oldParts[i];var _newPart=newParts[i+delta];if(_oldPart&&_newPart&&_oldPart.index===_newPart.index&&_oldPart.fragment.sn===_newPart.fragment.sn){intersectionFn(_oldPart,_newPart);}else{delta--;}}}}function mapFragmentIntersection(oldDetails,newDetails,intersectionFn){var skippedSegments=newDetails.skippedSegments;var start=Math.max(oldDetails.startSN,newDetails.startSN)-newDetails.startSN;var end=(oldDetails.fragmentHint?1:0)+(skippedSegments?newDetails.endSN:Math.min(oldDetails.endSN,newDetails.endSN))-newDetails.startSN;var delta=newDetails.startSN-oldDetails.startSN;var newFrags=newDetails.fragmentHint?newDetails.fragments.concat(newDetails.fragmentHint):newDetails.fragments;var oldFrags=oldDetails.fragmentHint?oldDetails.fragments.concat(oldDetails.fragmentHint):oldDetails.fragments;for(var i=start;i<=end;i++){var _oldFrag=oldFrags[delta+i];var _newFrag=newFrags[i];if(skippedSegments&&!_newFrag&&i<skippedSegments){// Fill in skipped segments in delta playlist
_newFrag=newDetails.fragments[i]=_oldFrag;}if(_oldFrag&&_newFrag){intersectionFn(_oldFrag,_newFrag);}}}function adjustSliding(oldDetails,newDetails){var delta=newDetails.startSN+newDetails.skippedSegments-oldDetails.startSN;var oldFragments=oldDetails.fragments;if(delta<0||delta>=oldFragments.length){return;}addSliding(newDetails,oldFragments[delta].start);}function addSliding(details,start){if(start){var fragments=details.fragments;for(var i=details.skippedSegments;i<fragments.length;i++){fragments[i].start+=start;}if(details.fragmentHint){details.fragmentHint.start+=start;}}}function computeReloadInterval(newDetails,stats){var reloadInterval=1000*newDetails.levelTargetDuration;var reloadIntervalAfterMiss=reloadInterval/2;var timeSinceLastModified=newDetails.age;var useLastModified=timeSinceLastModified>0&&timeSinceLastModified<reloadInterval*3;var roundTrip=stats.loading.end-stats.loading.start;var estimatedTimeUntilUpdate;var availabilityDelay=newDetails.availabilityDelay;// let estimate = 'average';
if(newDetails.updated===false){if(useLastModified){// estimate = 'miss round trip';
// We should have had a hit so try again in the time it takes to get a response,
// but no less than 1/3 second.
var minRetry=333*newDetails.misses;estimatedTimeUntilUpdate=Math.max(Math.min(reloadIntervalAfterMiss,roundTrip*2),minRetry);newDetails.availabilityDelay=(newDetails.availabilityDelay||0)+estimatedTimeUntilUpdate;}else{// estimate = 'miss half average';
// follow HLS Spec, If the client reloads a Playlist file and finds that it has not
// changed then it MUST wait for a period of one-half the target
// duration before retrying.
estimatedTimeUntilUpdate=reloadIntervalAfterMiss;}}else if(useLastModified){// estimate = 'next modified date';
// Get the closest we've been to timeSinceLastModified on update
availabilityDelay=Math.min(availabilityDelay||reloadInterval/2,timeSinceLastModified);newDetails.availabilityDelay=availabilityDelay;estimatedTimeUntilUpdate=availabilityDelay+reloadInterval-timeSinceLastModified;}else{estimatedTimeUntilUpdate=reloadInterval-roundTrip;}// console.log(`[computeReloadInterval] live reload ${newDetails.updated ? 'REFRESHED' : 'MISSED'}`,
//   '\n  method', estimate,
//   '\n  estimated time until update =>', estimatedTimeUntilUpdate,
//   '\n  average target duration', reloadInterval,
//   '\n  time since modified', timeSinceLastModified,
//   '\n  time round trip', roundTrip,
//   '\n  availability delay', availabilityDelay);
return Math.round(estimatedTimeUntilUpdate);}function getFragmentWithSN(level,sn,fragCurrent){if(!level||!level.details){return null;}var levelDetails=level.details;var fragment=levelDetails.fragments[sn-levelDetails.startSN];if(fragment){return fragment;}fragment=levelDetails.fragmentHint;if(fragment&&fragment.sn===sn){return fragment;}if(sn<levelDetails.startSN&&fragCurrent&&fragCurrent.sn===sn){return fragCurrent;}return null;}function getPartWith(level,sn,partIndex){if(!level||!level.details){return null;}var partList=level.details.partList;if(partList){for(var i=partList.length;i--;){var part=partList[i];if(part.index===partIndex&&part.fragment.sn===sn){return part;}}}return null;}/***/},/***/"./src/controller/stream-controller.ts":/*!*********************************************!*\
			  !*** ./src/controller/stream-controller.ts ***!
			  \*********************************************/ /*! exports provided: default */ /***/function srcControllerStreamControllerTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"default",function(){return StreamController;});/* harmony import */var _home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./src/polyfills/number */"./src/polyfills/number.ts");/* harmony import */var _base_stream_controller__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ./base-stream-controller */"./src/controller/base-stream-controller.ts");/* harmony import */var _is_supported__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../is-supported */"./src/is-supported.ts");/* harmony import */var _events__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ../events */"./src/events.ts");/* harmony import */var _utils_buffer_helper__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts");/* harmony import */var _fragment_tracker__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(/*! ./fragment-tracker */"./src/controller/fragment-tracker.ts");/* harmony import */var _types_loader__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(/*! ../types/loader */"./src/types/loader.ts");/* harmony import */var _loader_fragment__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(/*! ../loader/fragment */"./src/loader/fragment.ts");/* harmony import */var _demux_transmuxer_interface__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(/*! ../demux/transmuxer-interface */"./src/demux/transmuxer-interface.ts");/* harmony import */var _types_transmuxer__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(/*! ../types/transmuxer */"./src/types/transmuxer.ts");/* harmony import */var _gap_controller__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(/*! ./gap-controller */"./src/controller/gap-controller.ts");/* harmony import */var _errors__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(/*! ../errors */"./src/errors.ts");/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(/*! ../utils/logger */"./src/utils/logger.ts");function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype);subClass.prototype.constructor=subClass;_setPrototypeOf(subClass,superClass);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}var TICK_INTERVAL=100;// how often to tick in ms
var StreamController=/*#__PURE__*/function(_BaseStreamController){_inheritsLoose(StreamController,_BaseStreamController);function StreamController(hls,fragmentTracker){var _this;_this=_BaseStreamController.call(this,hls,fragmentTracker,'[stream-controller]')||this;_this.audioCodecSwap=false;_this.gapController=null;_this.level=-1;_this._forceStartLoad=false;_this.altAudio=false;_this.audioOnly=false;_this.fragPlaying=null;_this.onvplaying=null;_this.onvseeked=null;_this.fragLastKbps=0;_this.stalled=false;_this.couldBacktrack=false;_this.audioCodecSwitch=false;_this.videoBuffer=null;_this._registerListeners();return _this;}var _proto=StreamController.prototype;_proto._registerListeners=function _registerListeners(){var hls=this.hls;hls.on(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].MEDIA_ATTACHED,this.onMediaAttached,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].MANIFEST_LOADING,this.onManifestLoading,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].MANIFEST_PARSED,this.onManifestParsed,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].LEVEL_LOADING,this.onLevelLoading,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].LEVEL_LOADED,this.onLevelLoaded,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].ERROR,this.onError,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].BUFFER_CREATED,this.onBufferCreated,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].BUFFER_FLUSHED,this.onBufferFlushed,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].LEVELS_UPDATED,this.onLevelsUpdated,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].FRAG_BUFFERED,this.onFragBuffered,this);};_proto._unregisterListeners=function _unregisterListeners(){var hls=this.hls;hls.off(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].MEDIA_ATTACHED,this.onMediaAttached,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].MANIFEST_LOADING,this.onManifestLoading,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].MANIFEST_PARSED,this.onManifestParsed,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].LEVEL_LOADED,this.onLevelLoaded,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].ERROR,this.onError,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].BUFFER_CREATED,this.onBufferCreated,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].BUFFER_FLUSHED,this.onBufferFlushed,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].LEVELS_UPDATED,this.onLevelsUpdated,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].FRAG_BUFFERED,this.onFragBuffered,this);};_proto.onHandlerDestroying=function onHandlerDestroying(){this._unregisterListeners();this.onMediaDetaching();};_proto.startLoad=function startLoad(startPosition){if(this.levels){var lastCurrentTime=this.lastCurrentTime,hls=this.hls;this.stopLoad();this.setInterval(TICK_INTERVAL);this.level=-1;this.fragLoadError=0;if(!this.startFragRequested){// determine load level
var startLevel=hls.startLevel;if(startLevel===-1){if(hls.config.testBandwidth){// -1 : guess start Level by doing a bitrate test by loading first fragment of lowest quality level
startLevel=0;this.bitrateTest=true;}else{startLevel=hls.nextAutoLevel;}}// set new level to playlist loader : this will trigger start level load
// hls.nextLoadLevel remains until it is set to a new value or until a new frag is successfully loaded
this.level=hls.nextLoadLevel=startLevel;this.loadedmetadata=false;}// if startPosition undefined but lastCurrentTime set, set startPosition to last currentTime
if(lastCurrentTime>0&&startPosition===-1){this.log("Override startPosition with lastCurrentTime @"+lastCurrentTime.toFixed(3));startPosition=lastCurrentTime;}this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].IDLE;this.nextLoadPosition=this.startPosition=this.lastCurrentTime=startPosition;this.tick();}else{this._forceStartLoad=true;this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].STOPPED;}};_proto.stopLoad=function stopLoad(){this._forceStartLoad=false;_BaseStreamController.prototype.stopLoad.call(this);};_proto.doTick=function doTick(){switch(this.state){case _base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].IDLE:this.doTickIdle();break;case _base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].WAITING_LEVEL:{var _levels$level;var levels=this.levels,level=this.level;var details=levels===null||levels===void 0?void 0:(_levels$level=levels[level])===null||_levels$level===void 0?void 0:_levels$level.details;if(details&&(!details.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(details)){break;}this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].IDLE;break;}break;}case _base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].FRAG_LOADING_WAITING_RETRY:{var _this$media;var now=self.performance.now();var retryDate=this.retryDate;// if current time is gt than retryDate, or if media seeking let's switch to IDLE state to retry loading
if(!retryDate||now>=retryDate||(_this$media=this.media)!==null&&_this$media!==void 0&&_this$media.seeking){this.log('retryDate reached, switch back to IDLE state');this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].IDLE;}}break;}// check buffer
// check/update current fragment
this.onTickEnd();};_proto.onTickEnd=function onTickEnd(){_BaseStreamController.prototype.onTickEnd.call(this);this.checkBuffer();this.checkFragmentChanged();};_proto.doTickIdle=function doTickIdle(){var _frag$decryptdata,_frag$decryptdata2;var hls=this.hls,levelLastLoaded=this.levelLastLoaded,levels=this.levels,media=this.media;var config=hls.config,level=hls.nextLoadLevel;// if start level not parsed yet OR
// if video not attached AND start fragment already requested OR start frag prefetch not enabled
// exit loop, as we either need more info (level not parsed) or we need media to be attached to load new fragment
if(levelLastLoaded===null||!media&&(this.startFragRequested||!config.startFragPrefetch)){return;}// If the "main" level is audio-only but we are loading an alternate track in the same group, do not load anything
if(this.altAudio&&this.audioOnly){return;}if(!levels||!levels[level]){return;}var levelInfo=levels[level];// if buffer length is less than maxBufLen try to load a new fragment
// set next load level : this will trigger a playlist load if needed
this.level=hls.nextLoadLevel=level;var levelDetails=levelInfo.details;// if level info not retrieved yet, switch state and wait for level retrieval
// if live playlist, ensure that new playlist has been refreshed to avoid loading/try to load
// a useless and outdated fragment (that might even introduce load error if it is already out of the live playlist)
if(!levelDetails||this.state===_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].WAITING_LEVEL||levelDetails.live&&this.levelLastLoaded!==level){this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].WAITING_LEVEL;return;}var bufferInfo=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:media,_types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistLevelType"].MAIN);if(bufferInfo===null){return;}var bufferLen=bufferInfo.len;// compute max Buffer Length that we could get from this load level, based on level bitrate. don't buffer more than 60 MB and more than 30s
var maxBufLen=this.getMaxBufferLength(levelInfo.maxBitrate);// Stay idle if we are still with buffer margins
if(bufferLen>=maxBufLen){return;}if(this._streamEnded(bufferInfo,levelDetails)){var data={};if(this.altAudio){data.type='video';}this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].BUFFER_EOS,data);this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].ENDED;return;}var targetBufferTime=bufferInfo.end;var frag=this.getNextFragment(targetBufferTime,levelDetails);// Avoid backtracking after seeking or switching by loading an earlier segment in streams that could backtrack
if(this.couldBacktrack&&!this.fragPrevious&&frag&&frag.sn!=='initSegment'){var fragIdx=frag.sn-levelDetails.startSN;if(fragIdx>1){frag=levelDetails.fragments[fragIdx-1];this.fragmentTracker.removeFragment(frag);}}// Avoid loop loading by using nextLoadPosition set for backtracking
if(frag&&this.fragmentTracker.getState(frag)===_fragment_tracker__WEBPACK_IMPORTED_MODULE_5__["FragmentState"].OK&&this.nextLoadPosition>targetBufferTime){// Cleanup the fragment tracker before trying to find the next unbuffered fragment
var type=this.audioOnly&&!this.altAudio?_loader_fragment__WEBPACK_IMPORTED_MODULE_7__["ElementaryStreamTypes"].AUDIO:_loader_fragment__WEBPACK_IMPORTED_MODULE_7__["ElementaryStreamTypes"].VIDEO;this.afterBufferFlushed(media,type,_types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistLevelType"].MAIN);frag=this.getNextFragment(this.nextLoadPosition,levelDetails);}if(!frag){return;}if(frag.initSegment&&!frag.initSegment.data&&!this.bitrateTest){frag=frag.initSegment;}// We want to load the key if we're dealing with an identity key, because we will decrypt
// this content using the key we fetch. Other keys will be handled by the DRM CDM via EME.
if(((_frag$decryptdata=frag.decryptdata)===null||_frag$decryptdata===void 0?void 0:_frag$decryptdata.keyFormat)==='identity'&&!((_frag$decryptdata2=frag.decryptdata)!==null&&_frag$decryptdata2!==void 0&&_frag$decryptdata2.key)){this.loadKey(frag,levelDetails);}else{this.loadFragment(frag,levelDetails,targetBufferTime);}};_proto.loadFragment=function loadFragment(frag,levelDetails,targetBufferTime){var _this$media2;// Check if fragment is not loaded
var fragState=this.fragmentTracker.getState(frag);this.fragCurrent=frag;// Use data from loaded backtracked fragment if available
if(fragState===_fragment_tracker__WEBPACK_IMPORTED_MODULE_5__["FragmentState"].BACKTRACKED){var data=this.fragmentTracker.getBacktrackData(frag);if(data){this._handleFragmentLoadProgress(data);this._handleFragmentLoadComplete(data);return;}else{fragState=_fragment_tracker__WEBPACK_IMPORTED_MODULE_5__["FragmentState"].NOT_LOADED;}}if(fragState===_fragment_tracker__WEBPACK_IMPORTED_MODULE_5__["FragmentState"].NOT_LOADED||fragState===_fragment_tracker__WEBPACK_IMPORTED_MODULE_5__["FragmentState"].PARTIAL){if(frag.sn==='initSegment'){this._loadInitSegment(frag);}else if(this.bitrateTest){frag.bitrateTest=true;this.log("Fragment "+frag.sn+" of level "+frag.level+" is being downloaded to test bitrate and will not be buffered");this._loadBitrateTestFrag(frag);}else{this.startFragRequested=true;_BaseStreamController.prototype.loadFragment.call(this,frag,levelDetails,targetBufferTime);}}else if(fragState===_fragment_tracker__WEBPACK_IMPORTED_MODULE_5__["FragmentState"].APPENDING){// Lower the buffer size and try again
if(this.reduceMaxBufferLength(frag.duration)){this.fragmentTracker.removeFragment(frag);}}else if(((_this$media2=this.media)===null||_this$media2===void 0?void 0:_this$media2.buffered.length)===0){// Stop gap for bad tracker / buffer flush behavior
this.fragmentTracker.removeAllFragments();}};_proto.getAppendedFrag=function getAppendedFrag(position){var fragOrPart=this.fragmentTracker.getAppendedFrag(position,_types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistLevelType"].MAIN);if(fragOrPart&&'fragment'in fragOrPart){return fragOrPart.fragment;}return fragOrPart;};_proto.getBufferedFrag=function getBufferedFrag(position){return this.fragmentTracker.getBufferedFrag(position,_types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistLevelType"].MAIN);};_proto.followingBufferedFrag=function followingBufferedFrag(frag){if(frag){// try to get range of next fragment (500ms after this range)
return this.getBufferedFrag(frag.end+0.5);}return null;}/*
			    on immediate level switch :
			     - pause playback if playing
			     - cancel any pending load request
			     - and trigger a buffer flush
			  */;_proto.immediateLevelSwitch=function immediateLevelSwitch(){this.abortCurrentFrag();this.flushMainBuffer(0,Number.POSITIVE_INFINITY);}/**
			   * try to switch ASAP without breaking video playback:
			   * in order to ensure smooth but quick level switching,
			   * we need to find the next flushable buffer range
			   * we should take into account new segment fetch time
			   */;_proto.nextLevelSwitch=function nextLevelSwitch(){var levels=this.levels,media=this.media;// ensure that media is defined and that metadata are available (to retrieve currentTime)
if(media!==null&&media!==void 0&&media.readyState){var fetchdelay;var fragPlayingCurrent=this.getAppendedFrag(media.currentTime);if(fragPlayingCurrent&&fragPlayingCurrent.start>1){// flush buffer preceding current fragment (flush until current fragment start offset)
// minus 1s to avoid video freezing, that could happen if we flush keyframe of current video ...
this.flushMainBuffer(0,fragPlayingCurrent.start-1);}if(!media.paused&&levels){// add a safety delay of 1s
var nextLevelId=this.hls.nextLoadLevel;var nextLevel=levels[nextLevelId];var fragLastKbps=this.fragLastKbps;if(fragLastKbps&&this.fragCurrent){fetchdelay=this.fragCurrent.duration*nextLevel.maxBitrate/(1000*fragLastKbps)+1;}else{fetchdelay=0;}}else{fetchdelay=0;}// this.log('fetchdelay:'+fetchdelay);
// find buffer range that will be reached once new fragment will be fetched
var bufferedFrag=this.getBufferedFrag(media.currentTime+fetchdelay);if(bufferedFrag){// we can flush buffer range following this one without stalling playback
var nextBufferedFrag=this.followingBufferedFrag(bufferedFrag);if(nextBufferedFrag){// if we are here, we can also cancel any loading/demuxing in progress, as they are useless
this.abortCurrentFrag();// start flush position is in next buffered frag. Leave some padding for non-independent segments and smoother playback.
var maxStart=nextBufferedFrag.maxStartPTS?nextBufferedFrag.maxStartPTS:nextBufferedFrag.start;var fragDuration=nextBufferedFrag.duration;var startPts=Math.max(bufferedFrag.end,maxStart+Math.min(Math.max(fragDuration-this.config.maxFragLookUpTolerance,fragDuration*0.5),fragDuration*0.75));this.flushMainBuffer(startPts,Number.POSITIVE_INFINITY);}}}};_proto.abortCurrentFrag=function abortCurrentFrag(){var fragCurrent=this.fragCurrent;this.fragCurrent=null;if(fragCurrent!==null&&fragCurrent!==void 0&&fragCurrent.loader){fragCurrent.loader.abort();}if(this.state===_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].KEY_LOADING){this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].IDLE;}this.nextLoadPosition=this.getLoadPosition();};_proto.flushMainBuffer=function flushMainBuffer(startOffset,endOffset){_BaseStreamController.prototype.flushMainBuffer.call(this,startOffset,endOffset,this.altAudio?'video':null);};_proto.onMediaAttached=function onMediaAttached(event,data){_BaseStreamController.prototype.onMediaAttached.call(this,event,data);var media=data.media;this.onvplaying=this.onMediaPlaying.bind(this);this.onvseeked=this.onMediaSeeked.bind(this);media.addEventListener('playing',this.onvplaying);media.addEventListener('seeked',this.onvseeked);this.gapController=new _gap_controller__WEBPACK_IMPORTED_MODULE_10__["default"](this.config,media,this.fragmentTracker,this.hls);};_proto.onMediaDetaching=function onMediaDetaching(){var media=this.media;if(media){media.removeEventListener('playing',this.onvplaying);media.removeEventListener('seeked',this.onvseeked);this.onvplaying=this.onvseeked=null;this.videoBuffer=null;}this.fragPlaying=null;if(this.gapController){this.gapController.destroy();this.gapController=null;}_BaseStreamController.prototype.onMediaDetaching.call(this);};_proto.onMediaPlaying=function onMediaPlaying(){// tick to speed up FRAG_CHANGED triggering
this.tick();};_proto.onMediaSeeked=function onMediaSeeked(){var media=this.media;var currentTime=media?media.currentTime:null;if(Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(currentTime)){this.log("Media seeked to "+currentTime.toFixed(3));}// tick to speed up FRAG_CHANGED triggering
this.tick();};_proto.onManifestLoading=function onManifestLoading(){// reset buffer on manifest loading
this.log('Trigger BUFFER_RESET');this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].BUFFER_RESET,undefined);this.fragmentTracker.removeAllFragments();this.couldBacktrack=this.stalled=false;this.startPosition=this.lastCurrentTime=0;this.fragPlaying=null;};_proto.onManifestParsed=function onManifestParsed(event,data){var aac=false;var heaac=false;var codec;data.levels.forEach(function(level){// detect if we have different kind of audio codecs used amongst playlists
codec=level.audioCodec;if(codec){if(codec.indexOf('mp4a.40.2')!==-1){aac=true;}if(codec.indexOf('mp4a.40.5')!==-1){heaac=true;}}});this.audioCodecSwitch=aac&&heaac&&!Object(_is_supported__WEBPACK_IMPORTED_MODULE_2__["changeTypeSupported"])();if(this.audioCodecSwitch){this.log('Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC');}this.levels=data.levels;this.startFragRequested=false;};_proto.onLevelLoading=function onLevelLoading(event,data){var levels=this.levels;if(!levels||this.state!==_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].IDLE){return;}var level=levels[data.level];if(!level.details||level.details.live&&this.levelLastLoaded!==data.level||this.waitForCdnTuneIn(level.details)){this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].WAITING_LEVEL;}};_proto.onLevelLoaded=function onLevelLoaded(event,data){var _curLevel$details;var levels=this.levels;var newLevelId=data.level;var newDetails=data.details;var duration=newDetails.totalduration;if(!levels){this.warn("Levels were reset while loading level "+newLevelId);return;}this.log("Level "+newLevelId+" loaded ["+newDetails.startSN+","+newDetails.endSN+"], cc ["+newDetails.startCC+", "+newDetails.endCC+"] duration:"+duration);var fragCurrent=this.fragCurrent;if(fragCurrent&&(this.state===_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].FRAG_LOADING||this.state===_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].FRAG_LOADING_WAITING_RETRY)){if(fragCurrent.level!==data.level&&fragCurrent.loader){this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].IDLE;fragCurrent.loader.abort();}}var curLevel=levels[newLevelId];var sliding=0;if(newDetails.live||(_curLevel$details=curLevel.details)!==null&&_curLevel$details!==void 0&&_curLevel$details.live){if(!newDetails.fragments[0]){newDetails.deltaUpdateFailed=true;}if(newDetails.deltaUpdateFailed){return;}sliding=this.alignPlaylists(newDetails,curLevel.details);}// override level info
curLevel.details=newDetails;this.levelLastLoaded=newLevelId;this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].LEVEL_UPDATED,{details:newDetails,level:newLevelId});// only switch back to IDLE state if we were waiting for level to start downloading a new fragment
if(this.state===_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].WAITING_LEVEL){if(this.waitForCdnTuneIn(newDetails)){// Wait for Low-Latency CDN Tune-in
return;}this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].IDLE;}if(!this.startFragRequested){this.setStartPosition(newDetails,sliding);}else if(newDetails.live){this.synchronizeToLiveEdge(newDetails);}// trigger handler right now
this.tick();};_proto._handleFragmentLoadProgress=function _handleFragmentLoadProgress(data){var _frag$initSegment;var frag=data.frag,part=data.part,payload=data.payload;var levels=this.levels;if(!levels){this.warn("Levels were reset while fragment load was in progress. Fragment "+frag.sn+" of level "+frag.level+" will not be buffered");return;}var currentLevel=levels[frag.level];var details=currentLevel.details;if(!details){this.warn("Dropping fragment "+frag.sn+" of level "+frag.level+" after level details were reset");return;}var videoCodec=currentLevel.videoCodec;// time Offset is accurate if level PTS is known, or if playlist is not sliding (not live)
var accurateTimeOffset=details.PTSKnown||!details.live;var initSegmentData=(_frag$initSegment=frag.initSegment)===null||_frag$initSegment===void 0?void 0:_frag$initSegment.data;var audioCodec=this._getAudioCodec(currentLevel);// transmux the MPEG-TS data to ISO-BMFF segments
// this.log(`Transmuxing ${frag.sn} of [${details.startSN} ,${details.endSN}],level ${frag.level}, cc ${frag.cc}`);
var transmuxer=this.transmuxer=this.transmuxer||new _demux_transmuxer_interface__WEBPACK_IMPORTED_MODULE_8__["default"](this.hls,_types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistLevelType"].MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this));var partIndex=part?part.index:-1;var partial=partIndex!==-1;var chunkMeta=new _types_transmuxer__WEBPACK_IMPORTED_MODULE_9__["ChunkMetadata"](frag.level,frag.sn,frag.stats.chunkCount,payload.byteLength,partIndex,partial);var initPTS=this.initPTS[frag.cc];transmuxer.push(payload,initSegmentData,audioCodec,videoCodec,frag,part,details.totalduration,accurateTimeOffset,chunkMeta,initPTS);};_proto.onAudioTrackSwitching=function onAudioTrackSwitching(event,data){// if any URL found on new audio track, it is an alternate audio track
var fromAltAudio=this.altAudio;var altAudio=!!data.url;var trackId=data.id;// if we switch on main audio, ensure that main fragment scheduling is synced with media.buffered
// don't do anything if we switch to alt audio: audio stream controller is handling it.
// we will just have to change buffer scheduling on audioTrackSwitched
if(!altAudio){if(this.mediaBuffer!==this.media){this.log('Switching on main audio, use media.buffered to schedule main fragment loading');this.mediaBuffer=this.media;var fragCurrent=this.fragCurrent;// we need to refill audio buffer from main: cancel any frag loading to speed up audio switch
if(fragCurrent!==null&&fragCurrent!==void 0&&fragCurrent.loader){this.log('Switching to main audio track, cancel main fragment load');fragCurrent.loader.abort();}// destroy transmuxer to force init segment generation (following audio switch)
this.resetTransmuxer();// switch to IDLE state to load new fragment
this.resetLoadingState();}else if(this.audioOnly){// Reset audio transmuxer so when switching back to main audio we're not still appending where we left off
this.resetTransmuxer();}var hls=this.hls;// If switching from alt to main audio, flush all audio and trigger track switched
if(fromAltAudio){hls.trigger(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:'audio'});}hls.trigger(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].AUDIO_TRACK_SWITCHED,{id:trackId});}};_proto.onAudioTrackSwitched=function onAudioTrackSwitched(event,data){var trackId=data.id;var altAudio=!!this.hls.audioTracks[trackId].url;if(altAudio){var videoBuffer=this.videoBuffer;// if we switched on alternate audio, ensure that main fragment scheduling is synced with video sourcebuffer buffered
if(videoBuffer&&this.mediaBuffer!==videoBuffer){this.log('Switching on alternate audio, use video.buffered to schedule main fragment loading');this.mediaBuffer=videoBuffer;}}this.altAudio=altAudio;this.tick();};_proto.onBufferCreated=function onBufferCreated(event,data){var tracks=data.tracks;var mediaTrack;var name;var alternate=false;for(var type in tracks){var track=tracks[type];if(track.id==='main'){name=type;mediaTrack=track;// keep video source buffer reference
if(type==='video'){var videoTrack=tracks[type];if(videoTrack){this.videoBuffer=videoTrack.buffer;}}}else{alternate=true;}}if(alternate&&mediaTrack){this.log("Alternate track found, use "+name+".buffered to schedule main fragment loading");this.mediaBuffer=mediaTrack.buffer;}else{this.mediaBuffer=this.media;}};_proto.onFragBuffered=function onFragBuffered(event,data){var frag=data.frag,part=data.part;if(frag&&frag.type!==_types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistLevelType"].MAIN){return;}if(this.fragContextChanged(frag)){// If a level switch was requested while a fragment was buffering, it will emit the FRAG_BUFFERED event upon completion
// Avoid setting state back to IDLE, since that will interfere with a level switch
this.warn("Fragment "+frag.sn+(part?' p: '+part.index:'')+" of level "+frag.level+" finished buffering, but was aborted. state: "+this.state);if(this.state===_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].PARSED){this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].IDLE;}return;}var stats=part?part.stats:frag.stats;this.fragLastKbps=Math.round(8*stats.total/(stats.buffering.end-stats.loading.first));if(frag.sn!=='initSegment'){this.fragPrevious=frag;}this.fragBufferedComplete(frag,part);};_proto.onError=function onError(event,data){switch(data.details){case _errors__WEBPACK_IMPORTED_MODULE_11__["ErrorDetails"].FRAG_LOAD_ERROR:case _errors__WEBPACK_IMPORTED_MODULE_11__["ErrorDetails"].FRAG_LOAD_TIMEOUT:case _errors__WEBPACK_IMPORTED_MODULE_11__["ErrorDetails"].KEY_LOAD_ERROR:case _errors__WEBPACK_IMPORTED_MODULE_11__["ErrorDetails"].KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(_types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistLevelType"].MAIN,data);break;case _errors__WEBPACK_IMPORTED_MODULE_11__["ErrorDetails"].LEVEL_LOAD_ERROR:case _errors__WEBPACK_IMPORTED_MODULE_11__["ErrorDetails"].LEVEL_LOAD_TIMEOUT:if(this.state!==_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].ERROR){if(data.fatal){// if fatal error, stop processing
this.warn(""+data.details);this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].ERROR;}else{// in case of non fatal error while loading level, if level controller is not retrying to load level , switch back to IDLE
if(!data.levelRetry&&this.state===_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].WAITING_LEVEL){this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].IDLE;}}}break;case _errors__WEBPACK_IMPORTED_MODULE_11__["ErrorDetails"].BUFFER_FULL_ERROR:// if in appending state
if(data.parent==='main'&&(this.state===_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].PARSING||this.state===_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].PARSED)){var flushBuffer=true;var bufferedInfo=this.getFwdBufferInfo(this.media,_types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistLevelType"].MAIN);// 0.5 : tolerance needed as some browsers stalls playback before reaching buffered end
// reduce max buf len if current position is buffered
if(bufferedInfo&&bufferedInfo.len>0.5){flushBuffer=!this.reduceMaxBufferLength(bufferedInfo.len);}if(flushBuffer){// current position is not buffered, but browser is still complaining about buffer full error
// this happens on IE/Edge, refer to https://github.com/video-dev/hls.js/pull/708
// in that case flush the whole buffer to recover
this.warn('buffer full error also media.currentTime is not buffered, flush main');// flush main buffer
this.immediateLevelSwitch();}this.resetLoadingState();}break;}}// Checks the health of the buffer and attempts to resolve playback stalls.
;_proto.checkBuffer=function checkBuffer(){var media=this.media,gapController=this.gapController;if(!media||!gapController||!media.readyState){// Exit early if we don't have media or if the media hasn't buffered anything yet (readyState 0)
return;}// Check combined buffer
var buffered=_utils_buffer_helper__WEBPACK_IMPORTED_MODULE_4__["BufferHelper"].getBuffered(media);if(!this.loadedmetadata&&buffered.length){this.loadedmetadata=true;this.seekToStartPos();}else{// Resolve gaps using the main buffer, whose ranges are the intersections of the A/V sourcebuffers
gapController.poll(this.lastCurrentTime);}this.lastCurrentTime=media.currentTime;};_proto.onFragLoadEmergencyAborted=function onFragLoadEmergencyAborted(){this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].IDLE;// if loadedmetadata is not set, it means that we are emergency switch down on first frag
// in that case, reset startFragRequested flag
if(!this.loadedmetadata){this.startFragRequested=false;this.nextLoadPosition=this.startPosition;}this.tickImmediate();};_proto.onBufferFlushed=function onBufferFlushed(event,_ref){var type=_ref.type;if(type!==_loader_fragment__WEBPACK_IMPORTED_MODULE_7__["ElementaryStreamTypes"].AUDIO||this.audioOnly&&!this.altAudio){var media=(type===_loader_fragment__WEBPACK_IMPORTED_MODULE_7__["ElementaryStreamTypes"].VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(media,type,_types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistLevelType"].MAIN);}};_proto.onLevelsUpdated=function onLevelsUpdated(event,data){this.levels=data.levels;};_proto.swapAudioCodec=function swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap;}/**
			   * Seeks to the set startPosition if not equal to the mediaElement's current time.
			   * @private
			   */;_proto.seekToStartPos=function seekToStartPos(){var media=this.media;var currentTime=media.currentTime;var startPosition=this.startPosition;// only adjust currentTime if different from startPosition or if startPosition not buffered
// at that stage, there should be only one buffered range, as we reach that code after first fragment has been buffered
if(startPosition>=0&&currentTime<startPosition){if(media.seeking){_utils_logger__WEBPACK_IMPORTED_MODULE_12__["logger"].log("could not seek to "+startPosition+", already seeking at "+currentTime);return;}var buffered=_utils_buffer_helper__WEBPACK_IMPORTED_MODULE_4__["BufferHelper"].getBuffered(media);var bufferStart=buffered.length?buffered.start(0):0;var delta=bufferStart-startPosition;if(delta>0&&(delta<this.config.maxBufferHole||delta<this.config.maxFragLookUpTolerance)){_utils_logger__WEBPACK_IMPORTED_MODULE_12__["logger"].log("adjusting start position by "+delta+" to match buffer start");startPosition+=delta;this.startPosition=startPosition;}this.log("seek to target start position "+startPosition+" from current time "+currentTime);media.currentTime=startPosition;}};_proto._getAudioCodec=function _getAudioCodec(currentLevel){var audioCodec=this.config.defaultAudioCodec||currentLevel.audioCodec;if(this.audioCodecSwap&&audioCodec){this.log('Swapping audio codec');if(audioCodec.indexOf('mp4a.40.5')!==-1){audioCodec='mp4a.40.2';}else{audioCodec='mp4a.40.5';}}return audioCodec;};_proto._loadBitrateTestFrag=function _loadBitrateTestFrag(frag){var _this2=this;this._doFragLoad(frag).then(function(data){var hls=_this2.hls;if(!data||hls.nextLoadLevel||_this2.fragContextChanged(frag)){return;}_this2.fragLoadError=0;_this2.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].IDLE;_this2.startFragRequested=false;_this2.bitrateTest=false;var stats=frag.stats;// Bitrate tests fragments are neither parsed nor buffered
stats.parsing.start=stats.parsing.end=stats.buffering.start=stats.buffering.end=self.performance.now();hls.trigger(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].FRAG_LOADED,data);});};_proto._handleTransmuxComplete=function _handleTransmuxComplete(transmuxResult){var _id3$samples;var id='main';var hls=this.hls;var remuxResult=transmuxResult.remuxResult,chunkMeta=transmuxResult.chunkMeta;var context=this.getCurrentContext(chunkMeta);if(!context){this.warn("The loading context changed while buffering fragment "+chunkMeta.sn+" of level "+chunkMeta.level+". This chunk will not be buffered.");this.resetLiveStartWhenNotLoaded(chunkMeta.level);return;}var frag=context.frag,part=context.part,level=context.level;var video=remuxResult.video,text=remuxResult.text,id3=remuxResult.id3,initSegment=remuxResult.initSegment;// The audio-stream-controller handles audio buffering if Hls.js is playing an alternate audio track
var audio=this.altAudio?undefined:remuxResult.audio;// Check if the current fragment has been aborted. We check this by first seeing if we're still playing the current level.
// If we are, subsequently check if the currently loading fragment (fragCurrent) has changed.
if(this.fragContextChanged(frag)){return;}this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].PARSING;if(initSegment){if(initSegment.tracks){this._bufferInitSegment(level,initSegment.tracks,frag,chunkMeta);hls.trigger(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].FRAG_PARSING_INIT_SEGMENT,{frag:frag,id:id,tracks:initSegment.tracks});}// This would be nice if Number.isFinite acted as a typeguard, but it doesn't. See: https://github.com/Microsoft/TypeScript/issues/10038
var initPTS=initSegment.initPTS;var timescale=initSegment.timescale;if(Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(initPTS)){this.initPTS[frag.cc]=initPTS;hls.trigger(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].INIT_PTS_FOUND,{frag:frag,id:id,initPTS:initPTS,timescale:timescale});}}// Avoid buffering if backtracking this fragment
if(video&&remuxResult.independent!==false){if(level.details){var startPTS=video.startPTS,endPTS=video.endPTS,startDTS=video.startDTS,endDTS=video.endDTS;if(part){part.elementaryStreams[video.type]={startPTS:startPTS,endPTS:endPTS,startDTS:startDTS,endDTS:endDTS};}else{if(video.firstKeyFrame&&video.independent){this.couldBacktrack=true;}if(video.dropped&&video.independent){// Backtrack if dropped frames create a gap after currentTime
var pos=this.getLoadPosition()+this.config.maxBufferHole;if(pos<startPTS){this.backtrack(frag);return;}// Set video stream start to fragment start so that truncated samples do not distort the timeline, and mark it partial
frag.setElementaryStreamInfo(video.type,frag.start,endPTS,frag.start,endDTS,true);}}frag.setElementaryStreamInfo(video.type,startPTS,endPTS,startDTS,endDTS);this.bufferFragmentData(video,frag,part,chunkMeta);}}else if(remuxResult.independent===false){this.backtrack(frag);return;}if(audio){var _startPTS=audio.startPTS,_endPTS=audio.endPTS,_startDTS=audio.startDTS,_endDTS=audio.endDTS;if(part){part.elementaryStreams[_loader_fragment__WEBPACK_IMPORTED_MODULE_7__["ElementaryStreamTypes"].AUDIO]={startPTS:_startPTS,endPTS:_endPTS,startDTS:_startDTS,endDTS:_endDTS};}frag.setElementaryStreamInfo(_loader_fragment__WEBPACK_IMPORTED_MODULE_7__["ElementaryStreamTypes"].AUDIO,_startPTS,_endPTS,_startDTS,_endDTS);this.bufferFragmentData(audio,frag,part,chunkMeta);}if(id3!==null&&id3!==void 0&&(_id3$samples=id3.samples)!==null&&_id3$samples!==void 0&&_id3$samples.length){var emittedID3={frag:frag,id:id,samples:id3.samples};hls.trigger(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].FRAG_PARSING_METADATA,emittedID3);}if(text){var emittedText={frag:frag,id:id,samples:text.samples};hls.trigger(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].FRAG_PARSING_USERDATA,emittedText);}};_proto._bufferInitSegment=function _bufferInitSegment(currentLevel,tracks,frag,chunkMeta){var _this3=this;if(this.state!==_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].PARSING){return;}this.audioOnly=!!tracks.audio&&!tracks.video;// if audio track is expected to come from audio stream controller, discard any coming from main
if(this.altAudio&&!this.audioOnly){delete tracks.audio;}// include levelCodec in audio and video tracks
var audio=tracks.audio,video=tracks.video,audiovideo=tracks.audiovideo;if(audio){var audioCodec=currentLevel.audioCodec;var ua=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){if(audioCodec){if(audioCodec.indexOf('mp4a.40.5')!==-1){audioCodec='mp4a.40.2';}else{audioCodec='mp4a.40.5';}}// In the case that AAC and HE-AAC audio codecs are signalled in manifest,
// force HE-AAC, as it seems that most browsers prefers it.
// don't force HE-AAC if mono stream, or in Firefox
if(audio.metadata.channelCount!==1&&ua.indexOf('firefox')===-1){audioCodec='mp4a.40.5';}}// HE-AAC is broken on Android, always signal audio codec as AAC even if variant manifest states otherwise
if(ua.indexOf('android')!==-1&&audio.container!=='audio/mpeg'){// Exclude mpeg audio
audioCodec='mp4a.40.2';this.log("Android: force audio codec to "+audioCodec);}if(currentLevel.audioCodec&&currentLevel.audioCodec!==audioCodec){this.log("Swapping manifest audio codec \""+currentLevel.audioCodec+"\" for \""+audioCodec+"\"");}audio.levelCodec=audioCodec;audio.id='main';this.log("Init audio buffer, container:"+audio.container+", codecs[selected/level/parsed]=["+(audioCodec||'')+"/"+(currentLevel.audioCodec||'')+"/"+audio.codec+"]");}if(video){video.levelCodec=currentLevel.videoCodec;video.id='main';this.log("Init video buffer, container:"+video.container+", codecs[level/parsed]=["+(currentLevel.videoCodec||'')+"/"+video.codec+"]");}if(audiovideo){this.log("Init audiovideo buffer, container:"+audiovideo.container+", codecs[level/parsed]=["+(currentLevel.attrs.CODECS||'')+"/"+audiovideo.codec+"]");}this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].BUFFER_CODECS,tracks);// loop through tracks that are going to be provided to bufferController
Object.keys(tracks).forEach(function(trackName){var track=tracks[trackName];var initSegment=track.initSegment;if(initSegment!==null&&initSegment!==void 0&&initSegment.byteLength){_this3.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].BUFFER_APPENDING,{type:trackName,data:initSegment,frag:frag,part:null,chunkMeta:chunkMeta,parent:frag.type});}});// trigger handler right now
this.tick();};_proto.backtrack=function backtrack(frag){this.couldBacktrack=true;// Causes findFragments to backtrack through fragments to find the keyframe
this.resetTransmuxer();this.flushBufferGap(frag);var data=this.fragmentTracker.backtrack(frag);this.fragPrevious=null;this.nextLoadPosition=frag.start;if(data){this.resetFragmentLoading(frag);}else{// Change state to BACKTRACKING so that fragmentEntity.backtrack data can be added after _doFragLoad
this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["State"].BACKTRACKING;}};_proto.checkFragmentChanged=function checkFragmentChanged(){var video=this.media;var fragPlayingCurrent=null;if(video&&video.readyState>1&&video.seeking===false){var currentTime=video.currentTime;/* if video element is in seeked state, currentTime can only increase.
			        (assuming that playback rate is positive ...)
			        As sometimes currentTime jumps back to zero after a
			        media decode error, check this, to avoid seeking back to
			        wrong position after a media decode error
			      */if(_utils_buffer_helper__WEBPACK_IMPORTED_MODULE_4__["BufferHelper"].isBuffered(video,currentTime)){fragPlayingCurrent=this.getAppendedFrag(currentTime);}else if(_utils_buffer_helper__WEBPACK_IMPORTED_MODULE_4__["BufferHelper"].isBuffered(video,currentTime+0.1)){/* ensure that FRAG_CHANGED event is triggered at startup,
			          when first video frame is displayed and playback is paused.
			          add a tolerance of 100ms, in case current position is not buffered,
			          check if current pos+100ms is buffered and use that buffer range
			          for FRAG_CHANGED event reporting */fragPlayingCurrent=this.getAppendedFrag(currentTime+0.1);}if(fragPlayingCurrent){var fragPlaying=this.fragPlaying;var fragCurrentLevel=fragPlayingCurrent.level;if(!fragPlaying||fragPlayingCurrent.sn!==fragPlaying.sn||fragPlaying.level!==fragCurrentLevel||fragPlayingCurrent.urlId!==fragPlaying.urlId){this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].FRAG_CHANGED,{frag:fragPlayingCurrent});if(!fragPlaying||fragPlaying.level!==fragCurrentLevel){this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].LEVEL_SWITCHED,{level:fragCurrentLevel});}this.fragPlaying=fragPlayingCurrent;}}}};_createClass(StreamController,[{key:"nextLevel",get:function get(){var frag=this.nextBufferedFrag;if(frag){return frag.level;}else{return-1;}}},{key:"currentLevel",get:function get(){var media=this.media;if(media){var fragPlayingCurrent=this.getAppendedFrag(media.currentTime);if(fragPlayingCurrent){return fragPlayingCurrent.level;}}return-1;}},{key:"nextBufferedFrag",get:function get(){var media=this.media;if(media){// first get end range of current fragment
var fragPlayingCurrent=this.getAppendedFrag(media.currentTime);return this.followingBufferedFrag(fragPlayingCurrent);}else{return null;}}},{key:"forceStartLoad",get:function get(){return this._forceStartLoad;}}]);return StreamController;}(_base_stream_controller__WEBPACK_IMPORTED_MODULE_1__["default"]);/***/},/***/"./src/controller/subtitle-stream-controller.ts":/*!******************************************************!*\
			  !*** ./src/controller/subtitle-stream-controller.ts ***!
			  \******************************************************/ /*! exports provided: SubtitleStreamController */ /***/function srcControllerSubtitleStreamControllerTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"SubtitleStreamController",function(){return SubtitleStreamController;});/* harmony import */var _events__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../events */"./src/events.ts");/* harmony import */var _utils_buffer_helper__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts");/* harmony import */var _fragment_finders__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ./fragment-finders */"./src/controller/fragment-finders.ts");/* harmony import */var _utils_discontinuities__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ../utils/discontinuities */"./src/utils/discontinuities.ts");/* harmony import */var _level_helper__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(/*! ./level-helper */"./src/controller/level-helper.ts");/* harmony import */var _fragment_tracker__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(/*! ./fragment-tracker */"./src/controller/fragment-tracker.ts");/* harmony import */var _base_stream_controller__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(/*! ./base-stream-controller */"./src/controller/base-stream-controller.ts");/* harmony import */var _types_loader__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(/*! ../types/loader */"./src/types/loader.ts");/* harmony import */var _types_level__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(/*! ../types/level */"./src/types/level.ts");function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype);subClass.prototype.constructor=subClass;_setPrototypeOf(subClass,superClass);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}var TICK_INTERVAL=500;// how often to tick in ms
var SubtitleStreamController=/*#__PURE__*/function(_BaseStreamController){_inheritsLoose(SubtitleStreamController,_BaseStreamController);function SubtitleStreamController(hls,fragmentTracker){var _this;_this=_BaseStreamController.call(this,hls,fragmentTracker,'[subtitle-stream-controller]')||this;_this.levels=[];_this.currentTrackId=-1;_this.tracksBuffered=[];_this.mainDetails=null;_this._registerListeners();return _this;}var _proto=SubtitleStreamController.prototype;_proto.onHandlerDestroying=function onHandlerDestroying(){this._unregisterListeners();this.mainDetails=null;};_proto._registerListeners=function _registerListeners(){var hls=this.hls;hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MEDIA_ATTACHED,this.onMediaAttached,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MANIFEST_LOADING,this.onManifestLoading,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].LEVEL_LOADED,this.onLevelLoaded,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].ERROR,this.onError,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].BUFFER_FLUSHING,this.onBufferFlushing,this);};_proto._unregisterListeners=function _unregisterListeners(){var hls=this.hls;hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MEDIA_ATTACHED,this.onMediaAttached,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MANIFEST_LOADING,this.onManifestLoading,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].LEVEL_LOADED,this.onLevelLoaded,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].ERROR,this.onError,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].BUFFER_FLUSHING,this.onBufferFlushing,this);};_proto.startLoad=function startLoad(){this.stopLoad();this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_6__["State"].IDLE;this.setInterval(TICK_INTERVAL);this.tick();};_proto.onManifestLoading=function onManifestLoading(){this.mainDetails=null;this.fragmentTracker.removeAllFragments();};_proto.onLevelLoaded=function onLevelLoaded(event,data){this.mainDetails=data.details;};_proto.onSubtitleFragProcessed=function onSubtitleFragProcessed(event,data){var frag=data.frag,success=data.success;this.fragPrevious=frag;this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_6__["State"].IDLE;if(!success){return;}var buffered=this.tracksBuffered[this.currentTrackId];if(!buffered){return;}// Create/update a buffered array matching the interface used by BufferHelper.bufferedInfo
// so we can re-use the logic used to detect how much has been buffered
var timeRange;var fragStart=frag.start;for(var i=0;i<buffered.length;i++){if(fragStart>=buffered[i].start&&fragStart<=buffered[i].end){timeRange=buffered[i];break;}}var fragEnd=frag.start+frag.duration;if(timeRange){timeRange.end=fragEnd;}else{timeRange={start:fragStart,end:fragEnd};buffered.push(timeRange);}this.fragmentTracker.fragBuffered(frag);};_proto.onBufferFlushing=function onBufferFlushing(event,data){var startOffset=data.startOffset,endOffset=data.endOffset;if(startOffset===0&&endOffset!==Number.POSITIVE_INFINITY){var currentTrackId=this.currentTrackId,levels=this.levels;if(!levels.length||!levels[currentTrackId]||!levels[currentTrackId].details){return;}var trackDetails=levels[currentTrackId].details;var targetDuration=trackDetails.targetduration;var endOffsetSubtitles=endOffset-targetDuration;if(endOffsetSubtitles<=0){return;}data.endOffsetSubtitles=Math.max(0,endOffsetSubtitles);this.tracksBuffered.forEach(function(buffered){for(var i=0;i<buffered.length;){if(buffered[i].end<=endOffsetSubtitles){buffered.shift();continue;}else if(buffered[i].start<endOffsetSubtitles){buffered[i].start=endOffsetSubtitles;}else{break;}i++;}});this.fragmentTracker.removeFragmentsInRange(startOffset,endOffsetSubtitles,_types_loader__WEBPACK_IMPORTED_MODULE_7__["PlaylistLevelType"].SUBTITLE);}}// If something goes wrong, proceed to next frag, if we were processing one.
;_proto.onError=function onError(event,data){var _this$fragCurrent;var frag=data.frag;// don't handle error not related to subtitle fragment
if(!frag||frag.type!==_types_loader__WEBPACK_IMPORTED_MODULE_7__["PlaylistLevelType"].SUBTITLE){return;}if((_this$fragCurrent=this.fragCurrent)!==null&&_this$fragCurrent!==void 0&&_this$fragCurrent.loader){this.fragCurrent.loader.abort();}this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_6__["State"].IDLE;}// Got all new subtitle levels.
;_proto.onSubtitleTracksUpdated=function onSubtitleTracksUpdated(event,_ref){var _this2=this;var subtitleTracks=_ref.subtitleTracks;this.tracksBuffered=[];this.levels=subtitleTracks.map(function(mediaPlaylist){return new _types_level__WEBPACK_IMPORTED_MODULE_8__["Level"](mediaPlaylist);});this.fragmentTracker.removeAllFragments();this.fragPrevious=null;this.levels.forEach(function(level){_this2.tracksBuffered[level.id]=[];});this.mediaBuffer=null;};_proto.onSubtitleTrackSwitch=function onSubtitleTrackSwitch(event,data){this.currentTrackId=data.id;if(!this.levels.length||this.currentTrackId===-1){this.clearInterval();return;}// Check if track has the necessary details to load fragments
var currentTrack=this.levels[this.currentTrackId];if(currentTrack!==null&&currentTrack!==void 0&&currentTrack.details){this.mediaBuffer=this.mediaBufferTimeRanges;}else{this.mediaBuffer=null;}if(currentTrack){this.setInterval(TICK_INTERVAL);}}// Got a new set of subtitle fragments.
;_proto.onSubtitleTrackLoaded=function onSubtitleTrackLoaded(event,data){var _track$details;var newDetails=data.details,trackId=data.id;var currentTrackId=this.currentTrackId,levels=this.levels;if(!levels.length){return;}var track=levels[currentTrackId];if(trackId>=levels.length||trackId!==currentTrackId||!track){return;}this.mediaBuffer=this.mediaBufferTimeRanges;if(newDetails.live||(_track$details=track.details)!==null&&_track$details!==void 0&&_track$details.live){var mainDetails=this.mainDetails;if(newDetails.deltaUpdateFailed||!mainDetails){return;}var mainSlidingStartFragment=mainDetails.fragments[0];if(!track.details){if(newDetails.hasProgramDateTime&&mainDetails.hasProgramDateTime){Object(_utils_discontinuities__WEBPACK_IMPORTED_MODULE_3__["alignMediaPlaylistByPDT"])(newDetails,mainDetails);}else if(mainSlidingStartFragment){// line up live playlist with main so that fragments in range are loaded
Object(_level_helper__WEBPACK_IMPORTED_MODULE_4__["addSliding"])(newDetails,mainSlidingStartFragment.start);}}else{var sliding=this.alignPlaylists(newDetails,track.details);if(sliding===0&&mainSlidingStartFragment){// realign with main when there is no overlap with last refresh
Object(_level_helper__WEBPACK_IMPORTED_MODULE_4__["addSliding"])(newDetails,mainSlidingStartFragment.start);}}}track.details=newDetails;this.levelLastLoaded=trackId;// trigger handler right now
this.tick();// If playlist is misaligned because of bad PDT or drift, delete details to resync with main on reload
if(newDetails.live&&!this.fragCurrent&&this.media&&this.state===_base_stream_controller__WEBPACK_IMPORTED_MODULE_6__["State"].IDLE){var foundFrag=Object(_fragment_finders__WEBPACK_IMPORTED_MODULE_2__["findFragmentByPTS"])(null,newDetails.fragments,this.media.currentTime,0);if(!foundFrag){this.warn('Subtitle playlist not aligned with playback');track.details=undefined;}}};_proto._handleFragmentLoadComplete=function _handleFragmentLoadComplete(fragLoadedData){var frag=fragLoadedData.frag,payload=fragLoadedData.payload;var decryptData=frag.decryptdata;var hls=this.hls;if(this.fragContextChanged(frag)){return;}// check to see if the payload needs to be decrypted
if(payload&&payload.byteLength>0&&decryptData&&decryptData.key&&decryptData.iv&&decryptData.method==='AES-128'){var startTime=performance.now();// decrypt the subtitles
this.decrypter.webCryptoDecrypt(new Uint8Array(payload),decryptData.key.buffer,decryptData.iv.buffer).then(function(decryptedData){var endTime=performance.now();hls.trigger(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].FRAG_DECRYPTED,{frag:frag,payload:decryptedData,stats:{tstart:startTime,tdecrypt:endTime}});});}};_proto.doTick=function doTick(){if(!this.media){this.state=_base_stream_controller__WEBPACK_IMPORTED_MODULE_6__["State"].IDLE;return;}if(this.state===_base_stream_controller__WEBPACK_IMPORTED_MODULE_6__["State"].IDLE){var _foundFrag;var currentTrackId=this.currentTrackId,levels=this.levels;if(!levels.length||!levels[currentTrackId]||!levels[currentTrackId].details){return;}// Expand range of subs loaded by one target-duration in either direction to make up for misaligned playlists
var trackDetails=levels[currentTrackId].details;var targetDuration=trackDetails.targetduration;var config=this.config,media=this.media;var bufferedInfo=_utils_buffer_helper__WEBPACK_IMPORTED_MODULE_1__["BufferHelper"].bufferedInfo(this.mediaBufferTimeRanges,media.currentTime-targetDuration,config.maxBufferHole);var targetBufferTime=bufferedInfo.end,bufferLen=bufferedInfo.len;var maxBufLen=this.getMaxBufferLength()+targetDuration;if(bufferLen>maxBufLen){return;}console.assert(trackDetails,'Subtitle track details are defined on idle subtitle stream controller tick');var fragments=trackDetails.fragments;var fragLen=fragments.length;var end=trackDetails.edge;var foundFrag;var fragPrevious=this.fragPrevious;if(targetBufferTime<end){var maxFragLookUpTolerance=config.maxFragLookUpTolerance;foundFrag=Object(_fragment_finders__WEBPACK_IMPORTED_MODULE_2__["findFragmentByPTS"])(fragPrevious,fragments,targetBufferTime,maxFragLookUpTolerance);if(!foundFrag&&fragPrevious&&fragPrevious.start<fragments[0].start){foundFrag=fragments[0];}}else{foundFrag=fragments[fragLen-1];}if((_foundFrag=foundFrag)!==null&&_foundFrag!==void 0&&_foundFrag.encrypted){this.loadKey(foundFrag,trackDetails);}else if(foundFrag&&this.fragmentTracker.getState(foundFrag)===_fragment_tracker__WEBPACK_IMPORTED_MODULE_5__["FragmentState"].NOT_LOADED){// only load if fragment is not loaded
this.loadFragment(foundFrag,trackDetails,targetBufferTime);}}};_proto.loadFragment=function loadFragment(frag,levelDetails,targetBufferTime){this.fragCurrent=frag;_BaseStreamController.prototype.loadFragment.call(this,frag,levelDetails,targetBufferTime);};_createClass(SubtitleStreamController,[{key:"mediaBufferTimeRanges",get:function get(){return this.tracksBuffered[this.currentTrackId]||[];}}]);return SubtitleStreamController;}(_base_stream_controller__WEBPACK_IMPORTED_MODULE_6__["default"]);/***/},/***/"./src/controller/subtitle-track-controller.ts":/*!*****************************************************!*\
			  !*** ./src/controller/subtitle-track-controller.ts ***!
			  \*****************************************************/ /*! exports provided: default */ /***/function srcControllerSubtitleTrackControllerTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var _events__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../events */"./src/events.ts");/* harmony import */var _utils_texttrack_utils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../utils/texttrack-utils */"./src/utils/texttrack-utils.ts");/* harmony import */var _base_playlist_controller__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ./base-playlist-controller */"./src/controller/base-playlist-controller.ts");/* harmony import */var _types_loader__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ../types/loader */"./src/types/loader.ts");function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype);subClass.prototype.constructor=subClass;_setPrototypeOf(subClass,superClass);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}var SubtitleTrackController=/*#__PURE__*/function(_BasePlaylistControll){_inheritsLoose(SubtitleTrackController,_BasePlaylistControll);// Enable/disable subtitle display rendering
function SubtitleTrackController(hls){var _this;_this=_BasePlaylistControll.call(this,hls,'[subtitle-track-controller]')||this;_this.media=null;_this.tracks=[];_this.groupId=null;_this.tracksInGroup=[];_this.trackId=-1;_this.selectDefaultTrack=true;_this.queuedDefaultTrack=-1;_this.trackChangeListener=function(){return _this.onTextTracksChanged();};_this.asyncPollTrackChange=function(){return _this.pollTrackChange(0);};_this.useTextTrackPolling=false;_this.subtitlePollingInterval=-1;_this.subtitleDisplay=true;_this.registerListeners();return _this;}var _proto=SubtitleTrackController.prototype;_proto.destroy=function destroy(){this.unregisterListeners();this.tracks.length=0;this.tracksInGroup.length=0;this.trackChangeListener=this.asyncPollTrackChange=null;_BasePlaylistControll.prototype.destroy.call(this);};_proto.registerListeners=function registerListeners(){var hls=this.hls;hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MEDIA_ATTACHED,this.onMediaAttached,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MANIFEST_LOADING,this.onManifestLoading,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MANIFEST_PARSED,this.onManifestParsed,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].LEVEL_LOADING,this.onLevelLoading,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].LEVEL_SWITCHING,this.onLevelSwitching,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].ERROR,this.onError,this);};_proto.unregisterListeners=function unregisterListeners(){var hls=this.hls;hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MEDIA_ATTACHED,this.onMediaAttached,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MANIFEST_LOADING,this.onManifestLoading,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].MANIFEST_PARSED,this.onManifestParsed,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].LEVEL_LOADING,this.onLevelLoading,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].LEVEL_SWITCHING,this.onLevelSwitching,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].ERROR,this.onError,this);}// Listen for subtitle track change, then extract the current track ID.
;_proto.onMediaAttached=function onMediaAttached(event,data){this.media=data.media;if(!this.media){return;}if(this.queuedDefaultTrack>-1){this.subtitleTrack=this.queuedDefaultTrack;this.queuedDefaultTrack=-1;}this.useTextTrackPolling=!(this.media.textTracks&&'onchange'in this.media.textTracks);if(this.useTextTrackPolling){this.pollTrackChange(500);}else{this.media.textTracks.addEventListener('change',this.asyncPollTrackChange);}};_proto.pollTrackChange=function pollTrackChange(timeout){self.clearInterval(this.subtitlePollingInterval);this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,timeout);};_proto.onMediaDetaching=function onMediaDetaching(){if(!this.media){return;}self.clearInterval(this.subtitlePollingInterval);if(!this.useTextTrackPolling){this.media.textTracks.removeEventListener('change',this.asyncPollTrackChange);}if(this.trackId>-1){this.queuedDefaultTrack=this.trackId;}var textTracks=filterSubtitleTracks(this.media.textTracks);// Clear loaded cues on media detachment from tracks
textTracks.forEach(function(track){Object(_utils_texttrack_utils__WEBPACK_IMPORTED_MODULE_1__["clearCurrentCues"])(track);});// Disable all subtitle tracks before detachment so when reattached only tracks in that content are enabled.
this.subtitleTrack=-1;this.media=null;};_proto.onManifestLoading=function onManifestLoading(){this.tracks=[];this.groupId=null;this.tracksInGroup=[];this.trackId=-1;this.selectDefaultTrack=true;}// Fired whenever a new manifest is loaded.
;_proto.onManifestParsed=function onManifestParsed(event,data){this.tracks=data.subtitleTracks;};_proto.onSubtitleTrackLoaded=function onSubtitleTrackLoaded(event,data){var id=data.id,details=data.details;var trackId=this.trackId;var currentTrack=this.tracksInGroup[trackId];if(!currentTrack){this.warn("Invalid subtitle track id "+id);return;}var curDetails=currentTrack.details;currentTrack.details=data.details;this.log("subtitle track "+id+" loaded ["+details.startSN+"-"+details.endSN+"]");if(id===this.trackId){this.retryCount=0;this.playlistLoaded(id,data,curDetails);}};_proto.onLevelLoading=function onLevelLoading(event,data){this.switchLevel(data.level);};_proto.onLevelSwitching=function onLevelSwitching(event,data){this.switchLevel(data.level);};_proto.switchLevel=function switchLevel(levelIndex){var levelInfo=this.hls.levels[levelIndex];if(!(levelInfo!==null&&levelInfo!==void 0&&levelInfo.textGroupIds)){return;}var textGroupId=levelInfo.textGroupIds[levelInfo.urlId];if(this.groupId!==textGroupId){var lastTrack=this.tracksInGroup?this.tracksInGroup[this.trackId]:undefined;var subtitleTracks=this.tracks.filter(function(track){return!textGroupId||track.groupId===textGroupId;});this.tracksInGroup=subtitleTracks;var initialTrackId=this.findTrackId(lastTrack===null||lastTrack===void 0?void 0:lastTrack.name)||this.findTrackId();this.groupId=textGroupId;var subtitleTracksUpdated={subtitleTracks:subtitleTracks};this.log("Updating subtitle tracks, "+subtitleTracks.length+" track(s) found in \""+textGroupId+"\" group-id");this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].SUBTITLE_TRACKS_UPDATED,subtitleTracksUpdated);if(initialTrackId!==-1){this.setSubtitleTrack(initialTrackId,lastTrack);}}};_proto.findTrackId=function findTrackId(name){var textTracks=this.tracksInGroup;for(var i=0;i<textTracks.length;i++){var track=textTracks[i];if(!this.selectDefaultTrack||track.default){if(!name||name===track.name){return track.id;}}}return-1;};_proto.onError=function onError(event,data){_BasePlaylistControll.prototype.onError.call(this,event,data);if(data.fatal||!data.context){return;}if(data.context.type===_types_loader__WEBPACK_IMPORTED_MODULE_3__["PlaylistContextType"].SUBTITLE_TRACK&&data.context.id===this.trackId&&data.context.groupId===this.groupId){this.retryLoadingOrFail(data);}}/** get alternate subtitle tracks list from playlist **/;_proto.loadPlaylist=function loadPlaylist(hlsUrlParameters){var currentTrack=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(currentTrack)){var id=currentTrack.id;var groupId=currentTrack.groupId;var url=currentTrack.url;if(hlsUrlParameters){try{url=hlsUrlParameters.addDirectives(url);}catch(error){this.warn("Could not construct new URL with HLS Delivery Directives: "+error);}}this.log("Loading subtitle playlist for id "+id);this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].SUBTITLE_TRACK_LOADING,{url:url,id:id,groupId:groupId,deliveryDirectives:hlsUrlParameters||null});}}/**
			   * Disables the old subtitleTrack and sets current mode on the next subtitleTrack.
			   * This operates on the DOM textTracks.
			   * A value of -1 will disable all subtitle tracks.
			   */;_proto.toggleTrackModes=function toggleTrackModes(newId){var _this2=this;var media=this.media,subtitleDisplay=this.subtitleDisplay,trackId=this.trackId;if(!media){return;}var textTracks=filterSubtitleTracks(media.textTracks);var groupTracks=textTracks.filter(function(track){return track.groupId===_this2.groupId;});if(newId===-1){[].slice.call(textTracks).forEach(function(track){track.mode='disabled';});}else{var oldTrack=groupTracks[trackId];if(oldTrack){oldTrack.mode='disabled';}}var nextTrack=groupTracks[newId];if(nextTrack){nextTrack.mode=subtitleDisplay?'showing':'hidden';}}/**
			   * This method is responsible for validating the subtitle index and periodically reloading if live.
			   * Dispatches the SUBTITLE_TRACK_SWITCH event, which instructs the subtitle-stream-controller to load the selected track.
			   */;_proto.setSubtitleTrack=function setSubtitleTrack(newId,lastTrack){var _tracks$newId;var tracks=this.tracksInGroup;// setting this.subtitleTrack will trigger internal logic
// if media has not been attached yet, it will fail
// we keep a reference to the default track id
// and we'll set subtitleTrack when onMediaAttached is triggered
if(!this.media){this.queuedDefaultTrack=newId;return;}if(this.trackId!==newId){this.toggleTrackModes(newId);}// exit if track id as already set or invalid
if(this.trackId===newId&&(newId===-1||(_tracks$newId=tracks[newId])!==null&&_tracks$newId!==void 0&&_tracks$newId.details)||newId<-1||newId>=tracks.length){return;}// stopping live reloading timer if any
this.clearTimer();var track=tracks[newId];this.log("Switching to subtitle track "+newId);this.trackId=newId;if(track){var id=track.id,_track$groupId=track.groupId,groupId=_track$groupId===void 0?'':_track$groupId,name=track.name,type=track.type,url=track.url;this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].SUBTITLE_TRACK_SWITCH,{id:id,groupId:groupId,name:name,type:type,url:url});var hlsUrlParameters=this.switchParams(track.url,lastTrack===null||lastTrack===void 0?void 0:lastTrack.details);this.loadPlaylist(hlsUrlParameters);}else{// switch to -1
this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].SUBTITLE_TRACK_SWITCH,{id:newId});}};_proto.onTextTracksChanged=function onTextTracksChanged(){if(!this.useTextTrackPolling){self.clearInterval(this.subtitlePollingInterval);}// Media is undefined when switching streams via loadSource()
if(!this.media||!this.hls.config.renderTextTracksNatively){return;}var trackId=-1;var tracks=filterSubtitleTracks(this.media.textTracks);for(var id=0;id<tracks.length;id++){if(tracks[id].mode==='hidden'){// Do not break in case there is a following track with showing.
trackId=id;}else if(tracks[id].mode==='showing'){trackId=id;break;}}// Setting current subtitleTrack will invoke code.
if(this.subtitleTrack!==trackId){this.subtitleTrack=trackId;}};_createClass(SubtitleTrackController,[{key:"subtitleTracks",get:function get(){return this.tracksInGroup;}/** get/set index of the selected subtitle track (based on index in subtitle track lists) **/},{key:"subtitleTrack",get:function get(){return this.trackId;},set:function set(newId){this.selectDefaultTrack=false;var lastTrack=this.tracksInGroup?this.tracksInGroup[this.trackId]:undefined;this.setSubtitleTrack(newId,lastTrack);}}]);return SubtitleTrackController;}(_base_playlist_controller__WEBPACK_IMPORTED_MODULE_2__["default"]);function filterSubtitleTracks(textTrackList){var tracks=[];for(var i=0;i<textTrackList.length;i++){var track=textTrackList[i];// Edge adds a track without a label; we don't want to use it
if(track.kind==='subtitles'&&track.label){tracks.push(textTrackList[i]);}}return tracks;}/* harmony default export */__webpack_exports__["default"]=SubtitleTrackController;/***/},/***/"./src/controller/timeline-controller.ts":/*!***********************************************!*\
			  !*** ./src/controller/timeline-controller.ts ***!
			  \***********************************************/ /*! exports provided: TimelineController */ /***/function srcControllerTimelineControllerTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"TimelineController",function(){return TimelineController;});/* harmony import */var _home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./src/polyfills/number */"./src/polyfills/number.ts");/* harmony import */var _events__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../events */"./src/events.ts");/* harmony import */var _utils_cea_608_parser__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../utils/cea-608-parser */"./src/utils/cea-608-parser.ts");/* harmony import */var _utils_output_filter__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ../utils/output-filter */"./src/utils/output-filter.ts");/* harmony import */var _utils_webvtt_parser__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(/*! ../utils/webvtt-parser */"./src/utils/webvtt-parser.ts");/* harmony import */var _utils_texttrack_utils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(/*! ../utils/texttrack-utils */"./src/utils/texttrack-utils.ts");/* harmony import */var _utils_imsc1_ttml_parser__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(/*! ../utils/imsc1-ttml-parser */"./src/utils/imsc1-ttml-parser.ts");/* harmony import */var _types_loader__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(/*! ../types/loader */"./src/types/loader.ts");/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(/*! ../utils/logger */"./src/utils/logger.ts");var TimelineController=/*#__PURE__*/function(){function TimelineController(hls){this.hls=void 0;this.media=null;this.config=void 0;this.enabled=true;this.Cues=void 0;this.textTracks=[];this.tracks=[];this.initPTS=[];this.timescale=[];this.unparsedVttFrags=[];this.captionsTracks={};this.nonNativeCaptionsTracks={};this.cea608Parser1=void 0;this.cea608Parser2=void 0;this.lastSn=-1;this.lastPartIndex=-1;this.prevCC=-1;this.vttCCs=newVTTCCs();this.captionsProperties=void 0;this.hls=hls;this.config=hls.config;this.Cues=hls.config.cueHandler;this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}};if(this.config.enableCEA708Captions){var channel1=new _utils_output_filter__WEBPACK_IMPORTED_MODULE_3__["default"](this,'textTrack1');var channel2=new _utils_output_filter__WEBPACK_IMPORTED_MODULE_3__["default"](this,'textTrack2');var channel3=new _utils_output_filter__WEBPACK_IMPORTED_MODULE_3__["default"](this,'textTrack3');var channel4=new _utils_output_filter__WEBPACK_IMPORTED_MODULE_3__["default"](this,'textTrack4');this.cea608Parser1=new _utils_cea_608_parser__WEBPACK_IMPORTED_MODULE_2__["default"](1,channel1,channel2);this.cea608Parser2=new _utils_cea_608_parser__WEBPACK_IMPORTED_MODULE_2__["default"](3,channel3,channel4);}hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].MEDIA_ATTACHING,this.onMediaAttaching,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].MANIFEST_LOADING,this.onManifestLoading,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].MANIFEST_LOADED,this.onManifestLoaded,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].FRAG_LOADING,this.onFragLoading,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].FRAG_LOADED,this.onFragLoaded,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].FRAG_DECRYPTED,this.onFragDecrypted,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].INIT_PTS_FOUND,this.onInitPtsFound,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].BUFFER_FLUSHING,this.onBufferFlushing,this);}var _proto=TimelineController.prototype;_proto.destroy=function destroy(){var hls=this.hls;hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].MEDIA_ATTACHING,this.onMediaAttaching,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].MEDIA_DETACHING,this.onMediaDetaching,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].MANIFEST_LOADING,this.onManifestLoading,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].MANIFEST_LOADED,this.onManifestLoaded,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].FRAG_LOADING,this.onFragLoading,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].FRAG_LOADED,this.onFragLoaded,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].FRAG_DECRYPTED,this.onFragDecrypted,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].INIT_PTS_FOUND,this.onInitPtsFound,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].BUFFER_FLUSHING,this.onBufferFlushing,this);// @ts-ignore
this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null;};_proto.addCues=function addCues(trackName,startTime,endTime,screen,cueRanges){// skip cues which overlap more than 50% with previously parsed time ranges
var merged=false;for(var i=cueRanges.length;i--;){var cueRange=cueRanges[i];var overlap=intersection(cueRange[0],cueRange[1],startTime,endTime);if(overlap>=0){cueRange[0]=Math.min(cueRange[0],startTime);cueRange[1]=Math.max(cueRange[1],endTime);merged=true;if(overlap/(endTime-startTime)>0.5){return;}}}if(!merged){cueRanges.push([startTime,endTime]);}if(this.config.renderTextTracksNatively){var track=this.captionsTracks[trackName];this.Cues.newCue(track,startTime,endTime,screen);}else{var cues=this.Cues.newCue(null,startTime,endTime,screen);this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].CUES_PARSED,{type:'captions',cues:cues,track:trackName});}}// Triggered when an initial PTS is found; used for synchronisation of WebVTT.
;_proto.onInitPtsFound=function onInitPtsFound(event,_ref){var _this=this;var frag=_ref.frag,id=_ref.id,initPTS=_ref.initPTS,timescale=_ref.timescale;var unparsedVttFrags=this.unparsedVttFrags;if(id==='main'){this.initPTS[frag.cc]=initPTS;this.timescale[frag.cc]=timescale;}// Due to asynchronous processing, initial PTS may arrive later than the first VTT fragments are loaded.
// Parse any unparsed fragments upon receiving the initial PTS.
if(unparsedVttFrags.length){this.unparsedVttFrags=[];unparsedVttFrags.forEach(function(frag){_this.onFragLoaded(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].FRAG_LOADED,frag);});}};_proto.getExistingTrack=function getExistingTrack(trackName){var media=this.media;if(media){for(var i=0;i<media.textTracks.length;i++){var textTrack=media.textTracks[i];if(textTrack[trackName]){return textTrack;}}}return null;};_proto.createCaptionsTrack=function createCaptionsTrack(trackName){if(this.config.renderTextTracksNatively){this.createNativeTrack(trackName);}else{this.createNonNativeTrack(trackName);}};_proto.createNativeTrack=function createNativeTrack(trackName){if(this.captionsTracks[trackName]){return;}var captionsProperties=this.captionsProperties,captionsTracks=this.captionsTracks,media=this.media;var _captionsProperties$t=captionsProperties[trackName],label=_captionsProperties$t.label,languageCode=_captionsProperties$t.languageCode;// Enable reuse of existing text track.
var existingTrack=this.getExistingTrack(trackName);if(!existingTrack){var textTrack=this.createTextTrack('captions',label,languageCode);if(textTrack){// Set a special property on the track so we know it's managed by Hls.js
textTrack[trackName]=true;captionsTracks[trackName]=textTrack;}}else{captionsTracks[trackName]=existingTrack;Object(_utils_texttrack_utils__WEBPACK_IMPORTED_MODULE_5__["clearCurrentCues"])(captionsTracks[trackName]);Object(_utils_texttrack_utils__WEBPACK_IMPORTED_MODULE_5__["sendAddTrackEvent"])(captionsTracks[trackName],media);}};_proto.createNonNativeTrack=function createNonNativeTrack(trackName){if(this.nonNativeCaptionsTracks[trackName]){return;}// Create a list of a single track for the provider to consume
var trackProperties=this.captionsProperties[trackName];if(!trackProperties){return;}var label=trackProperties.label;var track={_id:trackName,label:label,kind:'captions',default:trackProperties.media?!!trackProperties.media.default:false,closedCaptions:trackProperties.media};this.nonNativeCaptionsTracks[trackName]=track;this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[track]});};_proto.createTextTrack=function createTextTrack(kind,label,lang){var media=this.media;if(!media){return;}return media.addTextTrack(kind,label,lang);};_proto.onMediaAttaching=function onMediaAttaching(event,data){this.media=data.media;this._cleanTracks();};_proto.onMediaDetaching=function onMediaDetaching(){var captionsTracks=this.captionsTracks;Object.keys(captionsTracks).forEach(function(trackName){Object(_utils_texttrack_utils__WEBPACK_IMPORTED_MODULE_5__["clearCurrentCues"])(captionsTracks[trackName]);delete captionsTracks[trackName];});this.nonNativeCaptionsTracks={};};_proto.onManifestLoading=function onManifestLoading(){this.lastSn=-1;// Detect discontinuity in fragment parsing
this.lastPartIndex=-1;this.prevCC=-1;this.vttCCs=newVTTCCs();// Detect discontinuity in subtitle manifests
this._cleanTracks();this.tracks=[];this.captionsTracks={};this.nonNativeCaptionsTracks={};this.textTracks=[];this.unparsedVttFrags=this.unparsedVttFrags||[];this.initPTS=[];this.timescale=[];if(this.cea608Parser1&&this.cea608Parser2){this.cea608Parser1.reset();this.cea608Parser2.reset();}};_proto._cleanTracks=function _cleanTracks(){// clear outdated subtitles
var media=this.media;if(!media){return;}var textTracks=media.textTracks;if(textTracks){for(var i=0;i<textTracks.length;i++){Object(_utils_texttrack_utils__WEBPACK_IMPORTED_MODULE_5__["clearCurrentCues"])(textTracks[i]);}}};_proto.onSubtitleTracksUpdated=function onSubtitleTracksUpdated(event,data){var _this2=this;this.textTracks=[];var tracks=data.subtitleTracks||[];var hasIMSC1=tracks.some(function(track){return track.textCodec===_utils_imsc1_ttml_parser__WEBPACK_IMPORTED_MODULE_6__["IMSC1_CODEC"];});if(this.config.enableWebVTT||hasIMSC1&&this.config.enableIMSC1){var sameTracks=this.tracks&&tracks&&this.tracks.length===tracks.length;this.tracks=tracks||[];if(this.config.renderTextTracksNatively){var inUseTracks=this.media?this.media.textTracks:[];this.tracks.forEach(function(track,index){var textTrack;if(index<inUseTracks.length){var inUseTrack=null;for(var i=0;i<inUseTracks.length;i++){if(canReuseVttTextTrack(inUseTracks[i],track)){inUseTrack=inUseTracks[i];break;}}// Reuse tracks with the same label, but do not reuse 608/708 tracks
if(inUseTrack){textTrack=inUseTrack;}}if(textTrack){Object(_utils_texttrack_utils__WEBPACK_IMPORTED_MODULE_5__["clearCurrentCues"])(textTrack);}else{textTrack=_this2.createTextTrack('subtitles',track.name,track.lang);if(textTrack){textTrack.mode='disabled';}}if(textTrack){textTrack.groupId=track.groupId;_this2.textTracks.push(textTrack);}});}else if(!sameTracks&&this.tracks&&this.tracks.length){// Create a list of tracks for the provider to consume
var tracksList=this.tracks.map(function(track){return{label:track.name,kind:track.type.toLowerCase(),default:track.default,subtitleTrack:track};});this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:tracksList});}}};_proto.onManifestLoaded=function onManifestLoaded(event,data){var _this3=this;if(this.config.enableCEA708Captions&&data.captions){data.captions.forEach(function(captionsTrack){var instreamIdMatch=/(?:CC|SERVICE)([1-4])/.exec(captionsTrack.instreamId);if(!instreamIdMatch){return;}var trackName="textTrack"+instreamIdMatch[1];var trackProperties=_this3.captionsProperties[trackName];if(!trackProperties){return;}trackProperties.label=captionsTrack.name;if(captionsTrack.lang){// optional attribute
trackProperties.languageCode=captionsTrack.lang;}trackProperties.media=captionsTrack;});}};_proto.onFragLoading=function onFragLoading(event,data){var cea608Parser1=this.cea608Parser1,cea608Parser2=this.cea608Parser2,lastSn=this.lastSn,lastPartIndex=this.lastPartIndex;if(!this.enabled||!(cea608Parser1&&cea608Parser2)){return;}// if this frag isn't contiguous, clear the parser so cues with bad start/end times aren't added to the textTrack
if(data.frag.type===_types_loader__WEBPACK_IMPORTED_MODULE_7__["PlaylistLevelType"].MAIN){var _data$part$index,_data$part;var sn=data.frag.sn;var partIndex=(_data$part$index=data===null||data===void 0?void 0:(_data$part=data.part)===null||_data$part===void 0?void 0:_data$part.index)!=null?_data$part$index:-1;if(!(sn===lastSn+1||sn===lastSn&&partIndex===lastPartIndex+1)){cea608Parser1.reset();cea608Parser2.reset();}this.lastSn=sn;this.lastPartIndex=partIndex;}};_proto.onFragLoaded=function onFragLoaded(event,data){var frag=data.frag,payload=data.payload;var initPTS=this.initPTS,unparsedVttFrags=this.unparsedVttFrags;if(frag.type===_types_loader__WEBPACK_IMPORTED_MODULE_7__["PlaylistLevelType"].SUBTITLE){// If fragment is subtitle type, parse as WebVTT.
if(payload.byteLength){// We need an initial synchronisation PTS. Store fragments as long as none has arrived.
if(!Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(initPTS[frag.cc])){unparsedVttFrags.push(data);if(initPTS.length){// finish unsuccessfully, otherwise the subtitle-stream-controller could be blocked from loading new frags.
this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].SUBTITLE_FRAG_PROCESSED,{success:false,frag:frag,error:new Error('Missing initial subtitle PTS')});}return;}var decryptData=frag.decryptdata;// fragment after decryption has a stats object
var decrypted=('stats'in data);// If the subtitles are not encrypted, parse VTTs now. Otherwise, we need to wait.
if(decryptData==null||decryptData.key==null||decryptData.method!=='AES-128'||decrypted){var trackPlaylistMedia=this.tracks[frag.level];var vttCCs=this.vttCCs;if(!vttCCs[frag.cc]){vttCCs[frag.cc]={start:frag.start,prevCC:this.prevCC,new:true};this.prevCC=frag.cc;}if(trackPlaylistMedia&&trackPlaylistMedia.textCodec===_utils_imsc1_ttml_parser__WEBPACK_IMPORTED_MODULE_6__["IMSC1_CODEC"]){this._parseIMSC1(frag,payload);}else{this._parseVTTs(frag,payload,vttCCs);}}}else{// In case there is no payload, finish unsuccessfully.
this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].SUBTITLE_FRAG_PROCESSED,{success:false,frag:frag,error:new Error('Empty subtitle payload')});}}};_proto._parseIMSC1=function _parseIMSC1(frag,payload){var _this4=this;var hls=this.hls;Object(_utils_imsc1_ttml_parser__WEBPACK_IMPORTED_MODULE_6__["parseIMSC1"])(payload,this.initPTS[frag.cc],this.timescale[frag.cc],function(cues){_this4._appendCues(cues,frag.level);hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].SUBTITLE_FRAG_PROCESSED,{success:true,frag:frag});},function(error){_utils_logger__WEBPACK_IMPORTED_MODULE_8__["logger"].log("Failed to parse IMSC1: "+error);hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].SUBTITLE_FRAG_PROCESSED,{success:false,frag:frag,error:error});});};_proto._parseVTTs=function _parseVTTs(frag,payload,vttCCs){var _this5=this;var hls=this.hls;// Parse the WebVTT file contents.
Object(_utils_webvtt_parser__WEBPACK_IMPORTED_MODULE_4__["parseWebVTT"])(payload,this.initPTS[frag.cc],this.timescale[frag.cc],vttCCs,frag.cc,frag.start,function(cues){_this5._appendCues(cues,frag.level);hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].SUBTITLE_FRAG_PROCESSED,{success:true,frag:frag});},function(error){_this5._fallbackToIMSC1(frag,payload);// Something went wrong while parsing. Trigger event with success false.
_utils_logger__WEBPACK_IMPORTED_MODULE_8__["logger"].log("Failed to parse VTT cue: "+error);hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].SUBTITLE_FRAG_PROCESSED,{success:false,frag:frag,error:error});});};_proto._fallbackToIMSC1=function _fallbackToIMSC1(frag,payload){var _this6=this;// If textCodec is unknown, try parsing as IMSC1. Set textCodec based on the result
var trackPlaylistMedia=this.tracks[frag.level];if(!trackPlaylistMedia.textCodec){Object(_utils_imsc1_ttml_parser__WEBPACK_IMPORTED_MODULE_6__["parseIMSC1"])(payload,this.initPTS[frag.cc],this.timescale[frag.cc],function(){trackPlaylistMedia.textCodec=_utils_imsc1_ttml_parser__WEBPACK_IMPORTED_MODULE_6__["IMSC1_CODEC"];_this6._parseIMSC1(frag,payload);},function(){trackPlaylistMedia.textCodec='wvtt';});}};_proto._appendCues=function _appendCues(cues,fragLevel){var hls=this.hls;if(this.config.renderTextTracksNatively){var textTrack=this.textTracks[fragLevel];// WebVTTParser.parse is an async method and if the currently selected text track mode is set to "disabled"
// before parsing is done then don't try to access currentTrack.cues.getCueById as cues will be null
// and trying to access getCueById method of cues will throw an exception
// Because we check if the mode is disabled, we can force check `cues` below. They can't be null.
if(textTrack.mode==='disabled'){return;}cues.forEach(function(cue){return Object(_utils_texttrack_utils__WEBPACK_IMPORTED_MODULE_5__["addCueToTrack"])(textTrack,cue);});}else{var currentTrack=this.tracks[fragLevel];var track=currentTrack.default?'default':'subtitles'+fragLevel;hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].CUES_PARSED,{type:'subtitles',cues:cues,track:track});}};_proto.onFragDecrypted=function onFragDecrypted(event,data){var frag=data.frag;if(frag.type===_types_loader__WEBPACK_IMPORTED_MODULE_7__["PlaylistLevelType"].SUBTITLE){if(!Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(this.initPTS[frag.cc])){this.unparsedVttFrags.push(data);return;}this.onFragLoaded(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].FRAG_LOADED,data);}};_proto.onSubtitleTracksCleared=function onSubtitleTracksCleared(){this.tracks=[];this.captionsTracks={};};_proto.onFragParsingUserdata=function onFragParsingUserdata(event,data){var cea608Parser1=this.cea608Parser1,cea608Parser2=this.cea608Parser2;if(!this.enabled||!(cea608Parser1&&cea608Parser2)){return;}// If the event contains captions (found in the bytes property), push all bytes into the parser immediately
// It will create the proper timestamps based on the PTS value
for(var i=0;i<data.samples.length;i++){var ccBytes=data.samples[i].bytes;if(ccBytes){var ccdatas=this.extractCea608Data(ccBytes);cea608Parser1.addData(data.samples[i].pts,ccdatas[0]);cea608Parser2.addData(data.samples[i].pts,ccdatas[1]);}}};_proto.onBufferFlushing=function onBufferFlushing(event,_ref2){var startOffset=_ref2.startOffset,endOffset=_ref2.endOffset,endOffsetSubtitles=_ref2.endOffsetSubtitles,type=_ref2.type;var media=this.media;if(!media||media.currentTime<endOffset){return;}// Clear 608 caption cues from the captions TextTracks when the video back buffer is flushed
// Forward cues are never removed because we can loose streamed 608 content from recent fragments
if(!type||type==='video'){var captionsTracks=this.captionsTracks;Object.keys(captionsTracks).forEach(function(trackName){return Object(_utils_texttrack_utils__WEBPACK_IMPORTED_MODULE_5__["removeCuesInRange"])(captionsTracks[trackName],startOffset,endOffset);});}if(this.config.renderTextTracksNatively){// Clear VTT/IMSC1 subtitle cues from the subtitle TextTracks when the back buffer is flushed
if(startOffset===0&&endOffsetSubtitles!==undefined){var textTracks=this.textTracks;Object.keys(textTracks).forEach(function(trackName){return Object(_utils_texttrack_utils__WEBPACK_IMPORTED_MODULE_5__["removeCuesInRange"])(textTracks[trackName],startOffset,endOffsetSubtitles);});}}};_proto.extractCea608Data=function extractCea608Data(byteArray){var count=byteArray[0]&31;var position=2;var actualCCBytes=[[],[]];for(var j=0;j<count;j++){var tmpByte=byteArray[position++];var ccbyte1=0x7f&byteArray[position++];var ccbyte2=0x7f&byteArray[position++];var ccValid=(4&tmpByte)!==0;var ccType=3&tmpByte;if(ccbyte1===0&&ccbyte2===0){continue;}if(ccValid){if(ccType===0||ccType===1){actualCCBytes[ccType].push(ccbyte1);actualCCBytes[ccType].push(ccbyte2);}}}return actualCCBytes;};return TimelineController;}();function canReuseVttTextTrack(inUseTrack,manifestTrack){return inUseTrack&&inUseTrack.label===manifestTrack.name&&!(inUseTrack.textTrack1||inUseTrack.textTrack2);}function intersection(x1,x2,y1,y2){return Math.min(x2,y2)-Math.max(x1,y1);}function newVTTCCs(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:false}};}/***/},/***/"./src/crypt/aes-crypto.ts":/*!*********************************!*\
			  !*** ./src/crypt/aes-crypto.ts ***!
			  \*********************************/ /*! exports provided: default */ /***/function srcCryptAesCryptoTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"default",function(){return AESCrypto;});var AESCrypto=/*#__PURE__*/function(){function AESCrypto(subtle,iv){this.subtle=void 0;this.aesIV=void 0;this.subtle=subtle;this.aesIV=iv;}var _proto=AESCrypto.prototype;_proto.decrypt=function decrypt(data,key){return this.subtle.decrypt({name:'AES-CBC',iv:this.aesIV},key,data);};return AESCrypto;}();/***/},/***/"./src/crypt/aes-decryptor.ts":/*!************************************!*\
			  !*** ./src/crypt/aes-decryptor.ts ***!
			  \************************************/ /*! exports provided: removePadding, default */ /***/function srcCryptAesDecryptorTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"removePadding",function(){return removePadding;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"default",function(){return AESDecryptor;});/* harmony import */var _utils_typed_array__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../utils/typed-array */"./src/utils/typed-array.ts");// PKCS7
function removePadding(array){var outputBytes=array.byteLength;var paddingBytes=outputBytes&&new DataView(array.buffer).getUint8(outputBytes-1);if(paddingBytes){return Object(_utils_typed_array__WEBPACK_IMPORTED_MODULE_0__["sliceUint8"])(array,0,outputBytes-paddingBytes);}return array;}var AESDecryptor=/*#__PURE__*/function(){function AESDecryptor(){this.rcon=[0x0,0x1,0x2,0x4,0x8,0x10,0x20,0x40,0x80,0x1b,0x36];this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)];this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)];this.sBox=new Uint32Array(256);this.invSBox=new Uint32Array(256);this.key=new Uint32Array(0);this.ksRows=0;this.keySize=0;this.keySchedule=void 0;this.invKeySchedule=void 0;this.initTable();}// Using view.getUint32() also swaps the byte order.
var _proto=AESDecryptor.prototype;_proto.uint8ArrayToUint32Array_=function uint8ArrayToUint32Array_(arrayBuffer){var view=new DataView(arrayBuffer);var newArray=new Uint32Array(4);for(var i=0;i<4;i++){newArray[i]=view.getUint32(i*4);}return newArray;};_proto.initTable=function initTable(){var sBox=this.sBox;var invSBox=this.invSBox;var subMix=this.subMix;var subMix0=subMix[0];var subMix1=subMix[1];var subMix2=subMix[2];var subMix3=subMix[3];var invSubMix=this.invSubMix;var invSubMix0=invSubMix[0];var invSubMix1=invSubMix[1];var invSubMix2=invSubMix[2];var invSubMix3=invSubMix[3];var d=new Uint32Array(256);var x=0;var xi=0;var i=0;for(i=0;i<256;i++){if(i<128){d[i]=i<<1;}else{d[i]=i<<1^0x11b;}}for(i=0;i<256;i++){var sx=xi^xi<<1^xi<<2^xi<<3^xi<<4;sx=sx>>>8^sx&0xff^0x63;sBox[x]=sx;invSBox[sx]=x;// Compute multiplication
var x2=d[x];var x4=d[x2];var x8=d[x4];// Compute sub/invSub bytes, mix columns tables
var t=d[sx]*0x101^sx*0x1010100;subMix0[x]=t<<24|t>>>8;subMix1[x]=t<<16|t>>>16;subMix2[x]=t<<8|t>>>24;subMix3[x]=t;// Compute inv sub bytes, inv mix columns tables
t=x8*0x1010101^x4*0x10001^x2*0x101^x*0x1010100;invSubMix0[sx]=t<<24|t>>>8;invSubMix1[sx]=t<<16|t>>>16;invSubMix2[sx]=t<<8|t>>>24;invSubMix3[sx]=t;// Compute next counter
if(!x){x=xi=1;}else{x=x2^d[d[d[x8^x2]]];xi^=d[d[xi]];}}};_proto.expandKey=function expandKey(keyBuffer){// convert keyBuffer to Uint32Array
var key=this.uint8ArrayToUint32Array_(keyBuffer);var sameKey=true;var offset=0;while(offset<key.length&&sameKey){sameKey=key[offset]===this.key[offset];offset++;}if(sameKey){return;}this.key=key;var keySize=this.keySize=key.length;if(keySize!==4&&keySize!==6&&keySize!==8){throw new Error('Invalid aes key size='+keySize);}var ksRows=this.ksRows=(keySize+6+1)*4;var ksRow;var invKsRow;var keySchedule=this.keySchedule=new Uint32Array(ksRows);var invKeySchedule=this.invKeySchedule=new Uint32Array(ksRows);var sbox=this.sBox;var rcon=this.rcon;var invSubMix=this.invSubMix;var invSubMix0=invSubMix[0];var invSubMix1=invSubMix[1];var invSubMix2=invSubMix[2];var invSubMix3=invSubMix[3];var prev;var t;for(ksRow=0;ksRow<ksRows;ksRow++){if(ksRow<keySize){prev=keySchedule[ksRow]=key[ksRow];continue;}t=prev;if(ksRow%keySize===0){// Rot word
t=t<<8|t>>>24;// Sub word
t=sbox[t>>>24]<<24|sbox[t>>>16&0xff]<<16|sbox[t>>>8&0xff]<<8|sbox[t&0xff];// Mix Rcon
t^=rcon[ksRow/keySize|0]<<24;}else if(keySize>6&&ksRow%keySize===4){// Sub word
t=sbox[t>>>24]<<24|sbox[t>>>16&0xff]<<16|sbox[t>>>8&0xff]<<8|sbox[t&0xff];}keySchedule[ksRow]=prev=(keySchedule[ksRow-keySize]^t)>>>0;}for(invKsRow=0;invKsRow<ksRows;invKsRow++){ksRow=ksRows-invKsRow;if(invKsRow&3){t=keySchedule[ksRow];}else{t=keySchedule[ksRow-4];}if(invKsRow<4||ksRow<=4){invKeySchedule[invKsRow]=t;}else{invKeySchedule[invKsRow]=invSubMix0[sbox[t>>>24]]^invSubMix1[sbox[t>>>16&0xff]]^invSubMix2[sbox[t>>>8&0xff]]^invSubMix3[sbox[t&0xff]];}invKeySchedule[invKsRow]=invKeySchedule[invKsRow]>>>0;}}// Adding this as a method greatly improves performance.
;_proto.networkToHostOrderSwap=function networkToHostOrderSwap(word){return word<<24|(word&0xff00)<<8|(word&0xff0000)>>8|word>>>24;};_proto.decrypt=function decrypt(inputArrayBuffer,offset,aesIV){var nRounds=this.keySize+6;var invKeySchedule=this.invKeySchedule;var invSBOX=this.invSBox;var invSubMix=this.invSubMix;var invSubMix0=invSubMix[0];var invSubMix1=invSubMix[1];var invSubMix2=invSubMix[2];var invSubMix3=invSubMix[3];var initVector=this.uint8ArrayToUint32Array_(aesIV);var initVector0=initVector[0];var initVector1=initVector[1];var initVector2=initVector[2];var initVector3=initVector[3];var inputInt32=new Int32Array(inputArrayBuffer);var outputInt32=new Int32Array(inputInt32.length);var t0,t1,t2,t3;var s0,s1,s2,s3;var inputWords0,inputWords1,inputWords2,inputWords3;var ksRow,i;var swapWord=this.networkToHostOrderSwap;while(offset<inputInt32.length){inputWords0=swapWord(inputInt32[offset]);inputWords1=swapWord(inputInt32[offset+1]);inputWords2=swapWord(inputInt32[offset+2]);inputWords3=swapWord(inputInt32[offset+3]);s0=inputWords0^invKeySchedule[0];s1=inputWords3^invKeySchedule[1];s2=inputWords2^invKeySchedule[2];s3=inputWords1^invKeySchedule[3];ksRow=4;// Iterate through the rounds of decryption
for(i=1;i<nRounds;i++){t0=invSubMix0[s0>>>24]^invSubMix1[s1>>16&0xff]^invSubMix2[s2>>8&0xff]^invSubMix3[s3&0xff]^invKeySchedule[ksRow];t1=invSubMix0[s1>>>24]^invSubMix1[s2>>16&0xff]^invSubMix2[s3>>8&0xff]^invSubMix3[s0&0xff]^invKeySchedule[ksRow+1];t2=invSubMix0[s2>>>24]^invSubMix1[s3>>16&0xff]^invSubMix2[s0>>8&0xff]^invSubMix3[s1&0xff]^invKeySchedule[ksRow+2];t3=invSubMix0[s3>>>24]^invSubMix1[s0>>16&0xff]^invSubMix2[s1>>8&0xff]^invSubMix3[s2&0xff]^invKeySchedule[ksRow+3];// Update state
s0=t0;s1=t1;s2=t2;s3=t3;ksRow=ksRow+4;}// Shift rows, sub bytes, add round key
t0=invSBOX[s0>>>24]<<24^invSBOX[s1>>16&0xff]<<16^invSBOX[s2>>8&0xff]<<8^invSBOX[s3&0xff]^invKeySchedule[ksRow];t1=invSBOX[s1>>>24]<<24^invSBOX[s2>>16&0xff]<<16^invSBOX[s3>>8&0xff]<<8^invSBOX[s0&0xff]^invKeySchedule[ksRow+1];t2=invSBOX[s2>>>24]<<24^invSBOX[s3>>16&0xff]<<16^invSBOX[s0>>8&0xff]<<8^invSBOX[s1&0xff]^invKeySchedule[ksRow+2];t3=invSBOX[s3>>>24]<<24^invSBOX[s0>>16&0xff]<<16^invSBOX[s1>>8&0xff]<<8^invSBOX[s2&0xff]^invKeySchedule[ksRow+3];// Write
outputInt32[offset]=swapWord(t0^initVector0);outputInt32[offset+1]=swapWord(t3^initVector1);outputInt32[offset+2]=swapWord(t2^initVector2);outputInt32[offset+3]=swapWord(t1^initVector3);// reset initVector to last 4 unsigned int
initVector0=inputWords0;initVector1=inputWords1;initVector2=inputWords2;initVector3=inputWords3;offset=offset+4;}return outputInt32.buffer;};return AESDecryptor;}();/***/},/***/"./src/crypt/decrypter.ts":/*!********************************!*\
			  !*** ./src/crypt/decrypter.ts ***!
			  \********************************/ /*! exports provided: default */ /***/function srcCryptDecrypterTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"default",function(){return Decrypter;});/* harmony import */var _aes_crypto__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./aes-crypto */"./src/crypt/aes-crypto.ts");/* harmony import */var _fast_aes_key__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ./fast-aes-key */"./src/crypt/fast-aes-key.ts");/* harmony import */var _aes_decryptor__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ./aes-decryptor */"./src/crypt/aes-decryptor.ts");/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ../utils/logger */"./src/utils/logger.ts");/* harmony import */var _utils_mp4_tools__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts");/* harmony import */var _utils_typed_array__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(/*! ../utils/typed-array */"./src/utils/typed-array.ts");var CHUNK_SIZE=16;// 16 bytes, 128 bits
var Decrypter=/*#__PURE__*/function(){function Decrypter(observer,config,_temp){var _ref=_temp===void 0?{}:_temp,_ref$removePKCS7Paddi=_ref.removePKCS7Padding,removePKCS7Padding=_ref$removePKCS7Paddi===void 0?true:_ref$removePKCS7Paddi;this.logEnabled=true;this.observer=void 0;this.config=void 0;this.removePKCS7Padding=void 0;this.subtle=null;this.softwareDecrypter=null;this.key=null;this.fastAesKey=null;this.remainderData=null;this.currentIV=null;this.currentResult=null;this.observer=observer;this.config=config;this.removePKCS7Padding=removePKCS7Padding;// built in decryptor expects PKCS7 padding
if(removePKCS7Padding){try{var browserCrypto=self.crypto;if(browserCrypto){this.subtle=browserCrypto.subtle||browserCrypto.webkitSubtle;}}catch(e){/* no-op */}}if(this.subtle===null){this.config.enableSoftwareAES=true;}}var _proto=Decrypter.prototype;_proto.destroy=function destroy(){// @ts-ignore
this.observer=null;};_proto.isSync=function isSync(){return this.config.enableSoftwareAES;};_proto.flush=function flush(){var currentResult=this.currentResult;if(!currentResult){this.reset();return;}var data=new Uint8Array(currentResult);this.reset();if(this.removePKCS7Padding){return Object(_aes_decryptor__WEBPACK_IMPORTED_MODULE_2__["removePadding"])(data);}return data;};_proto.reset=function reset(){this.currentResult=null;this.currentIV=null;this.remainderData=null;if(this.softwareDecrypter){this.softwareDecrypter=null;}};_proto.decrypt=function decrypt(data,key,iv,callback){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(data),key,iv);var decryptResult=this.flush();if(decryptResult){callback(decryptResult.buffer);}}else{this.webCryptoDecrypt(new Uint8Array(data),key,iv).then(callback);}};_proto.softwareDecrypt=function softwareDecrypt(data,key,iv){var currentIV=this.currentIV,currentResult=this.currentResult,remainderData=this.remainderData;this.logOnce('JS AES decrypt');// The output is staggered during progressive parsing - the current result is cached, and emitted on the next call
// This is done in order to strip PKCS7 padding, which is found at the end of each segment. We only know we've reached
// the end on flush(), but by that time we have already received all bytes for the segment.
// Progressive decryption does not work with WebCrypto
if(remainderData){data=Object(_utils_mp4_tools__WEBPACK_IMPORTED_MODULE_4__["appendUint8Array"])(remainderData,data);this.remainderData=null;}// Byte length must be a multiple of 16 (AES-128 = 128 bit blocks = 16 bytes)
var currentChunk=this.getValidChunk(data);if(!currentChunk.length){return null;}if(currentIV){iv=currentIV;}var softwareDecrypter=this.softwareDecrypter;if(!softwareDecrypter){softwareDecrypter=this.softwareDecrypter=new _aes_decryptor__WEBPACK_IMPORTED_MODULE_2__["default"]();}softwareDecrypter.expandKey(key);var result=currentResult;this.currentResult=softwareDecrypter.decrypt(currentChunk.buffer,0,iv);this.currentIV=Object(_utils_typed_array__WEBPACK_IMPORTED_MODULE_5__["sliceUint8"])(currentChunk,-16).buffer;if(!result){return null;}return result;};_proto.webCryptoDecrypt=function webCryptoDecrypt(data,key,iv){var _this=this;var subtle=this.subtle;if(this.key!==key||!this.fastAesKey){this.key=key;this.fastAesKey=new _fast_aes_key__WEBPACK_IMPORTED_MODULE_1__["default"](subtle,key);}return this.fastAesKey.expandKey().then(function(aesKey){// decrypt using web crypto
if(!subtle){return Promise.reject(new Error('web crypto not initialized'));}var crypto=new _aes_crypto__WEBPACK_IMPORTED_MODULE_0__["default"](subtle,iv);return crypto.decrypt(data.buffer,aesKey);}).catch(function(err){return _this.onWebCryptoError(err,data,key,iv);});};_proto.onWebCryptoError=function onWebCryptoError(err,data,key,iv){_utils_logger__WEBPACK_IMPORTED_MODULE_3__["logger"].warn('[decrypter.ts]: WebCrypto Error, disable WebCrypto API:',err);this.config.enableSoftwareAES=true;this.logEnabled=true;return this.softwareDecrypt(data,key,iv);};_proto.getValidChunk=function getValidChunk(data){var currentChunk=data;var splitPoint=data.length-data.length%CHUNK_SIZE;if(splitPoint!==data.length){currentChunk=Object(_utils_typed_array__WEBPACK_IMPORTED_MODULE_5__["sliceUint8"])(data,0,splitPoint);this.remainderData=Object(_utils_typed_array__WEBPACK_IMPORTED_MODULE_5__["sliceUint8"])(data,splitPoint);}return currentChunk;};_proto.logOnce=function logOnce(msg){if(!this.logEnabled){return;}_utils_logger__WEBPACK_IMPORTED_MODULE_3__["logger"].log("[decrypter.ts]: "+msg);this.logEnabled=false;};return Decrypter;}();/***/},/***/"./src/crypt/fast-aes-key.ts":/*!***********************************!*\
			  !*** ./src/crypt/fast-aes-key.ts ***!
			  \***********************************/ /*! exports provided: default */ /***/function srcCryptFastAesKeyTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"default",function(){return FastAESKey;});var FastAESKey=/*#__PURE__*/function(){function FastAESKey(subtle,key){this.subtle=void 0;this.key=void 0;this.subtle=subtle;this.key=key;}var _proto=FastAESKey.prototype;_proto.expandKey=function expandKey(){return this.subtle.importKey('raw',this.key,{name:'AES-CBC'},false,['encrypt','decrypt']);};return FastAESKey;}();/***/},/***/"./src/demux/aacdemuxer.ts":/*!*********************************!*\
			  !*** ./src/demux/aacdemuxer.ts ***!
			  \*********************************/ /*! exports provided: default */ /***/function srcDemuxAacdemuxerTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var _base_audio_demuxer__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./base-audio-demuxer */"./src/demux/base-audio-demuxer.ts");/* harmony import */var _adts__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ./adts */"./src/demux/adts.ts");/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../utils/logger */"./src/utils/logger.ts");/* harmony import */var _demux_id3__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ../demux/id3 */"./src/demux/id3.ts");function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype);subClass.prototype.constructor=subClass;_setPrototypeOf(subClass,superClass);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}/**
			 * AAC demuxer
			 */var AACDemuxer=/*#__PURE__*/function(_BaseAudioDemuxer){_inheritsLoose(AACDemuxer,_BaseAudioDemuxer);function AACDemuxer(observer,config){var _this;_this=_BaseAudioDemuxer.call(this)||this;_this.observer=void 0;_this.config=void 0;_this.observer=observer;_this.config=config;return _this;}var _proto=AACDemuxer.prototype;_proto.resetInitSegment=function resetInitSegment(audioCodec,videoCodec,duration){_BaseAudioDemuxer.prototype.resetInitSegment.call(this,audioCodec,videoCodec,duration);this._audioTrack={container:'audio/adts',type:'audio',id:2,pid:-1,sequenceNumber:0,isAAC:true,samples:[],manifestCodec:audioCodec,duration:duration,inputTimeScale:90000,dropped:0};}// Source for probe info - https://wiki.multimedia.cx/index.php?title=ADTS
;AACDemuxer.probe=function probe(data){if(!data){return false;}// Check for the ADTS sync word
// Look for ADTS header | 1111 1111 | 1111 X00X | where X can be either 0 or 1
// Layer bits (position 14 and 15) in header should be always 0 for ADTS
// More info https://wiki.multimedia.cx/index.php?title=ADTS
var id3Data=_demux_id3__WEBPACK_IMPORTED_MODULE_3__["getID3Data"](data,0)||[];var offset=id3Data.length;for(var length=data.length;offset<length;offset++){if(_adts__WEBPACK_IMPORTED_MODULE_1__["probe"](data,offset)){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].log('ADTS sync word found !');return true;}}return false;};_proto.canParse=function canParse(data,offset){return _adts__WEBPACK_IMPORTED_MODULE_1__["canParse"](data,offset);};_proto.appendFrame=function appendFrame(track,data,offset){_adts__WEBPACK_IMPORTED_MODULE_1__["initTrackConfig"](track,this.observer,data,offset,track.manifestCodec);var frame=_adts__WEBPACK_IMPORTED_MODULE_1__["appendFrame"](track,data,offset,this.initPTS,this.frameIndex);if(frame&&frame.missing===0){return frame;}};return AACDemuxer;}(_base_audio_demuxer__WEBPACK_IMPORTED_MODULE_0__["default"]);AACDemuxer.minProbeByteLength=9;/* harmony default export */__webpack_exports__["default"]=AACDemuxer;/***/},/***/"./src/demux/adts.ts":/*!***************************!*\
			  !*** ./src/demux/adts.ts ***!
			  \***************************/ /*! exports provided: getAudioConfig, isHeaderPattern, getHeaderLength, getFullFrameLength, canGetFrameLength, isHeader, canParse, probe, initTrackConfig, getFrameDuration, parseFrameHeader, appendFrame */ /***/function srcDemuxAdtsTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"getAudioConfig",function(){return getAudioConfig;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"isHeaderPattern",function(){return isHeaderPattern;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"getHeaderLength",function(){return getHeaderLength;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"getFullFrameLength",function(){return getFullFrameLength;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"canGetFrameLength",function(){return canGetFrameLength;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"isHeader",function(){return isHeader;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"canParse",function(){return canParse;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"probe",function(){return probe;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"initTrackConfig",function(){return initTrackConfig;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"getFrameDuration",function(){return getFrameDuration;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"parseFrameHeader",function(){return parseFrameHeader;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"appendFrame",function(){return appendFrame;});/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../utils/logger */"./src/utils/logger.ts");/* harmony import */var _errors__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../errors */"./src/errors.ts");/* harmony import */var _events__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../events */"./src/events.ts");/**
			 * ADTS parser helper
			 * @link https://wiki.multimedia.cx/index.php?title=ADTS
			 */function getAudioConfig(observer,data,offset,audioCodec){var adtsObjectType;var adtsExtensionSamplingIndex;var adtsChanelConfig;var config;var userAgent=navigator.userAgent.toLowerCase();var manifestCodec=audioCodec;var adtsSampleingRates=[96000,88200,64000,48000,44100,32000,24000,22050,16000,12000,11025,8000,7350];// byte 2
adtsObjectType=((data[offset+2]&0xc0)>>>6)+1;var adtsSamplingIndex=(data[offset+2]&0x3c)>>>2;if(adtsSamplingIndex>adtsSampleingRates.length-1){observer.trigger(_events__WEBPACK_IMPORTED_MODULE_2__["Events"].ERROR,{type:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorTypes"].MEDIA_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorDetails"].FRAG_PARSING_ERROR,fatal:true,reason:"invalid ADTS sampling index:"+adtsSamplingIndex});return;}adtsChanelConfig=(data[offset+2]&0x01)<<2;// byte 3
adtsChanelConfig|=(data[offset+3]&0xc0)>>>6;_utils_logger__WEBPACK_IMPORTED_MODULE_0__["logger"].log("manifest codec:"+audioCodec+", ADTS type:"+adtsObjectType+", samplingIndex:"+adtsSamplingIndex);// firefox: freq less than 24kHz = AAC SBR (HE-AAC)
if(/firefox/i.test(userAgent)){if(adtsSamplingIndex>=6){adtsObjectType=5;config=new Array(4);// HE-AAC uses SBR (Spectral Band Replication) , high frequencies are constructed from low frequencies
// there is a factor 2 between frame sample rate and output sample rate
// multiply frequency by 2 (see table below, equivalent to substract 3)
adtsExtensionSamplingIndex=adtsSamplingIndex-3;}else{adtsObjectType=2;config=new Array(2);adtsExtensionSamplingIndex=adtsSamplingIndex;}// Android : always use AAC
}else if(userAgent.indexOf('android')!==-1){adtsObjectType=2;config=new Array(2);adtsExtensionSamplingIndex=adtsSamplingIndex;}else{/*  for other browsers (Chrome/Vivaldi/Opera ...)
			        always force audio type to be HE-AAC SBR, as some browsers do not support audio codec switch properly (like Chrome ...)
			    */adtsObjectType=5;config=new Array(4);// if (manifest codec is HE-AAC or HE-AACv2) OR (manifest codec not specified AND frequency less than 24kHz)
if(audioCodec&&(audioCodec.indexOf('mp4a.40.29')!==-1||audioCodec.indexOf('mp4a.40.5')!==-1)||!audioCodec&&adtsSamplingIndex>=6){// HE-AAC uses SBR (Spectral Band Replication) , high frequencies are constructed from low frequencies
// there is a factor 2 between frame sample rate and output sample rate
// multiply frequency by 2 (see table below, equivalent to substract 3)
adtsExtensionSamplingIndex=adtsSamplingIndex-3;}else{// if (manifest codec is AAC) AND (frequency less than 24kHz AND nb channel is 1) OR (manifest codec not specified and mono audio)
// Chrome fails to play back with low frequency AAC LC mono when initialized with HE-AAC.  This is not a problem with stereo.
if(audioCodec&&audioCodec.indexOf('mp4a.40.2')!==-1&&(adtsSamplingIndex>=6&&adtsChanelConfig===1||/vivaldi/i.test(userAgent))||!audioCodec&&adtsChanelConfig===1){adtsObjectType=2;config=new Array(2);}adtsExtensionSamplingIndex=adtsSamplingIndex;}}/* refer to http://wiki.multimedia.cx/index.php?title=MPEG-4_Audio#Audio_Specific_Config
			      ISO 14496-3 (AAC).pdf - Table 1.13 — Syntax of AudioSpecificConfig()
			    Audio Profile / Audio Object Type
			    0: Null
			    1: AAC Main
			    2: AAC LC (Low Complexity)
			    3: AAC SSR (Scalable Sample Rate)
			    4: AAC LTP (Long Term Prediction)
			    5: SBR (Spectral Band Replication)
			    6: AAC Scalable
			   sampling freq
			    0: 96000 Hz
			    1: 88200 Hz
			    2: 64000 Hz
			    3: 48000 Hz
			    4: 44100 Hz
			    5: 32000 Hz
			    6: 24000 Hz
			    7: 22050 Hz
			    8: 16000 Hz
			    9: 12000 Hz
			    10: 11025 Hz
			    11: 8000 Hz
			    12: 7350 Hz
			    13: Reserved
			    14: Reserved
			    15: frequency is written explictly
			    Channel Configurations
			    These are the channel configurations:
			    0: Defined in AOT Specifc Config
			    1: 1 channel: front-center
			    2: 2 channels: front-left, front-right
			  */ // audioObjectType = profile => profile, the MPEG-4 Audio Object Type minus 1
config[0]=adtsObjectType<<3;// samplingFrequencyIndex
config[0]|=(adtsSamplingIndex&0x0e)>>1;config[1]|=(adtsSamplingIndex&0x01)<<7;// channelConfiguration
config[1]|=adtsChanelConfig<<3;if(adtsObjectType===5){// adtsExtensionSampleingIndex
config[1]|=(adtsExtensionSamplingIndex&0x0e)>>1;config[2]=(adtsExtensionSamplingIndex&0x01)<<7;// adtsObjectType (force to 2, chrome is checking that object type is less than 5 ???
//    https://chromium.googlesource.com/chromium/src.git/+/master/media/formats/mp4/aac.cc
config[2]|=2<<2;config[3]=0;}return{config:config,samplerate:adtsSampleingRates[adtsSamplingIndex],channelCount:adtsChanelConfig,codec:'mp4a.40.'+adtsObjectType,manifestCodec:manifestCodec};}function isHeaderPattern(data,offset){return data[offset]===0xff&&(data[offset+1]&0xf6)===0xf0;}function getHeaderLength(data,offset){return data[offset+1]&0x01?7:9;}function getFullFrameLength(data,offset){return(data[offset+3]&0x03)<<11|data[offset+4]<<3|(data[offset+5]&0xe0)>>>5;}function canGetFrameLength(data,offset){return offset+5<data.length;}function isHeader(data,offset){// Look for ADTS header | 1111 1111 | 1111 X00X | where X can be either 0 or 1
// Layer bits (position 14 and 15) in header should be always 0 for ADTS
// More info https://wiki.multimedia.cx/index.php?title=ADTS
return offset+1<data.length&&isHeaderPattern(data,offset);}function canParse(data,offset){return canGetFrameLength(data,offset)&&isHeaderPattern(data,offset)&&getFullFrameLength(data,offset)<=data.length-offset;}function probe(data,offset){// same as isHeader but we also check that ADTS frame follows last ADTS frame
// or end of data is reached
if(isHeader(data,offset)){// ADTS header Length
var headerLength=getHeaderLength(data,offset);if(offset+headerLength>=data.length){return false;}// ADTS frame Length
var frameLength=getFullFrameLength(data,offset);if(frameLength<=headerLength){return false;}var newOffset=offset+frameLength;return newOffset===data.length||isHeader(data,newOffset);}return false;}function initTrackConfig(track,observer,data,offset,audioCodec){if(!track.samplerate){var config=getAudioConfig(observer,data,offset,audioCodec);if(!config){return;}track.config=config.config;track.samplerate=config.samplerate;track.channelCount=config.channelCount;track.codec=config.codec;track.manifestCodec=config.manifestCodec;_utils_logger__WEBPACK_IMPORTED_MODULE_0__["logger"].log("parsed codec:"+track.codec+", rate:"+config.samplerate+", channels:"+config.channelCount);}}function getFrameDuration(samplerate){return 1024*90000/samplerate;}function parseFrameHeader(data,offset,pts,frameIndex,frameDuration){// The protection skip bit tells us if we have 2 bytes of CRC data at the end of the ADTS header
var headerLength=getHeaderLength(data,offset);// retrieve frame size
var frameLength=getFullFrameLength(data,offset);frameLength-=headerLength;if(frameLength>0){var stamp=pts+frameIndex*frameDuration;// logger.log(`AAC frame, offset/length/total/pts:${offset+headerLength}/${frameLength}/${data.byteLength}/${(stamp/90).toFixed(0)}`);
return{headerLength:headerLength,frameLength:frameLength,stamp:stamp};}}function appendFrame(track,data,offset,pts,frameIndex){var frameDuration=getFrameDuration(track.samplerate);var header=parseFrameHeader(data,offset,pts,frameIndex,frameDuration);if(header){var frameLength=header.frameLength,headerLength=header.headerLength,stamp=header.stamp;var length=headerLength+frameLength;var missing=Math.max(0,offset+length-data.length);// logger.log(`AAC frame ${frameIndex}, pts:${stamp} length@offset/total: ${frameLength}@${offset+headerLength}/${data.byteLength} missing: ${missing}`);
var unit;if(missing){unit=new Uint8Array(length-headerLength);unit.set(data.subarray(offset+headerLength,data.length),0);}else{unit=data.subarray(offset+headerLength,offset+length);}var sample={unit:unit,pts:stamp};if(!missing){track.samples.push(sample);}return{sample:sample,length:length,missing:missing};}}/***/},/***/"./src/demux/base-audio-demuxer.ts":/*!*****************************************!*\
			  !*** ./src/demux/base-audio-demuxer.ts ***!
			  \*****************************************/ /*! exports provided: initPTSFn, default */ /***/function srcDemuxBaseAudioDemuxerTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"initPTSFn",function(){return initPTSFn;});/* harmony import */var _home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./src/polyfills/number */"./src/polyfills/number.ts");/* harmony import */var _demux_id3__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../demux/id3 */"./src/demux/id3.ts");/* harmony import */var _dummy_demuxed_track__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ./dummy-demuxed-track */"./src/demux/dummy-demuxed-track.ts");/* harmony import */var _utils_mp4_tools__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts");/* harmony import */var _utils_typed_array__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(/*! ../utils/typed-array */"./src/utils/typed-array.ts");var BaseAudioDemuxer=/*#__PURE__*/function(){function BaseAudioDemuxer(){this._audioTrack=void 0;this._id3Track=void 0;this.frameIndex=0;this.cachedData=null;this.initPTS=null;}var _proto=BaseAudioDemuxer.prototype;_proto.resetInitSegment=function resetInitSegment(audioCodec,videoCodec,duration){this._id3Track={type:'id3',id:3,pid:-1,inputTimeScale:90000,sequenceNumber:0,samples:[],dropped:0};};_proto.resetTimeStamp=function resetTimeStamp(){};_proto.resetContiguity=function resetContiguity(){};_proto.canParse=function canParse(data,offset){return false;};_proto.appendFrame=function appendFrame(track,data,offset){}// feed incoming data to the front of the parsing pipeline
;_proto.demux=function demux(data,timeOffset){if(this.cachedData){data=Object(_utils_mp4_tools__WEBPACK_IMPORTED_MODULE_3__["appendUint8Array"])(this.cachedData,data);this.cachedData=null;}var id3Data=_demux_id3__WEBPACK_IMPORTED_MODULE_1__["getID3Data"](data,0);var offset=id3Data?id3Data.length:0;var lastDataIndex;var pts;var track=this._audioTrack;var id3Track=this._id3Track;var timestamp=id3Data?_demux_id3__WEBPACK_IMPORTED_MODULE_1__["getTimeStamp"](id3Data):undefined;var length=data.length;if(this.frameIndex===0||this.initPTS===null){this.initPTS=initPTSFn(timestamp,timeOffset);}// more expressive than alternative: id3Data?.length
if(id3Data&&id3Data.length>0){id3Track.samples.push({pts:this.initPTS,dts:this.initPTS,data:id3Data});}pts=this.initPTS;while(offset<length){if(this.canParse(data,offset)){var frame=this.appendFrame(track,data,offset);if(frame){this.frameIndex++;pts=frame.sample.pts;offset+=frame.length;lastDataIndex=offset;}else{offset=length;}}else if(_demux_id3__WEBPACK_IMPORTED_MODULE_1__["canParse"](data,offset)){// after a ID3.canParse, a call to ID3.getID3Data *should* always returns some data
id3Data=_demux_id3__WEBPACK_IMPORTED_MODULE_1__["getID3Data"](data,offset);id3Track.samples.push({pts:pts,dts:pts,data:id3Data});offset+=id3Data.length;lastDataIndex=offset;}else{offset++;}if(offset===length&&lastDataIndex!==length){var partialData=Object(_utils_typed_array__WEBPACK_IMPORTED_MODULE_4__["sliceUint8"])(data,lastDataIndex);if(this.cachedData){this.cachedData=Object(_utils_mp4_tools__WEBPACK_IMPORTED_MODULE_3__["appendUint8Array"])(this.cachedData,partialData);}else{this.cachedData=partialData;}}}return{audioTrack:track,avcTrack:Object(_dummy_demuxed_track__WEBPACK_IMPORTED_MODULE_2__["dummyTrack"])(),id3Track:id3Track,textTrack:Object(_dummy_demuxed_track__WEBPACK_IMPORTED_MODULE_2__["dummyTrack"])()};};_proto.demuxSampleAes=function demuxSampleAes(data,keyData,timeOffset){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"));};_proto.flush=function flush(timeOffset){// Parse cache in case of remaining frames.
var cachedData=this.cachedData;if(cachedData){this.cachedData=null;this.demux(cachedData,0);}this.frameIndex=0;return{audioTrack:this._audioTrack,avcTrack:Object(_dummy_demuxed_track__WEBPACK_IMPORTED_MODULE_2__["dummyTrack"])(),id3Track:this._id3Track,textTrack:Object(_dummy_demuxed_track__WEBPACK_IMPORTED_MODULE_2__["dummyTrack"])()};};_proto.destroy=function destroy(){};return BaseAudioDemuxer;}();/**
			 * Initialize PTS
			 * <p>
			 *    use timestamp unless it is undefined, NaN or Infinity
			 * </p>
			 */var initPTSFn=function initPTSFn(timestamp,timeOffset){return Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(timestamp)?timestamp*90:timeOffset*90000;};/* harmony default export */__webpack_exports__["default"]=BaseAudioDemuxer;/***/},/***/"./src/demux/chunk-cache.ts":/*!**********************************!*\
			  !*** ./src/demux/chunk-cache.ts ***!
			  \**********************************/ /*! exports provided: default */ /***/function srcDemuxChunkCacheTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"default",function(){return ChunkCache;});var ChunkCache=/*#__PURE__*/function(){function ChunkCache(){this.chunks=[];this.dataLength=0;}var _proto=ChunkCache.prototype;_proto.push=function push(chunk){this.chunks.push(chunk);this.dataLength+=chunk.length;};_proto.flush=function flush(){var chunks=this.chunks,dataLength=this.dataLength;var result;if(!chunks.length){return new Uint8Array(0);}else if(chunks.length===1){result=chunks[0];}else{result=concatUint8Arrays(chunks,dataLength);}this.reset();return result;};_proto.reset=function reset(){this.chunks.length=0;this.dataLength=0;};return ChunkCache;}();function concatUint8Arrays(chunks,dataLength){var result=new Uint8Array(dataLength);var offset=0;for(var i=0;i<chunks.length;i++){var chunk=chunks[i];result.set(chunk,offset);offset+=chunk.length;}return result;}/***/},/***/"./src/demux/dummy-demuxed-track.ts":/*!******************************************!*\
			  !*** ./src/demux/dummy-demuxed-track.ts ***!
			  \******************************************/ /*! exports provided: dummyTrack */ /***/function srcDemuxDummyDemuxedTrackTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"dummyTrack",function(){return dummyTrack;});function dummyTrack(){return{type:'',id:-1,pid:-1,inputTimeScale:90000,sequenceNumber:-1,samples:[],dropped:0};}/***/},/***/"./src/demux/exp-golomb.ts":/*!*********************************!*\
			  !*** ./src/demux/exp-golomb.ts ***!
			  \*********************************/ /*! exports provided: default */ /***/function srcDemuxExpGolombTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../utils/logger */"./src/utils/logger.ts");/**
			 * Parser for exponential Golomb codes, a variable-bitwidth number encoding scheme used by h264.
			 */var ExpGolomb=/*#__PURE__*/function(){function ExpGolomb(data){this.data=void 0;this.bytesAvailable=void 0;this.word=void 0;this.bitsAvailable=void 0;this.data=data;// the number of bytes left to examine in this.data
this.bytesAvailable=data.byteLength;// the current word being examined
this.word=0;// :uint
// the number of bits left to examine in the current word
this.bitsAvailable=0;// :uint
}// ():void
var _proto=ExpGolomb.prototype;_proto.loadWord=function loadWord(){var data=this.data;var bytesAvailable=this.bytesAvailable;var position=data.byteLength-bytesAvailable;var workingBytes=new Uint8Array(4);var availableBytes=Math.min(4,bytesAvailable);if(availableBytes===0){throw new Error('no bytes available');}workingBytes.set(data.subarray(position,position+availableBytes));this.word=new DataView(workingBytes.buffer).getUint32(0);// track the amount of this.data that has been processed
this.bitsAvailable=availableBytes*8;this.bytesAvailable-=availableBytes;}// (count:int):void
;_proto.skipBits=function skipBits(count){var skipBytes;// :int
if(this.bitsAvailable>count){this.word<<=count;this.bitsAvailable-=count;}else{count-=this.bitsAvailable;skipBytes=count>>3;count-=skipBytes>>3;this.bytesAvailable-=skipBytes;this.loadWord();this.word<<=count;this.bitsAvailable-=count;}}// (size:int):uint
;_proto.readBits=function readBits(size){var bits=Math.min(this.bitsAvailable,size);// :uint
var valu=this.word>>>32-bits;// :uint
if(size>32){_utils_logger__WEBPACK_IMPORTED_MODULE_0__["logger"].error('Cannot read more than 32 bits at a time');}this.bitsAvailable-=bits;if(this.bitsAvailable>0){this.word<<=bits;}else if(this.bytesAvailable>0){this.loadWord();}bits=size-bits;if(bits>0&&this.bitsAvailable){return valu<<bits|this.readBits(bits);}else{return valu;}}// ():uint
;_proto.skipLZ=function skipLZ(){var leadingZeroCount;// :uint
for(leadingZeroCount=0;leadingZeroCount<this.bitsAvailable;++leadingZeroCount){if((this.word&0x80000000>>>leadingZeroCount)!==0){// the first bit of working word is 1
this.word<<=leadingZeroCount;this.bitsAvailable-=leadingZeroCount;return leadingZeroCount;}}// we exhausted word and still have not found a 1
this.loadWord();return leadingZeroCount+this.skipLZ();}// ():void
;_proto.skipUEG=function skipUEG(){this.skipBits(1+this.skipLZ());}// ():void
;_proto.skipEG=function skipEG(){this.skipBits(1+this.skipLZ());}// ():uint
;_proto.readUEG=function readUEG(){var clz=this.skipLZ();// :uint
return this.readBits(clz+1)-1;}// ():int
;_proto.readEG=function readEG(){var valu=this.readUEG();// :int
if(0x01&valu){// the number is odd if the low order bit is set
return 1+valu>>>1;// add 1 to make it even, and divide by 2
}else{return-1*(valu>>>1);// divide by two then make it negative
}}// Some convenience functions
// :Boolean
;_proto.readBoolean=function readBoolean(){return this.readBits(1)===1;}// ():int
;_proto.readUByte=function readUByte(){return this.readBits(8);}// ():int
;_proto.readUShort=function readUShort(){return this.readBits(16);}// ():int
;_proto.readUInt=function readUInt(){return this.readBits(32);}/**
			   * Advance the ExpGolomb decoder past a scaling list. The scaling
			   * list is optionally transmitted as part of a sequence parameter
			   * set and is not relevant to transmuxing.
			   * @param count the number of entries in this scaling list
			   * @see Recommendation ITU-T H.264, Section 7.3.2.1.1.1
			   */;_proto.skipScalingList=function skipScalingList(count){var lastScale=8;var nextScale=8;var deltaScale;for(var j=0;j<count;j++){if(nextScale!==0){deltaScale=this.readEG();nextScale=(lastScale+deltaScale+256)%256;}lastScale=nextScale===0?lastScale:nextScale;}}/**
			   * Read a sequence parameter set and return some interesting video
			   * properties. A sequence parameter set is the H264 metadata that
			   * describes the properties of upcoming video frames.
			   * @param data {Uint8Array} the bytes of a sequence parameter set
			   * @return {object} an object with configuration parsed from the
			   * sequence parameter set, including the dimensions of the
			   * associated video frames.
			   */;_proto.readSPS=function readSPS(){var frameCropLeftOffset=0;var frameCropRightOffset=0;var frameCropTopOffset=0;var frameCropBottomOffset=0;var numRefFramesInPicOrderCntCycle;var scalingListCount;var i;var readUByte=this.readUByte.bind(this);var readBits=this.readBits.bind(this);var readUEG=this.readUEG.bind(this);var readBoolean=this.readBoolean.bind(this);var skipBits=this.skipBits.bind(this);var skipEG=this.skipEG.bind(this);var skipUEG=this.skipUEG.bind(this);var skipScalingList=this.skipScalingList.bind(this);readUByte();var profileIdc=readUByte();// profile_idc
readBits(5);// profileCompat constraint_set[0-4]_flag, u(5)
skipBits(3);// reserved_zero_3bits u(3),
readUByte();// level_idc u(8)
skipUEG();// seq_parameter_set_id
// some profiles have more optional data we don't need
if(profileIdc===100||profileIdc===110||profileIdc===122||profileIdc===244||profileIdc===44||profileIdc===83||profileIdc===86||profileIdc===118||profileIdc===128){var chromaFormatIdc=readUEG();if(chromaFormatIdc===3){skipBits(1);}// separate_colour_plane_flag
skipUEG();// bit_depth_luma_minus8
skipUEG();// bit_depth_chroma_minus8
skipBits(1);// qpprime_y_zero_transform_bypass_flag
if(readBoolean()){// seq_scaling_matrix_present_flag
scalingListCount=chromaFormatIdc!==3?8:12;for(i=0;i<scalingListCount;i++){if(readBoolean()){// seq_scaling_list_present_flag[ i ]
if(i<6){skipScalingList(16);}else{skipScalingList(64);}}}}}skipUEG();// log2_max_frame_num_minus4
var picOrderCntType=readUEG();if(picOrderCntType===0){readUEG();// log2_max_pic_order_cnt_lsb_minus4
}else if(picOrderCntType===1){skipBits(1);// delta_pic_order_always_zero_flag
skipEG();// offset_for_non_ref_pic
skipEG();// offset_for_top_to_bottom_field
numRefFramesInPicOrderCntCycle=readUEG();for(i=0;i<numRefFramesInPicOrderCntCycle;i++){skipEG();}// offset_for_ref_frame[ i ]
}skipUEG();// max_num_ref_frames
skipBits(1);// gaps_in_frame_num_value_allowed_flag
var picWidthInMbsMinus1=readUEG();var picHeightInMapUnitsMinus1=readUEG();var frameMbsOnlyFlag=readBits(1);if(frameMbsOnlyFlag===0){skipBits(1);}// mb_adaptive_frame_field_flag
skipBits(1);// direct_8x8_inference_flag
if(readBoolean()){// frame_cropping_flag
frameCropLeftOffset=readUEG();frameCropRightOffset=readUEG();frameCropTopOffset=readUEG();frameCropBottomOffset=readUEG();}var pixelRatio=[1,1];if(readBoolean()){// vui_parameters_present_flag
if(readBoolean()){// aspect_ratio_info_present_flag
var aspectRatioIdc=readUByte();switch(aspectRatioIdc){case 1:pixelRatio=[1,1];break;case 2:pixelRatio=[12,11];break;case 3:pixelRatio=[10,11];break;case 4:pixelRatio=[16,11];break;case 5:pixelRatio=[40,33];break;case 6:pixelRatio=[24,11];break;case 7:pixelRatio=[20,11];break;case 8:pixelRatio=[32,11];break;case 9:pixelRatio=[80,33];break;case 10:pixelRatio=[18,11];break;case 11:pixelRatio=[15,11];break;case 12:pixelRatio=[64,33];break;case 13:pixelRatio=[160,99];break;case 14:pixelRatio=[4,3];break;case 15:pixelRatio=[3,2];break;case 16:pixelRatio=[2,1];break;case 255:{pixelRatio=[readUByte()<<8|readUByte(),readUByte()<<8|readUByte()];break;}}}}return{width:Math.ceil((picWidthInMbsMinus1+1)*16-frameCropLeftOffset*2-frameCropRightOffset*2),height:(2-frameMbsOnlyFlag)*(picHeightInMapUnitsMinus1+1)*16-(frameMbsOnlyFlag?2:4)*(frameCropTopOffset+frameCropBottomOffset),pixelRatio:pixelRatio};};_proto.readSliceType=function readSliceType(){// skip NALu type
this.readUByte();// discard first_mb_in_slice
this.readUEG();// return slice_type
return this.readUEG();};return ExpGolomb;}();/* harmony default export */__webpack_exports__["default"]=ExpGolomb;/***/},/***/"./src/demux/id3.ts":/*!**************************!*\
			  !*** ./src/demux/id3.ts ***!
			  \**************************/ /*! exports provided: isHeader, isFooter, getID3Data, canParse, getTimeStamp, isTimeStampFrame, getID3Frames, decodeFrame, utf8ArrayToStr, testables */ /***/function srcDemuxId3Ts(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"isHeader",function(){return isHeader;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"isFooter",function(){return isFooter;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"getID3Data",function(){return getID3Data;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"canParse",function(){return canParse;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"getTimeStamp",function(){return getTimeStamp;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"isTimeStampFrame",function(){return isTimeStampFrame;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"getID3Frames",function(){return getID3Frames;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"decodeFrame",function(){return decodeFrame;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"utf8ArrayToStr",function(){return utf8ArrayToStr;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"testables",function(){return testables;});// breaking up those two types in order to clarify what is happening in the decoding path.
/**
			 * Returns true if an ID3 header can be found at offset in data
			 * @param {Uint8Array} data - The data to search in
			 * @param {number} offset - The offset at which to start searching
			 * @return {boolean} - True if an ID3 header is found
			 */var isHeader=function isHeader(data,offset){/*
			   * http://id3.org/id3v2.3.0
			   * [0]     = 'I'
			   * [1]     = 'D'
			   * [2]     = '3'
			   * [3,4]   = {Version}
			   * [5]     = {Flags}
			   * [6-9]   = {ID3 Size}
			   *
			   * An ID3v2 tag can be detected with the following pattern:
			   *  $49 44 33 yy yy xx zz zz zz zz
			   * Where yy is less than $FF, xx is the 'flags' byte and zz is less than $80
			   */if(offset+10<=data.length){// look for 'ID3' identifier
if(data[offset]===0x49&&data[offset+1]===0x44&&data[offset+2]===0x33){// check version is within range
if(data[offset+3]<0xff&&data[offset+4]<0xff){// check size is within range
if(data[offset+6]<0x80&&data[offset+7]<0x80&&data[offset+8]<0x80&&data[offset+9]<0x80){return true;}}}}return false;};/**
			 * Returns true if an ID3 footer can be found at offset in data
			 * @param {Uint8Array} data - The data to search in
			 * @param {number} offset - The offset at which to start searching
			 * @return {boolean} - True if an ID3 footer is found
			 */var isFooter=function isFooter(data,offset){/*
			   * The footer is a copy of the header, but with a different identifier
			   */if(offset+10<=data.length){// look for '3DI' identifier
if(data[offset]===0x33&&data[offset+1]===0x44&&data[offset+2]===0x49){// check version is within range
if(data[offset+3]<0xff&&data[offset+4]<0xff){// check size is within range
if(data[offset+6]<0x80&&data[offset+7]<0x80&&data[offset+8]<0x80&&data[offset+9]<0x80){return true;}}}}return false;};/**
			 * Returns any adjacent ID3 tags found in data starting at offset, as one block of data
			 * @param {Uint8Array} data - The data to search in
			 * @param {number} offset - The offset at which to start searching
			 * @return {Uint8Array | undefined} - The block of data containing any ID3 tags found
			 * or *undefined* if no header is found at the starting offset
			 */var getID3Data=function getID3Data(data,offset){var front=offset;var length=0;while(isHeader(data,offset)){// ID3 header is 10 bytes
length+=10;var size=readSize(data,offset+6);length+=size;if(isFooter(data,offset+10)){// ID3 footer is 10 bytes
length+=10;}offset+=length;}if(length>0){return data.subarray(front,front+length);}return undefined;};var readSize=function readSize(data,offset){var size=0;size=(data[offset]&0x7f)<<21;size|=(data[offset+1]&0x7f)<<14;size|=(data[offset+2]&0x7f)<<7;size|=data[offset+3]&0x7f;return size;};var canParse=function canParse(data,offset){return isHeader(data,offset)&&readSize(data,offset+6)+10<=data.length-offset;};/**
			 * Searches for the Elementary Stream timestamp found in the ID3 data chunk
			 * @param {Uint8Array} data - Block of data containing one or more ID3 tags
			 * @return {number | undefined} - The timestamp
			 */var getTimeStamp=function getTimeStamp(data){var frames=getID3Frames(data);for(var i=0;i<frames.length;i++){var frame=frames[i];if(isTimeStampFrame(frame)){return readTimeStamp(frame);}}return undefined;};/**
			 * Returns true if the ID3 frame is an Elementary Stream timestamp frame
			 * @param {ID3 frame} frame
			 */var isTimeStampFrame=function isTimeStampFrame(frame){return frame&&frame.key==='PRIV'&&frame.info==='com.apple.streaming.transportStreamTimestamp';};var getFrameData=function getFrameData(data){/*
			  Frame ID       $xx xx xx xx (four characters)
			  Size           $xx xx xx xx
			  Flags          $xx xx
			  */var type=String.fromCharCode(data[0],data[1],data[2],data[3]);var size=readSize(data,4);// skip frame id, size, and flags
var offset=10;return{type:type,size:size,data:data.subarray(offset,offset+size)};};/**
			 * Returns an array of ID3 frames found in all the ID3 tags in the id3Data
			 * @param {Uint8Array} id3Data - The ID3 data containing one or more ID3 tags
			 * @return {ID3.Frame[]} - Array of ID3 frame objects
			 */var getID3Frames=function getID3Frames(id3Data){var offset=0;var frames=[];while(isHeader(id3Data,offset)){var size=readSize(id3Data,offset+6);// skip past ID3 header
offset+=10;var end=offset+size;// loop through frames in the ID3 tag
while(offset+8<end){var frameData=getFrameData(id3Data.subarray(offset));var frame=decodeFrame(frameData);if(frame){frames.push(frame);}// skip frame header and frame data
offset+=frameData.size+10;}if(isFooter(id3Data,offset)){offset+=10;}}return frames;};var decodeFrame=function decodeFrame(frame){if(frame.type==='PRIV'){return decodePrivFrame(frame);}else if(frame.type[0]==='W'){return decodeURLFrame(frame);}return decodeTextFrame(frame);};var decodePrivFrame=function decodePrivFrame(frame){/*
			  Format: <text string>\0<binary data>
			  */if(frame.size<2){return undefined;}var owner=utf8ArrayToStr(frame.data,true);var privateData=new Uint8Array(frame.data.subarray(owner.length+1));return{key:frame.type,info:owner,data:privateData.buffer};};var decodeTextFrame=function decodeTextFrame(frame){if(frame.size<2){return undefined;}if(frame.type==='TXXX'){/*
			    Format:
			    [0]   = {Text Encoding}
			    [1-?] = {Description}\0{Value}
			    */var index=1;var description=utf8ArrayToStr(frame.data.subarray(index),true);index+=description.length+1;var value=utf8ArrayToStr(frame.data.subarray(index));return{key:frame.type,info:description,data:value};}/*
			  Format:
			  [0]   = {Text Encoding}
			  [1-?] = {Value}
			  */var text=utf8ArrayToStr(frame.data.subarray(1));return{key:frame.type,data:text};};var decodeURLFrame=function decodeURLFrame(frame){if(frame.type==='WXXX'){/*
			    Format:
			    [0]   = {Text Encoding}
			    [1-?] = {Description}\0{URL}
			    */if(frame.size<2){return undefined;}var index=1;var description=utf8ArrayToStr(frame.data.subarray(index),true);index+=description.length+1;var value=utf8ArrayToStr(frame.data.subarray(index));return{key:frame.type,info:description,data:value};}/*
			  Format:
			  [0-?] = {URL}
			  */var url=utf8ArrayToStr(frame.data);return{key:frame.type,data:url};};var readTimeStamp=function readTimeStamp(timeStampFrame){if(timeStampFrame.data.byteLength===8){var data=new Uint8Array(timeStampFrame.data);// timestamp is 33 bit expressed as a big-endian eight-octet number,
// with the upper 31 bits set to zero.
var pts33Bit=data[3]&0x1;var timestamp=(data[4]<<23)+(data[5]<<15)+(data[6]<<7)+data[7];timestamp/=45;if(pts33Bit){timestamp+=47721858.84;}// 2^32 / 90
return Math.round(timestamp);}return undefined;};// http://stackoverflow.com/questions/8936984/uint8array-to-string-in-javascript/22373197
// http://www.onicos.com/staff/iz/amuse/javascript/expert/utf.txt
/* utf.js - UTF-8 <=> UTF-16 convertion
			 *
			 * Copyright (C) 1999 Masanao Izumo <iz@onicos.co.jp>
			 * Version: 1.0
			 * LastModified: Dec 25 1999
			 * This library is free.  You can redistribute it and/or modify it.
			 */var utf8ArrayToStr=function utf8ArrayToStr(array,exitOnNull){if(exitOnNull===void 0){exitOnNull=false;}var decoder=getTextDecoder();if(decoder){var decoded=decoder.decode(array);if(exitOnNull){// grab up to the first null
var idx=decoded.indexOf('\0');return idx!==-1?decoded.substring(0,idx):decoded;}// remove any null characters
return decoded.replace(/\0/g,'');}var len=array.length;var c;var char2;var char3;var out='';var i=0;while(i<len){c=array[i++];if(c===0x00&&exitOnNull){return out;}else if(c===0x00||c===0x03){// If the character is 3 (END_OF_TEXT) or 0 (NULL) then skip it
continue;}switch(c>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:// 0xxxxxxx
out+=String.fromCharCode(c);break;case 12:case 13:// 110x xxxx   10xx xxxx
char2=array[i++];out+=String.fromCharCode((c&0x1f)<<6|char2&0x3f);break;case 14:// 1110 xxxx  10xx xxxx  10xx xxxx
char2=array[i++];char3=array[i++];out+=String.fromCharCode((c&0x0f)<<12|(char2&0x3f)<<6|(char3&0x3f)<<0);break;}}return out;};var testables={decodeTextFrame:decodeTextFrame};var decoder;function getTextDecoder(){if(!decoder&&typeof self.TextDecoder!=='undefined'){decoder=new self.TextDecoder('utf-8');}return decoder;}/***/},/***/"./src/demux/mp3demuxer.ts":/*!*********************************!*\
			  !*** ./src/demux/mp3demuxer.ts ***!
			  \*********************************/ /*! exports provided: default */ /***/function srcDemuxMp3demuxerTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var _base_audio_demuxer__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./base-audio-demuxer */"./src/demux/base-audio-demuxer.ts");/* harmony import */var _demux_id3__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../demux/id3 */"./src/demux/id3.ts");/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../utils/logger */"./src/utils/logger.ts");/* harmony import */var _mpegaudio__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ./mpegaudio */"./src/demux/mpegaudio.ts");function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype);subClass.prototype.constructor=subClass;_setPrototypeOf(subClass,superClass);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}/**
			 * MP3 demuxer
			 */var MP3Demuxer=/*#__PURE__*/function(_BaseAudioDemuxer){_inheritsLoose(MP3Demuxer,_BaseAudioDemuxer);function MP3Demuxer(){return _BaseAudioDemuxer.apply(this,arguments)||this;}var _proto=MP3Demuxer.prototype;_proto.resetInitSegment=function resetInitSegment(audioCodec,videoCodec,duration){_BaseAudioDemuxer.prototype.resetInitSegment.call(this,audioCodec,videoCodec,duration);this._audioTrack={container:'audio/mpeg',type:'audio',id:2,pid:-1,sequenceNumber:0,isAAC:false,samples:[],manifestCodec:audioCodec,duration:duration,inputTimeScale:90000,dropped:0};};MP3Demuxer.probe=function probe(data){if(!data){return false;}// check if data contains ID3 timestamp and MPEG sync word
// Look for MPEG header | 1111 1111 | 111X XYZX | where X can be either 0 or 1 and Y or Z should be 1
// Layer bits (position 14 and 15) in header should be always different from 0 (Layer I or Layer II or Layer III)
// More info http://www.mp3-tech.org/programmer/frame_header.html
var id3Data=_demux_id3__WEBPACK_IMPORTED_MODULE_1__["getID3Data"](data,0)||[];var offset=id3Data.length;for(var length=data.length;offset<length;offset++){if(_mpegaudio__WEBPACK_IMPORTED_MODULE_3__["probe"](data,offset)){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].log('MPEG Audio sync word found !');return true;}}return false;};_proto.canParse=function canParse(data,offset){return _mpegaudio__WEBPACK_IMPORTED_MODULE_3__["canParse"](data,offset);};_proto.appendFrame=function appendFrame(track,data,offset){if(this.initPTS===null){return;}return _mpegaudio__WEBPACK_IMPORTED_MODULE_3__["appendFrame"](track,data,offset,this.initPTS,this.frameIndex);};return MP3Demuxer;}(_base_audio_demuxer__WEBPACK_IMPORTED_MODULE_0__["default"]);MP3Demuxer.minProbeByteLength=4;/* harmony default export */__webpack_exports__["default"]=MP3Demuxer;/***/},/***/"./src/demux/mp4demuxer.ts":/*!*********************************!*\
			  !*** ./src/demux/mp4demuxer.ts ***!
			  \*********************************/ /*! exports provided: default */ /***/function srcDemuxMp4demuxerTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var _utils_mp4_tools__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts");/* harmony import */var _dummy_demuxed_track__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ./dummy-demuxed-track */"./src/demux/dummy-demuxed-track.ts");/**
			 * MP4 demuxer
			 */var MP4Demuxer=/*#__PURE__*/function(){function MP4Demuxer(observer,config){this.remainderData=null;this.config=void 0;this.config=config;}var _proto=MP4Demuxer.prototype;_proto.resetTimeStamp=function resetTimeStamp(){};_proto.resetInitSegment=function resetInitSegment(){};_proto.resetContiguity=function resetContiguity(){};MP4Demuxer.probe=function probe(data){// ensure we find a moof box in the first 16 kB
return Object(_utils_mp4_tools__WEBPACK_IMPORTED_MODULE_0__["findBox"])({data:data,start:0,end:Math.min(data.length,16384)},['moof']).length>0;};_proto.demux=function demux(data){// Load all data into the avc track. The CMAF remuxer will look for the data in the samples object; the rest of the fields do not matter
var avcSamples=data;var avcTrack=Object(_dummy_demuxed_track__WEBPACK_IMPORTED_MODULE_1__["dummyTrack"])();if(this.config.progressive){// Split the bytestream into two ranges: one encompassing all data up until the start of the last moof, and everything else.
// This is done to guarantee that we're sending valid data to MSE - when demuxing progressively, we have no guarantee
// that the fetch loader gives us flush moof+mdat pairs. If we push jagged data to MSE, it will throw an exception.
if(this.remainderData){avcSamples=Object(_utils_mp4_tools__WEBPACK_IMPORTED_MODULE_0__["appendUint8Array"])(this.remainderData,data);}var segmentedData=Object(_utils_mp4_tools__WEBPACK_IMPORTED_MODULE_0__["segmentValidRange"])(avcSamples);this.remainderData=segmentedData.remainder;avcTrack.samples=segmentedData.valid||new Uint8Array();}else{avcTrack.samples=avcSamples;}return{audioTrack:Object(_dummy_demuxed_track__WEBPACK_IMPORTED_MODULE_1__["dummyTrack"])(),avcTrack:avcTrack,id3Track:Object(_dummy_demuxed_track__WEBPACK_IMPORTED_MODULE_1__["dummyTrack"])(),textTrack:Object(_dummy_demuxed_track__WEBPACK_IMPORTED_MODULE_1__["dummyTrack"])()};};_proto.flush=function flush(){var avcTrack=Object(_dummy_demuxed_track__WEBPACK_IMPORTED_MODULE_1__["dummyTrack"])();avcTrack.samples=this.remainderData||new Uint8Array();this.remainderData=null;return{audioTrack:Object(_dummy_demuxed_track__WEBPACK_IMPORTED_MODULE_1__["dummyTrack"])(),avcTrack:avcTrack,id3Track:Object(_dummy_demuxed_track__WEBPACK_IMPORTED_MODULE_1__["dummyTrack"])(),textTrack:Object(_dummy_demuxed_track__WEBPACK_IMPORTED_MODULE_1__["dummyTrack"])()};};_proto.demuxSampleAes=function demuxSampleAes(data,keyData,timeOffset){return Promise.reject(new Error('The MP4 demuxer does not support SAMPLE-AES decryption'));};_proto.destroy=function destroy(){};return MP4Demuxer;}();MP4Demuxer.minProbeByteLength=1024;/* harmony default export */__webpack_exports__["default"]=MP4Demuxer;/***/},/***/"./src/demux/mpegaudio.ts":/*!********************************!*\
			  !*** ./src/demux/mpegaudio.ts ***!
			  \********************************/ /*! exports provided: appendFrame, parseHeader, isHeaderPattern, isHeader, canParse, probe */ /***/function srcDemuxMpegaudioTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"appendFrame",function(){return appendFrame;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"parseHeader",function(){return parseHeader;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"isHeaderPattern",function(){return isHeaderPattern;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"isHeader",function(){return isHeader;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"canParse",function(){return canParse;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"probe",function(){return probe;});/**
			 *  MPEG parser helper
			 */var chromeVersion=null;var BitratesMap=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160];var SamplingRateMap=[44100,48000,32000,22050,24000,16000,11025,12000,8000];var SamplesCoefficients=[// MPEG 2.5
[0,// Reserved
72,// Layer3
144,// Layer2
12// Layer1
],// Reserved
[0,// Reserved
0,// Layer3
0,// Layer2
0// Layer1
],// MPEG 2
[0,// Reserved
72,// Layer3
144,// Layer2
12// Layer1
],// MPEG 1
[0,// Reserved
144,// Layer3
144,// Layer2
12// Layer1
]];var BytesInSlot=[0,// Reserved
1,// Layer3
1,// Layer2
4// Layer1
];function appendFrame(track,data,offset,pts,frameIndex){// Using http://www.datavoyage.com/mpgscript/mpeghdr.htm as a reference
if(offset+24>data.length){return;}var header=parseHeader(data,offset);if(header&&offset+header.frameLength<=data.length){var frameDuration=header.samplesPerFrame*90000/header.sampleRate;var stamp=pts+frameIndex*frameDuration;var sample={unit:data.subarray(offset,offset+header.frameLength),pts:stamp,dts:stamp};track.config=[];track.channelCount=header.channelCount;track.samplerate=header.sampleRate;track.samples.push(sample);return{sample:sample,length:header.frameLength,missing:0};}}function parseHeader(data,offset){var mpegVersion=data[offset+1]>>3&3;var mpegLayer=data[offset+1]>>1&3;var bitRateIndex=data[offset+2]>>4&15;var sampleRateIndex=data[offset+2]>>2&3;if(mpegVersion!==1&&bitRateIndex!==0&&bitRateIndex!==15&&sampleRateIndex!==3){var paddingBit=data[offset+2]>>1&1;var channelMode=data[offset+3]>>6;var columnInBitrates=mpegVersion===3?3-mpegLayer:mpegLayer===3?3:4;var bitRate=BitratesMap[columnInBitrates*14+bitRateIndex-1]*1000;var columnInSampleRates=mpegVersion===3?0:mpegVersion===2?1:2;var sampleRate=SamplingRateMap[columnInSampleRates*3+sampleRateIndex];var channelCount=channelMode===3?1:2;// If bits of channel mode are `11` then it is a single channel (Mono)
var sampleCoefficient=SamplesCoefficients[mpegVersion][mpegLayer];var bytesInSlot=BytesInSlot[mpegLayer];var samplesPerFrame=sampleCoefficient*8*bytesInSlot;var frameLength=Math.floor(sampleCoefficient*bitRate/sampleRate+paddingBit)*bytesInSlot;if(chromeVersion===null){var userAgent=navigator.userAgent||'';var result=userAgent.match(/Chrome\/(\d+)/i);chromeVersion=result?parseInt(result[1]):0;}var needChromeFix=!!chromeVersion&&chromeVersion<=87;if(needChromeFix&&mpegLayer===2&&bitRate>=224000&&channelMode===0){// Work around bug in Chromium by setting channelMode to dual-channel (01) instead of stereo (00)
data[offset+3]=data[offset+3]|0x80;}return{sampleRate:sampleRate,channelCount:channelCount,frameLength:frameLength,samplesPerFrame:samplesPerFrame};}}function isHeaderPattern(data,offset){return data[offset]===0xff&&(data[offset+1]&0xe0)===0xe0&&(data[offset+1]&0x06)!==0x00;}function isHeader(data,offset){// Look for MPEG header | 1111 1111 | 111X XYZX | where X can be either 0 or 1 and Y or Z should be 1
// Layer bits (position 14 and 15) in header should be always different from 0 (Layer I or Layer II or Layer III)
// More info http://www.mp3-tech.org/programmer/frame_header.html
return offset+1<data.length&&isHeaderPattern(data,offset);}function canParse(data,offset){var headerSize=4;return isHeaderPattern(data,offset)&&headerSize<=data.length-offset;}function probe(data,offset){// same as isHeader but we also check that MPEG frame follows last MPEG frame
// or end of data is reached
if(offset+1<data.length&&isHeaderPattern(data,offset)){// MPEG header Length
var headerLength=4;// MPEG frame Length
var header=parseHeader(data,offset);var frameLength=headerLength;if(header!==null&&header!==void 0&&header.frameLength){frameLength=header.frameLength;}var newOffset=offset+frameLength;return newOffset===data.length||isHeader(data,newOffset);}return false;}/***/},/***/"./src/demux/sample-aes.ts":/*!*********************************!*\
			  !*** ./src/demux/sample-aes.ts ***!
			  \*********************************/ /*! exports provided: default */ /***/function srcDemuxSampleAesTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var _crypt_decrypter__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../crypt/decrypter */"./src/crypt/decrypter.ts");/* harmony import */var _tsdemuxer__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ./tsdemuxer */"./src/demux/tsdemuxer.ts");/**
			 * SAMPLE-AES decrypter
			 */var SampleAesDecrypter=/*#__PURE__*/function(){function SampleAesDecrypter(observer,config,keyData){this.keyData=void 0;this.decrypter=void 0;this.keyData=keyData;this.decrypter=new _crypt_decrypter__WEBPACK_IMPORTED_MODULE_0__["default"](observer,config,{removePKCS7Padding:false});}var _proto=SampleAesDecrypter.prototype;_proto.decryptBuffer=function decryptBuffer(encryptedData,callback){this.decrypter.decrypt(encryptedData,this.keyData.key.buffer,this.keyData.iv.buffer,callback);}// AAC - encrypt all full 16 bytes blocks starting from offset 16
;_proto.decryptAacSample=function decryptAacSample(samples,sampleIndex,callback,sync){var curUnit=samples[sampleIndex].unit;var encryptedData=curUnit.subarray(16,curUnit.length-curUnit.length%16);var encryptedBuffer=encryptedData.buffer.slice(encryptedData.byteOffset,encryptedData.byteOffset+encryptedData.length);var localthis=this;this.decryptBuffer(encryptedBuffer,function(decryptedBuffer){var decryptedData=new Uint8Array(decryptedBuffer);curUnit.set(decryptedData,16);if(!sync){localthis.decryptAacSamples(samples,sampleIndex+1,callback);}});};_proto.decryptAacSamples=function decryptAacSamples(samples,sampleIndex,callback){for(;;sampleIndex++){if(sampleIndex>=samples.length){callback();return;}if(samples[sampleIndex].unit.length<32){continue;}var sync=this.decrypter.isSync();this.decryptAacSample(samples,sampleIndex,callback,sync);if(!sync){return;}}}// AVC - encrypt one 16 bytes block out of ten, starting from offset 32
;_proto.getAvcEncryptedData=function getAvcEncryptedData(decodedData){var encryptedDataLen=Math.floor((decodedData.length-48)/160)*16+16;var encryptedData=new Int8Array(encryptedDataLen);var outputPos=0;for(var inputPos=32;inputPos<decodedData.length-16;inputPos+=160,outputPos+=16){encryptedData.set(decodedData.subarray(inputPos,inputPos+16),outputPos);}return encryptedData;};_proto.getAvcDecryptedUnit=function getAvcDecryptedUnit(decodedData,decryptedData){var uint8DecryptedData=new Uint8Array(decryptedData);var inputPos=0;for(var outputPos=32;outputPos<decodedData.length-16;outputPos+=160,inputPos+=16){decodedData.set(uint8DecryptedData.subarray(inputPos,inputPos+16),outputPos);}return decodedData;};_proto.decryptAvcSample=function decryptAvcSample(samples,sampleIndex,unitIndex,callback,curUnit,sync){var decodedData=Object(_tsdemuxer__WEBPACK_IMPORTED_MODULE_1__["discardEPB"])(curUnit.data);var encryptedData=this.getAvcEncryptedData(decodedData);var localthis=this;this.decryptBuffer(encryptedData.buffer,function(decryptedBuffer){curUnit.data=localthis.getAvcDecryptedUnit(decodedData,decryptedBuffer);if(!sync){localthis.decryptAvcSamples(samples,sampleIndex,unitIndex+1,callback);}});};_proto.decryptAvcSamples=function decryptAvcSamples(samples,sampleIndex,unitIndex,callback){if(samples instanceof Uint8Array){throw new Error('Cannot decrypt samples of type Uint8Array');}for(;;sampleIndex++,unitIndex=0){if(sampleIndex>=samples.length){callback();return;}var curUnits=samples[sampleIndex].units;for(;;unitIndex++){if(unitIndex>=curUnits.length){break;}var curUnit=curUnits[unitIndex];if(curUnit.data.length<=48||curUnit.type!==1&&curUnit.type!==5){continue;}var sync=this.decrypter.isSync();this.decryptAvcSample(samples,sampleIndex,unitIndex,callback,curUnit,sync);if(!sync){return;}}}};return SampleAesDecrypter;}();/* harmony default export */__webpack_exports__["default"]=SampleAesDecrypter;/***/},/***/"./src/demux/transmuxer-interface.ts":/*!*******************************************!*\
			  !*** ./src/demux/transmuxer-interface.ts ***!
			  \*******************************************/ /*! exports provided: default */ /***/function srcDemuxTransmuxerInterfaceTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"default",function(){return TransmuxerInterface;});/* harmony import */var webworkify_webpack__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! webworkify-webpack */"./node_modules/webworkify-webpack/index.js");/* harmony import */var _events__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../events */"./src/events.ts");/* harmony import */var _demux_transmuxer__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../demux/transmuxer */"./src/demux/transmuxer.ts");/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ../utils/logger */"./src/utils/logger.ts");/* harmony import */var _errors__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(/*! ../errors */"./src/errors.ts");/* harmony import */var _utils_mediasource_helper__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(/*! ../utils/mediasource-helper */"./src/utils/mediasource-helper.ts");/* harmony import */var eventemitter3__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(/*! eventemitter3 */"./node_modules/eventemitter3/index.js");var MediaSource=Object(_utils_mediasource_helper__WEBPACK_IMPORTED_MODULE_5__["getMediaSource"])()||{isTypeSupported:function isTypeSupported(){return false;}};var TransmuxerInterface=/*#__PURE__*/function(){function TransmuxerInterface(hls,id,onTransmuxComplete,onFlush){var _this=this;this.hls=void 0;this.id=void 0;this.observer=void 0;this.frag=null;this.part=null;this.worker=void 0;this.onwmsg=void 0;this.transmuxer=null;this.onTransmuxComplete=void 0;this.onFlush=void 0;this.hls=hls;this.id=id;this.onTransmuxComplete=onTransmuxComplete;this.onFlush=onFlush;var config=hls.config;var forwardMessage=function forwardMessage(ev,data){data=data||{};data.frag=_this.frag;data.id=_this.id;hls.trigger(ev,data);};// forward events to main thread
this.observer=new eventemitter3__WEBPACK_IMPORTED_MODULE_6__["EventEmitter"]();this.observer.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].FRAG_DECRYPTED,forwardMessage);this.observer.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].ERROR,forwardMessage);var typeSupported={mp4:MediaSource.isTypeSupported('video/mp4'),mpeg:MediaSource.isTypeSupported('audio/mpeg'),mp3:MediaSource.isTypeSupported('audio/mp4; codecs="mp3"')};// navigator.vendor is not always available in Web Worker
// refer to https://developer.mozilla.org/en-US/docs/Web/API/WorkerGlobalScope/navigator
var vendor=navigator.vendor;if(config.enableWorker&&typeof Worker!=='undefined'){_utils_logger__WEBPACK_IMPORTED_MODULE_3__["logger"].log('demuxing in webworker');var worker;try{worker=this.worker=webworkify_webpack__WEBPACK_IMPORTED_MODULE_0__(/*require.resolve*/ /*! ../demux/transmuxer-worker.ts */"./src/demux/transmuxer-worker.ts");this.onwmsg=this.onWorkerMessage.bind(this);worker.addEventListener('message',this.onwmsg);worker.onerror=function(event){hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].ERROR,{type:_errors__WEBPACK_IMPORTED_MODULE_4__["ErrorTypes"].OTHER_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_4__["ErrorDetails"].INTERNAL_EXCEPTION,fatal:true,event:'demuxerWorker',error:new Error(event.message+"  ("+event.filename+":"+event.lineno+")")});};worker.postMessage({cmd:'init',typeSupported:typeSupported,vendor:vendor,id:id,config:JSON.stringify(config)});}catch(err){_utils_logger__WEBPACK_IMPORTED_MODULE_3__["logger"].warn('Error in worker:',err);_utils_logger__WEBPACK_IMPORTED_MODULE_3__["logger"].error('Error while initializing DemuxerWorker, fallback to inline');if(worker){// revoke the Object URL that was used to create transmuxer worker, so as not to leak it
self.URL.revokeObjectURL(worker.objectURL);}this.transmuxer=new _demux_transmuxer__WEBPACK_IMPORTED_MODULE_2__["default"](this.observer,typeSupported,config,vendor,id);this.worker=null;}}else{this.transmuxer=new _demux_transmuxer__WEBPACK_IMPORTED_MODULE_2__["default"](this.observer,typeSupported,config,vendor,id);}}var _proto=TransmuxerInterface.prototype;_proto.destroy=function destroy(){var w=this.worker;if(w){w.removeEventListener('message',this.onwmsg);w.terminate();this.worker=null;}else{var transmuxer=this.transmuxer;if(transmuxer){transmuxer.destroy();this.transmuxer=null;}}var observer=this.observer;if(observer){observer.removeAllListeners();}// @ts-ignore
this.observer=null;};_proto.push=function push(data,initSegmentData,audioCodec,videoCodec,frag,part,duration,accurateTimeOffset,chunkMeta,defaultInitPTS){var _frag$initSegment,_lastFrag$initSegment,_this2=this;chunkMeta.transmuxing.start=self.performance.now();var transmuxer=this.transmuxer,worker=this.worker;var timeOffset=part?part.start:frag.start;var decryptdata=frag.decryptdata;var lastFrag=this.frag;var discontinuity=!(lastFrag&&frag.cc===lastFrag.cc);var trackSwitch=!(lastFrag&&chunkMeta.level===lastFrag.level);var snDiff=lastFrag?chunkMeta.sn-lastFrag.sn:-1;var partDiff=this.part?chunkMeta.part-this.part.index:1;var contiguous=!trackSwitch&&(snDiff===1||snDiff===0&&partDiff===1);var now=self.performance.now();if(trackSwitch||snDiff||frag.stats.parsing.start===0){frag.stats.parsing.start=now;}if(part&&(partDiff||!contiguous)){part.stats.parsing.start=now;}var initSegmentChange=!(lastFrag&&((_frag$initSegment=frag.initSegment)===null||_frag$initSegment===void 0?void 0:_frag$initSegment.url)===((_lastFrag$initSegment=lastFrag.initSegment)===null||_lastFrag$initSegment===void 0?void 0:_lastFrag$initSegment.url));var state=new _demux_transmuxer__WEBPACK_IMPORTED_MODULE_2__["TransmuxState"](discontinuity,contiguous,accurateTimeOffset,trackSwitch,timeOffset,initSegmentChange);if(!contiguous||discontinuity||initSegmentChange){_utils_logger__WEBPACK_IMPORTED_MODULE_3__["logger"].log("[transmuxer-interface, "+frag.type+"]: Starting new transmux session for sn: "+chunkMeta.sn+" p: "+chunkMeta.part+" level: "+chunkMeta.level+" id: "+chunkMeta.id+"\n        discontinuity: "+discontinuity+"\n        trackSwitch: "+trackSwitch+"\n        contiguous: "+contiguous+"\n        accurateTimeOffset: "+accurateTimeOffset+"\n        timeOffset: "+timeOffset+"\n        initSegmentChange: "+initSegmentChange);var config=new _demux_transmuxer__WEBPACK_IMPORTED_MODULE_2__["TransmuxConfig"](audioCodec,videoCodec,initSegmentData,duration,defaultInitPTS);this.configureTransmuxer(config);}this.frag=frag;this.part=part;// Frags with sn of 'initSegment' are not transmuxed
if(worker){// post fragment payload as transferable objects for ArrayBuffer (no copy)
worker.postMessage({cmd:'demux',data:data,decryptdata:decryptdata,chunkMeta:chunkMeta,state:state},data instanceof ArrayBuffer?[data]:[]);}else if(transmuxer){var _transmuxResult=transmuxer.push(data,decryptdata,chunkMeta,state);if(Object(_demux_transmuxer__WEBPACK_IMPORTED_MODULE_2__["isPromise"])(_transmuxResult)){_transmuxResult.then(function(data){_this2.handleTransmuxComplete(data);});}else{this.handleTransmuxComplete(_transmuxResult);}}};_proto.flush=function flush(chunkMeta){var _this3=this;chunkMeta.transmuxing.start=self.performance.now();var transmuxer=this.transmuxer,worker=this.worker;if(worker){worker.postMessage({cmd:'flush',chunkMeta:chunkMeta});}else if(transmuxer){var _transmuxResult2=transmuxer.flush(chunkMeta);if(Object(_demux_transmuxer__WEBPACK_IMPORTED_MODULE_2__["isPromise"])(_transmuxResult2)){_transmuxResult2.then(function(data){_this3.handleFlushResult(data,chunkMeta);});}else{this.handleFlushResult(_transmuxResult2,chunkMeta);}}};_proto.handleFlushResult=function handleFlushResult(results,chunkMeta){var _this4=this;results.forEach(function(result){_this4.handleTransmuxComplete(result);});this.onFlush(chunkMeta);};_proto.onWorkerMessage=function onWorkerMessage(ev){var data=ev.data;var hls=this.hls;switch(data.event){case'init':{// revoke the Object URL that was used to create transmuxer worker, so as not to leak it
self.URL.revokeObjectURL(this.worker.objectURL);break;}case'transmuxComplete':{this.handleTransmuxComplete(data.data);break;}case'flush':{this.onFlush(data.data);break;}/* falls through */default:{data.data=data.data||{};data.data.frag=this.frag;data.data.id=this.id;hls.trigger(data.event,data.data);break;}}};_proto.configureTransmuxer=function configureTransmuxer(config){var worker=this.worker,transmuxer=this.transmuxer;if(worker){worker.postMessage({cmd:'configure',config:config});}else if(transmuxer){transmuxer.configure(config);}};_proto.handleTransmuxComplete=function handleTransmuxComplete(result){result.chunkMeta.transmuxing.end=self.performance.now();this.onTransmuxComplete(result);};return TransmuxerInterface;}();/***/},/***/"./src/demux/transmuxer-worker.ts":/*!****************************************!*\
			  !*** ./src/demux/transmuxer-worker.ts ***!
			  \****************************************/ /*! exports provided: default */ /***/function srcDemuxTransmuxerWorkerTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"default",function(){return TransmuxerWorker;});/* harmony import */var _demux_transmuxer__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../demux/transmuxer */"./src/demux/transmuxer.ts");/* harmony import */var _events__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../events */"./src/events.ts");/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../utils/logger */"./src/utils/logger.ts");/* harmony import */var eventemitter3__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! eventemitter3 */"./node_modules/eventemitter3/index.js");function TransmuxerWorker(self){var observer=new eventemitter3__WEBPACK_IMPORTED_MODULE_3__["EventEmitter"]();var forwardMessage=function forwardMessage(ev,data){self.postMessage({event:ev,data:data});};// forward events to main thread
observer.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].FRAG_DECRYPTED,forwardMessage);observer.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].ERROR,forwardMessage);self.addEventListener('message',function(ev){var data=ev.data;switch(data.cmd){case'init':{var config=JSON.parse(data.config);self.transmuxer=new _demux_transmuxer__WEBPACK_IMPORTED_MODULE_0__["default"](observer,data.typeSupported,config,data.vendor,data.id);Object(_utils_logger__WEBPACK_IMPORTED_MODULE_2__["enableLogs"])(config.debug);forwardMessage('init',null);break;}case'configure':{self.transmuxer.configure(data.config);break;}case'demux':{var transmuxResult=self.transmuxer.push(data.data,data.decryptdata,data.chunkMeta,data.state);if(Object(_demux_transmuxer__WEBPACK_IMPORTED_MODULE_0__["isPromise"])(transmuxResult)){transmuxResult.then(function(data){emitTransmuxComplete(self,data);});}else{emitTransmuxComplete(self,transmuxResult);}break;}case'flush':{var id=data.chunkMeta;var _transmuxResult=self.transmuxer.flush(id);if(Object(_demux_transmuxer__WEBPACK_IMPORTED_MODULE_0__["isPromise"])(_transmuxResult)){_transmuxResult.then(function(results){handleFlushResult(self,results,id);});}else{handleFlushResult(self,_transmuxResult,id);}break;}}});}function emitTransmuxComplete(self,transmuxResult){if(isEmptyResult(transmuxResult.remuxResult)){return;}var transferable=[];var _transmuxResult$remux=transmuxResult.remuxResult,audio=_transmuxResult$remux.audio,video=_transmuxResult$remux.video;if(audio){addToTransferable(transferable,audio);}if(video){addToTransferable(transferable,video);}self.postMessage({event:'transmuxComplete',data:transmuxResult},transferable);}// Converts data to a transferable object https://developers.google.com/web/updates/2011/12/Transferable-Objects-Lightning-Fast)
// in order to minimize message passing overhead
function addToTransferable(transferable,track){if(track.data1){transferable.push(track.data1.buffer);}if(track.data2){transferable.push(track.data2.buffer);}}function handleFlushResult(self,results,chunkMeta){results.forEach(function(result){emitTransmuxComplete(self,result);});self.postMessage({event:'flush',data:chunkMeta});}function isEmptyResult(remuxResult){return!remuxResult.audio&&!remuxResult.video&&!remuxResult.text&&!remuxResult.id3&&!remuxResult.initSegment;}/***/},/***/"./src/demux/transmuxer.ts":/*!*********************************!*\
			  !*** ./src/demux/transmuxer.ts ***!
			  \*********************************/ /*! exports provided: default, isPromise, TransmuxConfig, TransmuxState */ /***/function srcDemuxTransmuxerTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"default",function(){return Transmuxer;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"isPromise",function(){return isPromise;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"TransmuxConfig",function(){return TransmuxConfig;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"TransmuxState",function(){return TransmuxState;});/* harmony import */var _events__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../events */"./src/events.ts");/* harmony import */var _errors__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../errors */"./src/errors.ts");/* harmony import */var _crypt_decrypter__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../crypt/decrypter */"./src/crypt/decrypter.ts");/* harmony import */var _demux_aacdemuxer__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ../demux/aacdemuxer */"./src/demux/aacdemuxer.ts");/* harmony import */var _demux_mp4demuxer__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(/*! ../demux/mp4demuxer */"./src/demux/mp4demuxer.ts");/* harmony import */var _demux_tsdemuxer__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(/*! ../demux/tsdemuxer */"./src/demux/tsdemuxer.ts");/* harmony import */var _demux_mp3demuxer__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(/*! ../demux/mp3demuxer */"./src/demux/mp3demuxer.ts");/* harmony import */var _remux_mp4_remuxer__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(/*! ../remux/mp4-remuxer */"./src/remux/mp4-remuxer.ts");/* harmony import */var _remux_passthrough_remuxer__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(/*! ../remux/passthrough-remuxer */"./src/remux/passthrough-remuxer.ts");/* harmony import */var _chunk_cache__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(/*! ./chunk-cache */"./src/demux/chunk-cache.ts");/* harmony import */var _utils_mp4_tools__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts");/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(/*! ../utils/logger */"./src/utils/logger.ts");var now;// performance.now() not available on WebWorker, at least on Safari Desktop
try{now=self.performance.now.bind(self.performance);}catch(err){_utils_logger__WEBPACK_IMPORTED_MODULE_11__["logger"].debug('Unable to use Performance API on this environment');now=self.Date.now;}var muxConfig=[{demux:_demux_tsdemuxer__WEBPACK_IMPORTED_MODULE_5__["default"],remux:_remux_mp4_remuxer__WEBPACK_IMPORTED_MODULE_7__["default"]},{demux:_demux_mp4demuxer__WEBPACK_IMPORTED_MODULE_4__["default"],remux:_remux_passthrough_remuxer__WEBPACK_IMPORTED_MODULE_8__["default"]},{demux:_demux_aacdemuxer__WEBPACK_IMPORTED_MODULE_3__["default"],remux:_remux_mp4_remuxer__WEBPACK_IMPORTED_MODULE_7__["default"]},{demux:_demux_mp3demuxer__WEBPACK_IMPORTED_MODULE_6__["default"],remux:_remux_mp4_remuxer__WEBPACK_IMPORTED_MODULE_7__["default"]}];var minProbeByteLength=1024;muxConfig.forEach(function(_ref){var demux=_ref.demux;minProbeByteLength=Math.max(minProbeByteLength,demux.minProbeByteLength);});var Transmuxer=/*#__PURE__*/function(){function Transmuxer(observer,typeSupported,config,vendor,id){this.observer=void 0;this.typeSupported=void 0;this.config=void 0;this.vendor=void 0;this.id=void 0;this.demuxer=void 0;this.remuxer=void 0;this.decrypter=void 0;this.probe=void 0;this.decryptionPromise=null;this.transmuxConfig=void 0;this.currentTransmuxState=void 0;this.cache=new _chunk_cache__WEBPACK_IMPORTED_MODULE_9__["default"]();this.observer=observer;this.typeSupported=typeSupported;this.config=config;this.vendor=vendor;this.id=id;}var _proto=Transmuxer.prototype;_proto.configure=function configure(transmuxConfig){this.transmuxConfig=transmuxConfig;if(this.decrypter){this.decrypter.reset();}};_proto.push=function push(data,decryptdata,chunkMeta,state){var _this=this;var stats=chunkMeta.transmuxing;stats.executeStart=now();var uintData=new Uint8Array(data);var cache=this.cache,config=this.config,currentTransmuxState=this.currentTransmuxState,transmuxConfig=this.transmuxConfig;if(state){this.currentTransmuxState=state;}var keyData=getEncryptionType(uintData,decryptdata);if(keyData&&keyData.method==='AES-128'){var decrypter=this.getDecrypter();// Software decryption is synchronous; webCrypto is not
if(config.enableSoftwareAES){// Software decryption is progressive. Progressive decryption may not return a result on each call. Any cached
// data is handled in the flush() call
var decryptedData=decrypter.softwareDecrypt(uintData,keyData.key.buffer,keyData.iv.buffer);if(!decryptedData){stats.executeEnd=now();return emptyResult(chunkMeta);}uintData=new Uint8Array(decryptedData);}else{this.decryptionPromise=decrypter.webCryptoDecrypt(uintData,keyData.key.buffer,keyData.iv.buffer).then(function(decryptedData){// Calling push here is important; if flush() is called while this is still resolving, this ensures that
// the decrypted data has been transmuxed
var result=_this.push(decryptedData,null,chunkMeta);_this.decryptionPromise=null;return result;});return this.decryptionPromise;}}var _ref2=state||currentTransmuxState,contiguous=_ref2.contiguous,discontinuity=_ref2.discontinuity,trackSwitch=_ref2.trackSwitch,accurateTimeOffset=_ref2.accurateTimeOffset,timeOffset=_ref2.timeOffset,initSegmentChange=_ref2.initSegmentChange;var audioCodec=transmuxConfig.audioCodec,videoCodec=transmuxConfig.videoCodec,defaultInitPts=transmuxConfig.defaultInitPts,duration=transmuxConfig.duration,initSegmentData=transmuxConfig.initSegmentData;// Reset muxers before probing to ensure that their state is clean, even if flushing occurs before a successful probe
if(discontinuity||trackSwitch||initSegmentChange){this.resetInitSegment(initSegmentData,audioCodec,videoCodec,duration);}if(discontinuity||initSegmentChange){this.resetInitialTimestamp(defaultInitPts);}if(!contiguous){this.resetContiguity();}if(this.needsProbing(uintData,discontinuity,trackSwitch)){if(cache.dataLength){var cachedData=cache.flush();uintData=Object(_utils_mp4_tools__WEBPACK_IMPORTED_MODULE_10__["appendUint8Array"])(cachedData,uintData);}this.configureTransmuxer(uintData,transmuxConfig);}var result=this.transmux(uintData,keyData,timeOffset,accurateTimeOffset,chunkMeta);var currentState=this.currentTransmuxState;currentState.contiguous=true;currentState.discontinuity=false;currentState.trackSwitch=false;stats.executeEnd=now();return result;}// Due to data caching, flush calls can produce more than one TransmuxerResult (hence the Array type)
;_proto.flush=function flush(chunkMeta){var _this2=this;var stats=chunkMeta.transmuxing;stats.executeStart=now();var decrypter=this.decrypter,cache=this.cache,currentTransmuxState=this.currentTransmuxState,decryptionPromise=this.decryptionPromise;if(decryptionPromise){// Upon resolution, the decryption promise calls push() and returns its TransmuxerResult up the stack. Therefore
// only flushing is required for async decryption
return decryptionPromise.then(function(){return _this2.flush(chunkMeta);});}var transmuxResults=[];var timeOffset=currentTransmuxState.timeOffset;if(decrypter){// The decrypter may have data cached, which needs to be demuxed. In this case we'll have two TransmuxResults
// This happens in the case that we receive only 1 push call for a segment (either for non-progressive downloads,
// or for progressive downloads with small segments)
var decryptedData=decrypter.flush();if(decryptedData){// Push always returns a TransmuxerResult if decryptdata is null
transmuxResults.push(this.push(decryptedData,null,chunkMeta));}}var bytesSeen=cache.dataLength;cache.reset();var demuxer=this.demuxer,remuxer=this.remuxer;if(!demuxer||!remuxer){// If probing failed, and each demuxer saw enough bytes to be able to probe, then Hls.js has been given content its not able to handle
if(bytesSeen>=minProbeByteLength){this.observer.emit(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].ERROR,_events__WEBPACK_IMPORTED_MODULE_0__["Events"].ERROR,{type:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorTypes"].MEDIA_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorDetails"].FRAG_PARSING_ERROR,fatal:true,reason:'no demux matching with content found'});}stats.executeEnd=now();return[emptyResult(chunkMeta)];}var demuxResultOrPromise=demuxer.flush(timeOffset);if(isPromise(demuxResultOrPromise)){// Decrypt final SAMPLE-AES samples
return demuxResultOrPromise.then(function(demuxResult){_this2.flushRemux(transmuxResults,demuxResult,chunkMeta);return transmuxResults;});}this.flushRemux(transmuxResults,demuxResultOrPromise,chunkMeta);return transmuxResults;};_proto.flushRemux=function flushRemux(transmuxResults,demuxResult,chunkMeta){var audioTrack=demuxResult.audioTrack,avcTrack=demuxResult.avcTrack,id3Track=demuxResult.id3Track,textTrack=demuxResult.textTrack;var _this$currentTransmux=this.currentTransmuxState,accurateTimeOffset=_this$currentTransmux.accurateTimeOffset,timeOffset=_this$currentTransmux.timeOffset;_utils_logger__WEBPACK_IMPORTED_MODULE_11__["logger"].log("[transmuxer.ts]: Flushed fragment "+chunkMeta.sn+(chunkMeta.part>-1?' p: '+chunkMeta.part:'')+" of level "+chunkMeta.level);var remuxResult=this.remuxer.remux(audioTrack,avcTrack,id3Track,textTrack,timeOffset,accurateTimeOffset,true,this.id);transmuxResults.push({remuxResult:remuxResult,chunkMeta:chunkMeta});chunkMeta.transmuxing.executeEnd=now();};_proto.resetInitialTimestamp=function resetInitialTimestamp(defaultInitPts){var demuxer=this.demuxer,remuxer=this.remuxer;if(!demuxer||!remuxer){return;}demuxer.resetTimeStamp(defaultInitPts);remuxer.resetTimeStamp(defaultInitPts);};_proto.resetContiguity=function resetContiguity(){var demuxer=this.demuxer,remuxer=this.remuxer;if(!demuxer||!remuxer){return;}demuxer.resetContiguity();remuxer.resetNextTimestamp();};_proto.resetInitSegment=function resetInitSegment(initSegmentData,audioCodec,videoCodec,duration){var demuxer=this.demuxer,remuxer=this.remuxer;if(!demuxer||!remuxer){return;}demuxer.resetInitSegment(audioCodec,videoCodec,duration);remuxer.resetInitSegment(initSegmentData,audioCodec,videoCodec);};_proto.destroy=function destroy(){if(this.demuxer){this.demuxer.destroy();this.demuxer=undefined;}if(this.remuxer){this.remuxer.destroy();this.remuxer=undefined;}};_proto.transmux=function transmux(data,keyData,timeOffset,accurateTimeOffset,chunkMeta){var result;if(keyData&&keyData.method==='SAMPLE-AES'){result=this.transmuxSampleAes(data,keyData,timeOffset,accurateTimeOffset,chunkMeta);}else{result=this.transmuxUnencrypted(data,timeOffset,accurateTimeOffset,chunkMeta);}return result;};_proto.transmuxUnencrypted=function transmuxUnencrypted(data,timeOffset,accurateTimeOffset,chunkMeta){var _demux=this.demuxer.demux(data,timeOffset,false,!this.config.progressive),audioTrack=_demux.audioTrack,avcTrack=_demux.avcTrack,id3Track=_demux.id3Track,textTrack=_demux.textTrack;var remuxResult=this.remuxer.remux(audioTrack,avcTrack,id3Track,textTrack,timeOffset,accurateTimeOffset,false,this.id);return{remuxResult:remuxResult,chunkMeta:chunkMeta};};_proto.transmuxSampleAes=function transmuxSampleAes(data,decryptData,timeOffset,accurateTimeOffset,chunkMeta){var _this3=this;return this.demuxer.demuxSampleAes(data,decryptData,timeOffset).then(function(demuxResult){var remuxResult=_this3.remuxer.remux(demuxResult.audioTrack,demuxResult.avcTrack,demuxResult.id3Track,demuxResult.textTrack,timeOffset,accurateTimeOffset,false,_this3.id);return{remuxResult:remuxResult,chunkMeta:chunkMeta};});};_proto.configureTransmuxer=function configureTransmuxer(data,transmuxConfig){var config=this.config,observer=this.observer,typeSupported=this.typeSupported,vendor=this.vendor;var audioCodec=transmuxConfig.audioCodec,defaultInitPts=transmuxConfig.defaultInitPts,duration=transmuxConfig.duration,initSegmentData=transmuxConfig.initSegmentData,videoCodec=transmuxConfig.videoCodec;// probe for content type
var mux;for(var i=0,len=muxConfig.length;i<len;i++){if(muxConfig[i].demux.probe(data)){mux=muxConfig[i];break;}}if(!mux){// If probing previous configs fail, use mp4 passthrough
_utils_logger__WEBPACK_IMPORTED_MODULE_11__["logger"].warn('Failed to find demuxer by probing frag, treating as mp4 passthrough');mux={demux:_demux_mp4demuxer__WEBPACK_IMPORTED_MODULE_4__["default"],remux:_remux_passthrough_remuxer__WEBPACK_IMPORTED_MODULE_8__["default"]};}// so let's check that current remuxer and demuxer are still valid
var demuxer=this.demuxer;var remuxer=this.remuxer;var Remuxer=mux.remux;var Demuxer=mux.demux;if(!remuxer||!(remuxer instanceof Remuxer)){this.remuxer=new Remuxer(observer,config,typeSupported,vendor);}if(!demuxer||!(demuxer instanceof Demuxer)){this.demuxer=new Demuxer(observer,config,typeSupported);this.probe=Demuxer.probe;}// Ensure that muxers are always initialized with an initSegment
this.resetInitSegment(initSegmentData,audioCodec,videoCodec,duration);this.resetInitialTimestamp(defaultInitPts);};_proto.needsProbing=function needsProbing(data,discontinuity,trackSwitch){// in case of continuity change, or track switch
// we might switch from content type (AAC container to TS container, or TS to fmp4 for example)
return!this.demuxer||!this.remuxer||discontinuity||trackSwitch;};_proto.getDecrypter=function getDecrypter(){var decrypter=this.decrypter;if(!decrypter){decrypter=this.decrypter=new _crypt_decrypter__WEBPACK_IMPORTED_MODULE_2__["default"](this.observer,this.config);}return decrypter;};return Transmuxer;}();function getEncryptionType(data,decryptData){var encryptionType=null;if(data.byteLength>0&&decryptData!=null&&decryptData.key!=null&&decryptData.iv!==null&&decryptData.method!=null){encryptionType=decryptData;}return encryptionType;}var emptyResult=function emptyResult(chunkMeta){return{remuxResult:{},chunkMeta:chunkMeta};};function isPromise(p){return'then'in p&&p.then instanceof Function;}var TransmuxConfig=function TransmuxConfig(audioCodec,videoCodec,initSegmentData,duration,defaultInitPts){this.audioCodec=void 0;this.videoCodec=void 0;this.initSegmentData=void 0;this.duration=void 0;this.defaultInitPts=void 0;this.audioCodec=audioCodec;this.videoCodec=videoCodec;this.initSegmentData=initSegmentData;this.duration=duration;this.defaultInitPts=defaultInitPts;};var TransmuxState=function TransmuxState(discontinuity,contiguous,accurateTimeOffset,trackSwitch,timeOffset,initSegmentChange){this.discontinuity=void 0;this.contiguous=void 0;this.accurateTimeOffset=void 0;this.trackSwitch=void 0;this.timeOffset=void 0;this.initSegmentChange=void 0;this.discontinuity=discontinuity;this.contiguous=contiguous;this.accurateTimeOffset=accurateTimeOffset;this.trackSwitch=trackSwitch;this.timeOffset=timeOffset;this.initSegmentChange=initSegmentChange;};/***/},/***/"./src/demux/tsdemuxer.ts":/*!********************************!*\
			  !*** ./src/demux/tsdemuxer.ts ***!
			  \********************************/ /*! exports provided: discardEPB, default */ /***/function srcDemuxTsdemuxerTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"discardEPB",function(){return discardEPB;});/* harmony import */var _adts__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./adts */"./src/demux/adts.ts");/* harmony import */var _mpegaudio__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ./mpegaudio */"./src/demux/mpegaudio.ts");/* harmony import */var _exp_golomb__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ./exp-golomb */"./src/demux/exp-golomb.ts");/* harmony import */var _id3__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ./id3 */"./src/demux/id3.ts");/* harmony import */var _sample_aes__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(/*! ./sample-aes */"./src/demux/sample-aes.ts");/* harmony import */var _events__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(/*! ../events */"./src/events.ts");/* harmony import */var _utils_mp4_tools__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts");/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(/*! ../utils/logger */"./src/utils/logger.ts");/* harmony import */var _errors__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(/*! ../errors */"./src/errors.ts");/**
			 * highly optimized TS demuxer:
			 * parse PAT, PMT
			 * extract PES packet from audio and video PIDs
			 * extract AVC/H264 NAL units and AAC/ADTS samples from PES packet
			 * trigger the remuxer upon parsing completion
			 * it also tries to workaround as best as it can audio codec switch (HE-AAC to AAC and vice versa), without having to restart the MediaSource.
			 * it also controls the remuxing process :
			 * upon discontinuity or level switch detection, it will also notifies the remuxer so that it can reset its state.
			 */ // We are using fixed track IDs for driving the MP4 remuxer
// instead of following the TS PIDs.
// There is no reason not to do this and some browsers/SourceBuffer-demuxers
// may not like if there are TrackID "switches"
// See https://github.com/video-dev/hls.js/issues/1331
// Here we are mapping our internal track types to constant MP4 track IDs
// With MSE currently one can only have one track of each, and we are muxing
// whatever video/audio rendition in them.
var RemuxerTrackIdConfig={video:1,audio:2,id3:3,text:4};var TSDemuxer=/*#__PURE__*/function(){function TSDemuxer(observer,config,typeSupported){this.observer=void 0;this.config=void 0;this.typeSupported=void 0;this.sampleAes=null;this.pmtParsed=false;this.audioCodec=void 0;this.videoCodec=void 0;this._duration=0;this.aacLastPTS=null;this._initPTS=null;this._initDTS=null;this._pmtId=-1;this._avcTrack=void 0;this._audioTrack=void 0;this._id3Track=void 0;this._txtTrack=void 0;this.aacOverFlow=null;this.avcSample=null;this.remainderData=null;this.observer=observer;this.config=config;this.typeSupported=typeSupported;}TSDemuxer.probe=function probe(data){var syncOffset=TSDemuxer.syncOffset(data);if(syncOffset<0){return false;}else{if(syncOffset){_utils_logger__WEBPACK_IMPORTED_MODULE_7__["logger"].warn("MPEG2-TS detected but first sync word found @ offset "+syncOffset+", junk ahead ?");}return true;}};TSDemuxer.syncOffset=function syncOffset(data){// scan 1000 first bytes
var scanwindow=Math.min(1000,data.length-3*188);var i=0;while(i<scanwindow){// a TS fragment should contain at least 3 TS packets, a PAT, a PMT, and one PID, each starting with 0x47
if(data[i]===0x47&&data[i+188]===0x47&&data[i+2*188]===0x47){return i;}else{i++;}}return-1;}/**
			   * Creates a track model internal to demuxer used to drive remuxing input
			   *
			   * @param type 'audio' | 'video' | 'id3' | 'text'
			   * @param duration
			   * @return TSDemuxer's internal track model
			   */;TSDemuxer.createTrack=function createTrack(type,duration){return{container:type==='video'||type==='audio'?'video/mp2t':undefined,type:type,id:RemuxerTrackIdConfig[type],pid:-1,inputTimeScale:90000,sequenceNumber:0,samples:[],dropped:0,duration:type==='audio'?duration:undefined};}/**
			   * Initializes a new init segment on the demuxer/remuxer interface. Needed for discontinuities/track-switches (or at stream start)
			   * Resets all internal track instances of the demuxer.
			   */;var _proto=TSDemuxer.prototype;_proto.resetInitSegment=function resetInitSegment(audioCodec,videoCodec,duration){this.pmtParsed=false;this._pmtId=-1;this._avcTrack=TSDemuxer.createTrack('video',duration);this._audioTrack=TSDemuxer.createTrack('audio',duration);this._id3Track=TSDemuxer.createTrack('id3',duration);this._txtTrack=TSDemuxer.createTrack('text',duration);this._audioTrack.isAAC=true;// flush any partial content
this.aacOverFlow=null;this.aacLastPTS=null;this.avcSample=null;this.audioCodec=audioCodec;this.videoCodec=videoCodec;this._duration=duration;};_proto.resetTimeStamp=function resetTimeStamp(){};_proto.resetContiguity=function resetContiguity(){var _audioTrack=this._audioTrack,_avcTrack=this._avcTrack,_id3Track=this._id3Track;if(_audioTrack){_audioTrack.pesData=null;}if(_avcTrack){_avcTrack.pesData=null;}if(_id3Track){_id3Track.pesData=null;}this.aacOverFlow=null;this.aacLastPTS=null;};_proto.demux=function demux(data,timeOffset,isSampleAes,flush){if(isSampleAes===void 0){isSampleAes=false;}if(flush===void 0){flush=false;}if(!isSampleAes){this.sampleAes=null;}var pes;var avcTrack=this._avcTrack;var audioTrack=this._audioTrack;var id3Track=this._id3Track;var avcId=avcTrack.pid;var avcData=avcTrack.pesData;var audioId=audioTrack.pid;var id3Id=id3Track.pid;var audioData=audioTrack.pesData;var id3Data=id3Track.pesData;var unknownPIDs=false;var pmtParsed=this.pmtParsed;var pmtId=this._pmtId;var len=data.length;if(this.remainderData){data=Object(_utils_mp4_tools__WEBPACK_IMPORTED_MODULE_6__["appendUint8Array"])(this.remainderData,data);len=data.length;this.remainderData=null;}if(len<188&&!flush){this.remainderData=data;return{audioTrack:audioTrack,avcTrack:avcTrack,id3Track:id3Track,textTrack:this._txtTrack};}var syncOffset=Math.max(0,TSDemuxer.syncOffset(data));len-=(len+syncOffset)%188;if(len<data.byteLength&&!flush){this.remainderData=new Uint8Array(data.buffer,len,data.buffer.byteLength-len);}// loop through TS packets
var tsPacketErrors=0;for(var start=syncOffset;start<len;start+=188){if(data[start]===0x47){var stt=!!(data[start+1]&0x40);// pid is a 13-bit field starting at the last bit of TS[1]
var pid=((data[start+1]&0x1f)<<8)+data[start+2];var atf=(data[start+3]&0x30)>>4;// if an adaption field is present, its length is specified by the fifth byte of the TS packet header.
var offset=void 0;if(atf>1){offset=start+5+data[start+4];// continue if there is only adaptation field
if(offset===start+188){continue;}}else{offset=start+4;}switch(pid){case avcId:if(stt){if(avcData&&(pes=parsePES(avcData))){this.parseAVCPES(pes,false);}avcData={data:[],size:0};}if(avcData){avcData.data.push(data.subarray(offset,start+188));avcData.size+=start+188-offset;}break;case audioId:if(stt){if(audioData&&(pes=parsePES(audioData))){if(audioTrack.isAAC){this.parseAACPES(pes);}else{this.parseMPEGPES(pes);}}audioData={data:[],size:0};}if(audioData){audioData.data.push(data.subarray(offset,start+188));audioData.size+=start+188-offset;}break;case id3Id:if(stt){if(id3Data&&(pes=parsePES(id3Data))){this.parseID3PES(pes);}id3Data={data:[],size:0};}if(id3Data){id3Data.data.push(data.subarray(offset,start+188));id3Data.size+=start+188-offset;}break;case 0:if(stt){offset+=data[offset]+1;}pmtId=this._pmtId=parsePAT(data,offset);break;case pmtId:{if(stt){offset+=data[offset]+1;}var parsedPIDs=parsePMT(data,offset,this.typeSupported.mpeg===true||this.typeSupported.mp3===true,isSampleAes);// only update track id if track PID found while parsing PMT
// this is to avoid resetting the PID to -1 in case
// track PID transiently disappears from the stream
// this could happen in case of transient missing audio samples for example
// NOTE this is only the PID of the track as found in TS,
// but we are not using this for MP4 track IDs.
avcId=parsedPIDs.avc;if(avcId>0){avcTrack.pid=avcId;}audioId=parsedPIDs.audio;if(audioId>0){audioTrack.pid=audioId;audioTrack.isAAC=parsedPIDs.isAAC;}id3Id=parsedPIDs.id3;if(id3Id>0){id3Track.pid=id3Id;}if(unknownPIDs&&!pmtParsed){_utils_logger__WEBPACK_IMPORTED_MODULE_7__["logger"].log('reparse from beginning');unknownPIDs=false;// we set it to -188, the += 188 in the for loop will reset start to 0
start=syncOffset-188;}pmtParsed=this.pmtParsed=true;break;}case 17:case 0x1fff:break;default:unknownPIDs=true;break;}}else{tsPacketErrors++;}}if(tsPacketErrors>0){this.observer.emit(_events__WEBPACK_IMPORTED_MODULE_5__["Events"].ERROR,_events__WEBPACK_IMPORTED_MODULE_5__["Events"].ERROR,{type:_errors__WEBPACK_IMPORTED_MODULE_8__["ErrorTypes"].MEDIA_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_8__["ErrorDetails"].FRAG_PARSING_ERROR,fatal:false,reason:"Found "+tsPacketErrors+" TS packet/s that do not start with 0x47"});}avcTrack.pesData=avcData;audioTrack.pesData=audioData;id3Track.pesData=id3Data;var demuxResult={audioTrack:audioTrack,avcTrack:avcTrack,id3Track:id3Track,textTrack:this._txtTrack};if(flush){this.extractRemainingSamples(demuxResult);}return demuxResult;};_proto.flush=function flush(){var remainderData=this.remainderData;this.remainderData=null;var result;if(remainderData){result=this.demux(remainderData,-1,false,true);}else{result={audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track};}this.extractRemainingSamples(result);if(this.sampleAes){return this.decrypt(result,this.sampleAes);}return result;};_proto.extractRemainingSamples=function extractRemainingSamples(demuxResult){var audioTrack=demuxResult.audioTrack,avcTrack=demuxResult.avcTrack,id3Track=demuxResult.id3Track;var avcData=avcTrack.pesData;var audioData=audioTrack.pesData;var id3Data=id3Track.pesData;// try to parse last PES packets
var pes;if(avcData&&(pes=parsePES(avcData))){this.parseAVCPES(pes,true);avcTrack.pesData=null;}else{// either avcData null or PES truncated, keep it for next frag parsing
avcTrack.pesData=avcData;}if(audioData&&(pes=parsePES(audioData))){if(audioTrack.isAAC){this.parseAACPES(pes);}else{this.parseMPEGPES(pes);}audioTrack.pesData=null;}else{if(audioData!==null&&audioData!==void 0&&audioData.size){_utils_logger__WEBPACK_IMPORTED_MODULE_7__["logger"].log('last AAC PES packet truncated,might overlap between fragments');}// either audioData null or PES truncated, keep it for next frag parsing
audioTrack.pesData=audioData;}if(id3Data&&(pes=parsePES(id3Data))){this.parseID3PES(pes);id3Track.pesData=null;}else{// either id3Data null or PES truncated, keep it for next frag parsing
id3Track.pesData=id3Data;}};_proto.demuxSampleAes=function demuxSampleAes(data,keyData,timeOffset){var demuxResult=this.demux(data,timeOffset,true,!this.config.progressive);var sampleAes=this.sampleAes=new _sample_aes__WEBPACK_IMPORTED_MODULE_4__["default"](this.observer,this.config,keyData);return this.decrypt(demuxResult,sampleAes);};_proto.decrypt=function decrypt(demuxResult,sampleAes){return new Promise(function(resolve){var audioTrack=demuxResult.audioTrack,avcTrack=demuxResult.avcTrack;if(audioTrack.samples&&audioTrack.isAAC){sampleAes.decryptAacSamples(audioTrack.samples,0,function(){if(avcTrack.samples){sampleAes.decryptAvcSamples(avcTrack.samples,0,0,function(){resolve(demuxResult);});}else{resolve(demuxResult);}});}else if(avcTrack.samples){sampleAes.decryptAvcSamples(avcTrack.samples,0,0,function(){resolve(demuxResult);});}});};_proto.destroy=function destroy(){this._initPTS=this._initDTS=null;this._duration=0;};_proto.parseAVCPES=function parseAVCPES(pes,last){var _this=this;var track=this._avcTrack;var units=this.parseAVCNALu(pes.data);var avcSample=this.avcSample;var push;var spsfound=false;// free pes.data to save up some memory
pes.data=null;// if new NAL units found and last sample still there, let's push ...
// this helps parsing streams with missing AUD (only do this if AUD never found)
if(avcSample&&units.length&&!track.audFound){pushAccessUnit(avcSample,track);avcSample=this.avcSample=createAVCSample(false,pes.pts,pes.dts,'');}units.forEach(function(unit){switch(unit.type){// NDR
case 1:{push=true;if(!avcSample){avcSample=_this.avcSample=createAVCSample(true,pes.pts,pes.dts,'');}avcSample.frame=true;var data=unit.data;// only check slice type to detect KF in case SPS found in same packet (any keyframe is preceded by SPS ...)
if(spsfound&&data.length>4){// retrieve slice type by parsing beginning of NAL unit (follow H264 spec, slice_header definition) to detect keyframe embedded in NDR
var sliceType=new _exp_golomb__WEBPACK_IMPORTED_MODULE_2__["default"](data).readSliceType();// 2 : I slice, 4 : SI slice, 7 : I slice, 9: SI slice
// SI slice : A slice that is coded using intra prediction only and using quantisation of the prediction samples.
// An SI slice can be coded such that its decoded samples can be constructed identically to an SP slice.
// I slice: A slice that is not an SI slice that is decoded using intra prediction only.
// if (sliceType === 2 || sliceType === 7) {
if(sliceType===2||sliceType===4||sliceType===7||sliceType===9){avcSample.key=true;}}break;// IDR
}case 5:push=true;// handle PES not starting with AUD
if(!avcSample){avcSample=_this.avcSample=createAVCSample(true,pes.pts,pes.dts,'');}avcSample.key=true;avcSample.frame=true;break;// SEI
case 6:{push=true;var expGolombDecoder=new _exp_golomb__WEBPACK_IMPORTED_MODULE_2__["default"](discardEPB(unit.data));// skip frameType
expGolombDecoder.readUByte();var payloadType=0;var payloadSize=0;var endOfCaptions=false;var b=0;while(!endOfCaptions&&expGolombDecoder.bytesAvailable>1){payloadType=0;do{b=expGolombDecoder.readUByte();payloadType+=b;}while(b===0xff);// Parse payload size.
payloadSize=0;do{b=expGolombDecoder.readUByte();payloadSize+=b;}while(b===0xff);// TODO: there can be more than one payload in an SEI packet...
// TODO: need to read type and size in a while loop to get them all
if(payloadType===4&&expGolombDecoder.bytesAvailable!==0){endOfCaptions=true;var countryCode=expGolombDecoder.readUByte();if(countryCode===181){var providerCode=expGolombDecoder.readUShort();if(providerCode===49){var userStructure=expGolombDecoder.readUInt();if(userStructure===0x47413934){var userDataType=expGolombDecoder.readUByte();// Raw CEA-608 bytes wrapped in CEA-708 packet
if(userDataType===3){var firstByte=expGolombDecoder.readUByte();var secondByte=expGolombDecoder.readUByte();var totalCCs=31&firstByte;var byteArray=[firstByte,secondByte];for(var i=0;i<totalCCs;i++){// 3 bytes per CC
byteArray.push(expGolombDecoder.readUByte());byteArray.push(expGolombDecoder.readUByte());byteArray.push(expGolombDecoder.readUByte());}insertSampleInOrder(_this._txtTrack.samples,{type:3,pts:pes.pts,bytes:byteArray});}}}}}else if(payloadType===5&&expGolombDecoder.bytesAvailable!==0){endOfCaptions=true;if(payloadSize>16){var uuidStrArray=[];for(var _i=0;_i<16;_i++){uuidStrArray.push(expGolombDecoder.readUByte().toString(16));if(_i===3||_i===5||_i===7||_i===9){uuidStrArray.push('-');}}var length=payloadSize-16;var userDataPayloadBytes=new Uint8Array(length);for(var _i2=0;_i2<length;_i2++){userDataPayloadBytes[_i2]=expGolombDecoder.readUByte();}insertSampleInOrder(_this._txtTrack.samples,{pts:pes.pts,payloadType:payloadType,uuid:uuidStrArray.join(''),userData:Object(_id3__WEBPACK_IMPORTED_MODULE_3__["utf8ArrayToStr"])(userDataPayloadBytes),userDataBytes:userDataPayloadBytes});}}else if(payloadSize<expGolombDecoder.bytesAvailable){for(var _i3=0;_i3<payloadSize;_i3++){expGolombDecoder.readUByte();}}}break;// SPS
}case 7:push=true;spsfound=true;if(!track.sps){var _expGolombDecoder=new _exp_golomb__WEBPACK_IMPORTED_MODULE_2__["default"](unit.data);var config=_expGolombDecoder.readSPS();track.width=config.width;track.height=config.height;track.pixelRatio=config.pixelRatio;// TODO: `track.sps` is defined as a `number[]`, but we're setting it to a `Uint8Array[]`.
track.sps=[unit.data];track.duration=_this._duration;var codecarray=unit.data.subarray(1,4);var codecstring='avc1.';for(var _i4=0;_i4<3;_i4++){var h=codecarray[_i4].toString(16);if(h.length<2){h='0'+h;}codecstring+=h;}track.codec=codecstring;}break;// PPS
case 8:push=true;if(!track.pps){// TODO: `track.pss` is defined as a `number[]`, but we're setting it to a `Uint8Array[]`.
track.pps=[unit.data];}break;// AUD
case 9:push=false;track.audFound=true;if(avcSample){pushAccessUnit(avcSample,track);}avcSample=_this.avcSample=createAVCSample(false,pes.pts,pes.dts,'');break;// Filler Data
case 12:push=false;break;default:push=false;if(avcSample){avcSample.debug+='unknown NAL '+unit.type+' ';}break;}if(avcSample&&push){var _units=avcSample.units;_units.push(unit);}});// if last PES packet, push samples
if(last&&avcSample){pushAccessUnit(avcSample,track);this.avcSample=null;}};_proto.getLastNalUnit=function getLastNalUnit(){var _avcSample;var avcSample=this.avcSample;var lastUnit;// try to fallback to previous sample if current one is empty
if(!avcSample||avcSample.units.length===0){var samples=this._avcTrack.samples;avcSample=samples[samples.length-1];}if((_avcSample=avcSample)!==null&&_avcSample!==void 0&&_avcSample.units){var units=avcSample.units;lastUnit=units[units.length-1];}return lastUnit;};_proto.parseAVCNALu=function parseAVCNALu(array){var len=array.byteLength;var track=this._avcTrack;var state=track.naluState||0;var lastState=state;var units=[];var i=0;var value;var overflow;var unitType;var lastUnitStart=-1;var lastUnitType=0;// logger.log('PES:' + Hex.hexDump(array));
if(state===-1){// special use case where we found 3 or 4-byte start codes exactly at the end of previous PES packet
lastUnitStart=0;// NALu type is value read from offset 0
lastUnitType=array[0]&0x1f;state=0;i=1;}while(i<len){value=array[i++];// optimization. state 0 and 1 are the predominant case. let's handle them outside of the switch/case
if(!state){state=value?0:1;continue;}if(state===1){state=value?0:2;continue;}// here we have state either equal to 2 or 3
if(!value){state=3;}else if(value===1){if(lastUnitStart>=0){var unit={data:array.subarray(lastUnitStart,i-state-1),type:lastUnitType};// logger.log('pushing NALU, type/size:' + unit.type + '/' + unit.data.byteLength);
units.push(unit);}else{// lastUnitStart is undefined => this is the first start code found in this PES packet
// first check if start code delimiter is overlapping between 2 PES packets,
// ie it started in last packet (lastState not zero)
// and ended at the beginning of this PES packet (i <= 4 - lastState)
var lastUnit=this.getLastNalUnit();if(lastUnit){if(lastState&&i<=4-lastState){// start delimiter overlapping between PES packets
// strip start delimiter bytes from the end of last NAL unit
// check if lastUnit had a state different from zero
if(lastUnit.state){// strip last bytes
lastUnit.data=lastUnit.data.subarray(0,lastUnit.data.byteLength-lastState);}}// If NAL units are not starting right at the beginning of the PES packet, push preceding data into previous NAL unit.
overflow=i-state-1;if(overflow>0){// logger.log('first NALU found with overflow:' + overflow);
var tmp=new Uint8Array(lastUnit.data.byteLength+overflow);tmp.set(lastUnit.data,0);tmp.set(array.subarray(0,overflow),lastUnit.data.byteLength);lastUnit.data=tmp;lastUnit.state=0;}}}// check if we can read unit type
if(i<len){unitType=array[i]&0x1f;// logger.log('find NALU @ offset:' + i + ',type:' + unitType);
lastUnitStart=i;lastUnitType=unitType;state=0;}else{// not enough byte to read unit type. let's read it on next PES parsing
state=-1;}}else{state=0;}}if(lastUnitStart>=0&&state>=0){var _unit={data:array.subarray(lastUnitStart,len),type:lastUnitType,state:state};units.push(_unit);// logger.log('pushing NALU, type/size/state:' + unit.type + '/' + unit.data.byteLength + '/' + state);
}// no NALu found
if(units.length===0){// append pes.data to previous NAL unit
var _lastUnit=this.getLastNalUnit();if(_lastUnit){var _tmp=new Uint8Array(_lastUnit.data.byteLength+array.byteLength);_tmp.set(_lastUnit.data,0);_tmp.set(array,_lastUnit.data.byteLength);_lastUnit.data=_tmp;}}track.naluState=state;return units;};_proto.parseAACPES=function parseAACPES(pes){var startOffset=0;var track=this._audioTrack;var aacOverFlow=this.aacOverFlow;var data=pes.data;if(aacOverFlow){this.aacOverFlow=null;var sampleLength=aacOverFlow.sample.unit.byteLength;var frameMissingBytes=Math.min(aacOverFlow.missing,sampleLength);var frameOverflowBytes=sampleLength-frameMissingBytes;aacOverFlow.sample.unit.set(data.subarray(0,frameMissingBytes),frameOverflowBytes);track.samples.push(aacOverFlow.sample);// logger.log(`AAC: append overflowing ${frameOverflowBytes} bytes to beginning of new PES`);
startOffset=aacOverFlow.missing;}// look for ADTS header (0xFFFx)
var offset;var len;for(offset=startOffset,len=data.length;offset<len-1;offset++){if(_adts__WEBPACK_IMPORTED_MODULE_0__["isHeader"](data,offset)){break;}}// if ADTS header does not start straight from the beginning of the PES payload, raise an error
if(offset!==startOffset){var reason;var fatal;if(offset<len-1){reason="AAC PES did not start with ADTS header,offset:"+offset;fatal=false;}else{reason='no ADTS header found in AAC PES';fatal=true;}_utils_logger__WEBPACK_IMPORTED_MODULE_7__["logger"].warn("parsing error:"+reason);this.observer.emit(_events__WEBPACK_IMPORTED_MODULE_5__["Events"].ERROR,_events__WEBPACK_IMPORTED_MODULE_5__["Events"].ERROR,{type:_errors__WEBPACK_IMPORTED_MODULE_8__["ErrorTypes"].MEDIA_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_8__["ErrorDetails"].FRAG_PARSING_ERROR,fatal:fatal,reason:reason});if(fatal){return;}}_adts__WEBPACK_IMPORTED_MODULE_0__["initTrackConfig"](track,this.observer,data,offset,this.audioCodec);var pts;if(pes.pts!==undefined){pts=pes.pts;}else if(aacOverFlow){// if last AAC frame is overflowing, we should ensure timestamps are contiguous:
// first sample PTS should be equal to last sample PTS + frameDuration
var frameDuration=_adts__WEBPACK_IMPORTED_MODULE_0__["getFrameDuration"](track.samplerate);pts=aacOverFlow.sample.pts+frameDuration;}else{_utils_logger__WEBPACK_IMPORTED_MODULE_7__["logger"].warn('[tsdemuxer]: AAC PES unknown PTS');return;}// scan for aac samples
var frameIndex=0;while(offset<len){if(_adts__WEBPACK_IMPORTED_MODULE_0__["isHeader"](data,offset)){if(offset+5<len){var frame=_adts__WEBPACK_IMPORTED_MODULE_0__["appendFrame"](track,data,offset,pts,frameIndex);if(frame){if(frame.missing){this.aacOverFlow=frame;}else{offset+=frame.length;frameIndex++;continue;}}}// We are at an ADTS header, but do not have enough data for a frame
// Remaining data will be added to aacOverFlow
break;}else{// nothing found, keep looking
offset++;}}};_proto.parseMPEGPES=function parseMPEGPES(pes){var data=pes.data;var length=data.length;var frameIndex=0;var offset=0;var pts=pes.pts;if(pts===undefined){_utils_logger__WEBPACK_IMPORTED_MODULE_7__["logger"].warn('[tsdemuxer]: MPEG PES unknown PTS');return;}while(offset<length){if(_mpegaudio__WEBPACK_IMPORTED_MODULE_1__["isHeader"](data,offset)){var frame=_mpegaudio__WEBPACK_IMPORTED_MODULE_1__["appendFrame"](this._audioTrack,data,offset,pts,frameIndex);if(frame){offset+=frame.length;frameIndex++;}else{// logger.log('Unable to parse Mpeg audio frame');
break;}}else{// nothing found, keep looking
offset++;}}};_proto.parseID3PES=function parseID3PES(pes){if(pes.pts===undefined){_utils_logger__WEBPACK_IMPORTED_MODULE_7__["logger"].warn('[tsdemuxer]: ID3 PES unknown PTS');return;}this._id3Track.samples.push(pes);};return TSDemuxer;}();TSDemuxer.minProbeByteLength=188;function createAVCSample(key,pts,dts,debug){return{key:key,frame:false,pts:pts,dts:dts,units:[],debug:debug,length:0};}function parsePAT(data,offset){// skip the PSI header and parse the first PMT entry
return(data[offset+10]&0x1f)<<8|data[offset+11];// logger.log('PMT PID:'  + this._pmtId);
}function parsePMT(data,offset,mpegSupported,isSampleAes){var result={audio:-1,avc:-1,id3:-1,isAAC:true};var sectionLength=(data[offset+1]&0x0f)<<8|data[offset+2];var tableEnd=offset+3+sectionLength-4;// to determine where the table is, we have to figure out how
// long the program info descriptors are
var programInfoLength=(data[offset+10]&0x0f)<<8|data[offset+11];// advance the offset to the first entry in the mapping table
offset+=12+programInfoLength;while(offset<tableEnd){var pid=(data[offset+1]&0x1f)<<8|data[offset+2];switch(data[offset]){case 0xcf:// SAMPLE-AES AAC
if(!isSampleAes){_utils_logger__WEBPACK_IMPORTED_MODULE_7__["logger"].log('ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream');break;}/* falls through */case 0x0f:// ISO/IEC 13818-7 ADTS AAC (MPEG-2 lower bit-rate audio)
// logger.log('AAC PID:'  + pid);
if(result.audio===-1){result.audio=pid;}break;// Packetized metadata (ID3)
case 0x15:// logger.log('ID3 PID:'  + pid);
if(result.id3===-1){result.id3=pid;}break;case 0xdb:// SAMPLE-AES AVC
if(!isSampleAes){_utils_logger__WEBPACK_IMPORTED_MODULE_7__["logger"].log('H.264 with AES-128-CBC slice encryption found in unencrypted stream');break;}/* falls through */case 0x1b:// ITU-T Rec. H.264 and ISO/IEC 14496-10 (lower bit-rate video)
// logger.log('AVC PID:'  + pid);
if(result.avc===-1){result.avc=pid;}break;// ISO/IEC 11172-3 (MPEG-1 audio)
// or ISO/IEC 13818-3 (MPEG-2 halved sample rate audio)
case 0x03:case 0x04:// logger.log('MPEG PID:'  + pid);
if(!mpegSupported){_utils_logger__WEBPACK_IMPORTED_MODULE_7__["logger"].log('MPEG audio found, not supported in this browser');}else if(result.audio===-1){result.audio=pid;result.isAAC=false;}break;case 0x24:_utils_logger__WEBPACK_IMPORTED_MODULE_7__["logger"].warn('Unsupported HEVC stream type found');break;}// move to the next table entry
// skip past the elementary stream descriptors, if present
offset+=((data[offset+3]&0x0f)<<8|data[offset+4])+5;}return result;}function parsePES(stream){var i=0;var frag;var pesLen;var pesHdrLen;var pesPts;var pesDts;var data=stream.data;// safety check
if(!stream||stream.size===0){return null;}// we might need up to 19 bytes to read PES header
// if first chunk of data is less than 19 bytes, let's merge it with following ones until we get 19 bytes
// usually only one merge is needed (and this is rare ...)
while(data[0].length<19&&data.length>1){var newData=new Uint8Array(data[0].length+data[1].length);newData.set(data[0]);newData.set(data[1],data[0].length);data[0]=newData;data.splice(1,1);}// retrieve PTS/DTS from first fragment
frag=data[0];var pesPrefix=(frag[0]<<16)+(frag[1]<<8)+frag[2];if(pesPrefix===1){pesLen=(frag[4]<<8)+frag[5];// if PES parsed length is not zero and greater than total received length, stop parsing. PES might be truncated
// minus 6 : PES header size
if(pesLen&&pesLen>stream.size-6){return null;}var pesFlags=frag[7];if(pesFlags&0xc0){/* PES header described here : http://dvd.sourceforge.net/dvdinfo/pes-hdr.html
			          as PTS / DTS is 33 bit we cannot use bitwise operator in JS,
			          as Bitwise operators treat their operands as a sequence of 32 bits */pesPts=(frag[9]&0x0e)*536870912+// 1 << 29
(frag[10]&0xff)*4194304+// 1 << 22
(frag[11]&0xfe)*16384+// 1 << 14
(frag[12]&0xff)*128+// 1 << 7
(frag[13]&0xfe)/2;if(pesFlags&0x40){pesDts=(frag[14]&0x0e)*536870912+// 1 << 29
(frag[15]&0xff)*4194304+// 1 << 22
(frag[16]&0xfe)*16384+// 1 << 14
(frag[17]&0xff)*128+// 1 << 7
(frag[18]&0xfe)/2;if(pesPts-pesDts>60*90000){_utils_logger__WEBPACK_IMPORTED_MODULE_7__["logger"].warn(Math.round((pesPts-pesDts)/90000)+"s delta between PTS and DTS, align them");pesPts=pesDts;}}else{pesDts=pesPts;}}pesHdrLen=frag[8];// 9 bytes : 6 bytes for PES header + 3 bytes for PES extension
var payloadStartOffset=pesHdrLen+9;if(stream.size<=payloadStartOffset){return null;}stream.size-=payloadStartOffset;// reassemble PES packet
var pesData=new Uint8Array(stream.size);for(var j=0,dataLen=data.length;j<dataLen;j++){frag=data[j];var len=frag.byteLength;if(payloadStartOffset){if(payloadStartOffset>len){// trim full frag if PES header bigger than frag
payloadStartOffset-=len;continue;}else{// trim partial frag if PES header smaller than frag
frag=frag.subarray(payloadStartOffset);len-=payloadStartOffset;payloadStartOffset=0;}}pesData.set(frag,i);i+=len;}if(pesLen){// payload size : remove PES header + PES extension
pesLen-=pesHdrLen+3;}return{data:pesData,pts:pesPts,dts:pesDts,len:pesLen};}return null;}function pushAccessUnit(avcSample,avcTrack){if(avcSample.units.length&&avcSample.frame){// if sample does not have PTS/DTS, patch with last sample PTS/DTS
if(avcSample.pts===undefined){var samples=avcTrack.samples;var nbSamples=samples.length;if(nbSamples){var lastSample=samples[nbSamples-1];avcSample.pts=lastSample.pts;avcSample.dts=lastSample.dts;}else{// dropping samples, no timestamp found
avcTrack.dropped++;return;}}avcTrack.samples.push(avcSample);}if(avcSample.debug.length){_utils_logger__WEBPACK_IMPORTED_MODULE_7__["logger"].log(avcSample.pts+'/'+avcSample.dts+':'+avcSample.debug);}}function insertSampleInOrder(arr,data){var len=arr.length;if(len>0){if(data.pts>=arr[len-1].pts){arr.push(data);}else{for(var pos=len-1;pos>=0;pos--){if(data.pts<arr[pos].pts){arr.splice(pos,0,data);break;}}}}else{arr.push(data);}}/**
			 * remove Emulation Prevention bytes from a RBSP
			 */function discardEPB(data){var length=data.byteLength;var EPBPositions=[];var i=1;// Find all `Emulation Prevention Bytes`
while(i<length-2){if(data[i]===0&&data[i+1]===0&&data[i+2]===0x03){EPBPositions.push(i+2);i+=2;}else{i++;}}// If no Emulation Prevention Bytes were found just return the original
// array
if(EPBPositions.length===0){return data;}// Create a new array to hold the NAL unit data
var newLength=length-EPBPositions.length;var newData=new Uint8Array(newLength);var sourceIndex=0;for(i=0;i<newLength;sourceIndex++,i++){if(sourceIndex===EPBPositions[0]){// Skip this byte
sourceIndex++;// Remove this position index
EPBPositions.shift();}newData[i]=data[sourceIndex];}return newData;}/* harmony default export */__webpack_exports__["default"]=TSDemuxer;/***/},/***/"./src/errors.ts":/*!***********************!*\
			  !*** ./src/errors.ts ***!
			  \***********************/ /*! exports provided: ErrorTypes, ErrorDetails */ /***/function srcErrorsTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"ErrorTypes",function(){return ErrorTypes;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"ErrorDetails",function(){return ErrorDetails;});var ErrorTypes;/**
			 * @enum {ErrorDetails}
			 * @typedef {string} ErrorDetail
			 */(function(ErrorTypes){ErrorTypes["NETWORK_ERROR"]="networkError";ErrorTypes["MEDIA_ERROR"]="mediaError";ErrorTypes["KEY_SYSTEM_ERROR"]="keySystemError";ErrorTypes["MUX_ERROR"]="muxError";ErrorTypes["OTHER_ERROR"]="otherError";})(ErrorTypes||(ErrorTypes={}));var ErrorDetails;(function(ErrorDetails){ErrorDetails["KEY_SYSTEM_NO_KEYS"]="keySystemNoKeys";ErrorDetails["KEY_SYSTEM_NO_ACCESS"]="keySystemNoAccess";ErrorDetails["KEY_SYSTEM_NO_SESSION"]="keySystemNoSession";ErrorDetails["KEY_SYSTEM_LICENSE_REQUEST_FAILED"]="keySystemLicenseRequestFailed";ErrorDetails["KEY_SYSTEM_NO_INIT_DATA"]="keySystemNoInitData";ErrorDetails["MANIFEST_LOAD_ERROR"]="manifestLoadError";ErrorDetails["MANIFEST_LOAD_TIMEOUT"]="manifestLoadTimeOut";ErrorDetails["MANIFEST_PARSING_ERROR"]="manifestParsingError";ErrorDetails["MANIFEST_INCOMPATIBLE_CODECS_ERROR"]="manifestIncompatibleCodecsError";ErrorDetails["LEVEL_EMPTY_ERROR"]="levelEmptyError";ErrorDetails["LEVEL_LOAD_ERROR"]="levelLoadError";ErrorDetails["LEVEL_LOAD_TIMEOUT"]="levelLoadTimeOut";ErrorDetails["LEVEL_SWITCH_ERROR"]="levelSwitchError";ErrorDetails["AUDIO_TRACK_LOAD_ERROR"]="audioTrackLoadError";ErrorDetails["AUDIO_TRACK_LOAD_TIMEOUT"]="audioTrackLoadTimeOut";ErrorDetails["SUBTITLE_LOAD_ERROR"]="subtitleTrackLoadError";ErrorDetails["SUBTITLE_TRACK_LOAD_TIMEOUT"]="subtitleTrackLoadTimeOut";ErrorDetails["FRAG_LOAD_ERROR"]="fragLoadError";ErrorDetails["FRAG_LOAD_TIMEOUT"]="fragLoadTimeOut";ErrorDetails["FRAG_DECRYPT_ERROR"]="fragDecryptError";ErrorDetails["FRAG_PARSING_ERROR"]="fragParsingError";ErrorDetails["REMUX_ALLOC_ERROR"]="remuxAllocError";ErrorDetails["KEY_LOAD_ERROR"]="keyLoadError";ErrorDetails["KEY_LOAD_TIMEOUT"]="keyLoadTimeOut";ErrorDetails["BUFFER_ADD_CODEC_ERROR"]="bufferAddCodecError";ErrorDetails["BUFFER_INCOMPATIBLE_CODECS_ERROR"]="bufferIncompatibleCodecsError";ErrorDetails["BUFFER_APPEND_ERROR"]="bufferAppendError";ErrorDetails["BUFFER_APPENDING_ERROR"]="bufferAppendingError";ErrorDetails["BUFFER_STALLED_ERROR"]="bufferStalledError";ErrorDetails["BUFFER_FULL_ERROR"]="bufferFullError";ErrorDetails["BUFFER_SEEK_OVER_HOLE"]="bufferSeekOverHole";ErrorDetails["BUFFER_NUDGE_ON_STALL"]="bufferNudgeOnStall";ErrorDetails["INTERNAL_EXCEPTION"]="internalException";ErrorDetails["INTERNAL_ABORTED"]="aborted";ErrorDetails["UNKNOWN"]="unknown";})(ErrorDetails||(ErrorDetails={}));/***/},/***/"./src/events.ts":/*!***********************!*\
			  !*** ./src/events.ts ***!
			  \***********************/ /*! exports provided: Events */ /***/function srcEventsTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"Events",function(){return Events;});/**
			 * @readonly
			 * @enum {string}
			 */var Events;(function(Events){Events["MEDIA_ATTACHING"]="hlsMediaAttaching";Events["MEDIA_ATTACHED"]="hlsMediaAttached";Events["MEDIA_DETACHING"]="hlsMediaDetaching";Events["MEDIA_DETACHED"]="hlsMediaDetached";Events["BUFFER_RESET"]="hlsBufferReset";Events["BUFFER_CODECS"]="hlsBufferCodecs";Events["BUFFER_CREATED"]="hlsBufferCreated";Events["BUFFER_APPENDING"]="hlsBufferAppending";Events["BUFFER_APPENDED"]="hlsBufferAppended";Events["BUFFER_EOS"]="hlsBufferEos";Events["BUFFER_FLUSHING"]="hlsBufferFlushing";Events["BUFFER_FLUSHED"]="hlsBufferFlushed";Events["MANIFEST_LOADING"]="hlsManifestLoading";Events["MANIFEST_LOADED"]="hlsManifestLoaded";Events["MANIFEST_PARSED"]="hlsManifestParsed";Events["LEVEL_SWITCHING"]="hlsLevelSwitching";Events["LEVEL_SWITCHED"]="hlsLevelSwitched";Events["LEVEL_LOADING"]="hlsLevelLoading";Events["LEVEL_LOADED"]="hlsLevelLoaded";Events["LEVEL_UPDATED"]="hlsLevelUpdated";Events["LEVEL_PTS_UPDATED"]="hlsLevelPtsUpdated";Events["LEVELS_UPDATED"]="hlsLevelsUpdated";Events["AUDIO_TRACKS_UPDATED"]="hlsAudioTracksUpdated";Events["AUDIO_TRACK_SWITCHING"]="hlsAudioTrackSwitching";Events["AUDIO_TRACK_SWITCHED"]="hlsAudioTrackSwitched";Events["AUDIO_TRACK_LOADING"]="hlsAudioTrackLoading";Events["AUDIO_TRACK_LOADED"]="hlsAudioTrackLoaded";Events["SUBTITLE_TRACKS_UPDATED"]="hlsSubtitleTracksUpdated";Events["SUBTITLE_TRACKS_CLEARED"]="hlsSubtitleTracksCleared";Events["SUBTITLE_TRACK_SWITCH"]="hlsSubtitleTrackSwitch";Events["SUBTITLE_TRACK_LOADING"]="hlsSubtitleTrackLoading";Events["SUBTITLE_TRACK_LOADED"]="hlsSubtitleTrackLoaded";Events["SUBTITLE_FRAG_PROCESSED"]="hlsSubtitleFragProcessed";Events["CUES_PARSED"]="hlsCuesParsed";Events["NON_NATIVE_TEXT_TRACKS_FOUND"]="hlsNonNativeTextTracksFound";Events["INIT_PTS_FOUND"]="hlsInitPtsFound";Events["FRAG_LOADING"]="hlsFragLoading";Events["FRAG_LOAD_EMERGENCY_ABORTED"]="hlsFragLoadEmergencyAborted";Events["FRAG_LOADED"]="hlsFragLoaded";Events["FRAG_DECRYPTED"]="hlsFragDecrypted";Events["FRAG_PARSING_INIT_SEGMENT"]="hlsFragParsingInitSegment";Events["FRAG_PARSING_USERDATA"]="hlsFragParsingUserdata";Events["FRAG_PARSING_METADATA"]="hlsFragParsingMetadata";Events["FRAG_PARSED"]="hlsFragParsed";Events["FRAG_BUFFERED"]="hlsFragBuffered";Events["FRAG_CHANGED"]="hlsFragChanged";Events["FPS_DROP"]="hlsFpsDrop";Events["FPS_DROP_LEVEL_CAPPING"]="hlsFpsDropLevelCapping";Events["ERROR"]="hlsError";Events["DESTROYING"]="hlsDestroying";Events["KEY_LOADING"]="hlsKeyLoading";Events["KEY_LOADED"]="hlsKeyLoaded";Events["LIVE_BACK_BUFFER_REACHED"]="hlsLiveBackBufferReached";Events["BACK_BUFFER_REACHED"]="hlsBackBufferReached";})(Events||(Events={}));/***/},/***/"./src/hls.ts":/*!********************!*\
			  !*** ./src/hls.ts ***!
			  \********************/ /*! exports provided: default */ /***/function srcHlsTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"default",function(){return Hls;});/* harmony import */var url_toolkit__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! url-toolkit */"./node_modules/url-toolkit/src/url-toolkit.js");/* harmony import */var _loader_playlist_loader__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ./loader/playlist-loader */"./src/loader/playlist-loader.ts");/* harmony import */var _loader_key_loader__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ./loader/key-loader */"./src/loader/key-loader.ts");/* harmony import */var _controller_id3_track_controller__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ./controller/id3-track-controller */"./src/controller/id3-track-controller.ts");/* harmony import */var _controller_latency_controller__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(/*! ./controller/latency-controller */"./src/controller/latency-controller.ts");/* harmony import */var _controller_level_controller__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(/*! ./controller/level-controller */"./src/controller/level-controller.ts");/* harmony import */var _controller_fragment_tracker__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(/*! ./controller/fragment-tracker */"./src/controller/fragment-tracker.ts");/* harmony import */var _controller_stream_controller__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(/*! ./controller/stream-controller */"./src/controller/stream-controller.ts");/* harmony import */var _is_supported__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(/*! ./is-supported */"./src/is-supported.ts");/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(/*! ./utils/logger */"./src/utils/logger.ts");/* harmony import */var _config__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(/*! ./config */"./src/config.ts");/* harmony import */var eventemitter3__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(/*! eventemitter3 */"./node_modules/eventemitter3/index.js");/* harmony import */var _events__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(/*! ./events */"./src/events.ts");/* harmony import */var _errors__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(/*! ./errors */"./src/errors.ts");function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}/**
			 * @module Hls
			 * @class
			 * @constructor
			 */var Hls=/*#__PURE__*/function(){Hls.isSupported=function isSupported(){return Object(_is_supported__WEBPACK_IMPORTED_MODULE_8__["isSupported"])();};/**
			   * Creates an instance of an HLS client that can attach to exactly one `HTMLMediaElement`.
			   *
			   * @constructs Hls
			   * @param {HlsConfig} config
			   */function Hls(userConfig){if(userConfig===void 0){userConfig={};}this.config=void 0;this.userConfig=void 0;this.coreComponents=void 0;this.networkControllers=void 0;this._emitter=new eventemitter3__WEBPACK_IMPORTED_MODULE_11__["EventEmitter"]();this._autoLevelCapping=void 0;this.abrController=void 0;this.bufferController=void 0;this.capLevelController=void 0;this.latencyController=void 0;this.levelController=void 0;this.streamController=void 0;this.audioTrackController=void 0;this.subtitleTrackController=void 0;this.emeController=void 0;this.cmcdController=void 0;this._media=null;this.url=null;var config=this.config=Object(_config__WEBPACK_IMPORTED_MODULE_10__["mergeConfig"])(Hls.DefaultConfig,userConfig);this.userConfig=userConfig;Object(_utils_logger__WEBPACK_IMPORTED_MODULE_9__["enableLogs"])(config.debug);this._autoLevelCapping=-1;if(config.progressive){Object(_config__WEBPACK_IMPORTED_MODULE_10__["enableStreamingMode"])(config);}// core controllers and network loaders
var ConfigAbrController=config.abrController,ConfigBufferController=config.bufferController,ConfigCapLevelController=config.capLevelController,ConfigFpsController=config.fpsController;var abrController=this.abrController=new ConfigAbrController(this);var bufferController=this.bufferController=new ConfigBufferController(this);var capLevelController=this.capLevelController=new ConfigCapLevelController(this);var fpsController=new ConfigFpsController(this);var playListLoader=new _loader_playlist_loader__WEBPACK_IMPORTED_MODULE_1__["default"](this);var keyLoader=new _loader_key_loader__WEBPACK_IMPORTED_MODULE_2__["default"](this);var id3TrackController=new _controller_id3_track_controller__WEBPACK_IMPORTED_MODULE_3__["default"](this);// network controllers
var levelController=this.levelController=new _controller_level_controller__WEBPACK_IMPORTED_MODULE_5__["default"](this);// FragmentTracker must be defined before StreamController because the order of event handling is important
var fragmentTracker=new _controller_fragment_tracker__WEBPACK_IMPORTED_MODULE_6__["FragmentTracker"](this);var streamController=this.streamController=new _controller_stream_controller__WEBPACK_IMPORTED_MODULE_7__["default"](this,fragmentTracker);// Cap level controller uses streamController to flush the buffer
capLevelController.setStreamController(streamController);// fpsController uses streamController to switch when frames are being dropped
fpsController.setStreamController(streamController);var networkControllers=[levelController,streamController];this.networkControllers=networkControllers;var coreComponents=[playListLoader,keyLoader,abrController,bufferController,capLevelController,fpsController,id3TrackController,fragmentTracker];this.audioTrackController=this.createController(config.audioTrackController,null,networkControllers);this.createController(config.audioStreamController,fragmentTracker,networkControllers);// subtitleTrackController must be defined before  because the order of event handling is important
this.subtitleTrackController=this.createController(config.subtitleTrackController,null,networkControllers);this.createController(config.subtitleStreamController,fragmentTracker,networkControllers);this.createController(config.timelineController,null,coreComponents);this.emeController=this.createController(config.emeController,null,coreComponents);this.cmcdController=this.createController(config.cmcdController,null,coreComponents);this.latencyController=this.createController(_controller_latency_controller__WEBPACK_IMPORTED_MODULE_4__["default"],null,coreComponents);this.coreComponents=coreComponents;}var _proto=Hls.prototype;_proto.createController=function createController(ControllerClass,fragmentTracker,components){if(ControllerClass){var controllerInstance=fragmentTracker?new ControllerClass(this,fragmentTracker):new ControllerClass(this);if(components){components.push(controllerInstance);}return controllerInstance;}return null;}// Delegate the EventEmitter through the public API of Hls.js
;_proto.on=function on(event,listener,context){if(context===void 0){context=this;}this._emitter.on(event,listener,context);};_proto.once=function once(event,listener,context){if(context===void 0){context=this;}this._emitter.once(event,listener,context);};_proto.removeAllListeners=function removeAllListeners(event){this._emitter.removeAllListeners(event);};_proto.off=function off(event,listener,context,once){if(context===void 0){context=this;}this._emitter.off(event,listener,context,once);};_proto.listeners=function listeners(event){return this._emitter.listeners(event);};_proto.emit=function emit(event,name,eventObject){return this._emitter.emit(event,name,eventObject);};_proto.trigger=function trigger(event,eventObject){if(this.config.debug){return this.emit(event,event,eventObject);}else{try{return this.emit(event,event,eventObject);}catch(e){_utils_logger__WEBPACK_IMPORTED_MODULE_9__["logger"].error('An internal error happened while handling event '+event+'. Error message: "'+e.message+'". Here is a stacktrace:',e);this.trigger(_events__WEBPACK_IMPORTED_MODULE_12__["Events"].ERROR,{type:_errors__WEBPACK_IMPORTED_MODULE_13__["ErrorTypes"].OTHER_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_13__["ErrorDetails"].INTERNAL_EXCEPTION,fatal:false,event:event,error:e});}}return false;};_proto.listenerCount=function listenerCount(event){return this._emitter.listenerCount(event);}/**
			   * Dispose of the instance
			   */;_proto.destroy=function destroy(){_utils_logger__WEBPACK_IMPORTED_MODULE_9__["logger"].log('destroy');this.trigger(_events__WEBPACK_IMPORTED_MODULE_12__["Events"].DESTROYING,undefined);this.detachMedia();this.removeAllListeners();this._autoLevelCapping=-1;this.url=null;this.networkControllers.forEach(function(component){return component.destroy();});this.networkControllers.length=0;this.coreComponents.forEach(function(component){return component.destroy();});this.coreComponents.length=0;}/**
			   * Attaches Hls.js to a media element
			   * @param {HTMLMediaElement} media
			   */;_proto.attachMedia=function attachMedia(media){_utils_logger__WEBPACK_IMPORTED_MODULE_9__["logger"].log('attachMedia');this._media=media;this.trigger(_events__WEBPACK_IMPORTED_MODULE_12__["Events"].MEDIA_ATTACHING,{media:media});}/**
			   * Detach Hls.js from the media
			   */;_proto.detachMedia=function detachMedia(){_utils_logger__WEBPACK_IMPORTED_MODULE_9__["logger"].log('detachMedia');this.trigger(_events__WEBPACK_IMPORTED_MODULE_12__["Events"].MEDIA_DETACHING,undefined);this._media=null;}/**
			   * Set the source URL. Can be relative or absolute.
			   * @param {string} url
			   */;_proto.loadSource=function loadSource(url){this.stopLoad();var media=this.media;var loadedSource=this.url;var loadingSource=this.url=url_toolkit__WEBPACK_IMPORTED_MODULE_0__["buildAbsoluteURL"](self.location.href,url,{alwaysNormalize:true});_utils_logger__WEBPACK_IMPORTED_MODULE_9__["logger"].log("loadSource:"+loadingSource);if(media&&loadedSource&&loadedSource!==loadingSource&&this.bufferController.hasSourceTypes()){this.detachMedia();this.attachMedia(media);}// when attaching to a source URL, trigger a playlist load
this.trigger(_events__WEBPACK_IMPORTED_MODULE_12__["Events"].MANIFEST_LOADING,{url:url});}/**
			   * Start loading data from the stream source.
			   * Depending on default config, client starts loading automatically when a source is set.
			   *
			   * @param {number} startPosition Set the start position to stream from
			   * @default -1 None (from earliest point)
			   */;_proto.startLoad=function startLoad(startPosition){if(startPosition===void 0){startPosition=-1;}_utils_logger__WEBPACK_IMPORTED_MODULE_9__["logger"].log("startLoad("+startPosition+")");this.networkControllers.forEach(function(controller){controller.startLoad(startPosition);});}/**
			   * Stop loading of any stream data.
			   */;_proto.stopLoad=function stopLoad(){_utils_logger__WEBPACK_IMPORTED_MODULE_9__["logger"].log('stopLoad');this.networkControllers.forEach(function(controller){controller.stopLoad();});}/**
			   * Swap through possible audio codecs in the stream (for example to switch from stereo to 5.1)
			   */;_proto.swapAudioCodec=function swapAudioCodec(){_utils_logger__WEBPACK_IMPORTED_MODULE_9__["logger"].log('swapAudioCodec');this.streamController.swapAudioCodec();}/**
			   * When the media-element fails, this allows to detach and then re-attach it
			   * as one call (convenience method).
			   *
			   * Automatic recovery of media-errors by this process is configurable.
			   */;_proto.recoverMediaError=function recoverMediaError(){_utils_logger__WEBPACK_IMPORTED_MODULE_9__["logger"].log('recoverMediaError');var media=this._media;this.detachMedia();if(media){this.attachMedia(media);}};_proto.removeLevel=function removeLevel(levelIndex,urlId){if(urlId===void 0){urlId=0;}this.levelController.removeLevel(levelIndex,urlId);}/**
			   * @type {Level[]}
			   */;_createClass(Hls,[{key:"levels",get:function get(){var levels=this.levelController.levels;return levels?levels:[];}/**
			     * Index of quality level currently played
			     * @type {number}
			     */},{key:"currentLevel",get:function get(){return this.streamController.currentLevel;}/**
			     * Set quality level index immediately .
			     * This will flush the current buffer to replace the quality asap.
			     * That means playback will interrupt at least shortly to re-buffer and re-sync eventually.
			     * @type {number} -1 for automatic level selection
			     */,set:function set(newLevel){_utils_logger__WEBPACK_IMPORTED_MODULE_9__["logger"].log("set currentLevel:"+newLevel);this.loadLevel=newLevel;this.abrController.clearTimer();this.streamController.immediateLevelSwitch();}/**
			     * Index of next quality level loaded as scheduled by stream controller.
			     * @type {number}
			     */},{key:"nextLevel",get:function get(){return this.streamController.nextLevel;}/**
			     * Set quality level index for next loaded data.
			     * This will switch the video quality asap, without interrupting playback.
			     * May abort current loading of data, and flush parts of buffer (outside currently played fragment region).
			     * @type {number} -1 for automatic level selection
			     */,set:function set(newLevel){_utils_logger__WEBPACK_IMPORTED_MODULE_9__["logger"].log("set nextLevel:"+newLevel);this.levelController.manualLevel=newLevel;this.streamController.nextLevelSwitch();}/**
			     * Return the quality level of the currently or last (of none is loaded currently) segment
			     * @type {number}
			     */},{key:"loadLevel",get:function get(){return this.levelController.level;}/**
			     * Set quality level index for next loaded data in a conservative way.
			     * This will switch the quality without flushing, but interrupt current loading.
			     * Thus the moment when the quality switch will appear in effect will only be after the already existing buffer.
			     * @type {number} newLevel -1 for automatic level selection
			     */,set:function set(newLevel){_utils_logger__WEBPACK_IMPORTED_MODULE_9__["logger"].log("set loadLevel:"+newLevel);this.levelController.manualLevel=newLevel;}/**
			     * get next quality level loaded
			     * @type {number}
			     */},{key:"nextLoadLevel",get:function get(){return this.levelController.nextLoadLevel;}/**
			     * Set quality level of next loaded segment in a fully "non-destructive" way.
			     * Same as `loadLevel` but will wait for next switch (until current loading is done).
			     * @type {number} level
			     */,set:function set(level){this.levelController.nextLoadLevel=level;}/**
			     * Return "first level": like a default level, if not set,
			     * falls back to index of first level referenced in manifest
			     * @type {number}
			     */},{key:"firstLevel",get:function get(){return Math.max(this.levelController.firstLevel,this.minAutoLevel);}/**
			     * Sets "first-level", see getter.
			     * @type {number}
			     */,set:function set(newLevel){_utils_logger__WEBPACK_IMPORTED_MODULE_9__["logger"].log("set firstLevel:"+newLevel);this.levelController.firstLevel=newLevel;}/**
			     * Return start level (level of first fragment that will be played back)
			     * if not overrided by user, first level appearing in manifest will be used as start level
			     * if -1 : automatic start level selection, playback will start from level matching download bandwidth
			     * (determined from download of first segment)
			     * @type {number}
			     */},{key:"startLevel",get:function get(){return this.levelController.startLevel;}/**
			     * set  start level (level of first fragment that will be played back)
			     * if not overrided by user, first level appearing in manifest will be used as start level
			     * if -1 : automatic start level selection, playback will start from level matching download bandwidth
			     * (determined from download of first segment)
			     * @type {number} newLevel
			     */,set:function set(newLevel){_utils_logger__WEBPACK_IMPORTED_MODULE_9__["logger"].log("set startLevel:"+newLevel);// if not in automatic start level detection, ensure startLevel is greater than minAutoLevel
if(newLevel!==-1){newLevel=Math.max(newLevel,this.minAutoLevel);}this.levelController.startLevel=newLevel;}/**
			     * Get the current setting for capLevelToPlayerSize
			     *
			     * @type {boolean}
			     */},{key:"capLevelToPlayerSize",get:function get(){return this.config.capLevelToPlayerSize;}/**
			     * set  dynamically set capLevelToPlayerSize against (`CapLevelController`)
			     *
			     * @type {boolean}
			     */,set:function set(shouldStartCapping){var newCapLevelToPlayerSize=!!shouldStartCapping;if(newCapLevelToPlayerSize!==this.config.capLevelToPlayerSize){if(newCapLevelToPlayerSize){this.capLevelController.startCapping();// If capping occurs, nextLevelSwitch will happen based on size.
}else{this.capLevelController.stopCapping();this.autoLevelCapping=-1;this.streamController.nextLevelSwitch();// Now we're uncapped, get the next level asap.
}this.config.capLevelToPlayerSize=newCapLevelToPlayerSize;}}/**
			     * Capping/max level value that should be used by automatic level selection algorithm (`ABRController`)
			     * @type {number}
			     */},{key:"autoLevelCapping",get:function get(){return this._autoLevelCapping;}/**
			     * get bandwidth estimate
			     * @type {number}
			     */,set:/**
			     * Capping/max level value that should be used by automatic level selection algorithm (`ABRController`)
			     * @type {number}
			     */function set(newLevel){if(this._autoLevelCapping!==newLevel){_utils_logger__WEBPACK_IMPORTED_MODULE_9__["logger"].log("set autoLevelCapping:"+newLevel);this._autoLevelCapping=newLevel;}}/**
			     * True when automatic level selection enabled
			     * @type {boolean}
			     */},{key:"bandwidthEstimate",get:function get(){var bwEstimator=this.abrController.bwEstimator;if(!bwEstimator){return NaN;}return bwEstimator.getEstimate();}},{key:"autoLevelEnabled",get:function get(){return this.levelController.manualLevel===-1;}/**
			     * Level set manually (if any)
			     * @type {number}
			     */},{key:"manualLevel",get:function get(){return this.levelController.manualLevel;}/**
			     * min level selectable in auto mode according to config.minAutoBitrate
			     * @type {number}
			     */},{key:"minAutoLevel",get:function get(){var levels=this.levels,minAutoBitrate=this.config.minAutoBitrate;if(!levels)return 0;var len=levels.length;for(var i=0;i<len;i++){if(levels[i].maxBitrate>minAutoBitrate){return i;}}return 0;}/**
			     * max level selectable in auto mode according to autoLevelCapping
			     * @type {number}
			     */},{key:"maxAutoLevel",get:function get(){var levels=this.levels,autoLevelCapping=this.autoLevelCapping;var maxAutoLevel;if(autoLevelCapping===-1&&levels&&levels.length){maxAutoLevel=levels.length-1;}else{maxAutoLevel=autoLevelCapping;}return maxAutoLevel;}/**
			     * next automatically selected quality level
			     * @type {number}
			     */},{key:"nextAutoLevel",get:function get(){// ensure next auto level is between  min and max auto level
return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel);}/**
			     * this setter is used to force next auto level.
			     * this is useful to force a switch down in auto mode:
			     * in case of load error on level N, hls.js can set nextAutoLevel to N-1 for example)
			     * forced value is valid for one fragment. upon successful frag loading at forced level,
			     * this value will be resetted to -1 by ABR controller.
			     * @type {number}
			     */,set:function set(nextLevel){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,nextLevel);}/**
			     * @type {AudioTrack[]}
			     */},{key:"audioTracks",get:function get(){var audioTrackController=this.audioTrackController;return audioTrackController?audioTrackController.audioTracks:[];}/**
			     * index of the selected audio track (index in audio track lists)
			     * @type {number}
			     */},{key:"audioTrack",get:function get(){var audioTrackController=this.audioTrackController;return audioTrackController?audioTrackController.audioTrack:-1;}/**
			     * selects an audio track, based on its index in audio track lists
			     * @type {number}
			     */,set:function set(audioTrackId){var audioTrackController=this.audioTrackController;if(audioTrackController){audioTrackController.audioTrack=audioTrackId;}}/**
			     * get alternate subtitle tracks list from playlist
			     * @type {MediaPlaylist[]}
			     */},{key:"subtitleTracks",get:function get(){var subtitleTrackController=this.subtitleTrackController;return subtitleTrackController?subtitleTrackController.subtitleTracks:[];}/**
			     * index of the selected subtitle track (index in subtitle track lists)
			     * @type {number}
			     */},{key:"subtitleTrack",get:function get(){var subtitleTrackController=this.subtitleTrackController;return subtitleTrackController?subtitleTrackController.subtitleTrack:-1;},set:/**
			     * select an subtitle track, based on its index in subtitle track lists
			     * @type {number}
			     */function set(subtitleTrackId){var subtitleTrackController=this.subtitleTrackController;if(subtitleTrackController){subtitleTrackController.subtitleTrack=subtitleTrackId;}}/**
			     * @type {boolean}
			     */},{key:"media",get:function get(){return this._media;}},{key:"subtitleDisplay",get:function get(){var subtitleTrackController=this.subtitleTrackController;return subtitleTrackController?subtitleTrackController.subtitleDisplay:false;}/**
			     * Enable/disable subtitle display rendering
			     * @type {boolean}
			     */,set:function set(value){var subtitleTrackController=this.subtitleTrackController;if(subtitleTrackController){subtitleTrackController.subtitleDisplay=value;}}/**
			     * get mode for Low-Latency HLS loading
			     * @type {boolean}
			     */},{key:"lowLatencyMode",get:function get(){return this.config.lowLatencyMode;}/**
			     * Enable/disable Low-Latency HLS part playlist and segment loading, and start live streams at playlist PART-HOLD-BACK rather than HOLD-BACK.
			     * @type {boolean}
			     */,set:function set(mode){this.config.lowLatencyMode=mode;}/**
			     * position (in seconds) of live sync point (ie edge of live position minus safety delay defined by ```hls.config.liveSyncDuration```)
			     * @type {number}
			     */},{key:"liveSyncPosition",get:function get(){return this.latencyController.liveSyncPosition;}/**
			     * estimated position (in seconds) of live edge (ie edge of live playlist plus time sync playlist advanced)
			     * returns 0 before first playlist is loaded
			     * @type {number}
			     */},{key:"latency",get:function get(){return this.latencyController.latency;}/**
			     * maximum distance from the edge before the player seeks forward to ```hls.liveSyncPosition```
			     * configured using ```liveMaxLatencyDurationCount``` (multiple of target duration) or ```liveMaxLatencyDuration```
			     * returns 0 before first playlist is loaded
			     * @type {number}
			     */},{key:"maxLatency",get:function get(){return this.latencyController.maxLatency;}/**
			     * target distance from the edge as calculated by the latency controller
			     * @type {number}
			     */},{key:"targetLatency",get:function get(){return this.latencyController.targetLatency;}/**
			     * the rate at which the edge of the current live playlist is advancing or 1 if there is none
			     * @type {number}
			     */},{key:"drift",get:function get(){return this.latencyController.drift;}/**
			     * set to true when startLoad is called before MANIFEST_PARSED event
			     * @type {boolean}
			     */},{key:"forceStartLoad",get:function get(){return this.streamController.forceStartLoad;}}],[{key:"version",get:function get(){return"1.1.5";}},{key:"Events",get:function get(){return _events__WEBPACK_IMPORTED_MODULE_12__["Events"];}},{key:"ErrorTypes",get:function get(){return _errors__WEBPACK_IMPORTED_MODULE_13__["ErrorTypes"];}},{key:"ErrorDetails",get:function get(){return _errors__WEBPACK_IMPORTED_MODULE_13__["ErrorDetails"];}},{key:"DefaultConfig",get:function get(){if(!Hls.defaultConfig){return _config__WEBPACK_IMPORTED_MODULE_10__["hlsDefaultConfig"];}return Hls.defaultConfig;}/**
			     * @type {HlsConfig}
			     */,set:function set(defaultConfig){Hls.defaultConfig=defaultConfig;}}]);return Hls;}();Hls.defaultConfig=void 0;/***/},/***/"./src/is-supported.ts":/*!*****************************!*\
			  !*** ./src/is-supported.ts ***!
			  \*****************************/ /*! exports provided: isSupported, changeTypeSupported */ /***/function srcIsSupportedTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"isSupported",function(){return isSupported;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"changeTypeSupported",function(){return changeTypeSupported;});/* harmony import */var _utils_mediasource_helper__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./utils/mediasource-helper */"./src/utils/mediasource-helper.ts");function getSourceBuffer(){return self.SourceBuffer||self.WebKitSourceBuffer;}function isSupported(){var mediaSource=Object(_utils_mediasource_helper__WEBPACK_IMPORTED_MODULE_0__["getMediaSource"])();if(!mediaSource){return false;}var sourceBuffer=getSourceBuffer();var isTypeSupported=mediaSource&&typeof mediaSource.isTypeSupported==='function'&&mediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"');// if SourceBuffer is exposed ensure its API is valid
// safari and old version of Chrome doe not expose SourceBuffer globally so checking SourceBuffer.prototype is impossible
var sourceBufferValidAPI=!sourceBuffer||sourceBuffer.prototype&&typeof sourceBuffer.prototype.appendBuffer==='function'&&typeof sourceBuffer.prototype.remove==='function';return!!isTypeSupported&&!!sourceBufferValidAPI;}function changeTypeSupported(){var _sourceBuffer$prototy;var sourceBuffer=getSourceBuffer();return typeof(sourceBuffer===null||sourceBuffer===void 0?void 0:(_sourceBuffer$prototy=sourceBuffer.prototype)===null||_sourceBuffer$prototy===void 0?void 0:_sourceBuffer$prototy.changeType)==='function';}/***/},/***/"./src/loader/fragment-loader.ts":/*!***************************************!*\
			  !*** ./src/loader/fragment-loader.ts ***!
			  \***************************************/ /*! exports provided: default, LoadError */ /***/function srcLoaderFragmentLoaderTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"default",function(){return FragmentLoader;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"LoadError",function(){return LoadError;});/* harmony import */var _home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./src/polyfills/number */"./src/polyfills/number.ts");/* harmony import */var _errors__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../errors */"./src/errors.ts");function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype);subClass.prototype.constructor=subClass;_setPrototypeOf(subClass,superClass);}function _wrapNativeSuper(Class){var _cache=typeof Map==="function"?new Map():undefined;_wrapNativeSuper=function _wrapNativeSuper(Class){if(Class===null||!_isNativeFunction(Class))return Class;if(typeof Class!=="function"){throw new TypeError("Super expression must either be null or a function");}if(typeof _cache!=="undefined"){if(_cache.has(Class))return _cache.get(Class);_cache.set(Class,Wrapper);}function Wrapper(){return _construct(Class,arguments,_getPrototypeOf(this).constructor);}Wrapper.prototype=Object.create(Class.prototype,{constructor:{value:Wrapper,enumerable:false,writable:true,configurable:true}});return _setPrototypeOf(Wrapper,Class);};return _wrapNativeSuper(Class);}function _construct(Parent,args,Class){if(_isNativeReflectConstruct()){_construct=Reflect.construct;}else{_construct=function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var Constructor=Function.bind.apply(Parent,a);var instance=new Constructor();if(Class)_setPrototypeOf(instance,Class.prototype);return instance;};}return _construct.apply(null,arguments);}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}function _isNativeFunction(fn){return Function.toString.call(fn).indexOf("[native code]")!==-1;}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf(o);}var MIN_CHUNK_SIZE=Math.pow(2,17);// 128kb
var FragmentLoader=/*#__PURE__*/function(){function FragmentLoader(config){this.config=void 0;this.loader=null;this.partLoadTimeout=-1;this.config=config;}var _proto=FragmentLoader.prototype;_proto.destroy=function destroy(){if(this.loader){this.loader.destroy();this.loader=null;}};_proto.abort=function abort(){if(this.loader){// Abort the loader for current fragment. Only one may load at any given time
this.loader.abort();}};_proto.load=function load(frag,_onProgress){var _this=this;var url=frag.url;if(!url){return Promise.reject(new LoadError({type:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorTypes"].NETWORK_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorDetails"].FRAG_LOAD_ERROR,fatal:false,frag:frag,networkDetails:null},"Fragment does not have a "+(url?'part list':'url')));}this.abort();var config=this.config;var FragmentILoader=config.fLoader;var DefaultILoader=config.loader;return new Promise(function(resolve,reject){if(_this.loader){_this.loader.destroy();}var loader=_this.loader=frag.loader=FragmentILoader?new FragmentILoader(config):new DefaultILoader(config);var loaderContext=createLoaderContext(frag);var loaderConfig={timeout:config.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:config.fragLoadingMaxRetryTimeout,highWaterMark:MIN_CHUNK_SIZE};// Assign frag stats to the loader's stats reference
frag.stats=loader.stats;loader.load(loaderContext,loaderConfig,{onSuccess:function onSuccess(response,stats,context,networkDetails){_this.resetLoader(frag,loader);resolve({frag:frag,part:null,payload:response.data,networkDetails:networkDetails});},onError:function onError(response,context,networkDetails){_this.resetLoader(frag,loader);reject(new LoadError({type:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorTypes"].NETWORK_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorDetails"].FRAG_LOAD_ERROR,fatal:false,frag:frag,response:response,networkDetails:networkDetails}));},onAbort:function onAbort(stats,context,networkDetails){_this.resetLoader(frag,loader);reject(new LoadError({type:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorTypes"].NETWORK_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorDetails"].INTERNAL_ABORTED,fatal:false,frag:frag,networkDetails:networkDetails}));},onTimeout:function onTimeout(response,context,networkDetails){_this.resetLoader(frag,loader);reject(new LoadError({type:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorTypes"].NETWORK_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorDetails"].FRAG_LOAD_TIMEOUT,fatal:false,frag:frag,networkDetails:networkDetails}));},onProgress:function onProgress(stats,context,data,networkDetails){if(_onProgress){_onProgress({frag:frag,part:null,payload:data,networkDetails:networkDetails});}}});});};_proto.loadPart=function loadPart(frag,part,onProgress){var _this2=this;this.abort();var config=this.config;var FragmentILoader=config.fLoader;var DefaultILoader=config.loader;return new Promise(function(resolve,reject){if(_this2.loader){_this2.loader.destroy();}var loader=_this2.loader=frag.loader=FragmentILoader?new FragmentILoader(config):new DefaultILoader(config);var loaderContext=createLoaderContext(frag,part);var loaderConfig={timeout:config.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:config.fragLoadingMaxRetryTimeout,highWaterMark:MIN_CHUNK_SIZE};// Assign part stats to the loader's stats reference
part.stats=loader.stats;loader.load(loaderContext,loaderConfig,{onSuccess:function onSuccess(response,stats,context,networkDetails){_this2.resetLoader(frag,loader);_this2.updateStatsFromPart(frag,part);var partLoadedData={frag:frag,part:part,payload:response.data,networkDetails:networkDetails};onProgress(partLoadedData);resolve(partLoadedData);},onError:function onError(response,context,networkDetails){_this2.resetLoader(frag,loader);reject(new LoadError({type:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorTypes"].NETWORK_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorDetails"].FRAG_LOAD_ERROR,fatal:false,frag:frag,part:part,response:response,networkDetails:networkDetails}));},onAbort:function onAbort(stats,context,networkDetails){frag.stats.aborted=part.stats.aborted;_this2.resetLoader(frag,loader);reject(new LoadError({type:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorTypes"].NETWORK_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorDetails"].INTERNAL_ABORTED,fatal:false,frag:frag,part:part,networkDetails:networkDetails}));},onTimeout:function onTimeout(response,context,networkDetails){_this2.resetLoader(frag,loader);reject(new LoadError({type:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorTypes"].NETWORK_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorDetails"].FRAG_LOAD_TIMEOUT,fatal:false,frag:frag,part:part,networkDetails:networkDetails}));}});});};_proto.updateStatsFromPart=function updateStatsFromPart(frag,part){var fragStats=frag.stats;var partStats=part.stats;var partTotal=partStats.total;fragStats.loaded+=partStats.loaded;if(partTotal){var estTotalParts=Math.round(frag.duration/part.duration);var estLoadedParts=Math.min(Math.round(fragStats.loaded/partTotal),estTotalParts);var estRemainingParts=estTotalParts-estLoadedParts;var estRemainingBytes=estRemainingParts*Math.round(fragStats.loaded/estLoadedParts);fragStats.total=fragStats.loaded+estRemainingBytes;}else{fragStats.total=Math.max(fragStats.loaded,fragStats.total);}var fragLoading=fragStats.loading;var partLoading=partStats.loading;if(fragLoading.start){// add to fragment loader latency
fragLoading.first+=partLoading.first-partLoading.start;}else{fragLoading.start=partLoading.start;fragLoading.first=partLoading.first;}fragLoading.end=partLoading.end;};_proto.resetLoader=function resetLoader(frag,loader){frag.loader=null;if(this.loader===loader){self.clearTimeout(this.partLoadTimeout);this.loader=null;}loader.destroy();};return FragmentLoader;}();function createLoaderContext(frag,part){if(part===void 0){part=null;}var segment=part||frag;var loaderContext={frag:frag,part:part,responseType:'arraybuffer',url:segment.url,headers:{},rangeStart:0,rangeEnd:0};var start=segment.byteRangeStartOffset;var end=segment.byteRangeEndOffset;if(Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(start)&&Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(end)){loaderContext.rangeStart=start;loaderContext.rangeEnd=end;}return loaderContext;}var LoadError=/*#__PURE__*/function(_Error){_inheritsLoose(LoadError,_Error);function LoadError(data){var _this3;for(var _len=arguments.length,params=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){params[_key-1]=arguments[_key];}_this3=_Error.call.apply(_Error,[this].concat(params))||this;_this3.data=void 0;_this3.data=data;return _this3;}return LoadError;}(/*#__PURE__*/_wrapNativeSuper(Error));/***/},/***/"./src/loader/fragment.ts":/*!********************************!*\
			  !*** ./src/loader/fragment.ts ***!
			  \********************************/ /*! exports provided: ElementaryStreamTypes, BaseSegment, Fragment, Part */ /***/function srcLoaderFragmentTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"ElementaryStreamTypes",function(){return ElementaryStreamTypes;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"BaseSegment",function(){return BaseSegment;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"Fragment",function(){return Fragment;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"Part",function(){return Part;});/* harmony import */var _home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./src/polyfills/number */"./src/polyfills/number.ts");/* harmony import */var url_toolkit__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! url-toolkit */"./node_modules/url-toolkit/src/url-toolkit.js");/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../utils/logger */"./src/utils/logger.ts");/* harmony import */var _level_key__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ./level-key */"./src/loader/level-key.ts");/* harmony import */var _load_stats__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(/*! ./load-stats */"./src/loader/load-stats.ts");function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype);subClass.prototype.constructor=subClass;_setPrototypeOf(subClass,superClass);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}var ElementaryStreamTypes;(function(ElementaryStreamTypes){ElementaryStreamTypes["AUDIO"]="audio";ElementaryStreamTypes["VIDEO"]="video";ElementaryStreamTypes["AUDIOVIDEO"]="audiovideo";})(ElementaryStreamTypes||(ElementaryStreamTypes={}));var BaseSegment=/*#__PURE__*/function(){// baseurl is the URL to the playlist
// relurl is the portion of the URL that comes from inside the playlist.
// Holds the types of data this fragment supports
function BaseSegment(baseurl){var _this$elementaryStrea;this._byteRange=null;this._url=null;this.baseurl=void 0;this.relurl=void 0;this.elementaryStreams=(_this$elementaryStrea={},_this$elementaryStrea[ElementaryStreamTypes.AUDIO]=null,_this$elementaryStrea[ElementaryStreamTypes.VIDEO]=null,_this$elementaryStrea[ElementaryStreamTypes.AUDIOVIDEO]=null,_this$elementaryStrea);this.baseurl=baseurl;}// setByteRange converts a EXT-X-BYTERANGE attribute into a two element array
var _proto=BaseSegment.prototype;_proto.setByteRange=function setByteRange(value,previous){var params=value.split('@',2);var byteRange=[];if(params.length===1){byteRange[0]=previous?previous.byteRangeEndOffset:0;}else{byteRange[0]=parseInt(params[1]);}byteRange[1]=parseInt(params[0])+byteRange[0];this._byteRange=byteRange;};_createClass(BaseSegment,[{key:"byteRange",get:function get(){if(!this._byteRange){return[];}return this._byteRange;}},{key:"byteRangeStartOffset",get:function get(){return this.byteRange[0];}},{key:"byteRangeEndOffset",get:function get(){return this.byteRange[1];}},{key:"url",get:function get(){if(!this._url&&this.baseurl&&this.relurl){this._url=Object(url_toolkit__WEBPACK_IMPORTED_MODULE_1__["buildAbsoluteURL"])(this.baseurl,this.relurl,{alwaysNormalize:true});}return this._url||'';},set:function set(value){this._url=value;}}]);return BaseSegment;}();var Fragment=/*#__PURE__*/function(_BaseSegment){_inheritsLoose(Fragment,_BaseSegment);// EXTINF has to be present for a m38 to be considered valid
// sn notates the sequence number for a segment, and if set to a string can be 'initSegment'
// levelkey is the EXT-X-KEY that applies to this segment for decryption
// core difference from the private field _decryptdata is the lack of the initialized IV
// _decryptdata will set the IV for this segment based on the segment number in the fragment
// A string representing the fragment type
// A reference to the loader. Set while the fragment is loading, and removed afterwards. Used to abort fragment loading
// The level/track index to which the fragment belongs
// The continuity counter of the fragment
// The starting Presentation Time Stamp (PTS) of the fragment. Set after transmux complete.
// The ending Presentation Time Stamp (PTS) of the fragment. Set after transmux complete.
// The latest Presentation Time Stamp (PTS) appended to the buffer.
// The starting Decode Time Stamp (DTS) of the fragment. Set after transmux complete.
// The ending Decode Time Stamp (DTS) of the fragment. Set after transmux complete.
// The start time of the fragment, as listed in the manifest. Updated after transmux complete.
// Set by `updateFragPTSDTS` in level-helper
// The maximum starting Presentation Time Stamp (audio/video PTS) of the fragment. Set after transmux complete.
// The minimum ending Presentation Time Stamp (audio/video PTS) of the fragment. Set after transmux complete.
// Load/parse timing information
// A flag indicating whether the segment was downloaded in order to test bitrate, and was not buffered
// #EXTINF  segment title
// The Media Initialization Section for this segment
function Fragment(type,baseurl){var _this;_this=_BaseSegment.call(this,baseurl)||this;_this._decryptdata=null;_this.rawProgramDateTime=null;_this.programDateTime=null;_this.tagList=[];_this.duration=0;_this.sn=0;_this.levelkey=void 0;_this.type=void 0;_this.loader=null;_this.level=-1;_this.cc=0;_this.startPTS=void 0;_this.endPTS=void 0;_this.appendedPTS=void 0;_this.startDTS=void 0;_this.endDTS=void 0;_this.start=0;_this.deltaPTS=void 0;_this.maxStartPTS=void 0;_this.minEndPTS=void 0;_this.stats=new _load_stats__WEBPACK_IMPORTED_MODULE_4__["LoadStats"]();_this.urlId=0;_this.data=void 0;_this.bitrateTest=false;_this.title=null;_this.initSegment=null;_this.type=type;return _this;}var _proto2=Fragment.prototype;/**
			   * Utility method for parseLevelPlaylist to create an initialization vector for a given segment
			   * @param {number} segmentNumber - segment number to generate IV with
			   * @returns {Uint8Array}
			   */_proto2.createInitializationVector=function createInitializationVector(segmentNumber){var uint8View=new Uint8Array(16);for(var i=12;i<16;i++){uint8View[i]=segmentNumber>>8*(15-i)&0xff;}return uint8View;}/**
			   * Utility method for parseLevelPlaylist to get a fragment's decryption data from the currently parsed encryption key data
			   * @param levelkey - a playlist's encryption info
			   * @param segmentNumber - the fragment's segment number
			   * @returns {LevelKey} - an object to be applied as a fragment's decryptdata
			   */;_proto2.setDecryptDataFromLevelKey=function setDecryptDataFromLevelKey(levelkey,segmentNumber){var decryptdata=levelkey;if((levelkey===null||levelkey===void 0?void 0:levelkey.method)==='AES-128'&&levelkey.uri&&!levelkey.iv){decryptdata=_level_key__WEBPACK_IMPORTED_MODULE_3__["LevelKey"].fromURI(levelkey.uri);decryptdata.method=levelkey.method;decryptdata.iv=this.createInitializationVector(segmentNumber);decryptdata.keyFormat='identity';}return decryptdata;};_proto2.setElementaryStreamInfo=function setElementaryStreamInfo(type,startPTS,endPTS,startDTS,endDTS,partial){if(partial===void 0){partial=false;}var elementaryStreams=this.elementaryStreams;var info=elementaryStreams[type];if(!info){elementaryStreams[type]={startPTS:startPTS,endPTS:endPTS,startDTS:startDTS,endDTS:endDTS,partial:partial};return;}info.startPTS=Math.min(info.startPTS,startPTS);info.endPTS=Math.max(info.endPTS,endPTS);info.startDTS=Math.min(info.startDTS,startDTS);info.endDTS=Math.max(info.endDTS,endDTS);};_proto2.clearElementaryStreamInfo=function clearElementaryStreamInfo(){var elementaryStreams=this.elementaryStreams;elementaryStreams[ElementaryStreamTypes.AUDIO]=null;elementaryStreams[ElementaryStreamTypes.VIDEO]=null;elementaryStreams[ElementaryStreamTypes.AUDIOVIDEO]=null;};_createClass(Fragment,[{key:"decryptdata",get:function get(){if(!this.levelkey&&!this._decryptdata){return null;}if(!this._decryptdata&&this.levelkey){var sn=this.sn;if(typeof sn!=='number'){// We are fetching decryption data for a initialization segment
// If the segment was encrypted with AES-128
// It must have an IV defined. We cannot substitute the Segment Number in.
if(this.levelkey&&this.levelkey.method==='AES-128'&&!this.levelkey.iv){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].warn("missing IV for initialization segment with method=\""+this.levelkey.method+"\" - compliance issue");}/*
			          Be converted to a Number.
			          'initSegment' will become NaN.
			          NaN, which when converted through ToInt32() -> +0.
			          ---
			          Explicitly set sn to resulting value from implicit conversions 'initSegment' values for IV generation.
			          */sn=0;}this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,sn);}return this._decryptdata;}},{key:"end",get:function get(){return this.start+this.duration;}},{key:"endProgramDateTime",get:function get(){if(this.programDateTime===null){return null;}if(!Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(this.programDateTime)){return null;}var duration=!Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(this.duration)?0:this.duration;return this.programDateTime+duration*1000;}},{key:"encrypted",get:function get(){var _this$decryptdata;// At the m3u8-parser level we need to add support for manifest signalled keyformats
// when we want the fragment to start reporting that it is encrypted.
// Currently, keyFormat will only be set for identity keys
if((_this$decryptdata=this.decryptdata)!==null&&_this$decryptdata!==void 0&&_this$decryptdata.keyFormat&&this.decryptdata.uri){return true;}return false;}}]);return Fragment;}(BaseSegment);var Part=/*#__PURE__*/function(_BaseSegment2){_inheritsLoose(Part,_BaseSegment2);function Part(partAttrs,frag,baseurl,index,previous){var _this2;_this2=_BaseSegment2.call(this,baseurl)||this;_this2.fragOffset=0;_this2.duration=0;_this2.gap=false;_this2.independent=false;_this2.relurl=void 0;_this2.fragment=void 0;_this2.index=void 0;_this2.stats=new _load_stats__WEBPACK_IMPORTED_MODULE_4__["LoadStats"]();_this2.duration=partAttrs.decimalFloatingPoint('DURATION');_this2.gap=partAttrs.bool('GAP');_this2.independent=partAttrs.bool('INDEPENDENT');_this2.relurl=partAttrs.enumeratedString('URI');_this2.fragment=frag;_this2.index=index;var byteRange=partAttrs.enumeratedString('BYTERANGE');if(byteRange){_this2.setByteRange(byteRange,previous);}if(previous){_this2.fragOffset=previous.fragOffset+previous.duration;}return _this2;}_createClass(Part,[{key:"start",get:function get(){return this.fragment.start+this.fragOffset;}},{key:"end",get:function get(){return this.start+this.duration;}},{key:"loaded",get:function get(){var elementaryStreams=this.elementaryStreams;return!!(elementaryStreams.audio||elementaryStreams.video||elementaryStreams.audiovideo);}}]);return Part;}(BaseSegment);/***/},/***/"./src/loader/key-loader.ts":/*!**********************************!*\
			  !*** ./src/loader/key-loader.ts ***!
			  \**********************************/ /*! exports provided: default */ /***/function srcLoaderKeyLoaderTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"default",function(){return KeyLoader;});/* harmony import */var _events__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../events */"./src/events.ts");/* harmony import */var _errors__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../errors */"./src/errors.ts");/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../utils/logger */"./src/utils/logger.ts");/*
			 * Decrypt key Loader
			 */var KeyLoader=/*#__PURE__*/function(){function KeyLoader(hls){this.hls=void 0;this.loaders={};this.decryptkey=null;this.decrypturl=null;this.hls=hls;this._registerListeners();}var _proto=KeyLoader.prototype;_proto._registerListeners=function _registerListeners(){this.hls.on(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].KEY_LOADING,this.onKeyLoading,this);};_proto._unregisterListeners=function _unregisterListeners(){this.hls.off(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].KEY_LOADING,this.onKeyLoading);};_proto.destroy=function destroy(){this._unregisterListeners();for(var loaderName in this.loaders){var loader=this.loaders[loaderName];if(loader){loader.destroy();}}this.loaders={};};_proto.onKeyLoading=function onKeyLoading(event,data){var frag=data.frag;var type=frag.type;var loader=this.loaders[type];if(!frag.decryptdata){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].warn('Missing decryption data on fragment in onKeyLoading');return;}// Load the key if the uri is different from previous one, or if the decrypt key has not yet been retrieved
var uri=frag.decryptdata.uri;if(uri!==this.decrypturl||this.decryptkey===null){var config=this.hls.config;if(loader){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].warn("abort previous key loader for type:"+type);loader.abort();}if(!uri){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].warn('key uri is falsy');return;}var Loader=config.loader;var fragLoader=frag.loader=this.loaders[type]=new Loader(config);this.decrypturl=uri;this.decryptkey=null;var loaderContext={url:uri,frag:frag,responseType:'arraybuffer'};// maxRetry is 0 so that instead of retrying the same key on the same variant multiple times,
// key-loader will trigger an error and rely on stream-controller to handle retry logic.
// this will also align retry logic with fragment-loader
var loaderConfig={timeout:config.fragLoadingTimeOut,maxRetry:0,retryDelay:config.fragLoadingRetryDelay,maxRetryDelay:config.fragLoadingMaxRetryTimeout,highWaterMark:0};var loaderCallbacks={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};fragLoader.load(loaderContext,loaderConfig,loaderCallbacks);}else if(this.decryptkey){// Return the key if it's already been loaded
frag.decryptdata.key=this.decryptkey;this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].KEY_LOADED,{frag:frag});}};_proto.loadsuccess=function loadsuccess(response,stats,context){var frag=context.frag;if(!frag.decryptdata){_utils_logger__WEBPACK_IMPORTED_MODULE_2__["logger"].error('after key load, decryptdata unset');return;}this.decryptkey=frag.decryptdata.key=new Uint8Array(response.data);// detach fragment loader on load success
frag.loader=null;delete this.loaders[frag.type];this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].KEY_LOADED,{frag:frag});};_proto.loaderror=function loaderror(response,context){var frag=context.frag;var loader=frag.loader;if(loader){loader.abort();}delete this.loaders[frag.type];this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].ERROR,{type:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorTypes"].NETWORK_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorDetails"].KEY_LOAD_ERROR,fatal:false,frag:frag,response:response});};_proto.loadtimeout=function loadtimeout(stats,context){var frag=context.frag;var loader=frag.loader;if(loader){loader.abort();}delete this.loaders[frag.type];this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_0__["Events"].ERROR,{type:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorTypes"].NETWORK_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_1__["ErrorDetails"].KEY_LOAD_TIMEOUT,fatal:false,frag:frag});};return KeyLoader;}();/***/},/***/"./src/loader/level-details.ts":/*!*************************************!*\
			  !*** ./src/loader/level-details.ts ***!
			  \*************************************/ /*! exports provided: LevelDetails */ /***/function srcLoaderLevelDetailsTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"LevelDetails",function(){return LevelDetails;});/* harmony import */var _home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./src/polyfills/number */"./src/polyfills/number.ts");function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}var DEFAULT_TARGET_DURATION=10;var LevelDetails=/*#__PURE__*/function(){// Manifest reload synchronization
function LevelDetails(baseUrl){this.PTSKnown=false;this.alignedSliding=false;this.averagetargetduration=void 0;this.endCC=0;this.endSN=0;this.fragments=void 0;this.fragmentHint=void 0;this.partList=null;this.live=true;this.ageHeader=0;this.advancedDateTime=void 0;this.updated=true;this.advanced=true;this.availabilityDelay=void 0;this.misses=0;this.needSidxRanges=false;this.startCC=0;this.startSN=0;this.startTimeOffset=null;this.targetduration=0;this.totalduration=0;this.type=null;this.url=void 0;this.m3u8='';this.version=null;this.canBlockReload=false;this.canSkipUntil=0;this.canSkipDateRanges=false;this.skippedSegments=0;this.recentlyRemovedDateranges=void 0;this.partHoldBack=0;this.holdBack=0;this.partTarget=0;this.preloadHint=void 0;this.renditionReports=void 0;this.tuneInGoal=0;this.deltaUpdateFailed=void 0;this.driftStartTime=0;this.driftEndTime=0;this.driftStart=0;this.driftEnd=0;this.fragments=[];this.url=baseUrl;}var _proto=LevelDetails.prototype;_proto.reloaded=function reloaded(previous){if(!previous){this.advanced=true;this.updated=true;return;}var partSnDiff=this.lastPartSn-previous.lastPartSn;var partIndexDiff=this.lastPartIndex-previous.lastPartIndex;this.updated=this.endSN!==previous.endSN||!!partIndexDiff||!!partSnDiff;this.advanced=this.endSN>previous.endSN||partSnDiff>0||partSnDiff===0&&partIndexDiff>0;if(this.updated||this.advanced){this.misses=Math.floor(previous.misses*0.6);}else{this.misses=previous.misses+1;}this.availabilityDelay=previous.availabilityDelay;};_createClass(LevelDetails,[{key:"hasProgramDateTime",get:function get(){if(this.fragments.length){return Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(this.fragments[this.fragments.length-1].programDateTime);}return false;}},{key:"levelTargetDuration",get:function get(){return this.averagetargetduration||this.targetduration||DEFAULT_TARGET_DURATION;}},{key:"drift",get:function get(){var runTime=this.driftEndTime-this.driftStartTime;if(runTime>0){var runDuration=this.driftEnd-this.driftStart;return runDuration*1000/runTime;}return 1;}},{key:"edge",get:function get(){return this.partEnd||this.fragmentEnd;}},{key:"partEnd",get:function get(){var _this$partList;if((_this$partList=this.partList)!==null&&_this$partList!==void 0&&_this$partList.length){return this.partList[this.partList.length-1].end;}return this.fragmentEnd;}},{key:"fragmentEnd",get:function get(){var _this$fragments;if((_this$fragments=this.fragments)!==null&&_this$fragments!==void 0&&_this$fragments.length){return this.fragments[this.fragments.length-1].end;}return 0;}},{key:"age",get:function get(){if(this.advancedDateTime){return Math.max(Date.now()-this.advancedDateTime,0)/1000;}return 0;}},{key:"lastPartIndex",get:function get(){var _this$partList2;if((_this$partList2=this.partList)!==null&&_this$partList2!==void 0&&_this$partList2.length){return this.partList[this.partList.length-1].index;}return-1;}},{key:"lastPartSn",get:function get(){var _this$partList3;if((_this$partList3=this.partList)!==null&&_this$partList3!==void 0&&_this$partList3.length){return this.partList[this.partList.length-1].fragment.sn;}return this.endSN;}}]);return LevelDetails;}();/***/},/***/"./src/loader/level-key.ts":/*!*********************************!*\
			  !*** ./src/loader/level-key.ts ***!
			  \*********************************/ /*! exports provided: LevelKey */ /***/function srcLoaderLevelKeyTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"LevelKey",function(){return LevelKey;});/* harmony import */var url_toolkit__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! url-toolkit */"./node_modules/url-toolkit/src/url-toolkit.js");function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}var LevelKey=/*#__PURE__*/function(){LevelKey.fromURL=function fromURL(baseUrl,relativeUrl){return new LevelKey(baseUrl,relativeUrl);};LevelKey.fromURI=function fromURI(uri){return new LevelKey(uri);};function LevelKey(absoluteOrBaseURI,relativeURL){this._uri=null;this.method=null;this.keyFormat=null;this.keyFormatVersions=null;this.keyID=null;this.key=null;this.iv=null;if(relativeURL){this._uri=Object(url_toolkit__WEBPACK_IMPORTED_MODULE_0__["buildAbsoluteURL"])(absoluteOrBaseURI,relativeURL,{alwaysNormalize:true});}else{this._uri=absoluteOrBaseURI;}}_createClass(LevelKey,[{key:"uri",get:function get(){return this._uri;}}]);return LevelKey;}();/***/},/***/"./src/loader/load-stats.ts":/*!**********************************!*\
			  !*** ./src/loader/load-stats.ts ***!
			  \**********************************/ /*! exports provided: LoadStats */ /***/function srcLoaderLoadStatsTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"LoadStats",function(){return LoadStats;});var LoadStats=function LoadStats(){this.aborted=false;this.loaded=0;this.retry=0;this.total=0;this.chunkCount=0;this.bwEstimate=0;this.loading={start:0,first:0,end:0};this.parsing={start:0,end:0};this.buffering={start:0,first:0,end:0};};/***/},/***/"./src/loader/m3u8-parser.ts":/*!***********************************!*\
			  !*** ./src/loader/m3u8-parser.ts ***!
			  \***********************************/ /*! exports provided: default */ /***/function srcLoaderM3u8ParserTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"default",function(){return M3U8Parser;});/* harmony import */var _home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./src/polyfills/number */"./src/polyfills/number.ts");/* harmony import */var url_toolkit__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! url-toolkit */"./node_modules/url-toolkit/src/url-toolkit.js");/* harmony import */var _fragment__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ./fragment */"./src/loader/fragment.ts");/* harmony import */var _level_details__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ./level-details */"./src/loader/level-details.ts");/* harmony import */var _level_key__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(/*! ./level-key */"./src/loader/level-key.ts");/* harmony import */var _utils_attr_list__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(/*! ../utils/attr-list */"./src/utils/attr-list.ts");/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(/*! ../utils/logger */"./src/utils/logger.ts");/* harmony import */var _utils_codecs__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(/*! ../utils/codecs */"./src/utils/codecs.ts");// https://regex101.com is your friend
var MASTER_PLAYLIST_REGEX=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g;var MASTER_PLAYLIST_MEDIA_REGEX=/#EXT-X-MEDIA:(.*)/g;var LEVEL_PLAYLIST_REGEX_FAST=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,// duration (#EXTINF:<duration>,<title>), group 1 => duration, group 2 => title
/(?!#) *(\S[\S ]*)/.source,// segment URI, group 3 => the URI (note newline is not eaten)
/#EXT-X-BYTERANGE:*(.+)/.source,// next segment's byterange, group 4 => range spec (x@y)
/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,// next segment's program date/time group 5 => the datetime spec
/#.*/.source// All other non-segment oriented tags will match with all groups empty
].join('|'),'g');var LEVEL_PLAYLIST_REGEX_SLOW=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join('|'));var MP4_REGEX_SUFFIX=/\.(mp4|m4s|m4v|m4a)$/i;function isMP4Url(url){var _URLToolkit$parseURL$,_URLToolkit$parseURL;return MP4_REGEX_SUFFIX.test((_URLToolkit$parseURL$=(_URLToolkit$parseURL=url_toolkit__WEBPACK_IMPORTED_MODULE_1__["parseURL"](url))===null||_URLToolkit$parseURL===void 0?void 0:_URLToolkit$parseURL.path)!=null?_URLToolkit$parseURL$:'');}var M3U8Parser=/*#__PURE__*/function(){function M3U8Parser(){}M3U8Parser.findGroup=function findGroup(groups,mediaGroupId){for(var i=0;i<groups.length;i++){var group=groups[i];if(group.id===mediaGroupId){return group;}}};M3U8Parser.convertAVC1ToAVCOTI=function convertAVC1ToAVCOTI(codec){// Convert avc1 codec string from RFC-4281 to RFC-6381 for MediaSource.isTypeSupported
var avcdata=codec.split('.');if(avcdata.length>2){var result=avcdata.shift()+'.';result+=parseInt(avcdata.shift()).toString(16);result+=('000'+parseInt(avcdata.shift()).toString(16)).substr(-4);return result;}return codec;};M3U8Parser.resolve=function resolve(url,baseUrl){return url_toolkit__WEBPACK_IMPORTED_MODULE_1__["buildAbsoluteURL"](baseUrl,url,{alwaysNormalize:true});};M3U8Parser.parseMasterPlaylist=function parseMasterPlaylist(string,baseurl){var levels=[];var sessionData={};var hasSessionData=false;MASTER_PLAYLIST_REGEX.lastIndex=0;var result;while((result=MASTER_PLAYLIST_REGEX.exec(string))!=null){if(result[1]){// '#EXT-X-STREAM-INF' is found, parse level tag  in group 1
var attrs=new _utils_attr_list__WEBPACK_IMPORTED_MODULE_5__["AttrList"](result[1]);var level={attrs:attrs,bitrate:attrs.decimalInteger('AVERAGE-BANDWIDTH')||attrs.decimalInteger('BANDWIDTH'),name:attrs.NAME,url:M3U8Parser.resolve(result[2],baseurl)};var resolution=attrs.decimalResolution('RESOLUTION');if(resolution){level.width=resolution.width;level.height=resolution.height;}setCodecs((attrs.CODECS||'').split(/[ ,]+/).filter(function(c){return c;}),level);if(level.videoCodec&&level.videoCodec.indexOf('avc1')!==-1){level.videoCodec=M3U8Parser.convertAVC1ToAVCOTI(level.videoCodec);}levels.push(level);}else if(result[3]){// '#EXT-X-SESSION-DATA' is found, parse session data in group 3
var sessionAttrs=new _utils_attr_list__WEBPACK_IMPORTED_MODULE_5__["AttrList"](result[3]);if(sessionAttrs['DATA-ID']){hasSessionData=true;sessionData[sessionAttrs['DATA-ID']]=sessionAttrs;}}}return{levels:levels,sessionData:hasSessionData?sessionData:null};};M3U8Parser.parseMasterPlaylistMedia=function parseMasterPlaylistMedia(string,baseurl,type,groups){if(groups===void 0){groups=[];}var result;var medias=[];var id=0;MASTER_PLAYLIST_MEDIA_REGEX.lastIndex=0;while((result=MASTER_PLAYLIST_MEDIA_REGEX.exec(string))!==null){var attrs=new _utils_attr_list__WEBPACK_IMPORTED_MODULE_5__["AttrList"](result[1]);if(attrs.TYPE===type){var media={attrs:attrs,bitrate:0,id:id++,groupId:attrs['GROUP-ID'],instreamId:attrs['INSTREAM-ID'],name:attrs.NAME||attrs.LANGUAGE||'',type:type,default:attrs.bool('DEFAULT'),autoselect:attrs.bool('AUTOSELECT'),forced:attrs.bool('FORCED'),lang:attrs.LANGUAGE,url:attrs.URI?M3U8Parser.resolve(attrs.URI,baseurl):''};if(groups.length){// If there are audio or text groups signalled in the manifest, let's look for a matching codec string for this track
// If we don't find the track signalled, lets use the first audio groups codec we have
// Acting as a best guess
var groupCodec=M3U8Parser.findGroup(groups,media.groupId)||groups[0];assignCodec(media,groupCodec,'audioCodec');assignCodec(media,groupCodec,'textCodec');}medias.push(media);}}return medias;};M3U8Parser.parseLevelPlaylist=function parseLevelPlaylist(string,baseurl,id,type,levelUrlId){var level=new _level_details__WEBPACK_IMPORTED_MODULE_3__["LevelDetails"](baseurl);var fragments=level.fragments;// The most recent init segment seen (applies to all subsequent segments)
var currentInitSegment=null;var currentSN=0;var currentPart=0;var totalduration=0;var discontinuityCounter=0;var prevFrag=null;var frag=new _fragment__WEBPACK_IMPORTED_MODULE_2__["Fragment"](type,baseurl);var result;var i;var levelkey;var firstPdtIndex=-1;var createNextFrag=false;LEVEL_PLAYLIST_REGEX_FAST.lastIndex=0;level.m3u8=string;while((result=LEVEL_PLAYLIST_REGEX_FAST.exec(string))!==null){if(createNextFrag){createNextFrag=false;frag=new _fragment__WEBPACK_IMPORTED_MODULE_2__["Fragment"](type,baseurl);// setup the next fragment for part loading
frag.start=totalduration;frag.sn=currentSN;frag.cc=discontinuityCounter;frag.level=id;if(currentInitSegment){frag.initSegment=currentInitSegment;frag.rawProgramDateTime=currentInitSegment.rawProgramDateTime;}}var duration=result[1];if(duration){// INF
frag.duration=parseFloat(duration);// avoid sliced strings    https://github.com/video-dev/hls.js/issues/939
var title=(' '+result[2]).slice(1);frag.title=title||null;frag.tagList.push(title?['INF',duration,title]:['INF',duration]);}else if(result[3]){// url
if(Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(frag.duration)){frag.start=totalduration;if(levelkey){frag.levelkey=levelkey;}frag.sn=currentSN;frag.level=id;frag.cc=discontinuityCounter;frag.urlId=levelUrlId;fragments.push(frag);// avoid sliced strings    https://github.com/video-dev/hls.js/issues/939
frag.relurl=(' '+result[3]).slice(1);assignProgramDateTime(frag,prevFrag);prevFrag=frag;totalduration+=frag.duration;currentSN++;currentPart=0;createNextFrag=true;}}else if(result[4]){// X-BYTERANGE
var data=(' '+result[4]).slice(1);if(prevFrag){frag.setByteRange(data,prevFrag);}else{frag.setByteRange(data);}}else if(result[5]){// PROGRAM-DATE-TIME
// avoid sliced strings    https://github.com/video-dev/hls.js/issues/939
frag.rawProgramDateTime=(' '+result[5]).slice(1);frag.tagList.push(['PROGRAM-DATE-TIME',frag.rawProgramDateTime]);if(firstPdtIndex===-1){firstPdtIndex=fragments.length;}}else{result=result[0].match(LEVEL_PLAYLIST_REGEX_SLOW);if(!result){_utils_logger__WEBPACK_IMPORTED_MODULE_6__["logger"].warn('No matches on slow regex match for level playlist!');continue;}for(i=1;i<result.length;i++){if(typeof result[i]!=='undefined'){break;}}// avoid sliced strings    https://github.com/video-dev/hls.js/issues/939
var tag=(' '+result[i]).slice(1);var value1=(' '+result[i+1]).slice(1);var value2=result[i+2]?(' '+result[i+2]).slice(1):'';switch(tag){case'PLAYLIST-TYPE':level.type=value1.toUpperCase();break;case'MEDIA-SEQUENCE':currentSN=level.startSN=parseInt(value1);break;case'SKIP':{var skipAttrs=new _utils_attr_list__WEBPACK_IMPORTED_MODULE_5__["AttrList"](value1);var skippedSegments=skipAttrs.decimalInteger('SKIPPED-SEGMENTS');if(Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(skippedSegments)){level.skippedSegments=skippedSegments;// This will result in fragments[] containing undefined values, which we will fill in with `mergeDetails`
for(var _i=skippedSegments;_i--;){fragments.unshift(null);}currentSN+=skippedSegments;}var recentlyRemovedDateranges=skipAttrs.enumeratedString('RECENTLY-REMOVED-DATERANGES');if(recentlyRemovedDateranges){level.recentlyRemovedDateranges=recentlyRemovedDateranges.split('\t');}break;}case'TARGETDURATION':level.targetduration=parseFloat(value1);break;case'VERSION':level.version=parseInt(value1);break;case'EXTM3U':break;case'ENDLIST':level.live=false;break;case'#':if(value1||value2){frag.tagList.push(value2?[value1,value2]:[value1]);}break;case'DIS':discontinuityCounter++;/* falls through */case'GAP':frag.tagList.push([tag]);break;case'BITRATE':frag.tagList.push([tag,value1]);break;case'DISCONTINUITY-SEQ':discontinuityCounter=parseInt(value1);break;case'KEY':{var _keyAttrs$enumeratedS;// https://tools.ietf.org/html/rfc8216#section-4.3.2.4
var keyAttrs=new _utils_attr_list__WEBPACK_IMPORTED_MODULE_5__["AttrList"](value1);var decryptmethod=keyAttrs.enumeratedString('METHOD');var decrypturi=keyAttrs.URI;var decryptiv=keyAttrs.hexadecimalInteger('IV');var decryptkeyformatversions=keyAttrs.enumeratedString('KEYFORMATVERSIONS');var decryptkeyid=keyAttrs.enumeratedString('KEYID');// From RFC: This attribute is OPTIONAL; its absence indicates an implicit value of "identity".
var decryptkeyformat=(_keyAttrs$enumeratedS=keyAttrs.enumeratedString('KEYFORMAT'))!=null?_keyAttrs$enumeratedS:'identity';var unsupportedKnownKeyformatsInManifest=['com.apple.streamingkeydelivery','com.microsoft.playready','urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed',// widevine (v2)
'com.widevine'// earlier widevine (v1)
];if(unsupportedKnownKeyformatsInManifest.indexOf(decryptkeyformat)>-1){_utils_logger__WEBPACK_IMPORTED_MODULE_6__["logger"].warn("Keyformat "+decryptkeyformat+" is not supported from the manifest");continue;}else if(decryptkeyformat!=='identity'){// We are supposed to skip keys we don't understand.
// As we currently only officially support identity keys
// from the manifest we shouldn't save any other key.
continue;}// TODO: multiple keys can be defined on a fragment, and we need to support this
// for clients that support both playready and widevine
if(decryptmethod){// TODO: need to determine if the level key is actually a relative URL
// if it isn't, then we should instead construct the LevelKey using fromURI.
levelkey=_level_key__WEBPACK_IMPORTED_MODULE_4__["LevelKey"].fromURL(baseurl,decrypturi);if(decrypturi&&['AES-128','SAMPLE-AES','SAMPLE-AES-CENC'].indexOf(decryptmethod)>=0){levelkey.method=decryptmethod;levelkey.keyFormat=decryptkeyformat;if(decryptkeyid){levelkey.keyID=decryptkeyid;}if(decryptkeyformatversions){levelkey.keyFormatVersions=decryptkeyformatversions;}// Initialization Vector (IV)
levelkey.iv=decryptiv;}}break;}case'START':{var startAttrs=new _utils_attr_list__WEBPACK_IMPORTED_MODULE_5__["AttrList"](value1);var startTimeOffset=startAttrs.decimalFloatingPoint('TIME-OFFSET');// TIME-OFFSET can be 0
if(Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(startTimeOffset)){level.startTimeOffset=startTimeOffset;}break;}case'MAP':{var mapAttrs=new _utils_attr_list__WEBPACK_IMPORTED_MODULE_5__["AttrList"](value1);frag.relurl=mapAttrs.URI;if(mapAttrs.BYTERANGE){frag.setByteRange(mapAttrs.BYTERANGE);}frag.level=id;frag.sn='initSegment';if(levelkey){frag.levelkey=levelkey;}frag.initSegment=null;currentInitSegment=frag;createNextFrag=true;break;}case'SERVER-CONTROL':{var serverControlAttrs=new _utils_attr_list__WEBPACK_IMPORTED_MODULE_5__["AttrList"](value1);level.canBlockReload=serverControlAttrs.bool('CAN-BLOCK-RELOAD');level.canSkipUntil=serverControlAttrs.optionalFloat('CAN-SKIP-UNTIL',0);level.canSkipDateRanges=level.canSkipUntil>0&&serverControlAttrs.bool('CAN-SKIP-DATERANGES');level.partHoldBack=serverControlAttrs.optionalFloat('PART-HOLD-BACK',0);level.holdBack=serverControlAttrs.optionalFloat('HOLD-BACK',0);break;}case'PART-INF':{var partInfAttrs=new _utils_attr_list__WEBPACK_IMPORTED_MODULE_5__["AttrList"](value1);level.partTarget=partInfAttrs.decimalFloatingPoint('PART-TARGET');break;}case'PART':{var partList=level.partList;if(!partList){partList=level.partList=[];}var previousFragmentPart=currentPart>0?partList[partList.length-1]:undefined;var index=currentPart++;var part=new _fragment__WEBPACK_IMPORTED_MODULE_2__["Part"](new _utils_attr_list__WEBPACK_IMPORTED_MODULE_5__["AttrList"](value1),frag,baseurl,index,previousFragmentPart);partList.push(part);frag.duration+=part.duration;break;}case'PRELOAD-HINT':{var preloadHintAttrs=new _utils_attr_list__WEBPACK_IMPORTED_MODULE_5__["AttrList"](value1);level.preloadHint=preloadHintAttrs;break;}case'RENDITION-REPORT':{var renditionReportAttrs=new _utils_attr_list__WEBPACK_IMPORTED_MODULE_5__["AttrList"](value1);level.renditionReports=level.renditionReports||[];level.renditionReports.push(renditionReportAttrs);break;}default:_utils_logger__WEBPACK_IMPORTED_MODULE_6__["logger"].warn("line parsed but not handled: "+result);break;}}}if(prevFrag&&!prevFrag.relurl){fragments.pop();totalduration-=prevFrag.duration;if(level.partList){level.fragmentHint=prevFrag;}}else if(level.partList){assignProgramDateTime(frag,prevFrag);frag.cc=discontinuityCounter;level.fragmentHint=frag;}var fragmentLength=fragments.length;var firstFragment=fragments[0];var lastFragment=fragments[fragmentLength-1];totalduration+=level.skippedSegments*level.targetduration;if(totalduration>0&&fragmentLength&&lastFragment){level.averagetargetduration=totalduration/fragmentLength;var lastSn=lastFragment.sn;level.endSN=lastSn!=='initSegment'?lastSn:0;if(firstFragment){level.startCC=firstFragment.cc;if(!firstFragment.initSegment){// this is a bit lurky but HLS really has no other way to tell us
// if the fragments are TS or MP4, except if we download them :/
// but this is to be able to handle SIDX.
if(level.fragments.every(function(frag){return frag.relurl&&isMP4Url(frag.relurl);})){_utils_logger__WEBPACK_IMPORTED_MODULE_6__["logger"].warn('MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX');frag=new _fragment__WEBPACK_IMPORTED_MODULE_2__["Fragment"](type,baseurl);frag.relurl=lastFragment.relurl;frag.level=id;frag.sn='initSegment';firstFragment.initSegment=frag;level.needSidxRanges=true;}}}}else{level.endSN=0;level.startCC=0;}if(level.fragmentHint){totalduration+=level.fragmentHint.duration;}level.totalduration=totalduration;level.endCC=discontinuityCounter;/**
			     * Backfill any missing PDT values
			     * "If the first EXT-X-PROGRAM-DATE-TIME tag in a Playlist appears after
			     * one or more Media Segment URIs, the client SHOULD extrapolate
			     * backward from that tag (using EXTINF durations and/or media
			     * timestamps) to associate dates with those segments."
			     * We have already extrapolated forward, but all fragments up to the first instance of PDT do not have their PDTs
			     * computed.
			     */if(firstPdtIndex>0){backfillProgramDateTimes(fragments,firstPdtIndex);}return level;};return M3U8Parser;}();function setCodecs(codecs,level){['video','audio','text'].forEach(function(type){var filtered=codecs.filter(function(codec){return Object(_utils_codecs__WEBPACK_IMPORTED_MODULE_7__["isCodecType"])(codec,type);});if(filtered.length){var preferred=filtered.filter(function(codec){return codec.lastIndexOf('avc1',0)===0||codec.lastIndexOf('mp4a',0)===0;});level[type+"Codec"]=preferred.length>0?preferred[0]:filtered[0];// remove from list
codecs=codecs.filter(function(codec){return filtered.indexOf(codec)===-1;});}});level.unknownCodecs=codecs;}function assignCodec(media,groupItem,codecProperty){var codecValue=groupItem[codecProperty];if(codecValue){media[codecProperty]=codecValue;}}function backfillProgramDateTimes(fragments,firstPdtIndex){var fragPrev=fragments[firstPdtIndex];for(var i=firstPdtIndex;i--;){var frag=fragments[i];// Exit on delta-playlist skipped segments
if(!frag){return;}frag.programDateTime=fragPrev.programDateTime-frag.duration*1000;fragPrev=frag;}}function assignProgramDateTime(frag,prevFrag){if(frag.rawProgramDateTime){frag.programDateTime=Date.parse(frag.rawProgramDateTime);}else if(prevFrag!==null&&prevFrag!==void 0&&prevFrag.programDateTime){frag.programDateTime=prevFrag.endProgramDateTime;}if(!Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(frag.programDateTime)){frag.programDateTime=null;frag.rawProgramDateTime=null;}}/***/},/***/"./src/loader/playlist-loader.ts":/*!***************************************!*\
			  !*** ./src/loader/playlist-loader.ts ***!
			  \***************************************/ /*! exports provided: default */ /***/function srcLoaderPlaylistLoaderTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var _home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./src/polyfills/number */"./src/polyfills/number.ts");/* harmony import */var _events__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../events */"./src/events.ts");/* harmony import */var _errors__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../errors */"./src/errors.ts");/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ../utils/logger */"./src/utils/logger.ts");/* harmony import */var _utils_mp4_tools__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts");/* harmony import */var _m3u8_parser__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(/*! ./m3u8-parser */"./src/loader/m3u8-parser.ts");/* harmony import */var _types_loader__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(/*! ../types/loader */"./src/types/loader.ts");/* harmony import */var _utils_attr_list__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(/*! ../utils/attr-list */"./src/utils/attr-list.ts");/**
			 * PlaylistLoader - delegate for media manifest/playlist loading tasks. Takes care of parsing media to internal data-models.
			 *
			 * Once loaded, dispatches events with parsed data-models of manifest/levels/audio/subtitle tracks.
			 *
			 * Uses loader(s) set in config to do actual internal loading of resource tasks.
			 *
			 * @module
			 *
			 */function mapContextToLevelType(context){var type=context.type;switch(type){case _types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistContextType"].AUDIO_TRACK:return _types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistLevelType"].AUDIO;case _types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistContextType"].SUBTITLE_TRACK:return _types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistLevelType"].SUBTITLE;default:return _types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistLevelType"].MAIN;}}function getResponseUrl(response,context){var url=response.url;// responseURL not supported on some browsers (it is used to detect URL redirection)
// data-uri mode also not supported (but no need to detect redirection)
if(url===undefined||url.indexOf('data:')===0){// fallback to initial URL
url=context.url;}return url;}var PlaylistLoader=/*#__PURE__*/function(){function PlaylistLoader(hls){this.hls=void 0;this.loaders=Object.create(null);this.hls=hls;this.registerListeners();}var _proto=PlaylistLoader.prototype;_proto.registerListeners=function registerListeners(){var hls=this.hls;hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].MANIFEST_LOADING,this.onManifestLoading,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].LEVEL_LOADING,this.onLevelLoading,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this);hls.on(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this);};_proto.unregisterListeners=function unregisterListeners(){var hls=this.hls;hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].MANIFEST_LOADING,this.onManifestLoading,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].LEVEL_LOADING,this.onLevelLoading,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this);hls.off(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this);}/**
			   * Returns defaults or configured loader-type overloads (pLoader and loader config params)
			   */;_proto.createInternalLoader=function createInternalLoader(context){var config=this.hls.config;var PLoader=config.pLoader;var Loader=config.loader;var InternalLoader=PLoader||Loader;var loader=new InternalLoader(config);context.loader=loader;this.loaders[context.type]=loader;return loader;};_proto.getInternalLoader=function getInternalLoader(context){return this.loaders[context.type];};_proto.resetInternalLoader=function resetInternalLoader(contextType){if(this.loaders[contextType]){delete this.loaders[contextType];}}/**
			   * Call `destroy` on all internal loader instances mapped (one per context type)
			   */;_proto.destroyInternalLoaders=function destroyInternalLoaders(){for(var contextType in this.loaders){var loader=this.loaders[contextType];if(loader){loader.destroy();}this.resetInternalLoader(contextType);}};_proto.destroy=function destroy(){this.unregisterListeners();this.destroyInternalLoaders();};_proto.onManifestLoading=function onManifestLoading(event,data){var url=data.url;this.load({id:null,groupId:null,level:0,responseType:'text',type:_types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistContextType"].MANIFEST,url:url,deliveryDirectives:null});};_proto.onLevelLoading=function onLevelLoading(event,data){var id=data.id,level=data.level,url=data.url,deliveryDirectives=data.deliveryDirectives;this.load({id:id,groupId:null,level:level,responseType:'text',type:_types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistContextType"].LEVEL,url:url,deliveryDirectives:deliveryDirectives});};_proto.onAudioTrackLoading=function onAudioTrackLoading(event,data){var id=data.id,groupId=data.groupId,url=data.url,deliveryDirectives=data.deliveryDirectives;this.load({id:id,groupId:groupId,level:null,responseType:'text',type:_types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistContextType"].AUDIO_TRACK,url:url,deliveryDirectives:deliveryDirectives});};_proto.onSubtitleTrackLoading=function onSubtitleTrackLoading(event,data){var id=data.id,groupId=data.groupId,url=data.url,deliveryDirectives=data.deliveryDirectives;this.load({id:id,groupId:groupId,level:null,responseType:'text',type:_types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistContextType"].SUBTITLE_TRACK,url:url,deliveryDirectives:deliveryDirectives});};_proto.load=function load(context){var _context$deliveryDire;var config=this.hls.config;// logger.debug(`[playlist-loader]: Loading playlist of type ${context.type}, level: ${context.level}, id: ${context.id}`);
// Check if a loader for this context already exists
var loader=this.getInternalLoader(context);if(loader){var loaderContext=loader.context;if(loaderContext&&loaderContext.url===context.url){// same URL can't overlap
_utils_logger__WEBPACK_IMPORTED_MODULE_3__["logger"].trace('[playlist-loader]: playlist request ongoing');return;}_utils_logger__WEBPACK_IMPORTED_MODULE_3__["logger"].log("[playlist-loader]: aborting previous loader for type: "+context.type);loader.abort();}var maxRetry;var timeout;var retryDelay;var maxRetryDelay;// apply different configs for retries depending on
// context (manifest, level, audio/subs playlist)
switch(context.type){case _types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistContextType"].MANIFEST:maxRetry=config.manifestLoadingMaxRetry;timeout=config.manifestLoadingTimeOut;retryDelay=config.manifestLoadingRetryDelay;maxRetryDelay=config.manifestLoadingMaxRetryTimeout;break;case _types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistContextType"].LEVEL:case _types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistContextType"].AUDIO_TRACK:case _types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistContextType"].SUBTITLE_TRACK:// Manage retries in Level/Track Controller
maxRetry=0;timeout=config.levelLoadingTimeOut;break;default:maxRetry=config.levelLoadingMaxRetry;timeout=config.levelLoadingTimeOut;retryDelay=config.levelLoadingRetryDelay;maxRetryDelay=config.levelLoadingMaxRetryTimeout;break;}loader=this.createInternalLoader(context);// Override level/track timeout for LL-HLS requests
// (the default of 10000ms is counter productive to blocking playlist reload requests)
if((_context$deliveryDire=context.deliveryDirectives)!==null&&_context$deliveryDire!==void 0&&_context$deliveryDire.part){var levelDetails;if(context.type===_types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistContextType"].LEVEL&&context.level!==null){levelDetails=this.hls.levels[context.level].details;}else if(context.type===_types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistContextType"].AUDIO_TRACK&&context.id!==null){levelDetails=this.hls.audioTracks[context.id].details;}else if(context.type===_types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistContextType"].SUBTITLE_TRACK&&context.id!==null){levelDetails=this.hls.subtitleTracks[context.id].details;}if(levelDetails){var partTarget=levelDetails.partTarget;var targetDuration=levelDetails.targetduration;if(partTarget&&targetDuration){timeout=Math.min(Math.max(partTarget*3,targetDuration*0.8)*1000,timeout);}}}var loaderConfig={timeout:timeout,maxRetry:maxRetry,retryDelay:retryDelay,maxRetryDelay:maxRetryDelay,highWaterMark:0};var loaderCallbacks={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};// logger.debug(`[playlist-loader]: Calling internal loader delegate for URL: ${context.url}`);
loader.load(context,loaderConfig,loaderCallbacks);};_proto.loadsuccess=function loadsuccess(response,stats,context,networkDetails){if(networkDetails===void 0){networkDetails=null;}if(context.isSidxRequest){this.handleSidxRequest(response,context);this.handlePlaylistLoaded(response,stats,context,networkDetails);return;}this.resetInternalLoader(context.type);var string=response.data;// Validate if it is an M3U8 at all
if(string.indexOf('#EXTM3U')!==0){this.handleManifestParsingError(response,context,'no EXTM3U delimiter',networkDetails);return;}stats.parsing.start=performance.now();// Check if chunk-list or master. handle empty chunk list case (first EXTINF not signaled, but TARGETDURATION present)
if(string.indexOf('#EXTINF:')>0||string.indexOf('#EXT-X-TARGETDURATION:')>0){this.handleTrackOrLevelPlaylist(response,stats,context,networkDetails);}else{this.handleMasterPlaylist(response,stats,context,networkDetails);}};_proto.loaderror=function loaderror(response,context,networkDetails){if(networkDetails===void 0){networkDetails=null;}this.handleNetworkError(context,networkDetails,false,response);};_proto.loadtimeout=function loadtimeout(stats,context,networkDetails){if(networkDetails===void 0){networkDetails=null;}this.handleNetworkError(context,networkDetails,true);};_proto.handleMasterPlaylist=function handleMasterPlaylist(response,stats,context,networkDetails){var hls=this.hls;var string=response.data;var url=getResponseUrl(response,context);var _M3U8Parser$parseMast=_m3u8_parser__WEBPACK_IMPORTED_MODULE_5__["default"].parseMasterPlaylist(string,url),levels=_M3U8Parser$parseMast.levels,sessionData=_M3U8Parser$parseMast.sessionData;if(!levels.length){this.handleManifestParsingError(response,context,'no level found in manifest',networkDetails);return;}// multi level playlist, parse level info
var audioGroups=levels.map(function(level){return{id:level.attrs.AUDIO,audioCodec:level.audioCodec};});var subtitleGroups=levels.map(function(level){return{id:level.attrs.SUBTITLES,textCodec:level.textCodec};});var audioTracks=_m3u8_parser__WEBPACK_IMPORTED_MODULE_5__["default"].parseMasterPlaylistMedia(string,url,'AUDIO',audioGroups);var subtitles=_m3u8_parser__WEBPACK_IMPORTED_MODULE_5__["default"].parseMasterPlaylistMedia(string,url,'SUBTITLES',subtitleGroups);var captions=_m3u8_parser__WEBPACK_IMPORTED_MODULE_5__["default"].parseMasterPlaylistMedia(string,url,'CLOSED-CAPTIONS');if(audioTracks.length){// check if we have found an audio track embedded in main playlist (audio track without URI attribute)
var embeddedAudioFound=audioTracks.some(function(audioTrack){return!audioTrack.url;});// if no embedded audio track defined, but audio codec signaled in quality level,
// we need to signal this main audio track this could happen with playlists with
// alt audio rendition in which quality levels (main)
// contains both audio+video. but with mixed audio track not signaled
if(!embeddedAudioFound&&levels[0].audioCodec&&!levels[0].attrs.AUDIO){_utils_logger__WEBPACK_IMPORTED_MODULE_3__["logger"].log('[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one');audioTracks.unshift({type:'main',name:'main',default:false,autoselect:false,forced:false,id:-1,attrs:new _utils_attr_list__WEBPACK_IMPORTED_MODULE_7__["AttrList"]({}),bitrate:0,url:''});}}hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].MANIFEST_LOADED,{levels:levels,audioTracks:audioTracks,subtitles:subtitles,captions:captions,url:url,stats:stats,networkDetails:networkDetails,sessionData:sessionData});};_proto.handleTrackOrLevelPlaylist=function handleTrackOrLevelPlaylist(response,stats,context,networkDetails){var hls=this.hls;var id=context.id,level=context.level,type=context.type;var url=getResponseUrl(response,context);var levelUrlId=Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(id)?id:0;var levelId=Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(level)?level:levelUrlId;var levelType=mapContextToLevelType(context);var levelDetails=_m3u8_parser__WEBPACK_IMPORTED_MODULE_5__["default"].parseLevelPlaylist(response.data,url,levelId,levelType,levelUrlId);if(!levelDetails.fragments.length){hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].ERROR,{type:_errors__WEBPACK_IMPORTED_MODULE_2__["ErrorTypes"].NETWORK_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_2__["ErrorDetails"].LEVEL_EMPTY_ERROR,fatal:false,url:url,reason:'no fragments found in level',level:typeof context.level==='number'?context.level:undefined});return;}// We have done our first request (Manifest-type) and receive
// not a master playlist but a chunk-list (track/level)
// We fire the manifest-loaded event anyway with the parsed level-details
// by creating a single-level structure for it.
if(type===_types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistContextType"].MANIFEST){var singleLevel={attrs:new _utils_attr_list__WEBPACK_IMPORTED_MODULE_7__["AttrList"]({}),bitrate:0,details:levelDetails,name:'',url:url};hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].MANIFEST_LOADED,{levels:[singleLevel],audioTracks:[],url:url,stats:stats,networkDetails:networkDetails,sessionData:null});}// save parsing time
stats.parsing.end=performance.now();// in case we need SIDX ranges
// return early after calling load for
// the SIDX box.
if(levelDetails.needSidxRanges){var _levelDetails$fragmen;var sidxUrl=(_levelDetails$fragmen=levelDetails.fragments[0].initSegment)===null||_levelDetails$fragmen===void 0?void 0:_levelDetails$fragmen.url;this.load({url:sidxUrl,isSidxRequest:true,type:type,level:level,levelDetails:levelDetails,id:id,groupId:null,rangeStart:0,rangeEnd:2048,responseType:'arraybuffer',deliveryDirectives:null});return;}// extend the context with the new levelDetails property
context.levelDetails=levelDetails;this.handlePlaylistLoaded(response,stats,context,networkDetails);};_proto.handleSidxRequest=function handleSidxRequest(response,context){var sidxInfo=Object(_utils_mp4_tools__WEBPACK_IMPORTED_MODULE_4__["parseSegmentIndex"])(new Uint8Array(response.data));// if provided fragment does not contain sidx, early return
if(!sidxInfo){return;}var sidxReferences=sidxInfo.references;var levelDetails=context.levelDetails;sidxReferences.forEach(function(segmentRef,index){var segRefInfo=segmentRef.info;var frag=levelDetails.fragments[index];if(frag.byteRange.length===0){frag.setByteRange(String(1+segRefInfo.end-segRefInfo.start)+'@'+String(segRefInfo.start));}if(frag.initSegment){frag.initSegment.setByteRange(String(sidxInfo.moovEndOffset)+'@0');}});};_proto.handleManifestParsingError=function handleManifestParsingError(response,context,reason,networkDetails){this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].ERROR,{type:_errors__WEBPACK_IMPORTED_MODULE_2__["ErrorTypes"].NETWORK_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_2__["ErrorDetails"].MANIFEST_PARSING_ERROR,fatal:context.type===_types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistContextType"].MANIFEST,url:response.url,reason:reason,response:response,context:context,networkDetails:networkDetails});};_proto.handleNetworkError=function handleNetworkError(context,networkDetails,timeout,response){if(timeout===void 0){timeout=false;}_utils_logger__WEBPACK_IMPORTED_MODULE_3__["logger"].warn("[playlist-loader]: A network "+(timeout?'timeout':'error')+" occurred while loading "+context.type+" level: "+context.level+" id: "+context.id+" group-id: \""+context.groupId+"\"");var details=_errors__WEBPACK_IMPORTED_MODULE_2__["ErrorDetails"].UNKNOWN;var fatal=false;var loader=this.getInternalLoader(context);switch(context.type){case _types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistContextType"].MANIFEST:details=timeout?_errors__WEBPACK_IMPORTED_MODULE_2__["ErrorDetails"].MANIFEST_LOAD_TIMEOUT:_errors__WEBPACK_IMPORTED_MODULE_2__["ErrorDetails"].MANIFEST_LOAD_ERROR;fatal=true;break;case _types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistContextType"].LEVEL:details=timeout?_errors__WEBPACK_IMPORTED_MODULE_2__["ErrorDetails"].LEVEL_LOAD_TIMEOUT:_errors__WEBPACK_IMPORTED_MODULE_2__["ErrorDetails"].LEVEL_LOAD_ERROR;fatal=false;break;case _types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistContextType"].AUDIO_TRACK:details=timeout?_errors__WEBPACK_IMPORTED_MODULE_2__["ErrorDetails"].AUDIO_TRACK_LOAD_TIMEOUT:_errors__WEBPACK_IMPORTED_MODULE_2__["ErrorDetails"].AUDIO_TRACK_LOAD_ERROR;fatal=false;break;case _types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistContextType"].SUBTITLE_TRACK:details=timeout?_errors__WEBPACK_IMPORTED_MODULE_2__["ErrorDetails"].SUBTITLE_TRACK_LOAD_TIMEOUT:_errors__WEBPACK_IMPORTED_MODULE_2__["ErrorDetails"].SUBTITLE_LOAD_ERROR;fatal=false;break;}if(loader){this.resetInternalLoader(context.type);}var errorData={type:_errors__WEBPACK_IMPORTED_MODULE_2__["ErrorTypes"].NETWORK_ERROR,details:details,fatal:fatal,url:context.url,loader:loader,context:context,networkDetails:networkDetails};if(response){errorData.response=response;}this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].ERROR,errorData);};_proto.handlePlaylistLoaded=function handlePlaylistLoaded(response,stats,context,networkDetails){var type=context.type,level=context.level,id=context.id,groupId=context.groupId,loader=context.loader,levelDetails=context.levelDetails,deliveryDirectives=context.deliveryDirectives;if(!(levelDetails!==null&&levelDetails!==void 0&&levelDetails.targetduration)){this.handleManifestParsingError(response,context,'invalid target duration',networkDetails);return;}if(!loader){return;}if(levelDetails.live){if(loader.getCacheAge){levelDetails.ageHeader=loader.getCacheAge()||0;}if(!loader.getCacheAge||isNaN(levelDetails.ageHeader)){levelDetails.ageHeader=0;}}switch(type){case _types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistContextType"].MANIFEST:case _types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistContextType"].LEVEL:this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].LEVEL_LOADED,{details:levelDetails,level:level||0,id:id||0,stats:stats,networkDetails:networkDetails,deliveryDirectives:deliveryDirectives});break;case _types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistContextType"].AUDIO_TRACK:this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].AUDIO_TRACK_LOADED,{details:levelDetails,id:id||0,groupId:groupId||'',stats:stats,networkDetails:networkDetails,deliveryDirectives:deliveryDirectives});break;case _types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistContextType"].SUBTITLE_TRACK:this.hls.trigger(_events__WEBPACK_IMPORTED_MODULE_1__["Events"].SUBTITLE_TRACK_LOADED,{details:levelDetails,id:id||0,groupId:groupId||'',stats:stats,networkDetails:networkDetails,deliveryDirectives:deliveryDirectives});break;}};return PlaylistLoader;}();/* harmony default export */__webpack_exports__["default"]=PlaylistLoader;/***/},/***/"./src/polyfills/number.ts":/*!*********************************!*\
			  !*** ./src/polyfills/number.ts ***!
			  \*********************************/ /*! exports provided: isFiniteNumber, MAX_SAFE_INTEGER */ /***/function srcPolyfillsNumberTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"isFiniteNumber",function(){return isFiniteNumber;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"MAX_SAFE_INTEGER",function(){return MAX_SAFE_INTEGER;});var isFiniteNumber=Number.isFinite||function(value){return typeof value==='number'&&isFinite(value);};var MAX_SAFE_INTEGER=Number.MAX_SAFE_INTEGER||9007199254740991;/***/},/***/"./src/remux/aac-helper.ts":/*!*********************************!*\
			  !*** ./src/remux/aac-helper.ts ***!
			  \*********************************/ /*! exports provided: default */ /***/function srcRemuxAacHelperTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/**
			 *  AAC helper
			 */var AAC=/*#__PURE__*/function(){function AAC(){}AAC.getSilentFrame=function getSilentFrame(codec,channelCount){switch(codec){case'mp4a.40.2':if(channelCount===1){return new Uint8Array([0x00,0xc8,0x00,0x80,0x23,0x80]);}else if(channelCount===2){return new Uint8Array([0x21,0x00,0x49,0x90,0x02,0x19,0x00,0x23,0x80]);}else if(channelCount===3){return new Uint8Array([0x00,0xc8,0x00,0x80,0x20,0x84,0x01,0x26,0x40,0x08,0x64,0x00,0x8e]);}else if(channelCount===4){return new Uint8Array([0x00,0xc8,0x00,0x80,0x20,0x84,0x01,0x26,0x40,0x08,0x64,0x00,0x80,0x2c,0x80,0x08,0x02,0x38]);}else if(channelCount===5){return new Uint8Array([0x00,0xc8,0x00,0x80,0x20,0x84,0x01,0x26,0x40,0x08,0x64,0x00,0x82,0x30,0x04,0x99,0x00,0x21,0x90,0x02,0x38]);}else if(channelCount===6){return new Uint8Array([0x00,0xc8,0x00,0x80,0x20,0x84,0x01,0x26,0x40,0x08,0x64,0x00,0x82,0x30,0x04,0x99,0x00,0x21,0x90,0x02,0x00,0xb2,0x00,0x20,0x08,0xe0]);}break;// handle HE-AAC below (mp4a.40.5 / mp4a.40.29)
default:if(channelCount===1){// ffmpeg -y -f lavfi -i "aevalsrc=0:d=0.05" -c:a libfdk_aac -profile:a aac_he -b:a 4k output.aac && hexdump -v -e '16/1 "0x%x," "\n"' -v output.aac
return new Uint8Array([0x1,0x40,0x22,0x80,0xa3,0x4e,0xe6,0x80,0xba,0x8,0x0,0x0,0x0,0x1c,0x6,0xf1,0xc1,0xa,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5e]);}else if(channelCount===2){// ffmpeg -y -f lavfi -i "aevalsrc=0|0:d=0.05" -c:a libfdk_aac -profile:a aac_he_v2 -b:a 4k output.aac && hexdump -v -e '16/1 "0x%x," "\n"' -v output.aac
return new Uint8Array([0x1,0x40,0x22,0x80,0xa3,0x5e,0xe6,0x80,0xba,0x8,0x0,0x0,0x0,0x0,0x95,0x0,0x6,0xf1,0xa1,0xa,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5e]);}else if(channelCount===3){// ffmpeg -y -f lavfi -i "aevalsrc=0|0|0:d=0.05" -c:a libfdk_aac -profile:a aac_he_v2 -b:a 4k output.aac && hexdump -v -e '16/1 "0x%x," "\n"' -v output.aac
return new Uint8Array([0x1,0x40,0x22,0x80,0xa3,0x5e,0xe6,0x80,0xba,0x8,0x0,0x0,0x0,0x0,0x95,0x0,0x6,0xf1,0xa1,0xa,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5e]);}break;}return undefined;};return AAC;}();/* harmony default export */__webpack_exports__["default"]=AAC;/***/},/***/"./src/remux/mp4-generator.ts":/*!************************************!*\
			  !*** ./src/remux/mp4-generator.ts ***!
			  \************************************/ /*! exports provided: default */ /***/function srcRemuxMp4GeneratorTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/**
			 * Generate MP4 Box
			 */var UINT32_MAX=Math.pow(2,32)-1;var MP4=/*#__PURE__*/function(){function MP4(){}MP4.init=function init(){MP4.types={avc1:[],// codingname
avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],'.mp3':[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var i;for(i in MP4.types){if(MP4.types.hasOwnProperty(i)){MP4.types[i]=[i.charCodeAt(0),i.charCodeAt(1),i.charCodeAt(2),i.charCodeAt(3)];}}var videoHdlr=new Uint8Array([0x00,// version 0
0x00,0x00,0x00,// flags
0x00,0x00,0x00,0x00,// pre_defined
0x76,0x69,0x64,0x65,// handler_type: 'vide'
0x00,0x00,0x00,0x00,// reserved
0x00,0x00,0x00,0x00,// reserved
0x00,0x00,0x00,0x00,// reserved
0x56,0x69,0x64,0x65,0x6f,0x48,0x61,0x6e,0x64,0x6c,0x65,0x72,0x00// name: 'VideoHandler'
]);var audioHdlr=new Uint8Array([0x00,// version 0
0x00,0x00,0x00,// flags
0x00,0x00,0x00,0x00,// pre_defined
0x73,0x6f,0x75,0x6e,// handler_type: 'soun'
0x00,0x00,0x00,0x00,// reserved
0x00,0x00,0x00,0x00,// reserved
0x00,0x00,0x00,0x00,// reserved
0x53,0x6f,0x75,0x6e,0x64,0x48,0x61,0x6e,0x64,0x6c,0x65,0x72,0x00// name: 'SoundHandler'
]);MP4.HDLR_TYPES={video:videoHdlr,audio:audioHdlr};var dref=new Uint8Array([0x00,// version 0
0x00,0x00,0x00,// flags
0x00,0x00,0x00,0x01,// entry_count
0x00,0x00,0x00,0x0c,// entry_size
0x75,0x72,0x6c,0x20,// 'url' type
0x00,// version 0
0x00,0x00,0x01// entry_flags
]);var stco=new Uint8Array([0x00,// version
0x00,0x00,0x00,// flags
0x00,0x00,0x00,0x00// entry_count
]);MP4.STTS=MP4.STSC=MP4.STCO=stco;MP4.STSZ=new Uint8Array([0x00,// version
0x00,0x00,0x00,// flags
0x00,0x00,0x00,0x00,// sample_size
0x00,0x00,0x00,0x00// sample_count
]);MP4.VMHD=new Uint8Array([0x00,// version
0x00,0x00,0x01,// flags
0x00,0x00,// graphicsmode
0x00,0x00,0x00,0x00,0x00,0x00// opcolor
]);MP4.SMHD=new Uint8Array([0x00,// version
0x00,0x00,0x00,// flags
0x00,0x00,// balance
0x00,0x00// reserved
]);MP4.STSD=new Uint8Array([0x00,// version 0
0x00,0x00,0x00,// flags
0x00,0x00,0x00,0x01]);// entry_count
var majorBrand=new Uint8Array([105,115,111,109]);// isom
var avc1Brand=new Uint8Array([97,118,99,49]);// avc1
var minorVersion=new Uint8Array([0,0,0,1]);MP4.FTYP=MP4.box(MP4.types.ftyp,majorBrand,minorVersion,majorBrand,avc1Brand);MP4.DINF=MP4.box(MP4.types.dinf,MP4.box(MP4.types.dref,dref));};MP4.box=function box(type){var size=8;for(var _len=arguments.length,payload=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){payload[_key-1]=arguments[_key];}var i=payload.length;var len=i;// calculate the total size we need to allocate
while(i--){size+=payload[i].byteLength;}var result=new Uint8Array(size);result[0]=size>>24&0xff;result[1]=size>>16&0xff;result[2]=size>>8&0xff;result[3]=size&0xff;result.set(type,4);// copy the payload into the result
for(i=0,size=8;i<len;i++){// copy payload[i] array @ offset size
result.set(payload[i],size);size+=payload[i].byteLength;}return result;};MP4.hdlr=function hdlr(type){return MP4.box(MP4.types.hdlr,MP4.HDLR_TYPES[type]);};MP4.mdat=function mdat(data){return MP4.box(MP4.types.mdat,data);};MP4.mdhd=function mdhd(timescale,duration){duration*=timescale;var upperWordDuration=Math.floor(duration/(UINT32_MAX+1));var lowerWordDuration=Math.floor(duration%(UINT32_MAX+1));return MP4.box(MP4.types.mdhd,new Uint8Array([0x01,// version 1
0x00,0x00,0x00,// flags
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,// creation_time
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,// modification_time
timescale>>24&0xff,timescale>>16&0xff,timescale>>8&0xff,timescale&0xff,// timescale
upperWordDuration>>24,upperWordDuration>>16&0xff,upperWordDuration>>8&0xff,upperWordDuration&0xff,lowerWordDuration>>24,lowerWordDuration>>16&0xff,lowerWordDuration>>8&0xff,lowerWordDuration&0xff,0x55,0xc4,// 'und' language (undetermined)
0x00,0x00]));};MP4.mdia=function mdia(track){return MP4.box(MP4.types.mdia,MP4.mdhd(track.timescale,track.duration),MP4.hdlr(track.type),MP4.minf(track));};MP4.mfhd=function mfhd(sequenceNumber){return MP4.box(MP4.types.mfhd,new Uint8Array([0x00,0x00,0x00,0x00,// flags
sequenceNumber>>24,sequenceNumber>>16&0xff,sequenceNumber>>8&0xff,sequenceNumber&0xff// sequence_number
]));};MP4.minf=function minf(track){if(track.type==='audio'){return MP4.box(MP4.types.minf,MP4.box(MP4.types.smhd,MP4.SMHD),MP4.DINF,MP4.stbl(track));}else{return MP4.box(MP4.types.minf,MP4.box(MP4.types.vmhd,MP4.VMHD),MP4.DINF,MP4.stbl(track));}};MP4.moof=function moof(sn,baseMediaDecodeTime,track){return MP4.box(MP4.types.moof,MP4.mfhd(sn),MP4.traf(track,baseMediaDecodeTime));}/**
			   * @param tracks... (optional) {array} the tracks associated with this movie
			   */;MP4.moov=function moov(tracks){var i=tracks.length;var boxes=[];while(i--){boxes[i]=MP4.trak(tracks[i]);}return MP4.box.apply(null,[MP4.types.moov,MP4.mvhd(tracks[0].timescale,tracks[0].duration)].concat(boxes).concat(MP4.mvex(tracks)));};MP4.mvex=function mvex(tracks){var i=tracks.length;var boxes=[];while(i--){boxes[i]=MP4.trex(tracks[i]);}return MP4.box.apply(null,[MP4.types.mvex].concat(boxes));};MP4.mvhd=function mvhd(timescale,duration){duration*=timescale;var upperWordDuration=Math.floor(duration/(UINT32_MAX+1));var lowerWordDuration=Math.floor(duration%(UINT32_MAX+1));var bytes=new Uint8Array([0x01,// version 1
0x00,0x00,0x00,// flags
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,// creation_time
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,// modification_time
timescale>>24&0xff,timescale>>16&0xff,timescale>>8&0xff,timescale&0xff,// timescale
upperWordDuration>>24,upperWordDuration>>16&0xff,upperWordDuration>>8&0xff,upperWordDuration&0xff,lowerWordDuration>>24,lowerWordDuration>>16&0xff,lowerWordDuration>>8&0xff,lowerWordDuration&0xff,0x00,0x01,0x00,0x00,// 1.0 rate
0x01,0x00,// 1.0 volume
0x00,0x00,// reserved
0x00,0x00,0x00,0x00,// reserved
0x00,0x00,0x00,0x00,// reserved
0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x00,0x00,0x00,// transformation: unity matrix
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,// pre_defined
0xff,0xff,0xff,0xff// next_track_ID
]);return MP4.box(MP4.types.mvhd,bytes);};MP4.sdtp=function sdtp(track){var samples=track.samples||[];var bytes=new Uint8Array(4+samples.length);var i;var flags;// leave the full box header (4 bytes) all zero
// write the sample table
for(i=0;i<samples.length;i++){flags=samples[i].flags;bytes[i+4]=flags.dependsOn<<4|flags.isDependedOn<<2|flags.hasRedundancy;}return MP4.box(MP4.types.sdtp,bytes);};MP4.stbl=function stbl(track){return MP4.box(MP4.types.stbl,MP4.stsd(track),MP4.box(MP4.types.stts,MP4.STTS),MP4.box(MP4.types.stsc,MP4.STSC),MP4.box(MP4.types.stsz,MP4.STSZ),MP4.box(MP4.types.stco,MP4.STCO));};MP4.avc1=function avc1(track){var sps=[];var pps=[];var i;var data;var len;// assemble the SPSs
for(i=0;i<track.sps.length;i++){data=track.sps[i];len=data.byteLength;sps.push(len>>>8&0xff);sps.push(len&0xff);// SPS
sps=sps.concat(Array.prototype.slice.call(data));}// assemble the PPSs
for(i=0;i<track.pps.length;i++){data=track.pps[i];len=data.byteLength;pps.push(len>>>8&0xff);pps.push(len&0xff);pps=pps.concat(Array.prototype.slice.call(data));}var avcc=MP4.box(MP4.types.avcC,new Uint8Array([0x01,// version
sps[3],// profile
sps[4],// profile compat
sps[5],// level
0xfc|3,// lengthSizeMinusOne, hard-coded to 4 bytes
0xe0|track.sps.length// 3bit reserved (111) + numOfSequenceParameterSets
].concat(sps).concat([track.pps.length// numOfPictureParameterSets
]).concat(pps)));// "PPS"
var width=track.width;var height=track.height;var hSpacing=track.pixelRatio[0];var vSpacing=track.pixelRatio[1];return MP4.box(MP4.types.avc1,new Uint8Array([0x00,0x00,0x00,// reserved
0x00,0x00,0x00,// reserved
0x00,0x01,// data_reference_index
0x00,0x00,// pre_defined
0x00,0x00,// reserved
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,// pre_defined
width>>8&0xff,width&0xff,// width
height>>8&0xff,height&0xff,// height
0x00,0x48,0x00,0x00,// horizresolution
0x00,0x48,0x00,0x00,// vertresolution
0x00,0x00,0x00,0x00,// reserved
0x00,0x01,// frame_count
0x12,0x64,0x61,0x69,0x6c,// dailymotion/hls.js
0x79,0x6d,0x6f,0x74,0x69,0x6f,0x6e,0x2f,0x68,0x6c,0x73,0x2e,0x6a,0x73,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,// compressorname
0x00,0x18,// depth = 24
0x11,0x11]),// pre_defined = -1
avcc,MP4.box(MP4.types.btrt,new Uint8Array([0x00,0x1c,0x9c,0x80,// bufferSizeDB
0x00,0x2d,0xc6,0xc0,// maxBitrate
0x00,0x2d,0xc6,0xc0])),// avgBitrate
MP4.box(MP4.types.pasp,new Uint8Array([hSpacing>>24,// hSpacing
hSpacing>>16&0xff,hSpacing>>8&0xff,hSpacing&0xff,vSpacing>>24,// vSpacing
vSpacing>>16&0xff,vSpacing>>8&0xff,vSpacing&0xff])));};MP4.esds=function esds(track){var configlen=track.config.length;return new Uint8Array([0x00,// version 0
0x00,0x00,0x00,// flags
0x03,// descriptor_type
0x17+configlen,// length
0x00,0x01,// es_id
0x00,// stream_priority
0x04,// descriptor_type
0x0f+configlen,// length
0x40,// codec : mpeg4_audio
0x15,// stream_type
0x00,0x00,0x00,// buffer_size
0x00,0x00,0x00,0x00,// maxBitrate
0x00,0x00,0x00,0x00,// avgBitrate
0x05// descriptor_type
].concat([configlen]).concat(track.config).concat([0x06,0x01,0x02]));// GASpecificConfig)); // length + audio config descriptor
};MP4.mp4a=function mp4a(track){var samplerate=track.samplerate;return MP4.box(MP4.types.mp4a,new Uint8Array([0x00,0x00,0x00,// reserved
0x00,0x00,0x00,// reserved
0x00,0x01,// data_reference_index
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,// reserved
0x00,track.channelCount,// channelcount
0x00,0x10,// sampleSize:16bits
0x00,0x00,0x00,0x00,// reserved2
samplerate>>8&0xff,samplerate&0xff,//
0x00,0x00]),MP4.box(MP4.types.esds,MP4.esds(track)));};MP4.mp3=function mp3(track){var samplerate=track.samplerate;return MP4.box(MP4.types['.mp3'],new Uint8Array([0x00,0x00,0x00,// reserved
0x00,0x00,0x00,// reserved
0x00,0x01,// data_reference_index
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,// reserved
0x00,track.channelCount,// channelcount
0x00,0x10,// sampleSize:16bits
0x00,0x00,0x00,0x00,// reserved2
samplerate>>8&0xff,samplerate&0xff,//
0x00,0x00]));};MP4.stsd=function stsd(track){if(track.type==='audio'){if(!track.isAAC&&track.codec==='mp3'){return MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp3(track));}return MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp4a(track));}else{return MP4.box(MP4.types.stsd,MP4.STSD,MP4.avc1(track));}};MP4.tkhd=function tkhd(track){var id=track.id;var duration=track.duration*track.timescale;var width=track.width;var height=track.height;var upperWordDuration=Math.floor(duration/(UINT32_MAX+1));var lowerWordDuration=Math.floor(duration%(UINT32_MAX+1));return MP4.box(MP4.types.tkhd,new Uint8Array([0x01,// version 1
0x00,0x00,0x07,// flags
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,// creation_time
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,// modification_time
id>>24&0xff,id>>16&0xff,id>>8&0xff,id&0xff,// track_ID
0x00,0x00,0x00,0x00,// reserved
upperWordDuration>>24,upperWordDuration>>16&0xff,upperWordDuration>>8&0xff,upperWordDuration&0xff,lowerWordDuration>>24,lowerWordDuration>>16&0xff,lowerWordDuration>>8&0xff,lowerWordDuration&0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,// reserved
0x00,0x00,// layer
0x00,0x00,// alternate_group
0x00,0x00,// non-audio track volume
0x00,0x00,// reserved
0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x00,0x00,0x00,// transformation: unity matrix
width>>8&0xff,width&0xff,0x00,0x00,// width
height>>8&0xff,height&0xff,0x00,0x00// height
]));};MP4.traf=function traf(track,baseMediaDecodeTime){var sampleDependencyTable=MP4.sdtp(track);var id=track.id;var upperWordBaseMediaDecodeTime=Math.floor(baseMediaDecodeTime/(UINT32_MAX+1));var lowerWordBaseMediaDecodeTime=Math.floor(baseMediaDecodeTime%(UINT32_MAX+1));return MP4.box(MP4.types.traf,MP4.box(MP4.types.tfhd,new Uint8Array([0x00,// version 0
0x00,0x00,0x00,// flags
id>>24,id>>16&0xff,id>>8&0xff,id&0xff// track_ID
])),MP4.box(MP4.types.tfdt,new Uint8Array([0x01,// version 1
0x00,0x00,0x00,// flags
upperWordBaseMediaDecodeTime>>24,upperWordBaseMediaDecodeTime>>16&0xff,upperWordBaseMediaDecodeTime>>8&0xff,upperWordBaseMediaDecodeTime&0xff,lowerWordBaseMediaDecodeTime>>24,lowerWordBaseMediaDecodeTime>>16&0xff,lowerWordBaseMediaDecodeTime>>8&0xff,lowerWordBaseMediaDecodeTime&0xff])),MP4.trun(track,sampleDependencyTable.length+16+// tfhd
20+// tfdt
8+// traf header
16+// mfhd
8+// moof header
8),// mdat header
sampleDependencyTable);}/**
			   * Generate a track box.
			   * @param track {object} a track definition
			   * @return {Uint8Array} the track box
			   */;MP4.trak=function trak(track){track.duration=track.duration||0xffffffff;return MP4.box(MP4.types.trak,MP4.tkhd(track),MP4.mdia(track));};MP4.trex=function trex(track){var id=track.id;return MP4.box(MP4.types.trex,new Uint8Array([0x00,// version 0
0x00,0x00,0x00,// flags
id>>24,id>>16&0xff,id>>8&0xff,id&0xff,// track_ID
0x00,0x00,0x00,0x01,// default_sample_description_index
0x00,0x00,0x00,0x00,// default_sample_duration
0x00,0x00,0x00,0x00,// default_sample_size
0x00,0x01,0x00,0x01// default_sample_flags
]));};MP4.trun=function trun(track,offset){var samples=track.samples||[];var len=samples.length;var arraylen=12+16*len;var array=new Uint8Array(arraylen);var i;var sample;var duration;var size;var flags;var cts;offset+=8+arraylen;array.set([0x00,// version 0
0x00,0x0f,0x01,// flags
len>>>24&0xff,len>>>16&0xff,len>>>8&0xff,len&0xff,// sample_count
offset>>>24&0xff,offset>>>16&0xff,offset>>>8&0xff,offset&0xff// data_offset
],0);for(i=0;i<len;i++){sample=samples[i];duration=sample.duration;size=sample.size;flags=sample.flags;cts=sample.cts;array.set([duration>>>24&0xff,duration>>>16&0xff,duration>>>8&0xff,duration&0xff,// sample_duration
size>>>24&0xff,size>>>16&0xff,size>>>8&0xff,size&0xff,// sample_size
flags.isLeading<<2|flags.dependsOn,flags.isDependedOn<<6|flags.hasRedundancy<<4|flags.paddingValue<<1|flags.isNonSync,flags.degradPrio&0xf0<<8,flags.degradPrio&0x0f,// sample_flags
cts>>>24&0xff,cts>>>16&0xff,cts>>>8&0xff,cts&0xff// sample_composition_time_offset
],12+16*i);}return MP4.box(MP4.types.trun,array);};MP4.initSegment=function initSegment(tracks){if(!MP4.types){MP4.init();}var movie=MP4.moov(tracks);var result=new Uint8Array(MP4.FTYP.byteLength+movie.byteLength);result.set(MP4.FTYP);result.set(movie,MP4.FTYP.byteLength);return result;};return MP4;}();MP4.types=void 0;MP4.HDLR_TYPES=void 0;MP4.STTS=void 0;MP4.STSC=void 0;MP4.STCO=void 0;MP4.STSZ=void 0;MP4.VMHD=void 0;MP4.SMHD=void 0;MP4.STSD=void 0;MP4.FTYP=void 0;MP4.DINF=void 0;/* harmony default export */__webpack_exports__["default"]=MP4;/***/},/***/"./src/remux/mp4-remuxer.ts":/*!**********************************!*\
			  !*** ./src/remux/mp4-remuxer.ts ***!
			  \**********************************/ /*! exports provided: default, normalizePts */ /***/function srcRemuxMp4RemuxerTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"default",function(){return MP4Remuxer;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"normalizePts",function(){return normalizePts;});/* harmony import */var _home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./src/polyfills/number */"./src/polyfills/number.ts");/* harmony import */var _aac_helper__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ./aac-helper */"./src/remux/aac-helper.ts");/* harmony import */var _mp4_generator__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ./mp4-generator */"./src/remux/mp4-generator.ts");/* harmony import */var _events__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ../events */"./src/events.ts");/* harmony import */var _errors__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(/*! ../errors */"./src/errors.ts");/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(/*! ../utils/logger */"./src/utils/logger.ts");/* harmony import */var _types_loader__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(/*! ../types/loader */"./src/types/loader.ts");/* harmony import */var _utils_timescale_conversion__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(/*! ../utils/timescale-conversion */"./src/utils/timescale-conversion.ts");function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};return _extends.apply(this,arguments);}var MAX_SILENT_FRAME_DURATION=10*1000;// 10 seconds
var AAC_SAMPLES_PER_FRAME=1024;var MPEG_AUDIO_SAMPLE_PER_FRAME=1152;var chromeVersion=null;var safariWebkitVersion=null;var requiresPositiveDts=false;var MP4Remuxer=/*#__PURE__*/function(){function MP4Remuxer(observer,config,typeSupported,vendor){this.observer=void 0;this.config=void 0;this.typeSupported=void 0;this.ISGenerated=false;this._initPTS=void 0;this._initDTS=void 0;this.nextAvcDts=null;this.nextAudioPts=null;this.isAudioContiguous=false;this.isVideoContiguous=false;this.observer=observer;this.config=config;this.typeSupported=typeSupported;this.ISGenerated=false;if(chromeVersion===null){var userAgent=navigator.userAgent||'';var result=userAgent.match(/Chrome\/(\d+)/i);chromeVersion=result?parseInt(result[1]):0;}if(safariWebkitVersion===null){var _result=navigator.userAgent.match(/Safari\/(\d+)/i);safariWebkitVersion=_result?parseInt(_result[1]):0;}requiresPositiveDts=!!chromeVersion&&chromeVersion<75||!!safariWebkitVersion&&safariWebkitVersion<600;}var _proto=MP4Remuxer.prototype;_proto.destroy=function destroy(){};_proto.resetTimeStamp=function resetTimeStamp(defaultTimeStamp){_utils_logger__WEBPACK_IMPORTED_MODULE_5__["logger"].log('[mp4-remuxer]: initPTS & initDTS reset');this._initPTS=this._initDTS=defaultTimeStamp;};_proto.resetNextTimestamp=function resetNextTimestamp(){_utils_logger__WEBPACK_IMPORTED_MODULE_5__["logger"].log('[mp4-remuxer]: reset next timestamp');this.isVideoContiguous=false;this.isAudioContiguous=false;};_proto.resetInitSegment=function resetInitSegment(){_utils_logger__WEBPACK_IMPORTED_MODULE_5__["logger"].log('[mp4-remuxer]: ISGenerated flag reset');this.ISGenerated=false;};_proto.getVideoStartPts=function getVideoStartPts(videoSamples){var rolloverDetected=false;var startPTS=videoSamples.reduce(function(minPTS,sample){var delta=sample.pts-minPTS;if(delta<-4294967296){// 2^32, see PTSNormalize for reasoning, but we're hitting a rollover here, and we don't want that to impact the timeOffset calculation
rolloverDetected=true;return normalizePts(minPTS,sample.pts);}else if(delta>0){return minPTS;}else{return sample.pts;}},videoSamples[0].pts);if(rolloverDetected){_utils_logger__WEBPACK_IMPORTED_MODULE_5__["logger"].debug('PTS rollover detected');}return startPTS;};_proto.remux=function remux(audioTrack,videoTrack,id3Track,textTrack,timeOffset,accurateTimeOffset,flush,playlistType){var video;var audio;var initSegment;var text;var id3;var independent;var audioTimeOffset=timeOffset;var videoTimeOffset=timeOffset;// If we're remuxing audio and video progressively, wait until we've received enough samples for each track before proceeding.
// This is done to synchronize the audio and video streams. We know if the current segment will have samples if the "pid"
// parameter is greater than -1. The pid is set when the PMT is parsed, which contains the tracks list.
// However, if the initSegment has already been generated, or we've reached the end of a segment (flush),
// then we can remux one track without waiting for the other.
var hasAudio=audioTrack.pid>-1;var hasVideo=videoTrack.pid>-1;var length=videoTrack.samples.length;var enoughAudioSamples=audioTrack.samples.length>0;var enoughVideoSamples=length>1;var canRemuxAvc=(!hasAudio||enoughAudioSamples)&&(!hasVideo||enoughVideoSamples)||this.ISGenerated||flush;if(canRemuxAvc){if(!this.ISGenerated){initSegment=this.generateIS(audioTrack,videoTrack,timeOffset);}var isVideoContiguous=this.isVideoContiguous;var firstKeyFrameIndex=-1;if(enoughVideoSamples){firstKeyFrameIndex=findKeyframeIndex(videoTrack.samples);if(!isVideoContiguous&&this.config.forceKeyFrameOnDiscontinuity){independent=true;if(firstKeyFrameIndex>0){_utils_logger__WEBPACK_IMPORTED_MODULE_5__["logger"].warn("[mp4-remuxer]: Dropped "+firstKeyFrameIndex+" out of "+length+" video samples due to a missing keyframe");var startPTS=this.getVideoStartPts(videoTrack.samples);videoTrack.samples=videoTrack.samples.slice(firstKeyFrameIndex);videoTrack.dropped+=firstKeyFrameIndex;videoTimeOffset+=(videoTrack.samples[0].pts-startPTS)/(videoTrack.timescale||90000);}else if(firstKeyFrameIndex===-1){_utils_logger__WEBPACK_IMPORTED_MODULE_5__["logger"].warn("[mp4-remuxer]: No keyframe found out of "+length+" video samples");independent=false;}}}if(this.ISGenerated){if(enoughAudioSamples&&enoughVideoSamples){// timeOffset is expected to be the offset of the first timestamp of this fragment (first DTS)
// if first audio DTS is not aligned with first video DTS then we need to take that into account
// when providing timeOffset to remuxAudio / remuxVideo. if we don't do that, there might be a permanent / small
// drift between audio and video streams
var _startPTS=this.getVideoStartPts(videoTrack.samples);var tsDelta=normalizePts(audioTrack.samples[0].pts,_startPTS)-_startPTS;var audiovideoTimestampDelta=tsDelta/videoTrack.inputTimeScale;audioTimeOffset+=Math.max(0,audiovideoTimestampDelta);videoTimeOffset+=Math.max(0,-audiovideoTimestampDelta);}// Purposefully remuxing audio before video, so that remuxVideo can use nextAudioPts, which is calculated in remuxAudio.
if(enoughAudioSamples){// if initSegment was generated without audio samples, regenerate it again
if(!audioTrack.samplerate){_utils_logger__WEBPACK_IMPORTED_MODULE_5__["logger"].warn('[mp4-remuxer]: regenerate InitSegment as audio detected');initSegment=this.generateIS(audioTrack,videoTrack,timeOffset);}audio=this.remuxAudio(audioTrack,audioTimeOffset,this.isAudioContiguous,accurateTimeOffset,hasVideo||enoughVideoSamples||playlistType===_types_loader__WEBPACK_IMPORTED_MODULE_6__["PlaylistLevelType"].AUDIO?videoTimeOffset:undefined);if(enoughVideoSamples){var audioTrackLength=audio?audio.endPTS-audio.startPTS:0;// if initSegment was generated without video samples, regenerate it again
if(!videoTrack.inputTimeScale){_utils_logger__WEBPACK_IMPORTED_MODULE_5__["logger"].warn('[mp4-remuxer]: regenerate InitSegment as video detected');initSegment=this.generateIS(audioTrack,videoTrack,timeOffset);}video=this.remuxVideo(videoTrack,videoTimeOffset,isVideoContiguous,audioTrackLength);}}else if(enoughVideoSamples){video=this.remuxVideo(videoTrack,videoTimeOffset,isVideoContiguous,0);}if(video){video.firstKeyFrame=firstKeyFrameIndex;video.independent=firstKeyFrameIndex!==-1;}}}// Allow ID3 and text to remux, even if more audio/video samples are required
if(this.ISGenerated){if(id3Track.samples.length){id3=this.remuxID3(id3Track,timeOffset);}if(textTrack.samples.length){text=this.remuxText(textTrack,timeOffset);}}return{audio:audio,video:video,initSegment:initSegment,independent:independent,text:text,id3:id3};};_proto.generateIS=function generateIS(audioTrack,videoTrack,timeOffset){var audioSamples=audioTrack.samples;var videoSamples=videoTrack.samples;var typeSupported=this.typeSupported;var tracks={};var computePTSDTS=!Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(this._initPTS);var container='audio/mp4';var initPTS;var initDTS;var timescale;if(computePTSDTS){initPTS=initDTS=Infinity;}if(audioTrack.config&&audioSamples.length){// let's use audio sampling rate as MP4 time scale.
// rationale is that there is a integer nb of audio frames per audio sample (1024 for AAC)
// using audio sampling rate here helps having an integer MP4 frame duration
// this avoids potential rounding issue and AV sync issue
audioTrack.timescale=audioTrack.samplerate;if(!audioTrack.isAAC){if(typeSupported.mpeg){// Chrome and Safari
container='audio/mpeg';audioTrack.codec='';}else if(typeSupported.mp3){// Firefox
audioTrack.codec='mp3';}}tracks.audio={id:'audio',container:container,codec:audioTrack.codec,initSegment:!audioTrack.isAAC&&typeSupported.mpeg?new Uint8Array(0):_mp4_generator__WEBPACK_IMPORTED_MODULE_2__["default"].initSegment([audioTrack]),metadata:{channelCount:audioTrack.channelCount}};if(computePTSDTS){timescale=audioTrack.inputTimeScale;// remember first PTS of this demuxing context. for audio, PTS = DTS
initPTS=initDTS=audioSamples[0].pts-Math.round(timescale*timeOffset);}}if(videoTrack.sps&&videoTrack.pps&&videoSamples.length){// let's use input time scale as MP4 video timescale
// we use input time scale straight away to avoid rounding issues on frame duration / cts computation
videoTrack.timescale=videoTrack.inputTimeScale;tracks.video={id:'main',container:'video/mp4',codec:videoTrack.codec,initSegment:_mp4_generator__WEBPACK_IMPORTED_MODULE_2__["default"].initSegment([videoTrack]),metadata:{width:videoTrack.width,height:videoTrack.height}};if(computePTSDTS){timescale=videoTrack.inputTimeScale;var startPTS=this.getVideoStartPts(videoSamples);var startOffset=Math.round(timescale*timeOffset);initDTS=Math.min(initDTS,normalizePts(videoSamples[0].dts,startPTS)-startOffset);initPTS=Math.min(initPTS,startPTS-startOffset);}}if(Object.keys(tracks).length){this.ISGenerated=true;if(computePTSDTS){this._initPTS=initPTS;this._initDTS=initDTS;}return{tracks:tracks,initPTS:initPTS,timescale:timescale};}};_proto.remuxVideo=function remuxVideo(track,timeOffset,contiguous,audioTrackLength){var timeScale=track.inputTimeScale;var inputSamples=track.samples;var outputSamples=[];var nbSamples=inputSamples.length;var initPTS=this._initPTS;var nextAvcDts=this.nextAvcDts;var offset=8;var mp4SampleDuration;var firstDTS;var lastDTS;var minPTS=Number.POSITIVE_INFINITY;var maxPTS=Number.NEGATIVE_INFINITY;var ptsDtsShift=0;var sortSamples=false;// if parsed fragment is contiguous with last one, let's use last DTS value as reference
if(!contiguous||nextAvcDts===null){var pts=timeOffset*timeScale;var cts=inputSamples[0].pts-normalizePts(inputSamples[0].dts,inputSamples[0].pts);// if not contiguous, let's use target timeOffset
nextAvcDts=pts-cts;}// PTS is coded on 33bits, and can loop from -2^32 to 2^32
// PTSNormalize will make PTS/DTS value monotonic, we use last known DTS value as reference value
for(var i=0;i<nbSamples;i++){var sample=inputSamples[i];sample.pts=normalizePts(sample.pts-initPTS,nextAvcDts);sample.dts=normalizePts(sample.dts-initPTS,nextAvcDts);if(sample.dts>sample.pts){var PTS_DTS_SHIFT_TOLERANCE_90KHZ=90000*0.2;ptsDtsShift=Math.max(Math.min(ptsDtsShift,sample.pts-sample.dts),-1*PTS_DTS_SHIFT_TOLERANCE_90KHZ);}if(sample.dts<inputSamples[i>0?i-1:i].dts){sortSamples=true;}}// sort video samples by DTS then PTS then demux id order
if(sortSamples){inputSamples.sort(function(a,b){var deltadts=a.dts-b.dts;var deltapts=a.pts-b.pts;return deltadts||deltapts;});}// Get first/last DTS
firstDTS=inputSamples[0].dts;lastDTS=inputSamples[inputSamples.length-1].dts;// on Safari let's signal the same sample duration for all samples
// sample duration (as expected by trun MP4 boxes), should be the delta between sample DTS
// set this constant duration as being the avg delta between consecutive DTS.
var averageSampleDuration=Math.round((lastDTS-firstDTS)/(nbSamples-1));// handle broken streams with PTS < DTS, tolerance up 0.2 seconds
if(ptsDtsShift<0){if(ptsDtsShift<averageSampleDuration*-2){// Fix for "CNN special report, with CC" in test-streams (including Safari browser)
// With large PTS < DTS errors such as this, we want to correct CTS while maintaining increasing DTS values
_utils_logger__WEBPACK_IMPORTED_MODULE_5__["logger"].warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(_utils_timescale_conversion__WEBPACK_IMPORTED_MODULE_7__["toMsFromMpegTsClock"])(-averageSampleDuration,true)+" ms");var lastDts=ptsDtsShift;for(var _i=0;_i<nbSamples;_i++){inputSamples[_i].dts=lastDts=Math.max(lastDts,inputSamples[_i].pts-averageSampleDuration);inputSamples[_i].pts=Math.max(lastDts,inputSamples[_i].pts);}}else{// Fix for "Custom IV with bad PTS DTS" in test-streams
// With smaller PTS < DTS errors we can simply move all DTS back. This increases CTS without causing buffer gaps or decode errors in Safari
_utils_logger__WEBPACK_IMPORTED_MODULE_5__["logger"].warn("PTS < DTS detected in video samples, shifting DTS by "+Object(_utils_timescale_conversion__WEBPACK_IMPORTED_MODULE_7__["toMsFromMpegTsClock"])(ptsDtsShift,true)+" ms to overcome this issue");for(var _i2=0;_i2<nbSamples;_i2++){inputSamples[_i2].dts=inputSamples[_i2].dts+ptsDtsShift;}}firstDTS=inputSamples[0].dts;}// if fragment are contiguous, detect hole/overlapping between fragments
if(contiguous){// check timestamp continuity across consecutive fragments (this is to remove inter-fragment gap/hole)
var delta=firstDTS-nextAvcDts;var foundHole=delta>averageSampleDuration;var foundOverlap=delta<-1;if(foundHole||foundOverlap){if(foundHole){_utils_logger__WEBPACK_IMPORTED_MODULE_5__["logger"].warn("AVC: "+Object(_utils_timescale_conversion__WEBPACK_IMPORTED_MODULE_7__["toMsFromMpegTsClock"])(delta,true)+" ms ("+delta+"dts) hole between fragments detected, filling it");}else{_utils_logger__WEBPACK_IMPORTED_MODULE_5__["logger"].warn("AVC: "+Object(_utils_timescale_conversion__WEBPACK_IMPORTED_MODULE_7__["toMsFromMpegTsClock"])(-delta,true)+" ms ("+delta+"dts) overlapping between fragments detected");}firstDTS=nextAvcDts;var firstPTS=inputSamples[0].pts-delta;inputSamples[0].dts=firstDTS;inputSamples[0].pts=firstPTS;_utils_logger__WEBPACK_IMPORTED_MODULE_5__["logger"].log("Video: First PTS/DTS adjusted: "+Object(_utils_timescale_conversion__WEBPACK_IMPORTED_MODULE_7__["toMsFromMpegTsClock"])(firstPTS,true)+"/"+Object(_utils_timescale_conversion__WEBPACK_IMPORTED_MODULE_7__["toMsFromMpegTsClock"])(firstDTS,true)+", delta: "+Object(_utils_timescale_conversion__WEBPACK_IMPORTED_MODULE_7__["toMsFromMpegTsClock"])(delta,true)+" ms");}}if(requiresPositiveDts){firstDTS=Math.max(0,firstDTS);}var nbNalu=0;var naluLen=0;for(var _i3=0;_i3<nbSamples;_i3++){// compute total/avc sample length and nb of NAL units
var _sample=inputSamples[_i3];var units=_sample.units;var nbUnits=units.length;var sampleLen=0;for(var j=0;j<nbUnits;j++){sampleLen+=units[j].data.length;}naluLen+=sampleLen;nbNalu+=nbUnits;_sample.length=sampleLen;// normalize PTS/DTS
// ensure sample monotonic DTS
_sample.dts=Math.max(_sample.dts,firstDTS);// ensure that computed value is greater or equal than sample DTS
_sample.pts=Math.max(_sample.pts,_sample.dts,0);minPTS=Math.min(_sample.pts,minPTS);maxPTS=Math.max(_sample.pts,maxPTS);}lastDTS=inputSamples[nbSamples-1].dts;/* concatenate the video data and construct the mdat in place
			      (need 8 more bytes to fill length and mpdat type) */var mdatSize=naluLen+4*nbNalu+8;var mdat;try{mdat=new Uint8Array(mdatSize);}catch(err){this.observer.emit(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].ERROR,_events__WEBPACK_IMPORTED_MODULE_3__["Events"].ERROR,{type:_errors__WEBPACK_IMPORTED_MODULE_4__["ErrorTypes"].MUX_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_4__["ErrorDetails"].REMUX_ALLOC_ERROR,fatal:false,bytes:mdatSize,reason:"fail allocating video mdat "+mdatSize});return;}var view=new DataView(mdat.buffer);view.setUint32(0,mdatSize);mdat.set(_mp4_generator__WEBPACK_IMPORTED_MODULE_2__["default"].types.mdat,4);for(var _i4=0;_i4<nbSamples;_i4++){var avcSample=inputSamples[_i4];var avcSampleUnits=avcSample.units;var mp4SampleLength=0;// convert NALU bitstream to MP4 format (prepend NALU with size field)
for(var _j=0,_nbUnits=avcSampleUnits.length;_j<_nbUnits;_j++){var unit=avcSampleUnits[_j];var unitData=unit.data;var unitDataLen=unit.data.byteLength;view.setUint32(offset,unitDataLen);offset+=4;mdat.set(unitData,offset);offset+=unitDataLen;mp4SampleLength+=4+unitDataLen;}// expected sample duration is the Decoding Timestamp diff of consecutive samples
if(_i4<nbSamples-1){mp4SampleDuration=inputSamples[_i4+1].dts-avcSample.dts;}else{var config=this.config;var lastFrameDuration=avcSample.dts-inputSamples[_i4>0?_i4-1:_i4].dts;if(config.stretchShortVideoTrack&&this.nextAudioPts!==null){// In some cases, a segment's audio track duration may exceed the video track duration.
// Since we've already remuxed audio, and we know how long the audio track is, we look to
// see if the delta to the next segment is longer than maxBufferHole.
// If so, playback would potentially get stuck, so we artificially inflate
// the duration of the last frame to minimize any potential gap between segments.
var gapTolerance=Math.floor(config.maxBufferHole*timeScale);var deltaToFrameEnd=(audioTrackLength?minPTS+audioTrackLength*timeScale:this.nextAudioPts)-avcSample.pts;if(deltaToFrameEnd>gapTolerance){// We subtract lastFrameDuration from deltaToFrameEnd to try to prevent any video
// frame overlap. maxBufferHole should be >> lastFrameDuration anyway.
mp4SampleDuration=deltaToFrameEnd-lastFrameDuration;if(mp4SampleDuration<0){mp4SampleDuration=lastFrameDuration;}_utils_logger__WEBPACK_IMPORTED_MODULE_5__["logger"].log("[mp4-remuxer]: It is approximately "+deltaToFrameEnd/90+" ms to the next segment; using duration "+mp4SampleDuration/90+" ms for the last video frame.");}else{mp4SampleDuration=lastFrameDuration;}}else{mp4SampleDuration=lastFrameDuration;}}var compositionTimeOffset=Math.round(avcSample.pts-avcSample.dts);outputSamples.push(new Mp4Sample(avcSample.key,mp4SampleDuration,mp4SampleLength,compositionTimeOffset));}if(outputSamples.length&&chromeVersion&&chromeVersion<70){// Chrome workaround, mark first sample as being a Random Access Point (keyframe) to avoid sourcebuffer append issue
// https://code.google.com/p/chromium/issues/detail?id=229412
var flags=outputSamples[0].flags;flags.dependsOn=2;flags.isNonSync=0;}console.assert(mp4SampleDuration!==undefined,'mp4SampleDuration must be computed');// next AVC sample DTS should be equal to last sample DTS + last sample duration (in PES timescale)
this.nextAvcDts=nextAvcDts=lastDTS+mp4SampleDuration;this.isVideoContiguous=true;var moof=_mp4_generator__WEBPACK_IMPORTED_MODULE_2__["default"].moof(track.sequenceNumber++,firstDTS,_extends({},track,{samples:outputSamples}));var type='video';var data={data1:moof,data2:mdat,startPTS:minPTS/timeScale,endPTS:(maxPTS+mp4SampleDuration)/timeScale,startDTS:firstDTS/timeScale,endDTS:nextAvcDts/timeScale,type:type,hasAudio:false,hasVideo:true,nb:outputSamples.length,dropped:track.dropped};track.samples=[];track.dropped=0;console.assert(mdat.length,'MDAT length must not be zero');return data;};_proto.remuxAudio=function remuxAudio(track,timeOffset,contiguous,accurateTimeOffset,videoTimeOffset){var inputTimeScale=track.inputTimeScale;var mp4timeScale=track.samplerate?track.samplerate:inputTimeScale;var scaleFactor=inputTimeScale/mp4timeScale;var mp4SampleDuration=track.isAAC?AAC_SAMPLES_PER_FRAME:MPEG_AUDIO_SAMPLE_PER_FRAME;var inputSampleDuration=mp4SampleDuration*scaleFactor;var initPTS=this._initPTS;var rawMPEG=!track.isAAC&&this.typeSupported.mpeg;var outputSamples=[];var inputSamples=track.samples;var offset=rawMPEG?0:8;var nextAudioPts=this.nextAudioPts||-1;// window.audioSamples ? window.audioSamples.push(inputSamples.map(s => s.pts)) : (window.audioSamples = [inputSamples.map(s => s.pts)]);
// for audio samples, also consider consecutive fragments as being contiguous (even if a level switch occurs),
// for sake of clarity:
// consecutive fragments are frags with
//  - less than 100ms gaps between new time offset (if accurate) and next expected PTS OR
//  - less than 20 audio frames distance
// contiguous fragments are consecutive fragments from same quality level (same level, new SN = old SN + 1)
// this helps ensuring audio continuity
// and this also avoids audio glitches/cut when switching quality, or reporting wrong duration on first audio frame
var timeOffsetMpegTS=timeOffset*inputTimeScale;this.isAudioContiguous=contiguous=contiguous||inputSamples.length&&nextAudioPts>0&&(accurateTimeOffset&&Math.abs(timeOffsetMpegTS-nextAudioPts)<9000||Math.abs(normalizePts(inputSamples[0].pts-initPTS,timeOffsetMpegTS)-nextAudioPts)<20*inputSampleDuration);// compute normalized PTS
inputSamples.forEach(function(sample){sample.pts=normalizePts(sample.pts-initPTS,timeOffsetMpegTS);});if(!contiguous||nextAudioPts<0){// filter out sample with negative PTS that are not playable anyway
// if we don't remove these negative samples, they will shift all audio samples forward.
// leading to audio overlap between current / next fragment
inputSamples=inputSamples.filter(function(sample){return sample.pts>=0;});// in case all samples have negative PTS, and have been filtered out, return now
if(!inputSamples.length){return;}if(videoTimeOffset===0){// Set the start to 0 to match video so that start gaps larger than inputSampleDuration are filled with silence
nextAudioPts=0;}else if(accurateTimeOffset){// When not seeking, not live, and LevelDetails.PTSKnown, use fragment start as predicted next audio PTS
nextAudioPts=Math.max(0,timeOffsetMpegTS);}else{// if frags are not contiguous and if we cant trust time offset, let's use first sample PTS as next audio PTS
nextAudioPts=inputSamples[0].pts;}}// If the audio track is missing samples, the frames seem to get "left-shifted" within the
// resulting mp4 segment, causing sync issues and leaving gaps at the end of the audio segment.
// In an effort to prevent this from happening, we inject frames here where there are gaps.
// When possible, we inject a silent frame; when that's not possible, we duplicate the last
// frame.
if(track.isAAC){var alignedWithVideo=videoTimeOffset!==undefined;var maxAudioFramesDrift=this.config.maxAudioFramesDrift;for(var i=0,nextPts=nextAudioPts;i<inputSamples.length;i++){// First, let's see how far off this frame is from where we expect it to be
var sample=inputSamples[i];var pts=sample.pts;var delta=pts-nextPts;var duration=Math.abs(1000*delta/inputTimeScale);// When remuxing with video, if we're overlapping by more than a duration, drop this sample to stay in sync
if(delta<=-maxAudioFramesDrift*inputSampleDuration&&alignedWithVideo){if(i===0){_utils_logger__WEBPACK_IMPORTED_MODULE_5__["logger"].warn("Audio frame @ "+(pts/inputTimeScale).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1000*delta/inputTimeScale)+" ms.");this.nextAudioPts=nextAudioPts=nextPts=pts;}}// eslint-disable-line brace-style
// Insert missing frames if:
// 1: We're more than maxAudioFramesDrift frame away
// 2: Not more than MAX_SILENT_FRAME_DURATION away
// 3: currentTime (aka nextPtsNorm) is not 0
// 4: remuxing with video (videoTimeOffset !== undefined)
else if(delta>=maxAudioFramesDrift*inputSampleDuration&&duration<MAX_SILENT_FRAME_DURATION&&alignedWithVideo){var missing=Math.round(delta/inputSampleDuration);// Adjust nextPts so that silent samples are aligned with media pts. This will prevent media samples from
// later being shifted if nextPts is based on timeOffset and delta is not a multiple of inputSampleDuration.
nextPts=pts-missing*inputSampleDuration;if(nextPts<0){missing--;nextPts+=inputSampleDuration;}if(i===0){this.nextAudioPts=nextAudioPts=nextPts;}_utils_logger__WEBPACK_IMPORTED_MODULE_5__["logger"].warn("[mp4-remuxer]: Injecting "+missing+" audio frame @ "+(nextPts/inputTimeScale).toFixed(3)+"s due to "+Math.round(1000*delta/inputTimeScale)+" ms gap.");for(var j=0;j<missing;j++){var newStamp=Math.max(nextPts,0);var fillFrame=_aac_helper__WEBPACK_IMPORTED_MODULE_1__["default"].getSilentFrame(track.manifestCodec||track.codec,track.channelCount);if(!fillFrame){_utils_logger__WEBPACK_IMPORTED_MODULE_5__["logger"].log('[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead.');fillFrame=sample.unit.subarray();}inputSamples.splice(i,0,{unit:fillFrame,pts:newStamp});nextPts+=inputSampleDuration;i++;}}sample.pts=nextPts;nextPts+=inputSampleDuration;}}var firstPTS=null;var lastPTS=null;var mdat;var mdatSize=0;var sampleLength=inputSamples.length;while(sampleLength--){mdatSize+=inputSamples[sampleLength].unit.byteLength;}for(var _j2=0,_nbSamples=inputSamples.length;_j2<_nbSamples;_j2++){var audioSample=inputSamples[_j2];var unit=audioSample.unit;var _pts=audioSample.pts;if(lastPTS!==null){// If we have more than one sample, set the duration of the sample to the "real" duration; the PTS diff with
// the previous sample
var prevSample=outputSamples[_j2-1];prevSample.duration=Math.round((_pts-lastPTS)/scaleFactor);}else{if(contiguous&&track.isAAC){// set PTS/DTS to expected PTS/DTS
_pts=nextAudioPts;}// remember first PTS of our audioSamples
firstPTS=_pts;if(mdatSize>0){/* concatenate the audio data and construct the mdat in place
			            (need 8 more bytes to fill length and mdat type) */mdatSize+=offset;try{mdat=new Uint8Array(mdatSize);}catch(err){this.observer.emit(_events__WEBPACK_IMPORTED_MODULE_3__["Events"].ERROR,_events__WEBPACK_IMPORTED_MODULE_3__["Events"].ERROR,{type:_errors__WEBPACK_IMPORTED_MODULE_4__["ErrorTypes"].MUX_ERROR,details:_errors__WEBPACK_IMPORTED_MODULE_4__["ErrorDetails"].REMUX_ALLOC_ERROR,fatal:false,bytes:mdatSize,reason:"fail allocating audio mdat "+mdatSize});return;}if(!rawMPEG){var view=new DataView(mdat.buffer);view.setUint32(0,mdatSize);mdat.set(_mp4_generator__WEBPACK_IMPORTED_MODULE_2__["default"].types.mdat,4);}}else{// no audio samples
return;}}mdat.set(unit,offset);var unitLen=unit.byteLength;offset+=unitLen;// Default the sample's duration to the computed mp4SampleDuration, which will either be 1024 for AAC or 1152 for MPEG
// In the case that we have 1 sample, this will be the duration. If we have more than one sample, the duration
// becomes the PTS diff with the previous sample
outputSamples.push(new Mp4Sample(true,mp4SampleDuration,unitLen,0));lastPTS=_pts;}// We could end up with no audio samples if all input samples were overlapping with the previously remuxed ones
var nbSamples=outputSamples.length;if(!nbSamples){return;}// The next audio sample PTS should be equal to last sample PTS + duration
var lastSample=outputSamples[outputSamples.length-1];this.nextAudioPts=nextAudioPts=lastPTS+scaleFactor*lastSample.duration;// Set the track samples from inputSamples to outputSamples before remuxing
var moof=rawMPEG?new Uint8Array(0):_mp4_generator__WEBPACK_IMPORTED_MODULE_2__["default"].moof(track.sequenceNumber++,firstPTS/scaleFactor,_extends({},track,{samples:outputSamples}));// Clear the track samples. This also clears the samples array in the demuxer, since the reference is shared
track.samples=[];var start=firstPTS/inputTimeScale;var end=nextAudioPts/inputTimeScale;var type='audio';var audioData={data1:moof,data2:mdat,startPTS:start,endPTS:end,startDTS:start,endDTS:end,type:type,hasAudio:true,hasVideo:false,nb:nbSamples};this.isAudioContiguous=true;console.assert(mdat.length,'MDAT length must not be zero');return audioData;};_proto.remuxEmptyAudio=function remuxEmptyAudio(track,timeOffset,contiguous,videoData){var inputTimeScale=track.inputTimeScale;var mp4timeScale=track.samplerate?track.samplerate:inputTimeScale;var scaleFactor=inputTimeScale/mp4timeScale;var nextAudioPts=this.nextAudioPts;// sync with video's timestamp
var startDTS=(nextAudioPts!==null?nextAudioPts:videoData.startDTS*inputTimeScale)+this._initDTS;var endDTS=videoData.endDTS*inputTimeScale+this._initDTS;// one sample's duration value
var frameDuration=scaleFactor*AAC_SAMPLES_PER_FRAME;// samples count of this segment's duration
var nbSamples=Math.ceil((endDTS-startDTS)/frameDuration);// silent frame
var silentFrame=_aac_helper__WEBPACK_IMPORTED_MODULE_1__["default"].getSilentFrame(track.manifestCodec||track.codec,track.channelCount);_utils_logger__WEBPACK_IMPORTED_MODULE_5__["logger"].warn('[mp4-remuxer]: remux empty Audio');// Can't remux if we can't generate a silent frame...
if(!silentFrame){_utils_logger__WEBPACK_IMPORTED_MODULE_5__["logger"].trace('[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec');return;}var samples=[];for(var i=0;i<nbSamples;i++){var stamp=startDTS+i*frameDuration;samples.push({unit:silentFrame,pts:stamp,dts:stamp});}track.samples=samples;return this.remuxAudio(track,timeOffset,contiguous,false);};_proto.remuxID3=function remuxID3(track,timeOffset){var length=track.samples.length;if(!length){return;}var inputTimeScale=track.inputTimeScale;var initPTS=this._initPTS;var initDTS=this._initDTS;for(var index=0;index<length;index++){var sample=track.samples[index];// setting id3 pts, dts to relative time
// using this._initPTS and this._initDTS to calculate relative time
sample.pts=normalizePts(sample.pts-initPTS,timeOffset*inputTimeScale)/inputTimeScale;sample.dts=normalizePts(sample.dts-initDTS,timeOffset*inputTimeScale)/inputTimeScale;}var samples=track.samples;track.samples=[];return{samples:samples};};_proto.remuxText=function remuxText(track,timeOffset){var length=track.samples.length;if(!length){return;}var inputTimeScale=track.inputTimeScale;var initPTS=this._initPTS;for(var index=0;index<length;index++){var sample=track.samples[index];// setting text pts, dts to relative time
// using this._initPTS and this._initDTS to calculate relative time
sample.pts=normalizePts(sample.pts-initPTS,timeOffset*inputTimeScale)/inputTimeScale;}track.samples.sort(function(a,b){return a.pts-b.pts;});var samples=track.samples;track.samples=[];return{samples:samples};};return MP4Remuxer;}();function normalizePts(value,reference){var offset;if(reference===null){return value;}if(reference<value){// - 2^33
offset=-8589934592;}else{// + 2^33
offset=8589934592;}/* PTS is 33bit (from 0 to 2^33 -1)
			    if diff between value and reference is bigger than half of the amplitude (2^32) then it means that
			    PTS looping occured. fill the gap */while(Math.abs(value-reference)>4294967296){value+=offset;}return value;}function findKeyframeIndex(samples){for(var i=0;i<samples.length;i++){if(samples[i].key){return i;}}return-1;}var Mp4Sample=function Mp4Sample(isKeyframe,duration,size,cts){this.size=void 0;this.duration=void 0;this.cts=void 0;this.flags=void 0;this.duration=duration;this.size=size;this.cts=cts;this.flags=new Mp4SampleFlags(isKeyframe);};var Mp4SampleFlags=function Mp4SampleFlags(isKeyframe){this.isLeading=0;this.isDependedOn=0;this.hasRedundancy=0;this.degradPrio=0;this.dependsOn=1;this.isNonSync=1;this.dependsOn=isKeyframe?2:1;this.isNonSync=isKeyframe?0:1;};/***/},/***/"./src/remux/passthrough-remuxer.ts":/*!******************************************!*\
			  !*** ./src/remux/passthrough-remuxer.ts ***!
			  \******************************************/ /*! exports provided: default */ /***/function srcRemuxPassthroughRemuxerTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var _home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./src/polyfills/number */"./src/polyfills/number.ts");/* harmony import */var _utils_mp4_tools__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts");/* harmony import */var _loader_fragment__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../loader/fragment */"./src/loader/fragment.ts");/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ../utils/logger */"./src/utils/logger.ts");var PassThroughRemuxer=/*#__PURE__*/function(){function PassThroughRemuxer(){this.emitInitSegment=false;this.audioCodec=void 0;this.videoCodec=void 0;this.initData=void 0;this.initPTS=void 0;this.initTracks=void 0;this.lastEndDTS=null;}var _proto=PassThroughRemuxer.prototype;_proto.destroy=function destroy(){};_proto.resetTimeStamp=function resetTimeStamp(defaultInitPTS){this.initPTS=defaultInitPTS;this.lastEndDTS=null;};_proto.resetNextTimestamp=function resetNextTimestamp(){this.lastEndDTS=null;};_proto.resetInitSegment=function resetInitSegment(initSegment,audioCodec,videoCodec){this.audioCodec=audioCodec;this.videoCodec=videoCodec;this.generateInitSegment(initSegment);this.emitInitSegment=true;};_proto.generateInitSegment=function generateInitSegment(initSegment){var audioCodec=this.audioCodec,videoCodec=this.videoCodec;if(!initSegment||!initSegment.byteLength){this.initTracks=undefined;this.initData=undefined;return;}var initData=this.initData=Object(_utils_mp4_tools__WEBPACK_IMPORTED_MODULE_1__["parseInitSegment"])(initSegment);// Get codec from initSegment or fallback to default
if(!audioCodec){audioCodec=getParsedTrackCodec(initData.audio,_loader_fragment__WEBPACK_IMPORTED_MODULE_2__["ElementaryStreamTypes"].AUDIO);}if(!videoCodec){videoCodec=getParsedTrackCodec(initData.video,_loader_fragment__WEBPACK_IMPORTED_MODULE_2__["ElementaryStreamTypes"].VIDEO);}var tracks={};if(initData.audio&&initData.video){tracks.audiovideo={container:'video/mp4',codec:audioCodec+','+videoCodec,initSegment:initSegment,id:'main'};}else if(initData.audio){tracks.audio={container:'audio/mp4',codec:audioCodec,initSegment:initSegment,id:'audio'};}else if(initData.video){tracks.video={container:'video/mp4',codec:videoCodec,initSegment:initSegment,id:'main'};}else{_utils_logger__WEBPACK_IMPORTED_MODULE_3__["logger"].warn('[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes.');}this.initTracks=tracks;};_proto.remux=function remux(audioTrack,videoTrack,id3Track,textTrack,timeOffset){var initPTS=this.initPTS,lastEndDTS=this.lastEndDTS;var result={audio:undefined,video:undefined,text:textTrack,id3:id3Track,initSegment:undefined};// If we haven't yet set a lastEndDTS, or it was reset, set it to the provided timeOffset. We want to use the
// lastEndDTS over timeOffset whenever possible; during progressive playback, the media source will not update
// the media duration (which is what timeOffset is provided as) before we need to process the next chunk.
if(!Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(lastEndDTS)){lastEndDTS=this.lastEndDTS=timeOffset||0;}// The binary segment data is added to the videoTrack in the mp4demuxer. We don't check to see if the data is only
// audio or video (or both); adding it to video was an arbitrary choice.
var data=videoTrack.samples;if(!data||!data.length){return result;}var initSegment={initPTS:undefined,timescale:1};var initData=this.initData;if(!initData||!initData.length){this.generateInitSegment(data);initData=this.initData;}if(!initData||!initData.length){// We can't remux if the initSegment could not be generated
_utils_logger__WEBPACK_IMPORTED_MODULE_3__["logger"].warn('[passthrough-remuxer.ts]: Failed to generate initSegment.');return result;}if(this.emitInitSegment){initSegment.tracks=this.initTracks;this.emitInitSegment=false;}if(!Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(initPTS)){this.initPTS=initSegment.initPTS=initPTS=computeInitPTS(initData,data,lastEndDTS);}var duration=Object(_utils_mp4_tools__WEBPACK_IMPORTED_MODULE_1__["getDuration"])(data,initData);var startDTS=lastEndDTS;var endDTS=duration+startDTS;Object(_utils_mp4_tools__WEBPACK_IMPORTED_MODULE_1__["offsetStartDTS"])(initData,data,initPTS);if(duration>0){this.lastEndDTS=endDTS;}else{_utils_logger__WEBPACK_IMPORTED_MODULE_3__["logger"].warn('Duration parsed from mp4 should be greater than zero');this.resetNextTimestamp();}var hasAudio=!!initData.audio;var hasVideo=!!initData.video;var type='';if(hasAudio){type+='audio';}if(hasVideo){type+='video';}var track={data1:data,startPTS:startDTS,startDTS:startDTS,endPTS:endDTS,endDTS:endDTS,type:type,hasAudio:hasAudio,hasVideo:hasVideo,nb:1,dropped:0};result.audio=track.type==='audio'?track:undefined;result.video=track.type!=='audio'?track:undefined;result.text=textTrack;result.id3=id3Track;result.initSegment=initSegment;return result;};return PassThroughRemuxer;}();var computeInitPTS=function computeInitPTS(initData,data,timeOffset){return Object(_utils_mp4_tools__WEBPACK_IMPORTED_MODULE_1__["getStartDTS"])(initData,data)-timeOffset;};function getParsedTrackCodec(track,type){var parsedCodec=track===null||track===void 0?void 0:track.codec;if(parsedCodec&&parsedCodec.length>4){return parsedCodec;}// Since mp4-tools cannot parse full codec string (see 'TODO: Parse codec details'... in mp4-tools)
// Provide defaults based on codec type
// This allows for some playback of some fmp4 playlists without CODECS defined in manifest
if(parsedCodec==='hvc1'){return'hvc1.1.c.L120.90';}if(parsedCodec==='av01'){return'av01.0.04M.08';}if(parsedCodec==='avc1'||type===_loader_fragment__WEBPACK_IMPORTED_MODULE_2__["ElementaryStreamTypes"].VIDEO){return'avc1.42e01e';}return'mp4a.40.5';}/* harmony default export */__webpack_exports__["default"]=PassThroughRemuxer;/***/},/***/"./src/task-loop.ts":/*!**************************!*\
			  !*** ./src/task-loop.ts ***!
			  \**************************/ /*! exports provided: default */ /***/function srcTaskLoopTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"default",function(){return TaskLoop;});/**
			 * Sub-class specialization of EventHandler base class.
			 *
			 * TaskLoop allows to schedule a task function being called (optionnaly repeatedly) on the main loop,
			 * scheduled asynchroneously, avoiding recursive calls in the same tick.
			 *
			 * The task itself is implemented in `doTick`. It can be requested and called for single execution
			 * using the `tick` method.
			 *
			 * It will be assured that the task execution method (`tick`) only gets called once per main loop "tick",
			 * no matter how often it gets requested for execution. Execution in further ticks will be scheduled accordingly.
			 *
			 * If further execution requests have already been scheduled on the next tick, it can be checked with `hasNextTick`,
			 * and cancelled with `clearNextTick`.
			 *
			 * The task can be scheduled as an interval repeatedly with a period as parameter (see `setInterval`, `clearInterval`).
			 *
			 * Sub-classes need to implement the `doTick` method which will effectively have the task execution routine.
			 *
			 * Further explanations:
			 *
			 * The baseclass has a `tick` method that will schedule the doTick call. It may be called synchroneously
			 * only for a stack-depth of one. On re-entrant calls, sub-sequent calls are scheduled for next main loop ticks.
			 *
			 * When the task execution (`tick` method) is called in re-entrant way this is detected and
			 * we are limiting the task execution per call stack to exactly one, but scheduling/post-poning further
			 * task processing on the next main loop iteration (also known as "next tick" in the Node/JS runtime lingo).
			 */var TaskLoop=/*#__PURE__*/function(){function TaskLoop(){this._boundTick=void 0;this._tickTimer=null;this._tickInterval=null;this._tickCallCount=0;this._boundTick=this.tick.bind(this);}var _proto=TaskLoop.prototype;_proto.destroy=function destroy(){this.onHandlerDestroying();this.onHandlerDestroyed();};_proto.onHandlerDestroying=function onHandlerDestroying(){// clear all timers before unregistering from event bus
this.clearNextTick();this.clearInterval();};_proto.onHandlerDestroyed=function onHandlerDestroyed(){}/**
			   * @returns {boolean}
			   */;_proto.hasInterval=function hasInterval(){return!!this._tickInterval;}/**
			   * @returns {boolean}
			   */;_proto.hasNextTick=function hasNextTick(){return!!this._tickTimer;}/**
			   * @param {number} millis Interval time (ms)
			   * @returns {boolean} True when interval has been scheduled, false when already scheduled (no effect)
			   */;_proto.setInterval=function setInterval(millis){if(!this._tickInterval){this._tickInterval=self.setInterval(this._boundTick,millis);return true;}return false;}/**
			   * @returns {boolean} True when interval was cleared, false when none was set (no effect)
			   */;_proto.clearInterval=function clearInterval(){if(this._tickInterval){self.clearInterval(this._tickInterval);this._tickInterval=null;return true;}return false;}/**
			   * @returns {boolean} True when timeout was cleared, false when none was set (no effect)
			   */;_proto.clearNextTick=function clearNextTick(){if(this._tickTimer){self.clearTimeout(this._tickTimer);this._tickTimer=null;return true;}return false;}/**
			   * Will call the subclass doTick implementation in this main loop tick
			   * or in the next one (via setTimeout(,0)) in case it has already been called
			   * in this tick (in case this is a re-entrant call).
			   */;_proto.tick=function tick(){this._tickCallCount++;if(this._tickCallCount===1){this.doTick();// re-entrant call to tick from previous doTick call stack
// -> schedule a call on the next main loop iteration to process this task processing request
if(this._tickCallCount>1){// make sure only one timer exists at any time at max
this.tickImmediate();}this._tickCallCount=0;}};_proto.tickImmediate=function tickImmediate(){this.clearNextTick();this._tickTimer=self.setTimeout(this._boundTick,0);}/**
			   * For subclass to implement task logic
			   * @abstract
			   */;_proto.doTick=function doTick(){};return TaskLoop;}();/***/},/***/"./src/types/cmcd.ts":/*!***************************!*\
			  !*** ./src/types/cmcd.ts ***!
			  \***************************/ /*! exports provided: CMCDVersion, CMCDObjectType, CMCDStreamingFormat, CMCDStreamType */ /***/function srcTypesCmcdTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"CMCDVersion",function(){return CMCDVersion;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"CMCDObjectType",function(){return CMCDObjectType;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"CMCDStreamingFormat",function(){return CMCDStreamingFormat;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"CMCDStreamType",function(){return CMCDStreamType;});/**
			 * CMCD spec version
			 */var CMCDVersion=1;/**
			 * CMCD Object Type
			 */var CMCDObjectType;/**
			 * CMCD Streaming Format
			 */(function(CMCDObjectType){CMCDObjectType["MANIFEST"]="m";CMCDObjectType["AUDIO"]="a";CMCDObjectType["VIDEO"]="v";CMCDObjectType["MUXED"]="av";CMCDObjectType["INIT"]="i";CMCDObjectType["CAPTION"]="c";CMCDObjectType["TIMED_TEXT"]="tt";CMCDObjectType["KEY"]="k";CMCDObjectType["OTHER"]="o";})(CMCDObjectType||(CMCDObjectType={}));var CMCDStreamingFormat;/**
			 * CMCD Streaming Type
			 */(function(CMCDStreamingFormat){CMCDStreamingFormat["DASH"]="d";CMCDStreamingFormat["HLS"]="h";CMCDStreamingFormat["SMOOTH"]="s";CMCDStreamingFormat["OTHER"]="o";})(CMCDStreamingFormat||(CMCDStreamingFormat={}));var CMCDStreamType;/**
			 * CMCD Headers
			 */(function(CMCDStreamType){CMCDStreamType["VOD"]="v";CMCDStreamType["LIVE"]="l";})(CMCDStreamType||(CMCDStreamType={}));/***/},/***/"./src/types/level.ts":/*!****************************!*\
			  !*** ./src/types/level.ts ***!
			  \****************************/ /*! exports provided: HlsSkip, getSkipValue, HlsUrlParameters, Level */ /***/function srcTypesLevelTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"HlsSkip",function(){return HlsSkip;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"getSkipValue",function(){return getSkipValue;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"HlsUrlParameters",function(){return HlsUrlParameters;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"Level",function(){return Level;});function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}var HlsSkip;(function(HlsSkip){HlsSkip["No"]="";HlsSkip["Yes"]="YES";HlsSkip["v2"]="v2";})(HlsSkip||(HlsSkip={}));function getSkipValue(details,msn){var canSkipUntil=details.canSkipUntil,canSkipDateRanges=details.canSkipDateRanges,endSN=details.endSN;var snChangeGoal=msn!==undefined?msn-endSN:0;if(canSkipUntil&&snChangeGoal<canSkipUntil){if(canSkipDateRanges){return HlsSkip.v2;}return HlsSkip.Yes;}return HlsSkip.No;}var HlsUrlParameters=/*#__PURE__*/function(){function HlsUrlParameters(msn,part,skip){this.msn=void 0;this.part=void 0;this.skip=void 0;this.msn=msn;this.part=part;this.skip=skip;}var _proto=HlsUrlParameters.prototype;_proto.addDirectives=function addDirectives(uri){var url=new self.URL(uri);if(this.msn!==undefined){url.searchParams.set('_HLS_msn',this.msn.toString());}if(this.part!==undefined){url.searchParams.set('_HLS_part',this.part.toString());}if(this.skip){url.searchParams.set('_HLS_skip',this.skip);}return url.toString();};return HlsUrlParameters;}();var Level=/*#__PURE__*/function(){function Level(data){this.attrs=void 0;this.audioCodec=void 0;this.bitrate=void 0;this.codecSet=void 0;this.height=void 0;this.id=void 0;this.name=void 0;this.videoCodec=void 0;this.width=void 0;this.unknownCodecs=void 0;this.audioGroupIds=void 0;this.details=void 0;this.fragmentError=0;this.loadError=0;this.loaded=void 0;this.realBitrate=0;this.textGroupIds=void 0;this.url=void 0;this._urlId=0;this.url=[data.url];this.attrs=data.attrs;this.bitrate=data.bitrate;if(data.details){this.details=data.details;}this.id=data.id||0;this.name=data.name;this.width=data.width||0;this.height=data.height||0;this.audioCodec=data.audioCodec;this.videoCodec=data.videoCodec;this.unknownCodecs=data.unknownCodecs;this.codecSet=[data.videoCodec,data.audioCodec].filter(function(c){return c;}).join(',').replace(/\.[^.,]+/g,'');}_createClass(Level,[{key:"maxBitrate",get:function get(){return Math.max(this.realBitrate,this.bitrate);}},{key:"uri",get:function get(){return this.url[this._urlId]||'';}},{key:"urlId",get:function get(){return this._urlId;},set:function set(value){var newValue=value%this.url.length;if(this._urlId!==newValue){this.details=undefined;this._urlId=newValue;}}}]);return Level;}();/***/},/***/"./src/types/loader.ts":/*!*****************************!*\
			  !*** ./src/types/loader.ts ***!
			  \*****************************/ /*! exports provided: PlaylistContextType, PlaylistLevelType */ /***/function srcTypesLoaderTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"PlaylistContextType",function(){return PlaylistContextType;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"PlaylistLevelType",function(){return PlaylistLevelType;});var PlaylistContextType;(function(PlaylistContextType){PlaylistContextType["MANIFEST"]="manifest";PlaylistContextType["LEVEL"]="level";PlaylistContextType["AUDIO_TRACK"]="audioTrack";PlaylistContextType["SUBTITLE_TRACK"]="subtitleTrack";})(PlaylistContextType||(PlaylistContextType={}));var PlaylistLevelType;(function(PlaylistLevelType){PlaylistLevelType["MAIN"]="main";PlaylistLevelType["AUDIO"]="audio";PlaylistLevelType["SUBTITLE"]="subtitle";})(PlaylistLevelType||(PlaylistLevelType={}));/***/},/***/"./src/types/transmuxer.ts":/*!*********************************!*\
			  !*** ./src/types/transmuxer.ts ***!
			  \*********************************/ /*! exports provided: ChunkMetadata */ /***/function srcTypesTransmuxerTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"ChunkMetadata",function(){return ChunkMetadata;});var ChunkMetadata=function ChunkMetadata(level,sn,id,size,part,partial){if(size===void 0){size=0;}if(part===void 0){part=-1;}if(partial===void 0){partial=false;}this.level=void 0;this.sn=void 0;this.part=void 0;this.id=void 0;this.size=void 0;this.partial=void 0;this.transmuxing=getNewPerformanceTiming();this.buffering={audio:getNewPerformanceTiming(),video:getNewPerformanceTiming(),audiovideo:getNewPerformanceTiming()};this.level=level;this.sn=sn;this.id=id;this.size=size;this.part=part;this.partial=partial;};function getNewPerformanceTiming(){return{start:0,executeStart:0,executeEnd:0,end:0};}/***/},/***/"./src/utils/attr-list.ts":/*!********************************!*\
			  !*** ./src/utils/attr-list.ts ***!
			  \********************************/ /*! exports provided: AttrList */ /***/function srcUtilsAttrListTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"AttrList",function(){return AttrList;});var DECIMAL_RESOLUTION_REGEX=/^(\d+)x(\d+)$/;// eslint-disable-line no-useless-escape
var ATTR_LIST_REGEX=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g;// eslint-disable-line no-useless-escape
// adapted from https://github.com/kanongil/node-m3u8parse/blob/master/attrlist.js
var AttrList=/*#__PURE__*/function(){function AttrList(attrs){if(typeof attrs==='string'){attrs=AttrList.parseAttrList(attrs);}for(var attr in attrs){if(attrs.hasOwnProperty(attr)){this[attr]=attrs[attr];}}}var _proto=AttrList.prototype;_proto.decimalInteger=function decimalInteger(attrName){var intValue=parseInt(this[attrName],10);if(intValue>Number.MAX_SAFE_INTEGER){return Infinity;}return intValue;};_proto.hexadecimalInteger=function hexadecimalInteger(attrName){if(this[attrName]){var stringValue=(this[attrName]||'0x').slice(2);stringValue=(stringValue.length&1?'0':'')+stringValue;var value=new Uint8Array(stringValue.length/2);for(var i=0;i<stringValue.length/2;i++){value[i]=parseInt(stringValue.slice(i*2,i*2+2),16);}return value;}else{return null;}};_proto.hexadecimalIntegerAsNumber=function hexadecimalIntegerAsNumber(attrName){var intValue=parseInt(this[attrName],16);if(intValue>Number.MAX_SAFE_INTEGER){return Infinity;}return intValue;};_proto.decimalFloatingPoint=function decimalFloatingPoint(attrName){return parseFloat(this[attrName]);};_proto.optionalFloat=function optionalFloat(attrName,defaultValue){var value=this[attrName];return value?parseFloat(value):defaultValue;};_proto.enumeratedString=function enumeratedString(attrName){return this[attrName];};_proto.bool=function bool(attrName){return this[attrName]==='YES';};_proto.decimalResolution=function decimalResolution(attrName){var res=DECIMAL_RESOLUTION_REGEX.exec(this[attrName]);if(res===null){return undefined;}return{width:parseInt(res[1],10),height:parseInt(res[2],10)};};AttrList.parseAttrList=function parseAttrList(input){var match;var attrs={};var quote='"';ATTR_LIST_REGEX.lastIndex=0;while((match=ATTR_LIST_REGEX.exec(input))!==null){var value=match[2];if(value.indexOf(quote)===0&&value.lastIndexOf(quote)===value.length-1){value=value.slice(1,-1);}attrs[match[1]]=value;}return attrs;};return AttrList;}();/***/},/***/"./src/utils/binary-search.ts":/*!************************************!*\
			  !*** ./src/utils/binary-search.ts ***!
			  \************************************/ /*! exports provided: default */ /***/function srcUtilsBinarySearchTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var BinarySearch={/**
			   * Searches for an item in an array which matches a certain condition.
			   * This requires the condition to only match one item in the array,
			   * and for the array to be ordered.
			   *
			   * @param {Array<T>} list The array to search.
			   * @param {BinarySearchComparison<T>} comparisonFn
			   *      Called and provided a candidate item as the first argument.
			   *      Should return:
			   *          > -1 if the item should be located at a lower index than the provided item.
			   *          > 1 if the item should be located at a higher index than the provided item.
			   *          > 0 if the item is the item you're looking for.
			   *
			   * @return {T | null} The object if it is found or null otherwise.
			   */search:function search(list,comparisonFn){var minIndex=0;var maxIndex=list.length-1;var currentIndex=null;var currentElement=null;while(minIndex<=maxIndex){currentIndex=(minIndex+maxIndex)/2|0;currentElement=list[currentIndex];var comparisonResult=comparisonFn(currentElement);if(comparisonResult>0){minIndex=currentIndex+1;}else if(comparisonResult<0){maxIndex=currentIndex-1;}else{return currentElement;}}return null;}};/* harmony default export */__webpack_exports__["default"]=BinarySearch;/***/},/***/"./src/utils/buffer-helper.ts":/*!************************************!*\
			  !*** ./src/utils/buffer-helper.ts ***!
			  \************************************/ /*! exports provided: BufferHelper */ /***/function srcUtilsBufferHelperTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"BufferHelper",function(){return BufferHelper;});/* harmony import */var _logger__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./logger */"./src/utils/logger.ts");/**
			 * @module BufferHelper
			 *
			 * Providing methods dealing with buffer length retrieval for example.
			 *
			 * In general, a helper around HTML5 MediaElement TimeRanges gathered from `buffered` property.
			 *
			 * Also @see https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement/buffered
			 */var noopBuffered={length:0,start:function start(){return 0;},end:function end(){return 0;}};var BufferHelper=/*#__PURE__*/function(){function BufferHelper(){}/**
			   * Return true if `media`'s buffered include `position`
			   * @param {Bufferable} media
			   * @param {number} position
			   * @returns {boolean}
			   */BufferHelper.isBuffered=function isBuffered(media,position){try{if(media){var buffered=BufferHelper.getBuffered(media);for(var i=0;i<buffered.length;i++){if(position>=buffered.start(i)&&position<=buffered.end(i)){return true;}}}}catch(error){// this is to catch
// InvalidStateError: Failed to read the 'buffered' property from 'SourceBuffer':
// This SourceBuffer has been removed from the parent media source
}return false;};BufferHelper.bufferInfo=function bufferInfo(media,pos,maxHoleDuration){try{if(media){var vbuffered=BufferHelper.getBuffered(media);var buffered=[];var i;for(i=0;i<vbuffered.length;i++){buffered.push({start:vbuffered.start(i),end:vbuffered.end(i)});}return this.bufferedInfo(buffered,pos,maxHoleDuration);}}catch(error){// this is to catch
// InvalidStateError: Failed to read the 'buffered' property from 'SourceBuffer':
// This SourceBuffer has been removed from the parent media source
}return{len:0,start:pos,end:pos,nextStart:undefined};};BufferHelper.bufferedInfo=function bufferedInfo(buffered,pos,maxHoleDuration){pos=Math.max(0,pos);// sort on buffer.start/smaller end (IE does not always return sorted buffered range)
buffered.sort(function(a,b){var diff=a.start-b.start;if(diff){return diff;}else{return b.end-a.end;}});var buffered2=[];if(maxHoleDuration){// there might be some small holes between buffer time range
// consider that holes smaller than maxHoleDuration are irrelevant and build another
// buffer time range representations that discards those holes
for(var i=0;i<buffered.length;i++){var buf2len=buffered2.length;if(buf2len){var buf2end=buffered2[buf2len-1].end;// if small hole (value between 0 or maxHoleDuration ) or overlapping (negative)
if(buffered[i].start-buf2end<maxHoleDuration){// merge overlapping time ranges
// update lastRange.end only if smaller than item.end
// e.g.  [ 1, 15] with  [ 2,8] => [ 1,15] (no need to modify lastRange.end)
// whereas [ 1, 8] with  [ 2,15] => [ 1,15] ( lastRange should switch from [1,8] to [1,15])
if(buffered[i].end>buf2end){buffered2[buf2len-1].end=buffered[i].end;}}else{// big hole
buffered2.push(buffered[i]);}}else{// first value
buffered2.push(buffered[i]);}}}else{buffered2=buffered;}var bufferLen=0;// bufferStartNext can possibly be undefined based on the conditional logic below
var bufferStartNext;// bufferStart and bufferEnd are buffer boundaries around current video position
var bufferStart=pos;var bufferEnd=pos;for(var _i=0;_i<buffered2.length;_i++){var start=buffered2[_i].start;var end=buffered2[_i].end;// logger.log('buf start/end:' + buffered.start(i) + '/' + buffered.end(i));
if(pos+maxHoleDuration>=start&&pos<end){// play position is inside this buffer TimeRange, retrieve end of buffer position and buffer length
bufferStart=start;bufferEnd=end;bufferLen=bufferEnd-pos;}else if(pos+maxHoleDuration<start){bufferStartNext=start;break;}}return{len:bufferLen,start:bufferStart||0,end:bufferEnd||0,nextStart:bufferStartNext};}/**
			   * Safe method to get buffered property.
			   * SourceBuffer.buffered may throw if SourceBuffer is removed from it's MediaSource
			   */;BufferHelper.getBuffered=function getBuffered(media){try{return media.buffered;}catch(e){_logger__WEBPACK_IMPORTED_MODULE_0__["logger"].log('failed to get media.buffered',e);return noopBuffered;}};return BufferHelper;}();/***/},/***/"./src/utils/cea-608-parser.ts":/*!*************************************!*\
			  !*** ./src/utils/cea-608-parser.ts ***!
			  \*************************************/ /*! exports provided: Row, CaptionScreen, default */ /***/function srcUtilsCea608ParserTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"Row",function(){return Row;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"CaptionScreen",function(){return CaptionScreen;});/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../utils/logger */"./src/utils/logger.ts");/**
			 *
			 * This code was ported from the dash.js project at:
			 *   https://github.com/Dash-Industry-Forum/dash.js/blob/development/externals/cea608-parser.js
			 *   https://github.com/Dash-Industry-Forum/dash.js/commit/8269b26a761e0853bb21d78780ed945144ecdd4d#diff-71bc295a2d6b6b7093a1d3290d53a4b2
			 *
			 * The original copyright appears below:
			 *
			 * The copyright in this software is being made available under the BSD License,
			 * included below. This software may be subject to other third party and contributor
			 * rights, including patent rights, and no such rights are granted under this license.
			 *
			 * Copyright (c) 2015-2016, DASH Industry Forum.
			 * All rights reserved.
			 *
			 * Redistribution and use in source and binary forms, with or without modification,
			 * are permitted provided that the following conditions are met:
			 *  1. Redistributions of source code must retain the above copyright notice, this
			 *  list of conditions and the following disclaimer.
			 *  * Redistributions in binary form must reproduce the above copyright notice,
			 *  this list of conditions and the following disclaimer in the documentation and/or
			 *  other materials provided with the distribution.
			 *  2. Neither the name of Dash Industry Forum nor the names of its
			 *  contributors may be used to endorse or promote products derived from this software
			 *  without specific prior written permission.
			 *
			 *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY
			 *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
			 *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
			 *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
			 *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
			 *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
			 *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
			 *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
			 *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
			 *  POSSIBILITY OF SUCH DAMAGE.
			 */ /**
			 *  Exceptions from regular ASCII. CodePoints are mapped to UTF-16 codes
			 */var specialCea608CharsCodes={0x2a:0xe1,// lowercase a, acute accent
0x5c:0xe9,// lowercase e, acute accent
0x5e:0xed,// lowercase i, acute accent
0x5f:0xf3,// lowercase o, acute accent
0x60:0xfa,// lowercase u, acute accent
0x7b:0xe7,// lowercase c with cedilla
0x7c:0xf7,// division symbol
0x7d:0xd1,// uppercase N tilde
0x7e:0xf1,// lowercase n tilde
0x7f:0x2588,// Full block
// THIS BLOCK INCLUDES THE 16 EXTENDED (TWO-BYTE) LINE 21 CHARACTERS
// THAT COME FROM HI BYTE=0x11 AND LOW BETWEEN 0x30 AND 0x3F
// THIS MEANS THAT \x50 MUST BE ADDED TO THE VALUES
0x80:0xae,// Registered symbol (R)
0x81:0xb0,// degree sign
0x82:0xbd,// 1/2 symbol
0x83:0xbf,// Inverted (open) question mark
0x84:0x2122,// Trademark symbol (TM)
0x85:0xa2,// Cents symbol
0x86:0xa3,// Pounds sterling
0x87:0x266a,// Music 8'th note
0x88:0xe0,// lowercase a, grave accent
0x89:0x20,// transparent space (regular)
0x8a:0xe8,// lowercase e, grave accent
0x8b:0xe2,// lowercase a, circumflex accent
0x8c:0xea,// lowercase e, circumflex accent
0x8d:0xee,// lowercase i, circumflex accent
0x8e:0xf4,// lowercase o, circumflex accent
0x8f:0xfb,// lowercase u, circumflex accent
// THIS BLOCK INCLUDES THE 32 EXTENDED (TWO-BYTE) LINE 21 CHARACTERS
// THAT COME FROM HI BYTE=0x12 AND LOW BETWEEN 0x20 AND 0x3F
0x90:0xc1,// capital letter A with acute
0x91:0xc9,// capital letter E with acute
0x92:0xd3,// capital letter O with acute
0x93:0xda,// capital letter U with acute
0x94:0xdc,// capital letter U with diaresis
0x95:0xfc,// lowercase letter U with diaeresis
0x96:0x2018,// opening single quote
0x97:0xa1,// inverted exclamation mark
0x98:0x2a,// asterisk
0x99:0x2019,// closing single quote
0x9a:0x2501,// box drawings heavy horizontal
0x9b:0xa9,// copyright sign
0x9c:0x2120,// Service mark
0x9d:0x2022,// (round) bullet
0x9e:0x201c,// Left double quotation mark
0x9f:0x201d,// Right double quotation mark
0xa0:0xc0,// uppercase A, grave accent
0xa1:0xc2,// uppercase A, circumflex
0xa2:0xc7,// uppercase C with cedilla
0xa3:0xc8,// uppercase E, grave accent
0xa4:0xca,// uppercase E, circumflex
0xa5:0xcb,// capital letter E with diaresis
0xa6:0xeb,// lowercase letter e with diaresis
0xa7:0xce,// uppercase I, circumflex
0xa8:0xcf,// uppercase I, with diaresis
0xa9:0xef,// lowercase i, with diaresis
0xaa:0xd4,// uppercase O, circumflex
0xab:0xd9,// uppercase U, grave accent
0xac:0xf9,// lowercase u, grave accent
0xad:0xdb,// uppercase U, circumflex
0xae:0xab,// left-pointing double angle quotation mark
0xaf:0xbb,// right-pointing double angle quotation mark
// THIS BLOCK INCLUDES THE 32 EXTENDED (TWO-BYTE) LINE 21 CHARACTERS
// THAT COME FROM HI BYTE=0x13 AND LOW BETWEEN 0x20 AND 0x3F
0xb0:0xc3,// Uppercase A, tilde
0xb1:0xe3,// Lowercase a, tilde
0xb2:0xcd,// Uppercase I, acute accent
0xb3:0xcc,// Uppercase I, grave accent
0xb4:0xec,// Lowercase i, grave accent
0xb5:0xd2,// Uppercase O, grave accent
0xb6:0xf2,// Lowercase o, grave accent
0xb7:0xd5,// Uppercase O, tilde
0xb8:0xf5,// Lowercase o, tilde
0xb9:0x7b,// Open curly brace
0xba:0x7d,// Closing curly brace
0xbb:0x5c,// Backslash
0xbc:0x5e,// Caret
0xbd:0x5f,// Underscore
0xbe:0x7c,// Pipe (vertical line)
0xbf:0x223c,// Tilde operator
0xc0:0xc4,// Uppercase A, umlaut
0xc1:0xe4,// Lowercase A, umlaut
0xc2:0xd6,// Uppercase O, umlaut
0xc3:0xf6,// Lowercase o, umlaut
0xc4:0xdf,// Esszett (sharp S)
0xc5:0xa5,// Yen symbol
0xc6:0xa4,// Generic currency sign
0xc7:0x2503,// Box drawings heavy vertical
0xc8:0xc5,// Uppercase A, ring
0xc9:0xe5,// Lowercase A, ring
0xca:0xd8,// Uppercase O, stroke
0xcb:0xf8,// Lowercase o, strok
0xcc:0x250f,// Box drawings heavy down and right
0xcd:0x2513,// Box drawings heavy down and left
0xce:0x2517,// Box drawings heavy up and right
0xcf:0x251b// Box drawings heavy up and left
};/**
			 * Utils
			 */var getCharForByte=function getCharForByte(_byte){var charCode=_byte;if(specialCea608CharsCodes.hasOwnProperty(_byte)){charCode=specialCea608CharsCodes[_byte];}return String.fromCharCode(charCode);};var NR_ROWS=15;var NR_COLS=100;// Tables to look up row from PAC data
var rowsLowCh1={0x11:1,0x12:3,0x15:5,0x16:7,0x17:9,0x10:11,0x13:12,0x14:14};var rowsHighCh1={0x11:2,0x12:4,0x15:6,0x16:8,0x17:10,0x13:13,0x14:15};var rowsLowCh2={0x19:1,0x1a:3,0x1d:5,0x1e:7,0x1f:9,0x18:11,0x1b:12,0x1c:14};var rowsHighCh2={0x19:2,0x1a:4,0x1d:6,0x1e:8,0x1f:10,0x1b:13,0x1c:15};var backgroundColors=['white','green','blue','cyan','red','yellow','magenta','black','transparent'];var VerboseLevel;(function(VerboseLevel){VerboseLevel[VerboseLevel["ERROR"]=0]="ERROR";VerboseLevel[VerboseLevel["TEXT"]=1]="TEXT";VerboseLevel[VerboseLevel["WARNING"]=2]="WARNING";VerboseLevel[VerboseLevel["INFO"]=2]="INFO";VerboseLevel[VerboseLevel["DEBUG"]=3]="DEBUG";VerboseLevel[VerboseLevel["DATA"]=3]="DATA";})(VerboseLevel||(VerboseLevel={}));var CaptionsLogger=/*#__PURE__*/function(){function CaptionsLogger(){this.time=null;this.verboseLevel=VerboseLevel.ERROR;}var _proto=CaptionsLogger.prototype;_proto.log=function log(severity,msg){if(this.verboseLevel>=severity){_utils_logger__WEBPACK_IMPORTED_MODULE_0__["logger"].log(this.time+" ["+severity+"] "+msg);}};return CaptionsLogger;}();var numArrayToHexArray=function numArrayToHexArray(numArray){var hexArray=[];for(var j=0;j<numArray.length;j++){hexArray.push(numArray[j].toString(16));}return hexArray;};var PenState=/*#__PURE__*/function(){function PenState(foreground,underline,italics,background,flash){this.foreground=void 0;this.underline=void 0;this.italics=void 0;this.background=void 0;this.flash=void 0;this.foreground=foreground||'white';this.underline=underline||false;this.italics=italics||false;this.background=background||'black';this.flash=flash||false;}var _proto2=PenState.prototype;_proto2.reset=function reset(){this.foreground='white';this.underline=false;this.italics=false;this.background='black';this.flash=false;};_proto2.setStyles=function setStyles(styles){var attribs=['foreground','underline','italics','background','flash'];for(var i=0;i<attribs.length;i++){var style=attribs[i];if(styles.hasOwnProperty(style)){this[style]=styles[style];}}};_proto2.isDefault=function isDefault(){return this.foreground==='white'&&!this.underline&&!this.italics&&this.background==='black'&&!this.flash;};_proto2.equals=function equals(other){return this.foreground===other.foreground&&this.underline===other.underline&&this.italics===other.italics&&this.background===other.background&&this.flash===other.flash;};_proto2.copy=function copy(newPenState){this.foreground=newPenState.foreground;this.underline=newPenState.underline;this.italics=newPenState.italics;this.background=newPenState.background;this.flash=newPenState.flash;};_proto2.toString=function toString(){return'color='+this.foreground+', underline='+this.underline+', italics='+this.italics+', background='+this.background+', flash='+this.flash;};return PenState;}();/**
			 * Unicode character with styling and background.
			 * @constructor
			 */var StyledUnicodeChar=/*#__PURE__*/function(){function StyledUnicodeChar(uchar,foreground,underline,italics,background,flash){this.uchar=void 0;this.penState=void 0;this.uchar=uchar||' ';// unicode character
this.penState=new PenState(foreground,underline,italics,background,flash);}var _proto3=StyledUnicodeChar.prototype;_proto3.reset=function reset(){this.uchar=' ';this.penState.reset();};_proto3.setChar=function setChar(uchar,newPenState){this.uchar=uchar;this.penState.copy(newPenState);};_proto3.setPenState=function setPenState(newPenState){this.penState.copy(newPenState);};_proto3.equals=function equals(other){return this.uchar===other.uchar&&this.penState.equals(other.penState);};_proto3.copy=function copy(newChar){this.uchar=newChar.uchar;this.penState.copy(newChar.penState);};_proto3.isEmpty=function isEmpty(){return this.uchar===' '&&this.penState.isDefault();};return StyledUnicodeChar;}();/**
			 * CEA-608 row consisting of NR_COLS instances of StyledUnicodeChar.
			 * @constructor
			 */var Row=/*#__PURE__*/function(){function Row(logger){this.chars=void 0;this.pos=void 0;this.currPenState=void 0;this.cueStartTime=void 0;this.logger=void 0;this.chars=[];for(var i=0;i<NR_COLS;i++){this.chars.push(new StyledUnicodeChar());}this.logger=logger;this.pos=0;this.currPenState=new PenState();}var _proto4=Row.prototype;_proto4.equals=function equals(other){var equal=true;for(var i=0;i<NR_COLS;i++){if(!this.chars[i].equals(other.chars[i])){equal=false;break;}}return equal;};_proto4.copy=function copy(other){for(var i=0;i<NR_COLS;i++){this.chars[i].copy(other.chars[i]);}};_proto4.isEmpty=function isEmpty(){var empty=true;for(var i=0;i<NR_COLS;i++){if(!this.chars[i].isEmpty()){empty=false;break;}}return empty;}/**
			   *  Set the cursor to a valid column.
			   */;_proto4.setCursor=function setCursor(absPos){if(this.pos!==absPos){this.pos=absPos;}if(this.pos<0){this.logger.log(VerboseLevel.DEBUG,'Negative cursor position '+this.pos);this.pos=0;}else if(this.pos>NR_COLS){this.logger.log(VerboseLevel.DEBUG,'Too large cursor position '+this.pos);this.pos=NR_COLS;}}/**
			   * Move the cursor relative to current position.
			   */;_proto4.moveCursor=function moveCursor(relPos){var newPos=this.pos+relPos;if(relPos>1){for(var i=this.pos+1;i<newPos+1;i++){this.chars[i].setPenState(this.currPenState);}}this.setCursor(newPos);}/**
			   * Backspace, move one step back and clear character.
			   */;_proto4.backSpace=function backSpace(){this.moveCursor(-1);this.chars[this.pos].setChar(' ',this.currPenState);};_proto4.insertChar=function insertChar(_byte2){if(_byte2>=0x90){// Extended char
this.backSpace();}var _char=getCharForByte(_byte2);if(this.pos>=NR_COLS){this.logger.log(VerboseLevel.ERROR,'Cannot insert '+_byte2.toString(16)+' ('+_char+') at position '+this.pos+'. Skipping it!');return;}this.chars[this.pos].setChar(_char,this.currPenState);this.moveCursor(1);};_proto4.clearFromPos=function clearFromPos(startPos){var i;for(i=startPos;i<NR_COLS;i++){this.chars[i].reset();}};_proto4.clear=function clear(){this.clearFromPos(0);this.pos=0;this.currPenState.reset();};_proto4.clearToEndOfRow=function clearToEndOfRow(){this.clearFromPos(this.pos);};_proto4.getTextString=function getTextString(){var chars=[];var empty=true;for(var i=0;i<NR_COLS;i++){var _char2=this.chars[i].uchar;if(_char2!==' '){empty=false;}chars.push(_char2);}if(empty){return'';}else{return chars.join('');}};_proto4.setPenStyles=function setPenStyles(styles){this.currPenState.setStyles(styles);var currChar=this.chars[this.pos];currChar.setPenState(this.currPenState);};return Row;}();/**
			 * Keep a CEA-608 screen of 32x15 styled characters
			 * @constructor
			 */var CaptionScreen=/*#__PURE__*/function(){function CaptionScreen(logger){this.rows=void 0;this.currRow=void 0;this.nrRollUpRows=void 0;this.lastOutputScreen=void 0;this.logger=void 0;this.rows=[];for(var i=0;i<NR_ROWS;i++){this.rows.push(new Row(logger));}// Note that we use zero-based numbering (0-14)
this.logger=logger;this.currRow=NR_ROWS-1;this.nrRollUpRows=null;this.lastOutputScreen=null;this.reset();}var _proto5=CaptionScreen.prototype;_proto5.reset=function reset(){for(var i=0;i<NR_ROWS;i++){this.rows[i].clear();}this.currRow=NR_ROWS-1;};_proto5.equals=function equals(other){var equal=true;for(var i=0;i<NR_ROWS;i++){if(!this.rows[i].equals(other.rows[i])){equal=false;break;}}return equal;};_proto5.copy=function copy(other){for(var i=0;i<NR_ROWS;i++){this.rows[i].copy(other.rows[i]);}};_proto5.isEmpty=function isEmpty(){var empty=true;for(var i=0;i<NR_ROWS;i++){if(!this.rows[i].isEmpty()){empty=false;break;}}return empty;};_proto5.backSpace=function backSpace(){var row=this.rows[this.currRow];row.backSpace();};_proto5.clearToEndOfRow=function clearToEndOfRow(){var row=this.rows[this.currRow];row.clearToEndOfRow();}/**
			   * Insert a character (without styling) in the current row.
			   */;_proto5.insertChar=function insertChar(_char3){var row=this.rows[this.currRow];row.insertChar(_char3);};_proto5.setPen=function setPen(styles){var row=this.rows[this.currRow];row.setPenStyles(styles);};_proto5.moveCursor=function moveCursor(relPos){var row=this.rows[this.currRow];row.moveCursor(relPos);};_proto5.setCursor=function setCursor(absPos){this.logger.log(VerboseLevel.INFO,'setCursor: '+absPos);var row=this.rows[this.currRow];row.setCursor(absPos);};_proto5.setPAC=function setPAC(pacData){this.logger.log(VerboseLevel.INFO,'pacData = '+JSON.stringify(pacData));var newRow=pacData.row-1;if(this.nrRollUpRows&&newRow<this.nrRollUpRows-1){newRow=this.nrRollUpRows-1;}// Make sure this only affects Roll-up Captions by checking this.nrRollUpRows
if(this.nrRollUpRows&&this.currRow!==newRow){// clear all rows first
for(var i=0;i<NR_ROWS;i++){this.rows[i].clear();}// Copy this.nrRollUpRows rows from lastOutputScreen and place it in the newRow location
// topRowIndex - the start of rows to copy (inclusive index)
var topRowIndex=this.currRow+1-this.nrRollUpRows;// We only copy if the last position was already shown.
// We use the cueStartTime value to check this.
var lastOutputScreen=this.lastOutputScreen;if(lastOutputScreen){var prevLineTime=lastOutputScreen.rows[topRowIndex].cueStartTime;var time=this.logger.time;if(prevLineTime&&time!==null&&prevLineTime<time){for(var _i=0;_i<this.nrRollUpRows;_i++){this.rows[newRow-this.nrRollUpRows+_i+1].copy(lastOutputScreen.rows[topRowIndex+_i]);}}}}this.currRow=newRow;var row=this.rows[this.currRow];if(pacData.indent!==null){var indent=pacData.indent;var prevPos=Math.max(indent-1,0);row.setCursor(pacData.indent);pacData.color=row.chars[prevPos].penState.foreground;}var styles={foreground:pacData.color,underline:pacData.underline,italics:pacData.italics,background:'black',flash:false};this.setPen(styles);}/**
			   * Set background/extra foreground, but first do back_space, and then insert space (backwards compatibility).
			   */;_proto5.setBkgData=function setBkgData(bkgData){this.logger.log(VerboseLevel.INFO,'bkgData = '+JSON.stringify(bkgData));this.backSpace();this.setPen(bkgData);this.insertChar(0x20);// Space
};_proto5.setRollUpRows=function setRollUpRows(nrRows){this.nrRollUpRows=nrRows;};_proto5.rollUp=function rollUp(){if(this.nrRollUpRows===null){this.logger.log(VerboseLevel.DEBUG,'roll_up but nrRollUpRows not set yet');return;// Not properly setup
}this.logger.log(VerboseLevel.TEXT,this.getDisplayText());var topRowIndex=this.currRow+1-this.nrRollUpRows;var topRow=this.rows.splice(topRowIndex,1)[0];topRow.clear();this.rows.splice(this.currRow,0,topRow);this.logger.log(VerboseLevel.INFO,'Rolling up');// this.logger.log(VerboseLevel.TEXT, this.get_display_text())
}/**
			   * Get all non-empty rows with as unicode text.
			   */;_proto5.getDisplayText=function getDisplayText(asOneRow){asOneRow=asOneRow||false;var displayText=[];var text='';var rowNr=-1;for(var i=0;i<NR_ROWS;i++){var rowText=this.rows[i].getTextString();if(rowText){rowNr=i+1;if(asOneRow){displayText.push('Row '+rowNr+": '"+rowText+"'");}else{displayText.push(rowText.trim());}}}if(displayText.length>0){if(asOneRow){text='['+displayText.join(' | ')+']';}else{text=displayText.join('\n');}}return text;};_proto5.getTextAndFormat=function getTextAndFormat(){return this.rows;};return CaptionScreen;}();// var modes = ['MODE_ROLL-UP', 'MODE_POP-ON', 'MODE_PAINT-ON', 'MODE_TEXT'];
var Cea608Channel=/*#__PURE__*/function(){function Cea608Channel(channelNumber,outputFilter,logger){this.chNr=void 0;this.outputFilter=void 0;this.mode=void 0;this.verbose=void 0;this.displayedMemory=void 0;this.nonDisplayedMemory=void 0;this.lastOutputScreen=void 0;this.currRollUpRow=void 0;this.writeScreen=void 0;this.cueStartTime=void 0;this.logger=void 0;this.chNr=channelNumber;this.outputFilter=outputFilter;this.mode=null;this.verbose=0;this.displayedMemory=new CaptionScreen(logger);this.nonDisplayedMemory=new CaptionScreen(logger);this.lastOutputScreen=new CaptionScreen(logger);this.currRollUpRow=this.displayedMemory.rows[NR_ROWS-1];this.writeScreen=this.displayedMemory;this.mode=null;this.cueStartTime=null;// Keeps track of where a cue started.
this.logger=logger;}var _proto6=Cea608Channel.prototype;_proto6.reset=function reset(){this.mode=null;this.displayedMemory.reset();this.nonDisplayedMemory.reset();this.lastOutputScreen.reset();this.outputFilter.reset();this.currRollUpRow=this.displayedMemory.rows[NR_ROWS-1];this.writeScreen=this.displayedMemory;this.mode=null;this.cueStartTime=null;};_proto6.getHandler=function getHandler(){return this.outputFilter;};_proto6.setHandler=function setHandler(newHandler){this.outputFilter=newHandler;};_proto6.setPAC=function setPAC(pacData){this.writeScreen.setPAC(pacData);};_proto6.setBkgData=function setBkgData(bkgData){this.writeScreen.setBkgData(bkgData);};_proto6.setMode=function setMode(newMode){if(newMode===this.mode){return;}this.mode=newMode;this.logger.log(VerboseLevel.INFO,'MODE='+newMode);if(this.mode==='MODE_POP-ON'){this.writeScreen=this.nonDisplayedMemory;}else{this.writeScreen=this.displayedMemory;this.writeScreen.reset();}if(this.mode!=='MODE_ROLL-UP'){this.displayedMemory.nrRollUpRows=null;this.nonDisplayedMemory.nrRollUpRows=null;}this.mode=newMode;};_proto6.insertChars=function insertChars(chars){for(var i=0;i<chars.length;i++){this.writeScreen.insertChar(chars[i]);}var screen=this.writeScreen===this.displayedMemory?'DISP':'NON_DISP';this.logger.log(VerboseLevel.INFO,screen+': '+this.writeScreen.getDisplayText(true));if(this.mode==='MODE_PAINT-ON'||this.mode==='MODE_ROLL-UP'){this.logger.log(VerboseLevel.TEXT,'DISPLAYED: '+this.displayedMemory.getDisplayText(true));this.outputDataUpdate();}};_proto6.ccRCL=function ccRCL(){// Resume Caption Loading (switch mode to Pop On)
this.logger.log(VerboseLevel.INFO,'RCL - Resume Caption Loading');this.setMode('MODE_POP-ON');};_proto6.ccBS=function ccBS(){// BackSpace
this.logger.log(VerboseLevel.INFO,'BS - BackSpace');if(this.mode==='MODE_TEXT'){return;}this.writeScreen.backSpace();if(this.writeScreen===this.displayedMemory){this.outputDataUpdate();}};_proto6.ccAOF=function ccAOF(){// Reserved (formerly Alarm Off)
};_proto6.ccAON=function ccAON(){// Reserved (formerly Alarm On)
};_proto6.ccDER=function ccDER(){// Delete to End of Row
this.logger.log(VerboseLevel.INFO,'DER- Delete to End of Row');this.writeScreen.clearToEndOfRow();this.outputDataUpdate();};_proto6.ccRU=function ccRU(nrRows){// Roll-Up Captions-2,3,or 4 Rows
this.logger.log(VerboseLevel.INFO,'RU('+nrRows+') - Roll Up');this.writeScreen=this.displayedMemory;this.setMode('MODE_ROLL-UP');this.writeScreen.setRollUpRows(nrRows);};_proto6.ccFON=function ccFON(){// Flash On
this.logger.log(VerboseLevel.INFO,'FON - Flash On');this.writeScreen.setPen({flash:true});};_proto6.ccRDC=function ccRDC(){// Resume Direct Captioning (switch mode to PaintOn)
this.logger.log(VerboseLevel.INFO,'RDC - Resume Direct Captioning');this.setMode('MODE_PAINT-ON');};_proto6.ccTR=function ccTR(){// Text Restart in text mode (not supported, however)
this.logger.log(VerboseLevel.INFO,'TR');this.setMode('MODE_TEXT');};_proto6.ccRTD=function ccRTD(){// Resume Text Display in Text mode (not supported, however)
this.logger.log(VerboseLevel.INFO,'RTD');this.setMode('MODE_TEXT');};_proto6.ccEDM=function ccEDM(){// Erase Displayed Memory
this.logger.log(VerboseLevel.INFO,'EDM - Erase Displayed Memory');this.displayedMemory.reset();this.outputDataUpdate(true);};_proto6.ccCR=function ccCR(){// Carriage Return
this.logger.log(VerboseLevel.INFO,'CR - Carriage Return');this.writeScreen.rollUp();this.outputDataUpdate(true);};_proto6.ccENM=function ccENM(){// Erase Non-Displayed Memory
this.logger.log(VerboseLevel.INFO,'ENM - Erase Non-displayed Memory');this.nonDisplayedMemory.reset();};_proto6.ccEOC=function ccEOC(){// End of Caption (Flip Memories)
this.logger.log(VerboseLevel.INFO,'EOC - End Of Caption');if(this.mode==='MODE_POP-ON'){var tmp=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory;this.nonDisplayedMemory=tmp;this.writeScreen=this.nonDisplayedMemory;this.logger.log(VerboseLevel.TEXT,'DISP: '+this.displayedMemory.getDisplayText());}this.outputDataUpdate(true);};_proto6.ccTO=function ccTO(nrCols){// Tab Offset 1,2, or 3 columns
this.logger.log(VerboseLevel.INFO,'TO('+nrCols+') - Tab Offset');this.writeScreen.moveCursor(nrCols);};_proto6.ccMIDROW=function ccMIDROW(secondByte){// Parse MIDROW command
var styles={flash:false};styles.underline=secondByte%2===1;styles.italics=secondByte>=0x2e;if(!styles.italics){var colorIndex=Math.floor(secondByte/2)-0x10;var colors=['white','green','blue','cyan','red','yellow','magenta'];styles.foreground=colors[colorIndex];}else{styles.foreground='white';}this.logger.log(VerboseLevel.INFO,'MIDROW: '+JSON.stringify(styles));this.writeScreen.setPen(styles);};_proto6.outputDataUpdate=function outputDataUpdate(dispatch){if(dispatch===void 0){dispatch=false;}var time=this.logger.time;if(time===null){return;}if(this.outputFilter){if(this.cueStartTime===null&&!this.displayedMemory.isEmpty()){// Start of a new cue
this.cueStartTime=time;}else{if(!this.displayedMemory.equals(this.lastOutputScreen)){this.outputFilter.newCue(this.cueStartTime,time,this.lastOutputScreen);if(dispatch&&this.outputFilter.dispatchCue){this.outputFilter.dispatchCue();}this.cueStartTime=this.displayedMemory.isEmpty()?null:time;}}this.lastOutputScreen.copy(this.displayedMemory);}};_proto6.cueSplitAtTime=function cueSplitAtTime(t){if(this.outputFilter){if(!this.displayedMemory.isEmpty()){if(this.outputFilter.newCue){this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory);}this.cueStartTime=t;}}};return Cea608Channel;}();var Cea608Parser=/*#__PURE__*/function(){function Cea608Parser(field,out1,out2){this.channels=void 0;this.currentChannel=0;this.cmdHistory=void 0;this.logger=void 0;var logger=new CaptionsLogger();this.channels=[null,new Cea608Channel(field,out1,logger),new Cea608Channel(field+1,out2,logger)];this.cmdHistory=createCmdHistory();this.logger=logger;}var _proto7=Cea608Parser.prototype;_proto7.getHandler=function getHandler(channel){return this.channels[channel].getHandler();};_proto7.setHandler=function setHandler(channel,newHandler){this.channels[channel].setHandler(newHandler);}/**
			   * Add data for time t in forms of list of bytes (unsigned ints). The bytes are treated as pairs.
			   */;_proto7.addData=function addData(time,byteList){var cmdFound;var a;var b;var charsFound=false;this.logger.time=time;for(var i=0;i<byteList.length;i+=2){a=byteList[i]&0x7f;b=byteList[i+1]&0x7f;if(a===0&&b===0){continue;}else{this.logger.log(VerboseLevel.DATA,'['+numArrayToHexArray([byteList[i],byteList[i+1]])+'] -> ('+numArrayToHexArray([a,b])+')');}cmdFound=this.parseCmd(a,b);if(!cmdFound){cmdFound=this.parseMidrow(a,b);}if(!cmdFound){cmdFound=this.parsePAC(a,b);}if(!cmdFound){cmdFound=this.parseBackgroundAttributes(a,b);}if(!cmdFound){charsFound=this.parseChars(a,b);if(charsFound){var currChNr=this.currentChannel;if(currChNr&&currChNr>0){var channel=this.channels[currChNr];channel.insertChars(charsFound);}else{this.logger.log(VerboseLevel.WARNING,'No channel found yet. TEXT-MODE?');}}}if(!cmdFound&&!charsFound){this.logger.log(VerboseLevel.WARNING,"Couldn't parse cleaned data "+numArrayToHexArray([a,b])+' orig: '+numArrayToHexArray([byteList[i],byteList[i+1]]));}}}/**
			   * Parse Command.
			   * @returns {Boolean} Tells if a command was found
			   */;_proto7.parseCmd=function parseCmd(a,b){var cmdHistory=this.cmdHistory;var cond1=(a===0x14||a===0x1c||a===0x15||a===0x1d)&&b>=0x20&&b<=0x2f;var cond2=(a===0x17||a===0x1f)&&b>=0x21&&b<=0x23;if(!(cond1||cond2)){return false;}if(hasCmdRepeated(a,b,cmdHistory)){setLastCmd(null,null,cmdHistory);this.logger.log(VerboseLevel.DEBUG,'Repeated command ('+numArrayToHexArray([a,b])+') is dropped');return true;}var chNr=a===0x14||a===0x15||a===0x17?1:2;var channel=this.channels[chNr];if(a===0x14||a===0x15||a===0x1c||a===0x1d){if(b===0x20){channel.ccRCL();}else if(b===0x21){channel.ccBS();}else if(b===0x22){channel.ccAOF();}else if(b===0x23){channel.ccAON();}else if(b===0x24){channel.ccDER();}else if(b===0x25){channel.ccRU(2);}else if(b===0x26){channel.ccRU(3);}else if(b===0x27){channel.ccRU(4);}else if(b===0x28){channel.ccFON();}else if(b===0x29){channel.ccRDC();}else if(b===0x2a){channel.ccTR();}else if(b===0x2b){channel.ccRTD();}else if(b===0x2c){channel.ccEDM();}else if(b===0x2d){channel.ccCR();}else if(b===0x2e){channel.ccENM();}else if(b===0x2f){channel.ccEOC();}}else{// a == 0x17 || a == 0x1F
channel.ccTO(b-0x20);}setLastCmd(a,b,cmdHistory);this.currentChannel=chNr;return true;}/**
			   * Parse midrow styling command
			   * @returns {Boolean}
			   */;_proto7.parseMidrow=function parseMidrow(a,b){var chNr=0;if((a===0x11||a===0x19)&&b>=0x20&&b<=0x2f){if(a===0x11){chNr=1;}else{chNr=2;}if(chNr!==this.currentChannel){this.logger.log(VerboseLevel.ERROR,'Mismatch channel in midrow parsing');return false;}var channel=this.channels[chNr];if(!channel){return false;}channel.ccMIDROW(b);this.logger.log(VerboseLevel.DEBUG,'MIDROW ('+numArrayToHexArray([a,b])+')');return true;}return false;}/**
			   * Parse Preable Access Codes (Table 53).
			   * @returns {Boolean} Tells if PAC found
			   */;_proto7.parsePAC=function parsePAC(a,b){var row;var cmdHistory=this.cmdHistory;var case1=(a>=0x11&&a<=0x17||a>=0x19&&a<=0x1f)&&b>=0x40&&b<=0x7f;var case2=(a===0x10||a===0x18)&&b>=0x40&&b<=0x5f;if(!(case1||case2)){return false;}if(hasCmdRepeated(a,b,cmdHistory)){setLastCmd(null,null,cmdHistory);return true;// Repeated commands are dropped (once)
}var chNr=a<=0x17?1:2;if(b>=0x40&&b<=0x5f){row=chNr===1?rowsLowCh1[a]:rowsLowCh2[a];}else{// 0x60 <= b <= 0x7F
row=chNr===1?rowsHighCh1[a]:rowsHighCh2[a];}var channel=this.channels[chNr];if(!channel){return false;}channel.setPAC(this.interpretPAC(row,b));setLastCmd(a,b,cmdHistory);this.currentChannel=chNr;return true;}/**
			   * Interpret the second byte of the pac, and return the information.
			   * @returns {Object} pacData with style parameters.
			   */;_proto7.interpretPAC=function interpretPAC(row,_byte3){var pacIndex;var pacData={color:null,italics:false,indent:null,underline:false,row:row};if(_byte3>0x5f){pacIndex=_byte3-0x60;}else{pacIndex=_byte3-0x40;}pacData.underline=(pacIndex&1)===1;if(pacIndex<=0xd){pacData.color=['white','green','blue','cyan','red','yellow','magenta','white'][Math.floor(pacIndex/2)];}else if(pacIndex<=0xf){pacData.italics=true;pacData.color='white';}else{pacData.indent=Math.floor((pacIndex-0x10)/2)*4;}return pacData;// Note that row has zero offset. The spec uses 1.
}/**
			   * Parse characters.
			   * @returns An array with 1 to 2 codes corresponding to chars, if found. null otherwise.
			   */;_proto7.parseChars=function parseChars(a,b){var channelNr;var charCodes=null;var charCode1=null;if(a>=0x19){channelNr=2;charCode1=a-8;}else{channelNr=1;charCode1=a;}if(charCode1>=0x11&&charCode1<=0x13){// Special character
var oneCode;if(charCode1===0x11){oneCode=b+0x50;}else if(charCode1===0x12){oneCode=b+0x70;}else{oneCode=b+0x90;}this.logger.log(VerboseLevel.INFO,"Special char '"+getCharForByte(oneCode)+"' in channel "+channelNr);charCodes=[oneCode];}else if(a>=0x20&&a<=0x7f){charCodes=b===0?[a]:[a,b];}if(charCodes){var hexCodes=numArrayToHexArray(charCodes);this.logger.log(VerboseLevel.DEBUG,'Char codes =  '+hexCodes.join(','));setLastCmd(a,b,this.cmdHistory);}return charCodes;}/**
			   * Parse extended background attributes as well as new foreground color black.
			   * @returns {Boolean} Tells if background attributes are found
			   */;_proto7.parseBackgroundAttributes=function parseBackgroundAttributes(a,b){var case1=(a===0x10||a===0x18)&&b>=0x20&&b<=0x2f;var case2=(a===0x17||a===0x1f)&&b>=0x2d&&b<=0x2f;if(!(case1||case2)){return false;}var index;var bkgData={};if(a===0x10||a===0x18){index=Math.floor((b-0x20)/2);bkgData.background=backgroundColors[index];if(b%2===1){bkgData.background=bkgData.background+'_semi';}}else if(b===0x2d){bkgData.background='transparent';}else{bkgData.foreground='black';if(b===0x2f){bkgData.underline=true;}}var chNr=a<=0x17?1:2;var channel=this.channels[chNr];channel.setBkgData(bkgData);setLastCmd(a,b,this.cmdHistory);return true;}/**
			   * Reset state of parser and its channels.
			   */;_proto7.reset=function reset(){for(var i=0;i<Object.keys(this.channels).length;i++){var channel=this.channels[i];if(channel){channel.reset();}}this.cmdHistory=createCmdHistory();}/**
			   * Trigger the generation of a cue, and the start of a new one if displayScreens are not empty.
			   */;_proto7.cueSplitAtTime=function cueSplitAtTime(t){for(var i=0;i<this.channels.length;i++){var channel=this.channels[i];if(channel){channel.cueSplitAtTime(t);}}};return Cea608Parser;}();function setLastCmd(a,b,cmdHistory){cmdHistory.a=a;cmdHistory.b=b;}function hasCmdRepeated(a,b,cmdHistory){return cmdHistory.a===a&&cmdHistory.b===b;}function createCmdHistory(){return{a:null,b:null};}/* harmony default export */__webpack_exports__["default"]=Cea608Parser;/***/},/***/"./src/utils/codecs.ts":/*!*****************************!*\
			  !*** ./src/utils/codecs.ts ***!
			  \*****************************/ /*! exports provided: isCodecType, isCodecSupportedInMp4 */ /***/function srcUtilsCodecsTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"isCodecType",function(){return isCodecType;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"isCodecSupportedInMp4",function(){return isCodecSupportedInMp4;});// from http://mp4ra.org/codecs.html
var sampleEntryCodesISO={audio:{a3ds:true,'ac-3':true,'ac-4':true,alac:true,alaw:true,dra1:true,'dts+':true,'dts-':true,dtsc:true,dtse:true,dtsh:true,'ec-3':true,enca:true,g719:true,g726:true,m4ae:true,mha1:true,mha2:true,mhm1:true,mhm2:true,mlpa:true,mp4a:true,'raw ':true,Opus:true,samr:true,sawb:true,sawp:true,sevc:true,sqcp:true,ssmv:true,twos:true,ulaw:true},video:{avc1:true,avc2:true,avc3:true,avc4:true,avcp:true,av01:true,drac:true,dvav:true,dvhe:true,encv:true,hev1:true,hvc1:true,mjp2:true,mp4v:true,mvc1:true,mvc2:true,mvc3:true,mvc4:true,resv:true,rv60:true,s263:true,svc1:true,svc2:true,'vc-1':true,vp08:true,vp09:true},text:{stpp:true,wvtt:true}};function isCodecType(codec,type){var typeCodes=sampleEntryCodesISO[type];return!!typeCodes&&typeCodes[codec.slice(0,4)]===true;}function isCodecSupportedInMp4(codec,type){return MediaSource.isTypeSupported((type||'video')+"/mp4;codecs=\""+codec+"\"");}/***/},/***/"./src/utils/cues.ts":/*!***************************!*\
			  !*** ./src/utils/cues.ts ***!
			  \***************************/ /*! exports provided: default */ /***/function srcUtilsCuesTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var _vttparser__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./vttparser */"./src/utils/vttparser.ts");/* harmony import */var _webvtt_parser__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ./webvtt-parser */"./src/utils/webvtt-parser.ts");/* harmony import */var _texttrack_utils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ./texttrack-utils */"./src/utils/texttrack-utils.ts");var WHITESPACE_CHAR=/\s/;var Cues={newCue:function newCue(track,startTime,endTime,captionScreen){var result=[];var row;// the type data states this is VTTCue, but it can potentially be a TextTrackCue on old browsers
var cue;var indenting;var indent;var text;var Cue=self.VTTCue||self.TextTrackCue;for(var r=0;r<captionScreen.rows.length;r++){row=captionScreen.rows[r];indenting=true;indent=0;text='';if(!row.isEmpty()){for(var c=0;c<row.chars.length;c++){if(WHITESPACE_CHAR.test(row.chars[c].uchar)&&indenting){indent++;}else{text+=row.chars[c].uchar;indenting=false;}}// To be used for cleaning-up orphaned roll-up captions
row.cueStartTime=startTime;// Give a slight bump to the endTime if it's equal to startTime to avoid a SyntaxError in IE
if(startTime===endTime){endTime+=0.0001;}if(indent>=16){indent--;}else{indent++;}var cueText=Object(_vttparser__WEBPACK_IMPORTED_MODULE_0__["fixLineBreaks"])(text.trim());var id=Object(_webvtt_parser__WEBPACK_IMPORTED_MODULE_1__["generateCueId"])(startTime,endTime,cueText);// If this cue already exists in the track do not push it
if(!track||!track.cues||!track.cues.getCueById(id)){cue=new Cue(startTime,endTime,cueText);cue.id=id;cue.line=r+1;cue.align='left';// Clamp the position between 10 and 80 percent (CEA-608 PAC indent code)
// https://dvcs.w3.org/hg/text-tracks/raw-file/default/608toVTT/608toVTT.html#positioning-in-cea-608
// Firefox throws an exception and captions break with out of bounds 0-100 values
cue.position=10+Math.min(80,Math.floor(indent*8/32)*10);result.push(cue);}}}if(track&&result.length){// Sort bottom cues in reverse order so that they render in line order when overlapping in Chrome
result.sort(function(cueA,cueB){if(cueA.line==='auto'||cueB.line==='auto'){return 0;}if(cueA.line>8&&cueB.line>8){return cueB.line-cueA.line;}return cueA.line-cueB.line;});result.forEach(function(cue){return Object(_texttrack_utils__WEBPACK_IMPORTED_MODULE_2__["addCueToTrack"])(track,cue);});}return result;}};/* harmony default export */__webpack_exports__["default"]=Cues;/***/},/***/"./src/utils/discontinuities.ts":/*!**************************************!*\
			  !*** ./src/utils/discontinuities.ts ***!
			  \**************************************/ /*! exports provided: findFirstFragWithCC, shouldAlignOnDiscontinuities, findDiscontinuousReferenceFrag, adjustSlidingStart, alignStream, alignPDT, alignFragmentByPDTDelta, alignMediaPlaylistByPDT */ /***/function srcUtilsDiscontinuitiesTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"findFirstFragWithCC",function(){return findFirstFragWithCC;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"shouldAlignOnDiscontinuities",function(){return shouldAlignOnDiscontinuities;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"findDiscontinuousReferenceFrag",function(){return findDiscontinuousReferenceFrag;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"adjustSlidingStart",function(){return adjustSlidingStart;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"alignStream",function(){return alignStream;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"alignPDT",function(){return alignPDT;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"alignFragmentByPDTDelta",function(){return alignFragmentByPDTDelta;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"alignMediaPlaylistByPDT",function(){return alignMediaPlaylistByPDT;});/* harmony import */var _home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./src/polyfills/number */"./src/polyfills/number.ts");/* harmony import */var _logger__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ./logger */"./src/utils/logger.ts");/* harmony import */var _controller_level_helper__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../controller/level-helper */"./src/controller/level-helper.ts");function findFirstFragWithCC(fragments,cc){var firstFrag=null;for(var i=0,len=fragments.length;i<len;i++){var currentFrag=fragments[i];if(currentFrag&&currentFrag.cc===cc){firstFrag=currentFrag;break;}}return firstFrag;}function shouldAlignOnDiscontinuities(lastFrag,lastLevel,details){if(lastLevel.details){if(details.endCC>details.startCC||lastFrag&&lastFrag.cc<details.startCC){return true;}}return false;}// Find the first frag in the previous level which matches the CC of the first frag of the new level
function findDiscontinuousReferenceFrag(prevDetails,curDetails){var prevFrags=prevDetails.fragments;var curFrags=curDetails.fragments;if(!curFrags.length||!prevFrags.length){_logger__WEBPACK_IMPORTED_MODULE_1__["logger"].log('No fragments to align');return;}var prevStartFrag=findFirstFragWithCC(prevFrags,curFrags[0].cc);if(!prevStartFrag||prevStartFrag&&!prevStartFrag.startPTS){_logger__WEBPACK_IMPORTED_MODULE_1__["logger"].log('No frag in previous level to align on');return;}return prevStartFrag;}function adjustFragmentStart(frag,sliding){if(frag){var start=frag.start+sliding;frag.start=frag.startPTS=start;frag.endPTS=start+frag.duration;}}function adjustSlidingStart(sliding,details){// Update segments
var fragments=details.fragments;for(var i=0,len=fragments.length;i<len;i++){adjustFragmentStart(fragments[i],sliding);}// Update LL-HLS parts at the end of the playlist
if(details.fragmentHint){adjustFragmentStart(details.fragmentHint,sliding);}details.alignedSliding=true;}/**
			 * Using the parameters of the last level, this function computes PTS' of the new fragments so that they form a
			 * contiguous stream with the last fragments.
			 * The PTS of a fragment lets Hls.js know where it fits into a stream - by knowing every PTS, we know which fragment to
			 * download at any given time. PTS is normally computed when the fragment is demuxed, so taking this step saves us time
			 * and an extra download.
			 * @param lastFrag
			 * @param lastLevel
			 * @param details
			 */function alignStream(lastFrag,lastLevel,details){if(!lastLevel){return;}alignDiscontinuities(lastFrag,details,lastLevel);if(!details.alignedSliding&&lastLevel.details){// If the PTS wasn't figured out via discontinuity sequence that means there was no CC increase within the level.
// Aligning via Program Date Time should therefore be reliable, since PDT should be the same within the same
// discontinuity sequence.
alignPDT(details,lastLevel.details);}if(!details.alignedSliding&&lastLevel.details&&!details.skippedSegments){// Try to align on sn so that we pick a better start fragment.
// Do not perform this on playlists with delta updates as this is only to align levels on switch
// and adjustSliding only adjusts fragments after skippedSegments.
Object(_controller_level_helper__WEBPACK_IMPORTED_MODULE_2__["adjustSliding"])(lastLevel.details,details);}}/**
			 * Computes the PTS if a new level's fragments using the PTS of a fragment in the last level which shares the same
			 * discontinuity sequence.
			 * @param lastFrag - The last Fragment which shares the same discontinuity sequence
			 * @param lastLevel - The details of the last loaded level
			 * @param details - The details of the new level
			 */function alignDiscontinuities(lastFrag,details,lastLevel){if(shouldAlignOnDiscontinuities(lastFrag,lastLevel,details)){var referenceFrag=findDiscontinuousReferenceFrag(lastLevel.details,details);if(referenceFrag&&Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(referenceFrag.start)){_logger__WEBPACK_IMPORTED_MODULE_1__["logger"].log("Adjusting PTS using last level due to CC increase within current level "+details.url);adjustSlidingStart(referenceFrag.start,details);}}}/**
			 * Computes the PTS of a new level's fragments using the difference in Program Date Time from the last level.
			 * @param details - The details of the new level
			 * @param lastDetails - The details of the last loaded level
			 */function alignPDT(details,lastDetails){// This check protects the unsafe "!" usage below for null program date time access.
if(!lastDetails.fragments.length||!details.hasProgramDateTime||!lastDetails.hasProgramDateTime){return;}// if last level sliding is 1000 and its first frag PROGRAM-DATE-TIME is 2017-08-20 1:10:00 AM
// and if new details first frag PROGRAM DATE-TIME is 2017-08-20 1:10:08 AM
// then we can deduce that playlist B sliding is 1000+8 = 1008s
var lastPDT=lastDetails.fragments[0].programDateTime;// hasProgramDateTime check above makes this safe.
var newPDT=details.fragments[0].programDateTime;// date diff is in ms. frag.start is in seconds
var sliding=(newPDT-lastPDT)/1000+lastDetails.fragments[0].start;if(sliding&&Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(sliding)){_logger__WEBPACK_IMPORTED_MODULE_1__["logger"].log("Adjusting PTS using programDateTime delta "+(newPDT-lastPDT)+"ms, sliding:"+sliding.toFixed(3)+" "+details.url+" ");adjustSlidingStart(sliding,details);}}function alignFragmentByPDTDelta(frag,delta){var programDateTime=frag.programDateTime;if(!programDateTime)return;var start=(programDateTime-delta)/1000;frag.start=frag.startPTS=start;frag.endPTS=start+frag.duration;}/**
			 * Ensures appropriate time-alignment between renditions based on PDT. Unlike `alignPDT`, which adjusts
			 * the timeline based on the delta between PDTs of the 0th fragment of two playlists/`LevelDetails`,
			 * this function assumes the timelines represented in `refDetails` are accurate, including the PDTs,
			 * and uses the "wallclock"/PDT timeline as a cross-reference to `details`, adjusting the presentation
			 * times/timelines of `details` accordingly.
			 * Given the asynchronous nature of fetches and initial loads of live `main` and audio/subtitle tracks,
			 * the primary purpose of this function is to ensure the "local timelines" of audio/subtitle tracks
			 * are aligned to the main/video timeline, using PDT as the cross-reference/"anchor" that should
			 * be consistent across playlists, per the HLS spec.
			 * @param details - The details of the rendition you'd like to time-align (e.g. an audio rendition).
			 * @param refDetails - The details of the reference rendition with start and PDT times for alignment.
			 */function alignMediaPlaylistByPDT(details,refDetails){// This check protects the unsafe "!" usage below for null program date time access.
if(!refDetails.fragments.length||!details.hasProgramDateTime||!refDetails.hasProgramDateTime){return;}var refPDT=refDetails.fragments[0].programDateTime;// hasProgramDateTime check above makes this safe.
var refStart=refDetails.fragments[0].start;// Use the delta between the reference details' presentation timeline's start time and its PDT
// to align the other rendtion's timeline.
var delta=refPDT-refStart*1000;// Per spec: "If any Media Playlist in a Master Playlist contains an EXT-X-PROGRAM-DATE-TIME tag, then all
// Media Playlists in that Master Playlist MUST contain EXT-X-PROGRAM-DATE-TIME tags with consistent mappings
// of date and time to media timestamps."
// So we should be able to use each rendition's PDT as a reference time and use the delta to compute our relevant
// start and end times.
// NOTE: This code assumes each level/details timelines have already been made "internally consistent"
details.fragments.forEach(function(frag){alignFragmentByPDTDelta(frag,delta);});if(details.fragmentHint){alignFragmentByPDTDelta(details.fragmentHint,delta);}details.alignedSliding=true;}/***/},/***/"./src/utils/ewma-bandwidth-estimator.ts":/*!***********************************************!*\
			  !*** ./src/utils/ewma-bandwidth-estimator.ts ***!
			  \***********************************************/ /*! exports provided: default */ /***/function srcUtilsEwmaBandwidthEstimatorTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var _utils_ewma__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../utils/ewma */"./src/utils/ewma.ts");/*
			 * EWMA Bandwidth Estimator
			 *  - heavily inspired from shaka-player
			 * Tracks bandwidth samples and estimates available bandwidth.
			 * Based on the minimum of two exponentially-weighted moving averages with
			 * different half-lives.
			 */var EwmaBandWidthEstimator=/*#__PURE__*/function(){function EwmaBandWidthEstimator(slow,fast,defaultEstimate){this.defaultEstimate_=void 0;this.minWeight_=void 0;this.minDelayMs_=void 0;this.slow_=void 0;this.fast_=void 0;this.defaultEstimate_=defaultEstimate;this.minWeight_=0.001;this.minDelayMs_=50;this.slow_=new _utils_ewma__WEBPACK_IMPORTED_MODULE_0__["default"](slow);this.fast_=new _utils_ewma__WEBPACK_IMPORTED_MODULE_0__["default"](fast);}var _proto=EwmaBandWidthEstimator.prototype;_proto.update=function update(slow,fast){var slow_=this.slow_,fast_=this.fast_;if(this.slow_.halfLife!==slow){this.slow_=new _utils_ewma__WEBPACK_IMPORTED_MODULE_0__["default"](slow,slow_.getEstimate(),slow_.getTotalWeight());}if(this.fast_.halfLife!==fast){this.fast_=new _utils_ewma__WEBPACK_IMPORTED_MODULE_0__["default"](fast,fast_.getEstimate(),fast_.getTotalWeight());}};_proto.sample=function sample(durationMs,numBytes){durationMs=Math.max(durationMs,this.minDelayMs_);var numBits=8*numBytes;// weight is duration in seconds
var durationS=durationMs/1000;// value is bandwidth in bits/s
var bandwidthInBps=numBits/durationS;this.fast_.sample(durationS,bandwidthInBps);this.slow_.sample(durationS,bandwidthInBps);};_proto.canEstimate=function canEstimate(){var fast=this.fast_;return fast&&fast.getTotalWeight()>=this.minWeight_;};_proto.getEstimate=function getEstimate(){if(this.canEstimate()){// console.log('slow estimate:'+ Math.round(this.slow_.getEstimate()));
// console.log('fast estimate:'+ Math.round(this.fast_.getEstimate()));
// Take the minimum of these two estimates.  This should have the effect of
// adapting down quickly, but up more slowly.
return Math.min(this.fast_.getEstimate(),this.slow_.getEstimate());}else{return this.defaultEstimate_;}};_proto.destroy=function destroy(){};return EwmaBandWidthEstimator;}();/* harmony default export */__webpack_exports__["default"]=EwmaBandWidthEstimator;/***/},/***/"./src/utils/ewma.ts":/*!***************************!*\
			  !*** ./src/utils/ewma.ts ***!
			  \***************************/ /*! exports provided: default */ /***/function srcUtilsEwmaTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/*
			 * compute an Exponential Weighted moving average
			 * - https://en.wikipedia.org/wiki/Moving_average#Exponential_moving_average
			 *  - heavily inspired from shaka-player
			 */var EWMA=/*#__PURE__*/function(){//  About half of the estimated value will be from the last |halfLife| samples by weight.
function EWMA(halfLife,estimate,weight){if(estimate===void 0){estimate=0;}if(weight===void 0){weight=0;}this.halfLife=void 0;this.alpha_=void 0;this.estimate_=void 0;this.totalWeight_=void 0;this.halfLife=halfLife;// Larger values of alpha expire historical data more slowly.
this.alpha_=halfLife?Math.exp(Math.log(0.5)/halfLife):0;this.estimate_=estimate;this.totalWeight_=weight;}var _proto=EWMA.prototype;_proto.sample=function sample(weight,value){var adjAlpha=Math.pow(this.alpha_,weight);this.estimate_=value*(1-adjAlpha)+adjAlpha*this.estimate_;this.totalWeight_+=weight;};_proto.getTotalWeight=function getTotalWeight(){return this.totalWeight_;};_proto.getEstimate=function getEstimate(){if(this.alpha_){var zeroFactor=1-Math.pow(this.alpha_,this.totalWeight_);if(zeroFactor){return this.estimate_/zeroFactor;}}return this.estimate_;};return EWMA;}();/* harmony default export */__webpack_exports__["default"]=EWMA;/***/},/***/"./src/utils/fetch-loader.ts":/*!***********************************!*\
			  !*** ./src/utils/fetch-loader.ts ***!
			  \***********************************/ /*! exports provided: fetchSupported, default */ /***/function srcUtilsFetchLoaderTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"fetchSupported",function(){return fetchSupported;});/* harmony import */var _home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./src/polyfills/number */"./src/polyfills/number.ts");/* harmony import */var _loader_load_stats__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../loader/load-stats */"./src/loader/load-stats.ts");/* harmony import */var _demux_chunk_cache__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../demux/chunk-cache */"./src/demux/chunk-cache.ts");function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype);subClass.prototype.constructor=subClass;_setPrototypeOf(subClass,superClass);}function _wrapNativeSuper(Class){var _cache=typeof Map==="function"?new Map():undefined;_wrapNativeSuper=function _wrapNativeSuper(Class){if(Class===null||!_isNativeFunction(Class))return Class;if(typeof Class!=="function"){throw new TypeError("Super expression must either be null or a function");}if(typeof _cache!=="undefined"){if(_cache.has(Class))return _cache.get(Class);_cache.set(Class,Wrapper);}function Wrapper(){return _construct(Class,arguments,_getPrototypeOf(this).constructor);}Wrapper.prototype=Object.create(Class.prototype,{constructor:{value:Wrapper,enumerable:false,writable:true,configurable:true}});return _setPrototypeOf(Wrapper,Class);};return _wrapNativeSuper(Class);}function _construct(Parent,args,Class){if(_isNativeReflectConstruct()){_construct=Reflect.construct;}else{_construct=function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var Constructor=Function.bind.apply(Parent,a);var instance=new Constructor();if(Class)_setPrototypeOf(instance,Class.prototype);return instance;};}return _construct.apply(null,arguments);}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}function _isNativeFunction(fn){return Function.toString.call(fn).indexOf("[native code]")!==-1;}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf(o);}function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};return _extends.apply(this,arguments);}function fetchSupported(){if(// @ts-ignore
self.fetch&&self.AbortController&&self.ReadableStream&&self.Request){try{new self.ReadableStream({});// eslint-disable-line no-new
return true;}catch(e){/* noop */}}return false;}var FetchLoader=/*#__PURE__*/function(){function FetchLoader(config/* HlsConfig */){this.fetchSetup=void 0;this.requestTimeout=void 0;this.request=void 0;this.response=void 0;this.controller=void 0;this.context=void 0;this.config=null;this.callbacks=null;this.stats=void 0;this.loader=null;this.fetchSetup=config.fetchSetup||getRequest;this.controller=new self.AbortController();this.stats=new _loader_load_stats__WEBPACK_IMPORTED_MODULE_1__["LoadStats"]();}var _proto=FetchLoader.prototype;_proto.destroy=function destroy(){this.loader=this.callbacks=null;this.abortInternal();};_proto.abortInternal=function abortInternal(){var response=this.response;if(!response||!response.ok){this.stats.aborted=true;this.controller.abort();}};_proto.abort=function abort(){var _this$callbacks;this.abortInternal();if((_this$callbacks=this.callbacks)!==null&&_this$callbacks!==void 0&&_this$callbacks.onAbort){this.callbacks.onAbort(this.stats,this.context,this.response);}};_proto.load=function load(context,config,callbacks){var _this=this;var stats=this.stats;if(stats.loading.start){throw new Error('Loader can only be used once.');}stats.loading.start=self.performance.now();var initParams=getRequestParameters(context,this.controller.signal);var onProgress=callbacks.onProgress;var isArrayBuffer=context.responseType==='arraybuffer';var LENGTH=isArrayBuffer?'byteLength':'length';this.context=context;this.config=config;this.callbacks=callbacks;this.request=this.fetchSetup(context,initParams);self.clearTimeout(this.requestTimeout);this.requestTimeout=self.setTimeout(function(){_this.abortInternal();callbacks.onTimeout(stats,context,_this.response);},config.timeout);self.fetch(this.request).then(function(response){_this.response=_this.loader=response;if(!response.ok){var status=response.status,statusText=response.statusText;throw new FetchError(statusText||'fetch, bad network response',status,response);}stats.loading.first=Math.max(self.performance.now(),stats.loading.start);stats.total=parseInt(response.headers.get('Content-Length')||'0');if(onProgress&&Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(config.highWaterMark)){return _this.loadProgressively(response,stats,context,config.highWaterMark,onProgress);}if(isArrayBuffer){return response.arrayBuffer();}return response.text();}).then(function(responseData){var response=_this.response;self.clearTimeout(_this.requestTimeout);stats.loading.end=Math.max(self.performance.now(),stats.loading.first);stats.loaded=stats.total=responseData[LENGTH];var loaderResponse={url:response.url,data:responseData};if(onProgress&&!Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(config.highWaterMark)){onProgress(stats,context,responseData,response);}callbacks.onSuccess(loaderResponse,stats,context,response);}).catch(function(error){self.clearTimeout(_this.requestTimeout);if(stats.aborted){return;}// CORS errors result in an undefined code. Set it to 0 here to align with XHR's behavior
var code=error.code||0;callbacks.onError({code:code,text:error.message},context,error.details);});};_proto.getCacheAge=function getCacheAge(){var result=null;if(this.response){var ageHeader=this.response.headers.get('age');result=ageHeader?parseFloat(ageHeader):null;}return result;};_proto.loadProgressively=function loadProgressively(response,stats,context,highWaterMark,onProgress){if(highWaterMark===void 0){highWaterMark=0;}var chunkCache=new _demux_chunk_cache__WEBPACK_IMPORTED_MODULE_2__["default"]();var reader=response.body.getReader();var pump=function pump(){return reader.read().then(function(data){if(data.done){if(chunkCache.dataLength){onProgress(stats,context,chunkCache.flush(),response);}return Promise.resolve(new ArrayBuffer(0));}var chunk=data.value;var len=chunk.length;stats.loaded+=len;if(len<highWaterMark||chunkCache.dataLength){// The current chunk is too small to to be emitted or the cache already has data
// Push it to the cache
chunkCache.push(chunk);if(chunkCache.dataLength>=highWaterMark){// flush in order to join the typed arrays
onProgress(stats,context,chunkCache.flush(),response);}}else{// If there's nothing cached already, and the chache is large enough
// just emit the progress event
onProgress(stats,context,chunk,response);}return pump();}).catch(function(){/* aborted */return Promise.reject();});};return pump();};return FetchLoader;}();function getRequestParameters(context,signal){var initParams={method:'GET',mode:'cors',credentials:'same-origin',signal:signal,headers:new self.Headers(_extends({},context.headers))};if(context.rangeEnd){initParams.headers.set('Range','bytes='+context.rangeStart+'-'+String(context.rangeEnd-1));}return initParams;}function getRequest(context,initParams){return new self.Request(context.url,initParams);}var FetchError=/*#__PURE__*/function(_Error){_inheritsLoose(FetchError,_Error);function FetchError(message,code,details){var _this2;_this2=_Error.call(this,message)||this;_this2.code=void 0;_this2.details=void 0;_this2.code=code;_this2.details=details;return _this2;}return FetchError;}(/*#__PURE__*/_wrapNativeSuper(Error));/* harmony default export */__webpack_exports__["default"]=FetchLoader;/***/},/***/"./src/utils/imsc1-ttml-parser.ts":/*!****************************************!*\
			  !*** ./src/utils/imsc1-ttml-parser.ts ***!
			  \****************************************/ /*! exports provided: IMSC1_CODEC, parseIMSC1 */ /***/function srcUtilsImsc1TtmlParserTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"IMSC1_CODEC",function(){return IMSC1_CODEC;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"parseIMSC1",function(){return parseIMSC1;});/* harmony import */var _mp4_tools__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./mp4-tools */"./src/utils/mp4-tools.ts");/* harmony import */var _vttparser__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ./vttparser */"./src/utils/vttparser.ts");/* harmony import */var _vttcue__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ./vttcue */"./src/utils/vttcue.ts");/* harmony import */var _demux_id3__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ../demux/id3 */"./src/demux/id3.ts");/* harmony import */var _timescale_conversion__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(/*! ./timescale-conversion */"./src/utils/timescale-conversion.ts");/* harmony import */var _webvtt_parser__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(/*! ./webvtt-parser */"./src/utils/webvtt-parser.ts");function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};return _extends.apply(this,arguments);}var IMSC1_CODEC='stpp.ttml.im1t';// Time format: h:m:s:frames(.subframes)
var HMSF_REGEX=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/;// Time format: hours, minutes, seconds, milliseconds, frames, ticks
var TIME_UNIT_REGEX=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/;var textAlignToLineAlign={left:'start',center:'center',right:'end',start:'start',end:'end'};function parseIMSC1(payload,initPTS,timescale,callBack,errorCallBack){var results=Object(_mp4_tools__WEBPACK_IMPORTED_MODULE_0__["findBox"])(new Uint8Array(payload),['mdat']);if(results.length===0){errorCallBack(new Error('Could not parse IMSC1 mdat'));return;}var mdat=results[0];var ttml=Object(_demux_id3__WEBPACK_IMPORTED_MODULE_3__["utf8ArrayToStr"])(new Uint8Array(payload,mdat.start,mdat.end-mdat.start));var syncTime=Object(_timescale_conversion__WEBPACK_IMPORTED_MODULE_4__["toTimescaleFromScale"])(initPTS,1,timescale);try{callBack(parseTTML(ttml,syncTime));}catch(error){errorCallBack(error);}}function parseTTML(ttml,syncTime){var parser=new DOMParser();var xmlDoc=parser.parseFromString(ttml,'text/xml');var tt=xmlDoc.getElementsByTagName('tt')[0];if(!tt){throw new Error('Invalid ttml');}var defaultRateInfo={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0};var rateInfo=Object.keys(defaultRateInfo).reduce(function(result,key){result[key]=tt.getAttribute("ttp:"+key)||defaultRateInfo[key];return result;},{});var trim=tt.getAttribute('xml:space')!=='preserve';var styleElements=collectionToDictionary(getElementCollection(tt,'styling','style'));var regionElements=collectionToDictionary(getElementCollection(tt,'layout','region'));var cueElements=getElementCollection(tt,'body','[begin]');return[].map.call(cueElements,function(cueElement){var cueText=getTextContent(cueElement,trim);if(!cueText||!cueElement.hasAttribute('begin')){return null;}var startTime=parseTtmlTime(cueElement.getAttribute('begin'),rateInfo);var duration=parseTtmlTime(cueElement.getAttribute('dur'),rateInfo);var endTime=parseTtmlTime(cueElement.getAttribute('end'),rateInfo);if(startTime===null){throw timestampParsingError(cueElement);}if(endTime===null){if(duration===null){throw timestampParsingError(cueElement);}endTime=startTime+duration;}var cue=new _vttcue__WEBPACK_IMPORTED_MODULE_2__["default"](startTime-syncTime,endTime-syncTime,cueText);cue.id=Object(_webvtt_parser__WEBPACK_IMPORTED_MODULE_5__["generateCueId"])(cue.startTime,cue.endTime,cue.text);var region=regionElements[cueElement.getAttribute('region')];var style=styleElements[cueElement.getAttribute('style')];// TODO: Add regions to track and cue (origin and extend)
// These values are hard-coded (for now) to simulate region settings in the demo
cue.position=10;cue.size=80;// Apply styles to cue
var styles=getTtmlStyles(region,style);var textAlign=styles.textAlign;if(textAlign){// cue.positionAlign not settable in FF~2016
var lineAlign=textAlignToLineAlign[textAlign];if(lineAlign){cue.lineAlign=lineAlign;}cue.align=textAlign;}_extends(cue,styles);return cue;}).filter(function(cue){return cue!==null;});}function getElementCollection(fromElement,parentName,childName){var parent=fromElement.getElementsByTagName(parentName)[0];if(parent){return[].slice.call(parent.querySelectorAll(childName));}return[];}function collectionToDictionary(elementsWithId){return elementsWithId.reduce(function(dict,element){var id=element.getAttribute('xml:id');if(id){dict[id]=element;}return dict;},{});}function getTextContent(element,trim){return[].slice.call(element.childNodes).reduce(function(str,node,i){var _node$childNodes;if(node.nodeName==='br'&&i){return str+'\n';}if((_node$childNodes=node.childNodes)!==null&&_node$childNodes!==void 0&&_node$childNodes.length){return getTextContent(node,trim);}else if(trim){return str+node.textContent.trim().replace(/\s+/g,' ');}return str+node.textContent;},'');}function getTtmlStyles(region,style){var ttsNs='http://www.w3.org/ns/ttml#styling';var styleAttributes=['displayAlign','textAlign','color','backgroundColor','fontSize','fontFamily'// 'fontWeight',
// 'lineHeight',
// 'wrapOption',
// 'fontStyle',
// 'direction',
// 'writingMode'
];return styleAttributes.reduce(function(styles,name){var value=getAttributeNS(style,ttsNs,name)||getAttributeNS(region,ttsNs,name);if(value){styles[name]=value;}return styles;},{});}function getAttributeNS(element,ns,name){return element.hasAttributeNS(ns,name)?element.getAttributeNS(ns,name):null;}function timestampParsingError(node){return new Error("Could not parse ttml timestamp "+node);}function parseTtmlTime(timeAttributeValue,rateInfo){if(!timeAttributeValue){return null;}var seconds=Object(_vttparser__WEBPACK_IMPORTED_MODULE_1__["parseTimeStamp"])(timeAttributeValue);if(seconds===null){if(HMSF_REGEX.test(timeAttributeValue)){seconds=parseHoursMinutesSecondsFrames(timeAttributeValue,rateInfo);}else if(TIME_UNIT_REGEX.test(timeAttributeValue)){seconds=parseTimeUnits(timeAttributeValue,rateInfo);}}return seconds;}function parseHoursMinutesSecondsFrames(timeAttributeValue,rateInfo){var m=HMSF_REGEX.exec(timeAttributeValue);var frames=(m[4]|0)+(m[5]|0)/rateInfo.subFrameRate;return(m[1]|0)*3600+(m[2]|0)*60+(m[3]|0)+frames/rateInfo.frameRate;}function parseTimeUnits(timeAttributeValue,rateInfo){var m=TIME_UNIT_REGEX.exec(timeAttributeValue);var value=Number(m[1]);var unit=m[2];switch(unit){case'h':return value*3600;case'm':return value*60;case'ms':return value*1000;case'f':return value/rateInfo.frameRate;case't':return value/rateInfo.tickRate;}return value;}/***/},/***/"./src/utils/logger.ts":/*!*****************************!*\
			  !*** ./src/utils/logger.ts ***!
			  \*****************************/ /*! exports provided: enableLogs, logger */ /***/function srcUtilsLoggerTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"enableLogs",function(){return enableLogs;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"logger",function(){return logger;});var noop=function noop(){};var fakeLogger={trace:noop,debug:noop,log:noop,warn:noop,info:noop,error:noop};var exportedLogger=fakeLogger;// let lastCallTime;
// function formatMsgWithTimeInfo(type, msg) {
//   const now = Date.now();
//   const diff = lastCallTime ? '+' + (now - lastCallTime) : '0';
//   lastCallTime = now;
//   msg = (new Date(now)).toISOString() + ' | [' +  type + '] > ' + msg + ' ( ' + diff + ' ms )';
//   return msg;
// }
function consolePrintFn(type){var func=self.console[type];if(func){return func.bind(self.console,"["+type+"] >");}return noop;}function exportLoggerFunctions(debugConfig){for(var _len=arguments.length,functions=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){functions[_key-1]=arguments[_key];}functions.forEach(function(type){exportedLogger[type]=debugConfig[type]?debugConfig[type].bind(debugConfig):consolePrintFn(type);});}function enableLogs(debugConfig){// check that console is available
if(self.console&&debugConfig===true||_typeof3(debugConfig)==='object'){exportLoggerFunctions(debugConfig,// Remove out from list here to hard-disable a log-level
// 'trace',
'debug','log','info','warn','error');// Some browsers don't allow to use bind on console object anyway
// fallback to default if needed
try{exportedLogger.log();}catch(e){exportedLogger=fakeLogger;}}else{exportedLogger=fakeLogger;}}var logger=exportedLogger;/***/},/***/"./src/utils/mediakeys-helper.ts":/*!***************************************!*\
			  !*** ./src/utils/mediakeys-helper.ts ***!
			  \***************************************/ /*! exports provided: KeySystems, requestMediaKeySystemAccess */ /***/function srcUtilsMediakeysHelperTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"KeySystems",function(){return KeySystems;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"requestMediaKeySystemAccess",function(){return requestMediaKeySystemAccess;});/**
			 * @see https://developer.mozilla.org/en-US/docs/Web/API/Navigator/requestMediaKeySystemAccess
			 */var KeySystems;(function(KeySystems){KeySystems["WIDEVINE"]="com.widevine.alpha";KeySystems["PLAYREADY"]="com.microsoft.playready";})(KeySystems||(KeySystems={}));var requestMediaKeySystemAccess=function(){if(typeof self!=='undefined'&&self.navigator&&self.navigator.requestMediaKeySystemAccess){return self.navigator.requestMediaKeySystemAccess.bind(self.navigator);}else{return null;}}();/***/},/***/"./src/utils/mediasource-helper.ts":/*!*****************************************!*\
			  !*** ./src/utils/mediasource-helper.ts ***!
			  \*****************************************/ /*! exports provided: getMediaSource */ /***/function srcUtilsMediasourceHelperTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"getMediaSource",function(){return getMediaSource;});/**
			 * MediaSource helper
			 */function getMediaSource(){return self.MediaSource||self.WebKitMediaSource;}/***/},/***/"./src/utils/mp4-tools.ts":/*!********************************!*\
			  !*** ./src/utils/mp4-tools.ts ***!
			  \********************************/ /*! exports provided: bin2str, readUint16, readUint32, writeUint32, findBox, parseSegmentIndex, parseInitSegment, getStartDTS, getDuration, computeRawDurationFromSamples, offsetStartDTS, segmentValidRange, appendUint8Array */ /***/function srcUtilsMp4ToolsTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"bin2str",function(){return bin2str;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"readUint16",function(){return readUint16;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"readUint32",function(){return readUint32;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"writeUint32",function(){return writeUint32;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"findBox",function(){return findBox;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"parseSegmentIndex",function(){return parseSegmentIndex;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"parseInitSegment",function(){return parseInitSegment;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"getStartDTS",function(){return getStartDTS;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"getDuration",function(){return getDuration;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"computeRawDurationFromSamples",function(){return computeRawDurationFromSamples;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"offsetStartDTS",function(){return offsetStartDTS;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"segmentValidRange",function(){return segmentValidRange;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"appendUint8Array",function(){return appendUint8Array;});/* harmony import */var _typed_array__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./typed-array */"./src/utils/typed-array.ts");/* harmony import */var _loader_fragment__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../loader/fragment */"./src/loader/fragment.ts");var UINT32_MAX=Math.pow(2,32)-1;var push=[].push;function bin2str(data){return String.fromCharCode.apply(null,data);}function readUint16(buffer,offset){if('data'in buffer){offset+=buffer.start;buffer=buffer.data;}var val=buffer[offset]<<8|buffer[offset+1];return val<0?65536+val:val;}function readUint32(buffer,offset){if('data'in buffer){offset+=buffer.start;buffer=buffer.data;}var val=buffer[offset]<<24|buffer[offset+1]<<16|buffer[offset+2]<<8|buffer[offset+3];return val<0?4294967296+val:val;}function writeUint32(buffer,offset,value){if('data'in buffer){offset+=buffer.start;buffer=buffer.data;}buffer[offset]=value>>24;buffer[offset+1]=value>>16&0xff;buffer[offset+2]=value>>8&0xff;buffer[offset+3]=value&0xff;}// Find the data for a box specified by its path
function findBox(input,path){var results=[];if(!path.length){// short-circuit the search for empty paths
return results;}var data;var start;var end;if('data'in input){data=input.data;start=input.start;end=input.end;}else{data=input;start=0;end=data.byteLength;}for(var i=start;i<end;){var size=readUint32(data,i);var type=bin2str(data.subarray(i+4,i+8));var endbox=size>1?i+size:end;if(type===path[0]){if(path.length===1){// this is the end of the path and we've found the box we were
// looking for
results.push({data:data,start:i+8,end:endbox});}else{// recursively search for the next box along the path
var subresults=findBox({data:data,start:i+8,end:endbox},path.slice(1));if(subresults.length){push.apply(results,subresults);}}}i=endbox;}// we've finished searching all of data
return results;}function parseSegmentIndex(initSegment){var moovBox=findBox(initSegment,['moov']);var moov=moovBox[0];var moovEndOffset=moov?moov.end:null;// we need this in case we need to chop of garbage of the end of current data
var sidxBox=findBox(initSegment,['sidx']);if(!sidxBox||!sidxBox[0]){return null;}var references=[];var sidx=sidxBox[0];var version=sidx.data[0];// set initial offset, we skip the reference ID (not needed)
var index=version===0?8:16;var timescale=readUint32(sidx,index);index+=4;// TODO: parse earliestPresentationTime and firstOffset
// usually zero in our case
var earliestPresentationTime=0;var firstOffset=0;if(version===0){index+=8;}else{index+=16;}// skip reserved
index+=2;var startByte=sidx.end+firstOffset;var referencesCount=readUint16(sidx,index);index+=2;for(var i=0;i<referencesCount;i++){var referenceIndex=index;var referenceInfo=readUint32(sidx,referenceIndex);referenceIndex+=4;var referenceSize=referenceInfo&0x7fffffff;var referenceType=(referenceInfo&0x80000000)>>>31;if(referenceType===1){// eslint-disable-next-line no-console
console.warn('SIDX has hierarchical references (not supported)');return null;}var subsegmentDuration=readUint32(sidx,referenceIndex);referenceIndex+=4;references.push({referenceSize:referenceSize,subsegmentDuration:subsegmentDuration,// unscaled
info:{duration:subsegmentDuration/timescale,start:startByte,end:startByte+referenceSize-1}});startByte+=referenceSize;// Skipping 1 bit for |startsWithSap|, 3 bits for |sapType|, and 28 bits
// for |sapDelta|.
referenceIndex+=4;// skip to next ref
index=referenceIndex;}return{earliestPresentationTime:earliestPresentationTime,timescale:timescale,version:version,referencesCount:referencesCount,references:references,moovEndOffset:moovEndOffset};}/**
			 * Parses an MP4 initialization segment and extracts stream type and
			 * timescale values for any declared tracks. Timescale values indicate the
			 * number of clock ticks per second to assume for time-based values
			 * elsewhere in the MP4.
			 *
			 * To determine the start time of an MP4, you need two pieces of
			 * information: the timescale unit and the earliest base media decode
			 * time. Multiple timescales can be specified within an MP4 but the
			 * base media decode time is always expressed in the timescale from
			 * the media header box for the track:
			 * ```
			 * moov > trak > mdia > mdhd.timescale
			 * moov > trak > mdia > hdlr
			 * ```
			 * @param initSegment {Uint8Array} the bytes of the init segment
			 * @return {InitData} a hash of track type to timescale values or null if
			 * the init segment is malformed.
			 */function parseInitSegment(initSegment){var result=[];var traks=findBox(initSegment,['moov','trak']);for(var i=0;i<traks.length;i++){var trak=traks[i];var tkhd=findBox(trak,['tkhd'])[0];if(tkhd){var version=tkhd.data[tkhd.start];var _index=version===0?12:20;var trackId=readUint32(tkhd,_index);var mdhd=findBox(trak,['mdia','mdhd'])[0];if(mdhd){version=mdhd.data[mdhd.start];_index=version===0?12:20;var timescale=readUint32(mdhd,_index);var hdlr=findBox(trak,['mdia','hdlr'])[0];if(hdlr){var hdlrType=bin2str(hdlr.data.subarray(hdlr.start+8,hdlr.start+12));var type={soun:_loader_fragment__WEBPACK_IMPORTED_MODULE_1__["ElementaryStreamTypes"].AUDIO,vide:_loader_fragment__WEBPACK_IMPORTED_MODULE_1__["ElementaryStreamTypes"].VIDEO}[hdlrType];if(type){// Parse codec details
var stsd=findBox(trak,['mdia','minf','stbl','stsd'])[0];var codec=void 0;if(stsd){codec=bin2str(stsd.data.subarray(stsd.start+12,stsd.start+16));// TODO: Parse codec details to be able to build MIME type.
// stsd.start += 8;
// const codecBox = findBox(stsd, [codec])[0];
// if (codecBox) {
//   TODO: Codec parsing support for avc1, mp4a, hevc, av01...
// }
}result[trackId]={timescale:timescale,type:type};result[type]={timescale:timescale,id:trackId,codec:codec};}}}}}var trex=findBox(initSegment,['moov','mvex','trex']);trex.forEach(function(trex){var trackId=readUint32(trex,4);var track=result[trackId];if(track){track.default={duration:readUint32(trex,12),flags:readUint32(trex,20)};}});return result;}/**
			 * Determine the base media decode start time, in seconds, for an MP4
			 * fragment. If multiple fragments are specified, the earliest time is
			 * returned.
			 *
			 * The base media decode time can be parsed from track fragment
			 * metadata:
			 * ```
			 * moof > traf > tfdt.baseMediaDecodeTime
			 * ```
			 * It requires the timescale value from the mdhd to interpret.
			 *
			 * @param initData {InitData} a hash of track type to timescale values
			 * @param fmp4 {Uint8Array} the bytes of the mp4 fragment
			 * @return {number} the earliest base media decode start time for the
			 * fragment, in seconds
			 */function getStartDTS(initData,fmp4){// we need info from two children of each track fragment box
return findBox(fmp4,['moof','traf']).reduce(function(result,traf){var tfdt=findBox(traf,['tfdt'])[0];var version=tfdt.data[tfdt.start];var start=findBox(traf,['tfhd']).reduce(function(result,tfhd){// get the track id from the tfhd
var id=readUint32(tfhd,4);var track=initData[id];if(track){var baseTime=readUint32(tfdt,4);if(version===1){baseTime*=Math.pow(2,32);baseTime+=readUint32(tfdt,8);}// assume a 90kHz clock if no timescale was specified
var scale=track.timescale||90e3;// convert base time to seconds
var startTime=baseTime/scale;if(isFinite(startTime)&&(result===null||startTime<result)){return startTime;}}return result;},null);if(start!==null&&isFinite(start)&&(result===null||start<result)){return start;}return result;},null)||0;}/*
			  For Reference:
			  aligned(8) class TrackFragmentHeaderBox
			           extends FullBox(‘tfhd’, 0, tf_flags){
			     unsigned int(32)  track_ID;
			     // all the following are optional fields
			     unsigned int(64)  base_data_offset;
			     unsigned int(32)  sample_description_index;
			     unsigned int(32)  default_sample_duration;
			     unsigned int(32)  default_sample_size;
			     unsigned int(32)  default_sample_flags
			  }
			 */function getDuration(data,initData){var rawDuration=0;var videoDuration=0;var audioDuration=0;var trafs=findBox(data,['moof','traf']);for(var i=0;i<trafs.length;i++){var traf=trafs[i];// There is only one tfhd & trun per traf
// This is true for CMAF style content, and we should perhaps check the ftyp
// and only look for a single trun then, but for ISOBMFF we should check
// for multiple track runs.
var tfhd=findBox(traf,['tfhd'])[0];// get the track id from the tfhd
var id=readUint32(tfhd,4);var track=initData[id];if(!track){continue;}var trackDefault=track.default;var tfhdFlags=readUint32(tfhd,0)|(trackDefault===null||trackDefault===void 0?void 0:trackDefault.flags);var sampleDuration=trackDefault===null||trackDefault===void 0?void 0:trackDefault.duration;if(tfhdFlags&0x000008){// 0x000008 indicates the presence of the default_sample_duration field
if(tfhdFlags&0x000002){// 0x000002 indicates the presence of the sample_description_index field, which precedes default_sample_duration
// If present, the default_sample_duration exists at byte offset 12
sampleDuration=readUint32(tfhd,12);}else{// Otherwise, the duration is at byte offset 8
sampleDuration=readUint32(tfhd,8);}}// assume a 90kHz clock if no timescale was specified
var timescale=track.timescale||90e3;var truns=findBox(traf,['trun']);for(var j=0;j<truns.length;j++){rawDuration=computeRawDurationFromSamples(truns[j]);if(!rawDuration&&sampleDuration){var sampleCount=readUint32(truns[j],4);rawDuration=sampleDuration*sampleCount;}if(track.type===_loader_fragment__WEBPACK_IMPORTED_MODULE_1__["ElementaryStreamTypes"].VIDEO){videoDuration+=rawDuration/timescale;}else if(track.type===_loader_fragment__WEBPACK_IMPORTED_MODULE_1__["ElementaryStreamTypes"].AUDIO){audioDuration+=rawDuration/timescale;}}}if(videoDuration===0&&audioDuration===0){// If duration samples are not available in the traf use sidx subsegment_duration
var sidx=parseSegmentIndex(data);if(sidx!==null&&sidx!==void 0&&sidx.references){return sidx.references.reduce(function(dur,ref){return dur+ref.info.duration||0;},0);}}if(videoDuration){return videoDuration;}return audioDuration;}/*
			  For Reference:
			  aligned(8) class TrackRunBox
			           extends FullBox(‘trun’, version, tr_flags) {
			     unsigned int(32)  sample_count;
			     // the following are optional fields
			     signed int(32) data_offset;
			     unsigned int(32)  first_sample_flags;
			     // all fields in the following array are optional
			     {
			        unsigned int(32)  sample_duration;
			        unsigned int(32)  sample_size;
			        unsigned int(32)  sample_flags
			        if (version == 0)
			           { unsigned int(32)
			        else
			           { signed int(32)
			     }[ sample_count ]
			  }
			 */function computeRawDurationFromSamples(trun){var flags=readUint32(trun,0);// Flags are at offset 0, non-optional sample_count is at offset 4. Therefore we start 8 bytes in.
// Each field is an int32, which is 4 bytes
var offset=8;// data-offset-present flag
if(flags&0x000001){offset+=4;}// first-sample-flags-present flag
if(flags&0x000004){offset+=4;}var duration=0;var sampleCount=readUint32(trun,4);for(var i=0;i<sampleCount;i++){// sample-duration-present flag
if(flags&0x000100){var sampleDuration=readUint32(trun,offset);duration+=sampleDuration;offset+=4;}// sample-size-present flag
if(flags&0x000200){offset+=4;}// sample-flags-present flag
if(flags&0x000400){offset+=4;}// sample-composition-time-offsets-present flag
if(flags&0x000800){offset+=4;}}return duration;}function offsetStartDTS(initData,fmp4,timeOffset){findBox(fmp4,['moof','traf']).forEach(function(traf){findBox(traf,['tfhd']).forEach(function(tfhd){// get the track id from the tfhd
var id=readUint32(tfhd,4);var track=initData[id];if(!track){return;}// assume a 90kHz clock if no timescale was specified
var timescale=track.timescale||90e3;// get the base media decode time from the tfdt
findBox(traf,['tfdt']).forEach(function(tfdt){var version=tfdt.data[tfdt.start];var baseMediaDecodeTime=readUint32(tfdt,4);if(version===0){writeUint32(tfdt,4,baseMediaDecodeTime-timeOffset*timescale);}else{baseMediaDecodeTime*=Math.pow(2,32);baseMediaDecodeTime+=readUint32(tfdt,8);baseMediaDecodeTime-=timeOffset*timescale;baseMediaDecodeTime=Math.max(baseMediaDecodeTime,0);var upper=Math.floor(baseMediaDecodeTime/(UINT32_MAX+1));var lower=Math.floor(baseMediaDecodeTime%(UINT32_MAX+1));writeUint32(tfdt,4,upper);writeUint32(tfdt,8,lower);}});});});}// TODO: Check if the last moof+mdat pair is part of the valid range
function segmentValidRange(data){var segmentedRange={valid:null,remainder:null};var moofs=findBox(data,['moof']);if(!moofs){return segmentedRange;}else if(moofs.length<2){segmentedRange.remainder=data;return segmentedRange;}var last=moofs[moofs.length-1];// Offset by 8 bytes; findBox offsets the start by as much
segmentedRange.valid=Object(_typed_array__WEBPACK_IMPORTED_MODULE_0__["sliceUint8"])(data,0,last.start-8);segmentedRange.remainder=Object(_typed_array__WEBPACK_IMPORTED_MODULE_0__["sliceUint8"])(data,last.start-8);return segmentedRange;}function appendUint8Array(data1,data2){var temp=new Uint8Array(data1.length+data2.length);temp.set(data1);temp.set(data2,data1.length);return temp;}/***/},/***/"./src/utils/output-filter.ts":/*!************************************!*\
			  !*** ./src/utils/output-filter.ts ***!
			  \************************************/ /*! exports provided: default */ /***/function srcUtilsOutputFilterTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"default",function(){return OutputFilter;});var OutputFilter=/*#__PURE__*/function(){function OutputFilter(timelineController,trackName){this.timelineController=void 0;this.cueRanges=[];this.trackName=void 0;this.startTime=null;this.endTime=null;this.screen=null;this.timelineController=timelineController;this.trackName=trackName;}var _proto=OutputFilter.prototype;_proto.dispatchCue=function dispatchCue(){if(this.startTime===null){return;}this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges);this.startTime=null;};_proto.newCue=function newCue(startTime,endTime,screen){if(this.startTime===null||this.startTime>startTime){this.startTime=startTime;}this.endTime=endTime;this.screen=screen;this.timelineController.createCaptionsTrack(this.trackName);};_proto.reset=function reset(){this.cueRanges=[];this.startTime=null;};return OutputFilter;}();/***/},/***/"./src/utils/texttrack-utils.ts":/*!**************************************!*\
			  !*** ./src/utils/texttrack-utils.ts ***!
			  \**************************************/ /*! exports provided: sendAddTrackEvent, addCueToTrack, clearCurrentCues, removeCuesInRange, getCuesInRange */ /***/function srcUtilsTexttrackUtilsTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"sendAddTrackEvent",function(){return sendAddTrackEvent;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"addCueToTrack",function(){return addCueToTrack;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"clearCurrentCues",function(){return clearCurrentCues;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"removeCuesInRange",function(){return removeCuesInRange;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"getCuesInRange",function(){return getCuesInRange;});/* harmony import */var _logger__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./logger */"./src/utils/logger.ts");function sendAddTrackEvent(track,videoEl){var event;try{event=new Event('addtrack');}catch(err){// for IE11
event=document.createEvent('Event');event.initEvent('addtrack',false,false);}event.track=track;videoEl.dispatchEvent(event);}function addCueToTrack(track,cue){// Sometimes there are cue overlaps on segmented vtts so the same
// cue can appear more than once in different vtt files.
// This avoid showing duplicated cues with same timecode and text.
var mode=track.mode;if(mode==='disabled'){track.mode='hidden';}if(track.cues&&!track.cues.getCueById(cue.id)){try{track.addCue(cue);if(!track.cues.getCueById(cue.id)){throw new Error("addCue is failed for: "+cue);}}catch(err){_logger__WEBPACK_IMPORTED_MODULE_0__["logger"].debug("[texttrack-utils]: "+err);var textTrackCue=new self.TextTrackCue(cue.startTime,cue.endTime,cue.text);textTrackCue.id=cue.id;track.addCue(textTrackCue);}}if(mode==='disabled'){track.mode=mode;}}function clearCurrentCues(track){// When track.mode is disabled, track.cues will be null.
// To guarantee the removal of cues, we need to temporarily
// change the mode to hidden
var mode=track.mode;if(mode==='disabled'){track.mode='hidden';}if(track.cues){for(var i=track.cues.length;i--;){track.removeCue(track.cues[i]);}}if(mode==='disabled'){track.mode=mode;}}function removeCuesInRange(track,start,end){var mode=track.mode;if(mode==='disabled'){track.mode='hidden';}if(track.cues&&track.cues.length>0){var cues=getCuesInRange(track.cues,start,end);for(var i=0;i<cues.length;i++){track.removeCue(cues[i]);}}if(mode==='disabled'){track.mode=mode;}}// Find first cue starting after given time.
// Modified version of binary search O(log(n)).
function getFirstCueIndexAfterTime(cues,time){// If first cue starts after time, start there
if(time<cues[0].startTime){return 0;}// If the last cue ends before time there is no overlap
var len=cues.length-1;if(time>cues[len].endTime){return-1;}var left=0;var right=len;while(left<=right){var mid=Math.floor((right+left)/2);if(time<cues[mid].startTime){right=mid-1;}else if(time>cues[mid].startTime&&left<len){left=mid+1;}else{// If it's not lower or higher, it must be equal.
return mid;}}// At this point, left and right have swapped.
// No direct match was found, left or right element must be the closest. Check which one has the smallest diff.
return cues[left].startTime-time<time-cues[right].startTime?left:right;}function getCuesInRange(cues,start,end){var cuesFound=[];var firstCueInRange=getFirstCueIndexAfterTime(cues,start);if(firstCueInRange>-1){for(var i=firstCueInRange,len=cues.length;i<len;i++){var cue=cues[i];if(cue.startTime>=start&&cue.endTime<=end){cuesFound.push(cue);}else if(cue.startTime>end){return cuesFound;}}}return cuesFound;}/***/},/***/"./src/utils/time-ranges.ts":/*!**********************************!*\
			  !*** ./src/utils/time-ranges.ts ***!
			  \**********************************/ /*! exports provided: default */ /***/function srcUtilsTimeRangesTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/**
			 *  TimeRanges to string helper
			 */var TimeRanges={toString:function toString(r){var log='';var len=r.length;for(var i=0;i<len;i++){log+='['+r.start(i).toFixed(3)+','+r.end(i).toFixed(3)+']';}return log;}};/* harmony default export */__webpack_exports__["default"]=TimeRanges;/***/},/***/"./src/utils/timescale-conversion.ts":/*!*******************************************!*\
			  !*** ./src/utils/timescale-conversion.ts ***!
			  \*******************************************/ /*! exports provided: toTimescaleFromBase, toTimescaleFromScale, toMsFromMpegTsClock, toMpegTsClockFromTimescale */ /***/function srcUtilsTimescaleConversionTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"toTimescaleFromBase",function(){return toTimescaleFromBase;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"toTimescaleFromScale",function(){return toTimescaleFromScale;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"toMsFromMpegTsClock",function(){return toMsFromMpegTsClock;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"toMpegTsClockFromTimescale",function(){return toMpegTsClockFromTimescale;});var MPEG_TS_CLOCK_FREQ_HZ=90000;function toTimescaleFromBase(value,destScale,srcBase,round){if(srcBase===void 0){srcBase=1;}if(round===void 0){round=false;}var result=value*destScale*srcBase;// equivalent to `(value * scale) / (1 / base)`
return round?Math.round(result):result;}function toTimescaleFromScale(value,destScale,srcScale,round){if(srcScale===void 0){srcScale=1;}if(round===void 0){round=false;}return toTimescaleFromBase(value,destScale,1/srcScale,round);}function toMsFromMpegTsClock(value,round){if(round===void 0){round=false;}return toTimescaleFromBase(value,1000,1/MPEG_TS_CLOCK_FREQ_HZ,round);}function toMpegTsClockFromTimescale(value,srcScale){if(srcScale===void 0){srcScale=1;}return toTimescaleFromBase(value,MPEG_TS_CLOCK_FREQ_HZ,1/srcScale);}/***/},/***/"./src/utils/typed-array.ts":/*!**********************************!*\
			  !*** ./src/utils/typed-array.ts ***!
			  \**********************************/ /*! exports provided: sliceUint8 */ /***/function srcUtilsTypedArrayTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"sliceUint8",function(){return sliceUint8;});function sliceUint8(array,start,end){// @ts-expect-error This polyfills IE11 usage of Uint8Array slice.
// It always exists in the TypeScript definition so fails, but it fails at runtime on IE11.
return Uint8Array.prototype.slice?array.slice(start,end):new Uint8Array(Array.prototype.slice.call(array,start,end));}/***/},/***/"./src/utils/vttcue.ts":/*!*****************************!*\
			  !*** ./src/utils/vttcue.ts ***!
			  \*****************************/ /*! exports provided: default */ /***/function srcUtilsVttcueTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/**
			 * Copyright 2013 vtt.js Contributors
			 *
			 * Licensed under the Apache License, Version 2.0 (the 'License');
			 * you may not use this file except in compliance with the License.
			 * You may obtain a copy of the License at
			 *
			 *   http://www.apache.org/licenses/LICENSE-2.0
			 *
			 * Unless required by applicable law or agreed to in writing, software
			 * distributed under the License is distributed on an 'AS IS' BASIS,
			 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
			 * See the License for the specific language governing permissions and
			 * limitations under the License.
			 */ /* harmony default export */__webpack_exports__["default"]=function(){if(typeof self!=='undefined'&&self.VTTCue){return self.VTTCue;}var AllowedDirections=['','lr','rl'];var AllowedAlignments=['start','middle','end','left','right'];function isAllowedValue(allowed,value){if(typeof value!=='string'){return false;}// necessary for assuring the generic conforms to the Array interface
if(!Array.isArray(allowed)){return false;}// reset the type so that the next narrowing works well
var lcValue=value.toLowerCase();// use the allow list to narrow the type to a specific subset of strings
if(~allowed.indexOf(lcValue)){return lcValue;}return false;}function findDirectionSetting(value){return isAllowedValue(AllowedDirections,value);}function findAlignSetting(value){return isAllowedValue(AllowedAlignments,value);}function extend(obj){for(var _len=arguments.length,rest=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){rest[_key-1]=arguments[_key];}var i=1;for(;i<arguments.length;i++){var cobj=arguments[i];for(var p in cobj){obj[p]=cobj[p];}}return obj;}function VTTCue(startTime,endTime,text){var cue=this;var baseObj={enumerable:true};/**
			     * Shim implementation specific properties. These properties are not in
			     * the spec.
			     */ // Lets us know when the VTTCue's data has changed in such a way that we need
// to recompute its display state. This lets us compute its display state
// lazily.
cue.hasBeenReset=false;/**
			     * VTTCue and TextTrackCue properties
			     * http://dev.w3.org/html5/webvtt/#vttcue-interface
			     */var _id='';var _pauseOnExit=false;var _startTime=startTime;var _endTime=endTime;var _text=text;var _region=null;var _vertical='';var _snapToLines=true;var _line='auto';var _lineAlign='start';var _position=50;var _positionAlign='middle';var _size=50;var _align='middle';Object.defineProperty(cue,'id',extend({},baseObj,{get:function get(){return _id;},set:function set(value){_id=''+value;}}));Object.defineProperty(cue,'pauseOnExit',extend({},baseObj,{get:function get(){return _pauseOnExit;},set:function set(value){_pauseOnExit=!!value;}}));Object.defineProperty(cue,'startTime',extend({},baseObj,{get:function get(){return _startTime;},set:function set(value){if(typeof value!=='number'){throw new TypeError('Start time must be set to a number.');}_startTime=value;this.hasBeenReset=true;}}));Object.defineProperty(cue,'endTime',extend({},baseObj,{get:function get(){return _endTime;},set:function set(value){if(typeof value!=='number'){throw new TypeError('End time must be set to a number.');}_endTime=value;this.hasBeenReset=true;}}));Object.defineProperty(cue,'text',extend({},baseObj,{get:function get(){return _text;},set:function set(value){_text=''+value;this.hasBeenReset=true;}}));// todo: implement VTTRegion polyfill?
Object.defineProperty(cue,'region',extend({},baseObj,{get:function get(){return _region;},set:function set(value){_region=value;this.hasBeenReset=true;}}));Object.defineProperty(cue,'vertical',extend({},baseObj,{get:function get(){return _vertical;},set:function set(value){var setting=findDirectionSetting(value);// Have to check for false because the setting an be an empty string.
if(setting===false){throw new SyntaxError('An invalid or illegal string was specified.');}_vertical=setting;this.hasBeenReset=true;}}));Object.defineProperty(cue,'snapToLines',extend({},baseObj,{get:function get(){return _snapToLines;},set:function set(value){_snapToLines=!!value;this.hasBeenReset=true;}}));Object.defineProperty(cue,'line',extend({},baseObj,{get:function get(){return _line;},set:function set(value){if(typeof value!=='number'&&value!=='auto'){throw new SyntaxError('An invalid number or illegal string was specified.');}_line=value;this.hasBeenReset=true;}}));Object.defineProperty(cue,'lineAlign',extend({},baseObj,{get:function get(){return _lineAlign;},set:function set(value){var setting=findAlignSetting(value);if(!setting){throw new SyntaxError('An invalid or illegal string was specified.');}_lineAlign=setting;this.hasBeenReset=true;}}));Object.defineProperty(cue,'position',extend({},baseObj,{get:function get(){return _position;},set:function set(value){if(value<0||value>100){throw new Error('Position must be between 0 and 100.');}_position=value;this.hasBeenReset=true;}}));Object.defineProperty(cue,'positionAlign',extend({},baseObj,{get:function get(){return _positionAlign;},set:function set(value){var setting=findAlignSetting(value);if(!setting){throw new SyntaxError('An invalid or illegal string was specified.');}_positionAlign=setting;this.hasBeenReset=true;}}));Object.defineProperty(cue,'size',extend({},baseObj,{get:function get(){return _size;},set:function set(value){if(value<0||value>100){throw new Error('Size must be between 0 and 100.');}_size=value;this.hasBeenReset=true;}}));Object.defineProperty(cue,'align',extend({},baseObj,{get:function get(){return _align;},set:function set(value){var setting=findAlignSetting(value);if(!setting){throw new SyntaxError('An invalid or illegal string was specified.');}_align=setting;this.hasBeenReset=true;}}));/**
			     * Other <track> spec defined properties
			     */ // http://www.whatwg.org/specs/web-apps/current-work/multipage/the-video-element.html#text-track-cue-display-state
cue.displayState=undefined;}/**
			   * VTTCue methods
			   */VTTCue.prototype.getCueAsHTML=function(){// Assume WebVTT.convertCueToDOMTree is on the global.
var WebVTT=self.WebVTT;return WebVTT.convertCueToDOMTree(self,this.text);};// this is a polyfill hack
return VTTCue;}();/***/},/***/"./src/utils/vttparser.ts":/*!********************************!*\
			  !*** ./src/utils/vttparser.ts ***!
			  \********************************/ /*! exports provided: parseTimeStamp, fixLineBreaks, VTTParser */ /***/function srcUtilsVttparserTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"parseTimeStamp",function(){return parseTimeStamp;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"fixLineBreaks",function(){return fixLineBreaks;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"VTTParser",function(){return VTTParser;});/* harmony import */var _vttcue__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./vttcue */"./src/utils/vttcue.ts");/*
			 * Source: https://github.com/mozilla/vtt.js/blob/master/dist/vtt.js
			 */var StringDecoder=/*#__PURE__*/function(){function StringDecoder(){}var _proto=StringDecoder.prototype;// eslint-disable-next-line @typescript-eslint/no-unused-vars
_proto.decode=function decode(data,options){if(!data){return'';}if(typeof data!=='string'){throw new Error('Error - expected string data.');}return decodeURIComponent(encodeURIComponent(data));};return StringDecoder;}();// Try to parse input as a time stamp.
function parseTimeStamp(input){function computeSeconds(h,m,s,f){return(h|0)*3600+(m|0)*60+(s|0)+parseFloat(f||0);}var m=input.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);if(!m){return null;}if(parseFloat(m[2])>59){// Timestamp takes the form of [hours]:[minutes].[milliseconds]
// First position is hours as it's over 59.
return computeSeconds(m[2],m[3],0,m[4]);}// Timestamp takes the form of [hours (optional)]:[minutes]:[seconds].[milliseconds]
return computeSeconds(m[1],m[2],m[3],m[4]);}// A settings object holds key/value pairs and will ignore anything but the first
// assignment to a specific key.
var Settings=/*#__PURE__*/function(){function Settings(){this.values=Object.create(null);}var _proto2=Settings.prototype;// Only accept the first assignment to any key.
_proto2.set=function set(k,v){if(!this.get(k)&&v!==''){this.values[k]=v;}}// Return the value for a key, or a default value.
// If 'defaultKey' is passed then 'dflt' is assumed to be an object with
// a number of possible default values as properties where 'defaultKey' is
// the key of the property that will be chosen; otherwise it's assumed to be
// a single value.
;_proto2.get=function get(k,dflt,defaultKey){if(defaultKey){return this.has(k)?this.values[k]:dflt[defaultKey];}return this.has(k)?this.values[k]:dflt;}// Check whether we have a value for a key.
;_proto2.has=function has(k){return k in this.values;}// Accept a setting if its one of the given alternatives.
;_proto2.alt=function alt(k,v,a){for(var n=0;n<a.length;++n){if(v===a[n]){this.set(k,v);break;}}}// Accept a setting if its a valid (signed) integer.
;_proto2.integer=function integer(k,v){if(/^-?\d+$/.test(v)){// integer
this.set(k,parseInt(v,10));}}// Accept a setting if its a valid percentage.
;_proto2.percent=function percent(k,v){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(v)){var percent=parseFloat(v);if(percent>=0&&percent<=100){this.set(k,percent);return true;}}return false;};return Settings;}();// Helper function to parse input into groups separated by 'groupDelim', and
// interpret each group as a key/value pair separated by 'keyValueDelim'.
function parseOptions(input,callback,keyValueDelim,groupDelim){var groups=groupDelim?input.split(groupDelim):[input];for(var i in groups){if(typeof groups[i]!=='string'){continue;}var kv=groups[i].split(keyValueDelim);if(kv.length!==2){continue;}var _k=kv[0];var _v=kv[1];callback(_k,_v);}}var defaults=new _vttcue__WEBPACK_IMPORTED_MODULE_0__["default"](0,0,'');// 'middle' was changed to 'center' in the spec: https://github.com/w3c/webvtt/pull/244
//  Safari doesn't yet support this change, but FF and Chrome do.
var center=defaults.align==='middle'?'middle':'center';function parseCue(input,cue,regionList){// Remember the original input if we need to throw an error.
var oInput=input;// 4.1 WebVTT timestamp
function consumeTimeStamp(){var ts=parseTimeStamp(input);if(ts===null){throw new Error('Malformed timestamp: '+oInput);}// Remove time stamp from input.
input=input.replace(/^[^\sa-zA-Z-]+/,'');return ts;}// 4.4.2 WebVTT cue settings
function consumeCueSettings(input,cue){var settings=new Settings();parseOptions(input,function(k,v){var vals;switch(k){case'region':// Find the last region we parsed with the same region id.
for(var i=regionList.length-1;i>=0;i--){if(regionList[i].id===v){settings.set(k,regionList[i].region);break;}}break;case'vertical':settings.alt(k,v,['rl','lr']);break;case'line':vals=v.split(',');settings.integer(k,vals[0]);if(settings.percent(k,vals[0])){settings.set('snapToLines',false);}settings.alt(k,vals[0],['auto']);if(vals.length===2){settings.alt('lineAlign',vals[1],['start',center,'end']);}break;case'position':vals=v.split(',');settings.percent(k,vals[0]);if(vals.length===2){settings.alt('positionAlign',vals[1],['start',center,'end','line-left','line-right','auto']);}break;case'size':settings.percent(k,v);break;case'align':settings.alt(k,v,['start',center,'end','left','right']);break;}},/:/,/\s/);// Apply default values for any missing fields.
cue.region=settings.get('region',null);cue.vertical=settings.get('vertical','');var line=settings.get('line','auto');if(line==='auto'&&defaults.line===-1){// set numeric line number for Safari
line=-1;}cue.line=line;cue.lineAlign=settings.get('lineAlign','start');cue.snapToLines=settings.get('snapToLines',true);cue.size=settings.get('size',100);cue.align=settings.get('align',center);var position=settings.get('position','auto');if(position==='auto'&&defaults.position===50){// set numeric position for Safari
position=cue.align==='start'||cue.align==='left'?0:cue.align==='end'||cue.align==='right'?100:50;}cue.position=position;}function skipWhitespace(){input=input.replace(/^\s+/,'');}// 4.1 WebVTT cue timings.
skipWhitespace();cue.startTime=consumeTimeStamp();// (1) collect cue start time
skipWhitespace();if(input.substr(0,3)!=='-->'){// (3) next characters must match '-->'
throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+oInput);}input=input.substr(3);skipWhitespace();cue.endTime=consumeTimeStamp();// (5) collect cue end time
// 4.1 WebVTT cue settings list.
skipWhitespace();consumeCueSettings(input,cue);}function fixLineBreaks(input){return input.replace(/<br(?: \/)?>/gi,'\n');}var VTTParser=/*#__PURE__*/function(){function VTTParser(){this.state='INITIAL';this.buffer='';this.decoder=new StringDecoder();this.regionList=[];this.cue=null;this.oncue=void 0;this.onparsingerror=void 0;this.onflush=void 0;}var _proto3=VTTParser.prototype;_proto3.parse=function parse(data){var _this=this;// If there is no data then we won't decode it, but will just try to parse
// whatever is in buffer already. This may occur in circumstances, for
// example when flush() is called.
if(data){// Try to decode the data that we received.
_this.buffer+=_this.decoder.decode(data,{stream:true});}function collectNextLine(){var buffer=_this.buffer;var pos=0;buffer=fixLineBreaks(buffer);while(pos<buffer.length&&buffer[pos]!=='\r'&&buffer[pos]!=='\n'){++pos;}var line=buffer.substr(0,pos);// Advance the buffer early in case we fail below.
if(buffer[pos]==='\r'){++pos;}if(buffer[pos]==='\n'){++pos;}_this.buffer=buffer.substr(pos);return line;}// 3.2 WebVTT metadata header syntax
function parseHeader(input){parseOptions(input,function(k,v){// switch (k) {
// case 'region':
// 3.3 WebVTT region metadata header syntax
// console.log('parse region', v);
// parseRegion(v);
// break;
// }
},/:/);}// 5.1 WebVTT file parsing.
try{var line='';if(_this.state==='INITIAL'){// We can't start parsing until we have the first line.
if(!/\r\n|\n/.test(_this.buffer)){return this;}line=collectNextLine();// strip of UTF-8 BOM if any
// https://en.wikipedia.org/wiki/Byte_order_mark#UTF-8
var m=line.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!m||!m[0]){throw new Error('Malformed WebVTT signature.');}_this.state='HEADER';}var alreadyCollectedLine=false;while(_this.buffer){// We can't parse a line until we have the full line.
if(!/\r\n|\n/.test(_this.buffer)){return this;}if(!alreadyCollectedLine){line=collectNextLine();}else{alreadyCollectedLine=false;}switch(_this.state){case'HEADER':// 13-18 - Allow a header (metadata) under the WEBVTT line.
if(/:/.test(line)){parseHeader(line);}else if(!line){// An empty line terminates the header and starts the body (cues).
_this.state='ID';}continue;case'NOTE':// Ignore NOTE blocks.
if(!line){_this.state='ID';}continue;case'ID':// Check for the start of NOTE blocks.
if(/^NOTE($|[ \t])/.test(line)){_this.state='NOTE';break;}// 19-29 - Allow any number of line terminators, then initialize new cue values.
if(!line){continue;}_this.cue=new _vttcue__WEBPACK_IMPORTED_MODULE_0__["default"](0,0,'');_this.state='CUE';// 30-39 - Check if self line contains an optional identifier or timing data.
if(line.indexOf('-->')===-1){_this.cue.id=line;continue;}// Process line as start of a cue.
/* falls through */case'CUE':// 40 - Collect cue timings and settings.
if(!_this.cue){_this.state='BADCUE';continue;}try{parseCue(line,_this.cue,_this.regionList);}catch(e){// In case of an error ignore rest of the cue.
_this.cue=null;_this.state='BADCUE';continue;}_this.state='CUETEXT';continue;case'CUETEXT':{var hasSubstring=line.indexOf('-->')!==-1;// 34 - If we have an empty line then report the cue.
// 35 - If we have the special substring '-->' then report the cue,
// but do not collect the line as we need to process the current
// one as a new cue.
if(!line||hasSubstring&&(alreadyCollectedLine=true)){// We are done parsing self cue.
if(_this.oncue&&_this.cue){_this.oncue(_this.cue);}_this.cue=null;_this.state='ID';continue;}if(_this.cue===null){continue;}if(_this.cue.text){_this.cue.text+='\n';}_this.cue.text+=line;}continue;case'BADCUE':// 54-62 - Collect and discard the remaining cue.
if(!line){_this.state='ID';}}}}catch(e){// If we are currently parsing a cue, report what we have.
if(_this.state==='CUETEXT'&&_this.cue&&_this.oncue){_this.oncue(_this.cue);}_this.cue=null;// Enter BADWEBVTT state if header was not parsed correctly otherwise
// another exception occurred so enter BADCUE state.
_this.state=_this.state==='INITIAL'?'BADWEBVTT':'BADCUE';}return this;};_proto3.flush=function flush(){var _this=this;try{// Finish decoding the stream.
// _this.buffer += _this.decoder.decode();
// Synthesize the end of the current cue or region.
if(_this.cue||_this.state==='HEADER'){_this.buffer+='\n\n';_this.parse();}// If we've flushed, parsed, and we're still on the INITIAL state then
// that means we don't have enough of the stream to parse the first
// line.
if(_this.state==='INITIAL'||_this.state==='BADWEBVTT'){throw new Error('Malformed WebVTT signature.');}}catch(e){if(_this.onparsingerror){_this.onparsingerror(e);}}if(_this.onflush){_this.onflush();}return this;};return VTTParser;}();/***/},/***/"./src/utils/webvtt-parser.ts":/*!************************************!*\
			  !*** ./src/utils/webvtt-parser.ts ***!
			  \************************************/ /*! exports provided: generateCueId, parseWebVTT */ /***/function srcUtilsWebvttParserTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"generateCueId",function(){return generateCueId;});/* harmony export (binding) */__webpack_require__.d(__webpack_exports__,"parseWebVTT",function(){return parseWebVTT;});/* harmony import */var _home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ./src/polyfills/number */"./src/polyfills/number.ts");/* harmony import */var _vttparser__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ./vttparser */"./src/utils/vttparser.ts");/* harmony import */var _demux_id3__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(/*! ../demux/id3 */"./src/demux/id3.ts");/* harmony import */var _timescale_conversion__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(/*! ./timescale-conversion */"./src/utils/timescale-conversion.ts");/* harmony import */var _remux_mp4_remuxer__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(/*! ../remux/mp4-remuxer */"./src/remux/mp4-remuxer.ts");var LINEBREAKS=/\r\n|\n\r|\n|\r/g;// String.prototype.startsWith is not supported in IE11
var startsWith=function startsWith(inputString,searchString,position){if(position===void 0){position=0;}return inputString.substr(position,searchString.length)===searchString;};var cueString2millis=function cueString2millis(timeString){var ts=parseInt(timeString.substr(-3));var secs=parseInt(timeString.substr(-6,2));var mins=parseInt(timeString.substr(-9,2));var hours=timeString.length>9?parseInt(timeString.substr(0,timeString.indexOf(':'))):0;if(!Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(ts)||!Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(secs)||!Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(mins)||!Object(_home_runner_work_hls_js_hls_js_src_polyfills_number__WEBPACK_IMPORTED_MODULE_0__["isFiniteNumber"])(hours)){throw Error("Malformed X-TIMESTAMP-MAP: Local:"+timeString);}ts+=1000*secs;ts+=60*1000*mins;ts+=60*60*1000*hours;return ts;};// From https://github.com/darkskyapp/string-hash
var hash=function hash(text){var hash=5381;var i=text.length;while(i){hash=hash*33^text.charCodeAt(--i);}return(hash>>>0).toString();};// Create a unique hash id for a cue based on start/end times and text.
// This helps timeline-controller to avoid showing repeated captions.
function generateCueId(startTime,endTime,text){return hash(startTime.toString())+hash(endTime.toString())+hash(text);}var calculateOffset=function calculateOffset(vttCCs,cc,presentationTime){var currCC=vttCCs[cc];var prevCC=vttCCs[currCC.prevCC];// This is the first discontinuity or cues have been processed since the last discontinuity
// Offset = current discontinuity time
if(!prevCC||!prevCC.new&&currCC.new){vttCCs.ccOffset=vttCCs.presentationOffset=currCC.start;currCC.new=false;return;}// There have been discontinuities since cues were last parsed.
// Offset = time elapsed
while((_prevCC=prevCC)!==null&&_prevCC!==void 0&&_prevCC.new){var _prevCC;vttCCs.ccOffset+=currCC.start-prevCC.start;currCC.new=false;currCC=prevCC;prevCC=vttCCs[currCC.prevCC];}vttCCs.presentationOffset=presentationTime;};function parseWebVTT(vttByteArray,initPTS,timescale,vttCCs,cc,timeOffset,callBack,errorCallBack){var parser=new _vttparser__WEBPACK_IMPORTED_MODULE_1__["VTTParser"]();// Convert byteArray into string, replacing any somewhat exotic linefeeds with "\n", then split on that character.
// Uint8Array.prototype.reduce is not implemented in IE11
var vttLines=Object(_demux_id3__WEBPACK_IMPORTED_MODULE_2__["utf8ArrayToStr"])(new Uint8Array(vttByteArray)).trim().replace(LINEBREAKS,'\n').split('\n');var cues=[];var initPTS90Hz=Object(_timescale_conversion__WEBPACK_IMPORTED_MODULE_3__["toMpegTsClockFromTimescale"])(initPTS,timescale);var cueTime='00:00.000';var timestampMapMPEGTS=0;var timestampMapLOCAL=0;var parsingError;var inHeader=true;var timestampMap=false;parser.oncue=function(cue){// Adjust cue timing; clamp cues to start no earlier than - and drop cues that don't end after - 0 on timeline.
var currCC=vttCCs[cc];var cueOffset=vttCCs.ccOffset;// Calculate subtitle PTS offset
var webVttMpegTsMapOffset=(timestampMapMPEGTS-initPTS90Hz)/90000;// Update offsets for new discontinuities
if(currCC!==null&&currCC!==void 0&&currCC.new){if(timestampMapLOCAL!==undefined){// When local time is provided, offset = discontinuity start time - local time
cueOffset=vttCCs.ccOffset=currCC.start;}else{calculateOffset(vttCCs,cc,webVttMpegTsMapOffset);}}if(webVttMpegTsMapOffset){// If we have MPEGTS, offset = presentation time + discontinuity offset
cueOffset=webVttMpegTsMapOffset-vttCCs.presentationOffset;}if(timestampMap){var duration=cue.endTime-cue.startTime;var startTime=Object(_remux_mp4_remuxer__WEBPACK_IMPORTED_MODULE_4__["normalizePts"])((cue.startTime+cueOffset-timestampMapLOCAL)*90000,timeOffset*90000)/90000;cue.startTime=startTime;cue.endTime=startTime+duration;}//trim trailing webvtt block whitespaces
var text=cue.text.trim();// Fix encoding of special characters
cue.text=decodeURIComponent(encodeURIComponent(text));// If the cue was not assigned an id from the VTT file (line above the content), create one.
if(!cue.id){cue.id=generateCueId(cue.startTime,cue.endTime,text);}if(cue.endTime>0){cues.push(cue);}};parser.onparsingerror=function(error){parsingError=error;};parser.onflush=function(){if(parsingError){errorCallBack(parsingError);return;}callBack(cues);};// Go through contents line by line.
vttLines.forEach(function(line){if(inHeader){// Look for X-TIMESTAMP-MAP in header.
if(startsWith(line,'X-TIMESTAMP-MAP=')){// Once found, no more are allowed anyway, so stop searching.
inHeader=false;timestampMap=true;// Extract LOCAL and MPEGTS.
line.substr(16).split(',').forEach(function(timestamp){if(startsWith(timestamp,'LOCAL:')){cueTime=timestamp.substr(6);}else if(startsWith(timestamp,'MPEGTS:')){timestampMapMPEGTS=parseInt(timestamp.substr(7));}});try{// Convert cue time to seconds
timestampMapLOCAL=cueString2millis(cueTime)/1000;}catch(error){timestampMap=false;parsingError=error;}// Return without parsing X-TIMESTAMP-MAP line.
return;}else if(line===''){inHeader=false;}}// Parse line by default.
parser.parse(line+'\n');});parser.flush();}/***/},/***/"./src/utils/xhr-loader.ts":/*!*********************************!*\
			  !*** ./src/utils/xhr-loader.ts ***!
			  \*********************************/ /*! exports provided: default */ /***/function srcUtilsXhrLoaderTs(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);/* harmony import */var _utils_logger__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(/*! ../utils/logger */"./src/utils/logger.ts");/* harmony import */var _loader_load_stats__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(/*! ../loader/load-stats */"./src/loader/load-stats.ts");var AGE_HEADER_LINE_REGEX=/^age:\s*[\d.]+\s*$/m;var XhrLoader=/*#__PURE__*/function(){function XhrLoader(config/* HlsConfig */){this.xhrSetup=void 0;this.requestTimeout=void 0;this.retryTimeout=void 0;this.retryDelay=void 0;this.config=null;this.callbacks=null;this.context=void 0;this.loader=null;this.stats=void 0;this.xhrSetup=config?config.xhrSetup:null;this.stats=new _loader_load_stats__WEBPACK_IMPORTED_MODULE_1__["LoadStats"]();this.retryDelay=0;}var _proto=XhrLoader.prototype;_proto.destroy=function destroy(){this.callbacks=null;this.abortInternal();this.loader=null;this.config=null;};_proto.abortInternal=function abortInternal(){var loader=this.loader;self.clearTimeout(this.requestTimeout);self.clearTimeout(this.retryTimeout);if(loader){loader.onreadystatechange=null;loader.onprogress=null;if(loader.readyState!==4){this.stats.aborted=true;loader.abort();}}};_proto.abort=function abort(){var _this$callbacks;this.abortInternal();if((_this$callbacks=this.callbacks)!==null&&_this$callbacks!==void 0&&_this$callbacks.onAbort){this.callbacks.onAbort(this.stats,this.context,this.loader);}};_proto.load=function load(context,config,callbacks){if(this.stats.loading.start){throw new Error('Loader can only be used once.');}this.stats.loading.start=self.performance.now();this.context=context;this.config=config;this.callbacks=callbacks;this.retryDelay=config.retryDelay;this.loadInternal();};_proto.loadInternal=function loadInternal(){var config=this.config,context=this.context;if(!config){return;}var xhr=this.loader=new self.XMLHttpRequest();var stats=this.stats;stats.loading.first=0;stats.loaded=0;var xhrSetup=this.xhrSetup;try{if(xhrSetup){try{xhrSetup(xhr,context.url);}catch(e){// fix xhrSetup: (xhr, url) => {xhr.setRequestHeader("Content-Language", "test");}
// not working, as xhr.setRequestHeader expects xhr.readyState === OPEN
xhr.open('GET',context.url,true);xhrSetup(xhr,context.url);}}if(!xhr.readyState){xhr.open('GET',context.url,true);}var headers=this.context.headers;if(headers){for(var header in headers){xhr.setRequestHeader(header,headers[header]);}}}catch(e){// IE11 throws an exception on xhr.open if attempting to access an HTTP resource over HTTPS
this.callbacks.onError({code:xhr.status,text:e.message},context,xhr);return;}if(context.rangeEnd){xhr.setRequestHeader('Range','bytes='+context.rangeStart+'-'+(context.rangeEnd-1));}xhr.onreadystatechange=this.readystatechange.bind(this);xhr.onprogress=this.loadprogress.bind(this);xhr.responseType=context.responseType;// setup timeout before we perform request
self.clearTimeout(this.requestTimeout);this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),config.timeout);xhr.send();};_proto.readystatechange=function readystatechange(){var context=this.context,xhr=this.loader,stats=this.stats;if(!context||!xhr){return;}var readyState=xhr.readyState;var config=this.config;// don't proceed if xhr has been aborted
if(stats.aborted){return;}// >= HEADERS_RECEIVED
if(readyState>=2){// clear xhr timeout and rearm it if readyState less than 4
self.clearTimeout(this.requestTimeout);if(stats.loading.first===0){stats.loading.first=Math.max(self.performance.now(),stats.loading.start);}if(readyState===4){xhr.onreadystatechange=null;xhr.onprogress=null;var status=xhr.status;// http status between 200 to 299 are all successful
if(status>=200&&status<300){stats.loading.end=Math.max(self.performance.now(),stats.loading.first);var data;var len;if(context.responseType==='arraybuffer'){data=xhr.response;len=data.byteLength;}else{data=xhr.responseText;len=data.length;}stats.loaded=stats.total=len;if(!this.callbacks){return;}var onProgress=this.callbacks.onProgress;if(onProgress){onProgress(stats,context,data,xhr);}if(!this.callbacks){return;}var response={url:xhr.responseURL,data:data};this.callbacks.onSuccess(response,stats,context,xhr);}else{// if max nb of retries reached or if http status between 400 and 499 (such error cannot be recovered, retrying is useless), return error
if(stats.retry>=config.maxRetry||status>=400&&status<499){_utils_logger__WEBPACK_IMPORTED_MODULE_0__["logger"].error(status+" while loading "+context.url);this.callbacks.onError({code:status,text:xhr.statusText},context,xhr);}else{// retry
_utils_logger__WEBPACK_IMPORTED_MODULE_0__["logger"].warn(status+" while loading "+context.url+", retrying in "+this.retryDelay+"...");// abort and reset internal state
this.abortInternal();this.loader=null;// schedule retry
self.clearTimeout(this.retryTimeout);this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay);// set exponential backoff
this.retryDelay=Math.min(2*this.retryDelay,config.maxRetryDelay);stats.retry++;}}}else{// readyState >= 2 AND readyState !==4 (readyState = HEADERS_RECEIVED || LOADING) rearm timeout as xhr not finished yet
self.clearTimeout(this.requestTimeout);this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),config.timeout);}}};_proto.loadtimeout=function loadtimeout(){_utils_logger__WEBPACK_IMPORTED_MODULE_0__["logger"].warn("timeout while loading "+this.context.url);var callbacks=this.callbacks;if(callbacks){this.abortInternal();callbacks.onTimeout(this.stats,this.context,this.loader);}};_proto.loadprogress=function loadprogress(event){var stats=this.stats;stats.loaded=event.loaded;if(event.lengthComputable){stats.total=event.total;}};_proto.getCacheAge=function getCacheAge(){var result=null;if(this.loader&&AGE_HEADER_LINE_REGEX.test(this.loader.getAllResponseHeaders())){var ageHeader=this.loader.getResponseHeader('age');result=ageHeader?parseFloat(ageHeader):null;}return result;};return XhrLoader;}();/* harmony default export */__webpack_exports__["default"]=XhrLoader;/***/}/******/})["default"]);});})(hls);var Hls=/*@__PURE__*/getDefaultExportFromCjs(hls.exports);var type=3;var exts=["m3u8"];var Video=function Video(_ref25){var file=_ref25.file;var _react$exports$useCon7=react.exports.useContext(IContext),getSetting=_react$exports$useCon7.getSetting,lastFiles=_react$exports$useCon7.lastFiles;var videoFiles=lastFiles.filter(function(f){return f.type===type;});var _useTranslation4=useTranslation(),i18n=_useTranslation4.i18n;var fileUrl=useFileUrl();var link=fileUrl();var proxyLink=useFolderLink(true);var url=file.name.endsWith(".m3u8")?link:file.url;var history=useHistory();var art;var subtitleSize=useBreakpointValue({base:"30px",md:"50px"});react.exports.useEffect(function(){var options={container:"#video-player",title:file.name,url:url,autoplay:getSetting("autoplay video")==="true",autoMini:true,autoSize:false,playbackRate:true,flip:true,rotate:true,aspectRatio:true,fullscreen:true,fullscreenWeb:true,mutex:true,light:true,backdrop:true,subtitleOffset:true,miniProgressBar:true,localVideo:true,localSubtitle:true,lang:i18n.language==="zh"?"zh-cn":"en",setting:true,pip:true,customType:{flv:function flv(video,url2){var flvPlayer=flvjs.createPlayer({type:"flv",url:url2},{referrerPolicy:"no-referrer"});flvPlayer.attachMediaElement(video);flvPlayer.load();},m3u8:function m3u8(video,url2){var hls=new Hls();hls.loadSource(url2);hls.attachMedia(video);}},moreVideoAttr:{"webkit-playsinline":true,playsInline:true}};if(file.name.toLowerCase().endsWith(".flv")){options.type="flv";}if(getSetting("artplayer whitelist")){options.whitelist=getSetting("artplayer whitelist").split(",");}else{options.whitelist=[];}var useArt=!isMobile||options.whitelist.some(function(item){return item==="*"||userAgent.indexOf(item)>-1;});if(!useArt){options.moreVideoAttr.controls=true;}if(getSetting("artplayer autoSize")==="true"){options.autoSize=true;}var filename=file.name.substring(0,file.name.lastIndexOf("."));var subtitleType="";var subtitle=lastFiles.find(function(f){var fName=f.name;if(!fName.startsWith(filename)){return false;}for(var _i5=0,_arr2=[".srt",".ass",".vtt"];_i5<_arr2.length;_i5++){var ext=_arr2[_i5];if(fName.endsWith(ext)){return true;}}return false;});if(subtitle){var preLink=proxyLink;preLink+"/"+subtitle.name;options.subtitle={type:subtitleType,url:fileUrl(subtitle),bilingual:true,style:{color:"#03A9F4","font-size":subtitleSize}};}art=new Artplayer(options);art.on("video:ended",function(){var index=videoFiles.findIndex(function(f){return f.name===file.name;});if(index<videoFiles.length-1){history.push(encodeURI(videoFiles[index+1].name));}});return function(){if(art&&art.destroy){art.destroy();}};},[]);return/* @__PURE__ */React$1.createElement(Box,{w:"full",className:"video-preview-box"},/* @__PURE__ */React$1.createElement(Menu,null,/* @__PURE__ */React$1.createElement(MenuButton,{rightIcon:/* @__PURE__ */React$1.createElement(Icon,{boxSize:6,as:BsCardList}),w:"full",colorScheme:"gray",as:Button,mb:2},/* @__PURE__ */React$1.createElement(Text$1,{w:"full",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},file.name)),/* @__PURE__ */React$1.createElement(MenuList,{w:"full",maxH:"65vh",overflowY:"auto",zIndex:999},videoFiles.map(function(f){return/* @__PURE__ */React$1.createElement(MenuItem,{key:f.name,w:"full"},/* @__PURE__ */React$1.createElement(Link,{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",maxW:"85vw",w:"full",as:Link$1,_hover:{textDecoration:"none"},to:encodeURI(f.name)},f.name));}))),/* @__PURE__ */React$1.createElement(Box,{w:"full",h:"60vh",id:"video-player"}),/* @__PURE__ */React$1.createElement(Wrap,{mt:"2",spacing:"2",justify:"center"},/* @__PURE__ */React$1.createElement(Button,{colorScheme:"purple",as:chakra.a,href:"iina://weblink?url=".concat(link)},"IINA"),/* @__PURE__ */React$1.createElement(Button,{colorScheme:"yellow",as:chakra.a,href:"potplayer://".concat(link)},"PotPlayer"),/* @__PURE__ */React$1.createElement(Button,{colorScheme:"orange",as:chakra.a,href:"vlc://".concat(link)},"VLC"),/* @__PURE__ */React$1.createElement(Button,{colorScheme:"teal",as:chakra.a,href:"nplayer-".concat(link)},"nPlayer"),/* @__PURE__ */React$1.createElement(Button,{colorScheme:"blue",as:chakra.a,href:"intent:".concat(link,"#Intent;package=com.mxtech.videoplayer.ad;S.title=").concat(file.name,";end")},"MXPlayer"),/* @__PURE__ */React$1.createElement(Button,{colorScheme:"blue",as:chakra.a,href:"intent:".concat(link,"#Intent;package=com.mxtech.videoplayer.pro;S.title=").concat(file.name,";end")},"MXPlayer Pro")));};var __glob_7_9=/*#__PURE__*/Object.freeze((_Object$freeze10={__proto__:null},_defineProperty3(_Object$freeze10,Symbol.toStringTag,'Module'),_defineProperty3(_Object$freeze10,"type",type),_defineProperty3(_Object$freeze10,"exts",exts),_defineProperty3(_Object$freeze10,'default',Video),_Object$freeze10));var previews={"../preview/audio.tsx":__glob_7_0,"../preview/codeeditor.tsx":__glob_7_1,"../preview/epub.tsx":__glob_7_2,"../preview/image.tsx":__glob_7_3,"../preview/ipa.tsx":__glob_7_4,"../preview/markdown.tsx":__glob_7_5,"../preview/office.tsx":__glob_7_6,"../preview/pdf.tsx":__glob_7_7,"../preview/plist.tsx":__glob_7_8,"../preview/video.tsx":__glob_7_9};var NoPreview=function NoPreview(_ref26){var file=_ref26.file;var _react$exports$useCon8=react.exports.useContext(IContext),getSetting=_react$exports$useCon8.getSetting;var ext=file.name.split(".").pop()||"";var fileUrl=useFileUrl();var _useTranslation5=useTranslation(),t=_useTranslation5.t;return/* @__PURE__ */React$1.createElement(Center,{className:"no-preview",p:"4"},/* @__PURE__ */React$1.createElement(VStack,{spacing:"8"},/* @__PURE__ */React$1.createElement(Icon,{color:getSetting("icon color")||"#1890ff",boxSize:20,as:getIcon(file.type,ext)}),/* @__PURE__ */React$1.createElement(Heading,{size:"md"},file.name),/* @__PURE__ */React$1.createElement(Button,{onClick:function onClick(){window.open(fileUrl(),"_blank");}},t("Download"))));};var FilePreview=exports('default',function(){var _react$exports$useCon9=react.exports.useContext(IContext),files=_react$exports$useCon9.files;useTitle(files[0].name);for(var _path2 in previews){var preview=previews[_path2];var Component=preview.default;if(preview.type===files[0].type||preview.exts.includes(files[0].name.split(".").pop())){return/* @__PURE__ */React$1.createElement(Component,{file:files[0]});}}return/* @__PURE__ */React$1.createElement(NoPreview,{file:files[0]});});}};});})();
